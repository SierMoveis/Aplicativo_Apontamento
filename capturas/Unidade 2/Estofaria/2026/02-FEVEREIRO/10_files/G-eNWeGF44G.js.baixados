;/*FB_PKG_DELIM*/

__d("WAWebAddonCrossWindowUtils",[],(function(t,n,r,o,a,i){function e(e){return e.realType!=null?e.realType:e.revokeAddonType!=null?e.revokeAddonType:e.type}function l(t){return t.type===e(t)}function s(t){var n=e(t);switch(n){case"pin_message":case"reaction":case"reaction_enc":case"comment":case"event_edit_encrypted":case"event_response":case"poll_update":case"newsletter_question_response":case"message_edit_encrypted":return!0;case"keep_in_chat":case"unknown":return!1;default:return!1}}i.getAddonProcessorType=e,i.isRealAddonType=l,i.isInfraSupportedAddon=s}),66);
__d("WAWebAddonEncryptAddonMsgData",["WAWebAddonCrossWindowUtils","WAWebAddonPluginProcessor","WAWebAddonProcessRevokeDataUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WAWebAddonCrossWindowUtils").getAddonProcessorType(e);if(e.type!==t)return e.kind===o("WAWebMsgType").MsgKind.ProtocolAddonRevoke?o("WAWebAddonProcessRevokeDataUtils").protocolRevokeToRevokeMsgData(e):e}function s(t,n){var r=e(t);if(r==null){var a=o("WAWebAddonPluginProcessor").getAddonProcessor(t),i=a.convert,l=i.toDualDecryptedMsgData,s=i.toDualEncryptedMsgData;if(!(s==null||l==null))return{decrypt:function(){return l(t,n)},encrypt:function(){return s(t,n)}}}}l.createDualEncryptionHelper=s}),98);
__d("WAWebAddonInfraError",["$InternalEnum","WACustomError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({UnexpectedError:"unexpected_error",NotSupportedFeature:"not_supported_feature",NotSupportedMsgType:"not_supported_msg_type",UnexpectedMsgType:"unexpected_msg_type",InvalidParentMsgKey:"invalid_parent_msg_key",MissingParentMsg:"missing_parent_msg"}),s=(function(e){function t(t,n){var r,o="errorCode: "+String(t);return n!=null&&(o+=" comment: "+n),r=e.call(this,o)||this,r.name="AddonInfraError",r}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError);l.AddonInfraErrorCode=e,l.AddonInfraError=s}),98);
__d("WAWebWamEnumDeviceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRIMARY:1,COMPANION:2});i.DEVICE_TYPE=e}),66);
__d("WAWebWamEnumDsmError",[],(function(t,n,r,o,a,i){var e=Object.freeze({INVALID_SENDER:1,MISSING_DSM:2,INVALID_DSM:3});i.DSM_ERROR=e}),66);
__d("WAWebWamEnumMediaType",[],(function(t,n,r,o,a,i){var e=Object.freeze({NONE:1,PHOTO:2,VIDEO:3,AUDIO:4,PTT:5,LOCATION:6,CONTACT:7,DOCUMENT:8,URL:9,CALL:10,GIF:11,FUTURE:12,CONTACT_ARRAY:13,LIVE_LOCATION:14,PROFILE_PIC:15,STICKER:16,HSM:17,PRODUCT_IMAGE:18,TEMPLATE:19,MD_APP_STATE:20,MD_HISTORY_SYNC:21,CATALOG_LINK:22,PRODUCT_LINK:23,ORDER:24,LIST:25,LIST_REPLY:26,BUTTON_MESSAGE:27,BUTTON_RESPONSE_MESSAGE:28,PRODUCT_LIST:29,BUTTON_NFM:30,VIEW_ONCE_IMAGE:31,VIEW_ONCE_VIDEO:32,SHOP_STOREFRONT:33,REACTION:34,INTERACTIVE_NFM:35,INTERACTIVE_RESPONSE_NFM:36,POLL_CREATE:37,POLL_VOTE:38,TEXT:39,KEEP:40,UNKEEP:41,INVISIBLE_HELLO:42,MEDIA_EXPRESS_NOTIFY:43,UNDECRYPTED_MEDIA:44,UNDECRYPTED_TEXT:45,UNDECRYPTED_PAY:46,UNDECRYPTED_POLL:47,UNDECRYPTED_REACTION:48,UNDECRYPTED_MEDIA_NOTIFY:49,VIEW_ONCE_AUDIO:50,SCHEDULED_CALL_CREATE:51,SCHEDULED_CALL_CANCEL:52,PUSH_TO_VIDEO:53,PIN_IN_CHAT:54,INTERACTIVE_CAROUSEL:55,COMMENT:56,EPHEMERAL_SYNC_RESPONSE:57,EVENT_CREATE:58,EVENT_RESPOND:59,LOTTIE_STICKER:60,INTERACTIVE_PRODUCT_CAROUSEL:61,INTERACTIVE_PRODUCT:62,MEDIA_ALBUM:63,STICKER_PACK:64,POLL_RESULT_SNAPSHOT:65,MUSIC_ARTWORK:66,RICH_RESPONSE:67,MOTION_PHOTO:68,MOTION_VIDEO:69,APPDATA:70,GROUP_HISTORY:71,GROUP_HISTORY_NOTICE:72,MEMBER_TAG:73});i.MEDIA_TYPE=e}),66);
__d("WAWebWamEnumMessageType",[],(function(t,n,r,o,a,i){var e=Object.freeze({INDIVIDUAL:1,GROUP:2,BROADCAST:3,STATUS:4,CHANNEL:5,INTEROP:6,GREETING:7,MEDIA_HUB:8});i.MESSAGE_TYPE=e}),66);
__d("WAWebWamEnumRevokeType",[],(function(t,n,r,o,a,i){var e=Object.freeze({SENDER:0,ADMIN:1});i.REVOKE_TYPE=e}),66);
__d("WAWebMdBadDeviceSentMessageWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType","WAWebWamEnumDsmError","WAWebWamEnumEditType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumRevokeType"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({MdBadDeviceSentMessage:[2176,{dsmError:[2,o("WAWebWamEnumDsmError").DSM_ERROR],editType:[3,o("WAWebWamEnumEditType").EDIT_TYPE],isLid:[4,o("WAWebWamCodegenUtils").TYPES.BOOLEAN],mediaType:[5,o("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[6,o("WAWebWamEnumMessageType").MESSAGE_TYPE],peerType:[1,o("WAWebWamEnumDeviceType").DEVICE_TYPE],revokeType:[7,o("WAWebWamEnumRevokeType").REVOKE_TYPE]},[1,1,1],"regular"]},{MdBadDeviceSentMessage:[]});l.MdBadDeviceSentMessageWamEvent=e}),98);
__d("WAWebWamEnumE2eFailureReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({INVALID_MESSAGE:0,LEGACY_MESSAGE:1,INVALID_VERSION:2,PRE_KEY_MESSAGE_MISSING_PRE_KEY:3,PRE_KEY_MESSAGE_INVALID_KEY:4,UNTRUSTED_IDENTITY:5,NO_SESSION_AVAILABLE:6,PLAINTEXT_BYTE_MISMATCH:7,UNKNOWN_CIPHERTEXT_TYPE:8,UNKNOWN_CIPHERTEXT_VERSION:9,INVALID_PADDING:10,INVALID_PROTOCOL_BUFFER:11,INVALID_NUMBER_OF_MESSAGE_TYPES:12,INVALID_IMAGE_FILE_LENGTH:13,INVALID_IMAGE_FILE_SHA256:14,INVALID_IMAGE_MEDIA_URL:15,INVALID_IMAGE_MEDIA_KEY:16,INVALID_IMAGE_MIME_TYPE:17,UNKNOWN_V2_TAGS:18,INVALID_EDIT_VERSION:19,INVALID_HSM_NAMESPACE:20,INVALID_HSM_ELEMENT:21,UNKNOWN_PROTOCOL_MESSAGE_TYPE:22,DUPLICATE_MESSAGE:23,FINGERPRINT_IDENTITY_MISMATCH:24,FINGERPRINT_VERSION_MISMATCH:25,INVALID_ARGUMENT:26,INVALID_KEY:27,INVALID_KEY_ID:28,INVALID_MAC:29,NO_MEMORY:30,STALE_KEY_EXCHANGE:31,VRF_SIGNATURE_VERIFICATION_FAILED:32,ERROR_MINIMUM_VALUE:33,ERROR_UNKNOWN:34,INVALID_BROADCAST_STANZA_ATTRIBUTE:35,INVALID_LIST_REPLY_MESSAGE:36,INVALID_LIST_REPLY_ROW_IDENTIFIER:37,INVALID_BUTTONS_RESPONSE_MESSAGE:38,INVALID_BUTTONS_RESPONSE_BUTTON_IDENTIFIER:39,INVALID_ORDER_MESSAGE:40,ERROR_CANCELLED:41,FUTURE_MESSAGE:42,INVALID_EMPTY_PROTOBUF_NOT_ALLOWED:43,SELF_SEND:44,INVALID_MEDIA_MIME_TYPE_TEMPLATE_MESSAGE:45,INVALID_MEDIA_ENC_HASH:46,INVALID_IDENTITY:47,PASSTHROUGH:48,NOT_IN_PENDING_DEVICES:49,EDIT_TYPE_AND_PROTOCOL_MISMATCH:50,DECRYPTION_FAILED:51,DESERIALIZE_INVALID_PROTO_FORMAT:52,DESERIALIZE_RATCHET_KEY_BAD_FORMAT:53,DESERIALIZE_PK_INVALID_PROTO_FORMAT:54,DESERIALZE_PK_KEY_BAD_FORMAT:55,TOO_MANY_MESSAGES_IN_FUTURE:56,EMPTY_VERSION_CONTENT_SUFFIX:57,CONTENT_EXCEEDED_EXPECTED_LENGTH:58,GRP_INVALID_PROTO_FORMAT:59,GRP_INVALID_KEY_FORMAT:60,GRP_VERSION_CONTENT_EMPTY:61,GRP_INVALID_VERSION_CONTENT_LENGTH:62,GRP_SENDER_KEY_INVALID_PROTO_FORMAT:63,GRP_SENDER_KEY_PROTO_ERROR:64,GRP_TOO_MANY_MESSAGES_IN_FUTURE:65,MISSING_MESSAGE_SECRET:66,MESSAGE_SECRET_INVALID:67,INVALID_REACTION_TEXT:68,UNSUPPORTED_MESSAGE_TYPE:69,UNSUPPORTED_IN_INTEROP:70,TARGET_MESSAGE_NOT_FOUND:71,STATUS_FROM_HOSTED_DEVICE_UNSUPPORTED:72,GROUP_MESSAGE_FROM_HOSTED_DEVICE_UNSUPPORTED:73,BROADCAST_FROM_HOSTED_DEVICE_UNSUPPORTED:74,LIVE_LOCATION_FROM_HOSTED_DEVICE_UNSUPPORTED:75,MESSAGE_TYPE_MISMATCH:76,ERROR_SESSION_STATE_UNACKED_PKMSG_GET_BASE_KEY:77,ERROR_SIGNAL_MESSAGE_GET_SENDER_RATCHET_KEY:78,ERROR_SESSION_STATE_GET_ROOT_KEY:79,ERROR_SESSION_STATE_GET_SENDER_RATCHET_KEY_PAIR:80,ERROR_SESSION_STATE_SET_SENDER_CHAIN_KEY:81,ERROR_SESSION_STATE_FIND_RECEIVER_CHAIN:82,ERROR_SESSION_RECORD_DESERIALIZE:83,ERROR_SENDER_KEY_STATE_REMOVE_SENDER_MESSAGE_KEY:84,ERROR_EMPTY_PLAINTEXT_DATA:85,ERROR_MAC_LEN_MISMATCH:86,ERROR_INVALID_MAC_LEN:87,ERROR_INVALID_SIGNATURE_LEN:88,ERROR_SENDER_KEY_LOAD_KEY:89,ERROR_FAST_RATCHET_SENDER_KEY_LOAD_KEY:90,ERROR_UNKNOWN_LOAD_KEY:91,ERROR_UNKNOWN_LOAD_SESSION:92,ERROR_SESSION_RECORD_GET_STATE:93,ERROR_SESSION_STATE_GET_SENDER_CHAIN_KEY:94,ERROR_INVALID_KEY_MATEIRAL_DATA_LEN:95,ERROR_SESSION_STATE_GET_SENDER_RATCHET_KEY:96,ERROR_SESSION_STATE_GET_LOCAL_IDENTITY_KEY:97,ERROR_SESSION_STATE_GET_REMOTE_IDENTITY_KEY:98,ERROR_MEDIA_HASH_VERIFICATION_FAILURE:99,ERROR_CIPHERTEXT_TOO_LONG:100,ERROR_THUMBNAIL_HASH_VERIFICATION_FAILURE:101,ERROR_PARENT_CHILD_SENDER_JID_MISMATCH:102,INVALID_EDIT_MESSAGE:103,INVALID_SESSION:104,INVALID_STATUS_QUESTION_ANSWER_MESSAGE:105,INVALID_REPORTING_TOKEN:106,MISSING_REPORTING_TOKEN:107,INVALID_GUEST_MESSAGE_TYPE:108,INVALID_GUEST_PROTOCOL_BUFFER:109,INVALID_STATUS_STICKER_INTERACTION_MESSAGE:110,INVALID_JPEG_THUMBNAIL:111,DSM_MISSING:112,INVALID_DSM_SENDER:113,INVALID_DSM:114});i.E2E_FAILURE_REASON=e}),66);
__d("WAWebHandleMsgError",["$InternalEnum","WACustomError","WAWebMdBadDeviceSentMessageWamEvent","WAWebWamEnumDsmError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){var e,s=(function(e){function t(t,n){var r;return n===o("WAWebWamEnumDsmError").DSM_ERROR.MISSING_DSM?r=e.call(this,"message should be deviceSentMessage")||this:n===o("WAWebWamEnumDsmError").DSM_ERROR.INVALID_SENDER?r=e.call(this,"message should not be deviceSentMessage")||this:n===o("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM?r=e.call(this,"invalid deviceSentMessage")||this:r=e.call(this,"unknown deviceSentMessage error")||this,r.name="DeviceSentMessageError",new(o("WAWebMdBadDeviceSentMessageWamEvent")).MdBadDeviceSentMessageWamEvent({peerType:t,dsmError:n}).commit(),r.peerType=t,r.dsmError=n,babelHelpers.assertThisInitialized(r)}return babelHelpers.inheritsLoose(t,e),t})((e=o("WACustomError")).CustomError),u=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="UnknownDeviceMessageError",n}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError),c=(function(e){function t(t,n,r){var o,a;return a=e.call(this,typeof t=="string"?t:String(t))||this,a.name="MessageValidationError",a.code=t,a.e2eFailureReason=n,a.sendLogs=(o=r==null?void 0:r.sendLogs)!=null?o:!0,a}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError),d=(function(e){function t(t){var n;return n=e.call(this,"Received Nack error code "+(t!=null?t:"")+" from Server on message sent")||this,n.name="MessageSentAckError",n.ackErrorCode=t,n}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError),m=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="BizNodeValidationError",n}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError),p=n("$InternalEnum")({INVALID_POLL_UPDATE_STANZA:"poll_update_message_stanza_invalid",INVALID_REACTION_STANZA:"reaction_message_stanza_invalid",INVALID_PIN_IN_CHAT_STANZA:"pin_in_chat_message_stanza_invalid",INVALID_COMMENT_STANZA:"comment_message_stanza_invalid",INVALID_EVENT_RESPONSE_STANZA:"event_response_message_stanza_invalid",INVALID_EVENT_EDIT_STANZA:"event_edit_message_stanza_invalid",INVALID_EDIT_STANZA:"edit_message_stanza_invalid",INVALID_NEWSLETTER_EDIT_STANZA:"newsletter_edit_stanza_invalid"}),_=(function(e){function t(t){var n;return n=e.call(this,t,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_TYPE_MISMATCH)||this,n.name="MessageProtobufMismatchError",n}return babelHelpers.inheritsLoose(t,e),t})(c),f=(function(e){function t(t){var n;return n=e.call(this,"Received "+t.length+" message keys: "+t.join(", "),o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_NUMBER_OF_MESSAGE_TYPES)||this,n.name="MessageProtobufInvalidMessageTypes",n}return babelHelpers.inheritsLoose(t,e),t})(c);l.DeviceSentMessageError=s,l.UnknownDeviceMessageError=u,l.MessageValidationError=c,l.MessageSentAckError=d,l.BizNodeValidationError=m,l.MessageProtobufMismatchErrorCode=p,l.MessageProtobufMismatchError=_,l.MessageProtobufInvalidMessageTypes=f}),98);
__d("WAWebWamEnumMessageSecretAllowedType",[],(function(t,n,r,o,a,i){var e=Object.freeze({MESSAGE_POLL:0,MESSAGE_EDIT:1,REACTION:2,COMMENT:3,EVENT_RESPONSE:4,MESSAGE_EVENT_EDIT:5,MESSAGE_REPORTING_TOKEN:6});i.MESSAGE_SECRET_ALLOWED_TYPE=e}),66);
__d("WAWebWamEnumMessageSecretErrorType",[],(function(t,n,r,o,a,i){var e=Object.freeze({MISSING_MESSAGE_SECRET:0,WRONG_LENGTH:1,ENCRYPTION_ERROR:2,DECRYPTION_ERROR:3});i.MESSAGE_SECRET_ERROR_TYPE=e}),66);
__d("WAWebMessageSecretErrorsWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMediaType","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({MessageSecretErrors:[3686,{messageMediaType:[3,o("WAWebWamEnumMediaType").MEDIA_TYPE],messageSecretAllowedList:[1,o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE],messageSecretError:[2,o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE]},[1,1,1],"regular"]},{MessageSecretErrors:[]});l.MessageSecretErrorsWamEvent=e}),98);
__d("WAWebAddonEncryptionError",["$InternalEnum","WALogger","WAWebAddonInfraError","WAWebHandleMsgError","WAWebMessageSecretErrorsWamEvent","WAWebMsgType","WAWebWamEnumE2eFailureReason","WAWebWamEnumMediaType","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType"],(function(t,n,r,o,a,i,l){var e,s,u,c=n("$InternalEnum")({MISSING_MESSAGE_SECRET:"missing_message_secret",WRONG_MESSAGE_SECRET_LENGTH:"wrong_message_secret_length",ENCRYPTION_ERROR:"encryption_error",DECRYPTION_ERROR:"decryption_error"}),d=(function(e){function t(t,n){var r,o="addonType: "+t+", errorCode: "+String(n);return r=e.call(this,o,h(n))||this,r.name="DualEncryptionValidationError",p(t,n),r}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),m=function(n,r){var t=r.messageSecret;if(t==null)throw o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parent msg "," secret is missing"])),r.id),new d(n,c.MISSING_MESSAGE_SECRET);if(t.length!==32)throw o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parent msg "," secret is not 32 bytes"])),r.id),new d(n,c.WRONG_MESSAGE_SECRET_LENGTH);return t};function p(e,t){var n=_(e),r=f(e);if(n==null||r==null)throw o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[DualEncryptionValidationError] missing media type and allowed list value for ",""])),e).sendLogs("dual-encryption-validation-error"),new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError);new(o("WAWebMessageSecretErrorsWamEvent")).MessageSecretErrorsWamEvent({messageSecretError:g(t),messageMediaType:n,messageSecretAllowedList:r}).commit()}function _(e){switch(e){case o("WAWebMsgType").MsgKind.PollVoteEncrypted:case o("WAWebMsgType").MsgKind.PollVoteDecrypted:return o("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE;case o("WAWebMsgType").MsgKind.ReactionEncrypted:case o("WAWebMsgType").MsgKind.ReactionDecrypted:return o("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;case o("WAWebMsgType").MsgKind.EventResponseEncrypted:case o("WAWebMsgType").MsgKind.EventResponseDecrypted:return o("WAWebWamEnumMediaType").MEDIA_TYPE.EVENT_RESPOND;case o("WAWebMsgType").MsgKind.EventEditEncrypted:case o("WAWebMsgType").MsgKind.EventEditDecrypted:return o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case o("WAWebMsgType").MsgKind.CommentEncrypted:case o("WAWebMsgType").MsgKind.CommentDecrypted:return o("WAWebWamEnumMediaType").MEDIA_TYPE.COMMENT;default:return}}function f(e){switch(e){case o("WAWebMsgType").MsgKind.PollVoteEncrypted:case o("WAWebMsgType").MsgKind.PollVoteDecrypted:return o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL;case o("WAWebMsgType").MsgKind.ReactionEncrypted:case o("WAWebMsgType").MsgKind.ReactionDecrypted:return o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.REACTION;case o("WAWebMsgType").MsgKind.EventResponseEncrypted:case o("WAWebMsgType").MsgKind.EventResponseDecrypted:return o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.EVENT_RESPONSE;case o("WAWebMsgType").MsgKind.EventEditEncrypted:case o("WAWebMsgType").MsgKind.EventEditDecrypted:return o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_EVENT_EDIT;case o("WAWebMsgType").MsgKind.CommentEncrypted:case o("WAWebMsgType").MsgKind.CommentDecrypted:return o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.COMMENT;default:return}}function g(e){switch(e){case c.MISSING_MESSAGE_SECRET:return o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.MISSING_MESSAGE_SECRET;case c.WRONG_MESSAGE_SECRET_LENGTH:return o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.WRONG_LENGTH;case c.ENCRYPTION_ERROR:return o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.ENCRYPTION_ERROR;case c.DECRYPTION_ERROR:return o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.DECRYPTION_ERROR}}function h(e){switch(e){case c.MISSING_MESSAGE_SECRET:return o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET;case c.WRONG_MESSAGE_SECRET_LENGTH:return o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID;case c.ENCRYPTION_ERROR:return o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE;case c.DECRYPTION_ERROR:return o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.DECRYPTION_FAILED}}l.DualEncryptionValidationErrorCode=c,l.DualEncryptionValidationError=d,l.getValidatedMessageSecret=m}),98);
__d("WAWebProtobufsReporting.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={};s.internalDefaults={minVersion:1},s.name="Reportable",s.internalSpec={minVersion:[1,(e=o("WAProtoConst")).TYPES.UINT32],maxVersion:[2,e.TYPES.UINT32],notReportableMinVersion:[3,e.TYPES.UINT32],never:[4,e.TYPES.BOOL]},u.name="Config",u.internalSpec={field:[1,e.TYPES.MAP,[e.TYPES.UINT32,c]],version:[2,e.TYPES.UINT32]},c.internalDefaults={minVersion:1},c.name="Field",c.internalSpec={minVersion:[1,e.TYPES.UINT32],maxVersion:[2,e.TYPES.UINT32],notReportableMinVersion:[3,e.TYPES.UINT32],isMessage:[4,e.TYPES.BOOL],subfield:[5,e.TYPES.MAP,[e.TYPES.UINT32,c]]},l.ReportableSpec=s,l.ConfigSpec=u,l.FieldSpec=c}),98);
__d("WAWebReportingTokenConfig",["WAWebProtobufsReporting.pb","decodeProtobuf"],(function(t,n,r,o,a,i,l){function e(e){for(var t=atob(e),n=t.length,r=new Uint8Array(new ArrayBuffer(n)),o=0;o<n;o++)r[o]=t.charCodeAt(o);return r}var s="CgQIARIACjQIAxIwKgQIAhIAKgQIAxIAKgQICBIAKgQICxIAKhAIERIMKgQIFRIAKgQIFhIAKgQIGRIACioIBBImCAIqBggBEgIIAioGCBASAggCKhIIERIOCAIqBAgVEgAqBAgWEgAKOggFEjYIAioGCAMSAggCKgYIBBICCAIqBggFEgIIAioGCBASAggCKhIIERIOCAIqBAgVEgAqBAgWEgAKIggGEh4qBAgBEgAqEAgREgwqBAgVEgAqBAgWEgAqBAgeEgAKLggHEioqBAgCEgAqBAgHEgAqBAgKEgAqEAgREgwqBAgVEgAqBAgWEgAqBAgUEgAKLggIEioqBAgCEgAqBAgHEgAqBAgJEgAqEAgREgwqBAgVEgAqBAgWEgAqBAgVEgAKNAgJEjAqBAgCEgAqBAgGEgAqBAgHEgAqBAgNEgAqEAgREgwqBAgVEgAqBAgWEgAqBAgUEgAKKAgMEiQIAioGCAESAggCKgYIAhICCAIqCAgOEgQIAiABKgYIDxICCAIKKggSEiYIAioGCAYSAggCKgYIEBICCAIqEggREg4IAioECBUSACoECBYSAAouCBoSKioECAQSACoECAUSACoECAgSACoECA0SACoQCBESDCoECBUSACoECBYSAApCCBwSPggCKgYIARICCAIqBggCEgIIAioGCAQSAggCKgYIBRICCAIqBggGEgIIAioSCAcSDggCKgQIFRIAKgQIFhIACgwIJRIIKgYIARICIAEKUggxEk4IAioGCAISAggCKhYIAxISCAIqBggBEgIIAioGCAISAggCKhIIBRIOCAIqBAgVEgAqBAgWEgAqFggIEhIIAioGCAESAggCKgYIAhICCAIKDAg1EggqBggBEgIgAQoOCDcSCggCKgYIARICIAEKDgg6EgoIAioGCAESAiABCg4IOxIKCAIqBggBEgIgAQpSCDwSTggCKgYIAhICCAIqFggDEhIIAioGCAESAggCKgYIAhICCAIqEggFEg4IAioECBUSACoECBYSACoWCAgSEggCKgYIARICCAIqBggCEgIIAgpSCEASTggCKgYIAhICCAIqFggDEhIIAioGCAESAggCKgYIAhICCAIqEggFEg4IAioECBUSACoECBYSACoWCAgSEggCKgYIARICCAIqBggCEgIIAgo2CEISMggCKgQIAhIAKgQIBhIAKgQIBxIAKgQIDRIAKhAIERIMKgQIFRIAKgQIFhIAKgQIFBIACg4IShIKCAIqBggBEgIgAQoOCFcSCggCKgYIARICIAEKMghYEi4IAioGCAESAggCKg4IAhIKCAIqBggBEgIIAioSCAMSDggCKgQIFRIAKgQIFhIACg4IXBIKCAIqBggBEgIgAQoOCF0SCggCKgYIARICIAEKDgheEgoIAioGCAESAiAB",u=(function(){function e(e){var t=e.fieldNumber,n=e.isMessage,r=n===void 0?!1:n,o=e.subfields;this.fieldNumber=t,this.isMessage=r,this.subfields=o}var t=e.prototype;return t.isExtractWholeField=function(){return this.subfields==null||this.subfields.fieldsToFrank.size===0},e})(),c=(function(){function e(e){var t=this;this.fieldsToFrank=new Map,e==null||e.forEach(function(e){t.fieldsToFrank.set(e.fieldNumber,e)})}var t=e.prototype;return t.getConfigForField=function(t){return this.fieldsToFrank.get(t)||null},e})();function d(e,t,n){var r=n.minVersion,o=n.maxVersion,a=o===void 0?1/0:o,i=n.subfield,l=n.isMessage;if(e<r||e>a)return null;if(i==null)return new u({fieldNumber:t,isMessage:l});var s=[];return i.forEach(function(t,n){var r=d(e,n,t);r!=null&&s.push(r)}),new u({fieldNumber:t,isMessage:l,subfields:new c(s)})}var m=new Map;function p(t){var n,r=m.get(t);if(r!=null)return r;var a=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsReporting.pb").ConfigSpec,e(s)),i=[];(n=a.field)==null||n.forEach(function(e,n){var r=d(t,n,e);r!=null&&i.push(r)});var l=new c(i);return m.set(t,l),l}l.getBytesFromBase64=e,l.REPORTING_TOKEN_CONFIG_BASE64=s,l.FieldToExtract=u,l.ReportingTokenConfig=c,l.getReportingTokenConfig=p}),98);
__d("WAWebReportingTokenProtobufUtils",["WABinary"],(function(t,n,r,o,a,i,l){function e(e){return e&7}function s(e){return e>>>3}function u(e){var t=new(o("WABinary")).Binary;return t.writeVarInt(e),t.readByteArrayView()}l.getWireTypeFromTag=e,l.getFieldNumberFromTag=s,l.convertToVarInt=u}),98);
__d("WAWebReportingTokenContent",["WABinary","WAProtoConst","WAWebReportingTokenProtobufUtils","err"],(function(t,n,r,o,a,i,l){var e=function(t){this.value=t;var e=o("WAWebReportingTokenProtobufUtils").convertToVarInt(t);this.size=e.length},s=(function(){function t(t,n){this.valLengthSize=0;var a=new(o("WABinary")).Binary(t);a.advance(n);var i=a.readVarInt(o("WABinary").parseInt64OrThrow);if(i<0||i>=4294967296)throw r("err")("Invalid tag value, out of bound: "+i);var l=o("WAWebReportingTokenProtobufUtils").getWireTypeFromTag(i);this.tag=new e(i);var s=0,u=new(o("WABinary")).Binary;switch(u.writeVarInt(i),l){case o("WAProtoConst").ENC.VARINT:{var c=a.readVarInt(o("WABinary").parseUint64OrThrow);u.writeVarInt(c);break}case o("WAProtoConst").ENC.BINARY:{var d=a.readVarInt(o("WABinary").parseUint64OrThrow),m=a.readByteArrayView(d);s+=o("WAWebReportingTokenProtobufUtils").convertToVarInt(d).length,u.writeVarInt(d),u.writeByteArray(m),this.valLengthSize=s;break}case o("WAProtoConst").ENC.BIT64:{var p=a.readByteArrayView(8);u.writeByteArray(p);break}case o("WAProtoConst").ENC.BIT32:{var _=a.readByteArrayView(4);u.writeByteArray(_);break}default:throw r("err")("Unsupported wire type "+l)}this.bytes=u.readByteArrayView(),this.start=n,this.end=n+this.bytes.length}var n=t.prototype;return n.getFieldNumber=function(){return o("WAWebReportingTokenProtobufUtils").getFieldNumberFromTag(this.tag.value)},n.getWireType=function(){return o("WAWebReportingTokenProtobufUtils").getWireTypeFromTag(this.tag.value)},n.getTotalSize=function(){return this.bytes.length},n.getValueStartIdx=function(){return this.start+this.tag.size+this.valLengthSize},n.getValueEndIdx=function(){return this.end},n.getBytes=function(){return this.bytes},t})(),u=(function(){function e(e,t,n){this.tag=e,this.partsLength=t,this.parts=n,this.partsLengthInBytes=o("WAWebReportingTokenProtobufUtils").convertToVarInt(this.partsLength)}var t=e.prototype;return t.getFieldNumber=function(){return o("WAWebReportingTokenProtobufUtils").getFieldNumberFromTag(this.tag.value)},t.getTotalSize=function(){return this.tag.size+this.partsLengthInBytes.length+this.parts.getTotalSize()},t.getBytes=function(){var e=new(o("WABinary")).Binary;e.writeVarInt(this.tag.value),e.writeVarInt(this.partsLength);for(var t of this.parts.fields)e.writeByteArray(t.getBytes());return e.readByteArrayView()},e})(),c=(function(){function e(){this.fields=[],this.totalSize=0}var t=e.prototype;return t.add=function(t){this.fields.push(t),this.totalSize+=t.getTotalSize()},t.getTotalSize=function(){return this.totalSize},e})(),d=(function(){function e(e,t){this.protobufMessage=e,this.messageConfig=t}var t=e.prototype;return t.extractProtobufParts=function(t,n,r,a){var e=new c;if(a==null)return e;for(var i=n;i<r;){var l=new s(t,i),d=a.getConfigForField(l.getFieldNumber());if(i+=l.getTotalSize(),d!=null)if(d.isMessage===!0||!d.isExtractWholeField()){if(l.getWireType()===o("WAProtoConst").ENC.BINARY){var m=this.extractProtobufParts(t,l.getValueStartIdx(),l.getValueEndIdx(),d.isMessage===!0?this.messageConfig:d.subfields);m.fields.length>0&&e.add(new u(l.tag,m.getTotalSize(),m))}}else e.add(l)}return e.fields.sort(function(e,t){return e.getFieldNumber()-t.getFieldNumber()}),e},t.getReportingTokenContent=function(){var e=this.extractProtobufParts(this.protobufMessage,0,this.protobufMessage.length,this.messageConfig),t=e.fields,n=new(o("WABinary")).Binary;for(var r of t)n.writeByteArray(r.getBytes());return n.readByteArrayView()},e})();l.ReportingTokenContentCalculator=d}),98);
__d("WAWebAddonEncryption",["WACryptoAesGcm","WALogger","WANullthrows","WAUseCaseSecret","WAWebABProps","WAWebAddonEncryptionError","WAWebApiContact","WAWebMessagingGatingUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebReportingTokenConfig","WAWebReportingTokenContent","WAWebWidToJid","asyncToGeneratorRuntime","encodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(e,t){switch(e){case o("WAWebMsgType").MsgKind.PollVoteEncrypted:case o("WAWebMsgType").MsgKind.PollVoteDecrypted:return t.stanzaId+"\0"+t.addOnSenderJid;case o("WAWebMsgType").MsgKind.EventResponseEncrypted:case o("WAWebMsgType").MsgKind.EventResponseDecrypted:return t.stanzaId+"\0"+t.addOnSenderJid;default:return}}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=n.addOnSender,i=n.iv,l=n.messageSecret,c=n.originalMessageSender,m=n.parentWid,p=n.stanzaId;try{var _=o("WAWebWidToJid").widToUserJid(c),f=o("WAWebWidToJid").widToUserJid(a);if(o("WAWebABProps").getABPropConfigValue("lid_one_to_one_migration_event_response_force_pn_jid")&&m!=null&&m.isRegularUser()&&(t.type===o("WAWebMsgType").MsgKind.EventResponseDecrypted||t.type===o("WAWebMsgType").MsgKind.EventEditDecrypted)){if(c.isLid()){var h=o("WAWebApiContact").getPhoneNumber(c);h?_=o("WAWebWidToJid").widToUserJid(h):o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["LID to PN Mapping not found for message sender"]))).sendLogs("missing-lid-to-pn-mapping-for-message-sender")}if(a.isLid()){var y=o("WAWebApiContact").getPhoneNumber(a);y?f=o("WAWebWidToJid").widToUserJid(y):o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["LID to PN Mapping not found for addon sender"]))).sendLogs("missing-lid-to-pn-mapping-for-addon-sender")}}var C=r("WANullthrows")(g(t.type)),b=C.spec,v=C.usecase,S=yield o("WAUseCaseSecret").createUseCaseSecret({messageSecret:l,stanzaId:p,parentMsgOriginalSender:_,modificationSender:f,modificationType:v}),R=o("encodeProtobuf").encodeProtobuf(b,t.encode).readBuffer(),L=yield o("WACryptoAesGcm").gcmEncrypt(S,i,R,d(t.type,{stanzaId:p,addOnSenderJid:f})),E=(t.type===o("WAWebMsgType").MsgKind.CommentDecrypted||t.type===o("WAWebMsgType").MsgKind.EventEditDecrypted||t.type===o("WAWebMsgType").MsgKind.MessageEditDecrypted)&&o("WAWebMessagingGatingUtils").isDualEncryptedReportingTokenSendingEnabled()?new(o("WAWebReportingTokenContent")).ReportingTokenContentCalculator(new Uint8Array(R),o("WAWebReportingTokenConfig").getReportingTokenConfig(o("WAWebMessagingGatingUtils").getSenderReportingTokenVersion())).getReportingTokenContent():null;return babelHelpers.extends({encPayload:L},E!=null&&{reportingTokenContent:E})}catch(e){throw o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed encrypting an addon "," "," ",""])),p,t.type,e),new(o("WAWebAddonEncryptionError")).DualEncryptionValidationError(t.type,o("WAWebAddonEncryptionError").DualEncryptionValidationErrorCode.ENCRYPTION_ERROR)}}),p.apply(this,arguments)}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.addOnSender,a=t.iv,i=t.messageSecret,l=t.originalMessageSender,s=t.stanzaId;try{var u=o("WAWebWidToJid").widToUserJid(n),m=r("WANullthrows")(g(e.type)),p=m.usecase,_=yield o("WAUseCaseSecret").createUseCaseSecret({messageSecret:i,stanzaId:s,parentMsgOriginalSender:o("WAWebWidToJid").widToUserJid(l),modificationSender:u,modificationType:p}),f=yield o("WACryptoAesGcm").gcmDecrypt(_,a,e.encryptedAddOn,d(e.type,{stanzaId:s,addOnSenderJid:u}));return f}catch(t){throw o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed decrypting an addon "," "," ",""])),s,e.type,t),new(o("WAWebAddonEncryptionError")).DualEncryptionValidationError(e.type,o("WAWebAddonEncryptionError").DualEncryptionValidationErrorCode.DECRYPTION_ERROR)}}),f.apply(this,arguments)}function g(e){switch(e){case o("WAWebMsgType").MsgKind.ReactionEncrypted:case o("WAWebMsgType").MsgKind.ReactionDecrypted:return{spec:o("WAWebProtobufsE2E.pb").Message$ReactionMessageSpec,usecase:o("WAUseCaseSecret").UseCaseSecretModificationType.ENC_REACTION};case o("WAWebMsgType").MsgKind.PollVoteEncrypted:case o("WAWebMsgType").MsgKind.PollVoteDecrypted:return{spec:o("WAWebProtobufsE2E.pb").Message$PollVoteMessageSpec,usecase:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE};case o("WAWebMsgType").MsgKind.CommentEncrypted:case o("WAWebMsgType").MsgKind.CommentDecrypted:return{spec:o("WAWebProtobufsE2E.pb").MessageSpec,usecase:o("WAUseCaseSecret").UseCaseSecretModificationType.ENC_COMMENT};case o("WAWebMsgType").MsgKind.EventResponseEncrypted:case o("WAWebMsgType").MsgKind.EventResponseDecrypted:return{spec:o("WAWebProtobufsE2E.pb").Message$EventResponseMessageSpec,usecase:o("WAUseCaseSecret").UseCaseSecretModificationType.EVENT_RESPONSE};case o("WAWebMsgType").MsgKind.EventEditEncrypted:case o("WAWebMsgType").MsgKind.EventEditDecrypted:return{spec:o("WAWebProtobufsE2E.pb").MessageSpec,usecase:o("WAUseCaseSecret").UseCaseSecretModificationType.EVENT_EDIT_ENCRYPTED};case o("WAWebMsgType").MsgKind.MessageEditEncrypted:case o("WAWebMsgType").MsgKind.MessageEditDecrypted:return{spec:o("WAWebProtobufsE2E.pb").MessageSpec,usecase:o("WAUseCaseSecret").UseCaseSecretModificationType.MESSAGE_EDIT}}}l.encryptAddOn=m,l.decryptAddOn=_}),98);
__d("WAWebAddonConstants",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["Unified","Pin","Comment","PollVote","Reaction","EventResponse","None"]),l=n("$InternalEnum").Mirrored(["OnlineReceive","HistorySync","Send","SendRevoke","SendRetry","Revoke","DeleteForMe","DeleteWithParent","Hydration","MarkAsRead","SetAck","ProcessGroupHistoryBundle"]),s=Object.freeze({Regular:"Regular",WithRevokes:"WithRevokes",DualEncrypted:"DualEncrypted",DualEncryptedWithMessageTraits:"DualEncryptedWithMessageTraits"}),u=Object.freeze({PinInChat:1});i.AddonTableMode=e,i.AddonProcessMode=l,i.AddonProcessorType=s,i.AddonMinimizedType=u}),66);
__d("WAWebAddonMarkAsReadUtils",["WALogger","WAWebAddonConstants","WAWebAddonSelectUtils","WAWebAddonUpdateDataUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.map(function(e){return e.read!=null?babelHelpers.extends({},e,{read:!0}):e});try{var r=o("WAWebAddonSelectUtils").getAddonTableMode(t[0]);yield o("WAWebAddonUpdateDataUtils").updateAddonsInTableMode({processMode:o("WAWebAddonConstants").AddonProcessMode.MarkAsRead,tableMode:r},{add:n})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["processMarkAsRead update failed ",""])),t).tags("addons","messaging").sendLogs("processMarkAsRead")}});return function(n){return t.apply(this,arguments)}})();l.processMarkAsRead=s}),98);
__d("WAWebAddonLogUtils",[],(function(t,n,r,o,a,i){function e(e){return e.some(function(e){return e.status==="rejected"})}i.hasSettledWithError=e}),66);
__d("WAWebAddonProcessMsgs",["AddonPlaceholderMsgsUtils","Promise","WALogger","WAWebAddonConstants","WAWebAddonCrossWindowUtils","WAWebAddonEncryptAddonMsgData","WAWebAddonLogUtils","WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils","WAWebAddonSelectUtils","WAWebAddonSortUtils","WAWebAddonUpdateDataUtils","WAWebHandleMsgError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f;function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var r=t.addons,a=t.processMode,i=t.processor,l=i.convert.toDualDecryptedMsgData;if(l==null||a===o("WAWebAddonConstants").AddonProcessMode.HistorySync||a!==o("WAWebAddonConstants").AddonProcessMode.OnlineReceive)return r;var s=[],u=yield(f||(f=n("Promise"))).allSettled(r.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){return o("WAWebAddonCrossWindowUtils").isRealAddonType(t)?l(t,e.getForAddon(t)):t});return function(e){return t.apply(this,arguments)}})()));for(var m of u)m.status==="fulfilled"?s.push(m.value):o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Cannot decrypt a message: ",""])),m.reason);return o("WAWebAddonLogUtils").hasSettledWithError(u)&&o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[addon-infra] Failed to decrypt a message"]))).tags("messagings","addons").sendLogs(String(a)+"-decription-failed",{sampling:.01}),s}),h.apply(this,arguments)}function y(e,t){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.addons,r=t.processMode,a=t.processor,i=t.tableMode,l=a.convert.toDualDecryptedMsgData,s=[],u=l==null?n:yield g(e,t);if(a.type===o("WAWebAddonConstants").AddonProcessorType.DualEncryptedWithMessageTraits){var c=o("AddonPlaceholderMsgsUtils").getIncomingPlaceholderKeys(t);if(c!=null){var d=yield o("AddonPlaceholderMsgsUtils").getPlaceholderMsgKeys(i,c);u=u.filter(function(e){return!d.has(e.id.toString())})}}return s=yield a.beforeUpsert(u,{processMode:r,parents:e}),{processor:a,processMode:r,tableMode:i,addons:s}}),C.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.addons,r=t.processMode,a=t.processor,i=t.tableMode;if(a.type===o("WAWebAddonConstants").AddonProcessorType.DualEncryptedWithMessageTraits){var l=yield o("AddonPlaceholderMsgsUtils").getPlaceholderMsgKeys(i,n.map(function(e){return e.id}));yield a.afterUpsert(n,{processMode:r,parents:e,existingPlaceholderKeys:l})}else yield a.afterUpsert(n,{processMode:r,parents:e})}),v.apply(this,arguments)}function S(e,t,n,r,o){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r,a,i){var l,s=yield(f||(f=n("Promise"))).all(o("WAWebAddonSortUtils").groupAddonsByProcessor(e.mode,t,r).map(function(e){return y(a,e)})),u=(l=[]).concat.apply(l,s.map(function(e){var t=e.addons;return t}));u.length&&(yield o("WAWebAddonUpdateDataUtils").updateAddonsInTableMode({processMode:e.mode,tableMode:t},{add:u},{metricReporter:i})),yield f.all(s.map(function(e){return b(a,e)})),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[addon-infra]: processed "," addon(s) during ",", table mode ",""])),r.length,e.mode,o("WAWebAddonConstants").AddonTableMode.getName(t))}),R.apply(this,arguments)}function L(e,t,n,r){var a=r.failSilently,i=r.metricReporter;return Array.from(o("WAWebAddonSortUtils").groupAddonsByTableMode(t),function(r){var l=r[0],c=r[1];return S(e,l,c,n,i).catch(function(n){if(n instanceof o("WAWebHandleMsgError").MessageValidationError){var r;o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["failed incoming addons processing ",""])),n).tags("addons","messaging").sendLogs("processAddonMsgs: "+((r=t[0])==null?void 0:r.type)+" in "+String(l))}else{var i,c="addon-"+String(e.mode)+"-error: "+((i=t[0])==null?void 0:i.type);o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[AddonInfraError] failed saving addons in "," with "," ",""])),l,n.message,n.stack).tags("addons","messaging").sendLogs(c)}if(!a)throw n})})}function E(e,t,n){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r){if(e.length===0)return{orphans:[]};var a={mode:r!=null?r:o("WAWebAddonConstants").AddonProcessMode.OnlineReceive},i=yield o("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs(e,a.mode),l=i[0],s=i[1],u=o("WAWebAddonSortUtils").collectValidAndOrphanAddons(s,l),c=u.orphans,d=u.validAddons,m=L(a,d,o("WAWebAddonSelectUtils").createAddonParentSelector(l),{metricReporter:t,failSilently:!0});return yield(f||(f=n("Promise"))).allSettled(m),{orphans:c}}),k.apply(this,arguments)}function I(e,t,n,r){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r,a){var i={mode:e},l=L(i,[t],o("WAWebAddonSelectUtils").createAddonParentSelector(r),{metricReporter:a,failSilently:!1});yield(f||(f=n("Promise"))).all(l)}),T.apply(this,arguments)}function D(e,t,n,r){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r,a){var i=r.getForAddon(t),l=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=o("WAWebAddonEncryptAddonMsgData").createDualEncryptionHelper(t,i);return e?e.encrypt():t});return function(){return e.apply(this,arguments)}})(),s=yield(f||(f=n("Promise"))).all([l(),S({mode:e},o("WAWebAddonSelectUtils").getAddonTableMode(t),[t],r,a)]),u=s[0];return{encryptedMsgData:u,decryptedMsgData:t,parent:i}}),x.apply(this,arguments)}function $(e,t,n){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){try{var r,a=o("WAWebAddonPluginProcessor").getAddonProcessor(t);a.updateCollection({add:[t],remove:[]},e);var i=o("WAWebAddonProcessMsgsUtils").getParentMsgKey(t);o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[addon-infra]: optimistic update "," (",") addon, id: ",", parent: ",", isParentLid: ",""])),o("WAWebAddonCrossWindowUtils").getAddonProcessorType(t),t.type,t.id.id,i.id,(r=i.participant)==null?void 0:r.isLid());var l=yield o("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs([t],e),s=l[0],u=l[1],c=yield D(e,u[0],o("WAWebAddonSelectUtils").createAddonParentSelector(s),n);return c}catch(e){throw o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["process optimistic addon msg send: "," ",""])),e.message,e.stack).tags("addons","messaging").sendLogs("failed-optimistic-addon-send"),e}}),P.apply(this,arguments)}function N(e){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0){var t={mode:o("WAWebAddonConstants").AddonProcessMode.HistorySync},r=o("WAWebAddonSelectUtils").createAddonParentSelector(new Map),a=L(t,e,r,{failSilently:!0});yield(f||(f=n("Promise"))).allSettled(a)}}),M.apply(this,arguments)}l.processMsgsAndGetOrphans=E,l.processOutgoingMsg=I,l.processOutgoingMsgOptimisticUpdate=$,l.processHistoryMsgs=N}),98);
__d("WAWebParentMsgKeyValidation",["$InternalEnum","WACustomError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_PARENT_MESSAGE_KEY:"missing_parent_message_key"}),s=(function(e){function t(t,n){var r,o="errorCode: "+String(t);return n!=null&&(o+=" comment: "+n),r=e.call(this,o)||this,r.name="ParentMsgKeyValidationError",r}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError);l.ParentMsgKeyValidationErrorCode=e,l.ParentMsgKeyValidationError=s}),98);
__d("WAWebAddonProcessMsgsUtils",["Promise","WALogger","WAWebAddonConstants","WAWebAddonCrossWindowUtils","WAWebAddonGatingUtils","WAWebAddonPerfUtils","WAWebAddonPluginProcessor","WAWebAddonQueryUtils","WAWebLidMigrationUtils","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebParentMsgKeyValidation","WAWebWid","asyncToGeneratorRuntime","nullthrows"],(function(t,n,r,o,a,i,l){var e,s;function u(e){if(e.targetMessageKey!=null)return"targetMessageKey";if(e.pinParentKey!=null)return"pinParentKey";if(e.pollUpdateParentKey!=null)return"pollUpdateParentKey";if(e.reactionParentKey!=null)return"reactionParentKey";if(e.parentMsgKey!=null)return"parentMsgKey";throw new(o("WAWebParentMsgKeyValidation")).ParentMsgKeyValidationError(o("WAWebParentMsgKeyValidation").ParentMsgKeyValidationErrorCode.MISSING_PARENT_MESSAGE_KEY)}function c(e){var t,n,a,i,l=(t=(n=(a=(i=e.targetMessageKey)!=null?i:e.parentMsgKey)!=null?a:e.pinParentKey)!=null?n:e.pollUpdateParentKey)!=null?t:e.reactionParentKey;if(l instanceof r("WAWebMsgKey"))return l;throw new(o("WAWebParentMsgKeyValidation")).ParentMsgKeyValidationError(o("WAWebParentMsgKeyValidation").ParentMsgKeyValidationErrorCode.MISSING_PARENT_MESSAGE_KEY)}function d(e){var t=c(e);if(t.remote.isBroadcastList()){var n=o("WAWebMsgKeyUtils").msgKeyToTargetInfo(t,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Message),a=t.fromMe?n.to:n.from;return new(r("WAWebMsgKey"))({remote:a,fromMe:t.fromMe,id:t.id})}return t}function m(e){var t=o("WAWebAddonCrossWindowUtils").getAddonProcessorType(e);if(o("WAWebAddonPluginProcessor").getAddonProcessorsMap().has(t))return e}function p(e,t){var n=new Map,a=e.map(function(e){var a,i=d(e),l=o("WAWebLidMigrationUtils").getAlternateMsgKey(i),s=null;if(n.has(i.toString()))s=r("nullthrows")(n.get(i.toString()));else if(l!=null&&n.has(l.toString()))s=r("nullthrows")(n.get(l.toString()));else{var u=t.get(i.toString());u==null&&l&&(u=t.get(l.toString())),u!=null&&!i.equals(u.id)&&(s=u.id,n.set(i.toString(),s))}var c=(a=t.get(i.toString()))!=null?a:l!=null?t.get(l.toString()):void 0;if(c==null)return e;if(s==null)return _(e,c);var m=f(e,s);return _(m,c)});return n.forEach(function(e,n){var r=t.get(n);r!=null&&(t.set(e.toString(),r),t.delete(n))}),[t,a]}function _(e,t){var n,o=t.broadcastId!=null&&r("WAWebWid").isWid(t.broadcastId)&&!!((n=t.broadcastId)!=null&&n.isBroadcastList());if(!o)return e;var a=d(e);return f(e,new(r("WAWebMsgKey"))({id:a.id,fromMe:a.fromMe,remote:a.remote}))}function f(e,t){var n,o=u(e),a=e.id;return e.id.remote.isUser()&&t.remote.isUser()&&(a=new(r("WAWebMsgKey"))({fromMe:e.id.fromMe,remote:t.remote,id:e.id.id})),babelHelpers.extends({},e,(n={id:a},n[o]=t,n))}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.map(d),r;t===o("WAWebAddonConstants").AddonProcessMode.OnlineReceive&&(r=yield o("WAWebAddonPerfUtils").createMessagesQplMarker(o("WAWebAddonPerfUtils").AddonQplMarkerType.Incoming,{type:o("WAWebAddonPerfUtils").AnnotationRequestType.BulkGetParentMsgs,size:n.length}));try{var a,i=yield y(e);return(a=r)==null||a.success(),i}catch(e){var l;throw(l=r)==null||l.fail(),e}}),h.apply(this,arguments)}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(d),n=yield o("WAWebAddonQueryUtils").getParentMsgsByMsgKey(t);return p(e,n)}),C.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{var r=[];for(var a of o("WAWebAddonPluginProcessor").getAddonProcessorsMap().entries()){var i=a[0],l=a[1];o("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(i)&&r.push(l.convert.fromHistorySyncMsg(t))}var u=yield(s||(s=n("Promise"))).all(r).then(function(e){var t;return(t=[]).concat.apply(t,e)});return u}catch(t){return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseHistorySyncMsg: error:",""])),t).tags("addons","messaging").sendLogs("parseHistorySyncMsg"),[]}}),v.apply(this,arguments)}function S(e){var t=[],n=[],r=[];for(var a of e){var i=a.parsedMsgPayload;if(o("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(i.type)){var l=m(i);l!=null?t.push(l):n.push(a)}else i.kind===o("WAWebMsgType").MsgKind.ReactionDecrypted?r.push(i):n.push(a)}return{unifiedAddons:t,otherOrphans:n,legacyReactionAddons:r}}l.getParentMsgKey=d,l.castToAddonMsgData=m,l.updateMsgParentKeyValue=f,l.queryAddonParentMsgs=g,l.queryParentMsgs=y,l.parseHistorySyncMsg=b,l.sortAddonOrphans=S}),98);
__d("WAWebAddonProcessRevoke",["Promise","WALogger","WANullthrows","WAWebAddonConstants","WAWebAddonDBTable","WAWebAddonGatingUtils","WAWebAddonLogUtils","WAWebAddonProcessRevokeDataUtils","WAWebAddonRetryRequestUtils","WAWebAddonSelectUtils","WAWebAddonUpdateDataUtils","WAWebMsgGetters","WAWebNoop","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m;function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,a=[];for(var i of o("WAWebAddonConstants").AddonTableMode.members())i!==o("WAWebAddonConstants").AddonTableMode.None&&a.push(o("WAWebAddonDBTable").addonInternalDBTable.bulkGetByMsgKey(i,e,!1).then(function(e){for(var n of e)n!=null&&t.set(n.id.toString(),n)}).catch(r("WAWebNoop")));return yield(m||(m=n("Promise"))).all(a),o("WAWebAddonSelectUtils").createAddonSelector(t)}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=[],i=function*(){var e=l[0],n=l[1];a.push(o("WAWebAddonUpdateDataUtils").updateAddonsInTableMode({processMode:t.mode,tableMode:e},n).catch(function(t){throw o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["storeRevokesForTableMode for ",": ",""])),e,t),t}))};for(var l of r)yield*i();var u=yield(m||(m=n("Promise"))).allSettled(a);o("WAWebAddonLogUtils").hasSettledWithError(u)&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["revoking addons finished with errors"]))).tags("addons","messaging").sendLogs("revokeAddonMsgs")}),g.apply(this,arguments)}function h(e,t,n){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=[],i=new Map;for(var l of t){var s=n.get(r("WANullthrows")(l.protocolMessageKey));if(o("WAWebAddonGatingUtils").isUnifiedInfraEnabled(s)){var c=o("WAWebAddonSelectUtils").getTableModeByMsgType(s.type);i.has(c)||i.set(c,{add:[],remove:[]});var d=r("WANullthrows")(i.get(c));l.id.equals(s.id)||d.remove.push(s),d.add.push(l),o("WAWebUserPrefsMeUser").isMeAccount(o("WAWebMsgGetters").getFrom(s))&&a.push([s,l])}}o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[addon-infra]: processRevokeMsgs "," addon(s)"])),i.size),yield f(e,i),yield o("WAWebAddonRetryRequestUtils").replaceSelfMessageTypeRows(a)}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n={mode:o("WAWebAddonConstants").AddonProcessMode.SendRevoke};try{yield h(n,[o("WAWebAddonProcessRevokeDataUtils").protocolRevokeToRevokeMsgData(e)],o("WAWebAddonSelectUtils").createAddonSelector(new Map([[t.id.toString(),t]])))}catch(n){throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["process addon revoke ",", ",": ",""])),e.id,t.id,n).tags("addons","messaging").sendLogs("processSentRevokeMsg"),n}}),b.apply(this,arguments)}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t={mode:o("WAWebAddonConstants").AddonProcessMode.Revoke},n=new Set;try{var r=e.map(function(e){return e.revokeMsgKey}),a=yield p(r),i=[];for(var l of e){var s=l.revokeMsgKey;if(!a.has(s)){n.add(s);continue}var u=a.get(s),c=o("WAWebAddonProcessRevokeDataUtils").revokeMsgInfoToRevokeMsgData(l,u);i.push(c)}return yield h(t,i,a),n}catch(e){throw o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["process addon revokes: ",""])),e).tags("addons","messaging").sendLogs("processAddonRevokes"),e}}),S.apply(this,arguments)}l.processSentRevokeMsg=C,l.processRevokeMsgs=v}),98);
__d("WAWebProcessBaseMsgInfo",[],(function(t,n,r,o,a,i){var e=function(t){return{id:t.id,from:t.from,to:t.to,type:t.type,t:t.t,ack:t.ack,count:null,author:t.author,notifyName:t.notifyName,invis:t.invis,subtype:t.subtype,viewMode:t.viewMode}},l=function(t){return{id:t.id,from:t.from,to:t.to,type:t.type,t:t.t,ack:t.ack,count:null,author:t.author,notifyName:t.notifyName,invis:t.invis,subtype:t.subtype,viewMode:t.viewMode}};i.msgToBaseMsgInfo=e,i.msgDataToBaseMsgInfo=l}),66);
__d("WAWebAddonProcessRevokeDataUtils",["WAWebAddonCrossWindowUtils","WAWebAddonProcessMsgsUtils","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebProcessBaseMsgInfo","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e=function(t,n){var e,r=o("WAWebAddonCrossWindowUtils").getAddonProcessorType(n);return babelHelpers.extends({id:t.newMsgKey,type:o("WAWebMsgType").MSG_TYPE.REVOKED,kind:o("WAWebMsgType").MsgKind.RevokedAddon,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:t.subtype==="admin_revoke"?"admin":"sender",revokeTimestamp:(e=t.revokeTimestamp)!=null?e:void 0},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(n.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{revokeAddonType:r,protocolMessageKey:n.id,t:o("WAWebMsgGetters").getT(n),parentMsgKey:o("WAWebAddonProcessMsgsUtils").getParentMsgKey(n)})},s=function(t){return babelHelpers.extends({},o("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(t),{id:t.id},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(t.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{type:o("WAWebMsgType").MSG_TYPE.REVOKED,kind:o("WAWebMsgType").MsgKind.RevokedAddon,subtype:t.subtype==="admin_revoke"?"admin":"sender",revokeTimestamp:t.revokeTimestamp,revokeAddonType:t.revokeAddonType,protocolMessageKey:t.protocolMessageKey,parentMsgKey:t.targetMessageKey})};l.revokeMsgInfoToRevokeMsgData=e,l.protocolRevokeToRevokeMsgData=s}),98);
__d("WAWebMaybe",[],(function(t,n,r,o,a,i){function e(e,t){if(e!=null)return t(e)}i.ifSome=e}),66);
__d("WAWebAddonQueryUtils",["WALogger","WAWebDBMsgUtils","WAWebLidMigrationUtils","WAWebMaybe","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebDBMsgUtils").getMsgsByMsgKey(t.map(String)),a=new Map(n.map(function(e){return[e.id.toString(),e]}));if(a.size===t.length)return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getParentMsgsByMsgKey: found all parent messages (",")"])),a.size),a;var i=a.size,l=t.filter(function(e){return!a.has(e.toString())}),u=r("compactMap")(l,o("WAWebLidMigrationUtils").getAlternateMsgKey);if(u.length>0){var c=yield o("WAWebDBMsgUtils").getMsgsByMsgKey(u.map(String));c.forEach(function(e){o("WAWebMaybe").ifSome(o("WAWebLidMigrationUtils").getAlternateMsgKey(e.id),function(t){a.set(t.toString(),e)})})}return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getParentMsgsByMsgKey: found "," of "," parent messages, "," without alternating keys"])),a.size,t.length,i),a}),c.apply(this,arguments)}l.getParentMsgsByMsgKey=u}),98);
__d("WAWebAddonRetryRequestUtils",["WALogger","WANullthrows","WAWebAck","WAWebAddonConstants","WAWebAddonCrossWindowUtils","WAWebAddonDBTable","WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils","WAWebAddonSelectUtils","WAWebAddonSortUtils","WAWebModelStorageUtils","WAWebSchemaSelfAddonMessageTypeTable","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return(yield o("WAWebSchemaSelfAddonMessageTypeTable").getSelfAddonMessageTypeTable().equals(["msgId"],e.id))[0]}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if((yield u(e.id))==null){var t={msgId:e.id.id,msgType:o("WAWebAddonCrossWindowUtils").getAddonProcessorType(e)};yield o("WAWebSchemaSelfAddonMessageTypeTable").getSelfAddonMessageTypeTable().createOrReplace(t)}}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0)return o("WAWebModelStorageUtils").getStorage().lock(["self-addon-message-type"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],o=yield n.anyOf(["msgId"],e.map(function(e){var t=e[0];return t.id.id})),a=e.map(function(e){var t=e[0],n=e[1];return{msgId:n.id.id,msgType:t.type}});yield n.bulkRemove(r("compactMap")(o,function(e){return e.rowId})),yield n.bulkCreateOrReplace(a)});return function(e){return t.apply(this,arguments)}})())}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield u(t);if(n!=null){var a=o("WAWebAddonSelectUtils").getTableModeByMsgType(n.msgType),i=yield o("WAWebAddonDBTable").addonInternalDBTable.getByMsgKey(a,t);if(i==null){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["msg-retry: can not find addon ","."])),t.toString());return}if(!o("WAWebAddonCrossWindowUtils").isRealAddonType(i))return{msgData:i,selfMsgRow:n};var l=i.ack;if(l==null||l<o("WAWebAck").ACK.SENT){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["msg-retry: can not find addon ","."])),t.toString()).sendLogs("msg-retry");return}var c=o("WAWebAddonPluginProcessor").getAddonProcessor(i).convert.toDualEncryptedMsgData;if(c!=null){var d=yield o("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs([i],o("WAWebAddonConstants").AddonProcessMode.Send),m=d[0],p=d[1],_=o("WAWebAddonSortUtils").collectValidAndOrphanAddons(p,m),f=_.validAddons,g=f[0],h=r("WANullthrows")(m.get(o("WAWebAddonProcessMsgsUtils").getParentMsgKey(g).toString()));return{msgData:yield c(g,h),selfMsgRow:n}}return{msgData:i,selfMsgRow:n}}}),g.apply(this,arguments)}l.hasSentAddonMsg=u,l.storeSelfMessageTypeRow=d,l.replaceSelfMessageTypeRows=p,l.getSentAddonMsgRecord=f}),98);
__d("WAWebApiHydrateWidsUtil",["WAWebWidFactory","WAWebWidJsonReviver"],(function(t,n,r,o,a,i,l){function e(t){if(Array.isArray(t)){for(var n=0;n<t.length;n++)t[n]=e(o("WAWebWidJsonReviver").widReviver(String(n),t[n],o("WAWebWidFactory").isWidlike,o("WAWebWidFactory").createWidFromWidLike));return t}else if(t&&typeof t=="object"){for(var r=Object.keys(t),a=0;a<r.length;a++){var i=r[a];t[i]=e(o("WAWebWidJsonReviver").widReviver(i,t[i],o("WAWebWidFactory").isWidlike,o("WAWebWidFactory").createWidFromWidLike))}return t}return t}l.hydrateWids=e}),98);
__d("WAWebDBCAPIPermissions",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({PENDING:0,ALLOW:1,DENIED:2});i.CloudAPICallingPermissionType=e}),66);
__d("WAWebThreadId",["WAWebMsgKey","WAWebThreadUtils","err"],(function(t,n,r,o,a,i,l){var e=(function(){function e(e){this.type=e.type,this.key=e.key,this._serialized=this.type+"_"+this.key.toString()}var t=e.prototype;return t.toString=function(){return this._serialized},t.equals=function(n){return n instanceof e&&this.toString()===n.toString()},e.from=function(t){var e=t.split("_");if(e.length<2)throw r("err")("ThreadId.from error: invalid string format");var n=e[0],a=e.slice(1,e.length).join("_"),i=o("WAWebThreadUtils").getThreadTypeFromString(n);return o("WAWebThreadUtils").getThreadIDfromType(r("WAWebMsgKey").from(a),i)},e.fromMessage=function(t,n){var e=t instanceof r("WAWebMsgKey")?t:r("WAWebMsgKey").from(t);return o("WAWebThreadUtils").getThreadIDfromType(e,n)},e})();l.default=e}),98);
__d("WAWebThreadUtils",["WAWebMsgKey","WAWebProtobufsE2E.pb","WAWebThreadId","err"],(function(t,n,r,o,a,i,l){var e={AiThread:"aiThread",ViewAllReplies:"viewAllReplies"};function s(t){switch(t){case e.AiThread:case String(o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.AI_THREAD):return e.AiThread;case e.ViewAllReplies:case String(o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.VIEW_REPLIES):return e.ViewAllReplies;default:throw r("err")("getThreadTypeFromString error: invalid thread type")}}function u(t,n){switch(n){case e.AiThread:return new(r("WAWebThreadId"))({type:n,key:r("WAWebMsgKey").from(t)});case e.ViewAllReplies:return new(r("WAWebThreadId"))({type:n,key:r("WAWebMsgKey").from(t)});default:throw r("err")("getThreadIDfromType error: invalid thread type")}}function c(t){switch(t){case o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.AI_THREAD:return e.AiThread;case o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.VIEW_REPLIES:return e.ViewAllReplies;case o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.UNKNOWN:throw r("err")("getThreadsTypeFromE2EValue error: UNKNOWN thread type")}}function d(t){switch(t){case e.AiThread:return o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.AI_THREAD;case e.ViewAllReplies:return o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.VIEW_REPLIES}}l.ThreadType=e,l.getThreadTypeFromString=s,l.getThreadIDfromType=u,l.getThreadsTypeFromE2EValue=c,l.getThreadsTypeAsE2EValue=d}),98);
__d("WAWebDBMessageUtils",["$InternalEnum","WAWebDBCAPIPermissions","WAWebInteractiveMessagesNativeFlowName","WAWebThreadId","WAWebThreadUtils","WAWebVcardParsingUtils"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({IncomingChatMessage:"1",Outgoing:"2",SystemMessage:"3"}),s=n("$InternalEnum")({Default:"",GroupStatus:"gs"});function u(e){var t=e.toString(16);return(t.length-1).toString(16)+t}function c(e){return parseInt(e.substring(1),16)}function d(e){return e.toString()+"_/"}function m(e){return e.toString()+"_g"}function p(e,t,n){n===void 0&&(n=s.Default);var r=u(t);return""+n+e+"_"+r+"_m"}function _(e){var t=e.split("_")[1];return c(t)}function f(e){var t=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e.type);return String(t)+"_"+e.key.toString()+"_"}function g(e,t){var n=u(e),r=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(t.type);return String(r)+"_"+t.key.toString()+"_"+n}function h(e){var t=e.split("_");return r("WAWebThreadId").from(t.slice(0,t.length-1).join("_"))}function y(e,t){var n=e.internalThreadIDs;if(n==null||n.length===0)return!1;var r=f(t);return n.some(function(e){return e.startsWith(r)})}function C(e){var t=e.internalThreadIDs;return t==null||t.length===0?[]:t.map(function(e){return h(e)})}function b(t,n,r,o){var a;return r?a=e.SystemMessage:n?a=e.IncomingChatMessage:a=e.Outgoing,t+"_"+a+"_"+(o!=null?u(o):"")}function v(e){var t=[];if(e.type==="vcard")t=[e.body];else if(e.kind==="multiVcard")t=e.vcardList.map(function(e){return e.vcard});else return;return t.filter(Boolean).reduce(function(e,t){var n=o("WAWebVcardParsingUtils").vcardAllWids(o("WAWebVcardParsingUtils").parseVcard(t));return e.concat(n.map(function(e){return e.toString()}))},[])}function S(e){var t=e.isGroupStatus,n=s.Default;return t===!0&&(n=s.GroupStatus),n}function R(e){return e.type!=="interactive"||(e==null?void 0:e.interactivePayload)==null?!1:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CALL_PERMISSION_REQUEST}function L(e){var t=e.quotedMsg;return(t==null?void 0:t.type)!=="interactive"||(t==null?void 0:t.interactivePayload)==null?!1:t.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CALL_PERMISSION_REQUEST}function E(e){var t,n=e.quotedMsg;if((n==null?void 0:n.type)!=="interactive")return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.PENDING;var r=(t=n.interactivePayload)==null?void 0:t.buttons;if(r==null||r.length===0)return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.PENDING;var a=r[0].buttonParamsJson;if(a==null)return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.PENDING;try{var i,l=JSON.parse(a),s=l==null||(i=l.action_selected)==null?void 0:i.type;if(s==="permanent_allow")return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.ALLOW;if(s==="disallow")return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.DENIED}catch(e){return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.PENDING}return o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.PENDING}l.MessagePropertyType=e,l.InternalIdPrefix=s,l.orderPreservingHex=u,l.undoOrderPreservingHex=c,l.beginningOfChat=d,l.endOfChat=m,l.craftInternalId=p,l.getInChatMsgId=_,l.craftInternalThreadIdPrefix=f,l.craftInternalThreadId=g,l.getThreadIdFromInternalThreadId=h,l.messageHasThreadId=y,l.getThreadIdsFromMessage=C,l.craftMessageRangeIndex=b,l.getVcardWids=v,l.getPrefixForInternalId=S,l.isCoexCallingPermissionsRequestMessage=R,l.isCoexCallingPermissionsResponseMessage=L,l.getSelectedCallingPermissions=E}),98);
__d("WAWebDBMsgOpaqueDataKeys",[],(function(t,n,r,o,a,i){var e=["body","caption","paymentAmount1000","futureproofBuffer","messageSecret","clientUrl","loc","lng","lat","isLive","matchedText","title","description","pollName","pollSelectableOptionsCount","isSentCagPollCreation","pollUpdateParentKey","encPollVote","senderTimestampMs","targetMessageKey","encIv","encPayload","eventName","isEventCanceled","eventDescription","eventJoinLink","eventStartTime","eventLocation","eventEndTime","eventIsScheduledCall","eventExtraGuestsAllowed"],l=["targetMessageKey","pollUpdateParentKey"],s={targetMessageKey:"encReactionTargetMessageKey",encIv:"encReactionEncIv",encPayload:"encReactionEncPayload",encReactionTargetMessageKey:"targetMessageKey",encReactionEncIv:"encIv",encReactionEncPayload:"encPayload"};function u(e,t){return e==="reaction_enc"?s[t]:t}i.MSG_OPAQUE_DATA_KEYS=e,i.MsgKeyFieldsInOpaqueData=l,i.getKey=u}),66);
__d("WAWebPollOptionHashUtils",["WABase64","WAHex","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e}function s(e){return self.crypto.subtle.digest("SHA-256",new TextEncoder().encode(e))}function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s(e);return o("WAHex").toLowerCaseHex(new Uint8Array(t))}),c.apply(this,arguments)}function d(e){return o("WAHex").toHex(e)}function m(e){return o("WAHex").toHex(new Uint8Array(o("WABase64").decodeB64(e))).toUpperCase()}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield u(e),r=n.concat(t);return u(r)}),_.apply(this,arguments)}l.createOptionHashHexFromString=e,l.getHashBufferForString=s,l.getHashHexForString=u,l.bufferToHex=d,l.base64ToHex=m,l.generatePollOptionHash=p}),98);
__d("WAWebPollsDbUtils",["invariant","WANullthrows","WAWebPollOptionHashUtils"],(function(t,n,r,o,a,i,l,s){function e(e){return e==null?void 0:e.slice().sort(function(e,t){return e.localId-t.localId}).map(function(e,t){var n=e.hash,r=e.localId,o=e.name;return r===t||s(0,59784),n!=null?{name:o,hash:n}:{name:o}})}function u(e){var t,n=(t=e==null?void 0:e.pollVotes)!=null?t:[],r=n==null?void 0:n.slice().sort(function(e,t){return e.option.localId-t.option.localId}).map(function(e,t){var n=e.option,r=e.optionVoteCount;return n.localId===t||s(0,59784),{option:{name:n.name},optionVoteCount:r}});return{pollVotes:r}}function c(e){return e==null?void 0:e.map(function(e,t){var n=e.hash,a=e.name;return n==null?{name:r("WANullthrows")(a),localId:t}:{name:r("WANullthrows")(a),localId:t,hash:o("WAWebPollOptionHashUtils").createOptionHashHexFromString(n)}})}function d(e){var t,n=(t=e==null?void 0:e.pollVotes)!=null?t:[],o=n==null?void 0:n.map(function(e,t){var n=e.option,o=e.optionVoteCount;return{option:{name:r("WANullthrows")(n==null?void 0:n.name),localId:t},optionVoteCount:r("WANullthrows")(o)}});return{pollVotes:o}}l.compressPollOptions=e,l.compressPollVotesSnapshot=u,l.expandPollOptions=c,l.expandPollVotesSnapshot=d}),98);
__d("WAWebThreadsGating",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("web_threads_infra_enabled")}function s(){return o("WAWebABProps").getABPropConfigValue("view_replies_infra_enabled")}function u(){return o("WAWebABProps").getABPropConfigValue("hide_auto_quotes_on_web")}function c(){return o("WAWebABProps").getABPropConfigValue("wa_web_enable_follow_up_reply_icon")}l.isThreadsInfraEnabled=e,l.isViewRepliesInfraEnabled=s,l.shouldHideAutoQuote=u,l.isFollowUpReplyEnabled=c}),98);
__d("WAWebDBMessageSerialization",["invariant","WAJids","WAWebApiHydrateWidsUtil","WAWebDBMessageUtils","WAWebDBMsgOpaqueDataKeys","WAWebMsgKey","WAWebMsgType","WAWebPollCreationUtils","WAWebPollsDbUtils","WAWebProtobufsMdStorageMsgRowOpaqueData.pb","WAWebThreadsGating","WAWebViewMode.flow","WAWebWid","WAWebWidFactory","WAWebWidToJid","decodeProtobuf","encodeProtobuf","isArrayNullOrEmpty"],(function(t,n,r,o,a,i,l,s){var e=1e9,u=new Set(Object.values(o("WAWebMsgType").MSG_TYPE)),c=["id","parentMsgId","protocolMessageKey","paymentRequestMessageKey","keptMessageKey","pollUpdateParentKey","kicKey","latestEditMsgKey","targetMessageKey","pinParentKey","reactionParentKey","parentMsgKey","groupHistoryBundleMessageKey"];function d(t,n){var a,i,l,s,u,d,_=babelHelpers.extends({},t);t.quotedMsg&&(_.quotedMsg=babelHelpers.extends({},t.quotedMsg)),(a=t.quotedMsg)!=null&&a.paymentNoteMsg&&(_.quotedMsg.paymentNoteMsg=babelHelpers.extends({},t.quotedMsg.paymentNoteMsg)),t.paymentNoteMsg&&(_.paymentNoteMsg=babelHelpers.extends({},t.paymentNoteMsg)),t.groupMentions&&(_.groupMentions=t.groupMentions.map(function(e){return{groupSubject:e.groupSubject,groupJid:o("WAWebWidFactory").createWidFromWidLike(e.groupJid)}})),_.star=_.isStarred!==void 0,_.isMdHistoryMsg=_.rowId<e,_.internalId!=null&&(((i=_.to)==null?void 0:i.server)==="newsletter"||(l=_.from)!=null&&l.endsWith("@newsletter"))&&(_.serverId=o("WAWebDBMessageUtils").getInChatMsgId(_.internalId)),!r("isArrayNullOrEmpty")(_.internalThreadIDs)&&o("WAWebThreadsGating").isThreadsInfraEnabled()&&(_.threadIds=_.internalThreadIDs.map(function(e){return o("WAWebDBMessageUtils").getThreadIdFromInternalThreadId(e)})),delete _.internalId,delete _.isStarred,delete _.count,delete _.hasLink,delete _.isMediaMsg,delete _.isDocMsg,delete _.isCallLogMsg,delete _.isCarouselMsg,delete _.isEventMsg,delete _.typeFlag,delete _.expiredTimestamp,delete _.pendingReadReceipt,p(_),o("WAWebApiHydrateWidsUtil").hydrateWids(_),c.forEach(function(e){_[e]!=null&&(_[e]=r("WAWebMsgKey").from(_[e]))}),((s=_.quotedMsg)==null?void 0:s.id)!=null&&(_.quotedMsg.id=r("WAWebMsgKey").from(_.quotedMsg.id)),((u=_.groupHistoryIndividualMessageInfo)==null?void 0:u.bundleMessageKey)!=null&&(_.groupHistoryIndividualMessageInfo.bundleMessageKey=r("WAWebMsgKey").from(_.groupHistoryIndividualMessageInfo.bundleMessageKey)),_.messageSecret!=null&&(_.messageSecret=new Uint8Array(_.messageSecret)),_.botMessageSecret!=null&&(_.botMessageSecret=new Uint8Array(_.botMessageSecret));var f=m(_),g=f[0],h=f[1],y=f[2];return _.futureproofType=g,_.futureproofSubtype=h,_.subtype=y!=null?y:void 0,_.viewMode=(d=_.viewMode)!=null?d:o("WAWebViewMode.flow").ViewModeType.VISIBLE,_.carouselCardsParsed!=null&&(_.carouselCardsParsed=_.carouselCardsParsed.map(function(e){return babelHelpers.extends({},e,{id:e.id instanceof r("WAWebMsgKey")?e.id:new(r("WAWebMsgKey"))(e.id),parentMsgId:e.parentMsgId instanceof r("WAWebMsgKey")?e.parentMsgId:new(r("WAWebMsgKey"))(e.parentMsgId)})})),n==null||n(_),_}function m(e){var t=e.futureproofSubtype,n=e.futureproofType,r=e.subtype;if(e.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&e.futureproofType==null&&e.subtype!=null){switch(e.subtype){case"poll_update":{n=o("WAWebMsgType").MSG_TYPE.POLL_UPDATE,t="poll_vote";break}case"message_edit":{n=o("WAWebMsgType").MSG_TYPE.PROTOCOL,t="message_edit";break}case"phone":case"phone_only_feature":break;default:u.has(e.subtype)||s(0,67194),n=e.subtype}e.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&n!=null&&(r=void 0)}return e.type===o("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&r==null&&(r="poll_vote"),[n,t,r]}function p(e){var t=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsMdStorageMsgRowOpaqueData.pb").MsgRowOpaqueDataSpec,e.msgRowOpaqueData),n=t.currentMsg,a=t.quotedMsg;if(n){n.paymentNoteMsgBody!=null&&e.paymentNoteMsg&&(e.paymentNoteMsg.body=n.paymentNoteMsgBody),o("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(t){e[t]=n[o("WAWebDBMsgOpaqueDataKeys").getKey(e.type,t)]}),e.pollOptions=o("WAWebPollsDbUtils").expandPollOptions(n.pollOptions),e.pollVotesSnapshot=o("WAWebPollsDbUtils").expandPollVotesSnapshot(n.pollVotesSnapshot),n.correctOptionIndex!=null&&(e.correctOptionIndex=n.correctOptionIndex),(e.type===o("WAWebMsgType").MSG_TYPE.POLL_CREATION||e.type===o("WAWebMsgType").MSG_TYPE.POLL_RESULT_SNAPSHOT)&&(e.pollContentType=o("WAWebPollCreationUtils").getPollContentTypeFromDBValue(n.pollContentType),e.pollType=o("WAWebPollCreationUtils").getPollTypeFromDBValue(n.pollType));var i=n.originalSelfAuthor;i!=null&&r("WAWebWid").isWid(i)&&(e.originalSelfAuthor=o("WAWebWidFactory").createWid(i)),n.plainProtobufBytes!=null&&(e.plainProtobufBytes=new Uint8Array(n.plainProtobufBytes))}e.quotedMsg&&a&&(a.paymentNoteMsgBody!=null&&(e.quotedMsg.paymentNoteMsg.body=a.paymentNoteMsgBody),o("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(t){e.quotedMsg[t]=a[o("WAWebDBMsgOpaqueDataKeys").getKey(e.type,t)]}),e.quotedMsg.pollOptions=o("WAWebPollsDbUtils").expandPollOptions(a.pollOptions))}function _(e,t){var n,r,o=babelHelpers.extends({},e);return e.quotedMsg&&(o.quotedMsg=babelHelpers.extends({},e.quotedMsg)),(n=e.quotedMsg)!=null&&n.paymentNoteMsg&&(o.quotedMsg.paymentNoteMsg=babelHelpers.extends({},e.quotedMsg.paymentNoteMsg)),e.paymentNoteMsg&&(o.paymentNoteMsg=babelHelpers.extends({},e.paymentNoteMsg)),e.from&&(o.from=e.from.toString()),(t==null?void 0:t.storeReportingInfo)===!0&&(o.preMatChat=e.preMatChat,o.senderWithDevice=e.senderWithDevice),c.forEach(function(e){o[e]!=null&&(o[e]=o[e].toString())}),((r=o.groupHistoryIndividualMessageInfo)==null?void 0:r.bundleMessageKey)!=null&&(o.groupHistoryIndividualMessageInfo.bundleMessageKey=o.groupHistoryIndividualMessageInfo.bundleMessageKey.toString()),delete o.notifyName,delete o.isNewMsg,delete o.clearMedia,delete o.multicast,delete o.urlNumber,delete o.urlText,delete o.linkPreview,delete o.star,delete o.forwardedFromWeb,f(o,t),o}function f(e,t){var n,r,a={currentMsg:{},quotedMsg:{}};if((n=e.paymentNoteMsg)!=null&&n.body){var i;a.currentMsg.paymentNoteMsgBody=e.paymentNoteMsg.body,(i=e.paymentNoteMsg)==null||delete i.body}(r=e.quotedMsg)!=null&&(r=r.paymentNoteMsg)!=null&&r.body&&(a.quotedMsg.paymentNoteMsgBody=e.quotedMsg.paymentNoteMsg.body,delete e.quotedMsg.paymentNoteMsg.body),e.correctOptionIndex!=null&&(a.currentMsg.correctOptionIndex=e.correctOptionIndex,delete e.correctOptionIndex),o("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(t){a.currentMsg[o("WAWebDBMsgOpaqueDataKeys").getKey(e.type,t)]=e[t],delete e[t]}),e.originalSelfAuthor&&(a.currentMsg.originalSelfAuthor=o("WAJids").extractUserJid(o("WAWebWidToJid").widToDeviceJid(e.originalSelfAuthor)),delete e.originalSelfAuthor),a.currentMsg.pollContentType=o("WAWebPollCreationUtils").getPollContentTypeAsDBValue(e.pollContentType),delete e.pollContentType,a.currentMsg.pollType=o("WAWebPollCreationUtils").getPollTypeAsDBValue(e.pollType),delete e.pollType,a.currentMsg.pollOptions=o("WAWebPollsDbUtils").compressPollOptions(e.pollOptions),delete e.pollOptions,a.currentMsg.pollVotesSnapshot=o("WAWebPollsDbUtils").compressPollVotesSnapshot(e.pollVotesSnapshot),delete e.pollVotesSnapshot,e.quotedMsg&&(o("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(t){a.quotedMsg[t]=e.quotedMsg[t],delete e.quotedMsg[t]}),a.quotedMsg.pollOptions=o("WAWebPollsDbUtils").compressPollOptions(e.quotedMsg.pollOptions),delete e.quotedMsg.pollOptions),(t==null?void 0:t.storeReportingInfo)===!0&&e.plainProtobufBytes!=null&&(a.currentMsg.plainProtobufBytes=e.plainProtobufBytes),delete e.plainProtobufBytes;var l=o("encodeProtobuf").encodeProtobuf(o("WAWebProtobufsMdStorageMsgRowOpaqueData.pb").MsgRowOpaqueDataSpec,a);e.msgRowOpaqueData=l.readBuffer()}l.messageFromDbRow=d,l.movFieldFromOpaqueDataBackToMsg=p,l.dbRowFromMessage=_,l.movEncFieldToOpaqueData=f}),98);
__d("WAWebDBCommentMessageSerialization",["WANullthrows","WAWebDBMessageSerialization","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebViewMode.flow","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=babelHelpers.extends({},e);return o("WAWebDBMessageSerialization").movEncFieldToOpaqueData(t),babelHelpers.extends({},t,{msgKey:t.id.toString(),parentMsgKey:t.parentMsgKey.toString(),sender:t.author.toString()})}function s(e){var t;return{msgKey:e.id.toString(),sender:r("WANullthrows")(o("WAWebMsgGetters").getSender(e),"undefined sender").toString(),parentMsgKey:e.parentMsgKey.toString(),t:o("WAWebMsgGetters").getT(e),ack:(t=o("WAWebMsgGetters").getAck(e))!=null?t:void 0,read:e.read,isOverwrittenByRevoke:!0,subtype:e.subtype,revokeTimestamp:e.revokeTimestamp,protocolMessageKey:e.protocolMessageKey.toString()}}function u(e){return{isPlaceholder:!0,msgKey:e.id.toString(),sender:r("WANullthrows")(o("WAWebMsgGetters").getSender(e),"undefined sender").toString(),parentMsgKey:e.parentMsgKey.toString(),read:e.read,t:o("WAWebMsgGetters").getT(e)}}function c(e){var t,n=r("WAWebMsgKey").from(e.msgKey),a=r("WAWebMsgKey").from(e.parentMsgKey),i=babelHelpers.extends({id:n,parentMsgKey:a,ack:e.ack,t:e.t},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(n,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE});if(e.isOverwrittenByRevoke===!0){var l;return babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.REVOKED,kind:o("WAWebMsgType").MsgKind.RevokedAddon,subtype:r("WANullthrows")(e.subtype),revokeAddonType:o("WAWebMsgType").MSG_TYPE.COMMENT,revokeTimestamp:(l=e.revokeTimestamp)!=null?l:void 0,protocolMessageKey:r("WAWebMsgKey").from(r("WANullthrows")(e.protocolMessageKey,"undefined protocolMessageKey"))})}if(e.isPlaceholder===!0)return babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.CIPHERTEXT,kind:o("WAWebMsgType").MsgKind.PlaceholderAddon,realType:o("WAWebMsgType").MSG_TYPE.COMMENT});var s=babelHelpers.extends({},e);return o("WAWebDBMessageSerialization").movFieldFromOpaqueDataBackToMsg(s),babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.COMMENT,kind:o("WAWebMsgType").MsgKind.CommentDecrypted,from:o("WAWebWidFactory").createUserWidOrThrow(s.sender),body:s.body,author:o("WAWebWidFactory").createUserWidOrThrow(s.sender),read:(t=e.read)!=null?t:!1})}l.dbRowFromCommentMessage=e,l.dbRowFromRevokedMsgData=s,l.dbRowFromPlaceholderAddon=u,l.commentMessageFromDbRow=c}),98);
__d("WAWebAddonCommentTableMode",["WAWebAddonConstants","WAWebAddonInfraError","WAWebCommentSchema","WAWebDBCommentMessageSerialization","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e={mode:o("WAWebAddonConstants").AddonTableMode.Comment,bulkUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){if(e.kind===o("WAWebMsgType").MsgKind.CommentDecrypted)return o("WAWebDBCommentMessageSerialization").dbRowFromCommentMessage(e);if(e.kind===o("WAWebMsgType").MsgKind.RevokedAddon)return o("WAWebDBCommentMessageSerialization").dbRowFromRevokedMsgData(e);if(e.kind===o("WAWebMsgType").MsgKind.PlaceholderAddon)return o("WAWebDBCommentMessageSerialization").dbRowFromPlaceholderAddon(e);throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType)});yield o("WAWebCommentSchema").getTable().bulkCreateOrReplace(t)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByParentAndSender:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebCommentSchema").getTable().bulkGet(e.map(function(e){return e.toString()}),t);return n.map(function(e){return e==null?e:o("WAWebDBCommentMessageSerialization").commentMessageFromDbRow(e)})});function t(t,n){return e.apply(this,arguments)}return t})(),bulkGetByParentMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebCommentSchema").getTable().anyOf(["parentMsgKey"],e.map(function(e){return e.toString()}));return t.map(o("WAWebDBCommentMessageSerialization").commentMessageFromDbRow)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByChatWid:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkRemoveByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebCommentSchema").getTable().bulkRemove(e.map(function(e){return e.toString()}))});function t(t){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebCommentSchema").getTable().get(e.toString());return t==null?null:o("WAWebDBCommentMessageSerialization").commentMessageFromDbRow(t)});function t(t){return e.apply(this,arguments)}return t})(),updateAck:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){yield o("WAWebCommentSchema").getTable().merge(e.id.toString(),{ack:t})});function t(t,n){return e.apply(this,arguments)}return t})(),markAsRead:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebCommentSchema").getTable().merge(e.toString(),{read:!0})});function t(t){return e.apply(this,arguments)}return t})(),getTableSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebCommentSchema").getTable().count()});function t(){return e.apply(this,arguments)}return t})()};l.commentTableMode=e}),98);
__d("WAWebEventResponseDBSerialization",["WANullthrows","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebViewMode.flow","err"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WAWebProtobufsE2E.pb").Message$EventResponseMessage$EventResponseType.cast(new Uint8Array(e)[0]);if(t==null)throw r("err")("Value contained in array buffer is not a valid event response");return t}function s(e){var t=new ArrayBuffer(1),n=new Uint8Array(t);return n[0]=e,n.buffer}function u(e){var t=r("WANullthrows")(o("WAWebMsgGetters").getSender(e));return{msgKey:e.id.toString(),parentMsgKey:e.parentMsgKey.toString(),eventResponse:s(e.eventResponse),senderTimestampMs:e.senderTimestampMs,sender:t.toString(),t:e.t,ack:e.ack,read:o("WAWebUserPrefsMeUser").isMeAccount(t)||e.read}}function c(t){var n,a=r("WAWebMsgKey").from(t.msgKey);return babelHelpers.extends({id:a},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(a,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{type:o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:o("WAWebMsgType").MsgKind.EventResponseDecrypted,ack:t.ack,t:t.t,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,eventResponse:e(t.eventResponse),parentMsgKey:r("WAWebMsgKey").from(t.parentMsgKey),senderTimestampMs:t.senderTimestampMs,read:(n=t.read)!=null?n:!1})}l.decodeEventResponseFromDBRow=e,l.dbRowFromEventResponseMessage=u,l.eventResponseMessageFromDBRow=c}),98);
__d("WAWebAddonEventResponseTableMode",["WANullthrows","WAWebAddonConstants","WAWebAddonInfraError","WAWebEventResponseDBSerialization","WAWebEventResponsesSchema","WAWebMsgGetters","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e={mode:o("WAWebAddonConstants").AddonTableMode.EventResponse,bulkUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebEventResponsesSchema").getTable().bulkCreateOrReplace(e.map(function(e){if(e.kind!==o("WAWebMsgType").MsgKind.EventResponseDecrypted)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);return o("WAWebEventResponseDBSerialization").dbRowFromEventResponseMessage(e)}))});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByParentAndSender:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebEventResponsesSchema").getTable().anyOf(["parentMsgKey","sender"],e.map(function(e){return[e[0].toString(),e[1].toString()]}));return t.map(o("WAWebEventResponseDBSerialization").eventResponseMessageFromDBRow)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByParentMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebEventResponsesSchema").getTable().anyOf(["parentMsgKey"],e.map(function(e){return e.toString()}));return t.map(o("WAWebEventResponseDBSerialization").eventResponseMessageFromDBRow)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByChatWid:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkRemoveByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebEventResponsesSchema").getTable().bulkRemoveByIndex(["msgKey"],e.map(function(e){return e.toString()}))});function t(t){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=(t=yield o("WAWebEventResponsesSchema").getTable().equals(["msgKey"],e.toString()))==null?void 0:t[0];return n==null?n:o("WAWebEventResponseDBSerialization").eventResponseMessageFromDBRow(n)});function t(t){return e.apply(this,arguments)}return t})(),updateAck:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n;if(e.kind===o("WAWebMsgType").MsgKind.EventResponseEncrypted)n=e.targetMessageKey;else if(e.kind===o("WAWebMsgType").MsgKind.EventResponseDecrypted)n=e.parentMsgKey;else throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);yield o("WAWebEventResponsesSchema").getTable().merge([n.toString(),r("WANullthrows")(o("WAWebMsgGetters").getSender(e)).toString()],{ack:t})});function t(t,n){return e.apply(this,arguments)}return t})(),markAsRead:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield e.getByMsgKey(t);if(n!=null)return e.bulkUpsert([babelHelpers.extends({},n,{read:!0})])});function r(e){return t.apply(this,arguments)}return r})(),getTableSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebEventResponsesSchema").getTable().count()});function t(){return e.apply(this,arguments)}return t})()};l.eventResponseTableMode=e}),98);
__d("WAWebMaxPerGroup",[],(function(t,n,r,o,a,i){function e(e,t,n){var r=new Map;for(var o of e){var a=n(o),i=r.get(a);(i==null||t(o)>=t(i))&&r.set(a,o)}return Array.from(r.values())}i.maxPerGroup=e}),66);
__d("WAWebPollsDbSerialization",["WAWebMsgKey","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t={msgKey:e.msgKey.toString(),parentMsgKey:e.parentMsgKey.toString(),selectedOptionLocalIds:new Uint8Array(e.selectedOptionLocalIds).buffer,senderTimestampMs:e.senderTimestampMs,sender:e.sender.toString(),read:e.read};return e.t!=null&&(t.t=e.t),e.ack!=null&&(t.ack=e.ack),t}function s(e){var t;return{msgKey:r("WAWebMsgKey").fromString(e.msgKey),parentMsgKey:r("WAWebMsgKey").fromString(e.parentMsgKey),selectedOptionLocalIds:Array.from(new Uint8Array(e.selectedOptionLocalIds)),senderTimestampMs:e.senderTimestampMs,t:e.t,sender:o("WAWebWidFactory").createUserWidOrThrow(e.sender),ack:e.ack,read:(t=e.read)!=null?t:!0}}l.dbRowFromVote=e,l.voteFromDbRow=s}),98);
__d("WAWebPollsGetVoteKey",["WAWebLidMigrationUtils","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.parentMsgKey,n=e.sender,r=o("WAWebWidFactory").createWidFromWidLike(n);return String(t)+"|"+String(o("WAWebLidMigrationUtils").toLid(r))+"|"+String(o("WAWebLidMigrationUtils").toPn(r))}l.getVoteKey=e}),98);
__d("WAWebDBPollsUpsertVotes",["WAWebApiContact","WAWebMaxPerGroup","WAWebModelStorageUtils","WAWebPollsDbSerialization","WAWebPollsGetVoteKey","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WAWebMaxPerGroup").maxPerGroup(e,function(e){return e.senderTimestampMs},o("WAWebPollsGetVoteKey").getVoteKey);return o("WAWebModelStorageUtils").getStorage().lock(["poll-votes"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=yield n.anyOf(["parentMsgKey","sender"],s(t)),a=new Map;for(var i of r)a.set(o("WAWebPollsGetVoteKey").getVoteKey(i),i);var l=[],u=[],c=[];for(var d of t){var m,p=a.get(o("WAWebPollsGetVoteKey").getVoteKey(d));if(p!=null){if(p.senderTimestampMs>d.senderTimestampMs){l.push(o("WAWebPollsDbSerialization").voteFromDbRow(p));continue}String(d.sender)!==String(p.sender)&&c.push(p)}var _=d.selectedOptionLocalIds.length===0,f=(m=p==null?void 0:p.read)!=null?m:!1,g=!_&&f&&d.read!==f?babelHelpers.extends({},d,{read:!0}):d;l.push(g),u.push(o("WAWebPollsDbSerialization").dbRowFromVote(g))}return c.length>0&&(yield n.bulkRemove(u.map(function(e){return[e.parentMsgKey,e.sender]}))),u.length>0&&(yield n.bulkCreateOrReplace(u)),l});return function(t){return e.apply(this,arguments)}})())}function s(e){var t=[];for(var n of e){var r=n.parentMsgKey,a=n.sender;t.push([r.toString(),a.toString()]);var i=o("WAWebApiContact").getAlternateUserWid(a);i!=null&&t.push([r.toString(),i.toString()])}return t}l.upsertVotesDb=e}),98);
__d("WAWebPollsVoteDataUtils",["WANullthrows","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r,a=o("WAWebMsgKeyUtils").msgKeyToTargetInfo(e.msgKey,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),i=a.author,l=a.from,s=a.to;return{id:e.msgKey,to:s,from:l,author:i,type:o("WAWebMsgType").MSG_TYPE.POLL_UPDATE,kind:o("WAWebMsgType").MsgKind.PollVoteDecrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,pollUpdateParentKey:e.parentMsgKey,selectedOptionLocalIds:e.selectedOptionLocalIds,senderTimestampMs:e.senderTimestampMs,t:(t=e.t)!=null?t:void 0,ack:(n=e.ack)!=null?n:void 0,read:(r=e.read)!=null?r:!1}}function s(e){return{msgKey:e.id,parentMsgKey:e.pollUpdateParentKey,selectedOptionLocalIds:e.selectedOptionLocalIds,senderTimestampMs:e.senderTimestampMs,t:e.t,sender:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e))),ack:o("WAWebMsgGetters").getAck(e),read:o("WAWebUserPrefsMeUser").isMeAccount(e.from)||e.read}}l.voteDataToPollVoteMsgData=e,l.pollVoteMsgDataToVoteData=s}),98);
__d("WAWebAddonPollVoteTableMode",["WANullthrows","WAWebAddonConstants","WAWebAddonInfraError","WAWebDBPollsUpsertVotes","WAWebMsgType","WAWebPollsDbSerialization","WAWebPollsVoteDataUtils","WAWebPollsVotesSchema","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=function(t){return o("WAWebPollsVoteDataUtils").voteDataToPollVoteMsgData(o("WAWebPollsDbSerialization").voteFromDbRow(t))},s={mode:o("WAWebAddonConstants").AddonTableMode.PollVote,bulkUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){if(e.kind!==o("WAWebMsgType").MsgKind.PollVoteDecrypted)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);return o("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData(e)});yield o("WAWebDBPollsUpsertVotes").upsertVotesDb(t)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByParentAndSender:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebPollsVotesSchema").getTable().anyOf(["parentMsgKey","sender"],t.map(function(e){return[e[0].toString(),e[1].toString()]}));return n.map(e)});function r(e){return t.apply(this,arguments)}return r})(),bulkGetByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByParentMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebPollsVotesSchema").getTable().anyOf(["parentMsgKey"],t.map(function(e){return e.toString()}));return n.map(e)});function r(e){return t.apply(this,arguments)}return r})(),bulkGetByChatWid:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkRemoveByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebPollsVotesSchema").getTable().bulkRemoveByIndex(["msgKey"],e.map(function(e){return e.toString()}))});function t(t){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=(yield o("WAWebPollsVotesSchema").getTable().equals(["msgKey"],t.toString()))[0];return n==null?n:e(n)});function r(e){return t.apply(this,arguments)}return r})(),updateAck:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e.kind!==o("WAWebMsgType").MsgKind.PollVoteDecrypted&&e.kind!==o("WAWebMsgType").MsgKind.PollVoteEncrypted)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);yield o("WAWebPollsVotesSchema").getTable().merge([e.pollUpdateParentKey.toString(),r("WANullthrows")(e.from).toString()],{ack:t})});function t(t,n){return e.apply(this,arguments)}return t})(),markAsRead:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s.getByMsgKey(e);if(t!=null)return s.bulkUpsert([babelHelpers.extends({},t,{read:!0})])});function t(t){return e.apply(this,arguments)}return t})(),getTableSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebPollsVotesSchema").getTable().count()});function t(){return e.apply(this,arguments)}return t})()};l.pollVoteTableMode=s}),98);
__d("WAWebAddonDBTable",["WAWebAddonCommentTableMode","WAWebAddonConstants","WAWebAddonEventResponseTableMode","WAWebAddonInfraError","WAWebAddonPinTableMode","WAWebAddonPollVoteTableMode","WAWebAddonReactionTableMode","WAWebAddonSelectUtils","WAWebAddonUnifiedAddonsTableMode","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=function(t){switch(t){case o("WAWebAddonConstants").AddonTableMode.Pin:return o("WAWebAddonPinTableMode").pinTableMode;case o("WAWebAddonConstants").AddonTableMode.PollVote:return o("WAWebAddonPollVoteTableMode").pollVoteTableMode;case o("WAWebAddonConstants").AddonTableMode.Comment:return o("WAWebAddonCommentTableMode").commentTableMode;case o("WAWebAddonConstants").AddonTableMode.Reaction:return o("WAWebAddonReactionTableMode").reactionTableMode;case o("WAWebAddonConstants").AddonTableMode.EventResponse:return o("WAWebAddonEventResponseTableMode").eventResponseTableMode;case o("WAWebAddonConstants").AddonTableMode.Unified:return o("WAWebAddonUnifiedAddonsTableMode").unifiedAddonsTableMode;case o("WAWebAddonConstants").AddonTableMode.None:throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)}},s={bulkUpsert:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){if(n.length!==0)return e(t).bulkUpsert(n)});function r(e,n){return t.apply(this,arguments)}return r})(),bulkGetByParentAndSender:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){return n.length===0?[]:e(t).bulkGetByParentAndSender(n)});function r(e,n){return t.apply(this,arguments)}return r})(),bulkGetByMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){return e(t).bulkGetByMsgKey(n,r)});function r(e,n,r){return t.apply(this,arguments)}return r})(),bulkGetByParentMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){return e(t).bulkGetByParentMsgKey(n)});function r(e,n){return t.apply(this,arguments)}return r})(),bulkGetByChatWid:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){return e(t).bulkGetByChatWid(n)});function r(e,n){return t.apply(this,arguments)}return r})(),bulkRemoveByMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){if(n.length!==0)return e(t).bulkRemoveByMsgKey(n)});function r(e,n){return t.apply(this,arguments)}return r})(),updateAck:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){return e(t).updateAck(n,r)});function r(e,n,r){return t.apply(this,arguments)}return r})(),getByMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){return e(t).getByMsgKey(n)});function r(e,n){return t.apply(this,arguments)}return r})(),getTableSize:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){return e(t).getTableSize()});function r(e){return t.apply(this,arguments)}return r})()},u={bulkGetByParentAndSender:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return s.bulkGetByParentAndSender(o("WAWebAddonSelectUtils").getTableModeByMsgType(e),t)});function t(t,n){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return s.getByMsgKey(o("WAWebAddonSelectUtils").getTableModeByMsgType(e),t)});function t(t,n){return e.apply(this,arguments)}return t})()};l.addonInternalDBTable=s,l.addonDBTable=u}),98);
__d("WAWebCastToPinInChatMsg",["invariant","WAWebMsgType"],(function(t,n,r,o,a,i,l,s){function e(e){return e.type===o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE?e:null}function u(t){var n=e(t);return n!=null||s(0,76405),n}l.assertPinInChatMsgData=u}),98);
__d("WAWebAddonPinTableMode",["WAWebAddonConstants","WAWebAddonInfraError","WAWebCastToPinInChatMsg","WAWebDBCRUDOperationsPinInChat","WAWebPinInChatSchema","WAWebPinsDbSerialization","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e={mode:o("WAWebAddonConstants").AddonTableMode.Pin,bulkUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){return o("WAWebPinsDbSerialization").serializePinInChatMsgData(o("WAWebCastToPinInChatMsg").assertPinInChatMsgData(e))});yield o("WAWebDBCRUDOperationsPinInChat").createOrUpdatePinInChat(e[0].id.remote,t)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByParentAndSender:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByParentMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==1)return[];var t=yield o("WAWebPinInChatSchema").getTable().get(e[0].toString());return t==null?[]:[o("WAWebPinsDbSerialization").deserializePinInChatMsgData(t)]});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByChatWid:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebPinInChatSchema").getTable().anyOf(["chatId"],e.map(function(e){return e.toString()}));return t.map(o("WAWebPinsDbSerialization").deserializePinInChatMsgData)});function t(t){return e.apply(this,arguments)}return t})(),bulkRemoveByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebPinInChatSchema").getTable().bulkRemoveByIndex(["msgKey"],e.map(function(e){return e.toString()}))});function t(t){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=(yield o("WAWebPinInChatSchema").getTable().equals(["msgKey"],e.toString()))[0];return t==null?t:o("WAWebPinsDbSerialization").deserializePinInChatMsgData(t)});function t(t){return e.apply(this,arguments)}return t})(),updateAck:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WAWebPinsDbSerialization").serializePinInChatMsgData(o("WAWebCastToPinInChatMsg").assertPinInChatMsgData(e));yield o("WAWebPinInChatSchema").getTable().merge(n.parentMsgKey,{ack:t})});function t(t,n){return e.apply(this,arguments)}return t})(),markAsRead:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield e.getByMsgKey(t);if(n!=null)return e.bulkUpsert([babelHelpers.extends({},n,{read:!0})])});function r(e){return t.apply(this,arguments)}return r})(),getTableSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebPinInChatSchema").getTable().count()});function t(){return e.apply(this,arguments)}return t})()};l.pinTableMode=e}),98);
__d("WAWebCastToReactionMsg",["invariant","WAWebMsgType"],(function(t,n,r,o,a,i,l,s){function e(e){return e.type===o("WAWebMsgType").MSG_TYPE.REACTION?e:null}function u(t){var n=e(t);return n!=null||s(0,73785),n}l.castToReactionMsgData=e,l.assertReactionMsgData=u}),98);
__d("WAWebAddonReactionTableMode",["WANullthrows","WAWebAddonConstants","WAWebAddonInfraError","WAWebCastToReactionMsg","WAWebMsgGetters","WAWebMsgType","WAWebReactionDataUtils","WAWebSchemaReactions","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e={mode:o("WAWebAddonConstants").AddonTableMode.Reaction,bulkUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){return o("WAWebReactionDataUtils").reactionMsgDataToReactionRow(o("WAWebCastToReactionMsg").assertReactionMsgData(e))});yield o("WAWebSchemaReactions").getReactionsTable().bulkCreateOrReplace(t)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByParentAndSender:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","senderUserJid"],e.map(function(e){var t=e[0],n=e[1];return[t.toString(),n.toString()]}));return t.map(o("WAWebReactionDataUtils").reactionRowToReactionMsgData)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByParentMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey"],e.map(function(e){return e.toString()}));return t.map(o("WAWebReactionDataUtils").reactionRowToReactionMsgData)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByChatWid:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkRemoveByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebSchemaReactions").getReactionsTable().bulkRemoveByIndex(["msgKey"],e.map(function(e){return e.toString()}))});function t(t){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=(yield o("WAWebSchemaReactions").getReactionsTable().equals(["msgKey"],e.toString()))[0];return t==null?t:o("WAWebReactionDataUtils").reactionRowToReactionMsgData(t)});function t(t){return e.apply(this,arguments)}return t})(),updateAck:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n;if(e.kind===o("WAWebMsgType").MsgKind.ReactionEncrypted)n=e.targetMessageKey;else if(e.kind===o("WAWebMsgType").MsgKind.ReactionDecrypted)n=e.reactionParentKey;else throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType);yield o("WAWebSchemaReactions").getReactionsTable().merge([n.toString(),r("WANullthrows")(o("WAWebMsgGetters").getSender(e)).toString()],{ack:t})});function t(t,n){return e.apply(this,arguments)}return t})(),markAsRead:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield e.getByMsgKey(t);if(n!=null)return e.bulkUpsert([babelHelpers.extends({},n,{read:!0})])});function r(e){return t.apply(this,arguments)}return r})(),getTableSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebSchemaReactions").getReactionsTable().count()});function t(){return e.apply(this,arguments)}return t})()};l.reactionTableMode=e}),98);
__d("WAWebAddonUnifiedAddonsTableMode",["WAWebAddonConstants","WAWebAddonInfraError","WAWebMsgType","WAWebPinsDbSerialization","WAWebSchemaUnifiedAddons","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=function(t){return t.map(function(e){if(e.rowType===o("WAWebAddonConstants").AddonMinimizedType.PinInChat)return o("WAWebPinsDbSerialization").unifiedAddonRowIntoPinInChatMsgData(e);throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType)})},s={mode:o("WAWebAddonConstants").AddonTableMode.Unified,bulkUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){if(e.kind===o("WAWebMsgType").MsgKind.PinInChat)return o("WAWebPinsDbSerialization").pinInChatMsgDatIntoUnifiedAddonRow(e);throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});yield o("WAWebSchemaUnifiedAddons").getTable().bulkCreateOrReplace(t)});function t(t){return e.apply(this,arguments)}return t})(),bulkGetByParentAndSender:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function t(){return e.apply(this,arguments)}return t})(),bulkGetByParentMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebSchemaUnifiedAddons").getTable().anyOf(["targetMsgKey"],t.map(function(e){return e.toString()}));return e(n)});function r(e){return t.apply(this,arguments)}return r})(),bulkGetByChatWid:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebSchemaUnifiedAddons").getTable().anyOf(["arbitraryIndex"],t.map(function(e){return e.toString()}));return e(n)});function r(e){return t.apply(this,arguments)}return r})(),bulkRemoveByMsgKey:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebSchemaUnifiedAddons").getTable().bulkRemove(e.map(function(e){return e.toString()}))});function t(t){return e.apply(this,arguments)}return t})(),getByMsgKey:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebSchemaUnifiedAddons").getTable().get(t.toString());return n==null?null:e([n])[0]});function r(e){return t.apply(this,arguments)}return r})(),updateAck:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){yield o("WAWebSchemaUnifiedAddons").getTable().merge(e.id.toString(),{ack:t})});function t(t,n){return e.apply(this,arguments)}return t})(),markAsRead:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function t(){return e.apply(this,arguments)}return t})(),getTableSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebSchemaUnifiedAddons").getTable().count()});function t(){return e.apply(this,arguments)}return t})()};l.unifiedAddonsTableMode=s}),98);
__d("AddonPlaceholderMsgsUtils",["WAWebAddonConstants","WAWebAddonDBTable","WAWebAddonInfraError","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){var t=e.addons,n=e.processor;if(n.type!==o("WAWebAddonConstants").AddonProcessorType.DualEncryptedWithMessageTraits)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature);var r=[];for(var a of t)a.kind===o("WAWebMsgType").MsgKind.PlaceholderAddon&&r.push(a.id);return r.length===0?null:r}function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebAddonDBTable").addonInternalDBTable.bulkGetByMsgKey(e,t),r=new Set;for(var a of n)a!=null&&a.kind===o("WAWebMsgType").MsgKind.PlaceholderAddon&&r.add(a.id.toString());return r}),u.apply(this,arguments)}l.getIncomingPlaceholderKeys=e,l.getPlaceholderMsgKeys=s}),98);
__d("WAWebAddOnParseWebMsgInfo",["WALongInt","WANullthrows","WATimeUtils","WAWebE2EProtoUtils","WAWebMsgKey","WAWebUserPrefsMeUser","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e,t,n){var a=!!e.fromMe,i=o("WAWebE2EProtoUtils").decodeJid(e.remoteJid),l=t===!0?o("WAWebUserPrefsMeUser").getMeLidUserOrThrow():o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),s;if(a?i!=null&&typeof i!="string"&&!i.isUser()&&(s=l):s=n!=null?o("WAWebE2EProtoUtils").decodeJid(n):o("WAWebE2EProtoUtils").decodeJid(e.participant),typeof i=="string"||i==null)return null;var u;s!=null&&typeof s!="string"?u=new(r("WAWebMsgKey"))({id:r("WANullthrows")(e.id),fromMe:a,remote:i,participant:s}):u=new(r("WAWebMsgKey"))({id:r("WANullthrows")(e.id),fromMe:a,remote:i});var c=u.participant||u.remote,d=o("WAWebWidFactory").asUserWidOrThrow(a===!0?l:c);return{msgKey:u,sender:d}}function s(e){return e==null?null:Math.floor(o("WALongInt").numberOrThrowIfTooLarge(e)/1e3)}function u(e){var t=o("WATimeUtils").unixTimeMs();return e==null?t:Math.max(e+1,t)}l.buildAddonMsgKey=e,l.getAddonServerTimestamp=s,l.getIncreasingLatestSenderTimestampMs=u}),98);
__d("WAWebAddonGatingUtils",["WAWebAddonCrossWindowUtils","WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebAddonPluginProcessor").hasAddonProcessor(e)?o("WAWebAddonPluginProcessor").getAddonProcessor(e).isEnabled():!1}function s(e){var t=o("WAWebAddonProcessMsgsUtils").castToAddonMsgData(e);return t==null||!o("WAWebAddonCrossWindowUtils").isInfraSupportedAddon(t)?!1:o("WAWebAddonPluginProcessor").getAddonProcessor(t).isEnabled()}l.isUnifiedInfraEnabledForType=e,l.isUnifiedInfraEnabled=s}),98);
__d("WAWebAddonHydrationUtils",["WALogger","WAWebAddonConstants","WAWebAddonCrossWindowUtils","WAWebAddonDBTable","WAWebAddonPerfUtils","WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils","WAWebAddonSelectUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsHistorySync","WAWebWid","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s={};function u(e){var t,n=e,r=n.length&&((t=o("WAWebUserPrefsHistorySync").getHistorySyncStatus())==null?void 0:t.recentCompleted)===!0&&n[0].type!==o("WAWebMsgType").MSG_TYPE.REACTION;return r&&(n=e.filter(function(e){var t;return e.type===o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE?t=e.id.remote:t=o("WAWebAddonProcessMsgsUtils").getParentMsgKey(e),m(t,o("WAWebAddonCrossWindowUtils").getAddonProcessorType(e))})),n}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.hydrationType,a=t.ids,i=function(t){s[n]||(s[n]=new Set),!m(t,n)&&s[n].add(t.toString())},l=a.filter(function(e){return!m(e,n)});if(l.length!==0){var u;try{var c,d=o("WAWebAddonSelectUtils").getTableModeByMsgType(n),p;if(n===o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE){u=yield o("WAWebAddonPerfUtils").createAddonQplMarker(o("WAWebAddonPerfUtils").AddonQplMarkerType.UI,{mode:d,type:o("WAWebAddonPerfUtils").AnnotationRequestType.BulkGetByChatWid,size:1});var _=r("compactMap")(l,function(e){return e instanceof r("WAWebWid")?e:null});p=yield o("WAWebAddonDBTable").addonInternalDBTable.bulkGetByChatWid(d,_)}else{u=yield o("WAWebAddonPerfUtils").createAddonQplMarker(o("WAWebAddonPerfUtils").AddonQplMarkerType.UI,{mode:d,type:o("WAWebAddonPerfUtils").AnnotationRequestType.BulkGetByParentMsgKeys,size:1});var f=r("compactMap")(l,function(e){return e instanceof r("WAWebMsgKey")?e:null});p=yield o("WAWebAddonDBTable").addonInternalDBTable.bulkGetByParentMsgKey(d,f)}(c=u)==null||c.success(),p.length&&(yield o("WAWebAddonPluginProcessor").getAddonProcessor(n).updateCollection({add:p,remove:[]},o("WAWebAddonConstants").AddonProcessMode.Hydration));var g=o("WAWebUserPrefsHistorySync").getHistorySyncStatus();(g==null?void 0:g.recentCompleted)===!0&&l.forEach(i)}catch(t){var h;(h=u)==null||h.fail(),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[Addon][Hydration] Failed to hydrate "," for "," with error, ",""])),n,l.map(function(e){return e.toString()}),t).sendLogs("hydratingAddonMsgs",{sampling:.01})}}}),d.apply(this,arguments)}function m(e,t){var n;return!!((n=s[t])!=null&&n.has(e.toString()))}function p(){for(var e of Object.keys(s))delete s[e]}l.filterAddonsByHydratedStatus=u,l.hydrateAddons=c,l.clearHydrationCache=p}),98);
__d("WAWebAddonPerfUtils",["$InternalEnum","WANullthrows","WAQplTypes","WAWebABProps","WAWebAddonConstants","WAWebAddonDBTable","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({BulkUpsert:"bulk_upsert",BulkRemoveByParents:"bulk_remove_by_parents",BulkGetByParentMsgKeys:"bulk_get_by_parent_msg_keys",BulkGetByChatWid:"bulk_get_by_chat_wid",BulkGetParentMsgs:"bulk_get_parent_msgs"}),s=n("$InternalEnum").Mirrored(["Incoming","Outgoing","UI"]);function u(e){return e<10001?1e4:e<30001?3e4:e<500001?5e4:e<1000001?1e5:e<3000001?3e5:e<5000001?5e5:e<8000001?8e5:1e6}var c={date:0,values:new Map};function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=c,n=new Date().setHours(0,0,0,0);if(t.date===n){var r=t.values.get(e);if(r==null){var a=u(yield o("WAWebAddonDBTable").addonInternalDBTable.getTableSize(e));return t.values.set(e,a),a}return r}t.date=n,t.values.clear();var i=u(yield o("WAWebAddonDBTable").addonInternalDBTable.getTableSize(e));return t.values.set(e,i),i}),m.apply(this,arguments)}function p(){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e="messages",t=c,n=new Date().setHours(0,0,0,0);if(t.date===n){var r=t.values.get(e);if(r==null){var a=u(yield o("WAWebSchemaMessage").getMessageTable().count());return t.values.set(e,a),a}return r}t.date=n,t.values.clear();var i=u(yield o("WAWebSchemaMessage").getMessageTable().count());return t.values.set(e,i),i}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){return{string:{request_type:e.getName(t.type),table_mode:o("WAWebAddonConstants").AddonTableMode.getName(t.mode)},int:{request_size:t.size,table_size:yield d(t.mode)}}}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){return{string:{request_type:e.getName(t.type),table_mode:"messages"},int:{request_size:t.size,table_size:yield p()}}}),y.apply(this,arguments)}function C(){return o("WAWebABProps").getABPropConfigValue("addon_infra_enable_perf_logging")}function b(e){return{success:function(){return e==null?void 0:e.end(o("WAQplTypes").QuickLogActionType.SUCCESS)},fail:function(){return e==null?void 0:e.end(o("WAQplTypes").QuickLogActionType.FAIL)}}}function v(e){var t=Math.random();return t<=e/100}function S(e,t){switch(e){case s.Incoming:return t===o("WAWebAddonConstants").AddonTableMode.Reaction?v(3):v(10);case s.Outgoing:return v(25);case s.UI:return v(1)}}function R(e,t,n){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(C()&&S(e,t)){var a;switch(e){case s.Incoming:a=o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ADDON_PROCESS_INCOMING;break;case s.Outgoing:a=o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ADDON_PROCESS_OUTGOING;break;case s.UI:a=o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ADDON_CHAT_REQUEST;break}var i=o("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(r("WANullthrows")(a),{annotations:yield n()});return b(i)}}),L.apply(this,arguments)}function E(e,t){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return R(e,t.mode,function(){return f(t)})}),k.apply(this,arguments)}function I(e,t){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return R(e,o("WAWebAddonConstants").AddonTableMode.None,function(){return h(t)})}),T.apply(this,arguments)}l.AnnotationRequestType=e,l.AddonQplMarkerType=s,l.getCachedTableSize=d,l.createAddonQplMarker=E,l.createMessagesQplMarker=I}),98);
__d("WAWebAddonSelectUtils",["WAWebABProps","WAWebAddonConstants","WAWebAddonCrossWindowUtils","WAWebAddonInfraError","WAWebAddonProcessMsgsUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){if(e===o("WAWebMsgType").MSG_TYPE.REVOKED)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType,"revoke is not expected to cross this path");if(e===o("WAWebMsgType").MSG_TYPE.PROTOCOL)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType,"protocol revoke is not expected to cross this path");switch(e){case o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE:return o("WAWebABProps").getABPropConfigValue("unified_pin_addon_table_enabled")?o("WAWebAddonConstants").AddonTableMode.Unified:o("WAWebAddonConstants").AddonTableMode.Pin;case o("WAWebMsgType").MSG_TYPE.COMMENT:return o("WAWebAddonConstants").AddonTableMode.Comment;case o("WAWebMsgType").MSG_TYPE.POLL_UPDATE:return o("WAWebAddonConstants").AddonTableMode.PollVote;case o("WAWebMsgType").MSG_TYPE.REACTION_ENC:case o("WAWebMsgType").MSG_TYPE.REACTION:return o("WAWebAddonConstants").AddonTableMode.Reaction;case o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE:return o("WAWebAddonConstants").AddonTableMode.EventResponse;case o("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED:return o("WAWebAddonConstants").AddonTableMode.None;case o("WAWebMsgType").MSG_TYPE.MESSAGE_EDIT_ENCRYPTED:return o("WAWebAddonConstants").AddonTableMode.Unified;default:throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType,"received "+e+" msgType")}}function s(t){return e(o("WAWebAddonCrossWindowUtils").getAddonProcessorType(t))}function u(e){return{getByParentMsgKey:function(n){var t=e.get(n);if(t==null)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError);return t},getForAddon:function(n){var t=e.get(o("WAWebAddonProcessMsgsUtils").getParentMsgKey(n).toString());if(t==null)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError);return t}}}function c(e){return{get:function(n){var t=e.get(n.toString());if(t==null)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError);return t},has:function(n){return!!e.get(n.toString())}}}l.getTableModeByMsgType=e,l.getAddonTableMode=s,l.createAddonParentSelector=u,l.createAddonSelector=c}),98);
__d("WAWebMessageAssociationConstants",["WAWebMsgType"],(function(t,n,r,o,a,i,l){var e=new Set([o("WAWebMsgType").MSG_TYPE.ALBUM]);l.orphanIneligibleFutureproofTypes=e}),98);
__d("WAWebAddonSortUtils",["WAWebAddonCrossWindowUtils","WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils","WAWebAddonSelectUtils","WAWebMessageAssociationConstants","WAWebMsgType","WAWebWid"],(function(t,n,r,o,a,i,l){function e(e,t){var n=s(e,t),r=n.nonOrphans,o=n.orphans;return{orphans:o,validAddons:r}}function s(e,t){var n=[],a=[];for(var i of e){var l=t.get(o("WAWebAddonProcessMsgsUtils").getParentMsgKey(i).toString()),s=l==null||(l==null?void 0:l.type)===o("WAWebMsgType").MSG_TYPE.UNKNOWN;if((l==null?void 0:l.futureproofType)!=null?s=!o("WAWebMessageAssociationConstants").orphanIneligibleFutureproofTypes.has(l.futureproofType):(l==null?void 0:l.type)===o("WAWebMsgType").MSG_TYPE.CIPHERTEXT&&(s=!0),s)n.push(i);else if(l!=null){var u,c=l.broadcastId!=null&&r("WAWebWid").isWid(l.broadcastId)&&!!((u=l.broadcastId)!=null&&u.isBroadcastList());c?a.push(babelHelpers.extends({},i,{author:void 0})):a.push(i)}}return{orphans:n,nonOrphans:a}}function u(e){var t=new Map;for(var n of e){var r,a=o("WAWebAddonSelectUtils").getAddonTableMode(n);t.has(a)||t.set(a,[]),(r=t.get(a))==null||r.push(n)}return t}function c(e,t,n){var r=new Map;for(var a of n){var i,l=o("WAWebAddonCrossWindowUtils").getAddonProcessorType(a);if(!r.has(l)){var s=o("WAWebAddonPluginProcessor").getAddonProcessor(l);r.set(l,{processor:s,processMode:e,tableMode:t,addons:[]})}(i=r.get(l))==null||i.addons.push(a)}return Array.from(r.values())}l.collectValidAndOrphanAddons=e,l.collectValidAndOrphans=s,l.groupAddonsByTableMode=u,l.groupAddonsByProcessor=c}),98);
__d("WAWebAddonUpdateDataUtils",["Promise","WANullthrows","WAWebAddonConstants","WAWebAddonDBTable","WAWebAddonHydrationUtils","WAWebAddonInfraError","WAWebAddonPerfUtils","WAWebAddonProcessMsgsUtils","WAWebAddonSelectUtils","WAWebAddonSortUtils","WAWebCommentUtils","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u=new Set([(s=o("WAWebAddonConstants")).AddonProcessMode.OnlineReceive,s.AddonProcessMode.Revoke,s.AddonProcessMode.DeleteForMe,s.AddonProcessMode.DeleteWithParent]);function c(e,t,n,r){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l){var s,u,c=[],d=(s=i.removeByMsgKey)!=null?s:[],m=(u=i.removeByMsgKey)!=null?u:[];if(i.remove!=null&&i.remove.length>0&&(d=d.concat(i.remove.map(function(e){return e.id})),m=m.concat(o("WAWebAddonHydrationUtils").filterAddonsByHydratedStatus(i.remove).map(function(e){return e.id}))),a!==o("WAWebAddonConstants").AddonTableMode.None){if(i.add!=null&&i.add.length>0){var p=(function(){var s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var s,u;l==null||(s=l.sendPerfReporter)==null||s.startSavedStage();var c=yield o("WAWebAddonPerfUtils").createAddonQplMarker(t===o("WAWebAddonConstants").AddonProcessMode.Send?o("WAWebAddonPerfUtils").AddonQplMarkerType.Outgoing:o("WAWebAddonPerfUtils").AddonQplMarkerType.Incoming,{mode:a,type:o("WAWebAddonPerfUtils").AnnotationRequestType.BulkUpsert,size:i.add.length});try{t===o("WAWebAddonConstants").AddonProcessMode.SetAck?yield(e||(e=n("Promise"))).all(i.add.map(function(e){return o("WAWebAddonDBTable").addonInternalDBTable.updateAck(a,e,r("WANullthrows")(e.ack,"ack is not defined"))})):yield o("WAWebAddonDBTable").addonInternalDBTable.bulkUpsert(a,i.add),c==null||c.success()}catch(e){throw c==null||c.fail(),e}l==null||(u=l.sendPerfReporter)==null||u.postSavedStage()});return function(){return s.apply(this,arguments)}})();c.push(p())}d.length>0&&c.push(o("WAWebAddonDBTable").addonInternalDBTable.bulkRemoveByMsgKey(a,d))}return c.length>0&&(yield(e||(e=n("Promise"))).all(c)),{removeFromUICollection:m}}),d.apply(this,arguments)}function m(e,t,n){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){var i=t.processMode,l=t.tableMode,s=a==null?void 0:a.metricReporter;if(i===o("WAWebAddonConstants").AddonProcessMode.Hydration)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError);var d=yield c(i,l,r,s),m=d.removeFromUICollection;if(i!==o("WAWebAddonConstants").AddonProcessMode.HistorySync)if(r.add!=null){var p,_;s==null||(p=s.sendPerfReporter)==null||p.startRenderedStage(),yield(e||(e=n("Promise"))).all(o("WAWebAddonSortUtils").groupAddonsByProcessor(i,l,r.add).map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebAddonHydrationUtils").filterAddonsByHydratedStatus(e.addons),n=t.length!==0||m.length!==0||i===o("WAWebAddonConstants").AddonProcessMode.OnlineReceive;n&&(yield e.processor.updateCollection({add:t,remove:m},i),u.has(i)&&(yield e.processor.manageNotifications({add:i===o("WAWebAddonConstants").AddonProcessMode.Revoke?[]:e.addons,remove:m},{processMode:i})))});return function(t){return e.apply(this,arguments)}})())),s==null||(_=s.sendPerfReporter)==null||_.postRenderedStage()}else if(r.remove!=null){if(yield(e||(e=n("Promise"))).all(o("WAWebAddonSortUtils").groupAddonsByProcessor(i,l,r.remove).map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield e.processor.updateCollection({add:[],remove:m},i),u.has(i)&&(yield e.processor.manageNotifications({add:[],remove:m},{processMode:i}))});return function(t){return e.apply(this,arguments)}})())),i===o("WAWebAddonConstants").AddonProcessMode.DeleteForMe&&l===o("WAWebAddonConstants").AddonTableMode.Comment){var f=yield o("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs(r.remove,o("WAWebAddonConstants").AddonProcessMode.DeleteForMe),g=f[0],h=[];for(var y of r.remove)y.kind===o("WAWebMsgType").MsgKind.CommentDecrypted&&h.push(y);yield o("WAWebCommentUtils").updateReplyCount([],o("WAWebAddonSelectUtils").createAddonParentSelector(g),h)}}else throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)}),p.apply(this,arguments)}l.updateAddonsInTableMode=m}),98);
__d("WAWeb-curve25519-donna",[],(function $module_WAWeb_curve25519_donna(global,require,requireDynamic,requireLazy,module,exports){var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);e.read=function(t){var r=new XMLHttpRequest;return r.open("GET",t,!1),r.send(null),r.responseText},typeof arguments!="undefined"&&(e.arguments=arguments),typeof console!="undefined"?(e.print||(e.print=function(t){}),e.printErr||(e.printErr=function(t){})):e.print||(e.print=function(){}),typeof e.setWindowTitle=="undefined"&&(e.setWindowTitle=function(t){document.title=t});function ba(t){eval.call(null,t)}!e.load&&e.read&&(e.load=function(t){ba(e.read(t))}),e.print||(e.print=function(){}),e.printErr||(e.printErr=e.print),e.arguments||(e.arguments=[]),e.thisProgram||(e.thisProgram="./this.program"),e.print=e.print,e.S=e.printErr,e.preRun=[],e.postRun=[];for(l in aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(t){ca=t},Ua:function(){return ca},na:function(){return m},X:function(t){m=t},Aa:function(t){switch(t){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return t[t.length-1]==="*"?n.H:t[0]==="i"?(t=parseInt(t.substr(1)),assert(t%8===0),t/8):0}},Ta:function(t){return Math.max(n.Aa(t),n.H)},dd:16,Bd:function(t,r){return r==="double"||r==="i64"?t&7&&(assert((t&7)===4),t+=4):assert((t&3)===0),t},od:function(t,r,o){return o||t!="i64"&&t!="double"?t?Math.min(r||(t?n.Ta(t):0),n.H):Math.min(r,8):8},J:function(t,r,o){return o&&o.length?(o.splice||(o=Array.prototype.slice.call(o)),o.splice(0,0,r),e["dynCall_"+t].apply(null,o)):e["dynCall_"+t].call(null,r)},U:[],Ma:function(t){for(var r=0;r<n.U.length;r++)if(!n.U[r])return n.U[r]=t,2*(1+r);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(t){n.U[(t-2)/2]=null},M:function(t){n.M.ma||(n.M.ma={}),n.M.ma[t]||(n.M.ma[t]=1,e.S(t))},ha:{},rd:function(t,r){assert(r),n.ha[r]||(n.ha[r]={});var o=n.ha[r];return o[t]||(o[t]=function(){return n.J(r,t,arguments)}),o[t]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(t){var r=m;return m=m+t|0,m=m+15&-16,r},Ia:function(t){var r=p;return p=p+t|0,p=p+15&-16,r},P:function(t){var r=v;return v=v+t|0,v=v+15&-16,(t=v>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),t=!0),t?(v=r,0):r},ea:function(t,r){return Math.ceil(t/(r||16))*(r||16)},xd:function(t,r,o){return o?+(t>>>0)+4294967296*+(r>>>0):+(t>>>0)+4294967296*+(r|0)},La:8,H:4,ed:0};e.Runtime=n,n.addFunction=n.Ma,n.removeFunction=n.$a;var A=!1,da,fa,ca;function assert(t,r){t||z("Assertion failed: "+r)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(t){}return assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)"),b}var ha,ia;(function(){function a(t){return t=t.toString().match(d).slice(1),{arguments:t[0],body:t[1],returnValue:t[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(t){var r=n.W(t.length);return ja(t,r),r},stringToC:function(t){var r=0;return t!=null&&t!==0&&(r=n.W((t.length<<2)+1),ka(t,r)),r}},c={string:b.stringToC,array:b.arrayToC};ia=function(t,r,o,i,s){t=ga(t);var _=[],g=0;if(i)for(var C=0;C<i.length;C++){var k=c[o[C]];k?(g===0&&(g=n.na()),_[C]=k(i[C])):_[C]=i[C]}if(o=t.apply(null,_),r==="string"&&(o=la(o)),g!==0){if(s&&s.async){EmterpreterAsync.hd.push(function(){n.X(g)});return}n.X(g)}return o};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every(function(t){return t==="number"});var u=c!=="string";if(u&&b)return h;var q=d.map(function(t,r){return"$"+r});c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];ea!=="number"&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}return d=a(function(){return h}).returnValue,c+="var ret = "+d+"("+q.join(",")+");",u||(d=a(function(){return la}).returnValue,c+="ret = "+d+"(ret);"),b||(c+=f.stackRestore.body.replace("()","(stack)")+";"),eval(c+"return ret})")}})(),e.ccall=ia,e.cwrap=ha;function ma(t,r,o){switch(o=o||"i8",o.charAt(o.length-1)==="*"&&(o="i32"),o){case"i1":D[t>>0]=r;break;case"i8":D[t>>0]=r;break;case"i16":E[t>>1]=r;break;case"i32":F[t>>2]=r;break;case"i64":fa=[r>>>0,(da=r,1<=+na(da)?0<da?(oa(+pa(da/4294967296),4294967295)|0)>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)],F[t>>2]=fa[0],F[t+4>>2]=fa[1];break;case"float":ra[t>>2]=r;break;case"double":sa[t>>3]=r;break;default:z("invalid type for setValue: "+o)}}e.setValue=ma;function ta(t,r){switch(r=r||"i8",r.charAt(r.length-1)==="*"&&(r="i32"),r){case"i1":return D[t>>0];case"i8":return D[t>>0];case"i16":return E[t>>1];case"i32":return F[t>>2];case"i64":return F[t>>2];case"float":return ra[t>>2];case"double":return sa[t>>3];default:z("invalid type for setValue: "+r)}return null}e.getValue=ta,e.ALLOC_NORMAL=0,e.ALLOC_STACK=1,e.ALLOC_STATIC=2,e.ALLOC_DYNAMIC=3,e.ALLOC_NONE=4;function G(t,r,o,i){var s,_;typeof t=="number"?(s=!0,_=t):(s=!1,_=t.length);var g=typeof r=="string"?r:null;if(o=o==4?i:[ua,n.W,n.Ia,n.P][o===void 0?2:o](Math.max(_,g?1:r.length)),s){for(i=o,assert((o&3)==0),t=o+(_&-4);i<t;i+=4)F[i>>2]=0;for(t=o+_;i<t;)D[i++>>0]=0;return o}if(g==="i8")return t.subarray||t.slice?H.set(t,o):H.set(new Uint8Array(t),o),o;i=0;for(var C,k;i<_;){var x=t[i];typeof x=="function"&&(x=n.sd(x)),s=g||r[i],s===0?i++:(s=="i64"&&(s="i32"),ma(o+i,x,s),k!==s&&(C=n.Aa(s),k=s),i+=C)}return o}e.allocate=G,e.getMemory=function(t){return va?typeof wa!="undefined"&&!wa.C||!xa?n.P(t):ua(t):n.Ia(t)};function la(t,r){if(r===0||!t)return"";for(var o=0,i,s=0;i=H[t+s>>0],o|=i,!(i==0&&!r||(s++,r&&s==r)););if(r||(r=s),i="",128>o){for(;0<r;)o=String.fromCharCode.apply(String,H.subarray(t,t+Math.min(r,1024))),i=i?i+o:o,t+=1024,r-=1024;return i}return e.UTF8ToString(t)}e.Pointer_stringify=la,e.AsciiToString=function(t){for(var r="";;){var o=D[t++>>0];if(!o)return r;r+=String.fromCharCode(o)}},e.stringToAscii=function(t,r){return ya(t,r,!1)};function za(t,r){for(var o,i,s,_,g,C,k="";;){if(o=t[r++],!o)return k;o&128?(i=t[r++]&63,(o&224)==192?k+=String.fromCharCode((o&31)<<6|i):(s=t[r++]&63,(o&240)==224?o=(o&15)<<12|i<<6|s:(_=t[r++]&63,(o&248)==240?o=(o&7)<<18|i<<12|s<<6|_:(g=t[r++]&63,(o&252)==248?o=(o&3)<<24|i<<18|s<<12|_<<6|g:(C=t[r++]&63,o=(o&1)<<30|i<<24|s<<18|_<<12|g<<6|C))),65536>o?k+=String.fromCharCode(o):(o-=65536,k+=String.fromCharCode(55296|o>>10,56320|o&1023)))):k+=String.fromCharCode(o)}}e.UTF8ArrayToString=za,e.UTF8ToString=function(t){return za(H,t)};function Aa(t,r,o,i){if(!(0<i))return 0;var s=o;i=o+i-1;for(var _=0;_<t.length;++_){var g=t.charCodeAt(_);if(55296<=g&&57343>=g&&(g=65536+((g&1023)<<10)|t.charCodeAt(++_)&1023),127>=g){if(o>=i)break;r[o++]=g}else{if(2047>=g){if(o+1>=i)break;r[o++]=192|g>>6}else{if(65535>=g){if(o+2>=i)break;r[o++]=224|g>>12}else{if(2097151>=g){if(o+3>=i)break;r[o++]=240|g>>18}else{if(67108863>=g){if(o+4>=i)break;r[o++]=248|g>>24}else{if(o+5>=i)break;r[o++]=252|g>>30,r[o++]=128|g>>24&63}r[o++]=128|g>>18&63}r[o++]=128|g>>12&63}r[o++]=128|g>>6&63}r[o++]=128|g&63}}return r[o]=0,o-s}e.stringToUTF8Array=Aa,e.stringToUTF8=function(t,r,o){return Aa(t,H,r,o)};function Ba(t){for(var r=0,o=0;o<t.length;++o){var i=t.charCodeAt(o);55296<=i&&57343>=i&&(i=65536+((i&1023)<<10)|t.charCodeAt(++o)&1023),127>=i?++r:r=2047>=i?r+2:65535>=i?r+3:2097151>=i?r+4:67108863>=i?r+5:r+6}return r}e.lengthBytesUTF8=Ba,e.UTF16ToString=function(t){for(var r=0,o="";;){var i=E[t+2*r>>1];if(i==0)return o;++r,o+=String.fromCharCode(i)}},e.stringToUTF16=function(t,r,o){if(o===void 0&&(o=2147483647),2>o)return 0;o-=2;var i=r;o=o<2*t.length?o/2:t.length;for(var s=0;s<o;++s)E[r>>1]=t.charCodeAt(s),r+=2;return E[r>>1]=0,r-i},e.lengthBytesUTF16=function(t){return 2*t.length},e.UTF32ToString=function(t){for(var r=0,o="";;){var i=F[t+4*r>>2];if(i==0)return o;++r,65536<=i?(i=i-65536,o+=String.fromCharCode(55296|i>>10,56320|i&1023)):o+=String.fromCharCode(i)}},e.stringToUTF32=function(t,r,o){if(o===void 0&&(o=2147483647),4>o)return 0;var i=r;o=i+o-4;for(var s=0;s<t.length;++s){var g=t.charCodeAt(s);if(55296<=g&&57343>=g)var _=t.charCodeAt(++s),g=65536+((g&1023)<<10)|_&1023;if(F[r>>2]=g,r+=4,r+4>o)break}return F[r>>2]=0,r-i},e.lengthBytesUTF32=function(t){for(var r=0,o=0;o<t.length;++o){var i=t.charCodeAt(o);55296<=i&&57343>=i&&++o,r+=4}return r};function Ca(t){function r(o,i,s){i=i||1/0;var x="",$=[],j;if(t[_]==="N"){for(_++,t[_]==="K"&&_++,j=[];t[_]!=="E";)if(t[_]==="S"){_++;var Q=t.indexOf("_",_);j.push(C[t.substring(_,Q)||0]||"?"),_=Q+1}else if(t[_]==="C")j.push(j[j.length-1]),_+=2;else{var Q=parseInt(t.substr(_)),ee=Q.toString().length;if(!Q||!ee){_--;break}var te=t.substr(_+ee,Q);j.push(te),C.push(te),_+=ee+Q}if(_++,j=j.join("::"),i--,i===0)return o?[j]:j}else(t[_]==="K"||k&&t[_]==="L")&&_++,(Q=parseInt(t.substr(_)))&&(ee=Q.toString().length,j=t.substr(_+ee,Q),_+=ee+Q);k=!1,t[_]==="I"?(_++,Q=r(!0),ee=r(!0,1,!0),x+=ee[0]+" "+j+"<"+Q.join(", ")+">"):x=j;e:for(;_<t.length&&0<i--;)if(j=t[_++],j in g)$.push(g[j]);else switch(j){case"P":$.push(r(!0,1,!0)[0]+"*");break;case"R":$.push(r(!0,1,!0)[0]+"&");break;case"L":_++,Q=t.indexOf("E",_)-_,$.push(t.substr(_,Q)),_+=Q+2;break;case"A":if(Q=parseInt(t.substr(_)),_+=Q.toString().length,t[_]!=="_")throw"?";_++,$.push(r(!0,1,!0)[0]+" ["+Q+"]");break;case"E":break e;default:x+="?"+j;break e}return s||$.length!==1||$[0]!=="void"||($=[]),o?(x&&$.push(x+"?"),$):x+("("+$.join(", ")+")")}var o=!!e.___cxa_demangle;if(o)try{var x=ua(t.length);ka(t.substr(1),x);var i=ua(4),s=e.___cxa_demangle(x,0,0,i);if(ta(i,"i32")===0&&s)return la(s)}catch(t){}finally{x&&Da(x),i&&Da(i),s&&Da(s)}var _=3,g={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},C=[],k=!0,x=t;try{if(t=="Object._main"||t=="_main")return"main()";if(typeof t=="number"&&(t=la(t)),t[0]!=="_"||t[1]!=="_"||t[2]!=="Z")return t;switch(t[3]){case"n":return"operator new()";case"d":return"operator delete()"}x=r()}catch(t){x+="?"}return 0<=x.indexOf("?")&&!o&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),x}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,function(t){var r=Ca(t);return t===r?t:t+" ["+r+"]"})}function Fa(){var t=Error();if(!t.stack){try{throw Error(0)}catch(r){t=r}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}e.stackTrace=function(){return Ea()};function Ga(){var t=v;return 0<t%4096&&(t+=4096-t%4096),t}for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||524288,w=e.TOTAL_MEMORY||1048576,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;I!==w&&(w=I),assert(typeof Int32Array!="undefined"&&typeof Float64Array!="undefined"&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support");var buffer;buffer=new ArrayBuffer(w),D=new Int8Array(buffer),E=new Int16Array(buffer),F=new Int32Array(buffer),H=new Uint8Array(buffer),Ha=new Uint16Array(buffer),Ia=new Uint32Array(buffer),ra=new Float32Array(buffer),sa=new Float64Array(buffer),F[0]=255,assert(H[0]===255&&H[3]===0,"Typed arrays 2 must be run on a little-endian system"),e.HEAP=void 0,e.buffer=buffer,e.HEAP8=D,e.HEAP16=E,e.HEAP32=F,e.HEAPU8=H,e.HEAPU16=Ha,e.HEAPU32=Ia,e.HEAPF32=ra,e.HEAPF64=sa;function Oa(t){for(;0<t.length;){var r=t.shift();if(typeof r=="function")r();else{var o=r.Qa;typeof o=="number"?r.T===void 0?n.J("v",o):n.J("vi",o,[r.T]):o(r.T===void 0?null:r.T)}}}var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(t){Pa.unshift(t)}e.addOnPreRun=Ta,e.addOnInit=function(t){Qa.unshift(t)},e.addOnPreMain=function(t){Ra.unshift(t)},e.addOnExit=function(t){K.unshift(t)};function Ua(t){Sa.unshift(t)}e.addOnPostRun=Ua;function Va(t,r,o){return o=Array(0<o?o:Ba(t)+1),t=Aa(t,o,0,o.length),r&&(o.length=t),o}e.intArrayFromString=Va,e.intArrayToString=function(t){for(var r=[],o=0;o<t.length;o++){var i=t[o];255<i&&(i&=255),r.push(String.fromCharCode(i))}return r.join("")};function ka(t,r,o){for(t=Va(t,o),o=0;o<t.length;)D[r+o>>0]=t[o],o+=1}e.writeStringToMemory=ka;function ja(t,r){for(var o=0;o<t.length;o++)D[r++>>0]=t[o]}e.writeArrayToMemory=ja;function ya(t,r,o){for(var i=0;i<t.length;++i)D[r++>>0]=t.charCodeAt(i);o||(D[r>>0]=0)}e.writeAsciiToMemory=ya,Math.imul&&Math.imul(4294967295,5)===-5||(Math.imul=function(t,r){var o=t&65535,i=r&65535;return o*i+((t>>>16)*i+o*(r>>>16)<<16)|0}),Math.td=Math.imul,Math.clz32||(Math.clz32=function(t){t=t>>>0;for(var r=0;32>r;r++)if(t&1<<31-r)return r;return 32}),Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}e.addRunDependency=Ya;function Za(){if(L--,e.monitorRunDependencies&&e.monitorRunDependencies(L),L==0&&(Wa!==null&&(clearInterval(Wa),Wa=null),Xa)){var t=Xa;Xa=null,t()}}e.removeRunDependency=Za,e.preloadedImages={},e.preloadedAudios={},Ja=8,p=Ja+1696,Qa.push(),G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);assert($a%8==0),e._bitshift64Ashr=ab,e._i64Subtract=bb,e._i64Add=cb,e._memset=db;function eb(t,r){K.push(function(){n.J("vi",t,[r])}),eb.level=K.length}e._bitshift64Lshr=fb,e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(t){return e.___errno_location&&(F[e.___errno_location()>>2]=t),t}function jb(t,r){for(var o=0,i=t.length-1;0<=i;i--){var s=t[i];s==="."?t.splice(i,1):s===".."?(t.splice(i,1),o++):o&&(t.splice(i,1),o--)}if(r)for(;o--;o)t.unshift("..");return t}function N(t){var r=t.charAt(0)==="/",o=t.substr(-1)==="/";return(t=jb(t.split("/").filter(function(t){return!!t}),!r).join("/"))||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t}function kb(t){var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=r[0],r=r[1],!t&&!r?".":(r&&(r=r.substr(0,r.length-1)),t+r)}function lb(t){if(t==="/")return"/";var r=t.lastIndexOf("/");return r===-1?t:t.substr(r+1)}function mb(){for(var t="",r=!1,o=arguments.length-1;-1<=o&&!r;o--){if(r=0<=o?arguments[o]:"/",typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";t=r+"/"+t,r=r.charAt(0)==="/"}return t=jb(t.split("/").filter(function(t){return!!t}),!r).join("/"),(r?"/":"")+t||"."}var nb=[];function ob(t,r){nb[t]={input:[],output:[],L:r},pb(t,qb)}var qb={open:function(t){var r=nb[t.g.rdev];if(!r)throw new O(M.ba);t.tty=r,t.seekable=!1},close:function(t){t.tty.L.flush(t.tty)},flush:function(t){t.tty.L.flush(t.tty)},read:function(t,r,o,i){if(!t.tty||!t.tty.L.Ba)throw new O(M.sa);for(var s=0,_=0;_<i;_++){var g;try{g=t.tty.L.Ba(t.tty)}catch(t){throw new O(M.F)}if(g===void 0&&s===0)throw new O(M.oa);if(g==null)break;s++,r[o+_]=g}return s&&(t.g.timestamp=Date.now()),s},write:function(t,r,o,i){if(!t.tty||!t.tty.L.ja)throw new O(M.sa);for(var s=0;s<i;s++)try{t.tty.L.ja(t.tty,r[o+s])}catch(t){throw new O(M.F)}return i&&(t.g.timestamp=Date.now()),s}},rb={Ba:function(t){if(!t.input.length){var r=null;if(typeof window!="undefined"&&typeof window.prompt=="function"?(r=window.prompt("Input: "),r!==null&&(r+="\n")):typeof readline=="function"&&(r=readline(),r!==null&&(r+="\n")),!r)return null;t.input=Va(r,!0)}return t.input.shift()},ja:function(t,r){r===null||r===10?(e.print(za(t.output,0)),t.output=[]):r!=0&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.print(za(t.output,0)),t.output=[])}},sb={ja:function(t,r){r===null||r===10?(e.printErr(za(t.output,0)),t.output=[]):r!=0&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.printErr(za(t.output,0)),t.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(t,r,o,i){if((o&61440)===24576||(o&61440)===4096)throw new O(M.G);return P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}}),o=ub(t,r,o,i),(o.mode&61440)===16384?(o.k=P.q.dir.g,o.n=P.q.dir.stream,o.e={}):(o.mode&61440)===32768?(o.k=P.q.file.g,o.n=P.q.file.stream,o.o=0,o.e=null):(o.mode&61440)===40960?(o.k=P.q.link.g,o.n=P.q.link.stream):(o.mode&61440)===8192&&(o.k=P.q.va.g,o.n=P.q.va.stream),o.timestamp=Date.now(),t&&(t.e[r]=o),o},Sa:function(t){if(t.e&&t.e.subarray){for(var r=[],o=0;o<t.o;++o)r.push(t.e[o]);return r}return t.e},qd:function(t){return t.e?t.e.subarray?t.e.subarray(0,t.o):new Uint8Array(t.e):new Uint8Array},ya:function(t,r){if(t.e&&t.e.subarray&&r>t.e.length&&(t.e=P.Sa(t),t.o=t.e.length),!t.e||t.e.subarray){var o=t.e?t.e.buffer.byteLength:0;o>=r||(r=Math.max(r,o*(1048576>o?2:1.125)|0),o!=0&&(r=Math.max(r,256)),o=t.e,t.e=new Uint8Array(r),0<t.o&&t.e.set(o.subarray(0,t.o),0))}else for(!t.e&&0<r&&(t.e=[]);t.e.length<r;)t.e.push(0)},ab:function(t,r){if(t.o!=r)if(r==0)t.e=null,t.o=0;else{if(!t.e||t.e.subarray){var o=t.e;t.e=new Uint8Array(new ArrayBuffer(r)),o&&t.e.set(o.subarray(0,Math.min(r,t.o)))}else if(t.e||(t.e=[]),t.e.length>r)t.e.length=r;else for(;t.e.length<r;)t.e.push(0);t.o=r}},k:{D:function(t){var r={};return r.dev=(t.mode&61440)===8192?t.id:1,r.ino=t.id,r.mode=t.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=t.rdev,(t.mode&61440)===16384?r.size=4096:(t.mode&61440)===32768?r.size=t.o:(t.mode&61440)===40960?r.size=t.link.length:r.size=0,r.atime=new Date(t.timestamp),r.mtime=new Date(t.timestamp),r.ctime=new Date(t.timestamp),r.Pa=4096,r.blocks=Math.ceil(r.size/r.Pa),r},p:function(t,r){r.mode!==void 0&&(t.mode=r.mode),r.timestamp!==void 0&&(t.timestamp=r.timestamp),r.size!==void 0&&P.ab(t,r.size)},lookup:function(){throw vb[M.B]},V:function(t,r,o,i){return P.createNode(t,r,o,i)},rename:function(t,r,o){if((t.mode&61440)===16384){var i;try{i=wb(r,o)}catch(t){}if(i)for(var s in i.e)throw new O(M.ra)}delete t.parent.e[t.name],t.name=o,r.e[o]=t,t.parent=r},unlink:function(t,r){delete t.e[r]},rmdir:function(t,r){var o=wb(t,r),i;for(i in o.e)throw new O(M.ra);delete t.e[r]},readdir:function(t){var r=[".",".."],o;for(o in t.e)t.e.hasOwnProperty(o)&&r.push(o);return r},symlink:function(t,r,o){return t=P.createNode(t,r,41471,0),t.link=o,t},readlink:function(t){if((t.mode&61440)!==40960)throw new O(M.u);return t.link}},n:{read:function(t,r,o,i,s){var _=t.g.e;if(s>=t.g.o)return 0;if(t=Math.min(t.g.o-s,i),assert(0<=t),8<t&&_.subarray)r.set(_.subarray(s,s+t),o);else for(i=0;i<t;i++)r[o+i]=_[s+i];return t},write:function(t,r,o,i,s,_){if(!i)return 0;if(t=t.g,t.timestamp=Date.now(),r.subarray&&(!t.e||t.e.subarray)){if(_)return t.e=r.subarray(o,o+i),t.o=i;if(t.o===0&&s===0)return t.e=new Uint8Array(r.subarray(o,o+i)),t.o=i;if(s+i<=t.o)return t.e.set(r.subarray(o,o+i),s),i}if(P.ya(t,s+i),t.e.subarray&&r.subarray)t.e.set(r.subarray(o,o+i),s);else for(_=0;_<i;_++)t.e[s+_]=r[o+_];return t.o=Math.max(t.o,s+i),i},I:function(t,r,o){if(o===1?r+=t.position:o===2&&(t.g.mode&61440)===32768&&(r+=t.g.o),0>r)throw new O(M.u);return r},ta:function(t,r,o){P.ya(t.g,r+o),t.g.o=Math.max(t.g.o,r+o)},Ea:function(t,r,o,i,s,_,g){if((t.g.mode&61440)!==32768)throw new O(M.ba);if(o=t.g.e,g&2||o.buffer!==r&&o.buffer!==r.buffer){if((0<s||s+i<t.g.o)&&(o.subarray?o=o.subarray(s,s+i):o=Array.prototype.slice.call(o,s,s+i)),t=!0,i=ua(i),!i)throw new O(M.Ka);r.set(o,i)}else t=!1,i=o.byteOffset;return{Cd:i,gd:t}},Ga:function(t,r,o,i,s){if((t.g.mode&61440)!==32768)throw new O(M.ba);return s&2||P.n.write(t,r,0,i,o,!1),0}}};G(1,"i32*",2),G(1,"i32*",2),G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(t,r){if(t=mb("/",t),r=r||{},!t)return{path:"",g:null};var i={za:!0,ka:0},o;for(o in i)r[o]===void 0&&(r[o]=i[o]);if(8<r.ka)throw new O(M.aa);var i=jb(t.split("/").filter(function(t){return!!t}),!1),s=xb;o="/";for(var _=0;_<i.length;_++){var g=_===i.length-1;if(g&&r.parent)break;if(s=wb(s,i[_]),o=N(o+"/"+i[_]),s.R&&(!g||g&&r.za)&&(s=s.R.root),!g||r.ga){for(g=0;(s.mode&61440)===40960;)if(s=Db(o),o=mb(kb(o),s),s=T(o,{ka:r.ka}).g,40<g++)throw new O(M.aa)}}return{path:o,g:s}}function U(t){for(var r;;){if(t===t.parent)return t=t.A.Fa,r?t[t.length-1]!=="/"?t+"/"+r:t+r:t;r=r?t.name+"/"+r:t.name,t=t.parent}}function Eb(t,r){for(var o=0,i=0;i<r.length;i++)o=(o<<5)-o+r.charCodeAt(i)|0;return(t+o>>>0)%R.length}function Fb(t){var r=Eb(t.parent.id,t.name);t.K=R[r],R[r]=t}function wb(t,r){var o;if(o=(o=Gb(t,"x"))?o:t.k.lookup?0:M.Y)throw new O(o,t);for(o=R[Eb(t.id,r)];o;o=o.K){var i=o.name;if(o.parent.id===t.id&&i===r)return o}return t.k.lookup(t,r)}function ub(t,r,o,i){return Hb||(Hb=function(t,r,o,i){t||(t=this),this.parent=t,this.A=t.A,this.R=null,this.id=Ab++,this.name=r,this.mode=o,this.k={},this.n={},this.rdev=i},Hb.prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(t){t?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(t){t?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return(this.mode&61440)===16384}},Ca:{get:function(){return(this.mode&61440)===8192}}})),t=new Hb(t,r,o,i),Fb(t),t}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(t,r){if(Cb)return 0;if(r.indexOf("r")===-1||t.mode&292){if(r.indexOf("w")!==-1&&!(t.mode&146)||r.indexOf("x")!==-1&&!(t.mode&73))return M.Y}else return M.Y;return 0}function Jb(t,r){try{return wb(t,r),M.pa}catch(t){}return Gb(t,"wx")}function Kb(){var t;t=4096;for(var r=0;r<=t;r++)if(!zb[r])return r;throw new O(M.Ja)}function Lb(t){Mb||(Mb=function(){},Mb.prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(t){this.g=t}},vd:{get:function(){return(this.flags&2097155)!==1}},wd:{get:function(){return(this.flags&2097155)!==0}},ud:{get:function(){return this.flags&1024}}}));var r=new Mb,o;for(o in t)r[o]=t[o];return t=r,r=Kb(),t.fd=r,zb[r]=t}var tb={open:function(t){t.n=yb[t.g.rdev].n,t.n.open&&t.n.open(t)},I:function(){throw new O(M.da)}};function pb(t,r){yb[t]={n:r}}function Nb(t,r){var o=r==="/",s=!r,i;if(o&&xb)throw new O(M.$);if(!o&&!s){if(i=T(r,{za:!1}),r=i.path,i=i.g,i.R)throw new O(M.$);if((i.mode&61440)!==16384)throw new O(M.qa)}var s={type:t,Ad:{},Fa:r,Ya:[]},_=t.A(s);_.A=s,s.root=_,o?xb=_:i&&(i.R=s,i.A&&i.A.Ya.push(s))}function Ob(t,r,o){var i=T(t,{parent:!0}).g;if(t=lb(t),!t||t==="."||t==="..")throw new O(M.u);var s=Jb(i,t);if(s)throw new O(s);if(!i.k.V)throw new O(M.G);return i.k.V(i,t,r,o)}function Pb(t,r){return r=(r!==void 0?r:438)&4095,r|=32768,Ob(t,r,0)}function V(t,r){return r=(r!==void 0?r:511)&1023,r|=16384,Ob(t,r,0)}function Qb(t,r,o){return typeof o=="undefined"&&(o=r,r=438),Ob(t,r|8192,o)}function Rb(t,r){if(!mb(t))throw new O(M.B);var o=T(r,{parent:!0}).g;if(!o)throw new O(M.B);var i=lb(r),s=Jb(o,i);if(s)throw new O(s);if(!o.k.symlink)throw new O(M.G);return o.k.symlink(o,i,t)}function Db(t){if(t=T(t).g,!t)throw new O(M.B);if(!t.k.readlink)throw new O(M.u);return mb(U(t.parent),t.k.readlink(t))}function Sb(t,r){var o;if(typeof t=="string"?o=T(t,{ga:!0}).g:o=t,!o.k.p)throw new O(M.G);o.k.p(o,{mode:r&4095|o.mode&-4096,timestamp:Date.now()})}function Tb(t,r){var o;if(t==="")throw new O(M.B);var i;if(typeof r=="string"){if(i=Ib[r],typeof i=="undefined")throw Error("Unknown file open mode: "+r)}else i=r;r=i,o=r&64?(typeof o=="undefined"?438:o)&4095|32768:0;var s;if(typeof t=="object")s=t;else{t=N(t);try{s=T(t,{ga:!(r&131072)}).g}catch(t){}}if(i=!1,r&64)if(s){if(r&128)throw new O(M.pa)}else s=Ob(t,o,0),i=!0;if(!s)throw new O(M.B);if((s.mode&61440)===8192&&(r&=-513),r&65536&&(s.mode&61440)!==16384)throw new O(M.qa);if(!i&&(s?(s.mode&61440)===40960?o=M.aa:(s.mode&61440)===16384&&((r&2097155)!==0||r&512)?o=M.N:(o=["r","w","rw"][r&3],r&512&&(o+="w"),o=Gb(s,o)):o=M.B,o))throw new O(o);if(r&512){o=s;var _;if(typeof o=="string"?_=T(o,{ga:!0}).g:_=o,!_.k.p)throw new O(M.G);if((_.mode&61440)===16384)throw new O(M.N);if((_.mode&61440)!==32768)throw new O(M.u);if(o=Gb(_,"w"))throw new O(o);_.k.p(_,{size:0,timestamp:Date.now()})}r&=-641,s=Lb({g:s,path:U(s),flags:r,seekable:!0,position:0,n:s.n,eb:[],error:!1}),s.n.open&&s.n.open(s),!e.logReadFiles||r&1||(Ub||(Ub={}),t in Ub||(Ub[t]=1,e.printErr("read file: "+t)));try{S.onOpenFile&&(_=0,(r&2097155)!==1&&(_|=1),(r&2097155)!==0&&(_|=2),S.onOpenFile(t,_))}catch(r){""+t+r.message}return s}function Vb(t){t.ia&&(t.ia=null);try{t.n.close&&t.n.close(t)}catch(t){throw t}finally{zb[t.fd]=null}}function Wb(t,r,o){if(!t.seekable||!t.n.I)throw new O(M.da);t.position=t.n.I(t,r,o),t.eb=[]}function Xb(t,r,o,i,s,_){if(0>i||0>s)throw new O(M.u);if((t.flags&2097155)===0)throw new O(M.Z);if((t.g.mode&61440)===16384)throw new O(M.N);if(!t.n.write)throw new O(M.u);t.flags&1024&&Wb(t,0,2);var g=!0;if(typeof s=="undefined")s=t.position,g=!1;else if(!t.seekable)throw new O(M.da);r=t.n.write(t,r,o,i,s,_),g||(t.position+=r);try{t.path&&S.onWriteToFile&&S.onWriteToFile(t.path)}catch(t){""+path+t.message}return r}function Yb(){O||(O=function(t,r){this.g=r,this.bb=function(t){this.Q=t;for(var r in M)if(M[r]===t){this.code=r;break}},this.bb(t),this.message=hb[t]},O.prototype=Error(),O.prototype.constructor=O,[M.B].forEach(function(t){vb[t]=new O(t),vb[t].stack="<generic error, no stack>"}))}var Zb;function $b(t,r){var o=0;return t&&(o|=365),r&&(o|=146),o}function ac(t,r,o,i){return t=N((typeof t=="string"?t:U(t))+"/"+r),Pb(t,$b(o,i))}function bc(t,r,o,i,s,_){if(t=r?N((typeof t=="string"?t:U(t))+"/"+r):t,i=$b(i,s),s=Pb(t,i),o){if(typeof o=="string"){t=Array(o.length),r=0;for(var g=o.length;r<g;++r)t[r]=o.charCodeAt(r);o=t}Sb(s,i|146),t=Tb(s,"w"),Xb(t,o,0,o.length,0,_),Vb(t),Sb(s,i)}return s}function W(t,r,o,i){t=N((typeof t=="string"?t:U(t))+"/"+r),r=$b(!!o,!!i),W.Da||(W.Da=64);var s=W.Da++<<8|0;return pb(s,{open:function(t){t.seekable=!1},close:function(){i&&i.buffer&&i.buffer.length&&i(10)},read:function(t,r,i,s){for(var _=0,g=0;g<s;g++){var C;try{C=o()}catch(t){throw new O(M.F)}if(C===void 0&&_===0)throw new O(M.oa);if(C==null)break;_++,r[i+g]=C}return _&&(t.g.timestamp=Date.now()),_},write:function(t,r,o,s){for(var _=0;_<s;_++)try{i(r[o+_])}catch(t){throw new O(M.F)}return s&&(t.g.timestamp=Date.now()),_}}),Qb(t,r,s)}function cc(t){if(t.Ca||t.Xa||t.link||t.e)return!0;var r=!0;if(typeof XMLHttpRequest!="undefined")throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(e.read)try{t.e=Va(e.read(t.url),!0),t.o=t.e.length}catch(t){r=!1}else throw Error("Cannot load without read() or XMLHttpRequest.");return r||ib(M.F),r}var dc={},Hb,Mb,Ub,ec=0;function X(){return ec+=4,F[ec-4>>2]}function fc(){var t;if(t=X(),t=zb[t],!t)throw new O(M.Z);return t}function wa(t){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var r=v;return t==0||wa.Ra(t)?r:4294967295}e._memcpy=gc;function hc(t,r){if(ic=t,jc=r,!kc)return 1;if(t==0)Y=function(){setTimeout(lc,r)},mc="timeout";else if(t==1)Y=function(){nc(lc)},mc="rAF";else if(t==2){if(!window.setImmediate){var o=[];window.addEventListener("message",function(t){t.source===window&&t.data==="__emcc"&&(t.stopPropagation(),o.shift()())},!0),window.setImmediate=function(t){o.push(t),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)},mc="immediate"}return 0}function oc(t,r,o,i,s){e.noExitRuntime=!0,assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),kc=t,pc=i;var _=qc;if(lc=function(){if(!A)if(0<rc.length){var r=Date.now(),o=rc.shift();if(o.Qa(o.T),sc){var s=sc,g=s%1==0?s-1:Math.floor(s);sc=o.ld?g:(8*s+(g+.5))/9}""+o.name+(Date.now()-r),tc(),setTimeout(lc,0)}else _<qc||(uc=uc+1|0,ic==1&&1<jc&&uc%jc!=0?Y():(mc==="timeout"&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc(function(){typeof i!="undefined"?n.J("vi",t,[i]):n.J("v",t)}),_<qc||(typeof SDL=="object"&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))},s||(r&&0<r?hc(0,1e3/r):hc(1,1),Y()),o)throw"SimulateInfiniteLoop"}var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var t=e.statusMessage||"Please wait...",r=sc,o=wc.nd;r?r<o?e.setStatus(t+" ("+(o-r)+"/"+o+")"):e.setStatus(t):e.setStatus("")}}function vc(t){if(!(A||e.preMainLoop&&e.preMainLoop()===!1)){try{t()}catch(t){if(t instanceof xc)return;throw t&&typeof t=="object"&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function t(){zc=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}if(e.preloadPlugins||(e.preloadPlugins=[]),!Cc){Cc=!0;try{Dc=!0}catch(t){Dc=!1}Ec=typeof MozBlobBuilder!="undefined"?MozBlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:Dc?null:console.log("warning: no BlobBuilder"),Fc=typeof window!="undefined"?window.URL?window.URL:window.webkitURL:void 0,e.Ha||typeof Fc!="undefined"||(e.Ha=!0),e.preloadPlugins.push({canHandle:function(t){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},handle:function(t,r,o,i){var s=null;if(Dc)try{s=new Blob([t],{type:Gc(r)}),s.size!==t.length&&(s=new Blob([new Uint8Array(t).buffer],{type:Gc(r)}))}catch(t){n.M("Blob constructor present but fails: "+t+"; falling back to blob builder")}s||(s=new Ec,s.append(new Uint8Array(t).buffer),s=s.getBlob());var _=Fc.createObjectURL(s),g=new Image;g.onload=function(){assert(g.complete,"Image "+r+" could not be decoded");var i=document.createElement("canvas");i.width=g.width,i.height=g.height,i.getContext("2d").drawImage(g,0,0),e.preloadedImages[r]=i,Fc.revokeObjectURL(_),o&&o(t)},g.onerror=function(){""+_,i&&i()},g.src=_}}),e.preloadPlugins.push({canHandle:function(t){return!e.zd&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(t,r,o,i){function s(i){g||(g=!0,e.preloadedAudios[r]=i,o&&o(t))}function _(){g||(g=!0,e.preloadedAudios[r]=new Audio,i&&i())}var g=!1;if(Dc){try{var C=new Blob([t],{type:Gc(r)})}catch(t){return _()}var C=Fc.createObjectURL(C),k=new Audio;k.addEventListener("canplaythrough",function(){s(k)},!1),k.onerror=function(){if(!g){""+r;for(var o="",i=0,_=0,C=0;C<t.length;C++)for(i=i<<8|t[C],_+=8;6<=_;)var x=i>>_-6&63,_=_-6,o=o+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[x];_==2?(o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(i&3)<<4],o+="=="):_==4&&(o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(i&15)<<2],o+="="),k.src="data:audio/x-"+r.substr(-3)+";base64,"+o,s(k)}},k.src=C,Hc(function(){s(k)})}else return _()}});var r=e.canvas;r&&(r.la=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.wa=r.wa.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),e.elementPointerLock&&r.addEventListener("click",function(t){!zc&&r.la&&(r.la(),t.preventDefault())},!1))}}function Ic(t,r,o,i){if(r&&e.fa&&t==e.canvas)return e.fa;var s,_;if(r){if(_={antialias:!1,alpha:!1},i)for(var g in i)_[g]=i[g];(_=GL.createContext(t,_))&&(s=GL.getContext(_).cd),t.style.backgroundColor="black"}else s=t.getContext("2d");return s?(o&&(r||assert(typeof GLctx=="undefined","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=s,r&&GL.yd(_),e.Dd=r,Ac.forEach(function(t){t()}),Bc()),s):null}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(t,r,o){function i(){yc=!1;var t=s.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t?(s.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},s.ua=s.ua.bind(document),Kc&&s.la(),yc=!0,Lc&&Nc()):(t.parentNode.insertBefore(s,t),t.parentNode.removeChild(t),Lc&&Oc()),e.onFullScreen&&e.onFullScreen(yc),Pc(s)}Kc=t,Lc=r,Qc=o,typeof Kc=="undefined"&&(Kc=!0),typeof Lc=="undefined"&&(Lc=!1),typeof Qc=="undefined"&&(Qc=null);var s=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var _=document.createElement("div");s.parentNode.insertBefore(_,s),_.appendChild(s),_.C=_.requestFullScreen||_.mozRequestFullScreen||_.msRequestFullscreen||(_.webkitRequestFullScreen?function(){_.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),o?_.C({Ed:o}):_.C()}var Rc=0;function Sc(t){var r=Date.now();if(Rc===0)Rc=r+1e3/60;else for(;r+2>=Rc;)Rc+=1e3/60;r=Math.max(Rc-r,0),setTimeout(t,r)}function nc(t){typeof window=="undefined"?Sc(t):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(t))}function Hc(t){e.noExitRuntime=!0,setTimeout(function(){A||t()},1e4)}function Gc(t){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[t.substr(t.lastIndexOf(".")+1)]}function Tc(t,r,o){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){i.status==200||i.status==0&&i.response?r(i.response):o()},i.onerror=o,i.send(null)}function Uc(t,r,o){Tc(t,function(o){assert(o,'Loading data file "'+t+'" failed (no arrayBuffer).'),r(new Uint8Array(o)),Za()},function(){if(o)o();else throw'Loading data file "'+t+'" failed.'}),Ya()}var Vc=[];function Wc(){var t=e.canvas;Vc.forEach(function(r){r(t.width,t.height)})}function Nc(){if(typeof SDL!="undefined"){var t=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=t|8388608}Wc()}function Oc(){if(typeof SDL!="undefined"){var t=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=t&-8388609}Wc()}function Pc(t,r,o){r&&o?(t.fb=r,t.Va=o):(r=t.fb,o=t.Va);var s=r,_=o;if(e.forcedAspectRatio&&0<e.forcedAspectRatio&&(s/_<e.forcedAspectRatio?s=Math.round(_*e.forcedAspectRatio):_=Math.round(s/e.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&typeof screen!="undefined")var i=Math.min(screen.width/s,screen.height/_),s=Math.round(s*i),_=Math.round(_*i);Lc?(t.width!=s&&(t.width=s),t.height!=_&&(t.height=_),typeof t.style!="undefined"&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=r&&(t.width=r),t.height!=o&&(t.height=o),typeof t.style!="undefined"&&(s!=r||_!=o?(t.style.setProperty("width",s+"px","important"),t.style.setProperty("height",_+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))}var Cc,Dc,Ec,Fc,Qc;Yb(),R=Array(4096),Nb(P,"/"),V("/tmp"),V("/home"),V("/home/web_user"),(function(){V("/dev"),pb(259,{read:function(){return 0},write:function(t,r,o,i){return i}}),Qb("/dev/null",259),ob(1280,rb),ob(1536,sb),Qb("/dev/tty",1280),Qb("/dev/tty1",1536);var t;if(typeof crypto!="undefined"){var r=new Uint8Array(1);t=function(){return crypto.getRandomValues(r),r[0]}}else t=function(){return 256*Math.random()|0};W("/dev","random",t),W("/dev","urandom",t),V("/dev/shm"),V("/dev/shm/tmp")})(),V("/proc"),V("/proc/self"),V("/proc/self/fd"),Nb({A:function(){var t=ub("/proc/self","fd",16895,73);return t.k={lookup:function(t,r){var o=zb[+r];if(!o)throw new O(M.Z);var i={parent:null,A:{Fa:"fake"},k:{readlink:function(){return o.path}}};return i.parent=i}},t}},"/proc/self/fd"),Qa.unshift(function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),Zb=!0,Yb(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin"),e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout"),e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var t=Tb("/dev/stdin","r");assert(t.fd===0,"invalid handle for stdin ("+t.fd+")"),t=Tb("/dev/stdout","w"),assert(t.fd===1,"invalid handle for stdout ("+t.fd+")"),t=Tb("/dev/stderr","w"),assert(t.fd===2,"invalid handle for stderr ("+t.fd+")")}}),Ra.push(function(){Cb=!1}),K.push(function(){Zb=!1;var t=e._fflush;for(t&&t(0),t=0;t<zb.length;t++){var r=zb[t];r&&Vb(r)}}),e.FS_createFolder=function(t,r,o,i){return t=N((typeof t=="string"?t:U(t))+"/"+r),V(t,$b(o,i))},e.FS_createPath=function(t,r){t=typeof t=="string"?t:U(t);for(var o=r.split("/").reverse();o.length;){var i=o.pop();if(i){var s=N(t+"/"+i);try{V(s)}catch(t){}t=s}}return s},e.FS_createDataFile=bc,e.FS_createPreloadedFile=function(t,r,o,i,s,_,g,C,k,x){function $(o){function $(o){x&&x(),C||bc(t,r,o,i,s,k),_&&_(),Za()}var Q=!1;e.preloadPlugins.forEach(function(t){!Q&&t.canHandle(j)&&(t.handle(o,j,$,function(){g&&g(),Za()}),Q=!0)}),Q||$(o)}Bc();var j=r?mb(N(t+"/"+r)):t;Ya(),typeof o=="string"?Uc(o,function(t){$(t)},g):$(o)},e.FS_createLazyFile=function(t,r,o,i,s){if(typeof XMLHttpRequest!="undefined")throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";o={Ca:!1,url:o};var _=ac(t,r,i,s);o.e?_.e=o.e:o.url&&(_.e=null,_.url=o.url),Object.defineProperty(_,"usedBytes",{get:function(){return this.e.length}});var g={};return Object.keys(_.n).forEach(function(t){var r=_.n[t];g[t]=function(){if(!cc(_))throw new O(M.F);return r.apply(null,arguments)}}),g.read=function(t,r,o,i,s){if(!cc(_))throw new O(M.F);if(t=t.g.e,s>=t.length)return 0;if(i=Math.min(t.length-s,i),assert(0<=i),t.slice)for(var g=0;g<i;g++)r[o+g]=t[s+g];else for(g=0;g<i;g++)r[o+g]=t.get(s+g);return i},_.n=g,_},e.FS_createLink=function(t,r,o){return t=N((typeof t=="string"?t:U(t))+"/"+r),Rb(o,t)},e.FS_createDevice=W,e.FS_unlink=function(t){var r=T(t,{parent:!0}).g,o=lb(t),i=wb(r,o),s;e:{try{s=wb(r,o)}catch(r){s=r.Q;break e}var _=Gb(r,"wx");s=_||((s.mode&61440)===16384?M.N:0)}if(s)throw s===M.N&&(s=M.G),new O(s);if(!r.k.unlink)throw new O(M.G);if(i.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(t)}catch(r){""+t+r.message}if(r.k.unlink(r,o),r=Eb(i.parent.id,i.name),R[r]===i)R[r]=i.K;else for(r=R[r];r;){if(r.K===i){r.K=i.K;break}r=r.K}try{S.onDeletePath&&S.onDeletePath(t)}catch(r){""+t+r.message}},Qa.unshift(function(){}),K.push(function(){}),e.requestFullScreen=function(t,r,o){Mc(t,r,o)},e.requestAnimationFrame=function(t){nc(t)},e.setCanvasSize=function(t,r,o){Pc(e.canvas,t,r),o||Wc()},e.pauseMainLoop=function(){Y=null,qc++},e.resumeMainLoop=function(){qc++;var t=ic,r=jc,o=kc;kc=null,oc(o,0,!1,pc,!0),hc(t,r),Y()},e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)},e.createContext=function(t,r,o,i){return Ic(t,r,o,i)},Ka=m=n.ea(p),va=!0,La=Ka+Na,Ma=v=n.ea(La),assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0},e.Oa={abort:z,assert:assert,invoke_ii:function(t,r){try{return e.dynCall_ii(t,r)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;Z.setThrew(1,0)}},invoke_iiii:function(t,r,o,i){try{return e.dynCall_iiii(t,r,o,i)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;Z.setThrew(1,0)}},invoke_vi:function(t,r){try{e.dynCall_vi(t,r)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(t,r){ec=r;try{var o=fc();return Vb(o),0}catch(t){return typeof dc!="undefined"&&t instanceof O||z(t),-t.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(t){var r=Date.now()/1e3|0;return t&&(F[t>>2]=r),r},___setErrNo:ib,_emscripten_memcpy_big:function(t,r,o){return H.set(H.subarray(r,r+o),t),t},___syscall54:function(t,r){ec=r;try{var o=fc(),i=X();switch(i){case 21505:return o.tty?0:-M.O;case 21506:return o.tty?0:-M.O;case 21519:if(!o.tty)return-M.O;var s=X();return F[s>>2]=0;case 21520:return o.tty?-M.u:-M.O;case 21531:if(s=X(),!o.n.Wa)throw new O(M.O);return o.n.Wa(o,i,s);default:z("bad ioctl syscall "+i)}}catch(t){return typeof dc!="undefined"&&t instanceof O||z(t),-t.Q}},___unlock:function(){},___syscall140:function(t,r){ec=r;try{var o=fc(),i=X(),s=X(),_=X(),g=X();return assert(i===0),Wb(o,s,g),F[_>>2]=o.position,o.ia&&s===0&&g===0&&(o.ia=null),0}catch(t){return typeof dc!="undefined"&&t instanceof O||z(t),-t.Q}},_pthread_cleanup_push:eb,_sysconf:function(t){switch(t){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return typeof navigator=="object"&&navigator.hardwareConcurrency||1}return ib(M.u),-1},___syscall146:function(t,r){ec=r;try{var o=fc(),i=X(),s;e:{for(var _=X(),g=0,C=0;C<_;C++){var k=Xb(o,D,F[i+8*C>>2],F[i+(8*C+4)>>2],void 0);if(0>k){s=-1;break e}g+=k}s=g}return s}catch(t){return typeof dc!="undefined"&&t instanceof O||z(t),-t.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=(function(t,r,o){"avoid using asm because chrome 47+ is broken";var i=new t.Int8Array(o),s=new t.Int16Array(o),_=new t.Int32Array(o),g=new t.Uint8Array(o),C=new t.Uint16Array(o),k=new t.Uint32Array(o),x=new t.Float32Array(o),$=new t.Float64Array(o),j=r.STACKTOP|0,Q=r.STACK_MAX|0,ee=r.tempDoublePtr|0,te=r.ABORT|0,ne=r.cttz_i8|0,re=0,oe=0,ae=0,ie=0,le=t.NaN,se=t.Infinity,ue=0,ce=0,de=0,me=0,pe=0,_e=0,fe=0,ge=0,he=0,ye=0,Ce=0,be=0,ve=0,Se=0,Re=0,Le=0,Ee=0,ke=0,Ie=0,Te=t.Math.floor,De=t.Math.abs,xe=t.Math.sqrt,$e=t.Math.pow,Pe=t.Math.cos,Ne=t.Math.sin,Me=t.Math.tan,we=t.Math.acos,Ae=t.Math.asin,Fe=t.Math.atan,Oe=t.Math.atan2,Be=t.Math.exp,We=t.Math.log,qe=t.Math.ceil,Ue=t.Math.imul,Ve=t.Math.min,He=t.Math.clz32,Ge=r.abort,ze=r.assert,je=r.invoke_ii,Ke=r.invoke_iiii,Qe=r.invoke_vi,Xe=r._pthread_cleanup_pop,Ye=r.___lock,Je=r._emscripten_set_main_loop,Ze=r._pthread_self,et=r.___syscall6,tt=r._emscripten_set_main_loop_timing,nt=r._abort,rt=r._sbrk,ot=r._time,at=r.___setErrNo,it=r._emscripten_memcpy_big,lt=r.___syscall54,st=r.___unlock,ut=r.___syscall140,ct=r._pthread_cleanup_push,dt=r._sysconf,mt=r.___syscall146,pt=0;function _t(t){t=t|0;var r=0;return r=j,j=j+t|0,j=j+15&-16,r|0}function ft(){return j|0}function gt(t){t=t|0,j=t}function ht(t,r){t=t|0,r=r|0,j=t,Q=r}function yt(t,r){t=t|0,r=r|0,re||(re=t,oe=r)}function Ct(t){t=t|0,i[ee>>0]=i[t>>0],i[ee+1>>0]=i[t+1>>0],i[ee+2>>0]=i[t+2>>0],i[ee+3>>0]=i[t+3>>0]}function bt(t){t=t|0,i[ee>>0]=i[t>>0],i[ee+1>>0]=i[t+1>>0],i[ee+2>>0]=i[t+2>>0],i[ee+3>>0]=i[t+3>>0],i[ee+4>>0]=i[t+4>>0],i[ee+5>>0]=i[t+5>>0],i[ee+6>>0]=i[t+6>>0],i[ee+7>>0]=i[t+7>>0]}function vt(t){t=t|0,ye=t}function St(){return ye|0}function Rt(t,r,o){t=t|0,r=r|0,o=o|0;var s=0,C=0,k=0,x=0,$=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0,pe=0,_e=0,fe=0,ge=0,he=0,Ce=0,be=0,ve=0,Se=0,Re=0,Le=0,Ee=0,ke=0,Ie=0,Te=0,De=0,xe=0,$e=0,Pe=0,Ne=0,Me=0,we=0,Ae=0,Fe=0,Oe=0,Be=0,We=0,qe=0,Ve=0,He=0,Ge=0,ze=0,je=0,Ke=0,Qe=0,Xe=0,Ye=0,Je=0,Ze=0,et=0,tt=0,nt=0,rt=0,ot=0,at=0,it=0,lt=0,st=0,ut=0,ct=0,dt=0,mt=0,pt=0,_t=0,ft=0,gt=0,ht=0,yt=0,Ct=0,bt=0,vt=0,St=0,Rt=0,It=0,Tt=0,Dt=0,xt=0,$t=0,Pt=0,Nt=0,Mt=0,wt=0,At=0,Ft=0,Ot=0,Bt=0,Wt=0,jt=0,Kt=0,Qt=0,Xt=0,Yt=0,Zt=0,en=0,tn=0,nn=0,rn=0,on=0,an=0,ln=0,sn=0,un=0,cn=0,dn=0,mn=0,pn=0,_n=0,fn=0,gn=0,hn=0,yn=0,Cn=0,bn=0,vn=0,Sn=0,Rn=0,Ln=0,En=0,kn=0,In=0,Tn=0,Dn=0,xn=0,$n=0,Pn=0,Nn=0,Mn=0,wn=0,An=0,Fn=0,On=0,Bn=0,Wn=0,qn=0,Un=0,Vn=0,Hn=0,Gn=0,zn=0,jn=0,Kn=0,Qn=0,Xn=0,Yn=0,Jn=0,Zn=0,er=0,tr=0,nr=0,rr=0,or=0,ar=0,ir=0,lr=0,sr=0,ur=0,cr=0,dr=0,mr=0,pr=0,_r=0,fr=0,gr=0,hr=0,yr=0,Cr=0,br=0,vr=0;s=j,j=j+2640|0,C=s+2456|0,k=s+2304|0,x=s+2152|0,$=s+2e3|0,Q=s+1848|0,ee=s+1696|0,te=s+1544|0,ne=s+1392|0,re=s+1240|0,oe=s+1088|0,ae=s+936|0,ie=s+784|0,le=s+632|0,se=s+480|0,ue=s+328|0,ce=s+248|0,de=s+168|0,me=s+80|0,pe=s,_e=s+2608|0,fe=_e,ge=r,r=fe+32|0;do i[fe>>0]=i[ge>>0]|0,fe=fe+1|0,ge=ge+1|0;while((fe|0)<(r|0));i[_e>>0]=(g[_e>>0]|0)&248,he=_e+31|0,i[he>>0]=(g[he>>0]|0)&63|64,he=g[o>>0]|0,Ce=zt(g[o+1>>0]|0|0,0,8)|0,be=ye,ve=zt(g[o+2>>0]|0|0,0,16)|0,Se=be|ye,be=g[o+3>>0]|0,Re=zt(be|0,0,24)|0,Le=ce,_[Le>>2]=Ce|he|ve|Re&50331648,_[Le+4>>2]=Se,Se=zt(g[o+4>>0]|0|0,0,8)|0,Le=ye,Re=zt(g[o+5>>0]|0|0,0,16)|0,ve=Le|ye,Le=g[o+6>>0]|0,he=zt(Le|0,0,24)|0,Ce=Gt(Se|be|Re|he|0,ve|ye|0,2)|0,ve=ce+8|0,_[ve>>2]=Ce&33554431,_[ve+4>>2]=0,ve=zt(g[o+7>>0]|0|0,0,8)|0,Ce=ye,he=zt(g[o+8>>0]|0|0,0,16)|0,Re=Ce|ye,Ce=g[o+9>>0]|0,be=zt(Ce|0,0,24)|0,Se=Gt(ve|Le|he|be|0,Re|ye|0,3)|0,Re=ce+16|0,_[Re>>2]=Se&67108863,_[Re+4>>2]=0,Re=zt(g[o+10>>0]|0|0,0,8)|0,Se=ye,be=zt(g[o+11>>0]|0|0,0,16)|0,he=Se|ye,Se=g[o+12>>0]|0,Le=zt(Se|0,0,24)|0,ve=Gt(Re|Ce|be|Le|0,he|ye|0,5)|0,he=ce+24|0,_[he>>2]=ve&33554431,_[he+4>>2]=0,he=zt(g[o+13>>0]|0|0,0,8)|0,ve=ye,Le=zt(g[o+14>>0]|0|0,0,16)|0,be=ve|ye,ve=zt(g[o+15>>0]|0|0,0,24)|0,Ce=Gt(he|Se|Le|ve|0,be|ye|0,6)|0,be=ce+32|0,_[be>>2]=Ce&67108863,_[be+4>>2]=0,be=g[o+16>>0]|0,Ce=zt(g[o+17>>0]|0|0,0,8)|0,ve=ye,Le=zt(g[o+18>>0]|0|0,0,16)|0,Se=ve|ye,ve=g[o+19>>0]|0,he=zt(ve|0,0,24)|0,Re=ce+40|0,_[Re>>2]=Ce|be|Le|he&16777216,_[Re+4>>2]=Se,Se=zt(g[o+20>>0]|0|0,0,8)|0,Re=ye,he=zt(g[o+21>>0]|0|0,0,16)|0,Le=Re|ye,Re=g[o+22>>0]|0,be=zt(Re|0,0,24)|0,Ce=Gt(Se|ve|he|be|0,Le|ye|0,1)|0,Le=ce+48|0,_[Le>>2]=Ce&67108863,_[Le+4>>2]=0,Le=zt(g[o+23>>0]|0|0,0,8)|0,Ce=ye,be=zt(g[o+24>>0]|0|0,0,16)|0,he=Ce|ye,Ce=g[o+25>>0]|0,ve=zt(Ce|0,0,24)|0,Se=Gt(Le|Re|be|ve|0,he|ye|0,3)|0,he=ce+56|0,_[he>>2]=Se&33554431,_[he+4>>2]=0,he=zt(g[o+26>>0]|0|0,0,8)|0,Se=ye,ve=zt(g[o+27>>0]|0|0,0,16)|0,be=Se|ye,Se=g[o+28>>0]|0,Re=zt(Se|0,0,24)|0,Le=Gt(he|Ce|ve|Re|0,be|ye|0,4)|0,be=ce+64|0,_[be>>2]=Le&67108863,_[be+4>>2]=0,be=zt(g[o+29>>0]|0|0,0,8)|0,Le=ye,Re=zt(g[o+30>>0]|0|0,0,16)|0,ve=Le|ye,Le=zt(g[o+31>>0]|0|0,0,24)|0,o=Gt(be|Se|Re|Le|0,ve|ye|0,6)|0,ve=ce+72|0,_[ve>>2]=o&33554431,_[ve+4>>2]=0,Ht(re|0,0,152)|0,ve=re,_[ve>>2]=1,_[ve+4>>2]=0,Ht(oe|0,0,152)|0,ve=oe,_[ve>>2]=1,_[ve+4>>2]=0,Ht(ae|0,0,152)|0,Ht(ie|0,0,152)|0,Ht(le|0,0,152)|0,ve=le,_[ve>>2]=1,_[ve+4>>2]=0,Ht(se|0,0,152)|0,Ht(ue|0,0,152)|0,ve=ue,_[ve>>2]=1,_[ve+4>>2]=0,fe=ne+80|0,r=fe+72|0;do _[fe>>2]=0,fe=fe+4|0;while((fe|0)<(r|0));fe=ne,ge=ce,r=fe+80|0;do _[fe>>2]=_[ge>>2],fe=fe+4|0,ge=ge+4|0;while((fe|0)<(r|0));for(ve=$+144|0,o=$+64|0,Le=$+136|0,Re=$+56|0,Se=$+128|0,be=$+48|0,Ce=$+120|0,he=$+40|0,Ee=$+112|0,ke=$+32|0,Ie=$+104|0,Te=$+24|0,De=$+96|0,xe=$+16|0,$e=$+88|0,Pe=$+8|0,Ne=$+80|0,Me=Q+144|0,we=Q+64|0,Ae=Q+136|0,Fe=Q+56|0,Oe=Q+128|0,Be=Q+48|0,We=Q+120|0,qe=Q+40|0,Ve=Q+112|0,He=Q+32|0,Ge=Q+104|0,ze=Q+24|0,je=Q+96|0,Ke=Q+16|0,Qe=Q+88|0,Xe=Q+8|0,Ye=Q+80|0,Je=$+72|0,Ze=Q+72|0,et=k+8|0,tt=x+8|0,nt=k+16|0,rt=x+16|0,ot=k+24|0,at=x+24|0,it=k+32|0,lt=x+32|0,st=k+40|0,ut=x+40|0,ct=k+48|0,dt=x+48|0,mt=k+56|0,pt=x+56|0,_t=k+64|0,ft=x+64|0,gt=k+72|0,ht=x+72|0,yt=C+80|0,Ct=C+8|0,bt=C+16|0,vt=C+24|0,St=C+32|0,Rt=C+40|0,It=C+48|0,Tt=C+56|0,Dt=C+64|0,xt=C+72|0,$t=0,Pt=ne,Nt=ie,ie=re,Mt=le,le=oe,wt=se,se=ae,ae=ue;;){for(ue=i[_e+(31-$t)>>0]|0,At=0,Ft=Pt,Ot=Nt,Bt=ie,Wt=Mt,jt=le,Kt=wt,Qt=se,Xt=ae;;){Yt=ue&255,Zt=Ut(0,0,Yt>>>7|0,0)|0,en=ye,tn=0;do nn=jt+(tn<<3)|0,rn=nn,on=_[rn>>2]|0,an=_[rn+4>>2]|0,rn=Ft+(tn<<3)|0,ln=rn,sn=_[ln>>2]|0,un=_[ln+4>>2]|0,ln=(sn^on)&Zt,cn=(un^an)&en,an=qt(0,ln^on|0,32)|0,on=nn,_[on>>2]=an,_[on+4>>2]=ye,on=qt(0,ln^sn|0,32)|0,sn=rn,_[sn>>2]=on,_[sn+4>>2]=ye,tn=tn+1|0;while((tn|0)!=10);dn=0;do tn=Qt+(dn<<3)|0,sn=tn,on=_[sn>>2]|0,rn=_[sn+4>>2]|0,sn=Bt+(dn<<3)|0,ln=sn,an=_[ln>>2]|0,nn=_[ln+4>>2]|0,ln=(an^on)&Zt,un=(nn^rn)&en,rn=qt(0,ln^on|0,32)|0,on=tn,_[on>>2]=rn,_[on+4>>2]=ye,on=qt(0,ln^an|0,32)|0,an=sn,_[an>>2]=on,_[an+4>>2]=ye,dn=dn+1|0;while((dn|0)!=10);an=jt,on=_[an>>2]|0,sn=_[an+4>>2]|0,an=jt+8|0,ln=an,rn=_[ln>>2]|0,tn=_[ln+4>>2]|0,ln=jt+16|0,nn=ln,un=_[nn>>2]|0,cn=_[nn+4>>2]|0,nn=jt+24|0,mn=nn,pn=_[mn>>2]|0,_n=_[mn+4>>2]|0,mn=jt+32|0,fn=mn,gn=_[fn>>2]|0,hn=_[fn+4>>2]|0,fn=jt+40|0,yn=fn,Cn=_[yn>>2]|0,bn=_[yn+4>>2]|0,yn=jt+48|0,vn=yn,Sn=_[vn>>2]|0,Rn=_[vn+4>>2]|0,vn=jt+56|0,Ln=vn,En=_[Ln>>2]|0,kn=_[Ln+4>>2]|0,Ln=jt+64|0,In=Ln,Tn=_[In>>2]|0,Dn=_[In+4>>2]|0,In=jt+72|0,xn=In,$n=_[xn>>2]|0,Pn=_[xn+4>>2]|0,xn=Qt,Nn=_[xn>>2]|0,Mn=_[xn+4>>2]|0,xn=Vt(Nn|0,Mn|0,on|0,sn|0)|0,wn=jt,_[wn>>2]=xn,_[wn+4>>2]=ye,wn=Qt+8|0,xn=wn,An=_[xn>>2]|0,Fn=_[xn+4>>2]|0,xn=Vt(An|0,Fn|0,rn|0,tn|0)|0,On=an,_[On>>2]=xn,_[On+4>>2]=ye,On=Qt+16|0,xn=On,an=_[xn>>2]|0,Bn=_[xn+4>>2]|0,xn=Vt(an|0,Bn|0,un|0,cn|0)|0,Wn=ln,_[Wn>>2]=xn,_[Wn+4>>2]=ye,Wn=Qt+24|0,xn=Wn,ln=_[xn>>2]|0,qn=_[xn+4>>2]|0,xn=Vt(ln|0,qn|0,pn|0,_n|0)|0,Un=nn,_[Un>>2]=xn,_[Un+4>>2]=ye,Un=Qt+32|0,xn=Un,nn=_[xn>>2]|0,Vn=_[xn+4>>2]|0,xn=Vt(nn|0,Vn|0,gn|0,hn|0)|0,Hn=mn,_[Hn>>2]=xn,_[Hn+4>>2]=ye,Hn=Qt+40|0,xn=Hn,mn=_[xn>>2]|0,Gn=_[xn+4>>2]|0,xn=Vt(mn|0,Gn|0,Cn|0,bn|0)|0,zn=fn,_[zn>>2]=xn,_[zn+4>>2]=ye,zn=Qt+48|0,xn=zn,fn=_[xn>>2]|0,jn=_[xn+4>>2]|0,xn=Vt(fn|0,jn|0,Sn|0,Rn|0)|0,Kn=yn,_[Kn>>2]=xn,_[Kn+4>>2]=ye,Kn=Qt+56|0,xn=Kn,yn=_[xn>>2]|0,Qn=_[xn+4>>2]|0,xn=Vt(yn|0,Qn|0,En|0,kn|0)|0,Xn=vn,_[Xn>>2]=xn,_[Xn+4>>2]=ye,Xn=Qt+64|0,xn=Xn,vn=_[xn>>2]|0,Yn=_[xn+4>>2]|0,xn=Vt(vn|0,Yn|0,Tn|0,Dn|0)|0,Jn=Ln,_[Jn>>2]=xn,_[Jn+4>>2]=ye,Jn=Qt+72|0,xn=Jn,Ln=_[xn>>2]|0,Zn=_[xn+4>>2]|0,xn=Vt(Ln|0,Zn|0,$n|0,Pn|0)|0,er=In,_[er>>2]=xn,_[er+4>>2]=ye,er=Ut(on|0,sn|0,Nn|0,Mn|0)|0,Mn=Qt,_[Mn>>2]=er,_[Mn+4>>2]=ye,Mn=Ut(rn|0,tn|0,An|0,Fn|0)|0,Fn=wn,_[Fn>>2]=Mn,_[Fn+4>>2]=ye,Fn=Ut(un|0,cn|0,an|0,Bn|0)|0,Bn=On,_[Bn>>2]=Fn,_[Bn+4>>2]=ye,Bn=Ut(pn|0,_n|0,ln|0,qn|0)|0,qn=Wn,_[qn>>2]=Bn,_[qn+4>>2]=ye,qn=Ut(gn|0,hn|0,nn|0,Vn|0)|0,Vn=Un,_[Vn>>2]=qn,_[Vn+4>>2]=ye,Vn=Ut(Cn|0,bn|0,mn|0,Gn|0)|0,Gn=Hn,_[Gn>>2]=Vn,_[Gn+4>>2]=ye,Gn=Ut(Sn|0,Rn|0,fn|0,jn|0)|0,jn=zn,_[jn>>2]=Gn,_[jn+4>>2]=ye,jn=Ut(En|0,kn|0,yn|0,Qn|0)|0,Qn=Kn,_[Qn>>2]=jn,_[Qn+4>>2]=ye,Qn=Ut(Tn|0,Dn|0,vn|0,Yn|0)|0,Yn=Xn,_[Yn>>2]=Qn,_[Yn+4>>2]=ye,Yn=Ut($n|0,Pn|0,Ln|0,Zn|0)|0,Zn=Jn,_[Zn>>2]=Yn,_[Zn+4>>2]=ye,Zn=Ft,Yn=_[Zn>>2]|0,Jn=_[Zn+4>>2]|0,Zn=Ft+8|0,Ln=Zn,Pn=_[Ln>>2]|0,$n=_[Ln+4>>2]|0,Ln=Ft+16|0,Qn=Ln,Xn=_[Qn>>2]|0,vn=_[Qn+4>>2]|0,Qn=Ft+24|0,Dn=Qn,Tn=_[Dn>>2]|0,jn=_[Dn+4>>2]|0,Dn=Ft+32|0,Kn=Dn,yn=_[Kn>>2]|0,kn=_[Kn+4>>2]|0,Kn=Ft+40|0,En=Kn,Gn=_[En>>2]|0,zn=_[En+4>>2]|0,En=Ft+48|0,fn=En,Rn=_[fn>>2]|0,Sn=_[fn+4>>2]|0,fn=Ft+56|0,Vn=fn,Hn=_[Vn>>2]|0,mn=_[Vn+4>>2]|0,Vn=Ft+64|0,bn=Vn,Cn=_[bn>>2]|0,qn=_[bn+4>>2]|0,bn=Ft+72|0,Un=bn,nn=_[Un>>2]|0,hn=_[Un+4>>2]|0,Un=Bt,gn=_[Un>>2]|0,Bn=_[Un+4>>2]|0,Un=Vt(gn|0,Bn|0,Yn|0,Jn|0)|0,Wn=Ft,_[Wn>>2]=Un,_[Wn+4>>2]=ye,Wn=Bt+8|0,Un=Wn,ln=_[Un>>2]|0,_n=_[Un+4>>2]|0,Un=Vt(ln|0,_n|0,Pn|0,$n|0)|0,pn=Zn,_[pn>>2]=Un,_[pn+4>>2]=ye,pn=Bt+16|0,Un=pn,Zn=_[Un>>2]|0,Fn=_[Un+4>>2]|0,Un=Vt(Zn|0,Fn|0,Xn|0,vn|0)|0,On=Ln,_[On>>2]=Un,_[On+4>>2]=ye,On=Bt+24|0,Un=On,Ln=_[Un>>2]|0,an=_[Un+4>>2]|0,Un=Vt(Ln|0,an|0,Tn|0,jn|0)|0,cn=Qn,_[cn>>2]=Un,_[cn+4>>2]=ye,cn=Bt+32|0,Un=cn,Qn=_[Un>>2]|0,un=_[Un+4>>2]|0,Un=Vt(Qn|0,un|0,yn|0,kn|0)|0,Mn=Dn,_[Mn>>2]=Un,_[Mn+4>>2]=ye,Mn=Bt+40|0,Un=Mn,Dn=_[Un>>2]|0,wn=_[Un+4>>2]|0,Un=Vt(Dn|0,wn|0,Gn|0,zn|0)|0,An=Kn,_[An>>2]=Un,_[An+4>>2]=ye,An=Bt+48|0,Un=An,Kn=_[Un>>2]|0,tn=_[Un+4>>2]|0,Un=Vt(Kn|0,tn|0,Rn|0,Sn|0)|0,rn=En,_[rn>>2]=Un,_[rn+4>>2]=ye,rn=Bt+56|0,Un=rn,En=_[Un>>2]|0,er=_[Un+4>>2]|0,Un=Vt(En|0,er|0,Hn|0,mn|0)|0,Nn=fn,_[Nn>>2]=Un,_[Nn+4>>2]=ye,Nn=Bt+64|0,Un=Nn,fn=_[Un>>2]|0,sn=_[Un+4>>2]|0,Un=Vt(fn|0,sn|0,Cn|0,qn|0)|0,on=Vn,_[on>>2]=Un,_[on+4>>2]=ye,on=Bt+72|0,Un=on,Vn=_[Un>>2]|0,xn=_[Un+4>>2]|0,Un=Vt(Vn|0,xn|0,nn|0,hn|0)|0,In=bn,_[In>>2]=Un,_[In+4>>2]=ye,In=Ut(Yn|0,Jn|0,gn|0,Bn|0)|0,Bn=Bt,_[Bn>>2]=In,_[Bn+4>>2]=ye,Bn=Ut(Pn|0,$n|0,ln|0,_n|0)|0,_n=Wn,_[_n>>2]=Bn,_[_n+4>>2]=ye,_n=Ut(Xn|0,vn|0,Zn|0,Fn|0)|0,Fn=pn,_[Fn>>2]=_n,_[Fn+4>>2]=ye,Fn=Ut(Tn|0,jn|0,Ln|0,an|0)|0,an=On,_[an>>2]=Fn,_[an+4>>2]=ye,an=Ut(yn|0,kn|0,Qn|0,un|0)|0,un=cn,_[un>>2]=an,_[un+4>>2]=ye,un=Ut(Gn|0,zn|0,Dn|0,wn|0)|0,wn=Mn,_[wn>>2]=un,_[wn+4>>2]=ye,wn=Ut(Rn|0,Sn|0,Kn|0,tn|0)|0,tn=An,_[tn>>2]=wn,_[tn+4>>2]=ye,tn=Ut(Hn|0,mn|0,En|0,er|0)|0,er=rn,_[er>>2]=tn,_[er+4>>2]=ye,er=Ut(Cn|0,qn|0,fn|0,sn|0)|0,sn=Nn,_[sn>>2]=er,_[sn+4>>2]=ye,sn=Ut(nn|0,hn|0,Vn|0,xn|0)|0,xn=on,_[xn>>2]=sn,_[xn+4>>2]=ye,Et($,Ft,Qt),Et(Q,jt,Bt),xn=ve,sn=_[xn>>2]|0,on=_[xn+4>>2]|0,xn=o,Vn=_[xn>>2]|0,hn=_[xn+4>>2]|0,xn=Jt(sn|0,on|0,18,0)|0,nn=ye,er=Vt(Vn|0,hn|0,sn|0,on|0)|0,on=Vt(er|0,ye|0,xn|0,nn|0)|0,nn=o,_[nn>>2]=on,_[nn+4>>2]=ye,nn=Le,on=_[nn>>2]|0,xn=_[nn+4>>2]|0,nn=Re,er=_[nn>>2]|0,sn=_[nn+4>>2]|0,nn=Jt(on|0,xn|0,18,0)|0,hn=ye,Vn=Vt(er|0,sn|0,on|0,xn|0)|0,xn=Vt(Vn|0,ye|0,nn|0,hn|0)|0,hn=Re,_[hn>>2]=xn,_[hn+4>>2]=ye,hn=Se,xn=_[hn>>2]|0,nn=_[hn+4>>2]|0,hn=be,Vn=_[hn>>2]|0,on=_[hn+4>>2]|0,hn=Jt(xn|0,nn|0,18,0)|0,sn=ye,er=Vt(Vn|0,on|0,xn|0,nn|0)|0,nn=Vt(er|0,ye|0,hn|0,sn|0)|0,sn=be,_[sn>>2]=nn,_[sn+4>>2]=ye,sn=Ce,nn=_[sn>>2]|0,hn=_[sn+4>>2]|0,sn=he,er=_[sn>>2]|0,xn=_[sn+4>>2]|0,sn=Jt(nn|0,hn|0,18,0)|0,on=ye,Vn=Vt(er|0,xn|0,nn|0,hn|0)|0,hn=Vt(Vn|0,ye|0,sn|0,on|0)|0,on=he,_[on>>2]=hn,_[on+4>>2]=ye,on=Ee,hn=_[on>>2]|0,sn=_[on+4>>2]|0,on=ke,Vn=_[on>>2]|0,nn=_[on+4>>2]|0,on=Jt(hn|0,sn|0,18,0)|0,xn=ye,er=Vt(Vn|0,nn|0,hn|0,sn|0)|0,sn=Vt(er|0,ye|0,on|0,xn|0)|0,xn=ke,_[xn>>2]=sn,_[xn+4>>2]=ye,xn=Ie,sn=_[xn>>2]|0,on=_[xn+4>>2]|0,xn=Te,er=_[xn>>2]|0,hn=_[xn+4>>2]|0,xn=Jt(sn|0,on|0,18,0)|0,nn=ye,Vn=Vt(er|0,hn|0,sn|0,on|0)|0,on=Vt(Vn|0,ye|0,xn|0,nn|0)|0,nn=Te,_[nn>>2]=on,_[nn+4>>2]=ye,nn=De,on=_[nn>>2]|0,xn=_[nn+4>>2]|0,nn=xe,Vn=_[nn>>2]|0,sn=_[nn+4>>2]|0,nn=Jt(on|0,xn|0,18,0)|0,hn=ye,er=Vt(Vn|0,sn|0,on|0,xn|0)|0,xn=Vt(er|0,ye|0,nn|0,hn|0)|0,hn=xe,_[hn>>2]=xn,_[hn+4>>2]=ye,hn=$e,xn=_[hn>>2]|0,nn=_[hn+4>>2]|0,hn=Pe,er=_[hn>>2]|0,on=_[hn+4>>2]|0,hn=Jt(xn|0,nn|0,18,0)|0,sn=ye,Vn=Vt(er|0,on|0,xn|0,nn|0)|0,nn=Vt(Vn|0,ye|0,hn|0,sn|0)|0,sn=Pe,_[sn>>2]=nn,_[sn+4>>2]=ye,sn=Ne,nn=_[sn>>2]|0,hn=_[sn+4>>2]|0,sn=$,Vn=_[sn>>2]|0,xn=_[sn+4>>2]|0,sn=Jt(nn|0,hn|0,18,0)|0,on=ye,er=Vt(Vn|0,xn|0,nn|0,hn|0)|0,hn=Vt(er|0,ye|0,sn|0,on|0)|0,on=ye,sn=$,_[sn>>2]=hn,_[sn+4>>2]=on,sn=Ne,_[sn>>2]=0,_[sn+4>>2]=0,sn=on,on=hn,hn=0;do er=Vt(sn>>31>>>6|0,0,on|0,sn|0)|0,nn=qt(er|0,ye|0,26)|0,er=ye,xn=zt(nn|0,er|0,26)|0,Vn=Ut(on|0,sn|0,xn|0,ye|0)|0,xn=$+(hn<<3)|0,_[xn>>2]=Vn,_[xn+4>>2]=ye,xn=$+((hn|1)<<3)|0,Vn=xn,Nn=Vt(nn|0,er|0,_[Vn>>2]|0,_[Vn+4>>2]|0)|0,Vn=ye,er=Vt(Vn>>31>>>7|0,0,Nn|0,Vn|0)|0,nn=qt(er|0,ye|0,25)|0,er=ye,fn=zt(nn|0,er|0,25)|0,qn=Ut(Nn|0,Vn|0,fn|0,ye|0)|0,fn=xn,_[fn>>2]=qn,_[fn+4>>2]=ye,hn=hn+2|0,fn=$+(hn<<3)|0,qn=fn,on=Vt(nn|0,er|0,_[qn>>2]|0,_[qn+4>>2]|0)|0,sn=ye,qn=fn,_[qn>>2]=on,_[qn+4>>2]=sn;while(hn>>>0<10);hn=Ne,sn=_[hn>>2]|0,on=_[hn+4>>2]|0,hn=$,qn=_[hn>>2]|0,fn=_[hn+4>>2]|0,hn=Jt(sn|0,on|0,18,0)|0,er=ye,nn=Vt(qn|0,fn|0,sn|0,on|0)|0,on=Vt(nn|0,ye|0,hn|0,er|0)|0,er=ye,hn=Ne,_[hn>>2]=0,_[hn+4>>2]=0,hn=Vt(er>>31>>>6|0,0,on|0,er|0)|0,nn=qt(hn|0,ye|0,26)|0,hn=ye,sn=zt(nn|0,hn|0,26)|0,fn=Ut(on|0,er|0,sn|0,ye|0)|0,sn=ye,er=$,_[er>>2]=fn,_[er+4>>2]=sn,er=Pe,on=Vt(nn|0,hn|0,_[er>>2]|0,_[er+4>>2]|0)|0,er=ye,hn=Pe,_[hn>>2]=on,_[hn+4>>2]=er,hn=Me,nn=_[hn>>2]|0,qn=_[hn+4>>2]|0,hn=we,xn=_[hn>>2]|0,Vn=_[hn+4>>2]|0,hn=Jt(nn|0,qn|0,18,0)|0,Nn=ye,Cn=Vt(xn|0,Vn|0,nn|0,qn|0)|0,qn=Vt(Cn|0,ye|0,hn|0,Nn|0)|0,Nn=we,_[Nn>>2]=qn,_[Nn+4>>2]=ye,Nn=Ae,qn=_[Nn>>2]|0,hn=_[Nn+4>>2]|0,Nn=Fe,Cn=_[Nn>>2]|0,nn=_[Nn+4>>2]|0,Nn=Jt(qn|0,hn|0,18,0)|0,Vn=ye,xn=Vt(Cn|0,nn|0,qn|0,hn|0)|0,hn=Vt(xn|0,ye|0,Nn|0,Vn|0)|0,Vn=Fe,_[Vn>>2]=hn,_[Vn+4>>2]=ye,Vn=Oe,hn=_[Vn>>2]|0,Nn=_[Vn+4>>2]|0,Vn=Be,xn=_[Vn>>2]|0,qn=_[Vn+4>>2]|0,Vn=Jt(hn|0,Nn|0,18,0)|0,nn=ye,Cn=Vt(xn|0,qn|0,hn|0,Nn|0)|0,Nn=Vt(Cn|0,ye|0,Vn|0,nn|0)|0,nn=Be,_[nn>>2]=Nn,_[nn+4>>2]=ye,nn=We,Nn=_[nn>>2]|0,Vn=_[nn+4>>2]|0,nn=qe,Cn=_[nn>>2]|0,hn=_[nn+4>>2]|0,nn=Jt(Nn|0,Vn|0,18,0)|0,qn=ye,xn=Vt(Cn|0,hn|0,Nn|0,Vn|0)|0,Vn=Vt(xn|0,ye|0,nn|0,qn|0)|0,qn=qe,_[qn>>2]=Vn,_[qn+4>>2]=ye,qn=Ve,Vn=_[qn>>2]|0,nn=_[qn+4>>2]|0,qn=He,xn=_[qn>>2]|0,Nn=_[qn+4>>2]|0,qn=Jt(Vn|0,nn|0,18,0)|0,hn=ye,Cn=Vt(xn|0,Nn|0,Vn|0,nn|0)|0,nn=Vt(Cn|0,ye|0,qn|0,hn|0)|0,hn=He,_[hn>>2]=nn,_[hn+4>>2]=ye,hn=Ge,nn=_[hn>>2]|0,qn=_[hn+4>>2]|0,hn=ze,Cn=_[hn>>2]|0,Vn=_[hn+4>>2]|0,hn=Jt(nn|0,qn|0,18,0)|0,Nn=ye,xn=Vt(Cn|0,Vn|0,nn|0,qn|0)|0,qn=Vt(xn|0,ye|0,hn|0,Nn|0)|0,Nn=ze,_[Nn>>2]=qn,_[Nn+4>>2]=ye,Nn=je,qn=_[Nn>>2]|0,hn=_[Nn+4>>2]|0,Nn=Ke,xn=_[Nn>>2]|0,nn=_[Nn+4>>2]|0,Nn=Jt(qn|0,hn|0,18,0)|0,Vn=ye,Cn=Vt(xn|0,nn|0,qn|0,hn|0)|0,hn=Vt(Cn|0,ye|0,Nn|0,Vn|0)|0,Vn=Ke,_[Vn>>2]=hn,_[Vn+4>>2]=ye,Vn=Qe,hn=_[Vn>>2]|0,Nn=_[Vn+4>>2]|0,Vn=Xe,Cn=_[Vn>>2]|0,qn=_[Vn+4>>2]|0,Vn=Jt(hn|0,Nn|0,18,0)|0,nn=ye,xn=Vt(Cn|0,qn|0,hn|0,Nn|0)|0,Nn=Vt(xn|0,ye|0,Vn|0,nn|0)|0,nn=Xe,_[nn>>2]=Nn,_[nn+4>>2]=ye,nn=Ye,Nn=_[nn>>2]|0,Vn=_[nn+4>>2]|0,nn=Q,xn=_[nn>>2]|0,hn=_[nn+4>>2]|0,nn=Jt(Nn|0,Vn|0,18,0)|0,qn=ye,Cn=Vt(xn|0,hn|0,Nn|0,Vn|0)|0,Vn=Vt(Cn|0,ye|0,nn|0,qn|0)|0,qn=ye,nn=Q,_[nn>>2]=Vn,_[nn+4>>2]=qn,nn=Ye,_[nn>>2]=0,_[nn+4>>2]=0,nn=qn,qn=Vn,Vn=0;do Cn=Vt(nn>>31>>>6|0,0,qn|0,nn|0)|0,Nn=qt(Cn|0,ye|0,26)|0,Cn=ye,hn=zt(Nn|0,Cn|0,26)|0,xn=Ut(qn|0,nn|0,hn|0,ye|0)|0,hn=Q+(Vn<<3)|0,_[hn>>2]=xn,_[hn+4>>2]=ye,hn=Q+((Vn|1)<<3)|0,xn=hn,tn=Vt(Nn|0,Cn|0,_[xn>>2]|0,_[xn+4>>2]|0)|0,xn=ye,Cn=Vt(xn>>31>>>7|0,0,tn|0,xn|0)|0,Nn=qt(Cn|0,ye|0,25)|0,Cn=ye,rn=zt(Nn|0,Cn|0,25)|0,En=Ut(tn|0,xn|0,rn|0,ye|0)|0,rn=hn,_[rn>>2]=En,_[rn+4>>2]=ye,Vn=Vn+2|0,rn=Q+(Vn<<3)|0,En=rn,qn=Vt(Nn|0,Cn|0,_[En>>2]|0,_[En+4>>2]|0)|0,nn=ye,En=rn,_[En>>2]=qn,_[En+4>>2]=nn;while(Vn>>>0<10);Vn=Ye,nn=_[Vn>>2]|0,qn=_[Vn+4>>2]|0,Vn=Q,En=_[Vn>>2]|0,rn=_[Vn+4>>2]|0,Vn=Jt(nn|0,qn|0,18,0)|0,Cn=ye,Nn=Vt(En|0,rn|0,nn|0,qn|0)|0,qn=Vt(Nn|0,ye|0,Vn|0,Cn|0)|0,Cn=ye,Vn=Ye,_[Vn>>2]=0,_[Vn+4>>2]=0,Vn=Vt(Cn>>31>>>6|0,0,qn|0,Cn|0)|0,Nn=qt(Vn|0,ye|0,26)|0,Vn=ye,nn=zt(Nn|0,Vn|0,26)|0,rn=Ut(qn|0,Cn|0,nn|0,ye|0)|0,nn=ye,Cn=Xe,qn=Vt(Nn|0,Vn|0,_[Cn>>2]|0,_[Cn+4>>2]|0)|0,Cn=ye,Vn=xe,Nn=_[Vn>>2]|0,En=_[Vn+4>>2]|0,Vn=Te,hn=_[Vn>>2]|0,xn=_[Vn+4>>2]|0,Vn=ke,tn=_[Vn>>2]|0,mn=_[Vn+4>>2]|0,Vn=he,Hn=_[Vn>>2]|0,wn=_[Vn+4>>2]|0,Vn=be,An=_[Vn>>2]|0,Kn=_[Vn+4>>2]|0,Vn=Re,Sn=_[Vn>>2]|0,Rn=_[Vn+4>>2]|0,Vn=o,un=_[Vn>>2]|0,Mn=_[Vn+4>>2]|0,Vn=Je,Dn=_[Vn>>2]|0,zn=_[Vn+4>>2]|0,Vn=Vt(rn|0,nn|0,fn|0,sn|0)|0,Gn=$,_[Gn>>2]=Vn,_[Gn+4>>2]=ye,Gn=Vt(qn|0,Cn|0,on|0,er|0)|0,Vn=Pe,_[Vn>>2]=Gn,_[Vn+4>>2]=ye,Vn=Ke,Gn=_[Vn>>2]|0,an=_[Vn+4>>2]|0,Vn=Vt(Gn|0,an|0,Nn|0,En|0)|0,cn=xe,_[cn>>2]=Vn,_[cn+4>>2]=ye,cn=ze,Vn=_[cn>>2]|0,Qn=_[cn+4>>2]|0,cn=Vt(Vn|0,Qn|0,hn|0,xn|0)|0,kn=Te,_[kn>>2]=cn,_[kn+4>>2]=ye,kn=He,cn=_[kn>>2]|0,yn=_[kn+4>>2]|0,kn=Vt(cn|0,yn|0,tn|0,mn|0)|0,Fn=ke,_[Fn>>2]=kn,_[Fn+4>>2]=ye,Fn=qe,kn=_[Fn>>2]|0,On=_[Fn+4>>2]|0,Fn=Vt(kn|0,On|0,Hn|0,wn|0)|0,Ln=he,_[Ln>>2]=Fn,_[Ln+4>>2]=ye,Ln=Be,Fn=_[Ln>>2]|0,jn=_[Ln+4>>2]|0,Ln=Vt(Fn|0,jn|0,An|0,Kn|0)|0,Tn=be,_[Tn>>2]=Ln,_[Tn+4>>2]=ye,Tn=Fe,Ln=_[Tn>>2]|0,_n=_[Tn+4>>2]|0,Tn=Vt(Ln|0,_n|0,Sn|0,Rn|0)|0,pn=Re,_[pn>>2]=Tn,_[pn+4>>2]=ye,pn=we,Tn=_[pn>>2]|0,Zn=_[pn+4>>2]|0,pn=Vt(Tn|0,Zn|0,un|0,Mn|0)|0,vn=o,_[vn>>2]=pn,_[vn+4>>2]=ye,vn=Ze,pn=_[vn>>2]|0,Xn=_[vn+4>>2]|0,vn=Vt(pn|0,Xn|0,Dn|0,zn|0)|0,Bn=Je,_[Bn>>2]=vn,_[Bn+4>>2]=ye,Bn=Ut(fn|0,sn|0,rn|0,nn|0)|0,nn=Q,_[nn>>2]=Bn,_[nn+4>>2]=ye,nn=Ut(on|0,er|0,qn|0,Cn|0)|0,Cn=Xe,_[Cn>>2]=nn,_[Cn+4>>2]=ye,Cn=Ut(Nn|0,En|0,Gn|0,an|0)|0,an=Ke,_[an>>2]=Cn,_[an+4>>2]=ye,an=Ut(hn|0,xn|0,Vn|0,Qn|0)|0,Qn=ze,_[Qn>>2]=an,_[Qn+4>>2]=ye,Qn=Ut(tn|0,mn|0,cn|0,yn|0)|0,yn=He,_[yn>>2]=Qn,_[yn+4>>2]=ye,yn=Ut(Hn|0,wn|0,kn|0,On|0)|0,On=qe,_[On>>2]=yn,_[On+4>>2]=ye,On=Ut(An|0,Kn|0,Fn|0,jn|0)|0,jn=Be,_[jn>>2]=On,_[jn+4>>2]=ye,jn=Ut(Sn|0,Rn|0,Ln|0,_n|0)|0,_n=Fe,_[_n>>2]=jn,_[_n+4>>2]=ye,_n=Ut(un|0,Mn|0,Tn|0,Zn|0)|0,Zn=we,_[Zn>>2]=_n,_[Zn+4>>2]=ye,Zn=Ut(Dn|0,zn|0,pn|0,Xn|0)|0,Xn=Ze,_[Xn>>2]=Zn,_[Xn+4>>2]=ye,kt(te,$),kt(ee,Q),Et(Q,ee,ce),Xn=Me,Zn=_[Xn>>2]|0,pn=_[Xn+4>>2]|0,Xn=we,zn=_[Xn>>2]|0,Dn=_[Xn+4>>2]|0,Xn=Jt(Zn|0,pn|0,18,0)|0,_n=ye,Tn=Vt(zn|0,Dn|0,Zn|0,pn|0)|0,pn=Vt(Tn|0,ye|0,Xn|0,_n|0)|0,_n=we,_[_n>>2]=pn,_[_n+4>>2]=ye,_n=Ae,pn=_[_n>>2]|0,Xn=_[_n+4>>2]|0,_n=Fe,Tn=_[_n>>2]|0,Zn=_[_n+4>>2]|0,_n=Jt(pn|0,Xn|0,18,0)|0,Dn=ye,zn=Vt(Tn|0,Zn|0,pn|0,Xn|0)|0,Xn=Vt(zn|0,ye|0,_n|0,Dn|0)|0,Dn=Fe,_[Dn>>2]=Xn,_[Dn+4>>2]=ye,Dn=Oe,Xn=_[Dn>>2]|0,_n=_[Dn+4>>2]|0,Dn=Be,zn=_[Dn>>2]|0,pn=_[Dn+4>>2]|0,Dn=Jt(Xn|0,_n|0,18,0)|0,Zn=ye,Tn=Vt(zn|0,pn|0,Xn|0,_n|0)|0,_n=Vt(Tn|0,ye|0,Dn|0,Zn|0)|0,Zn=Be,_[Zn>>2]=_n,_[Zn+4>>2]=ye,Zn=We,_n=_[Zn>>2]|0,Dn=_[Zn+4>>2]|0,Zn=qe,Tn=_[Zn>>2]|0,Xn=_[Zn+4>>2]|0,Zn=Jt(_n|0,Dn|0,18,0)|0,pn=ye,zn=Vt(Tn|0,Xn|0,_n|0,Dn|0)|0,Dn=Vt(zn|0,ye|0,Zn|0,pn|0)|0,pn=qe,_[pn>>2]=Dn,_[pn+4>>2]=ye,pn=Ve,Dn=_[pn>>2]|0,Zn=_[pn+4>>2]|0,pn=He,zn=_[pn>>2]|0,_n=_[pn+4>>2]|0,pn=Jt(Dn|0,Zn|0,18,0)|0,Xn=ye,Tn=Vt(zn|0,_n|0,Dn|0,Zn|0)|0,Zn=Vt(Tn|0,ye|0,pn|0,Xn|0)|0,Xn=He,_[Xn>>2]=Zn,_[Xn+4>>2]=ye,Xn=Ge,Zn=_[Xn>>2]|0,pn=_[Xn+4>>2]|0,Xn=ze,Tn=_[Xn>>2]|0,Dn=_[Xn+4>>2]|0,Xn=Jt(Zn|0,pn|0,18,0)|0,_n=ye,zn=Vt(Tn|0,Dn|0,Zn|0,pn|0)|0,pn=Vt(zn|0,ye|0,Xn|0,_n|0)|0,_n=ze,_[_n>>2]=pn,_[_n+4>>2]=ye,_n=je,pn=_[_n>>2]|0,Xn=_[_n+4>>2]|0,_n=Ke,zn=_[_n>>2]|0,Zn=_[_n+4>>2]|0,_n=Jt(pn|0,Xn|0,18,0)|0,Dn=ye,Tn=Vt(zn|0,Zn|0,pn|0,Xn|0)|0,Xn=Vt(Tn|0,ye|0,_n|0,Dn|0)|0,Dn=Ke,_[Dn>>2]=Xn,_[Dn+4>>2]=ye,Dn=Qe,Xn=_[Dn>>2]|0,_n=_[Dn+4>>2]|0,Dn=Xe,Tn=_[Dn>>2]|0,pn=_[Dn+4>>2]|0,Dn=Jt(Xn|0,_n|0,18,0)|0,Zn=ye,zn=Vt(Tn|0,pn|0,Xn|0,_n|0)|0,_n=Vt(zn|0,ye|0,Dn|0,Zn|0)|0,Zn=Xe,_[Zn>>2]=_n,_[Zn+4>>2]=ye,Zn=Ye,_n=_[Zn>>2]|0,Dn=_[Zn+4>>2]|0,Zn=Q,zn=_[Zn>>2]|0,Xn=_[Zn+4>>2]|0,Zn=Jt(_n|0,Dn|0,18,0)|0,pn=ye,Tn=Vt(zn|0,Xn|0,_n|0,Dn|0)|0,Dn=Vt(Tn|0,ye|0,Zn|0,pn|0)|0,pn=ye,Zn=Q,_[Zn>>2]=Dn,_[Zn+4>>2]=pn,Zn=Ye,_[Zn>>2]=0,_[Zn+4>>2]=0,Zn=pn,pn=Dn,Dn=0;do Tn=Vt(Zn>>31>>>6|0,0,pn|0,Zn|0)|0,_n=qt(Tn|0,ye|0,26)|0,Tn=ye,Xn=zt(_n|0,Tn|0,26)|0,zn=Ut(pn|0,Zn|0,Xn|0,ye|0)|0,Xn=Q+(Dn<<3)|0,_[Xn>>2]=zn,_[Xn+4>>2]=ye,Xn=Q+((Dn|1)<<3)|0,zn=Xn,Mn=Vt(_n|0,Tn|0,_[zn>>2]|0,_[zn+4>>2]|0)|0,zn=ye,Tn=Vt(zn>>31>>>7|0,0,Mn|0,zn|0)|0,_n=qt(Tn|0,ye|0,25)|0,Tn=ye,un=zt(_n|0,Tn|0,25)|0,jn=Ut(Mn|0,zn|0,un|0,ye|0)|0,un=Xn,_[un>>2]=jn,_[un+4>>2]=ye,Dn=Dn+2|0,un=Q+(Dn<<3)|0,jn=un,pn=Vt(_n|0,Tn|0,_[jn>>2]|0,_[jn+4>>2]|0)|0,Zn=ye,jn=un,_[jn>>2]=pn,_[jn+4>>2]=Zn;while(Dn>>>0<10);Dn=Ye,Zn=_[Dn>>2]|0,pn=_[Dn+4>>2]|0,Dn=Q,er=_[Dn>>2]|0,on=_[Dn+4>>2]|0,Dn=Jt(Zn|0,pn|0,18,0)|0,sn=ye,fn=Vt(er|0,on|0,Zn|0,pn|0)|0,pn=Vt(fn|0,ye|0,Dn|0,sn|0)|0,sn=ye,Dn=Ye,_[Dn>>2]=0,_[Dn+4>>2]=0,Dn=Vt(sn>>31>>>6|0,0,pn|0,sn|0)|0,fn=qt(Dn|0,ye|0,26)|0,Dn=ye,Zn=zt(fn|0,Dn|0,26)|0,on=Ut(pn|0,sn|0,Zn|0,ye|0)|0,Zn=Q,_[Zn>>2]=on,_[Zn+4>>2]=ye,Zn=Xe,on=Vt(fn|0,Dn|0,_[Zn>>2]|0,_[Zn+4>>2]|0)|0,Zn=Xe,_[Zn>>2]=on,_[Zn+4>>2]=ye,fe=Ot,ge=te,r=fe+80|0;do _[fe>>2]=_[ge>>2],fe=fe+4|0,ge=ge+4|0;while((fe|0)<(r|0));fe=Wt,ge=Q,r=fe+80|0;do _[fe>>2]=_[ge>>2],fe=fe+4|0,ge=ge+4|0;while((fe|0)<(r|0));kt(k,jt),kt(x,Qt),Et(Kt,k,x),Zn=Kt+144|0,on=_[Zn>>2]|0,Dn=_[Zn+4>>2]|0,Zn=Kt+64|0,fn=Zn,sn=_[fn>>2]|0,pn=_[fn+4>>2]|0,fn=Jt(on|0,Dn|0,18,0)|0,er=ye,jn=Vt(sn|0,pn|0,on|0,Dn|0)|0,Dn=Vt(jn|0,ye|0,fn|0,er|0)|0,er=Zn,_[er>>2]=Dn,_[er+4>>2]=ye,er=Kt+136|0,Dn=_[er>>2]|0,Zn=_[er+4>>2]|0,er=Kt+56|0,fn=er,jn=_[fn>>2]|0,on=_[fn+4>>2]|0,fn=Jt(Dn|0,Zn|0,18,0)|0,pn=ye,sn=Vt(jn|0,on|0,Dn|0,Zn|0)|0,Zn=Vt(sn|0,ye|0,fn|0,pn|0)|0,pn=er,_[pn>>2]=Zn,_[pn+4>>2]=ye,pn=Kt+128|0,Zn=_[pn>>2]|0,er=_[pn+4>>2]|0,pn=Kt+48|0,fn=pn,sn=_[fn>>2]|0,Dn=_[fn+4>>2]|0,fn=Jt(Zn|0,er|0,18,0)|0,on=ye,jn=Vt(sn|0,Dn|0,Zn|0,er|0)|0,er=Vt(jn|0,ye|0,fn|0,on|0)|0,on=pn,_[on>>2]=er,_[on+4>>2]=ye,on=Kt+120|0,er=_[on>>2]|0,pn=_[on+4>>2]|0,on=Kt+40|0,fn=on,jn=_[fn>>2]|0,Zn=_[fn+4>>2]|0,fn=Jt(er|0,pn|0,18,0)|0,Dn=ye,sn=Vt(jn|0,Zn|0,er|0,pn|0)|0,pn=Vt(sn|0,ye|0,fn|0,Dn|0)|0,Dn=on,_[Dn>>2]=pn,_[Dn+4>>2]=ye,Dn=Kt+112|0,pn=_[Dn>>2]|0,on=_[Dn+4>>2]|0,Dn=Kt+32|0,fn=Dn,sn=_[fn>>2]|0,er=_[fn+4>>2]|0,fn=Jt(pn|0,on|0,18,0)|0,Zn=ye,jn=Vt(sn|0,er|0,pn|0,on|0)|0,on=Vt(jn|0,ye|0,fn|0,Zn|0)|0,Zn=Dn,_[Zn>>2]=on,_[Zn+4>>2]=ye,Zn=Kt+104|0,on=_[Zn>>2]|0,Dn=_[Zn+4>>2]|0,Zn=Kt+24|0,fn=Zn,jn=_[fn>>2]|0,pn=_[fn+4>>2]|0,fn=Jt(on|0,Dn|0,18,0)|0,er=ye,sn=Vt(jn|0,pn|0,on|0,Dn|0)|0,Dn=Vt(sn|0,ye|0,fn|0,er|0)|0,er=Zn,_[er>>2]=Dn,_[er+4>>2]=ye,er=Kt+96|0,Dn=_[er>>2]|0,Zn=_[er+4>>2]|0,er=Kt+16|0,fn=er,sn=_[fn>>2]|0,on=_[fn+4>>2]|0,fn=Jt(Dn|0,Zn|0,18,0)|0,pn=ye,jn=Vt(sn|0,on|0,Dn|0,Zn|0)|0,Zn=Vt(jn|0,ye|0,fn|0,pn|0)|0,pn=er,_[pn>>2]=Zn,_[pn+4>>2]=ye,pn=Kt+88|0,Zn=_[pn>>2]|0,er=_[pn+4>>2]|0,pn=Kt+8|0,fn=pn,jn=_[fn>>2]|0,Dn=_[fn+4>>2]|0,fn=Jt(Zn|0,er|0,18,0)|0,on=ye,sn=Vt(jn|0,Dn|0,Zn|0,er|0)|0,er=Vt(sn|0,ye|0,fn|0,on|0)|0,on=pn,_[on>>2]=er,_[on+4>>2]=ye,on=Kt+80|0,er=on,fn=_[er>>2]|0,sn=_[er+4>>2]|0,er=Kt,Zn=_[er>>2]|0,Dn=_[er+4>>2]|0,er=Jt(fn|0,sn|0,18,0)|0,jn=ye,un=Vt(Zn|0,Dn|0,fn|0,sn|0)|0,sn=Vt(un|0,ye|0,er|0,jn|0)|0,jn=ye,er=Kt,_[er>>2]=sn,_[er+4>>2]=jn,er=on,_[er>>2]=0,_[er+4>>2]=0,er=jn,jn=sn,sn=0;do un=Vt(er>>31>>>6|0,0,jn|0,er|0)|0,fn=qt(un|0,ye|0,26)|0,un=ye,Dn=zt(fn|0,un|0,26)|0,Zn=Ut(jn|0,er|0,Dn|0,ye|0)|0,Dn=Kt+(sn<<3)|0,_[Dn>>2]=Zn,_[Dn+4>>2]=ye,Dn=Kt+((sn|1)<<3)|0,Zn=Dn,Tn=Vt(fn|0,un|0,_[Zn>>2]|0,_[Zn+4>>2]|0)|0,Zn=ye,un=Vt(Zn>>31>>>7|0,0,Tn|0,Zn|0)|0,fn=qt(un|0,ye|0,25)|0,un=ye,_n=zt(fn|0,un|0,25)|0,Xn=Ut(Tn|0,Zn|0,_n|0,ye|0)|0,_n=Dn,_[_n>>2]=Xn,_[_n+4>>2]=ye,sn=sn+2|0,_n=Kt+(sn<<3)|0,Xn=_n,jn=Vt(fn|0,un|0,_[Xn>>2]|0,_[Xn+4>>2]|0)|0,er=ye,Xn=_n,_[Xn>>2]=jn,_[Xn+4>>2]=er;while(sn>>>0<10);sn=on,er=_[sn>>2]|0,jn=_[sn+4>>2]|0,sn=Kt,Xn=_[sn>>2]|0,_n=_[sn+4>>2]|0,sn=Jt(er|0,jn|0,18,0)|0,un=ye,fn=Vt(Xn|0,_n|0,er|0,jn|0)|0,jn=Vt(fn|0,ye|0,sn|0,un|0)|0,un=ye,sn=on,_[sn>>2]=0,_[sn+4>>2]=0,sn=Vt(un>>31>>>6|0,0,jn|0,un|0)|0,fn=qt(sn|0,ye|0,26)|0,sn=ye,er=zt(fn|0,sn|0,26)|0,_n=Ut(jn|0,un|0,er|0,ye|0)|0,er=Kt,_[er>>2]=_n,_[er+4>>2]=ye,er=pn,_n=Vt(fn|0,sn|0,_[er>>2]|0,_[er+4>>2]|0)|0,er=pn,_[er>>2]=_n,_[er+4>>2]=ye,er=k,_n=_[er>>2]|0,sn=_[er+4>>2]|0,er=x,fn=Ut(_n|0,sn|0,_[er>>2]|0,_[er+4>>2]|0)|0,er=ye,un=x,_[un>>2]=fn,_[un+4>>2]=er,un=et,jn=_[un>>2]|0,Xn=_[un+4>>2]|0,un=tt,Dn=Ut(jn|0,Xn|0,_[un>>2]|0,_[un+4>>2]|0)|0,un=ye,Zn=tt,_[Zn>>2]=Dn,_[Zn+4>>2]=un,Zn=nt,Tn=_[Zn>>2]|0,zn=_[Zn+4>>2]|0,Zn=rt,Mn=Ut(Tn|0,zn|0,_[Zn>>2]|0,_[Zn+4>>2]|0)|0,Zn=ye,Ln=rt,_[Ln>>2]=Mn,_[Ln+4>>2]=Zn,Ln=ot,Rn=_[Ln>>2]|0,Sn=_[Ln+4>>2]|0,Ln=at,On=Ut(Rn|0,Sn|0,_[Ln>>2]|0,_[Ln+4>>2]|0)|0,Ln=ye,Fn=at,_[Fn>>2]=On,_[Fn+4>>2]=Ln,Fn=it,Kn=_[Fn>>2]|0,An=_[Fn+4>>2]|0,Fn=lt,yn=Ut(Kn|0,An|0,_[Fn>>2]|0,_[Fn+4>>2]|0)|0,Fn=ye,kn=lt,_[kn>>2]=yn,_[kn+4>>2]=Fn,kn=st,wn=_[kn>>2]|0,Hn=_[kn+4>>2]|0,kn=ut,Qn=Ut(wn|0,Hn|0,_[kn>>2]|0,_[kn+4>>2]|0)|0,kn=ye,cn=ut,_[cn>>2]=Qn,_[cn+4>>2]=kn,cn=ct,mn=_[cn>>2]|0,tn=_[cn+4>>2]|0,cn=dt,an=Ut(mn|0,tn|0,_[cn>>2]|0,_[cn+4>>2]|0)|0,cn=ye,Vn=dt,_[Vn>>2]=an,_[Vn+4>>2]=cn,Vn=mt,xn=_[Vn>>2]|0,hn=_[Vn+4>>2]|0,Vn=pt,Cn=Ut(xn|0,hn|0,_[Vn>>2]|0,_[Vn+4>>2]|0)|0,Vn=ye,Gn=pt,_[Gn>>2]=Cn,_[Gn+4>>2]=Vn,Gn=_t,En=_[Gn>>2]|0,Nn=_[Gn+4>>2]|0,Gn=ft,nn=Ut(En|0,Nn|0,_[Gn>>2]|0,_[Gn+4>>2]|0)|0,Gn=ye,qn=ft,_[qn>>2]=nn,_[qn+4>>2]=Gn,qn=gt,Bn=_[qn>>2]|0,rn=_[qn+4>>2]|0,qn=ht,vn=Ut(Bn|0,rn|0,_[qn>>2]|0,_[qn+4>>2]|0)|0,qn=ye,Wn=ht,_[Wn>>2]=vn,_[Wn+4>>2]=qn,fe=yt,r=fe+72|0;do _[fe>>2]=0,fe=fe+4|0;while((fe|0)<(r|0));pn=Jt(fn|0,er|0,121665,0)|0,on=ye,Wn=C,_[Wn>>2]=pn,_[Wn+4>>2]=on,Wn=Jt(Dn|0,un|0,121665,0)|0,ln=Ct,_[ln>>2]=Wn,_[ln+4>>2]=ye,ln=Jt(Mn|0,Zn|0,121665,0)|0,Wn=bt,_[Wn>>2]=ln,_[Wn+4>>2]=ye,Wn=Jt(On|0,Ln|0,121665,0)|0,ln=vt,_[ln>>2]=Wn,_[ln+4>>2]=ye,ln=Jt(yn|0,Fn|0,121665,0)|0,Wn=St,_[Wn>>2]=ln,_[Wn+4>>2]=ye,Wn=Jt(Qn|0,kn|0,121665,0)|0,ln=Rt,_[ln>>2]=Wn,_[ln+4>>2]=ye,ln=Jt(an|0,cn|0,121665,0)|0,Wn=It,_[Wn>>2]=ln,_[Wn+4>>2]=ye,Wn=Jt(Cn|0,Vn|0,121665,0)|0,ln=Tt,_[ln>>2]=Wn,_[ln+4>>2]=ye,ln=Jt(nn|0,Gn|0,121665,0)|0,Wn=Dt,_[Wn>>2]=ln,_[Wn+4>>2]=ye,Wn=Jt(vn|0,qn|0,121665,0)|0,ln=xt,_[ln>>2]=Wn,_[ln+4>>2]=ye,ln=yt,_[ln>>2]=0,_[ln+4>>2]=0,ln=on,on=pn,pn=0;do Wn=Vt(ln>>31>>>6|0,0,on|0,ln|0)|0,$n=qt(Wn|0,ye|0,26)|0,Wn=ye,Pn=zt($n|0,Wn|0,26)|0,In=Ut(on|0,ln|0,Pn|0,ye|0)|0,Pn=C+(pn<<3)|0,_[Pn>>2]=In,_[Pn+4>>2]=ye,Pn=C+((pn|1)<<3)|0,In=Pn,gn=Vt($n|0,Wn|0,_[In>>2]|0,_[In+4>>2]|0)|0,In=ye,Wn=Vt(In>>31>>>7|0,0,gn|0,In|0)|0,$n=qt(Wn|0,ye|0,25)|0,Wn=ye,Jn=zt($n|0,Wn|0,25)|0,Yn=Ut(gn|0,In|0,Jn|0,ye|0)|0,Jn=Pn,_[Jn>>2]=Yn,_[Jn+4>>2]=ye,pn=pn+2|0,Jn=C+(pn<<3)|0,Yn=Jn,on=Vt($n|0,Wn|0,_[Yn>>2]|0,_[Yn+4>>2]|0)|0,ln=ye,Yn=Jn,_[Yn>>2]=on,_[Yn+4>>2]=ln;while(pn>>>0<10);pn=yt,ln=_[pn>>2]|0,on=_[pn+4>>2]|0,pn=C,qn=_[pn>>2]|0,vn=_[pn+4>>2]|0,pn=Jt(ln|0,on|0,18,0)|0,Gn=ye,nn=Vt(qn|0,vn|0,ln|0,on|0)|0,on=Vt(nn|0,ye|0,pn|0,Gn|0)|0,Gn=ye,pn=yt,_[pn>>2]=0,_[pn+4>>2]=0,pn=Vt(Gn>>31>>>6|0,0,on|0,Gn|0)|0,nn=qt(pn|0,ye|0,26)|0,pn=ye,ln=zt(nn|0,pn|0,26)|0,vn=ye,qn=Ct,Vn=_[qn>>2]|0,Cn=_[qn+4>>2]|0,qn=Vt(on|0,Gn|0,_n|0,sn|0)|0,Gn=Ut(qn|0,ye|0,ln|0,vn|0)|0,vn=C,_[vn>>2]=Gn,_[vn+4>>2]=ye,vn=Vt(Vn|0,Cn|0,jn|0,Xn|0)|0,Cn=Vt(vn|0,ye|0,nn|0,pn|0)|0,pn=Ct,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=bt,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,Tn|0,zn|0)|0,pn=bt,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=vt,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,Rn|0,Sn|0)|0,pn=vt,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=St,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,Kn|0,An|0)|0,pn=St,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=Rt,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,wn|0,Hn|0)|0,pn=Rt,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=It,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,mn|0,tn|0)|0,pn=It,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=Tt,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,xn|0,hn|0)|0,pn=Tt,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=Dt,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,En|0,Nn|0)|0,pn=Dt,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=xt,Cn=Vt(_[pn>>2]|0,_[pn+4>>2]|0,Bn|0,rn|0)|0,pn=xt,_[pn>>2]=Cn,_[pn+4>>2]=ye,Et(Xt,x,C),pn=Xt+144|0,Cn=_[pn>>2]|0,nn=_[pn+4>>2]|0,pn=Xt+64|0,vn=pn,Vn=_[vn>>2]|0,Gn=_[vn+4>>2]|0,vn=Jt(Cn|0,nn|0,18,0)|0,ln=ye,qn=Vt(Vn|0,Gn|0,Cn|0,nn|0)|0,nn=Vt(qn|0,ye|0,vn|0,ln|0)|0,ln=pn,_[ln>>2]=nn,_[ln+4>>2]=ye,ln=Xt+136|0,nn=_[ln>>2]|0,pn=_[ln+4>>2]|0,ln=Xt+56|0,vn=ln,qn=_[vn>>2]|0,Cn=_[vn+4>>2]|0,vn=Jt(nn|0,pn|0,18,0)|0,Gn=ye,Vn=Vt(qn|0,Cn|0,nn|0,pn|0)|0,pn=Vt(Vn|0,ye|0,vn|0,Gn|0)|0,Gn=ln,_[Gn>>2]=pn,_[Gn+4>>2]=ye,Gn=Xt+128|0,pn=_[Gn>>2]|0,ln=_[Gn+4>>2]|0,Gn=Xt+48|0,vn=Gn,Vn=_[vn>>2]|0,nn=_[vn+4>>2]|0,vn=Jt(pn|0,ln|0,18,0)|0,Cn=ye,qn=Vt(Vn|0,nn|0,pn|0,ln|0)|0,ln=Vt(qn|0,ye|0,vn|0,Cn|0)|0,Cn=Gn,_[Cn>>2]=ln,_[Cn+4>>2]=ye,Cn=Xt+120|0,ln=_[Cn>>2]|0,Gn=_[Cn+4>>2]|0,Cn=Xt+40|0,vn=Cn,qn=_[vn>>2]|0,pn=_[vn+4>>2]|0,vn=Jt(ln|0,Gn|0,18,0)|0,nn=ye,Vn=Vt(qn|0,pn|0,ln|0,Gn|0)|0,Gn=Vt(Vn|0,ye|0,vn|0,nn|0)|0,nn=Cn,_[nn>>2]=Gn,_[nn+4>>2]=ye,nn=Xt+112|0,Gn=_[nn>>2]|0,Cn=_[nn+4>>2]|0,nn=Xt+32|0,vn=nn,Vn=_[vn>>2]|0,ln=_[vn+4>>2]|0,vn=Jt(Gn|0,Cn|0,18,0)|0,pn=ye,qn=Vt(Vn|0,ln|0,Gn|0,Cn|0)|0,Cn=Vt(qn|0,ye|0,vn|0,pn|0)|0,pn=nn,_[pn>>2]=Cn,_[pn+4>>2]=ye,pn=Xt+104|0,Cn=_[pn>>2]|0,nn=_[pn+4>>2]|0,pn=Xt+24|0,vn=pn,qn=_[vn>>2]|0,Gn=_[vn+4>>2]|0,vn=Jt(Cn|0,nn|0,18,0)|0,ln=ye,Vn=Vt(qn|0,Gn|0,Cn|0,nn|0)|0,nn=Vt(Vn|0,ye|0,vn|0,ln|0)|0,ln=pn,_[ln>>2]=nn,_[ln+4>>2]=ye,ln=Xt+96|0,nn=_[ln>>2]|0,pn=_[ln+4>>2]|0,ln=Xt+16|0,vn=ln,Vn=_[vn>>2]|0,Cn=_[vn+4>>2]|0,vn=Jt(nn|0,pn|0,18,0)|0,Gn=ye,qn=Vt(Vn|0,Cn|0,nn|0,pn|0)|0,pn=Vt(qn|0,ye|0,vn|0,Gn|0)|0,Gn=ln,_[Gn>>2]=pn,_[Gn+4>>2]=ye,Gn=Xt+88|0,pn=_[Gn>>2]|0,ln=_[Gn+4>>2]|0,Gn=Xt+8|0,vn=Gn,qn=_[vn>>2]|0,nn=_[vn+4>>2]|0,vn=Jt(pn|0,ln|0,18,0)|0,Cn=ye,Vn=Vt(qn|0,nn|0,pn|0,ln|0)|0,ln=Vt(Vn|0,ye|0,vn|0,Cn|0)|0,Cn=Gn,_[Cn>>2]=ln,_[Cn+4>>2]=ye,Cn=Xt+80|0,ln=Cn,vn=_[ln>>2]|0,Vn=_[ln+4>>2]|0,ln=Xt,pn=_[ln>>2]|0,nn=_[ln+4>>2]|0,ln=Jt(vn|0,Vn|0,18,0)|0,qn=ye,on=Vt(pn|0,nn|0,vn|0,Vn|0)|0,Vn=Vt(on|0,ye|0,ln|0,qn|0)|0,qn=ye,ln=Xt,_[ln>>2]=Vn,_[ln+4>>2]=qn,ln=Cn,_[ln>>2]=0,_[ln+4>>2]=0,ln=qn,qn=Vn,Vn=0;do on=Vt(ln>>31>>>6|0,0,qn|0,ln|0)|0,vn=qt(on|0,ye|0,26)|0,on=ye,nn=zt(vn|0,on|0,26)|0,pn=Ut(qn|0,ln|0,nn|0,ye|0)|0,nn=Xt+(Vn<<3)|0,_[nn>>2]=pn,_[nn+4>>2]=ye,nn=Xt+((Vn|1)<<3)|0,pn=nn,cn=Vt(vn|0,on|0,_[pn>>2]|0,_[pn+4>>2]|0)|0,pn=ye,on=Vt(pn>>31>>>7|0,0,cn|0,pn|0)|0,vn=qt(on|0,ye|0,25)|0,on=ye,an=zt(vn|0,on|0,25)|0,kn=Ut(cn|0,pn|0,an|0,ye|0)|0,an=nn,_[an>>2]=kn,_[an+4>>2]=ye,Vn=Vn+2|0,an=Xt+(Vn<<3)|0,kn=an,qn=Vt(vn|0,on|0,_[kn>>2]|0,_[kn+4>>2]|0)|0,ln=ye,kn=an,_[kn>>2]=qn,_[kn+4>>2]=ln;while(Vn>>>0<10);Vn=Cn,ln=_[Vn>>2]|0,qn=_[Vn+4>>2]|0,Vn=Xt,rn=_[Vn>>2]|0,Bn=_[Vn+4>>2]|0,Vn=Jt(ln|0,qn|0,18,0)|0,Nn=ye,En=Vt(rn|0,Bn|0,ln|0,qn|0)|0,qn=Vt(En|0,ye|0,Vn|0,Nn|0)|0,Nn=ye,Vn=Cn,_[Vn>>2]=0,_[Vn+4>>2]=0,Vn=Vt(Nn>>31>>>6|0,0,qn|0,Nn|0)|0,En=qt(Vn|0,ye|0,26)|0,Vn=ye,ln=zt(En|0,Vn|0,26)|0,Bn=Ut(qn|0,Nn|0,ln|0,ye|0)|0,ln=Xt,_[ln>>2]=Bn,_[ln+4>>2]=ye,ln=Gn,Bn=Vt(En|0,Vn|0,_[ln>>2]|0,_[ln+4>>2]|0)|0,ln=Gn,_[ln>>2]=Bn,_[ln+4>>2]=ye,ln=0;do Bn=Kt+(ln<<3)|0,Vn=Bn,En=_[Vn>>2]|0,Nn=_[Vn+4>>2]|0,Vn=Ot+(ln<<3)|0,qn=Vn,rn=_[qn>>2]|0,hn=_[qn+4>>2]|0,qn=(rn^En)&Zt,xn=(hn^Nn)&en,Nn=qt(0,qn^En|0,32)|0,En=Bn,_[En>>2]=Nn,_[En+4>>2]=ye,En=qt(0,qn^rn|0,32)|0,rn=Vn,_[rn>>2]=En,_[rn+4>>2]=ye,ln=ln+1|0;while((ln|0)!=10);tr=0;do ln=Xt+(tr<<3)|0,Gn=ln,Cn=_[Gn>>2]|0,rn=_[Gn+4>>2]|0,Gn=Wt+(tr<<3)|0,En=Gn,Vn=_[En>>2]|0,qn=_[En+4>>2]|0,En=(Vn^Cn)&Zt,Nn=(qn^rn)&en,rn=qt(0,En^Cn|0,32)|0,Cn=ln,_[Cn>>2]=rn,_[Cn+4>>2]=ye,Cn=qt(0,En^Vn|0,32)|0,Vn=Gn,_[Vn>>2]=Cn,_[Vn+4>>2]=ye,tr=tr+1|0;while((tr|0)!=10);if(At=At+1|0,(At|0)==8){nr=Ft,rr=Ot,or=Bt,ar=Wt,ir=jt,lr=Kt,sr=Qt,ur=Xt;break}else en=Xt,Zt=Kt,Vn=Wt,Cn=Ot,ue=Yt<<1&255,Xt=Qt,Qt=en,Kt=jt,jt=Zt,Wt=Bt,Bt=Vn,Ot=Ft,Ft=Cn}if(Ft=$t+1|0,(Ft|0)==32){cr=lr,dr=ur;break}else $t=Ft,Pt=rr,Nt=nr,ie=ar,Mt=or,le=lr,wt=ir,se=ur,ae=sr}fe=de,ge=cr,r=fe+80|0;do _[fe>>2]=_[ge>>2],fe=fe+4|0,ge=ge+4|0;while((fe|0)<(r|0));fe=me,ge=dr,r=fe+80|0;do _[fe>>2]=_[ge>>2],fe=fe+4|0,ge=ge+4|0;while((fe|0)<(r|0));kt(C,me),kt(oe,C),kt(re,oe),Lt(k,re,me),Lt(x,k,C),kt(re,x),Lt($,re,k),kt(re,$),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),Lt(Q,re,$),kt(re,Q),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),Lt(ee,oe,Q),kt(re,ee),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),Lt(re,oe,ee),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),Lt(te,re,Q),kt(re,te),kt(oe,re),Q=2;do kt(re,oe),kt(oe,re),Q=Q+2|0;while((Q|0)<50);Lt(ne,oe,te),kt(oe,ne),kt(re,oe),Q=2;do kt(oe,re),kt(re,oe),Q=Q+2|0;while((Q|0)<100);Lt(oe,re,ne),kt(re,oe),kt(oe,re),ne=2;do kt(re,oe),kt(oe,re),ne=ne+2|0;while((ne|0)<50);for(Lt(re,oe,te),kt(oe,re),kt(re,oe),kt(oe,re),kt(re,oe),kt(oe,re),Lt(pe,oe,x),Lt(me,de,pe),pe=_[me>>2]|0,_[C>>2]=pe,de=C+4|0,_[de>>2]=_[me+8>>2],x=C+8|0,_[x>>2]=_[me+16>>2],oe=C+12|0,_[oe>>2]=_[me+24>>2],re=C+16|0,_[re>>2]=_[me+32>>2],te=C+20|0,_[te>>2]=_[me+40>>2],ne=C+24|0,_[ne>>2]=_[me+48>>2],Q=C+28|0,_[Q>>2]=_[me+56>>2],ee=C+32|0,_[ee>>2]=_[me+64>>2],$=C+36|0,_[$>>2]=_[me+72>>2],me=pe,pe=0;k=C+(pe<<2)|0,ge=me>>31&me,pe&1?(r=ge>>25,_[k>>2]=(Ue(r,-33554432)|0)+me,k=pe+1|0,ge=C+(k<<2)|0,cr=(_[ge>>2]|0)+r|0,_[ge>>2]=cr,mr=cr,pr=k):(fe=ge>>26,_[k>>2]=(Ue(fe,-67108864)|0)+me,r=pe+1|0,dr=C+(r<<2)|0,cr=(_[dr>>2]|0)+fe|0,_[dr>>2]=cr,mr=cr,pr=r),(pr|0)!=9;)me=mr,pe=pr;for(pr=_[$>>2]|0,pe=(pr>>31&pr)>>25,_[$>>2]=(Ue(pe,-33554432)|0)+pr,pr=(pe*19|0)+(_[C>>2]|0)|0,_[C>>2]=pr,pe=pr,pr=0;mr=C+(pr<<2)|0,me=pe>>31&pe,pr&1?(r=me>>25,_[mr>>2]=(Ue(r,-33554432)|0)+pe,mr=pr+1|0,me=C+(mr<<2)|0,cr=(_[me>>2]|0)+r|0,_[me>>2]=cr,_r=mr,fr=cr):(k=me>>26,_[mr>>2]=(Ue(k,-67108864)|0)+pe,cr=pr+1|0,ge=C+(cr<<2)|0,r=(_[ge>>2]|0)+k|0,_[ge>>2]=r,_r=cr,fr=r),(_r|0)!=9;)pe=fr,pr=_r;for(_r=_[$>>2]|0,pr=(_r>>31&_r)>>25,_[$>>2]=(Ue(pr,-33554432)|0)+_r,_r=(pr*19|0)+(_[C>>2]|0)|0,pr=(_r>>31&_r)>>26,fr=(Ue(pr,-67108864)|0)+_r|0,_[C>>2]=fr,_[de>>2]=pr+(_[de>>2]|0),pr=fr,fr=0;_r=C+(fr<<2)|0,fr&1?(_[_r>>2]=pr&33554431,_r=fr+1|0,mr=C+(_r<<2)|0,pe=(_[mr>>2]|0)+(pr>>25)|0,_[mr>>2]=pe,gr=_r,hr=pe):(_[_r>>2]=pr&67108863,pe=fr+1|0,cr=C+(pe<<2)|0,mr=(_[cr>>2]|0)+(pr>>26)|0,_[cr>>2]=mr,gr=pe,hr=mr),(gr|0)!=9;)pr=hr,fr=gr;for(gr=_[$>>2]|0,_[$>>2]=gr&33554431,fr=((gr>>25)*19|0)+(_[C>>2]|0)|0,_[C>>2]=fr,gr=fr,fr=0;hr=C+(fr<<2)|0,fr&1?(_[hr>>2]=gr&33554431,hr=fr+1|0,_r=C+(hr<<2)|0,pr=(_[_r>>2]|0)+(gr>>25)|0,_[_r>>2]=pr,yr=hr,Cr=pr):(_[hr>>2]=gr&67108863,pr=fr+1|0,pe=C+(pr<<2)|0,_r=(_[pe>>2]|0)+(gr>>26)|0,_[pe>>2]=_r,yr=pr,Cr=_r),(yr|0)!=9;)gr=Cr,fr=yr;for(yr=_[$>>2]|0,fr=yr&33554431,_[$>>2]=fr,Cr=((yr>>25)*19|0)+(_[C>>2]|0)|0,_[C>>2]=Cr,yr=1,gr=~(Cr+-67108845>>31);;)if(pr=_[C+(yr<<2)>>2]|0,yr&1?(_r=pr<<16&(pr^-33554432),pr=_r<<8&_r,_r=pr<<4&pr,pr=_r<<2&_r,br=pr<<1&pr):(hr=pr<<16&(pr^-67108864),_r=hr<<8&hr,hr=_r<<4&_r,_r=hr<<2&hr,br=_r<<1&_r),pr=br>>31&gr,yr=yr+1|0,(yr|0)==10){vr=pr;break}else gr=pr;return gr=Cr-(vr&67108845)|0,_[C>>2]=gr,C=vr&67108863,Cr=vr&33554431,yr=(_[de>>2]|0)-Cr|0,br=yr<<2,pr=(_[x>>2]|0)-C|0,_r=pr<<3,hr=(_[oe>>2]|0)-Cr|0,pe=hr<<5,mr=(_[re>>2]|0)-vr|0,vr=mr<<6,cr=(_[te>>2]|0)-Cr|0,_[te>>2]=cr,te=(_[ne>>2]|0)-C|0,me=te<<1,r=(_[Q>>2]|0)-Cr|0,ge=r<<3,k=(_[ee>>2]|0)-C<<4,_[de>>2]=br,_[x>>2]=_r,_[oe>>2]=pe,_[re>>2]=vr,_[ne>>2]=me,_[Q>>2]=ge,_[ee>>2]=k,_[$>>2]=fr-Cr<<6,i[t>>0]=gr,i[t+1>>0]=gr>>>8,i[t+2>>0]=gr>>>16,i[t+3>>0]=br|gr>>>24,i[t+4>>0]=yr>>>6,i[t+5>>0]=yr>>>14,i[t+6>>0]=_r|yr>>>22,i[t+7>>0]=pr>>>5,i[t+8>>0]=pr>>>13,i[t+9>>0]=pe|pr>>>21,i[t+10>>0]=hr>>>3,i[t+11>>0]=hr>>>11,i[t+12>>0]=vr|hr>>>19,i[t+13>>0]=mr>>>2,i[t+14>>0]=mr>>>10,i[t+15>>0]=mr>>>18,i[t+16>>0]=cr,i[t+17>>0]=cr>>>8,i[t+18>>0]=cr>>>16,i[t+19>>0]=cr>>>24|me,i[t+20>>0]=te>>>7,i[t+21>>0]=te>>>15,i[t+22>>0]=te>>>23|ge,i[t+23>>0]=r>>>5,i[t+24>>0]=r>>>13,ge=_[ee>>2]|0,i[t+25>>0]=r>>>21|ge,i[t+26>>0]=ge>>>8,i[t+27>>0]=ge>>>16,r=_[$>>2]|0,i[t+28>>0]=ge>>>24|r,i[t+29>>0]=r>>>8,i[t+30>>0]=r>>>16,i[t+31>>0]=r>>>24,j=s,0}function Lt(t,r,o){t=t|0,r=r|0,o=o|0;var i=0,s=0,g=0,C=0,k=0,x=0,$=0,Q=0,ee=0,te=0,ne=0,re=0;i=j,j=j+160|0,s=i,Et(s,r,o),o=s+144|0,r=_[o>>2]|0,g=_[o+4>>2]|0,o=s+64|0,C=o,k=_[C>>2]|0,x=_[C+4>>2]|0,C=Jt(r|0,g|0,18,0)|0,$=ye,Q=Vt(k|0,x|0,r|0,g|0)|0,g=Vt(Q|0,ye|0,C|0,$|0)|0,$=o,_[$>>2]=g,_[$+4>>2]=ye,$=s+136|0,g=_[$>>2]|0,o=_[$+4>>2]|0,$=s+56|0,C=$,Q=_[C>>2]|0,r=_[C+4>>2]|0,C=Jt(g|0,o|0,18,0)|0,x=ye,k=Vt(Q|0,r|0,g|0,o|0)|0,o=Vt(k|0,ye|0,C|0,x|0)|0,x=$,_[x>>2]=o,_[x+4>>2]=ye,x=s+128|0,o=_[x>>2]|0,$=_[x+4>>2]|0,x=s+48|0,C=x,k=_[C>>2]|0,g=_[C+4>>2]|0,C=Jt(o|0,$|0,18,0)|0,r=ye,Q=Vt(k|0,g|0,o|0,$|0)|0,$=Vt(Q|0,ye|0,C|0,r|0)|0,r=x,_[r>>2]=$,_[r+4>>2]=ye,r=s+120|0,$=_[r>>2]|0,x=_[r+4>>2]|0,r=s+40|0,C=r,Q=_[C>>2]|0,o=_[C+4>>2]|0,C=Jt($|0,x|0,18,0)|0,g=ye,k=Vt(Q|0,o|0,$|0,x|0)|0,x=Vt(k|0,ye|0,C|0,g|0)|0,g=r,_[g>>2]=x,_[g+4>>2]=ye,g=s+112|0,x=_[g>>2]|0,r=_[g+4>>2]|0,g=s+32|0,C=g,k=_[C>>2]|0,$=_[C+4>>2]|0,C=Jt(x|0,r|0,18,0)|0,o=ye,Q=Vt(k|0,$|0,x|0,r|0)|0,r=Vt(Q|0,ye|0,C|0,o|0)|0,o=g,_[o>>2]=r,_[o+4>>2]=ye,o=s+104|0,r=_[o>>2]|0,g=_[o+4>>2]|0,o=s+24|0,C=o,Q=_[C>>2]|0,x=_[C+4>>2]|0,C=Jt(r|0,g|0,18,0)|0,$=ye,k=Vt(Q|0,x|0,r|0,g|0)|0,g=Vt(k|0,ye|0,C|0,$|0)|0,$=o,_[$>>2]=g,_[$+4>>2]=ye,$=s+96|0,g=_[$>>2]|0,o=_[$+4>>2]|0,$=s+16|0,C=$,k=_[C>>2]|0,r=_[C+4>>2]|0,C=Jt(g|0,o|0,18,0)|0,x=ye,Q=Vt(k|0,r|0,g|0,o|0)|0,o=Vt(Q|0,ye|0,C|0,x|0)|0,x=$,_[x>>2]=o,_[x+4>>2]=ye,x=s+88|0,o=_[x>>2]|0,$=_[x+4>>2]|0,x=s+8|0,C=x,Q=_[C>>2]|0,g=_[C+4>>2]|0,C=Jt(o|0,$|0,18,0)|0,r=ye,k=Vt(Q|0,g|0,o|0,$|0)|0,$=Vt(k|0,ye|0,C|0,r|0)|0,r=x,_[r>>2]=$,_[r+4>>2]=ye,r=s+80|0,$=r,C=_[$>>2]|0,k=_[$+4>>2]|0,$=s,o=_[$>>2]|0,g=_[$+4>>2]|0,$=Jt(C|0,k|0,18,0)|0,Q=ye,ee=Vt(o|0,g|0,C|0,k|0)|0,k=Vt(ee|0,ye|0,$|0,Q|0)|0,Q=ye,$=s,_[$>>2]=k,_[$+4>>2]=Q,$=r,_[$>>2]=0,_[$+4>>2]=0,$=Q,Q=k,k=0;do ee=Vt($>>31>>>6|0,0,Q|0,$|0)|0,C=qt(ee|0,ye|0,26)|0,ee=ye,g=zt(C|0,ee|0,26)|0,o=Ut(Q|0,$|0,g|0,ye|0)|0,g=s+(k<<3)|0,_[g>>2]=o,_[g+4>>2]=ye,g=s+((k|1)<<3)|0,o=g,te=Vt(C|0,ee|0,_[o>>2]|0,_[o+4>>2]|0)|0,o=ye,ee=Vt(o>>31>>>7|0,0,te|0,o|0)|0,C=qt(ee|0,ye|0,25)|0,ee=ye,ne=zt(C|0,ee|0,25)|0,re=Ut(te|0,o|0,ne|0,ye|0)|0,ne=g,_[ne>>2]=re,_[ne+4>>2]=ye,k=k+2|0,ne=s+(k<<3)|0,re=ne,Q=Vt(C|0,ee|0,_[re>>2]|0,_[re+4>>2]|0)|0,$=ye,re=ne,_[re>>2]=Q,_[re+4>>2]=$;while(k>>>0<10);k=r,$=_[k>>2]|0,Q=_[k+4>>2]|0,k=s,re=_[k>>2]|0,ne=_[k+4>>2]|0,k=Jt($|0,Q|0,18,0)|0,ee=ye,C=Vt(re|0,ne|0,$|0,Q|0)|0,Q=Vt(C|0,ye|0,k|0,ee|0)|0,ee=ye,k=r,_[k>>2]=0,_[k+4>>2]=0,k=Vt(ee>>31>>>6|0,0,Q|0,ee|0)|0,r=qt(k|0,ye|0,26)|0,k=ye,C=zt(r|0,k|0,26)|0,$=Ut(Q|0,ee|0,C|0,ye|0)|0,C=s,_[C>>2]=$,_[C+4>>2]=ye,C=x,$=Vt(r|0,k|0,_[C>>2]|0,_[C+4>>2]|0)|0,C=x,_[C>>2]=$,_[C+4>>2]=ye,C=t,t=s,s=C+80|0;do _[C>>2]=_[t>>2],C=C+4|0,t=t+4|0;while((C|0)<(s|0));j=i}function Et(t,r,o){t=t|0,r=r|0,o=o|0;var i=0,s=0,g=0,C=0,k=0,x=0,$=0,j=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0,pe=0;i=qt(0,_[r>>2]|0,32)|0,s=ye,g=qt(0,_[o>>2]|0,32)|0,C=Jt(g|0,ye|0,i|0,s|0)|0,s=t,_[s>>2]=C,_[s+4>>2]=ye,s=qt(0,_[r>>2]|0,32)|0,C=ye,i=o+8|0,g=qt(0,_[i>>2]|0,32)|0,k=Jt(g|0,ye|0,s|0,C|0)|0,C=ye,s=r+8|0,g=qt(0,_[s>>2]|0,32)|0,x=ye,$=qt(0,_[o>>2]|0,32)|0,j=Jt($|0,ye|0,g|0,x|0)|0,x=Vt(j|0,ye|0,k|0,C|0)|0,C=t+8|0,_[C>>2]=x,_[C+4>>2]=ye,C=qt(0,_[s>>2]|0,31)|0,x=ye,k=qt(0,_[i>>2]|0,32)|0,j=Jt(k|0,ye|0,C|0,x|0)|0,x=ye,C=qt(0,_[r>>2]|0,32)|0,k=ye,g=o+16|0,$=qt(0,_[g>>2]|0,32)|0,Q=Jt($|0,ye|0,C|0,k|0)|0,k=Vt(Q|0,ye|0,j|0,x|0)|0,x=ye,j=r+16|0,Q=qt(0,_[j>>2]|0,32)|0,C=ye,$=qt(0,_[o>>2]|0,32)|0,ee=Jt($|0,ye|0,Q|0,C|0)|0,C=Vt(k|0,x|0,ee|0,ye|0)|0,ee=t+16|0,_[ee>>2]=C,_[ee+4>>2]=ye,ee=qt(0,_[s>>2]|0,32)|0,C=ye,x=qt(0,_[g>>2]|0,32)|0,k=Jt(x|0,ye|0,ee|0,C|0)|0,C=ye,ee=qt(0,_[j>>2]|0,32)|0,x=ye,Q=qt(0,_[i>>2]|0,32)|0,$=Jt(Q|0,ye|0,ee|0,x|0)|0,x=Vt($|0,ye|0,k|0,C|0)|0,C=ye,k=qt(0,_[r>>2]|0,32)|0,$=ye,ee=o+24|0,Q=qt(0,_[ee>>2]|0,32)|0,te=Jt(Q|0,ye|0,k|0,$|0)|0,$=Vt(x|0,C|0,te|0,ye|0)|0,te=ye,C=r+24|0,x=qt(0,_[C>>2]|0,32)|0,k=ye,Q=qt(0,_[o>>2]|0,32)|0,ne=Jt(Q|0,ye|0,x|0,k|0)|0,k=Vt($|0,te|0,ne|0,ye|0)|0,ne=t+24|0,_[ne>>2]=k,_[ne+4>>2]=ye,ne=qt(0,_[j>>2]|0,32)|0,k=ye,te=qt(0,_[g>>2]|0,32)|0,$=Jt(te|0,ye|0,ne|0,k|0)|0,k=ye,ne=qt(0,_[s>>2]|0,32)|0,te=ye,x=qt(0,_[ee>>2]|0,32)|0,Q=Jt(x|0,ye|0,ne|0,te|0)|0,te=ye,ne=qt(0,_[C>>2]|0,32)|0,x=ye,re=qt(0,_[i>>2]|0,32)|0,oe=Jt(re|0,ye|0,ne|0,x|0)|0,x=Vt(oe|0,ye|0,Q|0,te|0)|0,te=zt(x|0,ye|0,1)|0,x=Vt(te|0,ye|0,$|0,k|0)|0,k=ye,$=qt(0,_[r>>2]|0,32)|0,te=ye,Q=o+32|0,oe=qt(0,_[Q>>2]|0,32)|0,ne=Jt(oe|0,ye|0,$|0,te|0)|0,te=Vt(x|0,k|0,ne|0,ye|0)|0,ne=ye,k=r+32|0,x=qt(0,_[k>>2]|0,32)|0,$=ye,oe=qt(0,_[o>>2]|0,32)|0,re=Jt(oe|0,ye|0,x|0,$|0)|0,$=Vt(te|0,ne|0,re|0,ye|0)|0,re=t+32|0,_[re>>2]=$,_[re+4>>2]=ye,re=qt(0,_[j>>2]|0,32)|0,$=ye,ne=qt(0,_[ee>>2]|0,32)|0,te=Jt(ne|0,ye|0,re|0,$|0)|0,$=ye,re=qt(0,_[C>>2]|0,32)|0,ne=ye,x=qt(0,_[g>>2]|0,32)|0,oe=Jt(x|0,ye|0,re|0,ne|0)|0,ne=Vt(oe|0,ye|0,te|0,$|0)|0,$=ye,te=qt(0,_[s>>2]|0,32)|0,oe=ye,re=qt(0,_[Q>>2]|0,32)|0,x=Jt(re|0,ye|0,te|0,oe|0)|0,oe=Vt(ne|0,$|0,x|0,ye|0)|0,x=ye,$=qt(0,_[k>>2]|0,32)|0,ne=ye,te=qt(0,_[i>>2]|0,32)|0,re=Jt(te|0,ye|0,$|0,ne|0)|0,ne=Vt(oe|0,x|0,re|0,ye|0)|0,re=ye,x=qt(0,_[r>>2]|0,32)|0,oe=ye,$=o+40|0,te=qt(0,_[$>>2]|0,32)|0,ae=Jt(te|0,ye|0,x|0,oe|0)|0,oe=Vt(ne|0,re|0,ae|0,ye|0)|0,ae=ye,re=r+40|0,ne=qt(0,_[re>>2]|0,32)|0,x=ye,te=qt(0,_[o>>2]|0,32)|0,ie=Jt(te|0,ye|0,ne|0,x|0)|0,x=Vt(oe|0,ae|0,ie|0,ye|0)|0,ie=t+40|0,_[ie>>2]=x,_[ie+4>>2]=ye,ie=qt(0,_[C>>2]|0,32)|0,x=ye,ae=qt(0,_[ee>>2]|0,32)|0,oe=Jt(ae|0,ye|0,ie|0,x|0)|0,x=ye,ie=qt(0,_[s>>2]|0,32)|0,ae=ye,ne=qt(0,_[$>>2]|0,32)|0,te=Jt(ne|0,ye|0,ie|0,ae|0)|0,ae=Vt(te|0,ye|0,oe|0,x|0)|0,x=ye,oe=qt(0,_[re>>2]|0,32)|0,te=ye,ie=qt(0,_[i>>2]|0,32)|0,ne=Jt(ie|0,ye|0,oe|0,te|0)|0,te=Vt(ae|0,x|0,ne|0,ye|0)|0,ne=zt(te|0,ye|0,1)|0,te=ye,x=qt(0,_[j>>2]|0,32)|0,ae=ye,oe=qt(0,_[Q>>2]|0,32)|0,ie=Jt(oe|0,ye|0,x|0,ae|0)|0,ae=Vt(ne|0,te|0,ie|0,ye|0)|0,ie=ye,te=qt(0,_[k>>2]|0,32)|0,ne=ye,x=qt(0,_[g>>2]|0,32)|0,oe=Jt(x|0,ye|0,te|0,ne|0)|0,ne=Vt(ae|0,ie|0,oe|0,ye|0)|0,oe=ye,ie=qt(0,_[r>>2]|0,32)|0,ae=ye,te=o+48|0,x=qt(0,_[te>>2]|0,32)|0,le=Jt(x|0,ye|0,ie|0,ae|0)|0,ae=Vt(ne|0,oe|0,le|0,ye|0)|0,le=ye,oe=r+48|0,ne=qt(0,_[oe>>2]|0,32)|0,ie=ye,x=qt(0,_[o>>2]|0,32)|0,se=Jt(x|0,ye|0,ne|0,ie|0)|0,ie=Vt(ae|0,le|0,se|0,ye|0)|0,se=t+48|0,_[se>>2]=ie,_[se+4>>2]=ye,se=qt(0,_[C>>2]|0,32)|0,ie=ye,le=qt(0,_[Q>>2]|0,32)|0,ae=Jt(le|0,ye|0,se|0,ie|0)|0,ie=ye,se=qt(0,_[k>>2]|0,32)|0,le=ye,ne=qt(0,_[ee>>2]|0,32)|0,x=Jt(ne|0,ye|0,se|0,le|0)|0,le=Vt(x|0,ye|0,ae|0,ie|0)|0,ie=ye,ae=qt(0,_[j>>2]|0,32)|0,x=ye,se=qt(0,_[$>>2]|0,32)|0,ne=Jt(se|0,ye|0,ae|0,x|0)|0,x=Vt(le|0,ie|0,ne|0,ye|0)|0,ne=ye,ie=qt(0,_[re>>2]|0,32)|0,le=ye,ae=qt(0,_[g>>2]|0,32)|0,se=Jt(ae|0,ye|0,ie|0,le|0)|0,le=Vt(x|0,ne|0,se|0,ye|0)|0,se=ye,ne=qt(0,_[s>>2]|0,32)|0,x=ye,ie=qt(0,_[te>>2]|0,32)|0,ae=Jt(ie|0,ye|0,ne|0,x|0)|0,x=Vt(le|0,se|0,ae|0,ye|0)|0,ae=ye,se=qt(0,_[oe>>2]|0,32)|0,le=ye,ne=qt(0,_[i>>2]|0,32)|0,ie=Jt(ne|0,ye|0,se|0,le|0)|0,le=Vt(x|0,ae|0,ie|0,ye|0)|0,ie=ye,ae=qt(0,_[r>>2]|0,32)|0,x=ye,se=o+56|0,ne=qt(0,_[se>>2]|0,32)|0,ue=Jt(ne|0,ye|0,ae|0,x|0)|0,x=Vt(le|0,ie|0,ue|0,ye|0)|0,ue=ye,ie=r+56|0,le=qt(0,_[ie>>2]|0,32)|0,ae=ye,ne=qt(0,_[o>>2]|0,32)|0,ce=Jt(ne|0,ye|0,le|0,ae|0)|0,ae=Vt(x|0,ue|0,ce|0,ye|0)|0,ce=t+56|0,_[ce>>2]=ae,_[ce+4>>2]=ye,ce=qt(0,_[k>>2]|0,32)|0,ae=ye,ue=qt(0,_[Q>>2]|0,32)|0,x=Jt(ue|0,ye|0,ce|0,ae|0)|0,ae=ye,ce=qt(0,_[C>>2]|0,32)|0,ue=ye,le=qt(0,_[$>>2]|0,32)|0,ne=Jt(le|0,ye|0,ce|0,ue|0)|0,ue=ye,ce=qt(0,_[re>>2]|0,32)|0,le=ye,de=qt(0,_[ee>>2]|0,32)|0,me=Jt(de|0,ye|0,ce|0,le|0)|0,le=Vt(me|0,ye|0,ne|0,ue|0)|0,ue=ye,ne=qt(0,_[s>>2]|0,32)|0,me=ye,ce=qt(0,_[se>>2]|0,32)|0,de=Jt(ce|0,ye|0,ne|0,me|0)|0,me=Vt(le|0,ue|0,de|0,ye|0)|0,de=ye,ue=qt(0,_[ie>>2]|0,32)|0,le=ye,ne=qt(0,_[i>>2]|0,32)|0,ce=Jt(ne|0,ye|0,ue|0,le|0)|0,le=Vt(me|0,de|0,ce|0,ye|0)|0,ce=zt(le|0,ye|0,1)|0,le=Vt(ce|0,ye|0,x|0,ae|0)|0,ae=ye,x=qt(0,_[j>>2]|0,32)|0,ce=ye,de=qt(0,_[te>>2]|0,32)|0,me=Jt(de|0,ye|0,x|0,ce|0)|0,ce=Vt(le|0,ae|0,me|0,ye|0)|0,me=ye,ae=qt(0,_[oe>>2]|0,32)|0,le=ye,x=qt(0,_[g>>2]|0,32)|0,de=Jt(x|0,ye|0,ae|0,le|0)|0,le=Vt(ce|0,me|0,de|0,ye|0)|0,de=ye,me=qt(0,_[r>>2]|0,32)|0,ce=ye,ae=o+64|0,x=qt(0,_[ae>>2]|0,32)|0,ue=Jt(x|0,ye|0,me|0,ce|0)|0,ce=Vt(le|0,de|0,ue|0,ye|0)|0,ue=ye,de=r+64|0,le=qt(0,_[de>>2]|0,32)|0,me=ye,x=qt(0,_[o>>2]|0,32)|0,ne=Jt(x|0,ye|0,le|0,me|0)|0,me=Vt(ce|0,ue|0,ne|0,ye|0)|0,ne=t+64|0,_[ne>>2]=me,_[ne+4>>2]=ye,ne=qt(0,_[k>>2]|0,32)|0,me=ye,ue=qt(0,_[$>>2]|0,32)|0,ce=Jt(ue|0,ye|0,ne|0,me|0)|0,me=ye,ne=qt(0,_[re>>2]|0,32)|0,ue=ye,le=qt(0,_[Q>>2]|0,32)|0,x=Jt(le|0,ye|0,ne|0,ue|0)|0,ue=Vt(x|0,ye|0,ce|0,me|0)|0,me=ye,ce=qt(0,_[C>>2]|0,32)|0,x=ye,ne=qt(0,_[te>>2]|0,32)|0,le=Jt(ne|0,ye|0,ce|0,x|0)|0,x=Vt(ue|0,me|0,le|0,ye|0)|0,le=ye,me=qt(0,_[oe>>2]|0,32)|0,ue=ye,ce=qt(0,_[ee>>2]|0,32)|0,ne=Jt(ce|0,ye|0,me|0,ue|0)|0,ue=Vt(x|0,le|0,ne|0,ye|0)|0,ne=ye,le=qt(0,_[j>>2]|0,32)|0,x=ye,me=qt(0,_[se>>2]|0,32)|0,ce=Jt(me|0,ye|0,le|0,x|0)|0,x=Vt(ue|0,ne|0,ce|0,ye|0)|0,ce=ye,ne=qt(0,_[ie>>2]|0,32)|0,ue=ye,le=qt(0,_[g>>2]|0,32)|0,me=Jt(le|0,ye|0,ne|0,ue|0)|0,ue=Vt(x|0,ce|0,me|0,ye|0)|0,me=ye,ce=qt(0,_[s>>2]|0,32)|0,x=ye,ne=qt(0,_[ae>>2]|0,32)|0,le=Jt(ne|0,ye|0,ce|0,x|0)|0,x=Vt(ue|0,me|0,le|0,ye|0)|0,le=ye,me=qt(0,_[de>>2]|0,32)|0,ue=ye,ce=qt(0,_[i>>2]|0,32)|0,ne=Jt(ce|0,ye|0,me|0,ue|0)|0,ue=Vt(x|0,le|0,ne|0,ye|0)|0,ne=ye,le=qt(0,_[r>>2]|0,32)|0,x=ye,me=o+72|0,ce=qt(0,_[me>>2]|0,32)|0,pe=Jt(ce|0,ye|0,le|0,x|0)|0,x=Vt(ue|0,ne|0,pe|0,ye|0)|0,pe=ye,ne=r+72|0,r=qt(0,_[ne>>2]|0,32)|0,ue=ye,le=qt(0,_[o>>2]|0,32)|0,o=Jt(le|0,ye|0,r|0,ue|0)|0,ue=Vt(x|0,pe|0,o|0,ye|0)|0,o=t+72|0,_[o>>2]=ue,_[o+4>>2]=ye,o=qt(0,_[re>>2]|0,32)|0,ue=ye,pe=qt(0,_[$>>2]|0,32)|0,x=Jt(pe|0,ye|0,o|0,ue|0)|0,ue=ye,o=qt(0,_[C>>2]|0,32)|0,pe=ye,r=qt(0,_[se>>2]|0,32)|0,le=Jt(r|0,ye|0,o|0,pe|0)|0,pe=Vt(le|0,ye|0,x|0,ue|0)|0,ue=ye,x=qt(0,_[ie>>2]|0,32)|0,le=ye,o=qt(0,_[ee>>2]|0,32)|0,r=Jt(o|0,ye|0,x|0,le|0)|0,le=Vt(pe|0,ue|0,r|0,ye|0)|0,r=ye,ue=qt(0,_[s>>2]|0,32)|0,s=ye,pe=qt(0,_[me>>2]|0,32)|0,x=Jt(pe|0,ye|0,ue|0,s|0)|0,s=Vt(le|0,r|0,x|0,ye|0)|0,x=ye,r=qt(0,_[ne>>2]|0,32)|0,le=ye,ue=qt(0,_[i>>2]|0,32)|0,i=Jt(ue|0,ye|0,r|0,le|0)|0,le=Vt(s|0,x|0,i|0,ye|0)|0,i=zt(le|0,ye|0,1)|0,le=ye,x=qt(0,_[k>>2]|0,32)|0,s=ye,r=qt(0,_[te>>2]|0,32)|0,ue=Jt(r|0,ye|0,x|0,s|0)|0,s=Vt(i|0,le|0,ue|0,ye|0)|0,ue=ye,le=qt(0,_[oe>>2]|0,32)|0,i=ye,x=qt(0,_[Q>>2]|0,32)|0,r=Jt(x|0,ye|0,le|0,i|0)|0,i=Vt(s|0,ue|0,r|0,ye|0)|0,r=ye,ue=qt(0,_[j>>2]|0,32)|0,s=ye,le=qt(0,_[ae>>2]|0,32)|0,x=Jt(le|0,ye|0,ue|0,s|0)|0,s=Vt(i|0,r|0,x|0,ye|0)|0,x=ye,r=qt(0,_[de>>2]|0,32)|0,i=ye,ue=qt(0,_[g>>2]|0,32)|0,le=Jt(ue|0,ye|0,r|0,i|0)|0,i=Vt(s|0,x|0,le|0,ye|0)|0,le=t+80|0,_[le>>2]=i,_[le+4>>2]=ye,le=qt(0,_[re>>2]|0,32)|0,i=ye,x=qt(0,_[te>>2]|0,32)|0,s=Jt(x|0,ye|0,le|0,i|0)|0,i=ye,le=qt(0,_[oe>>2]|0,32)|0,x=ye,r=qt(0,_[$>>2]|0,32)|0,ue=Jt(r|0,ye|0,le|0,x|0)|0,x=Vt(ue|0,ye|0,s|0,i|0)|0,i=ye,s=qt(0,_[k>>2]|0,32)|0,ue=ye,le=qt(0,_[se>>2]|0,32)|0,r=Jt(le|0,ye|0,s|0,ue|0)|0,ue=Vt(x|0,i|0,r|0,ye|0)|0,r=ye,i=qt(0,_[ie>>2]|0,32)|0,x=ye,s=qt(0,_[Q>>2]|0,32)|0,le=Jt(s|0,ye|0,i|0,x|0)|0,x=Vt(ue|0,r|0,le|0,ye|0)|0,le=ye,r=qt(0,_[C>>2]|0,32)|0,ue=ye,i=qt(0,_[ae>>2]|0,32)|0,s=Jt(i|0,ye|0,r|0,ue|0)|0,ue=Vt(x|0,le|0,s|0,ye|0)|0,s=ye,le=qt(0,_[de>>2]|0,32)|0,x=ye,r=qt(0,_[ee>>2]|0,32)|0,i=Jt(r|0,ye|0,le|0,x|0)|0,x=Vt(ue|0,s|0,i|0,ye|0)|0,i=ye,s=qt(0,_[j>>2]|0,32)|0,j=ye,ue=qt(0,_[me>>2]|0,32)|0,le=Jt(ue|0,ye|0,s|0,j|0)|0,j=Vt(x|0,i|0,le|0,ye|0)|0,le=ye,i=qt(0,_[ne>>2]|0,32)|0,x=ye,s=qt(0,_[g>>2]|0,32)|0,g=Jt(s|0,ye|0,i|0,x|0)|0,x=Vt(j|0,le|0,g|0,ye|0)|0,g=t+88|0,_[g>>2]=x,_[g+4>>2]=ye,g=qt(0,_[oe>>2]|0,32)|0,x=ye,le=qt(0,_[te>>2]|0,32)|0,j=Jt(le|0,ye|0,g|0,x|0)|0,x=ye,g=qt(0,_[re>>2]|0,32)|0,le=ye,i=qt(0,_[se>>2]|0,32)|0,s=Jt(i|0,ye|0,g|0,le|0)|0,le=ye,g=qt(0,_[ie>>2]|0,32)|0,i=ye,ue=qt(0,_[$>>2]|0,32)|0,r=Jt(ue|0,ye|0,g|0,i|0)|0,i=Vt(r|0,ye|0,s|0,le|0)|0,le=ye,s=qt(0,_[C>>2]|0,32)|0,C=ye,r=qt(0,_[me>>2]|0,32)|0,g=Jt(r|0,ye|0,s|0,C|0)|0,C=Vt(i|0,le|0,g|0,ye|0)|0,g=ye,le=qt(0,_[ne>>2]|0,32)|0,i=ye,s=qt(0,_[ee>>2]|0,32)|0,ee=Jt(s|0,ye|0,le|0,i|0)|0,i=Vt(C|0,g|0,ee|0,ye|0)|0,ee=zt(i|0,ye|0,1)|0,i=Vt(ee|0,ye|0,j|0,x|0)|0,x=ye,j=qt(0,_[k>>2]|0,32)|0,ee=ye,g=qt(0,_[ae>>2]|0,32)|0,C=Jt(g|0,ye|0,j|0,ee|0)|0,ee=Vt(i|0,x|0,C|0,ye|0)|0,C=ye,x=qt(0,_[de>>2]|0,32)|0,i=ye,j=qt(0,_[Q>>2]|0,32)|0,g=Jt(j|0,ye|0,x|0,i|0)|0,i=Vt(ee|0,C|0,g|0,ye|0)|0,g=t+96|0,_[g>>2]=i,_[g+4>>2]=ye,g=qt(0,_[oe>>2]|0,32)|0,i=ye,C=qt(0,_[se>>2]|0,32)|0,ee=Jt(C|0,ye|0,g|0,i|0)|0,i=ye,g=qt(0,_[ie>>2]|0,32)|0,C=ye,x=qt(0,_[te>>2]|0,32)|0,j=Jt(x|0,ye|0,g|0,C|0)|0,C=Vt(j|0,ye|0,ee|0,i|0)|0,i=ye,ee=qt(0,_[re>>2]|0,32)|0,j=ye,g=qt(0,_[ae>>2]|0,32)|0,x=Jt(g|0,ye|0,ee|0,j|0)|0,j=Vt(C|0,i|0,x|0,ye|0)|0,x=ye,i=qt(0,_[de>>2]|0,32)|0,C=ye,ee=qt(0,_[$>>2]|0,32)|0,g=Jt(ee|0,ye|0,i|0,C|0)|0,C=Vt(j|0,x|0,g|0,ye|0)|0,g=ye,x=qt(0,_[k>>2]|0,32)|0,k=ye,j=qt(0,_[me>>2]|0,32)|0,i=Jt(j|0,ye|0,x|0,k|0)|0,k=Vt(C|0,g|0,i|0,ye|0)|0,i=ye,g=qt(0,_[ne>>2]|0,32)|0,C=ye,x=qt(0,_[Q>>2]|0,32)|0,Q=Jt(x|0,ye|0,g|0,C|0)|0,C=Vt(k|0,i|0,Q|0,ye|0)|0,Q=t+104|0,_[Q>>2]=C,_[Q+4>>2]=ye,Q=qt(0,_[ie>>2]|0,32)|0,C=ye,i=qt(0,_[se>>2]|0,32)|0,k=Jt(i|0,ye|0,Q|0,C|0)|0,C=ye,Q=qt(0,_[re>>2]|0,32)|0,re=ye,i=qt(0,_[me>>2]|0,32)|0,g=Jt(i|0,ye|0,Q|0,re|0)|0,re=Vt(g|0,ye|0,k|0,C|0)|0,C=ye,k=qt(0,_[ne>>2]|0,32)|0,g=ye,Q=qt(0,_[$>>2]|0,32)|0,$=Jt(Q|0,ye|0,k|0,g|0)|0,g=Vt(re|0,C|0,$|0,ye|0)|0,$=zt(g|0,ye|0,1)|0,g=ye,C=qt(0,_[oe>>2]|0,32)|0,re=ye,k=qt(0,_[ae>>2]|0,32)|0,Q=Jt(k|0,ye|0,C|0,re|0)|0,re=Vt($|0,g|0,Q|0,ye|0)|0,Q=ye,g=qt(0,_[de>>2]|0,32)|0,$=ye,C=qt(0,_[te>>2]|0,32)|0,k=Jt(C|0,ye|0,g|0,$|0)|0,$=Vt(re|0,Q|0,k|0,ye|0)|0,k=t+112|0,_[k>>2]=$,_[k+4>>2]=ye,k=qt(0,_[ie>>2]|0,32)|0,$=ye,Q=qt(0,_[ae>>2]|0,32)|0,re=Jt(Q|0,ye|0,k|0,$|0)|0,$=ye,k=qt(0,_[de>>2]|0,32)|0,Q=ye,g=qt(0,_[se>>2]|0,32)|0,C=Jt(g|0,ye|0,k|0,Q|0)|0,Q=Vt(C|0,ye|0,re|0,$|0)|0,$=ye,re=qt(0,_[oe>>2]|0,32)|0,oe=ye,C=qt(0,_[me>>2]|0,32)|0,k=Jt(C|0,ye|0,re|0,oe|0)|0,oe=Vt(Q|0,$|0,k|0,ye|0)|0,k=ye,$=qt(0,_[ne>>2]|0,32)|0,Q=ye,re=qt(0,_[te>>2]|0,32)|0,te=Jt(re|0,ye|0,$|0,Q|0)|0,Q=Vt(oe|0,k|0,te|0,ye|0)|0,te=t+120|0,_[te>>2]=Q,_[te+4>>2]=ye,te=qt(0,_[de>>2]|0,32)|0,Q=ye,k=qt(0,_[ae>>2]|0,32)|0,oe=Jt(k|0,ye|0,te|0,Q|0)|0,Q=ye,te=qt(0,_[ie>>2]|0,32)|0,ie=ye,k=qt(0,_[me>>2]|0,32)|0,$=Jt(k|0,ye|0,te|0,ie|0)|0,ie=ye,te=qt(0,_[ne>>2]|0,32)|0,k=ye,re=qt(0,_[se>>2]|0,32)|0,se=Jt(re|0,ye|0,te|0,k|0)|0,k=Vt(se|0,ye|0,$|0,ie|0)|0,ie=zt(k|0,ye|0,1)|0,k=Vt(ie|0,ye|0,oe|0,Q|0)|0,Q=t+128|0,_[Q>>2]=k,_[Q+4>>2]=ye,Q=qt(0,_[de>>2]|0,32)|0,de=ye,k=qt(0,_[me>>2]|0,32)|0,oe=Jt(k|0,ye|0,Q|0,de|0)|0,de=ye,Q=qt(0,_[ne>>2]|0,32)|0,k=ye,ie=qt(0,_[ae>>2]|0,32)|0,ae=Jt(ie|0,ye|0,Q|0,k|0)|0,k=Vt(ae|0,ye|0,oe|0,de|0)|0,de=t+136|0,_[de>>2]=k,_[de+4>>2]=ye,de=qt(0,_[ne>>2]|0,31)|0,ne=ye,k=qt(0,_[me>>2]|0,32)|0,me=Jt(k|0,ye|0,de|0,ne|0)|0,ne=t+144|0,_[ne>>2]=me,_[ne+4>>2]=ye}function kt(t,r){t=t|0,r=r|0;var o=0,i=0,s=0,g=0,C=0,k=0,x=0,$=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0,pe=0,_e=0,fe=0,ge=0,he=0,Ce=0,be=0,ve=0,Se=0,Re=0,Le=0,Ee=0,ke=0,Ie=0,Te=0,De=0,xe=0,$e=0;o=j,j=j+160|0,i=o,s=_[r>>2]|0,g=qt(0,s|0,32)|0,C=ye,k=Jt(g|0,C|0,g|0,C|0)|0,x=i,_[x>>2]=k,_[x+4>>2]=ye,x=qt(0,s|0,31)|0,s=ye,k=r+8|0,$=_[k>>2]|0,Q=qt(0,$|0,32)|0,ee=ye,te=Jt(Q|0,ee|0,x|0,s|0)|0,ne=i+8|0,re=ne,_[re>>2]=te,_[re+4>>2]=ye,re=Jt(Q|0,ee|0,Q|0,ee|0)|0,te=ye,oe=r+16|0,ae=qt(0,_[oe>>2]|0,32)|0,ie=ye,le=Jt(ae|0,ie|0,g|0,C|0)|0,se=Vt(le|0,ye|0,re|0,te|0)|0,te=zt(se|0,ye|0,1)|0,se=i+16|0,re=se,_[re>>2]=te,_[re+4>>2]=ye,re=Jt(ae|0,ie|0,Q|0,ee|0)|0,te=ye,le=r+24|0,ue=qt(0,_[le>>2]|0,32)|0,ce=ye,de=Jt(ue|0,ce|0,g|0,C|0)|0,me=Vt(de|0,ye|0,re|0,te|0)|0,te=zt(me|0,ye|0,1)|0,me=i+24|0,re=me,_[re>>2]=te,_[re+4>>2]=ye,re=Jt(ae|0,ie|0,ae|0,ie|0)|0,te=ye,de=qt(0,$|0,30)|0,pe=Jt(ue|0,ce|0,de|0,ye|0)|0,de=Vt(pe|0,ye|0,re|0,te|0)|0,te=ye,re=r+32|0,pe=qt(0,_[re>>2]|0,32)|0,_e=ye,fe=Jt(pe|0,_e|0,x|0,s|0)|0,s=Vt(de|0,te|0,fe|0,ye|0)|0,fe=i+32|0,te=fe,_[te>>2]=s,_[te+4>>2]=ye,te=Jt(ue|0,ce|0,ae|0,ie|0)|0,s=ye,de=Jt(pe|0,_e|0,Q|0,ee|0)|0,x=Vt(de|0,ye|0,te|0,s|0)|0,s=ye,te=r+40|0,de=qt(0,_[te>>2]|0,32)|0,ge=ye,he=Jt(de|0,ge|0,g|0,C|0)|0,Ce=Vt(x|0,s|0,he|0,ye|0)|0,he=zt(Ce|0,ye|0,1)|0,Ce=i+40|0,s=Ce,_[s>>2]=he,_[s+4>>2]=ye,s=Jt(ue|0,ce|0,ue|0,ce|0)|0,he=ye,x=Jt(pe|0,_e|0,ae|0,ie|0)|0,be=Vt(x|0,ye|0,s|0,he|0)|0,he=ye,s=r+48|0,x=qt(0,_[s>>2]|0,32)|0,ve=ye,Se=Jt(x|0,ve|0,g|0,C|0)|0,Re=Vt(be|0,he|0,Se|0,ye|0)|0,Se=ye,he=qt(0,$|0,31)|0,$=Jt(de|0,ge|0,he|0,ye|0)|0,he=Vt(Re|0,Se|0,$|0,ye|0)|0,$=zt(he|0,ye|0,1)|0,he=i+48|0,Se=he,_[Se>>2]=$,_[Se+4>>2]=ye,Se=Jt(pe|0,_e|0,ue|0,ce|0)|0,$=ye,Re=Jt(de|0,ge|0,ae|0,ie|0)|0,be=Vt(Re|0,ye|0,Se|0,$|0)|0,$=ye,Se=Jt(x|0,ve|0,Q|0,ee|0)|0,Re=Vt(be|0,$|0,Se|0,ye|0)|0,Se=ye,$=r+56|0,be=qt(0,_[$>>2]|0,32)|0,Le=ye,Ee=Jt(be|0,Le|0,g|0,C|0)|0,ke=Vt(Re|0,Se|0,Ee|0,ye|0)|0,Ee=zt(ke|0,ye|0,1)|0,ke=i+56|0,Se=ke,_[Se>>2]=Ee,_[Se+4>>2]=ye,Se=Jt(pe|0,_e|0,pe|0,_e|0)|0,Ee=ye,Re=Jt(x|0,ve|0,ae|0,ie|0)|0,Ie=ye,Te=r+64|0,De=qt(0,_[Te>>2]|0,32)|0,xe=ye,$e=Jt(De|0,xe|0,g|0,C|0)|0,C=Vt($e|0,ye|0,Re|0,Ie|0)|0,Ie=ye,Re=Jt(be|0,Le|0,Q|0,ee|0)|0,ee=ye,Q=Jt(de|0,ge|0,ue|0,ce|0)|0,$e=Vt(Q|0,ye|0,Re|0,ee|0)|0,ee=zt($e|0,ye|0,1)|0,$e=Vt(C|0,Ie|0,ee|0,ye|0)|0,ee=zt($e|0,ye|0,1)|0,$e=Vt(ee|0,ye|0,Se|0,Ee|0)|0,Ee=i+64|0,Se=Ee,_[Se>>2]=$e,_[Se+4>>2]=ye,Se=Jt(de|0,ge|0,pe|0,_e|0)|0,$e=ye,ee=Jt(x|0,ve|0,ue|0,ce|0)|0,ce=Vt(ee|0,ye|0,Se|0,$e|0)|0,$e=ye,Se=Jt(be|0,Le|0,ae|0,ie|0)|0,ie=Vt(ce|0,$e|0,Se|0,ye|0)|0,Se=ye,$e=qt(0,_[k>>2]|0,32)|0,k=ye,ce=Jt(De|0,xe|0,$e|0,k|0)|0,ae=Vt(ie|0,Se|0,ce|0,ye|0)|0,ce=ye,Se=qt(0,_[r>>2]|0,32)|0,ie=ye,ee=_[r+72>>2]|0,r=qt(0,ee|0,32)|0,ue=ye,Ie=Jt(r|0,ue|0,Se|0,ie|0)|0,ie=Vt(ae|0,ce|0,Ie|0,ye|0)|0,Ie=zt(ie|0,ye|0,1)|0,ie=i+72|0,_[ie>>2]=Ie,_[ie+4>>2]=ye,ie=Jt(de|0,ge|0,de|0,ge|0)|0,Ie=ye,ce=Jt(x|0,ve|0,pe|0,_e|0)|0,_e=Vt(ce|0,ye|0,ie|0,Ie|0)|0,Ie=ye,ie=qt(0,_[oe>>2]|0,32)|0,oe=ye,ce=Jt(De|0,xe|0,ie|0,oe|0)|0,pe=Vt(_e|0,Ie|0,ce|0,ye|0)|0,ce=ye,Ie=qt(0,_[le>>2]|0,32)|0,le=ye,_e=Jt(be|0,Le|0,Ie|0,le|0)|0,ae=ye,Se=Jt(r|0,ue|0,$e|0,k|0)|0,k=Vt(Se|0,ye|0,_e|0,ae|0)|0,ae=zt(k|0,ye|0,1)|0,k=Vt(pe|0,ce|0,ae|0,ye|0)|0,ae=zt(k|0,ye|0,1)|0,k=i+80|0,ce=k,_[ce>>2]=ae,_[ce+4>>2]=ye,ce=Jt(x|0,ve|0,de|0,ge|0)|0,ge=ye,de=qt(0,_[re>>2]|0,32)|0,re=ye,ae=Jt(be|0,Le|0,de|0,re|0)|0,pe=Vt(ae|0,ye|0,ce|0,ge|0)|0,ge=ye,ce=Jt(De|0,xe|0,Ie|0,le|0)|0,ae=Vt(pe|0,ge|0,ce|0,ye|0)|0,ce=ye,ge=Jt(r|0,ue|0,ie|0,oe|0)|0,oe=Vt(ae|0,ce|0,ge|0,ye|0)|0,ge=ye,ce=zt(oe|0,ge|0,1)|0,ae=ye,ie=i+88|0,_[ie>>2]=ce,_[ie+4>>2]=ae,ie=Jt(x|0,ve|0,x|0,ve|0)|0,ve=ye,x=Jt(De|0,xe|0,de|0,re|0)|0,pe=ye,_e=_[te>>2]|0,te=qt(0,_e|0,32)|0,Se=ye,$e=Jt(be|0,Le|0,te|0,Se|0)|0,C=ye,Re=Jt(r|0,ue|0,Ie|0,le|0)|0,le=Vt(Re|0,ye|0,$e|0,C|0)|0,C=zt(le|0,ye|0,1)|0,le=Vt(C|0,ye|0,x|0,pe|0)|0,pe=zt(le|0,ye|0,1)|0,le=Vt(pe|0,ye|0,ie|0,ve|0)|0,ve=ye,ie=i+96|0,_[ie>>2]=le,_[ie+4>>2]=ve,ie=qt(0,_[s>>2]|0,32)|0,s=ye,pe=Jt(be|0,Le|0,ie|0,s|0)|0,Le=ye,be=Jt(De|0,xe|0,te|0,Se|0)|0,Se=Vt(be|0,ye|0,pe|0,Le|0)|0,Le=ye,pe=Jt(r|0,ue|0,de|0,re|0)|0,re=Vt(Se|0,Le|0,pe|0,ye|0)|0,pe=ye,Le=zt(re|0,pe|0,1)|0,Se=ye,de=i+104|0,_[de>>2]=Le,_[de+4>>2]=Se,de=_[$>>2]|0,$=qt(0,de|0,32)|0,be=ye,te=Jt($|0,be|0,$|0,be|0)|0,x=ye,C=Jt(De|0,xe|0,ie|0,s|0)|0,xe=Vt(C|0,ye|0,te|0,x|0)|0,x=ye,te=qt(0,_e|0,31)|0,_e=Jt(r|0,ue|0,te|0,ye|0)|0,te=Vt(xe|0,x|0,_e|0,ye|0)|0,_e=ye,x=zt(te|0,_e|0,1)|0,xe=ye,C=i+112|0,_[C>>2]=x,_[C+4>>2]=xe,C=_[Te>>2]|0,Te=qt(0,C|0,32)|0,De=ye,$e=Jt(Te|0,De|0,$|0,be|0)|0,be=ye,$=Jt(r|0,ue|0,ie|0,s|0)|0,s=Vt($|0,ye|0,$e|0,be|0)|0,be=ye,$e=zt(s|0,be|0,1)|0,$=ye,ie=i+120|0,_[ie>>2]=$e,_[ie+4>>2]=$,ie=Jt(Te|0,De|0,Te|0,De|0)|0,De=ye,Te=qt(0,de|0,30)|0,de=Jt(r|0,ue|0,Te|0,ye|0)|0,Te=Vt(de|0,ye|0,ie|0,De|0)|0,De=ye,ie=i+128|0,_[ie>>2]=Te,_[ie+4>>2]=De,ie=qt(0,C|0,31)|0,C=Jt(r|0,ue|0,ie|0,ye|0)|0,ie=ye,de=i+136|0,_[de>>2]=C,_[de+4>>2]=ie,de=qt(0,ee|0,31)|0,ee=Jt(de|0,ye|0,r|0,ue|0)|0,ue=ye,r=i+144|0,_[r>>2]=ee,_[r+4>>2]=ue,r=Ee,de=_[r>>2]|0,Re=_[r+4>>2]|0,r=Jt(ee|0,ue|0,18,0)|0,Ie=ye,Q=Vt(ee|0,ue|0,de|0,Re|0)|0,Re=Vt(Q|0,ye|0,r|0,Ie|0)|0,Ie=Ee,_[Ie>>2]=Re,_[Ie+4>>2]=ye,Ie=ke,Re=_[Ie>>2]|0,Ee=_[Ie+4>>2]|0,Ie=Jt(C|0,ie|0,18,0)|0,r=ye,Q=Vt(Re|0,Ee|0,C|0,ie|0)|0,ie=Vt(Q|0,ye|0,Ie|0,r|0)|0,r=ke,_[r>>2]=ie,_[r+4>>2]=ye,r=he,ie=_[r>>2]|0,ke=_[r+4>>2]|0,r=Jt(Te|0,De|0,18,0)|0,Ie=ye,Q=Vt(ie|0,ke|0,Te|0,De|0)|0,De=Vt(Q|0,ye|0,r|0,Ie|0)|0,Ie=he,_[Ie>>2]=De,_[Ie+4>>2]=ye,Ie=Ce,De=_[Ie>>2]|0,he=_[Ie+4>>2]|0,Ie=Jt(s|0,be|0,36,0)|0,be=ye,s=Vt(De|0,he|0,$e|0,$|0)|0,$=Vt(s|0,ye|0,Ie|0,be|0)|0,be=Ce,_[be>>2]=$,_[be+4>>2]=ye,be=fe,$=_[be>>2]|0,Ce=_[be+4>>2]|0,be=Jt(te|0,_e|0,36,0)|0,_e=ye,te=Vt($|0,Ce|0,x|0,xe|0)|0,xe=Vt(te|0,ye|0,be|0,_e|0)|0,_e=fe,_[_e>>2]=xe,_[_e+4>>2]=ye,_e=me,xe=_[_e>>2]|0,fe=_[_e+4>>2]|0,_e=Jt(re|0,pe|0,36,0)|0,pe=ye,re=Vt(xe|0,fe|0,Le|0,Se|0)|0,Se=Vt(re|0,ye|0,_e|0,pe|0)|0,pe=me,_[pe>>2]=Se,_[pe+4>>2]=ye,pe=se,Se=_[pe>>2]|0,me=_[pe+4>>2]|0,pe=Jt(le|0,ve|0,18,0)|0,_e=ye,re=Vt(Se|0,me|0,le|0,ve|0)|0,ve=Vt(re|0,ye|0,pe|0,_e|0)|0,_e=se,_[_e>>2]=ve,_[_e+4>>2]=ye,_e=ne,ve=_[_e>>2]|0,se=_[_e+4>>2]|0,_e=Jt(oe|0,ge|0,36,0)|0,ge=ye,oe=Vt(ve|0,se|0,ce|0,ae|0)|0,ae=Vt(oe|0,ye|0,_e|0,ge|0)|0,ge=ne,_[ge>>2]=ae,_[ge+4>>2]=ye,ge=k,ae=_[ge>>2]|0,_e=_[ge+4>>2]|0,ge=i,oe=_[ge>>2]|0,ce=_[ge+4>>2]|0,ge=Jt(ae|0,_e|0,18,0)|0,se=ye,ve=Vt(oe|0,ce|0,ae|0,_e|0)|0,_e=Vt(ve|0,ye|0,ge|0,se|0)|0,se=ye,ge=i,_[ge>>2]=_e,_[ge+4>>2]=se,ge=k,_[ge>>2]=0,_[ge+4>>2]=0,ge=se,se=_e,_e=0;do ve=Vt(ge>>31>>>6|0,0,se|0,ge|0)|0,ae=qt(ve|0,ye|0,26)|0,ve=ye,ce=zt(ae|0,ve|0,26)|0,oe=Ut(se|0,ge|0,ce|0,ye|0)|0,ce=i+(_e<<3)|0,_[ce>>2]=oe,_[ce+4>>2]=ye,ce=i+((_e|1)<<3)|0,oe=ce,pe=Vt(ae|0,ve|0,_[oe>>2]|0,_[oe+4>>2]|0)|0,oe=ye,ve=Vt(oe>>31>>>7|0,0,pe|0,oe|0)|0,ae=qt(ve|0,ye|0,25)|0,ve=ye,re=zt(ae|0,ve|0,25)|0,le=Ut(pe|0,oe|0,re|0,ye|0)|0,re=ce,_[re>>2]=le,_[re+4>>2]=ye,_e=_e+2|0,re=i+(_e<<3)|0,le=re,se=Vt(ae|0,ve|0,_[le>>2]|0,_[le+4>>2]|0)|0,ge=ye,le=re,_[le>>2]=se,_[le+4>>2]=ge;while(_e>>>0<10);_e=k,ge=_[_e>>2]|0,se=_[_e+4>>2]|0,_e=i,le=_[_e>>2]|0,re=_[_e+4>>2]|0,_e=Jt(ge|0,se|0,18,0)|0,ve=ye,ae=Vt(le|0,re|0,ge|0,se|0)|0,se=Vt(ae|0,ye|0,_e|0,ve|0)|0,ve=ye,_e=k,_[_e>>2]=0,_[_e+4>>2]=0,_e=Vt(ve>>31>>>6|0,0,se|0,ve|0)|0,k=qt(_e|0,ye|0,26)|0,_e=ye,ae=zt(k|0,_e|0,26)|0,ge=Ut(se|0,ve|0,ae|0,ye|0)|0,ae=i,_[ae>>2]=ge,_[ae+4>>2]=ye,ae=ne,ge=Vt(k|0,_e|0,_[ae>>2]|0,_[ae+4>>2]|0)|0,ae=ne,_[ae>>2]=ge,_[ae+4>>2]=ye,ae=t,t=i,i=ae+80|0;do _[ae>>2]=_[t>>2],ae=ae+4|0,t=t+4|0;while((ae|0)<(i|0));j=o}function It(){var t=0;return _[2]|0?t=_[(Ze()|0)+60>>2]|0:t=56,t|0}function Tt(t){t=t|0;var r=0;return t>>>0>4294963200?(_[(It()|0)>>2]=0-t,r=-1):r=t,r|0}function Dt(t){return t=t|0,0}function xt(t){t=t|0}function $t(t){t=t|0;var r=0,o=0;return r=j,j=j+16|0,o=r,_[o>>2]=_[t+60>>2],t=Tt(et(6,o|0)|0)|0,j=r,t|0}function Pt(t,r,o){t=t|0,r=r|0,o=o|0;var i=0,s=0,g=0,C=0;return i=j,j=j+32|0,s=i,g=i+20|0,_[s>>2]=_[t+60>>2],_[s+4>>2]=0,_[s+8>>2]=r,_[s+12>>2]=g,_[s+16>>2]=o,(Tt(ut(140,s|0)|0)|0)<0?(_[g>>2]=-1,C=-1):C=_[g>>2]|0,j=i,C|0}function Nt(t,r,o){t=t|0,r=r|0,o=o|0;var i=0,s=0,g=0,C=0,k=0,x=0,$=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0;for(i=j,j=j+48|0,s=i+16|0,g=i,C=i+32|0,k=t+28|0,x=_[k>>2]|0,_[C>>2]=x,$=t+20|0,Q=(_[$>>2]|0)-x|0,_[C+4>>2]=Q,_[C+8>>2]=r,_[C+12>>2]=o,r=t+60|0,x=t+44|0,ee=C,C=2,te=Q+o|0;;){if(_[2]|0?(ct(1,t|0),_[g>>2]=_[r>>2],_[g+4>>2]=ee,_[g+8>>2]=C,Q=Tt(mt(146,g|0)|0)|0,Xe(0),ne=Q):(_[s>>2]=_[r>>2],_[s+4>>2]=ee,_[s+8>>2]=C,ne=Tt(mt(146,s|0)|0)|0),(te|0)==(ne|0)){re=6;break}if((ne|0)<0){oe=ee,ae=C,re=8;break}Q=te-ne|0,ie=_[ee+4>>2]|0,ne>>>0<=ie>>>0?(C|0)==2?(_[k>>2]=(_[k>>2]|0)+ne,le=ie,se=ne,ue=ee,ce=2):(le=ie,se=ne,ue=ee,ce=C):(de=_[x>>2]|0,_[k>>2]=de,_[$>>2]=de,le=_[ee+12>>2]|0,se=ne-ie|0,ue=ee+8|0,ce=C+-1|0),_[ue>>2]=(_[ue>>2]|0)+se,_[ue+4>>2]=le-se,ee=ue,C=ce,te=Q}return(re|0)==6?(te=_[x>>2]|0,_[t+16>>2]=te+(_[t+48>>2]|0),x=te,_[k>>2]=x,_[$>>2]=x,me=o):(re|0)==8&&(_[t+16>>2]=0,_[k>>2]=0,_[$>>2]=0,_[t>>2]=_[t>>2]|32,(ae|0)==2?me=0:me=o-(_[oe+4>>2]|0)|0),j=i,me|0}function Mt(t,r,o){t=t|0,r=r|0,o=o|0;var s=0,g=0;return s=j,j=j+80|0,g=s,_[t+36>>2]=3,(_[t>>2]&64|0)==0&&(_[g>>2]=_[t+60>>2],_[g+4>>2]=21505,_[g+8>>2]=s+12,(lt(54,g|0)|0)!=0)&&(i[t+75>>0]=-1),g=Nt(t,r,o)|0,j=s,g|0}function wt(t){t=t|0;var r=0,o=0,i=0,s=0,g=0,C=0,k=0;do if(t){if((_[t+76>>2]|0)<=-1){r=Ft(t)|0;break}o=(Dt(t)|0)==0,i=Ft(t)|0,o||xt(t),r=i}else{if(_[13]|0?s=wt(_[13]|0)|0:s=0,Ye(36),i=_[8]|0,!i)g=s;else for(o=i,i=s;;)if((_[o+76>>2]|0)>-1?C=Dt(o)|0:C=0,(_[o+20>>2]|0)>>>0>(_[o+28>>2]|0)>>>0?k=Ft(o)|0|i:k=i,C&&xt(o),o=_[o+56>>2]|0,o)i=k;else{g=k;break}st(36),r=g}while(!1);return r|0}function At(t){t=t|0,_[t+68>>2]|0||xt(t)}function Ft(t){t=t|0;var r=0,o=0,i=0,s=0,g=0,C=0,k=0;return r=t+20|0,o=t+28|0,(_[r>>2]|0)>>>0>(_[o>>2]|0)>>>0&&(cn[_[t+36>>2]&3](t,0,0)|0,(_[r>>2]|0)==0)?i=-1:(s=t+4|0,g=_[s>>2]|0,C=t+8|0,k=_[C>>2]|0,g>>>0<k>>>0&&cn[_[t+40>>2]&3](t,g-k|0,1)|0,_[t+16>>2]=0,_[o>>2]=0,_[r>>2]=0,_[C>>2]=0,_[s>>2]=0,i=0),i|0}function Ot(t){t=t|0;var r=0,o=0,i=0,s=0,g=0,C=0,k=0,x=0,$=0,j=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0,pe=0,_e=0,fe=0,ge=0,he=0,ye=0,Ce=0,be=0,ve=0,Se=0,Re=0,Le=0,Ee=0,ke=0,Ie=0,Te=0,De=0,xe=0,$e=0,Pe=0,Ne=0,Me=0,we=0,Ae=0,Fe=0,Oe=0,Be=0,We=0,qe=0,Ue=0,Ve=0,He=0,Ge=0,ze=0,je=0,Ke=0,Qe=0,Xe=0,Ye=0,Je=0,Ze=0,et=0,tt=0,at=0,it=0,lt=0,st=0,ut=0,ct=0,mt=0,pt=0,_t=0,ft=0,gt=0,ht=0,yt=0,Ct=0,bt=0,vt=0,St=0,Rt=0,Lt=0,Et=0,kt=0,Tt=0,Dt=0,xt=0;do if(t>>>0<245){if(r=t>>>0<11?16:t+11&-8,o=r>>>3,i=_[43]|0,s=i>>>o,s&3){g=(s&1^1)+o|0,C=212+(g<<1<<2)|0,k=C+8|0,x=_[k>>2]|0,$=x+8|0,j=_[$>>2]|0;do if((C|0)!=(j|0))if(j>>>0<(_[47]|0)>>>0&&nt(),Q=j+12|0,(_[Q>>2]|0)==(x|0)){_[Q>>2]=C,_[k>>2]=j;break}else nt();else _[43]=i&~(1<<g);while(!1);return j=g<<3,_[x+4>>2]=j|3,k=x+j+4|0,_[k>>2]=_[k>>2]|1,ee=$,ee|0}if(k=_[45]|0,r>>>0>k>>>0){if(s){j=2<<o,C=s<<o&(j|0-j),j=(C&0-C)+-1|0,C=j>>>12&16,Q=j>>>C,j=Q>>>5&8,te=Q>>>j,Q=te>>>2&4,ne=te>>>Q,te=ne>>>1&2,re=ne>>>te,ne=re>>>1&1,oe=(j|C|Q|te|ne)+(re>>>ne)|0,ne=212+(oe<<1<<2)|0,re=ne+8|0,te=_[re>>2]|0,Q=te+8|0,C=_[Q>>2]|0;do if((ne|0)!=(C|0))if(C>>>0<(_[47]|0)>>>0&&nt(),j=C+12|0,(_[j>>2]|0)==(te|0)){_[j>>2]=ne,_[re>>2]=C,ae=_[45]|0;break}else nt();else _[43]=i&~(1<<oe),ae=k;while(!1);return k=(oe<<3)-r|0,_[te+4>>2]=r|3,i=te+r|0,_[i+4>>2]=k|1,_[i+k>>2]=k,ae&&(C=_[48]|0,re=ae>>>3,ne=212+(re<<1<<2)|0,o=_[43]|0,s=1<<re,o&s?(re=ne+8|0,$=_[re>>2]|0,$>>>0<(_[47]|0)>>>0?nt():(ie=re,le=$)):(_[43]=o|s,ie=ne+8|0,le=ne),_[ie>>2]=C,_[le+12>>2]=C,_[C+8>>2]=le,_[C+12>>2]=ne),_[45]=k,_[48]=i,ee=Q,ee|0}if(i=_[44]|0,i){for(k=(i&0-i)+-1|0,i=k>>>12&16,ne=k>>>i,k=ne>>>5&8,C=ne>>>k,ne=C>>>2&4,s=C>>>ne,C=s>>>1&2,o=s>>>C,s=o>>>1&1,$=_[476+((k|i|ne|C|s)+(o>>>s)<<2)>>2]|0,s=(_[$+4>>2]&-8)-r|0,o=$,C=$;;){if($=_[o+16>>2]|0,$)ce=$;else if(ne=_[o+20>>2]|0,ne)ce=ne;else{se=s,ue=C;break}$=(_[ce+4>>2]&-8)-r|0,ne=$>>>0<s>>>0,s=ne?$:s,o=ce,C=ne?ce:C}C=_[47]|0,ue>>>0<C>>>0&&nt(),o=ue+r|0,ue>>>0>=o>>>0&&nt(),s=_[ue+24>>2]|0,Q=_[ue+12>>2]|0;do if((Q|0)==(ue|0)){if(te=ue+20|0,oe=_[te>>2]|0,oe)me=oe,pe=te;else if(ne=ue+16|0,$=_[ne>>2]|0,$)me=$,pe=ne;else{de=0;break}for(;;){if(te=me+20|0,oe=_[te>>2]|0,oe){me=oe,pe=te;continue}if(te=me+16|0,oe=_[te>>2]|0,oe)me=oe,pe=te;else{_e=me,fe=pe;break}}if(fe>>>0<C>>>0)nt();else{_[fe>>2]=0,de=_e;break}}else if(te=_[ue+8>>2]|0,te>>>0<C>>>0&&nt(),oe=te+12|0,(_[oe>>2]|0)!=(ue|0)&&nt(),ne=Q+8|0,(_[ne>>2]|0)==(ue|0)){_[oe>>2]=Q,_[ne>>2]=te,de=Q;break}else nt();while(!1);do if(s){if(Q=_[ue+28>>2]|0,C=476+(Q<<2)|0,(ue|0)==(_[C>>2]|0)){if(_[C>>2]=de,!de){_[44]=_[44]&~(1<<Q);break}}else if(s>>>0<(_[47]|0)>>>0&&nt(),Q=s+16|0,(_[Q>>2]|0)==(ue|0)?_[Q>>2]=de:_[s+20>>2]=de,!de)break;Q=_[47]|0,de>>>0<Q>>>0&&nt(),_[de+24>>2]=s,C=_[ue+16>>2]|0;do if(C)if(C>>>0<Q>>>0)nt();else{_[de+16>>2]=C,_[C+24>>2]=de;break}while(!1);if(C=_[ue+20>>2]|0,C)if(C>>>0<(_[47]|0)>>>0)nt();else{_[de+20>>2]=C,_[C+24>>2]=de;break}}while(!1);return se>>>0<16?(s=se+r|0,_[ue+4>>2]=s|3,C=ue+s+4|0,_[C>>2]=_[C>>2]|1):(_[ue+4>>2]=r|3,_[o+4>>2]=se|1,_[o+se>>2]=se,C=_[45]|0,C&&(s=_[48]|0,Q=C>>>3,C=212+(Q<<1<<2)|0,te=_[43]|0,ne=1<<Q,te&ne?(Q=C+8|0,oe=_[Q>>2]|0,oe>>>0<(_[47]|0)>>>0?nt():(ge=Q,he=oe)):(_[43]=te|ne,ge=C+8|0,he=C),_[ge>>2]=s,_[he+12>>2]=s,_[s+8>>2]=he,_[s+12>>2]=C),_[45]=se,_[48]=o),ee=ue+8|0,ee|0}else ye=r}else ye=r}else if(t>>>0<=4294967231)if(C=t+11|0,s=C&-8,ne=_[44]|0,ne){te=0-s|0,oe=C>>>8,oe?s>>>0>16777215?Ce=31:(C=(oe+1048320|0)>>>16&8,Q=oe<<C,oe=(Q+520192|0)>>>16&4,$=Q<<oe,Q=($+245760|0)>>>16&2,i=14-(oe|C|Q)+($<<Q>>>15)|0,Ce=s>>>(i+7|0)&1|i<<1):Ce=0,i=_[476+(Ce<<2)>>2]|0;e:do if(!i)be=te,ve=0,Se=0,Re=86;else for(Q=te,$=0,C=s<<((Ce|0)==31?0:25-(Ce>>>1)|0),oe=i,k=0;;){if(re=_[oe+4>>2]&-8,x=re-s|0,x>>>0<Q>>>0)if((re|0)==(s|0)){Le=x,Ee=oe,ke=oe,Re=90;break e}else Ie=x,Te=oe;else Ie=Q,Te=k;if(x=_[oe+20>>2]|0,oe=_[oe+16+(C>>>31<<2)>>2]|0,re=(x|0)==0|(x|0)==(oe|0)?$:x,x=(oe|0)==0,x){be=Ie,ve=re,Se=Te,Re=86;break}else Q=Ie,$=re,C=C<<(x&1^1),k=Te}while(!1);if((Re|0)==86){if((ve|0)==0&(Se|0)==0){if(i=2<<Ce,te=ne&(i|0-i),!te){ye=s;break}i=(te&0-te)+-1|0,te=i>>>12&16,r=i>>>te,i=r>>>5&8,o=r>>>i,r=o>>>2&4,k=o>>>r,o=k>>>1&2,C=k>>>o,k=C>>>1&1,De=_[476+((i|te|r|o|k)+(C>>>k)<<2)>>2]|0}else De=ve;De?(Le=be,Ee=De,ke=Se,Re=90):(xe=be,$e=Se)}if((Re|0)==90)for(;;){if(Re=0,k=(_[Ee+4>>2]&-8)-s|0,C=k>>>0<Le>>>0,o=C?k:Le,k=C?Ee:ke,C=_[Ee+16>>2]|0,C){Le=o,Ee=C,ke=k,Re=90;continue}if(Ee=_[Ee+20>>2]|0,Ee)Le=o,ke=k,Re=90;else{xe=o,$e=k;break}}if(($e|0)!=0&&xe>>>0<((_[45]|0)-s|0)>>>0){ne=_[47]|0,$e>>>0<ne>>>0&&nt(),k=$e+s|0,$e>>>0>=k>>>0&&nt(),o=_[$e+24>>2]|0,C=_[$e+12>>2]|0;do if((C|0)==($e|0)){if(r=$e+20|0,te=_[r>>2]|0,te)Ne=te,Me=r;else if(i=$e+16|0,$=_[i>>2]|0,$)Ne=$,Me=i;else{Pe=0;break}for(;;){if(r=Ne+20|0,te=_[r>>2]|0,te){Ne=te,Me=r;continue}if(r=Ne+16|0,te=_[r>>2]|0,te)Ne=te,Me=r;else{we=Ne,Ae=Me;break}}if(Ae>>>0<ne>>>0)nt();else{_[Ae>>2]=0,Pe=we;break}}else if(r=_[$e+8>>2]|0,r>>>0<ne>>>0&&nt(),te=r+12|0,(_[te>>2]|0)!=($e|0)&&nt(),i=C+8|0,(_[i>>2]|0)==($e|0)){_[te>>2]=C,_[i>>2]=r,Pe=C;break}else nt();while(!1);do if(o){if(C=_[$e+28>>2]|0,ne=476+(C<<2)|0,($e|0)==(_[ne>>2]|0)){if(_[ne>>2]=Pe,!Pe){_[44]=_[44]&~(1<<C);break}}else if(o>>>0<(_[47]|0)>>>0&&nt(),C=o+16|0,(_[C>>2]|0)==($e|0)?_[C>>2]=Pe:_[o+20>>2]=Pe,!Pe)break;C=_[47]|0,Pe>>>0<C>>>0&&nt(),_[Pe+24>>2]=o,ne=_[$e+16>>2]|0;do if(ne)if(ne>>>0<C>>>0)nt();else{_[Pe+16>>2]=ne,_[ne+24>>2]=Pe;break}while(!1);if(ne=_[$e+20>>2]|0,ne)if(ne>>>0<(_[47]|0)>>>0)nt();else{_[Pe+20>>2]=ne,_[ne+24>>2]=Pe;break}}while(!1);do if(xe>>>0>=16){if(_[$e+4>>2]=s|3,_[k+4>>2]=xe|1,_[k+xe>>2]=xe,o=xe>>>3,xe>>>0<256){ne=212+(o<<1<<2)|0,C=_[43]|0,r=1<<o,C&r?(o=ne+8|0,i=_[o>>2]|0,i>>>0<(_[47]|0)>>>0?nt():(Fe=o,Oe=i)):(_[43]=C|r,Fe=ne+8|0,Oe=ne),_[Fe>>2]=k,_[Oe+12>>2]=k,_[k+8>>2]=Oe,_[k+12>>2]=ne;break}if(ne=xe>>>8,ne?xe>>>0>16777215?Be=31:(r=(ne+1048320|0)>>>16&8,C=ne<<r,ne=(C+520192|0)>>>16&4,i=C<<ne,C=(i+245760|0)>>>16&2,o=14-(ne|r|C)+(i<<C>>>15)|0,Be=xe>>>(o+7|0)&1|o<<1):Be=0,o=476+(Be<<2)|0,_[k+28>>2]=Be,C=k+16|0,_[C+4>>2]=0,_[C>>2]=0,C=_[44]|0,i=1<<Be,!(C&i)){_[44]=C|i,_[o>>2]=k,_[k+24>>2]=o,_[k+12>>2]=k,_[k+8>>2]=k;break}for(i=xe<<((Be|0)==31?0:25-(Be>>>1)|0),C=_[o>>2]|0;;){if((_[C+4>>2]&-8|0)==(xe|0)){We=C,Re=148;break}if(o=C+16+(i>>>31<<2)|0,r=_[o>>2]|0,r)i=i<<1,C=r;else{qe=o,Ue=C,Re=145;break}}if((Re|0)==145)if(qe>>>0<(_[47]|0)>>>0)nt();else{_[qe>>2]=k,_[k+24>>2]=Ue,_[k+12>>2]=k,_[k+8>>2]=k;break}else if((Re|0)==148)if(C=We+8|0,i=_[C>>2]|0,r=_[47]|0,i>>>0>=r>>>0&We>>>0>=r>>>0){_[i+12>>2]=k,_[C>>2]=k,_[k+8>>2]=i,_[k+12>>2]=We,_[k+24>>2]=0;break}else nt()}else i=xe+s|0,_[$e+4>>2]=i|3,C=$e+i+4|0,_[C>>2]=_[C>>2]|1;while(!1);return ee=$e+8|0,ee|0}else ye=s}else ye=s;else ye=-1;while(!1);if($e=_[45]|0,$e>>>0>=ye>>>0)return xe=$e-ye|0,We=_[48]|0,xe>>>0>15?(Ue=We+ye|0,_[48]=Ue,_[45]=xe,_[Ue+4>>2]=xe|1,_[Ue+xe>>2]=xe,_[We+4>>2]=ye|3):(_[45]=0,_[48]=0,_[We+4>>2]=$e|3,xe=We+$e+4|0,_[xe>>2]=_[xe>>2]|1),ee=We+8|0,ee|0;if(We=_[46]|0,We>>>0>ye>>>0)return xe=We-ye|0,_[46]=xe,We=_[49]|0,$e=We+ye|0,_[49]=$e,_[$e+4>>2]=xe|1,_[We+4>>2]=ye|3,ee=We+8|0,ee|0;do if(!(_[161]|0))if(We=dt(30)|0,We+-1&We)nt();else{_[163]=We,_[162]=We,_[164]=-1,_[165]=-1,_[166]=0,_[154]=0,_[161]=(ot(0)|0)&-16^1431655768;break}while(!1);if(We=ye+48|0,xe=_[163]|0,$e=ye+47|0,Ue=xe+$e|0,qe=0-xe|0,xe=Ue&qe,xe>>>0<=ye>>>0||(Be=_[153]|0,(Be|0)!=0&&(Oe=_[151]|0,Fe=Oe+xe|0,Fe>>>0<=Oe>>>0|Fe>>>0>Be>>>0)))return ee=0,ee|0;e:do if(_[154]&4)Re=190;else{Be=_[49]|0;t:do if(Be){for(Fe=620;;){if(Oe=_[Fe>>2]|0,Oe>>>0<=Be>>>0&&(Pe=Fe+4|0,(Oe+(_[Pe>>2]|0)|0)>>>0>Be>>>0)){Ve=Fe,He=Pe;break}if(Fe=_[Fe+8>>2]|0,!Fe){Re=173;break t}}if(Fe=Ue-(_[46]|0)&qe,Fe>>>0<2147483647)if(Pe=rt(Fe|0)|0,(Pe|0)==((_[Ve>>2]|0)+(_[He>>2]|0)|0)){if((Pe|0)!=-1){Ge=Pe,ze=Fe,Re=193;break e}}else je=Pe,Ke=Fe,Re=183}else Re=173;while(!1);do if((Re|0)==173&&(Be=rt(0)|0,(Be|0)!=-1)&&(s=Be,Fe=_[162]|0,Pe=Fe+-1|0,Pe&s?Qe=xe-s+(Pe+s&0-Fe)|0:Qe=xe,Fe=_[151]|0,s=Fe+Qe|0,Qe>>>0>ye>>>0&Qe>>>0<2147483647)){if(Pe=_[153]|0,(Pe|0)!=0&&s>>>0<=Fe>>>0|s>>>0>Pe>>>0)break;if(Pe=rt(Qe|0)|0,(Pe|0)==(Be|0)){Ge=Be,ze=Qe,Re=193;break e}else je=Pe,Ke=Qe,Re=183}while(!1);t:do if((Re|0)==183){Pe=0-Ke|0;do if(We>>>0>Ke>>>0&(Ke>>>0<2147483647&(je|0)!=-1)&&(Be=_[163]|0,s=$e-Ke+Be&0-Be,s>>>0<2147483647))if((rt(s|0)|0)==-1){rt(Pe|0)|0;break t}else{Xe=s+Ke|0;break}else Xe=Ke;while(!1);if((je|0)!=-1){Ge=je,ze=Xe,Re=193;break e}}while(!1);_[154]=_[154]|4,Re=190}while(!1);if((Re|0)==190&&xe>>>0<2147483647&&(Xe=rt(xe|0)|0,xe=rt(0)|0,Xe>>>0<xe>>>0&((Xe|0)!=-1&(xe|0)!=-1))&&(je=xe-Xe|0,je>>>0>(ye+40|0)>>>0)&&(Ge=Xe,ze=je,Re=193),(Re|0)==193){je=(_[151]|0)+ze|0,_[151]=je,je>>>0>(_[152]|0)>>>0&&(_[152]=je),je=_[49]|0;do if(je){Xe=620;do{if(xe=_[Xe>>2]|0,Ke=Xe+4|0,$e=_[Ke>>2]|0,(Ge|0)==(xe+$e|0)){Ye=xe,Je=Ke,Ze=$e,et=Xe,Re=203;break}Xe=_[Xe+8>>2]|0}while((Xe|0)!=0);if((Re|0)==203&&(_[et+12>>2]&8|0)==0&&je>>>0<Ge>>>0&je>>>0>=Ye>>>0){_[Je>>2]=Ze+ze,Xe=je+8|0,$e=(Xe&7|0)==0?0:0-Xe&7,Xe=je+$e|0,Ke=ze-$e+(_[46]|0)|0,_[49]=Xe,_[46]=Ke,_[Xe+4>>2]=Ke|1,_[Xe+Ke+4>>2]=40,_[50]=_[165];break}for(Ke=_[47]|0,Ge>>>0<Ke>>>0?(_[47]=Ge,tt=Ge):tt=Ke,Ke=Ge+ze|0,Xe=620;;){if((_[Xe>>2]|0)==(Ke|0)){at=Xe,it=Xe,Re=211;break}if(Xe=_[Xe+8>>2]|0,!Xe){lt=620;break}}if((Re|0)==211)if(_[it+12>>2]&8)lt=620;else{_[at>>2]=Ge,Xe=it+4|0,_[Xe>>2]=(_[Xe>>2]|0)+ze,Xe=Ge+8|0,$e=Ge+((Xe&7|0)==0?0:0-Xe&7)|0,Xe=Ke+8|0,xe=Ke+((Xe&7|0)==0?0:0-Xe&7)|0,Xe=$e+ye|0,We=xe-$e-ye|0,_[$e+4>>2]=ye|3;do if((xe|0)!=(je|0)){if((xe|0)==(_[48]|0)){Qe=(_[45]|0)+We|0,_[45]=Qe,_[48]=Xe,_[Xe+4>>2]=Qe|1,_[Xe+Qe>>2]=Qe;break}if(Qe=_[xe+4>>2]|0,(Qe&3|0)==1){He=Qe&-8,Ve=Qe>>>3;e:do if(Qe>>>0>=256){qe=_[xe+24>>2]|0,Ue=_[xe+12>>2]|0;do if((Ue|0)==(xe|0)){if(Pe=xe+16|0,s=Pe+4|0,Be=_[s>>2]|0,Be)ut=Be,ct=s;else if(Fe=_[Pe>>2]|0,Fe)ut=Fe,ct=Pe;else{st=0;break}for(;;){if(s=ut+20|0,Be=_[s>>2]|0,Be){ut=Be,ct=s;continue}if(s=ut+16|0,Be=_[s>>2]|0,Be)ut=Be,ct=s;else{mt=ut,pt=ct;break}}if(pt>>>0<tt>>>0)nt();else{_[pt>>2]=0,st=mt;break}}else if(s=_[xe+8>>2]|0,s>>>0<tt>>>0&&nt(),Be=s+12|0,(_[Be>>2]|0)!=(xe|0)&&nt(),Pe=Ue+8|0,(_[Pe>>2]|0)==(xe|0)){_[Be>>2]=Ue,_[Pe>>2]=s,st=Ue;break}else nt();while(!1);if(!qe)break;Ue=_[xe+28>>2]|0,s=476+(Ue<<2)|0;do if((xe|0)!=(_[s>>2]|0)){if(qe>>>0<(_[47]|0)>>>0&&nt(),Pe=qe+16|0,(_[Pe>>2]|0)==(xe|0)?_[Pe>>2]=st:_[qe+20>>2]=st,!st)break e}else{if(_[s>>2]=st,st)break;_[44]=_[44]&~(1<<Ue);break e}while(!1);Ue=_[47]|0,st>>>0<Ue>>>0&&nt(),_[st+24>>2]=qe,s=xe+16|0,Pe=_[s>>2]|0;do if(Pe)if(Pe>>>0<Ue>>>0)nt();else{_[st+16>>2]=Pe,_[Pe+24>>2]=st;break}while(!1);if(Pe=_[s+4>>2]|0,!Pe)break;if(Pe>>>0<(_[47]|0)>>>0)nt();else{_[st+20>>2]=Pe,_[Pe+24>>2]=st;break}}else{Pe=_[xe+8>>2]|0,Ue=_[xe+12>>2]|0,qe=212+(Ve<<1<<2)|0;do if((Pe|0)!=(qe|0)){if(Pe>>>0<tt>>>0&&nt(),(_[Pe+12>>2]|0)==(xe|0))break;nt()}while(!1);if((Ue|0)==(Pe|0)){_[43]=_[43]&~(1<<Ve);break}do if((Ue|0)==(qe|0))_t=Ue+8|0;else{if(Ue>>>0<tt>>>0&&nt(),s=Ue+8|0,(_[s>>2]|0)==(xe|0)){_t=s;break}nt()}while(!1);_[Pe+12>>2]=Ue,_[_t>>2]=Pe}while(!1);ft=xe+He|0,gt=He+We|0}else ft=xe,gt=We;if(Ve=ft+4|0,_[Ve>>2]=_[Ve>>2]&-2,_[Xe+4>>2]=gt|1,_[Xe+gt>>2]=gt,Ve=gt>>>3,gt>>>0<256){Qe=212+(Ve<<1<<2)|0,qe=_[43]|0,s=1<<Ve;do if(!(qe&s))_[43]=qe|s,ht=Qe+8|0,yt=Qe;else{if(Ve=Qe+8|0,Be=_[Ve>>2]|0,Be>>>0>=(_[47]|0)>>>0){ht=Ve,yt=Be;break}nt()}while(!1);_[ht>>2]=Xe,_[yt+12>>2]=Xe,_[Xe+8>>2]=yt,_[Xe+12>>2]=Qe;break}s=gt>>>8;do if(!s)Ct=0;else{if(gt>>>0>16777215){Ct=31;break}qe=(s+1048320|0)>>>16&8,He=s<<qe,Be=(He+520192|0)>>>16&4,Ve=He<<Be,He=(Ve+245760|0)>>>16&2,Fe=14-(Be|qe|He)+(Ve<<He>>>15)|0,Ct=gt>>>(Fe+7|0)&1|Fe<<1}while(!1);if(s=476+(Ct<<2)|0,_[Xe+28>>2]=Ct,Qe=Xe+16|0,_[Qe+4>>2]=0,_[Qe>>2]=0,Qe=_[44]|0,Fe=1<<Ct,!(Qe&Fe)){_[44]=Qe|Fe,_[s>>2]=Xe,_[Xe+24>>2]=s,_[Xe+12>>2]=Xe,_[Xe+8>>2]=Xe;break}for(Fe=gt<<((Ct|0)==31?0:25-(Ct>>>1)|0),Qe=_[s>>2]|0;;){if((_[Qe+4>>2]&-8|0)==(gt|0)){bt=Qe,Re=281;break}if(s=Qe+16+(Fe>>>31<<2)|0,He=_[s>>2]|0,He)Fe=Fe<<1,Qe=He;else{vt=s,St=Qe,Re=278;break}}if((Re|0)==278)if(vt>>>0<(_[47]|0)>>>0)nt();else{_[vt>>2]=Xe,_[Xe+24>>2]=St,_[Xe+12>>2]=Xe,_[Xe+8>>2]=Xe;break}else if((Re|0)==281)if(Qe=bt+8|0,Fe=_[Qe>>2]|0,He=_[47]|0,Fe>>>0>=He>>>0&bt>>>0>=He>>>0){_[Fe+12>>2]=Xe,_[Qe>>2]=Xe,_[Xe+8>>2]=Fe,_[Xe+12>>2]=bt,_[Xe+24>>2]=0;break}else nt()}else Fe=(_[46]|0)+We|0,_[46]=Fe,_[49]=Xe,_[Xe+4>>2]=Fe|1;while(!1);return ee=$e+8|0,ee|0}for(;;){if(Xe=_[lt>>2]|0,Xe>>>0<=je>>>0&&(We=Xe+(_[lt+4>>2]|0)|0,We>>>0>je>>>0)){Rt=We;break}lt=_[lt+8>>2]|0}$e=Rt+-47|0,We=$e+8|0,Xe=$e+((We&7|0)==0?0:0-We&7)|0,We=je+16|0,$e=Xe>>>0<We>>>0?je:Xe,Xe=$e+8|0,xe=Ge+8|0,Ke=(xe&7|0)==0?0:0-xe&7,xe=Ge+Ke|0,Fe=ze+-40-Ke|0,_[49]=xe,_[46]=Fe,_[xe+4>>2]=Fe|1,_[xe+Fe+4>>2]=40,_[50]=_[165],Fe=$e+4|0,_[Fe>>2]=27,_[Xe>>2]=_[155],_[Xe+4>>2]=_[156],_[Xe+8>>2]=_[157],_[Xe+12>>2]=_[158],_[155]=Ge,_[156]=ze,_[158]=0,_[157]=Xe,Xe=$e+24|0;do Xe=Xe+4|0,_[Xe>>2]=7;while((Xe+4|0)>>>0<Rt>>>0);if(($e|0)!=(je|0)){if(Xe=$e-je|0,_[Fe>>2]=_[Fe>>2]&-2,_[je+4>>2]=Xe|1,_[$e>>2]=Xe,xe=Xe>>>3,Xe>>>0<256){Ke=212+(xe<<1<<2)|0,Qe=_[43]|0,He=1<<xe,Qe&He?(xe=Ke+8|0,s=_[xe>>2]|0,s>>>0<(_[47]|0)>>>0?nt():(Lt=xe,Et=s)):(_[43]=Qe|He,Lt=Ke+8|0,Et=Ke),_[Lt>>2]=je,_[Et+12>>2]=je,_[je+8>>2]=Et,_[je+12>>2]=Ke;break}if(Ke=Xe>>>8,Ke?Xe>>>0>16777215?kt=31:(He=(Ke+1048320|0)>>>16&8,Qe=Ke<<He,Ke=(Qe+520192|0)>>>16&4,s=Qe<<Ke,Qe=(s+245760|0)>>>16&2,xe=14-(Ke|He|Qe)+(s<<Qe>>>15)|0,kt=Xe>>>(xe+7|0)&1|xe<<1):kt=0,xe=476+(kt<<2)|0,_[je+28>>2]=kt,_[je+20>>2]=0,_[We>>2]=0,Qe=_[44]|0,s=1<<kt,!(Qe&s)){_[44]=Qe|s,_[xe>>2]=je,_[je+24>>2]=xe,_[je+12>>2]=je,_[je+8>>2]=je;break}for(s=Xe<<((kt|0)==31?0:25-(kt>>>1)|0),Qe=_[xe>>2]|0;;){if((_[Qe+4>>2]&-8|0)==(Xe|0)){Tt=Qe,Re=307;break}if(xe=Qe+16+(s>>>31<<2)|0,He=_[xe>>2]|0,He)s=s<<1,Qe=He;else{Dt=xe,xt=Qe,Re=304;break}}if((Re|0)==304)if(Dt>>>0<(_[47]|0)>>>0)nt();else{_[Dt>>2]=je,_[je+24>>2]=xt,_[je+12>>2]=je,_[je+8>>2]=je;break}else if((Re|0)==307)if(Qe=Tt+8|0,s=_[Qe>>2]|0,Xe=_[47]|0,s>>>0>=Xe>>>0&Tt>>>0>=Xe>>>0){_[s+12>>2]=je,_[Qe>>2]=je,_[je+8>>2]=s,_[je+12>>2]=Tt,_[je+24>>2]=0;break}else nt()}}else{s=_[47]|0,(s|0)==0|Ge>>>0<s>>>0&&(_[47]=Ge),_[155]=Ge,_[156]=ze,_[158]=0,_[52]=_[161],_[51]=-1,s=0;do Qe=212+(s<<1<<2)|0,_[Qe+12>>2]=Qe,_[Qe+8>>2]=Qe,s=s+1|0;while((s|0)!=32);s=Ge+8|0,Qe=(s&7|0)==0?0:0-s&7,s=Ge+Qe|0,Xe=ze+-40-Qe|0,_[49]=s,_[46]=Xe,_[s+4>>2]=Xe|1,_[s+Xe+4>>2]=40,_[50]=_[165]}while(!1);if(ze=_[46]|0,ze>>>0>ye>>>0)return Ge=ze-ye|0,_[46]=Ge,ze=_[49]|0,je=ze+ye|0,_[49]=je,_[je+4>>2]=Ge|1,_[ze+4>>2]=ye|3,ee=ze+8|0,ee|0}return _[(It()|0)>>2]=12,ee=0,ee|0}function Bt(t){t=t|0;var r=0,o=0,i=0,s=0,g=0,C=0,k=0,x=0,$=0,j=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0,pe=0,_e=0,fe=0,ge=0,he=0,ye=0,Ce=0,be=0,ve=0,Se=0,Re=0,Le=0;if(t){r=t+-8|0,o=_[47]|0,r>>>0<o>>>0&&nt(),i=_[t+-4>>2]|0,t=i&3,(t|0)==1&&nt(),s=i&-8,g=r+s|0;do if(i&1)Q=r,ee=s;else{if(C=_[r>>2]|0,!t)return;if(k=r+(0-C)|0,x=C+s|0,k>>>0<o>>>0&&nt(),(k|0)==(_[48]|0)){if($=g+4|0,j=_[$>>2]|0,(j&3|0)!=3){Q=k,ee=x;break}_[45]=x,_[$>>2]=j&-2,_[k+4>>2]=x|1,_[k+x>>2]=x;return}if(j=C>>>3,C>>>0<256){if(C=_[k+8>>2]|0,$=_[k+12>>2]|0,te=212+(j<<1<<2)|0,(C|0)!=(te|0)&&(C>>>0<o>>>0&&nt(),(_[C+12>>2]|0)!=(k|0)&&nt()),($|0)==(C|0)){_[43]=_[43]&~(1<<j),Q=k,ee=x;break}($|0)!=(te|0)?($>>>0<o>>>0&&nt(),te=$+8|0,(_[te>>2]|0)==(k|0)?ne=te:nt()):ne=$+8|0,_[C+12>>2]=$,_[ne>>2]=C,Q=k,ee=x;break}C=_[k+24>>2]|0,$=_[k+12>>2]|0;do if(($|0)==(k|0)){if(te=k+16|0,j=te+4|0,re=_[j>>2]|0,re)ie=re,le=j;else if(oe=_[te>>2]|0,oe)ie=oe,le=te;else{ae=0;break}for(;;){if(j=ie+20|0,re=_[j>>2]|0,re){ie=re,le=j;continue}if(j=ie+16|0,re=_[j>>2]|0,re)ie=re,le=j;else{se=ie,ue=le;break}}if(ue>>>0<o>>>0)nt();else{_[ue>>2]=0,ae=se;break}}else if(j=_[k+8>>2]|0,j>>>0<o>>>0&&nt(),re=j+12|0,(_[re>>2]|0)!=(k|0)&&nt(),te=$+8|0,(_[te>>2]|0)==(k|0)){_[re>>2]=$,_[te>>2]=j,ae=$;break}else nt();while(!1);if(C){if($=_[k+28>>2]|0,j=476+($<<2)|0,(k|0)==(_[j>>2]|0)){if(_[j>>2]=ae,!ae){_[44]=_[44]&~(1<<$),Q=k,ee=x;break}}else if(C>>>0<(_[47]|0)>>>0&&nt(),$=C+16|0,(_[$>>2]|0)==(k|0)?_[$>>2]=ae:_[C+20>>2]=ae,!ae){Q=k,ee=x;break}$=_[47]|0,ae>>>0<$>>>0&&nt(),_[ae+24>>2]=C,j=k+16|0,te=_[j>>2]|0;do if(te)if(te>>>0<$>>>0)nt();else{_[ae+16>>2]=te,_[te+24>>2]=ae;break}while(!1);if(te=_[j+4>>2]|0,te)if(te>>>0<(_[47]|0)>>>0)nt();else{_[ae+20>>2]=te,_[te+24>>2]=ae,Q=k,ee=x;break}else Q=k,ee=x}else Q=k,ee=x}while(!1);if(Q>>>0>=g>>>0&&nt(),s=g+4|0,r=_[s>>2]|0,r&1||nt(),r&2)_[s>>2]=r&-2,_[Q+4>>2]=ee|1,_[Q+ee>>2]=ee,ge=ee;else{if((g|0)==(_[49]|0)){if(ae=(_[46]|0)+ee|0,_[46]=ae,_[49]=Q,_[Q+4>>2]=ae|1,(Q|0)!=(_[48]|0))return;_[48]=0,_[45]=0;return}if((g|0)==(_[48]|0)){ae=(_[45]|0)+ee|0,_[45]=ae,_[48]=Q,_[Q+4>>2]=ae|1,_[Q+ae>>2]=ae;return}ae=(r&-8)+ee|0,o=r>>>3;do if(r>>>0>=256){se=_[g+24>>2]|0,ue=_[g+12>>2]|0;do if((ue|0)==(g|0)){if(le=g+16|0,ie=le+4|0,ne=_[ie>>2]|0,ne)de=ne,me=ie;else if(t=_[le>>2]|0,t)de=t,me=le;else{ce=0;break}for(;;){if(ie=de+20|0,ne=_[ie>>2]|0,ne){de=ne,me=ie;continue}if(ie=de+16|0,ne=_[ie>>2]|0,ne)de=ne,me=ie;else{pe=de,_e=me;break}}if(_e>>>0<(_[47]|0)>>>0)nt();else{_[_e>>2]=0,ce=pe;break}}else if(ie=_[g+8>>2]|0,ie>>>0<(_[47]|0)>>>0&&nt(),ne=ie+12|0,(_[ne>>2]|0)!=(g|0)&&nt(),le=ue+8|0,(_[le>>2]|0)==(g|0)){_[ne>>2]=ue,_[le>>2]=ie,ce=ue;break}else nt();while(!1);if(se){if(ue=_[g+28>>2]|0,x=476+(ue<<2)|0,(g|0)==(_[x>>2]|0)){if(_[x>>2]=ce,!ce){_[44]=_[44]&~(1<<ue);break}}else if(se>>>0<(_[47]|0)>>>0&&nt(),ue=se+16|0,(_[ue>>2]|0)==(g|0)?_[ue>>2]=ce:_[se+20>>2]=ce,!ce)break;ue=_[47]|0,ce>>>0<ue>>>0&&nt(),_[ce+24>>2]=se,x=g+16|0,k=_[x>>2]|0;do if(k)if(k>>>0<ue>>>0)nt();else{_[ce+16>>2]=k,_[k+24>>2]=ce;break}while(!1);if(k=_[x+4>>2]|0,k)if(k>>>0<(_[47]|0)>>>0)nt();else{_[ce+20>>2]=k,_[k+24>>2]=ce;break}}}else{if(k=_[g+8>>2]|0,ue=_[g+12>>2]|0,se=212+(o<<1<<2)|0,(k|0)!=(se|0)&&(k>>>0<(_[47]|0)>>>0&&nt(),(_[k+12>>2]|0)!=(g|0)&&nt()),(ue|0)==(k|0)){_[43]=_[43]&~(1<<o);break}(ue|0)!=(se|0)?(ue>>>0<(_[47]|0)>>>0&&nt(),se=ue+8|0,(_[se>>2]|0)==(g|0)?fe=se:nt()):fe=ue+8|0,_[k+12>>2]=ue,_[fe>>2]=k}while(!1);if(_[Q+4>>2]=ae|1,_[Q+ae>>2]=ae,(Q|0)==(_[48]|0)){_[45]=ae;return}else ge=ae}if(ee=ge>>>3,ge>>>0<256){r=212+(ee<<1<<2)|0,s=_[43]|0,ae=1<<ee,s&ae?(ee=r+8|0,fe=_[ee>>2]|0,fe>>>0<(_[47]|0)>>>0?nt():(he=ee,ye=fe)):(_[43]=s|ae,he=r+8|0,ye=r),_[he>>2]=Q,_[ye+12>>2]=Q,_[Q+8>>2]=ye,_[Q+12>>2]=r;return}r=ge>>>8,r?ge>>>0>16777215?Ce=31:(ye=(r+1048320|0)>>>16&8,he=r<<ye,r=(he+520192|0)>>>16&4,ae=he<<r,he=(ae+245760|0)>>>16&2,s=14-(r|ye|he)+(ae<<he>>>15)|0,Ce=ge>>>(s+7|0)&1|s<<1):Ce=0,s=476+(Ce<<2)|0,_[Q+28>>2]=Ce,_[Q+20>>2]=0,_[Q+16>>2]=0,he=_[44]|0,ae=1<<Ce;do if(he&ae){for(ye=ge<<((Ce|0)==31?0:25-(Ce>>>1)|0),r=_[s>>2]|0;;){if((_[r+4>>2]&-8|0)==(ge|0)){be=r,ve=130;break}if(fe=r+16+(ye>>>31<<2)|0,ee=_[fe>>2]|0,ee)ye=ye<<1,r=ee;else{Se=fe,Re=r,ve=127;break}}if((ve|0)==127)if(Se>>>0<(_[47]|0)>>>0)nt();else{_[Se>>2]=Q,_[Q+24>>2]=Re,_[Q+12>>2]=Q,_[Q+8>>2]=Q;break}else if((ve|0)==130)if(r=be+8|0,ye=_[r>>2]|0,x=_[47]|0,ye>>>0>=x>>>0&be>>>0>=x>>>0){_[ye+12>>2]=Q,_[r>>2]=Q,_[Q+8>>2]=ye,_[Q+12>>2]=be,_[Q+24>>2]=0;break}else nt()}else _[44]=he|ae,_[s>>2]=Q,_[Q+24>>2]=s,_[Q+12>>2]=Q,_[Q+8>>2]=Q;while(!1);if(Q=(_[51]|0)+-1|0,_[51]=Q,!Q)Le=628;else return;for(;Q=_[Le>>2]|0,Q;)Le=Q+8|0;_[51]=-1}}function Wt(){}function qt(t,r,o){return t=t|0,r=r|0,o=o|0,(o|0)<32?(ye=r>>o,t>>>o|(r&(1<<o)-1)<<32-o):(ye=(r|0)<0?-1:0,r>>o-32|0)}function Ut(t,r,o,i){t=t|0,r=r|0,o=o|0,i=i|0;var s=0;return s=r-i>>>0,s=r-i-(o>>>0>t>>>0|0)>>>0,ye=s,t-o>>>0|0|0}function Vt(t,r,o,i){t=t|0,r=r|0,o=o|0,i=i|0;var s=0;return s=t+o>>>0,ye=r+i+(s>>>0<t>>>0|0)>>>0,s|0|0}function Ht(t,r,o){t=t|0,r=r|0,o=o|0;var s=0,g=0,C=0,k=0;if(s=t+o|0,(o|0)>=20){if(r=r&255,g=t&3,C=r|r<<8|r<<16|r<<24,k=s&-4,g)for(g=t+4-g|0;(t|0)<(g|0);)i[t>>0]=r,t=t+1|0;for(;(t|0)<(k|0);)_[t>>2]=C,t=t+4|0}for(;(t|0)<(s|0);)i[t>>0]=r,t=t+1|0;return t-o|0}function Gt(t,r,o){return t=t|0,r=r|0,o=o|0,(o|0)<32?(ye=r>>>o,t>>>o|(r&(1<<o)-1)<<32-o):(ye=0,r>>>o-32|0)}function zt(t,r,o){return t=t|0,r=r|0,o=o|0,(o|0)<32?(ye=r<<o|(t&(1<<o)-1<<32-o)>>>32-o,t<<o):(ye=t<<o-32,0)}function jt(t,r,o){t=t|0,r=r|0,o=o|0;var s=0;if((o|0)>=4096)return it(t|0,r|0,o|0)|0;if(s=t|0,(t&3)==(r&3)){for(;t&3;){if(!o)return s|0;i[t>>0]=i[r>>0]|0,t=t+1|0,r=r+1|0,o=o-1|0}for(;(o|0)>=4;)_[t>>2]=_[r>>2],t=t+4|0,r=r+4|0,o=o-4|0}for(;(o|0)>0;)i[t>>0]=i[r>>0]|0,t=t+1|0,r=r+1|0,o=o-1|0;return s|0}function Kt(t){t=t|0;var r=0;return r=i[ne+(t&255)>>0]|0,(r|0)<8?r|0:(r=i[ne+(t>>8&255)>>0]|0,(r|0)<8?r+8|0:(r=i[ne+(t>>16&255)>>0]|0,(r|0)<8?r+16|0:(i[ne+(t>>>24)>>0]|0)+24|0))}function Qt(t,r){t=t|0,r=r|0;var o=0,i=0,s=0,_=0;return o=t&65535,i=r&65535,s=Ue(i,o)|0,_=t>>>16,t=(s>>>16)+(Ue(i,_)|0)|0,i=r>>>16,r=Ue(i,o)|0,ye=(t>>>16)+(Ue(i,_)|0)+(((t&65535)+r|0)>>>16)|0,t+r<<16|s&65535|0|0}function Xt(t,r,o,i){t=t|0,r=r|0,o=o|0,i=i|0;var s=0,_=0,g=0,C=0,k=0;return s=r>>31|((r|0)<0?-1:0)<<1,_=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1,g=i>>31|((i|0)<0?-1:0)<<1,C=((i|0)<0?-1:0)>>31|((i|0)<0?-1:0)<<1,k=Ut(s^t,_^r,s,_)|0,r=ye,t=g^s,s=C^_,Ut((tn(k,r,Ut(g^o,C^i,g,C)|0,ye,0)|0)^t,ye^s,t,s)|0}function Yt(t,r,o,i){t=t|0,r=r|0,o=o|0,i=i|0;var s=0,g=0,C=0,k=0,x=0,$=0,Q=0;return s=j,j=j+16|0,g=s|0,C=r>>31|((r|0)<0?-1:0)<<1,k=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1,x=i>>31|((i|0)<0?-1:0)<<1,$=((i|0)<0?-1:0)>>31|((i|0)<0?-1:0)<<1,Q=Ut(C^t,k^r,C,k)|0,r=ye,tn(Q,r,Ut(x^o,$^i,x,$)|0,ye,g)|0,$=Ut(_[g>>2]^C,_[g+4>>2]^k,C,k)|0,k=ye,j=s,ye=k,$|0}function Jt(t,r,o,i){t=t|0,r=r|0,o=o|0,i=i|0;var s=0,_=0;return s=t,t=o,o=Qt(s,t)|0,_=ye,ye=(Ue(r,t)|0)+(Ue(i,s)|0)+_|_&0,o|0|0|0}function Zt(t,r,o,i){return t=t|0,r=r|0,o=o|0,i=i|0,tn(t,r,o,i,0)|0}function en(t,r,o,i){t=t|0,r=r|0,o=o|0,i=i|0;var s=0,g=0;return s=j,j=j+16|0,g=s|0,tn(t,r,o,i,g)|0,j=s,ye=_[g+4>>2]|0,_[g>>2]|0|0}function tn(t,r,o,i,s){t=t|0,r=r|0,o=o|0,i=i|0,s=s|0;var g=0,C=0,k=0,x=0,$=0,j=0,Q=0,ee=0,te=0,ne=0,re=0,oe=0,ae=0,ie=0,le=0,se=0,ue=0,ce=0,de=0,me=0,pe=0,_e=0,fe=0,ge=0,he=0,Ce=0,be=0;if(g=t,C=r,k=C,x=o,$=i,j=$,!k)return Q=(s|0)!=0,j?Q?(_[s>>2]=t|0,_[s+4>>2]=r&0,ee=0,te=0,ye=ee,te|0):(ee=0,te=0,ye=ee,te|0):(Q&&(_[s>>2]=(g>>>0)%(x>>>0),_[s+4>>2]=0),ee=0,te=(g>>>0)/(x>>>0)>>>0,ye=ee,te|0);Q=(j|0)==0;do if(x){if(!Q){if(ne=(He(j|0)|0)-(He(k|0)|0)|0,ne>>>0<=31){re=ne+1|0,oe=31-ne|0,ae=ne-31>>31,ie=re,le=g>>>(re>>>0)&ae|k<<oe,se=k>>>(re>>>0)&ae,ue=0,ce=g<<oe;break}return s?(_[s>>2]=t|0,_[s+4>>2]=C|r&0,ee=0,te=0,ye=ee,te|0):(ee=0,te=0,ye=ee,te|0)}if(oe=x-1|0,oe&x){ae=(He(x|0)|0)+33-(He(k|0)|0)|0,re=64-ae|0,ne=32-ae|0,de=ne>>31,me=ae-32|0,pe=me>>31,ie=ae,le=ne-1>>31&k>>>(me>>>0)|(k<<ne|g>>>(ae>>>0))&pe,se=pe&k>>>(ae>>>0),ue=g<<re&de,ce=(k<<re|g>>>(me>>>0))&de|g<<ne&ae-33>>31;break}return s&&(_[s>>2]=oe&g,_[s+4>>2]=0),(x|0)==1?(ee=C|r&0,te=t|0|0,ye=ee,te|0):(oe=Kt(x|0)|0,ee=k>>>(oe>>>0)|0,te=k<<32-oe|g>>>(oe>>>0)|0,ye=ee,te|0)}else{if(Q)return s&&(_[s>>2]=(k>>>0)%(x>>>0),_[s+4>>2]=0),ee=0,te=(k>>>0)/(x>>>0)>>>0,ye=ee,te|0;if(!g)return s&&(_[s>>2]=0,_[s+4>>2]=(k>>>0)%(j>>>0)),ee=0,te=(k>>>0)/(j>>>0)>>>0,ye=ee,te|0;if(oe=j-1|0,!(oe&j))return s&&(_[s>>2]=t|0,_[s+4>>2]=oe&k|r&0),ee=0,te=k>>>((Kt(j|0)|0)>>>0),ye=ee,te|0;if(oe=(He(j|0)|0)-(He(k|0)|0)|0,oe>>>0<=30){ae=oe+1|0,ne=31-oe|0,ie=ae,le=k<<ne|g>>>(ae>>>0),se=k>>>(ae>>>0),ue=0,ce=g<<ne;break}return s?(_[s>>2]=t|0,_[s+4>>2]=C|r&0,ee=0,te=0,ye=ee,te|0):(ee=0,te=0,ye=ee,te|0)}while(!1);if(!ie)_e=ce,fe=ue,ge=se,he=le,Ce=0,be=0;else{r=o|0|0,o=$|i&0,i=Vt(r|0,o|0,-1,-1)|0,$=ye,C=ce,ce=ue,ue=se,se=le,le=ie,ie=0;do t=C,C=ce>>>31|C<<1,ce=ie|ce<<1,g=se<<1|t>>>31|0,t=se>>>31|ue<<1|0,Ut(i,$,g,t)|0,k=ye,j=k>>31|((k|0)<0?-1:0)<<1,ie=j&1,se=Ut(g,t,j&r,(((k|0)<0?-1:0)>>31|((k|0)<0?-1:0)<<1)&o)|0,ue=ye,le=le-1|0;while((le|0)!=0);_e=C,fe=ce,ge=ue,he=se,Ce=0,be=ie}return ie=fe,fe=0,s&&(_[s>>2]=he,_[s+4>>2]=ge),ee=(ie|0)>>>31|(_e|fe)<<1|(fe<<1|ie>>>31)&0|Ce,te=(ie<<1|0)&-2|be,ye=ee,te|0}function nn(t,r){return t=t|0,r=r|0,un[t&1](r|0)|0}function rn(t,r,o,i){return t=t|0,r=r|0,o=o|0,i=i|0,cn[t&3](r|0,o|0,i|0)|0}function on(t,r){t=t|0,r=r|0,dn[t&1](r|0)}function an(t){return t=t|0,Ge(0),0}function ln(t,r,o){return t=t|0,r=r|0,o=o|0,Ge(1),0}function sn(t){t=t|0,Ge(2)}var un=[an,$t],cn=[ln,Mt,Pt,Nt],dn=[sn,At];return{_curve25519_donna:Rt,_free:Bt,_i64Add:Vt,_bitshift64Ashr:qt,_i64Subtract:Ut,_memset:Ht,_malloc:Ot,_memcpy:jt,_bitshift64Lshr:Gt,_fflush:wt,___errno_location:It,_bitshift64Shl:zt,runPostSets:Wt,stackAlloc:_t,stackSave:ft,stackRestore:gt,establishStackSpace:ht,setThrew:yt,setTempRet0:vt,getTempRet0:St,dynCall_ii:nn,dynCall_iiii:rn,dynCall_vi:on}})(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush,e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;e.dynCall_ii=Z.dynCall_ii,e.dynCall_iiii=Z.dynCall_iiii,e.dynCall_vi=Z.dynCall_vi,n.W=Z.stackAlloc,n.na=Z.stackSave,n.X=Z.stackRestore,n.md=Z.establishStackSpace,n.cb=Z.setTempRet0,n.Ua=Z.getTempRet0;function xc(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}xc.prototype=Error(),xc.prototype.constructor=xc;var Yc=null,Xa=function t(){e.calledRun||$c(),e.calledRun||(Xa=t)};e.callMain=e.jd=function(t){function r(){for(var t=0;3>t;t++)i.push(0)}assert(L==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(Pa.length==0,"cannot call main when preRun functions remain to be called"),t=t||[],xa||(xa=!0,Oa(Qa));var o=t.length+1,i=[G(Va(e.thisProgram),"i8",0)];r();for(var s=0;s<o-1;s+=1)i.push(G(Va(t[s]),"i8",0)),r();i.push(0),i=G(i,"i32",0);try{var _=e._main(o,i,0);ad(_,!0)}catch(t){if(!(t instanceof xc))if(t=="SimulateInfiniteLoop")e.noExitRuntime=!0;else throw t&&typeof t=="object"&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}finally{}};function $c(t){function r(){if(!e.calledRun&&(e.calledRun=!0,!A)){if(xa||(xa=!0,Oa(Qa)),Oa(Ra),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e._main&&bd&&e.callMain(t),e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}if(t=t||e.arguments,Yc===null&&(Yc=Date.now()),!(0<L)){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa),0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),r()},1)):r())}}e.run=e.run=$c;function ad(t,r){if(!r||!e.noExitRuntime)throw!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(t),new xc(t)}e.exit=e.exit=ad;var cd=[];function z(t){t!==void 0?(e.print(t),e.S(t),t=JSON.stringify(t)):t="",A=!0;var r="abort("+t+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw cd&&cd.forEach(function(o){r=o(r,t)}),r}if(e.abort=e.abort=z,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1),$c(),module.exports=e}),null);
__d("WAWebCryptoCurve25519",["Promise","WAWeb-curve25519-donna","WAWebCryptoLibraryUtilsApi","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s;function u(){s||(s=n("WAWeb-curve25519-donna"))}var c=new Uint8Array(32);c[0]=9;function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t;return e===void 0?(t=new Uint8Array(32),self.crypto.getRandomValues(t)):t=new Uint8Array(e),t[0]&=248,t[31]&=127,t[31]|=64,R({pubKey:32,privKey:t,basepoint:c},function(e){var n=s._curve25519_donna(e.pubKey,e.privKey,e.basepoint);if(n)throw r("err")("Curve25519:keyPair Error Code "+n);return{pubKey:S(e.pubKey,32),privKey:t.buffer}})}),m.apply(this,arguments)}function p(t,o){return(e||(e=n("Promise"))).resolve().then(function(){return R({sharedKey:32,pubKey:t,privKey:o},function(e){var t=s._curve25519_donna(e.sharedKey,e.privKey,e.pubKey);if(t)throw r("err")("Curve25519:sharedSecret Error Code "+t);return S(e.sharedKey,32)})})}var _=5;function f(e){return e.pubKey.byteLength===33&&e.privKey.byteLength===32}function g(e){if(f(e))return e;if(e.pubKey.byteLength!==32||e.privKey.byteLength!==32)throw r("err")("Invalid key pair type");var t=h(e.pubKey),n=new Uint8Array(32);return n.set(new Uint8Array(e.privKey)),{pubKey:t,privKey:n.buffer}}function h(e){if(e.byteLength!==32)throw r("err")("Invalid key type");var t=new Uint8Array(33);return t[0]=_,t.set(new Uint8Array(e),1),t.buffer}function y(e){return e.privKey.byteLength===32&&e.pubKey.byteLength===32}function C(e){if(y(e))return e;if(e.pubKey.byteLength!==33||e.privKey.byteLength!==32)throw r("err")("Invalid key pair type");var t=new Uint8Array(32),n=new Uint8Array(32);return t.set(new Uint8Array(e.pubKey).subarray(1)),n.set(new Uint8Array(e.privKey)),{pubKey:t.buffer,privKey:n.buffer}}function b(e){if(e.byteLength!==33)throw r("err")("Invalid key type");var t=new Uint8Array(32);return t.set(new Uint8Array(e).subarray(1)),t.buffer}function v(e){if(typeof e=="number")return s._malloc(e);var t=new Uint8Array(e.buffer||e),n=s._malloc(t.length);return s.HEAPU8.set(t,n),n}function S(e,t){var n=new Uint8Array(t);return n.set(s.HEAPU8.subarray(e,e+t)),n.buffer}function R(e,t){u();var n={};try{for(var r in e)n[r]=v(e[r]);return t(n)}finally{for(var o in n)s._free(n[o])}}function L(e,t){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield r("WAWebCryptoLibraryUtilsApi").signMsg(e.pubKey,e.privKey,t);return n}),E.apply(this,arguments)}function k(e,t,n){if(e.byteLength!==32)throw r("err")("Invalid public key length: "+e.byteLength);var o=new Uint8Array(33);return o[0]=_,o.set(e,1),r("WAWebCryptoLibraryUtilsApi").verifySignature(o,t,n)}l.keyPair=d,l.sharedSecret=p,l.toSignalCurveKeyPair=g,l.toSignalCurvePubKey=h,l.toCurveKeyPair=C,l.toCurveKeyPubKey=b,l.calculateSignature=L,l.verifySignature=k}),98);
__d("WASmaxInUserNoticeIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInUserNoticeIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInUserNoticeGetDisclosuresResponseClientError",["WAResultOrError","WASmaxInUserNoticeIQErrorBadRequestMixin","WASmaxInUserNoticeIQErrorResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInUserNoticeIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(r.value);if(!a.success)return a;var i=o("WASmaxInUserNoticeIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorIQErrorBadRequestMixin:a.value},i.value)):i}l.parseGetDisclosuresResponseClientError=e}),98);
__d("WASmaxInUserNoticeIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInUserNoticeStageMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"notice");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"id",0,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"stage",0,1e3);return r.success?o("WAResultOrError").makeResult({id:n.value,stage:r.value}):r}l.parseStageMixin=e}),98);
__d("WASmaxInUserNoticeGetDisclosuresResponseClientSuccess",["WAResultOrError","WASmaxInUserNoticeIQResultResponseMixin","WASmaxInUserNoticeStageMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"notice");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"t",0,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"version",1,void 0);if(!r.success)return r;var a=o("WASmaxParseUtils").attrIntRange(e,"type",0,void 0);if(!a.success)return a;var i=o("WASmaxInUserNoticeStageMixin").parseStageMixin(e);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({t:n.value,version:r.value,type:a.value},i.value)):i}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxInUserNoticeIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!a.success)return a;var i=o("WASmaxParseUtils").mapChildrenWithTag(t,"notice",0,1/0,e);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{notice:i.value})):i}l.parseGetDisclosuresResponseClientSuccessNotice=e,l.parseGetDisclosuresResponseClientSuccess=s}),98);
__d("WASmaxInUserNoticeIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",500);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorInternalServerErrorMixin=e}),98);
__d("WASmaxInUserNoticeIQErrorRateOverlimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","rate-overlimit");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",429);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorRateOverlimitMixin=e}),98);
__d("WASmaxInUserNoticeUserNoticeServerError",["WAResultOrError","WASmaxInUserNoticeIQErrorInternalServerErrorMixin","WASmaxInUserNoticeIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInUserNoticeIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:t.value});var n=o("WASmaxInUserNoticeIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorInternalServerError","IQErrorRateOverlimit"],[t,n])}l.parseUserNoticeServerError=e}),98);
__d("WASmaxInUserNoticeGetDisclosuresResponseServerError",["WAResultOrError","WASmaxInUserNoticeIQErrorResponseMixin","WASmaxInUserNoticeUserNoticeServerError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInUserNoticeIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInUserNoticeUserNoticeServerError").parseUserNoticeServerError(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorUserNoticeServerError:i.value})):i}l.parseGetDisclosuresResponseServerError=e}),98);
__d("WASmaxOutUserNoticeBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQGetRequestMixin=s}),98);
__d("WASmaxOutUserNoticeGetDisclosuresRequest",["WASmaxJsx","WASmaxOutUserNoticeBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.getUserDisclosuresT,n=o("WASmaxOutUserNoticeBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"tos"},o("WASmaxJsx").smax("get_user_disclosures",{t:o("WAWap").INT(t)})));return n}l.makeGetDisclosuresRequest=e}),98);
__d("WASmaxUserNoticeGetDisclosuresRPC",["WAComms","WASmaxInUserNoticeGetDisclosuresResponseClientError","WASmaxInUserNoticeGetDisclosuresResponseClientSuccess","WASmaxInUserNoticeGetDisclosuresResponseServerError","WASmaxOutUserNoticeGetDisclosuresRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutUserNoticeGetDisclosuresRequest").makeGetDisclosuresRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInUserNoticeGetDisclosuresResponseClientSuccess").parseGetDisclosuresResponseClientSuccess(r,n);if(a.success)return{name:"GetDisclosuresResponseClientSuccess",value:a.value};var i=o("WASmaxInUserNoticeGetDisclosuresResponseClientError").parseGetDisclosuresResponseClientError(r,n);if(i.success)return{name:"GetDisclosuresResponseClientError",value:i.value};var l=o("WASmaxInUserNoticeGetDisclosuresResponseServerError").parseGetDisclosuresResponseServerError(r,n);if(l.success)return{name:"GetDisclosuresResponseServerError",value:l.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("GetDisclosures",{ClientSuccess:a,ClientError:i,ServerError:l}))}),s.apply(this,arguments)}l.sendGetDisclosuresRPC=e}),98);
__d("WAWebGetUserDisclosuresQueryJob",["WASmaxUserNoticeGetDisclosuresRPC","WATimeUtils","WAWebBackendErrors","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=o("WATimeUtils").unixTime(),t=yield o("WASmaxUserNoticeGetDisclosuresRPC").sendGetDisclosuresRPC({getUserDisclosuresT:e});switch(t.name){case"GetDisclosuresResponseClientSuccess":return t.value.notice;case"GetDisclosuresResponseClientError":{var n=t.value.errorIQErrorBadRequestMixin,r=n.code,a=n.text;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(Number(r),a)}case"GetDisclosuresResponseServerError":{var i=t.value.errorUserNoticeServerError.value,l=i.code,s=i.text;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(Number(l),s)}}}),s.apply(this,arguments)}l.queryAllUserDisclosures=e}),98);
__d("WAWebGetUserDisclosuresJob",["WAJobOrchestratorTypes","WAWebGetUserDisclosuresQueryJob","WAWebOrchestratorNonPersistedJob"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getAllUserDisclosures",function(){return o("WAWebGetUserDisclosuresQueryJob").queryAllUserDisclosures()},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}l.getAllUserDisclosures=e}),98);
__d("WAWebTosJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebBackendErrors","WAWebNoop","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){var e=7200,s=259200,u=86400,c=new(r("WADeprecatedWapParser"))("tosNotices",function(t){t.assertTag("iq"),t.assertFromServer();var n=t.child("tos"),r={refresh:n.attrInt("refresh"),notice:[]};return n.forEachChildWithTag("notice",function(e){var t=e.maybeAttrString("state")!=="false",n=e.attrString("id");r.notice.push({id:n,state:t})}),(r.refresh>s||r.refresh<e)&&(r.refresh=u),r});function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=(t=o("WAWap")).wap("iq",{xmlns:"tos",id:t.generateId(),type:"get",to:t.S_WHATSAPP_NET},t.wap("request",null,e.map(function(e){return o("WAWap").wap("notice",{id:o("WAWap").CUSTOM_STRING(e)})}))),r=yield o("WADeprecatedSendIq").deprecatedSendIq(n,c);if(r.success)return r.result;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(r.errorCode,r.errorText)}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!r("gkx")("26258")){var t,n=new(r("WADeprecatedWapParser"))("tosNoticesDebug",r("WAWebNoop")),a=(t=o("WAWap")).wap("iq",{xmlns:"tos",id:t.generateId(),type:"set",to:t.S_WHATSAPP_NET},t.wap("delete",{id:e}));yield o("WADeprecatedSendIq").deprecatedSendIq(a,n)}}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=new(r("WADeprecatedWapParser"))("tosNoticesSet",r("WAWebNoop")),a=(t=o("WAWap")).wap("iq",{xmlns:"tos",id:t.generateId(),type:"set",to:t.S_WHATSAPP_NET},t.wap("request",{type:"session_update"},e.map(function(e){return o("WAWap").wap("notice",{id:o("WAWap").CUSTOM_STRING(e)})})));yield o("WADeprecatedSendIq").deprecatedSendIq(a,n)}),g.apply(this,arguments)}l.DEFAULT_TOS_REFRESH_INTERVAL=u,l.queryTosState=d,l.deleteTosState=p,l.updateTosState=f}),98);
__d("WAWebGetUserDisclosuresAction",["WATimeUtils","WAWebGetUserDisclosuresJob","WAWebTosJob","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=5;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WAWebGetUserDisclosuresJob").getAllUserDisclosures(),n=t.map(function(t){return{id:t.id.toString(),state:t.stage===e,timestamp:o("WATimeUtils").castToUnixTime(t.t)}});return{refresh:o("WAWebTosJob").DEFAULT_TOS_REFRESH_INTERVAL,notice:n}}),u.apply(this,arguments)}l.getUserDisclosuresAction=s}),98);
__d("WAWebWamEnumBlockEntryPoint",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,CHAT:1,PROFILE:2,BLOCK_LIST:3,TRIGGERED_BLOCK:4,ACCOUNT_INFO:5,CALL_LOG:6,OVERFLOW_MENU:7,GROUP_INFO:8,BLOCK_DIALOG:9,MESSAGE_MENU:10,MEDIA_VIEWER:11,OVERFLOW_MENU_BLOCK:12,ONE_TO_ONE_OLD_SPAM_BANNER_BLOCK:13,ONE_TO_ONE_SPAM_BANNER_BLOCK:14,BIZ_SPAM_BANNER_BLOCK:15,BLOCK_HEADER_CHAT:16,OVERFLOW_MENU_REPORT:17,ACCOUNT_INFO_REPORT:18,BIZ_OLD_SPAM_BANNER_BLOCK:19,CHAT_LIST_BLOCK:20,CHAT_LIST_NOINSUB_BLOCK:21,CHAT_LIST_CONTEXT_MENU_BLOCK:22,NOTIFICATION_BLOCK:23,ONE_TO_ONE_SPAM_BANNER_REPORT:24,BIZ_EXTENSION_MENU:25,VIEW_ONCE_VIEWER:26,STATUS_OVERFLOW_MENU_REPORT:27,ALBUM_MEDIA_MENU_REPORT:28,STATUS_POST_REPORT:29,MISSED_CALL_NOTIFICATION_BLOCK:30,CHAT_FMX_CARD_BLOCK:31,CHAT_FMX_CARD_BLOCK_SUSPICIOUS:32,CHAT_FMX_CARD_SAFETY_TOOLS_BLOCK:33,CHAT_FMX_CARD_SAFETY_TOOLS_BLOCK_SUSPICIOUS:34,CHAT_FMX_CARD_SAFETY_TOOLS_REPORT:35,CHAT_FMX_CARD_SAFETY_TOOLS_REPORT_SUSPICIOUS:36,ACCOUNT_INFO_BLOCK:37,CALL_LOG_BLOCK:38,BIZ_BLOCK_HEADER_CHAT:39,BIZ_OVERFLOW_MENU_BLOCK:40,PSA_BANNER_BLOCK:41,COMMENT_ACTIONS_BOTTOM_SHEET:42,CALL_SPAM_DIALOG_REPORT:43,CALL_SPAM_DIALOG_BLOCK:44,BIZ_ACCOUNT_INFO_BLOCK:45,BIZ_BLOCK_LIST:46,BIZ_CALL_LOG_BLOCK:47,ONGOING_CALL_LINK_BLOCK:48,ONE_TO_ONE_BLOCKED_CHAT_COMPOSER:49,CHAT_MORE_OPTIONS:50,CHAT_LONG_PRESS_OPTIONS:51,IAB_MENU_REPORT:52,DEPENDENT_CONVERSATION_BLOCKING_VIEW:53});i.BLOCK_ENTRY_POINT=e}),66);
__d("WAWebWamEnumMmSignalType",[],(function(t,n,r,o,a,i){var e=Object.freeze({USER_BLOCK:0,USER_REPORT:1,FIRST_CUSTOMER_MESSAGE:2,FIRST_CUSTOMER_MESSAGE_CONTINUATION:3,FIRST_BIZ_REPLY:4,FIRST_BIZ_REPLY_CONTINUATION:5,SECOND_CUSTOMER_MESSAGE:6,SECOND_CUSTOMER_MESSAGE_CONTINUATION:7,SECOND_BIZ_REPLY:8,SECOND_BIZ_REPLY_CONTINUATION:9,THIRD_CUSTOMER_MESSAGE:10,THIRD_CUSTOMER_MESSAGE_CONTINUATION:11,THIRD_BIZ_REPLY:12,USER_INTERESTED:13,USER_NOT_INTERESTED:14,USER_STOP_OFFERS:15,USER_BLOCK_REASON_NO_LONGER_NEEDED:16,USER_BLOCK_REASON_NO_SIGN_UP:17,USER_BLOCK_REASON_SPAM:18,USER_BLOCK_REASON_OFFENSIVE_MESSAGES:19,USER_BLOCK_REASON_OTP_DID_NOT_REQUEST:20,USER_BLOCK_REASON_OTHER:21,USER_MUTE:22,URL_CTA_CLICK:23,APP_CTA_CLICK:24,BODY_URL_CLICK:25,USER_BLOCK_REASON_SCAM_OR_FRAUD:26});i.MM_SIGNAL_TYPE=e}),66);
__d("WAWebMmSignalSharingGatingUtils",["WALogger","WAWebABProps","WAWebWamEnumBlockEntryPoint","WAWebWamEnumMmSignalType","WAWebWid"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(){return o("WAWebABProps").getABPropConfigValue("mm_data_sharing_disclosure_enabled")}function d(){return o("WAWebABProps").getABPropConfigValue("mm_data_sharing_disclosure_enabled_companion_history_sync")}function m(){return c()?o("WAWebABProps").getABPropConfigValue("data_sharing_transparency_indicator_duration"):0}function p(){return c()?o("WAWebABProps").getABPropConfigValue("ctwa_tos_filtering_enabled"):!1}function _(){return c()?o("WAWebABProps").getABPropConfigValue("disclosure_for_the_marketing_message_body_links_enabled"):!1}function f(){return c()?o("WAWebABProps").getABPropConfigValue("optimized_delivery_signal_collection_enabled"):!1}function g(){var t={store_consented_token_enabled:!1,store_non_consented_token_enabled:!1};if(!c())return t;try{return JSON.parse(o("WAWebABProps").getABPropConfigValue("optimized_delivery_tokens_storage_config"))}catch(r){var n=o("WAWebABProps").getABPropConfigValue("optimized_delivery_tokens_storage_config");return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[mmSignalSharing] parse tokens_storage_config failed: "," raw=",""])),r,n),t}}function h(){return c()?o("WAWebABProps").getABPropConfigValue("optimized_delivery_multiple_collection_windows_enabled"):!1}function y(){var e=168,t=Object.keys(o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE).map(function(e){return o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE[e]}),n={consented_collection_window_in_hours:e,non_consented_collection_window_in_hours:e,consented_types_allowlist:t,non_consented_types_allowlist:t};if(!c())return n;try{return JSON.parse(o("WAWebABProps").getABPropConfigValue("optimized_delivery_signal_collection_config"))}catch(e){return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[mmSignalSharing] fetch signal_collection_config err: ",""])),e),n}}function C(){return c()?o("WAWebABProps").getABPropConfigValue("mm_signal_sharing_verification_system_lid_enabled"):!1}function b(e){return e==null||!r("WAWebWid").isRegularUserNoImply(e)?!1:c()&&f()}function v(){var e=Object.values(o("WAWebWamEnumBlockEntryPoint").BLOCK_ENTRY_POINT).map(Number);if(!c())return e;try{return o("WAWebABProps").getABPropConfigValue("optimized_delivery_block_and_report_entry_points_allowlist_web").split(",").filter(function(e){return!isNaN(e)}).map(Number)}catch(t){return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[mmSignalSharing] fetch block_report_allowlist err: ",""])),t),e}}l.isMmSignalSharingDisclosureEnabled=c,l.isMmSignalSharingDisclosureEnabledFromCompanionHistorySync=d,l.getMmSignalSharingCollectionWindow=m,l.getMmSignalSharingTosFiltering=p,l.isMmSignalSharingDisclosureForMarketingMessageBodyLinksEnabled=_,l.getMmSignalSharingOptimizedDeliverySignalCollectionEnabled=f,l.getMmSignalSharingOptimizedDeliveryTokensStorageConfig=g,l.isMmSignalSharingOptimizedDeliveryMultipleCollectionWindowsEnabled=h,l.getMmSignalSharingOptimizedDeliverySignalCollectionConfig=y,l.getMmSignalSharingVerificationSystemLidEnabled=C,l.isMmSignalSharingCollectionEnabled=b,l.getMmSignalSharingBlockAndReportEntryPointsAllowlist=v}),98);
__d("WAWebWamoNewsletterGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("wamo_privacy_tos_show_channels_nux_enabled")}function s(){return o("WAWebABProps").getABPropConfigValue("newsletter_nux_notice_id")}function u(){return o("WAWebABProps").getABPropConfigValue("wamo_privacy_tos_unlinked_highlighted_notice_id")}function c(){return o("WAWebABProps").getABPropConfigValue("wamo_privacy_tos_linked_highlighted_notice_id")}function d(){return[s(),u(),c(),p()]}function m(){return o("WAWebABProps").getABPropConfigValue("wamo_privacy_tos_show_channels_nux_enabled")}function p(){return o("WAWebABProps").getABPropConfigValue("newsletter_admin_invite_nux_id")}l.shouldUseWamoTos=e,l.getNewsletterConsumerNux=s,l.getWamoUnlinkedTos=u,l.getWamoLinkedTos=c,l.getWamoNotices=d,l.shouldShowNewsletterAdminInviteNux=m,l.getNewsletterAdminInviteNux=p}),98);
__d("WAWebTos",["Promise","WACustomError","WAExponentialBackoff","WALogger","WAPromiseDelays","WATimeUtils","WAWebBackendErrors","WAWebBizGatingUtils","WAWebBotGating","WAWebBotTosIds","WAWebEventEmitter","WAWebGetUserDisclosuresAction","WAWebMmSignalSharingGatingUtils","WAWebMmSignalSharingTos","WAWebNewsletterGatingUtils","WAWebTosJob","WAWebUserPrefsKeys","WAWebUserPrefsMeUser","WAWebUserPrefsStore","WAWebWamoNewsletterGatingUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_="20210210",f=(function(e){function t(t){var n;return n=e.call(this,"Unknown user notice id: "+t)||this,n.name="UnknownUserNoticeIdError",n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError),g={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:new AbortController().signal},h=(function(t){function a(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,e.$TosManagerImpl$p_1=[],e.$TosManagerImpl$p_2=o("WAWebTosJob").DEFAULT_TOS_REFRESH_INTERVAL*1e3,babelHelpers.assertThisInitialized(e)||babelHelpers.assertThisInitialized(e)}babelHelpers.inheritsLoose(a,t);var i=a.prototype;return i.clearDisclosureNoticeIds_TESTONLY=function(){this.$TosManagerImpl$p_1=[]},i.$TosManagerImpl$p_3=function(){var e=new Set;if(o("WAWebBizGatingUtils").tosFetchEnabled()&&e.add(_),o("WAWebBotGating").isBotEnabled()){var t;e.add((t=o("WAWebBotTosIds")).getBotAgentTosId()),e.add(t.getBotInvokeTosId()),e.add(t.getBotShortcutTosId()),e.add(t.getBotLegacyShortcutTosId()),e.add(t.getBotLegacyInvokeTosId());var n=o("WAWebBotGating").getMasterBotNoticeId();n!=null&&e.add(n.toString())}return(o("WAWebBotGating").isBizBot1pEnabled()||o("WAWebBotGating").isBizBot3pEnabled())&&e.add(o("WAWebBotTosIds").getBizBotTosId()),o("WAWebBotGating").isUgcBotEnabled()&&e.add(o("WAWebBotTosIds").getUgcAiStudioTosId()),o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()&&e.add(o("WAWebMmSignalSharingTos").getMmSignalSharingDisclosureTosId()),Array.from(e)},i.$TosManagerImpl$p_4=function(){var e=this.$TosManagerImpl$p_3().concat(this.$TosManagerImpl$p_1);return e},i.$TosManagerImpl$p_5=function(t){var e=new Set(this.$TosManagerImpl$p_1.concat(t));this.$TosManagerImpl$p_1=Array.from(e)},i.getLastAcceptedTime=function(t){var e=this.$TosManagerImpl$p_6(t),n=r("WAWebUserPrefsStore").getUser(e);return n!=null&&typeof n=="number"?o("WATimeUtils").castToUnixTime(n):null},i.getState=function(n){try{var t=this.getStoreKey(n),a=r("WAWebUserPrefsStore").getUser(t),i=typeof a=="string"&&(a==="UNKNOWN"||a==="NOT_ACCEPTED"||a==="ACCEPTED")?a:"UNKNOWN";return i}catch(t){return t instanceof f||o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unexpected error when getting notice id state: ",""])),n).tags("tos-manager").sendLogs("Unexpected error when getting notice id state"),"UNKNOWN"}},i.setState=function(t,n,r){this.$TosManagerImpl$p_1.includes(t)||y()&&this.$TosManagerImpl$p_3().includes(t)?(this.$TosManagerImpl$p_7(t,n,r),this.trigger("change")):o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ToS state manager unrecognized user notice id: ",""])),t)},i.$TosManagerImpl$p_7=function(t,n,o){r("WAWebUserPrefsStore").setUser(this.getStoreKey(t),n),n==="ACCEPTED"&&o!=null?r("WAWebUserPrefsStore").setUser(this.$TosManagerImpl$p_6(t),o):r("WAWebUserPrefsStore").setUser(this.$TosManagerImpl$p_6(t),void 0)},i.run=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;if(!(!y()&&!o("WAWebNewsletterGatingUtils").isNewsletterEnabled())){try{yield o("WAExponentialBackoff").exponentialBackoff(g,function(e,n){return t.$TosManagerImpl$p_8().catch(function(t){if(t instanceof o("WAWebBackendErrors").ServerStatusCodeError)e:{if(t.statusCode===500){return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ToS state manager query failed, retriable error: ",", failCount ",""])),t.message,n),e(t);break e}break e}throw t})})}catch(e){if(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["ToS state manager state pull failed, error: ",""])),e).verbose().sendLogs("ToS state manager run failed"),!(e instanceof o("WAWebBackendErrors").ServerStatusCodeError&&e.statusCode===500))return}if((e==null?void 0:e.singleRun)!==!0&&this.$TosManagerImpl$p_9(this.$TosManagerImpl$p_4()).length>0){var n=o("WAWebUserPrefsMeUser").getMaybeMePnUser();yield o("WAPromiseDelays").delayMs(this.$TosManagerImpl$p_2),o("WAWebUserPrefsMeUser").getMaybeMePnUser()===n&&this.run()}}});function t(t){return e.apply(this,arguments)}return t})(),i.$TosManagerImpl$p_8=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=this;if(o("WAWebUserPrefsMeUser").getMaybeMePnUser()){var t=yield(p||(p=n("Promise"))).all([this.$TosManagerImpl$p_10(),this.$TosManagerImpl$p_11()]),a=t[0],i=t[1];this.$TosManagerImpl$p_2=Math.min(a.refresh,i.refresh)*1e3;var l=a.notice.concat(i.notice),s=new Set(this.$TosManagerImpl$p_4()),u=!1;l.filter(function(e){return s.has(e.id)}).forEach(function(t){var n=t.state?"ACCEPTED":"NOT_ACCEPTED",o=e.getStoreKey(t.id);r("WAWebUserPrefsStore").getUser(o)!==n&&(r("WAWebUserPrefsStore").setUser(o,n),e.$TosManagerImpl$p_7(t.id,n,t.timestamp),u=!0)}),r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.TOS_STATE_FETCH_ITERATION,o("WAWebBizGatingUtils").tosFetchIteration()),u&&this.trigger("change")}});function t(){return e.apply(this,arguments)}return t})(),i.$TosManagerImpl$p_12=function(){return{refresh:o("WAWebTosJob").DEFAULT_TOS_REFRESH_INTERVAL,notice:[]}},i.$TosManagerImpl$p_10=function(){if(!y())return(p||(p=n("Promise"))).resolve(this.$TosManagerImpl$p_12());var e=this.$TosManagerImpl$p_9(this.$TosManagerImpl$p_3());return e.length>0?o("WAWebTosJob").queryTosState(e):(p||(p=n("Promise"))).resolve(this.$TosManagerImpl$p_12())},i.$TosManagerImpl$p_11=function(){return o("WAWebNewsletterGatingUtils").isNewsletterEnabled()&&this.populateTosManagerNewsletterIds(),this.$TosManagerImpl$p_1.length===0?(p||(p=n("Promise"))).resolve(this.$TosManagerImpl$p_12()):o("WAWebGetUserDisclosuresAction").getUserDisclosuresAction()},i.$TosManagerImpl$p_9=function(t){var e=this,n=parseInt(r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.TOS_STATE_FETCH_ITERATION),10)||0;if(o("WAWebBizGatingUtils").tosFetchIteration()>n)return t;var a=t.map(function(t){return e.getState(t)});return t.filter(function(e,t){return a[t]!=="ACCEPTED"})},i.getStoreKey=function(t){var e=new Set(this.$TosManagerImpl$p_4());if(e.has(t))return"TOS_STATE_"+t;throw new f(t)},i.$TosManagerImpl$p_6=function(t){var e=new Set(this.$TosManagerImpl$p_4());if(e.has(t))return"TOS_STATE_"+t+"_LAST_ACCEPTED_TIME";throw new f(t)},i.maybeUpdateServer=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;if(y())try{var r=new Set(e);yield o("WAExponentialBackoff").exponentialBackoff(g,function(e,a){var i=t.$TosManagerImpl$p_13(r);return i.length>0?o("WAWebTosJob").updateTosState(i).catch(function(t){if(t instanceof o("WAWebBackendErrors").ServerStatusCodeError&&t.statusCode===500)return o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["ToS state manager server session state update failed, retriable error: ",", failCount ",""])),t.message,a),e(t);throw t}):(p||(p=n("Promise"))).resolve()})}catch(e){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["ToS state manager server session state update failed, error: ",""])),e).verbose().sendLogs("ToS state manager server session state update failed")}});function t(t){return e.apply(this,arguments)}return t})(),i.$TosManagerImpl$p_13=function(t){var e=this;if(o("WAWebUserPrefsMeUser").getMaybeMePnUser()){var n=this.$TosManagerImpl$p_3().map(function(t){return e.getState(t)});return this.$TosManagerImpl$p_3().filter(function(e,r){return n[r]==="ACCEPTED"&&t.has(e)})}return[]},i.$TosManagerImpl$p_14=function(t){r("WAWebUserPrefsStore").setUser(this.getStoreKey(t),void 0),r("WAWebUserPrefsStore").setUser(this.$TosManagerImpl$p_6(t),void 0)},i.resetAllState=function(){var e=this;this.$TosManagerImpl$p_4().forEach(function(t){e.$TosManagerImpl$p_14(t)}),o("WAWebTosJob").deleteTosState(_)},i.resetState=function(t){this.$TosManagerImpl$p_14(t),o("WAWebTosJob").deleteTosState(t)},i.populateTosManagerNewsletterIds=function(){var e=[o("WAWebNewsletterGatingUtils").getNewsletterProducerTos(),o("WAWebNewsletterGatingUtils").getNewsletterConsumerTos(),o("WAWebNewsletterGatingUtils").getNewsletterAdminInviteTos()].concat(o("WAWebWamoNewsletterGatingUtils").getWamoNotices());this.$TosManagerImpl$p_5(e)},a})(r("WAWebEventEmitter"));function y(){return o("WAWebBizGatingUtils").tosFetchEnabled()||o("WAWebBotGating").isBizBot1pEnabled()||o("WAWebBotGating").isBizBot3pEnabled()||o("WAWebBotGating").isUgcBotEnabled()}var C=new h;l.TOS_3_ID=_,l.TosManager=C}),98);
__d("WAWebBotUtils",["WAWebMsgKey","WAWebWid","WAWebWidFactory"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WAWebWidFactory").createUserWidOrThrow("13135550002@c.us"),s=o("WAWebWidFactory").createUserWidOrThrow("867051314767696@bot");function u(t){return t.equals(e)||t.equals(s)}function c(e){var t=e.botResponseTargetId;return t==null?null:new(r("WAWebMsgKey"))({fromMe:!0,remote:e.id.remote,id:t})}function d(e){return e instanceof r("WAWebWid")?e==null?void 0:e.equals(s):!1}function m(e){return e.some(function(e){return d(e.id)})}l.META_BOT_PN_WID=e,l.META_BOT_FBID_WID=s,l.isMetaAiBot=u,l.getBotResponseTargetMsgKey=c,l.isWidOpenGroupMetaBotFbidWid=d,l.participantListIncludOpenGroupBotWid=m}),98);
__d("WAWebBotGating",["WATimeUtils","WAWebABProps","WAWebBotGenTypingIndicatorMsg","WAWebBotTos","WAWebBotTosIds","WAWebBotUnifiedResponseGating","WAWebBotUtils","WAWebCommonMsgUtils","WAWebMobilePlatforms","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsDeviceCapabilities.pb","WAWebRichResponse.flow","WAWebThreadsGating","WAWebUserPrefsBot","justknobx"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebMobilePlatforms").isSMB()||!E()?!1:s()}function s(){return o("WAWebABProps").getABPropConfigValue("bonsai_enabled")===!0}function u(){return o("WAWebABProps").getABPropConfigValue("bonsai_entry_point_enabled")===!0}function c(){return e()&&o("WAWebABProps").getABPropConfigValue("bonsai_ptt_enabled")===!0}function d(t){return!e()||o("WAWebMsgGetters").getUnifiedResponse(t)!=null&&o("WAWebBotUnifiedResponseGating").isUnifiedResponseReceiverEnabled()?!1:!!o("WAWebMsgGetters").getIsMetaBotResponse(t)||t.subtype===o("WAWebBotGenTypingIndicatorMsg").BOT_TYPING_PLACEHOLDER_MSG_SUBTYPE}function m(){return o("WAWebABProps").getABPropConfigValue("wabai_message_rendering_enabled")}function p(){return o("WAWebABProps").getABPropConfigValue("wabai_message_feedback_enabled")}function _(){return o("WAWebABProps").getABPropConfigValue("bot_3p_status")!==0}function f(){return o("WAWebABProps").getABPropConfigValue("bot_3p_status")===2}function g(){return e()&&u()&&o("WAWebABProps").getABPropConfigValue("bonsai_chat_list_entry_point_enabled")}function h(){return e()&&u()&&!g()}function y(){return o("WAWebABProps").getABPropConfigValue("wabai_consent_cooldown")}function C(){return o("WAWebABProps").getABPropConfigValue("wabai_consent_required")}function b(){return e()&&o("WAWebABProps").getABPropConfigValue("bot_commands_1p_enabled")}var v,S,R;function L(e){R=e,v=null}function E(){var e;if(R==null)return!1;var t=R,n=(e=o("WAWebABProps").getABPropConfigValue("bonsai_supported_languages"))!=null?e:"en";if(S!==n||v==null){var r=n.toLowerCase().split(",").map(function(e){return e.trim()});S=n,v=r.includes(t)}return v}function k(){return o("WAWebABProps").getABPropConfigValue("bonsai_fp_ugc_sender")}function I(){return o("WAWebABProps").getABPropConfigValue("ai_home_graphql_enabled")}function T(){return o("WAWebABProps").getABPropConfigValue("ai_ugc_not_an_expert_enabled")}function D(){return o("WAWebABProps").getABPropConfigValue("ai_home_bot_profile_sync_interval_sec")*1e3}function x(){return e()?o("WAWebABProps").getABPropConfigValue("ai_web_forward_flow_enabled"):!1}function $(){return o("WAWebABProps").getABPropConfigValue("ai_forward_flow_surface_meta_ai_as_contact_enabled")}function P(){return o("WAWebABProps").getABPropConfigValue("ai_rich_response_main_gate_enabled")}function N(){return P()?o("WAWebMobilePlatforms").isSMB()?o("WAWebABProps").getABPropConfigValue("ai_rich_response_smb_web_structured_response_enabled"):o("WAWebABProps").getABPropConfigValue("ai_rich_response_web_structured_response_enabled"):!1}function M(){return P()?o("WAWebMobilePlatforms").isSMB()?o("WAWebABProps").getABPropConfigValue("ai_rich_response_smb_web_structured_response_receiver_enabled"):o("WAWebABProps").getABPropConfigValue("ai_rich_response_web_structured_response_receiver_enabled"):!1}function w(){return M()&&o("WAWebABProps").getABPropConfigValue("ai_rich_response_forward_receiving_enabled")}function A(e){return e.richResponse.parseState!==o("WAWebRichResponse.flow").RichResponseParseState.Unparsed&&M()}function F(e){return!(e.type===o("WAWebMsgType").MSG_TYPE.REVOKED||!o("WAWebMsgGetters").getIsBotSearchResponse(e)||o("WAWebCommonMsgUtils").isRichResponseMsg(e.type)&&!M())}function O(){return o("WAWebABProps").getABPropConfigValue("ai_chat_persistent_meta_ai_banner_enabled")}function B(){var e=o("WAWebABProps").getABPropConfigValue("ai_pdfn_tos_non_blocking_notices");return e.split(",").map(function(e){return e.trim()}).filter(function(e){return!isNaN(e)&&e!==""}).map(Number)}function W(){var e=o("WAWebABProps").getABPropConfigValue("ai_pdfn_tos_inline_notices");return e.split(",").map(function(e){return e.trim()}).filter(function(e){return!isNaN(e)&&e!==""}).map(Number)}function q(){return o("WAWebABProps").getABPropConfigValue("ai_chat_persistent_meta_ai_banner_logging_enabled")}function U(){var e=o("WAWebABProps").getABPropConfigValue("ai_pdfn_tos_master_notice_id");if(e.trim()==="")return null;var t=Number(e);return isNaN(t)?null:t}function V(){return o("WAWebABProps").getABPropConfigValue("ai_migrate_away_from_inline_tos_enabled")}function H(){var e=o("WAWebABProps").getABPropConfigValue("ai_experiment_graphql_config");if(e.trim()!==""){var t=e.split(",").map(function(e){return parseInt(e,10)}).filter(function(e){return!isNaN(e)});if(t.length!==0)return t}}function G(){return o("WAWebABProps").getABPropConfigValue("ai_search_null_state_update_interval")*1e3}function z(){return o("WATimeUtils").DAY_MILLISECONDS}function j(){return 1e3}function K(){return!(!e()||!u()||!o("WAWebBotTos").hasSeenShortcutTos()&&!o("WAWebBotTos").canShowBotTos(o("WAWebBotTosIds").getBotShortcutTosId()))}function Q(){return K()&&o("WAWebABProps").getABPropConfigValue("ai_search_experience_web_enabled")}function X(){return o("WAWebABProps").getABPropConfigValue("ai_search_null_state_row_count")}function Y(){return o("WAWebABProps").getABPropConfigValue("ai_search_max_num_suggestions")}function J(e){return e.trimmed().length>=3&&!e.hasFilter()}function Z(){return o("WAWebThreadsGating").isThreadsInfraEnabled()&&o("WAWebABProps").getABPropConfigValue("ai_chat_threads_infra_enabled")}function ee(){var e=o("WAWebUserPrefsBot").getPrimaryAiThreadSupportLevelFromLocalStorage();return e===o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.INFRA||e===o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.FULL}function te(){return ee()&&o("WAWebABProps").getABPropConfigValue("ai_chat_threads_web_enabled")}function ne(){return o("WAWebABProps").getABPropConfigValue("ai_chat_thread_capability_enabled")}function re(){return o("WAWebABProps").getABPropConfigValue("ai_forward_attribution_enabled")}function oe(e){return o("WAWebBotUtils").isMetaAiBot(e.from)&&r("justknobx")._("5352")}function ae(e){return o("WAWebBotUtils").isMetaAiBot(e)?o("WAWebABProps").getABPropConfigValue("ai_session_transparency_meta_ai_enabled"):o("WAWebABProps").getABPropConfigValue("ai_continuous_session_transparency_notice_enabled")}function ie(){return o("WAWebABProps").getABPropConfigValue("ai_chat_threads_web_msgs_load_limit")}function le(){return K()&&o("WAWebABProps").getABPropConfigValue("ai_web_ask_meta_ai_enabled")}function se(){return o("WAWebABProps").getABPropConfigValue("ai_mode_selector_enabled")}function ue(){return se()&&o("WAWebABProps").getABPropConfigValue("is_ai_mode_selector_visible")}function ce(){return!1}function de(){return o("WAWebABProps").getABPropConfigValue("ai_rich_response_reasoning_enabled")}function me(){return o("WAWebABProps").getABPropConfigValue("ai_chat_threads_historical_messages_migration_enabled")}l.isBotEnabled=e,l.isBotPttEnabled=c,l.shouldAnimateAsBotStream=d,l.isBizBot1pEnabled=m,l.isBizBot1pFeedbackEnabled=p,l.isBizBot3pEnabled=_,l.isBizBot3pAvailable=f,l.isBotShortcutEntryPointEnabled=g,l.isBotNewChatEntryPointEnabled=h,l.bizBotConsentDismissalCooldown=y,l.isBizBotConsentRequired=C,l.isMetaBotCommandsEnabled=b,l.setBonsaiUserLanguage=L,l.isFbidBotEnabled=k,l.isUgcBotEnabled=I,l.isUgcNotExpertEnabled=T,l.ugcBotProfileSyncInterval=D,l.isAiWebForwardEnabled=x,l.isAiAsContactEnabled=$,l.isRichStructuredResponseEnabled=N,l.isRichStructuredResponseReceiverEnabled=M,l.isRichResponseForwardReceivingEnabled=w,l.shouldRenderStructuredRichResponseMsg=A,l.showBotSearchPlugin=F,l.isAiChatPersistentMetaAIBannerEnabled=O,l.getNonBlockingBotNoticeIds=B,l.getInlineBotNoticeIds=W,l.isAiChatPersistentMetaAIBannerLoggingEnabled=q,l.getMasterBotNoticeId=U,l.isMigrateAwayFromInlineBotTosEnabled=V,l.getAiExperimentGraphqlConfig=H,l.getMetaAISearchNullStateSuggestionsUpdateIntervalMs=G,l.getMetaAISearchTypeAheadSuggestionsUpdateIntervalMs=z,l.getMetaAISearchTypeAheadSuggestionsLRUCacheCapacity=j,l.isMetaAISearchExperienceEnabled=Q,l.getMetaAISearchNullStateRowCount=X,l.getMetaAISearchTypeAheadMaxSuggestionsCount=Y,l.canSearchMetaAiSuggestions=J,l.isAiChatThreadsInfraEnabled=Z,l.isAiChatThreadsEnabled=te,l.isAiThreadCapabilityEnabled=ne,l.isAiForwardAttributionEnabled=re,l.isLoadingMediaMessagesEnabled=oe,l.isAiContinuousSessionTransparencyNoticeEnabled=ae,l.getAiThreadMsgsLoadLimit=ie,l.isAskMetaAiEnabled=le,l.isAiModeSelectorMessagingEnabled=se,l.isAiModeSelectorVisible=ue,l.isAiModeSelectorInteractive=ce,l.isRichResponseReasoningEnabled=de,l.isAiChatThreadsHistoricalMessageMigrationEnabled=me}),98);
__d("WAWebBotGenTypingIndicatorMsg",["WAWebABProps","WAWebBackendApi","WAWebBotGating","WAWebMsgKey","WAWebMsgType","WAWebWid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e="bot_typing_placeholder";function s(e,t){u(e,t)&&c(e)}function u(e,t){var n,a=o("WAWebBotGating").isBotEnabled()&&e.id instanceof r("WAWebWid")&&e.id.isBot(),i=o("WAWebBotGating").isBizBot3pEnabled()&&((n=e.contact.businessProfile)==null?void 0:n.isBizBot3p)===!0;return(a||i)&&t.type!==o("WAWebMsgType").MSG_TYPE.PROTOCOL&&t.type===o("WAWebMsgType").MSG_TYPE.CHAT}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t;if(o("WAWebBotGating").isBotEnabled()){var n=e.id;if(!(n instanceof r("WAWebWid")&&!n.isBot()&&!((t=e.contact.businessProfile)!=null&&t.isBizBot3p))){var a=new(r("WAWebMsgKey"))({fromMe:!1,remote:n,id:r("WAWebMsgKey").newId_DEPRECATED()});o("WAWebBackendApi").frontendFireAndForget("addInitialBotTypingIndicatorToChat",{chatId:n,msgKey:a})}}}),d.apply(this,arguments)}function m(){var e=o("WAWebABProps").getABPropConfigValue("bonsai_ti_timeout_duration_ms");return e}l.BOT_TYPING_PLACEHOLDER_MSG_SUBTYPE=e,l.maybeGenBotTypingIndicatorMessage=s,l.getBotTypingIndicatorTimeout=m}),98);
__d("WAWebPDFNTypes",[],(function(t,n,r,o,a,i){var e=Object.freeze({PDFN_ACCEPTED:"5"}),l=Object.freeze({ACCEPTED:5,OK:155}),s=Object.freeze({ACCEPTED:"ACCEPTED"});i.NOTICE_STAGES=e,i.DISCLOSURE_STAGE=l,i.NOTICE_STATUS=s}),66);
__d("WAWebBotTos",["WATimeUtils","WAWebBotGating","WAWebBotTosIds","WAWebBotTypes","WAWebPDFNTypes","WAWebSetUserDisclosureStageAction","WAWebTos","WAWebUserPrefsStore","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e="BIZ_BOT_TOS_DISMISSED_AT";function s(){var e;return(e=o("WAWebBotGating").getNonBlockingBotNoticeIds())==null?void 0:e.some(function(e){return o("WAWebTos").TosManager.getState(String(e))==="ACCEPTED"})}function u(){return c()||d()||m()}function c(){return o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getBotAgentTosId())==="ACCEPTED"}function d(){return o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getBotInvokeTosId())==="ACCEPTED"||o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getBotLegacyInvokeTosId())==="ACCEPTED"}function m(){return o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getBotShortcutTosId())==="ACCEPTED"||o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getBotLegacyShortcutTosId())==="ACCEPTED"}function p(){var e=o("WAWebBotGating").getMasterBotNoticeId();return e==null?!1:o("WAWebTos").TosManager.getState(String(e))==="ACCEPTED"}function _(t){if(t===o("WAWebBotTypes").BizBotType.BIZ_1P&&!o("WAWebBotGating").isBizBotConsentRequired()||f())return!0;var n=r("WAWebUserPrefsStore").getUser(e);if(typeof n!="number")return!1;var a=o("WAWebBotGating").bizBotConsentDismissalCooldown();return a<0?!0:a===0?!1:o("WATimeUtils").unixTime()-n<a}function f(){return o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getBizBotTosId())==="ACCEPTED"}function g(){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield L(Number(o("WAWebBotTosIds").getBotAgentTosId()))}),h.apply(this,arguments)}function y(){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield L(Number(o("WAWebBotTosIds").getBotInvokeTosId()))}),C.apply(this,arguments)}function b(){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield L(Number(o("WAWebBotTosIds").getBotShortcutTosId()))}),v.apply(this,arguments)}function S(){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield L(Number(o("WAWebBotTosIds").getBizBotTosId()))}),R.apply(this,arguments)}function L(e){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebSetUserDisclosureStageAction").updateUserDisclosureStateAction(e,o("WAWebPDFNTypes").DISCLOSURE_STAGE.ACCEPTED)}),E.apply(this,arguments)}function k(t){r("WAWebUserPrefsStore").setUser(e,t)}function I(){return o("WAWebTos").TosManager.getState(o("WAWebBotTosIds").getUgcAiStudioTosId())==="ACCEPTED"}function T(e){var t=o("WAWebBotGating").getNonBlockingBotNoticeIds();return t.length===0?!1:t.includes(Number(e))}function D(e){var t=o("WAWebBotGating").getMasterBotNoticeId();return t!=null&&e===t}function x(e){if(T(Number(e)))return!0;var t=o("WAWebBotGating").getMasterBotNoticeId();return t!=null?!0:o("WAWebBotTosIds").supportedTosNoticeIds.has(e)}l.hasAcceptedNonBlockingBotTos=s,l.hasSeenBotTos=u,l.hasSeenAgentTos=c,l.hasSeenInvokeTos=d,l.hasSeenShortcutTos=m,l.hasSeenMasterBotTos=p,l.hasSeenBizBotTos=_,l.hasAcceptedBizBotTos=f,l.markSeenAgentTos=g,l.markSeenInvokeTos=y,l.markSeenShortcutTos=b,l.acceptBizBotTos=S,l.setBizBotTosDismissalTime=k,l.hasSeenUgcTos=I,l.isNonBlockingBotNotice=T,l.isMasterBotTosNotice=D,l.canShowBotTos=x}),98);
__d("WAWebWamEnumAdditionalCategoryType",[],(function(t,n,r,o,a,i){var e=Object.freeze({META_AI_MODEL_BASE:1,META_AI_MODEL_PREMIUM:2});i.ADDITIONAL_CATEGORY_TYPE=e}),66);
__d("WAWebWamEnumBotDiscoveryPathType",[],(function(t,n,r,o,a,i){var e=Object.freeze({CURATED_DISPLAY:1,SEARCH:2,VIEW_ALL:3,DEEPLINK_USER_SHARED:4,INFINITE_SCROLL:5});i.BOT_DISCOVERY_PATH_TYPE=e}),66);
__d("WAWebWamEnumBotEntryPointType",[],(function(t,n,r,o,a,i){var e=Object.freeze({WA_CHAT:1,STATUS:2,NEW_CHAT:3,INVOKE:4,SHARED_AI:5,NOTIFICATION:6,BANNER:7,AI_CHATS_LIST_BUTTON:8,AI_CONTACT_ON_WA:9,DEEPLINK_USER_SHARED:10,DEEPLINK_QP:11,AI_SEARCH_CHATS_LIST:12,CHAT_INFO_PAGE:13,AI_VOICE:14,AI_CHAT_SHORTCUT:15,AI_IMAGINE_BOTTOM_SHEET:16,AI_HOME_PREVIEW:17,AI_SEARCH_CHATS_LIST_VOICE:18,AI_CHAT_THREAD_VOICE:19,AI_FAB_VOICE:20,CHAT_INFO_SETTINGS:21,CHAT_THREAD:22,AI_MEMORY_BOTTOM_SHEET:23,FORWARD:24,AI_MEMORY_SYSTEM_MESSAGE:25,AI_WIDGET:26,SHARE:27,AI_NEW_FAB_VOICE:28,AI_TAB_DISCOVERY:29,CHAT_LIST:30,AI_TAB:31,AI_HOME_IN_TAB:32,AI_NULL_STATE:33,AI_STUDIO_CREATION:34,AI_STUDIO_PROFILE_EDIT:35,BOT_SETTINGS:36,META_AI_LONG_PRESS_CONTEXT_MENU:37,FAB:38,AI_NEW_FAB_VOICE_CALL_HISTORY:39,AI_STUDIO_CREATION_FAB:40,INVOKE_META_AI_1ON1:41,INVOKE_META_AI_GROUP:42,AI_STUDIO_YOUR_AI:43,ASK_META_AI_CONTEXT_MENU:44,META_AI_SETTINGS:45,AI_STICKERS_BOTTOM_SHEET:46});i.BOT_ENTRY_POINT_TYPE=e}),66);
__d("WAWebWamEnumDiscoveryOriginType",[],(function(t,n,r,o,a,i){var e=Object.freeze({AI_TAB:1,AI_HOME:2,AI_HOME_IN_TAB:3});i.DISCOVERY_ORIGIN_TYPE=e}),66);
__d("WAWebWamEnumInlineTosStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({SUCCESS:1,FAIL:2});i.INLINE_TOS_STATUS=e}),66);
__d("WAWebWamEnumInputType",[],(function(t,n,r,o,a,i){var e=Object.freeze({SUGGESTION:1,USER_INPUT:2,USER_INPUT_AND_SUGGESTION:3});i.INPUT_TYPE=e}),66);
__d("WAWebBotJourneyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAdditionalCategoryType","WAWebWamEnumBotDiscoveryPathType","WAWebWamEnumBotEntryPointType","WAWebWamEnumChatFilterActionTypes","WAWebWamEnumDiscoveryOriginType","WAWebWamEnumInlineTosStatus","WAWebWamEnumInputType","WAWebWamEnumTsSurface"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({BotJourney:[4630,{actionType:[1,o("WAWebWamEnumChatFilterActionTypes").CHAT_FILTER_ACTION_TYPES],additionalCategory:[11,o("WAWebWamEnumAdditionalCategoryType").ADDITIONAL_CATEGORY_TYPE],aiCreationAvatarCropChanges:[38,e.TYPES.STRING],aiCreationInputType:[29,o("WAWebWamEnumInputType").INPUT_TYPE],aiCreationPersonalityCategoryInsert:[26,e.TYPES.STRING],aiCreationPersonalityCategorySelect:[27,e.TYPES.STRING],aiDiscoveryTab:[4,e.TYPES.STRING],aiSessionId:[18,e.TYPES.STRING],aiVoiceOnSelectionDefault:[24,e.TYPES.BOOLEAN],aiVoiceSelectionEnum:[25,e.TYPES.STRING],appSessionId:[2,e.TYPES.STRING],botDiscoveryPath:[8,o("WAWebWamEnumBotDiscoveryPathType").BOT_DISCOVERY_PATH_TYPE],botEntryPoint:[7,o("WAWebWamEnumBotEntryPointType").BOT_ENTRY_POINT_TYPE],botPersonaId:[5,e.TYPES.STRING],callRandomId:[13,e.TYPES.STRING],categoryType:[40,e.TYPES.STRING],conversationStarterCategory:[22,e.TYPES.STRING],conversationStarterIndex:[23,e.TYPES.INTEGER],conversationStarterLabel:[46,e.TYPES.STRING],conversationStarterPromptMode:[28,e.TYPES.STRING],deviceLanguage:[16,e.TYPES.STRING],discoveryOrigin:[19,o("WAWebWamEnumDiscoveryOriginType").DISCOVERY_ORIGIN_TYPE],eventTsMs:[47,e.TYPES.INTEGER],hasContinueChatting:[41,e.TYPES.BOOLEAN],hasYourAiCategory:[42,e.TYPES.BOOLEAN],inlineTosNoticeId:[20,e.TYPES.STRING],inlineTosStatus:[21,o("WAWebWamEnumInlineTosStatus").INLINE_TOS_STATUS],interestCategoriesSelected:[39,e.TYPES.INTEGER],isCache:[45,e.TYPES.BOOLEAN],isMetaAiAssistant:[12,e.TYPES.BOOLEAN],isMetaAiCharacterBotChat:[9,e.TYPES.BOOLEAN],isUserCreatedAgent:[10,e.TYPES.BOOLEAN],metricCount:[17,e.TYPES.INTEGER],scrollDepth:[44,e.TYPES.INTEGER],scrollFetchLatency:[43,e.TYPES.INTEGER],uiSurface:[6,o("WAWebWamEnumTsSurface").TS_SURFACE],xmaReelIndex:[14,e.TYPES.INTEGER],xmaReelMaxIndex:[15,e.TYPES.INTEGER]},[1,1,1],"regular"]},{BotJourney:[[[],["appSessionId","actionType","botEntryPoint"],[]]]});l.BotJourneyWamEvent=s}),98);
__d("WAWebGetSharedSessionId",["WAWebPonyfillsCryptoRandomUUID"],(function(t,n,r,o,a,i,l){var e=r("WAWebPonyfillsCryptoRandomUUID")();function s(){return e}l.getSharedSessionId=s}),98);
__d("WAWebBotLogging",["$InternalEnum","WAWebBotJourneyWamEvent","WAWebBotUtils","WAWebChatEntryPoint","WAWebGetSharedSessionId","WAWebWamEnumBotEntryPointType","WAWebWamEnumChatFilterActionTypes"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum").Mirrored(["Agent","Shortcut","Invoke","Search"]),s=n("$InternalEnum").Mirrored(["View","Accept","Dismiss"]),u=(function(){var t=new Set;return e.members().forEach(function(n){e:{if(n===e.Agent||n===e.Shortcut){t.add(n);break e}if(n===e.Search||n===e.Invoke)break e;throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)}}),t})(),c=(function(){var e=new Set;return o("WAWebChatEntryPoint").ChatEntryPoint.members().forEach(function(t){e:{if(t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAINullStateSuggestion||t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAITypeaheadSuggestion){e.add(t);break e}if(t===o("WAWebChatEntryPoint").ChatEntryPoint.BotChatListShortcut||t===o("WAWebChatEntryPoint").ChatEntryPoint.Chatlist||t===o("WAWebChatEntryPoint").ChatEntryPoint.ChatsTab||t===o("WAWebChatEntryPoint").ChatEntryPoint.CommunitiesTab||t===o("WAWebChatEntryPoint").ChatEntryPoint.ContactInfo||t===o("WAWebChatEntryPoint").ChatEntryPoint.Deeplink||t===o("WAWebChatEntryPoint").ChatEntryPoint.DirectMessage||t===o("WAWebChatEntryPoint").ChatEntryPoint.ForwardedNewsletterMessage||t===o("WAWebChatEntryPoint").ChatEntryPoint.Link||t===o("WAWebChatEntryPoint").ChatEntryPoint.Mention||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsLetterRecommendation||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterAdminInviteAcceptModal||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterCTAOnStatus||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterChatlist||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterCreationFlow||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterDirectory||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterDirectoryCategory||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterDirectoryCategorySearch||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterDirectorySearch||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterIntegrity||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCard||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCardButton||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterPostLinkCard||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterUpdatesTab||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterUpdatesTabSearch||t===o("WAWebChatEntryPoint").ChatEntryPoint.NewslettersTab||t===o("WAWebChatEntryPoint").ChatEntryPoint.Notification||t===o("WAWebChatEntryPoint").ChatEntryPoint.PrivateReply||t===o("WAWebChatEntryPoint").ChatEntryPoint.SimilarNewsletters||t===o("WAWebChatEntryPoint").ChatEntryPoint.Unknown||t===o("WAWebChatEntryPoint").ChatEntryPoint.Vcard||t===o("WAWebChatEntryPoint").ChatEntryPoint.VoipWindow||t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAIThreadList||t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAINewThreadCreation||t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAINavigationBar||t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAIIntroPanel||t===o("WAWebChatEntryPoint").ChatEntryPoint.MetaAIForward||t===o("WAWebChatEntryPoint").ChatEntryPoint.AskMetaAI||t===o("WAWebChatEntryPoint").ChatEntryPoint.RefreshRestore)break e;throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)}}),e})();function d(t){switch(t){case e.Agent:return o("WAWebWamEnumBotEntryPointType").BOT_ENTRY_POINT_TYPE.AI_CONTACT_ON_WA;case e.Shortcut:return o("WAWebWamEnumBotEntryPointType").BOT_ENTRY_POINT_TYPE.AI_CHATS_LIST_BUTTON;case e.Invoke:return o("WAWebWamEnumBotEntryPointType").BOT_ENTRY_POINT_TYPE.INVOKE;case e.Search:return o("WAWebWamEnumBotEntryPointType").BOT_ENTRY_POINT_TYPE.AI_SEARCH_CHATS_LIST}}function m(e){switch(e){case s.View:return o("WAWebWamEnumChatFilterActionTypes").CHAT_FILTER_ACTION_TYPES.AI_TOS_VIEW;case s.Accept:return o("WAWebWamEnumChatFilterActionTypes").CHAT_FILTER_ACTION_TYPES.AI_TOS_ACCEPT_CLICK;case s.Dismiss:return o("WAWebWamEnumChatFilterActionTypes").CHAT_FILTER_ACTION_TYPES.AI_TOS_DISMISS_CLICK}}function p(e){if(u.has(e)){var t=new(o("WAWebBotJourneyWamEvent")).BotJourneyWamEvent({appSessionId:o("WAWebGetSharedSessionId").getSharedSessionId(),actionType:o("WAWebWamEnumChatFilterActionTypes").CHAT_FILTER_ACTION_TYPES.AI_CHAT_CLICK,botEntryPoint:d(e)});t.commit()}}function _(e,t){var n=new(o("WAWebBotJourneyWamEvent")).BotJourneyWamEvent({appSessionId:o("WAWebGetSharedSessionId").getSharedSessionId(),actionType:m(t),botEntryPoint:d(e)});n.commit()}function f(t,n){return c.has(n)?e.Search:n===o("WAWebChatEntryPoint").ChatEntryPoint.BotChatListShortcut||o("WAWebBotUtils").isMetaAiBot(t)?e.Shortcut:e.Agent}l.BotEntryPointType=e,l.BotTosActionType=s,l.logAiChatClickBotJourneyEvent=p,l.logAiTosBotJourneyEvent=_,l.getBotEntryPoint=f}),98);
__d("WAWebBotTosIds",["WAWebABProps","WAWebBotGating","WAWebBotLogging"],(function(t,n,r,o,a,i,l){var e="20230901",s="20230902",u="20240216",c="20231027",d="20240729",m=new Set([e,s,u]),p=function(){var t=o("WAWebABProps").getABPropConfigValue("ai_pdfn_tos_shortcut_notice_id").trim(),n=t!=null&&t!==""?t:e;return n},_=function(){var e=o("WAWebABProps").getABPropConfigValue("ai_pdfn_tos_shortcut_notice_id").trim(),t=e!=null&&e!==""?e:u;return t},f=function(){var e=o("WAWebABProps").getABPropConfigValue("ai_pdfn_tos_invoke_notice_id").trim(),t=e!=null&&e!==""?e:s;return t};function g(){return u}function h(){return s}var y=function(){return c},C=function(t){var e=o("WAWebBotGating").getMasterBotNoticeId();if(e!=null)return e;switch(t){case o("WAWebBotLogging").BotEntryPointType.Shortcut:case o("WAWebBotLogging").BotEntryPointType.Search:return Number(_());case o("WAWebBotLogging").BotEntryPointType.Invoke:return Number(f());case o("WAWebBotLogging").BotEntryPointType.Agent:return Number(p())}},b=function(){return d};l.supportedTosNoticeIds=m,l.getBotAgentTosId=p,l.getBotShortcutTosId=_,l.getBotInvokeTosId=f,l.getBotLegacyShortcutTosId=g,l.getBotLegacyInvokeTosId=h,l.getBizBotTosId=y,l.getApplicableBotNoticeId=C,l.getUgcAiStudioTosId=b}),98);
__d("WAWebBotUnifiedResponseGating",["WAWebABProps","WAWebBotGating"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebBotGating").isRichStructuredResponseReceiverEnabled()&&o("WAWebABProps").getABPropConfigValue("ai_unified_response_imagine_receiver_web_enabled")}function s(){return o("WAWebBotGating").isRichStructuredResponseReceiverEnabled()&&o("WAWebABProps").getABPropConfigValue("ai_unified_response_receiver_web_enabled")}function u(){return o("WAWebABProps").getABPropConfigValue("ai_unified_response_sender_web_enabled")}function c(){return o("WAWebABProps").getABPropConfigValue("ai_unified_response_qpl_logging")}l.isUnifiedResponseImagineReceiverEnabled=e,l.isUnifiedResponseReceiverEnabled=s,l.isUnifiedResponseSendingEnabled=u,l.isUnifiedResponseQPLLoggingEnabled=c}),98);
__d("WAWebTimedCache",["WALogger","WATimeUtils","WAWebApiHydrateWidsUtil","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(e,t){if(e==null)return null;var n=o("WATimeUtils").unixTimeMs(),r=e.timestamp,a=e.value,i=n-r;return i<t?a:null}function m(e){return{timestamp:o("WATimeUtils").unixTimeMs(),value:e}}var p=(function(){function t(e){var t=e.getCacheTtlMs,n=e.mapLoad,r=e.mapStore;this.$1=n,this.$2=r,this.$3=t}var r=t.prototype;return r.get=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{var n,r=this.$1(),a=(n=JSON.stringify(t))!=null?n:"",i=r==null?void 0:r.get(a),l=o("WAWebApiHydrateWidsUtil").hydrateWids(i);return d(l,this.$3())}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to get cache value"]))).tags("newsletter").sendLogs("[TimedMapCache] Failed to get value from cache"),null}});function r(e){return t.apply(this,arguments)}return r})(),r.set=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n,r,a=(n=this.$1())!=null?n:new Map,i=(r=JSON.stringify(e))!=null?r:"",l=m(t);a==null||a.set(i,l),yield this.$2(a)}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to set cache value"]))).tags("newsletter").sendLogs("[TimedMapCache] Failed to set value in cache");return}});function t(t,n){return e.apply(this,arguments)}return t})(),r.remove=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{var t,n=this.$1();if(n==null)return;var r=(t=JSON.stringify(e))!=null?t:"";n==null||n.delete(r),yield this.$2(n)}catch(e){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove cache value"]))).tags("newsletter").sendLogs("[TimedMapCache] Failed to remove value from cache");return}});function t(t){return e.apply(this,arguments)}return t})(),r.pop=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var e=this.$1();if(e==null)return null;var t=e.entries().next().value;if(t==null)return null;var n=t[0],r=t[1];e==null||e.delete(n),yield this.$2(e);var a=o("WAWebApiHydrateWidsUtil").hydrateWids(r);return d(a,this.$3())}catch(e){return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to pop cache value"]))).tags("newsletter").sendLogs("[TimedMapCache] Failed to pop value from cache"),null}});function t(){return e.apply(this,arguments)}return t})(),r.size=function(){var e,t=this.$1();return(e=t==null?void 0:t.size)!=null?e:0},t})(),_=(function(e){function t(t){var n,r=t.capacity,o=t.getCacheTtlMs,a=t.mapLoad,i=t.mapStore;return n=e.call(this,{mapLoad:a,mapStore:i,getCacheTtlMs:o})||this,n.$TimedLRUMapCache$p_1=r,n}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.get=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield e.prototype.get.call(this,t);return n!=null&&(yield e.prototype.remove.call(this,t),yield e.prototype.set.call(this,t,n)),n});function r(e){return t.apply(this,arguments)}return r})(),r.set=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){yield e.prototype.remove.call(this,t),yield e.prototype.set.call(this,t,n),this.size()>this.$TimedLRUMapCache$p_1&&(yield e.prototype.pop.call(this))});function r(e,n){return t.apply(this,arguments)}return r})(),t})(p);l.getTimedCacheItemValue=d,l.createTimedCacheItem=m,l.TimedMapCache=p,l.TimedLRUMapCache=_}),98);
__d("WAWebUserPrefsDeviceCapabilities",["WAWebProtobufsDeviceCapabilities.pb","WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(t,n,r,o,a,i,l){var e={chatLockSupportLevel:o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$ChatLockSupportLevel.NONE,aiThread:{supportLevel:o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.NONE}};function s(t){var n={chatLockSupportLevel:t.chatLockSupportLevel!=null?t.chatLockSupportLevel:e.chatLockSupportLevel,aiThread:{supportLevel:t.aiThread.supportLevel!=null?t.aiThread.supportLevel:o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.NONE}};return n}function u(t){var n,r,a=(n=typeof t=="object"&&t!=null&&typeof t.chatLockSupportLevel=="number"?o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$ChatLockSupportLevel.cast(t.chatLockSupportLevel):null)!=null?n:e.chatLockSupportLevel,i=(r=typeof t=="object"&&t!=null&&t.aiThread!=null&&typeof t.aiThread.supportLevel=="number"?o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.cast(t.aiThread.supportLevel):null)!=null?r:o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.NONE;return{chatLockSupportLevel:a,aiThread:{supportLevel:i}}}function c(e){switch(e){case"self":return o("WAWebUserPrefsKeys").UserPrefs.DeviceCapabilities;case"primary":return o("WAWebUserPrefsKeys").UserPrefs.PrimaryDeviceCapabilities}}function d(e,t){var n=s(e);r("WAWebUserPrefsStore").setUser(c(t),n,{shouldWriteToIdb:!1})}function m(e){var t=r("WAWebUserPrefsStore").getUser(c(e));return u(t)}function p(e,t){var n=m(t),r=babelHelpers.extends({},n,e);return d(r,t),r}function _(){return m("primary")}l.mergeDeviceCapabilitiesToStorage=p,l.getPrimaryDeviceCapabilitiesFromLocalStorage=_}),98);
__d("WAWebUserPrefsBot",["WAWebBotGating","WAWebProtobufsDeviceCapabilities.pb","WAWebTimedCache","WAWebUserPrefsDeviceCapabilities","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(t,n,r,o,a,i,l){function e(){var e=r("WAWebUserPrefsStore").get(o("WAWebUserPrefsKeys").MD_KEYS.BOT_LIST_LAST_REQUESTED_TIMESTAMP),t=typeof e=="number"?e:0;return t}function s(e){r("WAWebUserPrefsStore").set(o("WAWebUserPrefsKeys").MD_KEYS.BOT_LIST_LAST_REQUESTED_TIMESTAMP,e)}function u(){var e=r("WAWebUserPrefsStore").get(o("WAWebUserPrefsKeys").MD_KEYS.UGC_BOT_LIST_LAST_REQUESTED_TIMESTAMP),t=typeof e=="number"?e:0;return t}function c(e){r("WAWebUserPrefsStore").set(o("WAWebUserPrefsKeys").MD_KEYS.UGC_BOT_LIST_LAST_REQUESTED_TIMESTAMP,e)}function d(){var e=r("WAWebUserPrefsStore").get(o("WAWebUserPrefsKeys").MD_KEYS.UGC_BOT_LIST_LAST_BHASH);return typeof e=="string"?e:null}function m(e){r("WAWebUserPrefsStore").set(o("WAWebUserPrefsKeys").MD_KEYS.UGC_BOT_LIST_LAST_BHASH,e)}var p=new(o("WAWebTimedCache")).TimedMapCache({mapLoad:function(){return o("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(o("WAWebUserPrefsKeys").KEYS.WA_WEB_CACHED_META_AI_SEARCH_NULL_STATE_SUGGESTIONS)},mapStore:function(t){return o("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(o("WAWebUserPrefsKeys").KEYS.WA_WEB_CACHED_META_AI_SEARCH_NULL_STATE_SUGGESTIONS,t)},getCacheTtlMs:o("WAWebBotGating").getMetaAISearchNullStateSuggestionsUpdateIntervalMs}),_=new(o("WAWebTimedCache")).TimedLRUMapCache({mapLoad:function(){return o("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(o("WAWebUserPrefsKeys").KEYS.WA_WEB_CACHED_META_AI_SEARCH_TYPE_AHEAD_SUGGESTIONS)},mapStore:function(t){return o("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(o("WAWebUserPrefsKeys").KEYS.WA_WEB_CACHED_META_AI_SEARCH_TYPE_AHEAD_SUGGESTIONS,t)},getCacheTtlMs:o("WAWebBotGating").getMetaAISearchTypeAheadSuggestionsUpdateIntervalMs,capacity:o("WAWebBotGating").getMetaAISearchTypeAheadSuggestionsLRUCacheCapacity()});function f(e){r("WAWebUserPrefsStore").set(o("WAWebUserPrefsKeys").UserPrefs.MetaAISearchNullStateIndex,e)}function g(){var e=r("WAWebUserPrefsStore").get(o("WAWebUserPrefsKeys").UserPrefs.MetaAISearchNullStateIndex),t=typeof e=="number"?e:0;return t}function h(){var e,t=o("WAWebUserPrefsDeviceCapabilities").getPrimaryDeviceCapabilitiesFromLocalStorage();return(e=t.aiThread.supportLevel)!=null?e:o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$AiThread$SupportLevel.NONE}function y(){return o("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(o("WAWebUserPrefsKeys").KEYS.WA_WEB_META_AI_THREAD_MIGRATION_STATE)}function C(e){return o("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(o("WAWebUserPrefsKeys").KEYS.WA_WEB_META_AI_THREAD_MIGRATION_STATE,e)}l.getBotListLastRequestedTimestamp=e,l.setBotListLastRequestedTimestamp=s,l.getUgcBotListLastRequestedTimestamp=u,l.setUgcBotListLastRequestedTimestamp=c,l.getUgcBotListLastBhash=d,l.setUgcBotListLastBhash=m,l.MetaAINullStateSuggestionsCache=p,l.MetaAITypeAheadSuggestionsCache=_,l.setMetaAISearchNullStateIndex=f,l.getMetaAISearchNullStateIndex=g,l.getPrimaryAiThreadSupportLevelFromLocalStorage=h,l.getMetaAIThreadMigrationState=y,l.setMetaAIThreadMigrationState=C}),98);
__d("WAWebMmSignalSharingTos",["WATimeUtils","WAWebMmSignalSharingGatingUtils","WAWebTos","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e="20231028";function s(){return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()?e:""}function u(){o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()&&o("WAWebTos").TosManager.setState(s(),"ACCEPTED",o("WATimeUtils").unixTime())}function c(){return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()?o("WAWebTos").TosManager.getState(s())==="ACCEPTED":!1}function d(){return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()?o("WAWebTos").TosManager.getState(o("WAWebTos").TOS_3_ID)==="ACCEPTED":!1}function m(){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()&&(yield o("WAWebTos").TosManager.run({singleRun:!0}))}),p.apply(this,arguments)}l.getMmSignalSharingDisclosureTosId=s,l.acceptMmSignalSharingDisclosureTos=u,l.isMmSignalSharingDisclosureTosAccepted=c,l.is2021TosAccepted=d,l.refreshTos=m}),98);
__d("WAWebSetUserDisclosureStageJob",["WAJobOrchestratorTypes","WAWebOrchestratorNonPersistedJob","WAWebSetUserDisclosureStageQueryJob"],(function(t,n,r,o,a,i,l){function e(e,t){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("setUserDisclosureStage",function(){return o("WAWebSetUserDisclosureStageQueryJob").SetUserDisclosureStageQueryJob(e,t)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}l.setUserDisclosureStage=e}),98);
__d("WASmaxInUserNoticeSetResultResponseClientError",["WAResultOrError","WASmaxInUserNoticeIQErrorBadRequestMixin","WASmaxInUserNoticeIQErrorResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInUserNoticeIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(r.value);if(!a.success)return a;var i=o("WASmaxInUserNoticeIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorIQErrorBadRequestMixin:a.value},i.value)):i}l.parseSetResultResponseClientError=e}),98);
__d("WASmaxInUserNoticeSetResultResponseServerError",["WAResultOrError","WASmaxInUserNoticeIQErrorInternalServerErrorMixin","WASmaxInUserNoticeIQErrorResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInUserNoticeIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(r.value);if(!a.success)return a;var i=o("WASmaxInUserNoticeIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorIQErrorInternalServerErrorMixin:a.value},i.value)):i}l.parseSetResultResponseServerError=e}),98);
__d("WASmaxInUserNoticeSetResultResponseSuccess",["WAResultOrError","WASmaxInUserNoticeIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"trackable");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"id",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"result",0,1e3);return r.success?o("WAResultOrError").makeResult({id:n.value,result:r.value}):r}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(t,"trackable",e);if(!a.success)return a;var i=o("WASmaxInUserNoticeIQResultResponseMixin").parseIQResultResponseMixin(t,n);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{trackable:a.value})):i}l.parseSetResultResponseSuccessTrackable=e,l.parseSetResultResponseSuccess=s}),98);
__d("WASmaxOutUserNoticeBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"set"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQSetRequestMixin=s}),98);
__d("WASmaxOutUserNoticeSetResultRequest",["WASmaxJsx","WASmaxOutUserNoticeBaseIQSetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.trackableId,n=e.trackableResult,r=o("WASmaxOutUserNoticeBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"tos"},o("WASmaxJsx").smax("trackable",{id:o("WAWap").INT(t),result:o("WAWap").INT(n)})));return r}l.makeSetResultRequest=e}),98);
__d("WAWebSetUserDisclosureStageQueryJob",["Promise","WAComms","WASmaxInUserNoticeSetResultResponseClientError","WASmaxInUserNoticeSetResultResponseServerError","WASmaxInUserNoticeSetResultResponseSuccess","WASmaxOutUserNoticeSetResultRequest","WATimeUtils","WAWebBackendErrors","WAWebTos","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s={5:"ACCEPTED",155:"ACCEPTED","-1":"UNKNOWN"};function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a={trackableId:t,trackableResult:r},i=yield o("WASmaxOutUserNoticeSetResultRequest").makeSetResultRequest(a),l=yield o("WAComms").sendSmaxStanza(i),u=yield o("WASmaxInUserNoticeSetResultResponseSuccess").parseSetResultResponseSuccess(l,i);if(u.success){var c=o("WATimeUtils").unixTime(),d=s[r];return o("WAWebTos").TosManager.setState(t.toString(),d,c),(e||(e=n("Promise"))).resolve(!0)}var m=yield o("WASmaxInUserNoticeSetResultResponseClientError").parseSetResultResponseClientError(l,i);if(m.success){var p=m.value.errorIQErrorBadRequestMixin,_=p.code,f=p.text;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(Number(_),f)}var g=yield o("WASmaxInUserNoticeSetResultResponseServerError").parseSetResultResponseServerError(l,i);if(g.success){var h=g.value.errorIQErrorInternalServerErrorMixin,y=h.code,C=h.text;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(Number(y),C)}return(e||(e=n("Promise"))).resolve(!1)}),c.apply(this,arguments)}l.SetUserDisclosureStageQueryJob=u}),98);
__d("WAWebWamEnumNoticeTriggeredBy",[],(function(t,n,r,o,a,i){var e=Object.freeze({AUTO_START:0,BANNER:1,DEEP_LINK:2,JUST_IN_TIME:3});i.NOTICE_TRIGGERED_BY=e}),66);
__d("WAWebWamEnumNoticeType",[],(function(t,n,r,o,a,i){var e=Object.freeze({LEGACY_USER_NOTICE:0,BADGED_USER_NOTICE:1,PDFN_DISCLOSURE:2});i.NOTICE_TYPE=e}),66);
__d("WAWebWamEnumUserNoticeEvent",[],(function(t,n,r,o,a,i){var e=Object.freeze({TRIGGERED:0,BANNER_APPEAR:1,BANNER_SELECT:2,MODAL_APPEAR:3,MODAL_DISMISS:4,MODAL_LINK_FOLLOW:5,MODAL_ACCEPT:6,BLOCKING_MODAL_APPEAR:7,BLOCKING_MODAL_LINK_FOLLOW:8,BLOCKING_MODAL_ACCEPT:9,BANNER_DISMISS:10,EDUCATION_1_APPEAR:11,EDUCATION_1_DISMISS:12,EDUCATION_1_CONTINUE:13,MODAL_BACK:14,BLOCKING_MODAL_BACK:15,STARTED:100,PDFN_SHOWN_0:105,BADGE_APPEARED_NEXT_TO_SETTINGS:110,PDFN_SHOWN_1:111,PDFN_SHOWN_2:112,PDFN_SHOWN_3:113,PDFN_SHOWN_4:114,PDFN_SHOWN_5:115,PDFN_SHOWN_6:116,PDFN_SHOWN_7:117,PDFN_SHOWN_8:118,PDFN_SHOWN_9:119,BADGE_APPEARED_NEXT_TO_HELP:120,BADGE_SHOWN_IN_HELP:130,PDFN_DISMISSED:145,BADGE_EXPIRED:150,PDFN_OK:155,PDFN_SOFT_OPT_IN:160,PDFN_SOFT_OPT_OUT:162,PDFN_DENIED:165,BADGE_SELECTED:170,PDFN_ACCEPTED:175,PDFN_FAILED_TO_DOWNLOAD:400,PDFN_PARTIAL_DOWNLOAD:410,PDFN_ERROR_MISMATCHED_TEMPLATE:420,PDFN_ERROR_UNKNOWN:499,FINAL_END:999,PDFN_0_SECONDARY_BTN_CLICKED:1014,PDFN_1_SECONDARY_BTN_CLICKED:1015,PDFN_2_SECONDARY_BTN_CLICKED:1016,PDFN_3_SECONDARY_BTN_CLICKED:1017,PDFN_4_SECONDARY_BTN_CLICKED:1018,PDFN_5_SECONDARY_BTN_CLICKED:1019,PDFN_6_SECONDARY_BTN_CLICKED:1020,PDFN_7_SECONDARY_BTN_CLICKED:1021,PDFN_8_SECONDARY_BTN_CLICKED:1022,PDFN_9_SECONDARY_BTN_CLICKED:1023});i.USER_NOTICE_EVENT=e}),66);
__d("WAWebUserNoticeWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumNoticeTriggeredBy","WAWebWamEnumNoticeType","WAWebWamEnumUserNoticeEvent"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({UserNotice:[2472,{noticeTriggeredBy:[5,o("WAWebWamEnumNoticeTriggeredBy").NOTICE_TRIGGERED_BY],noticeType:[4,o("WAWebWamEnumNoticeType").NOTICE_TYPE],tsMs:[6,e.TYPES.TIMER],userNoticeContentVersion:[2,e.TYPES.INTEGER],userNoticeEvent:[3,o("WAWebWamEnumUserNoticeEvent").USER_NOTICE_EVENT],userNoticeId:[1,e.TYPES.INTEGER]},[1,1,1],"regular"]},{UserNotice:[]});l.UserNoticeWamEvent=s}),98);
__d("WAWebPDFNLogging",["WAWebPDFNTypes","WAWebUserNoticeWamEvent","WAWebWamEnumUserNoticeEvent"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.noticeContentVersion,n=e.noticeEvent,r=e.noticeId,a=e.noticeType,i=new(o("WAWebUserNoticeWamEvent")).UserNoticeWamEvent({userNoticeId:r,userNoticeContentVersion:t,userNoticeEvent:n,noticeType:a});i.commit()}function s(e){switch(e){case o("WAWebPDFNTypes").DISCLOSURE_STAGE.ACCEPTED:return o("WAWebWamEnumUserNoticeEvent").USER_NOTICE_EVENT.PDFN_ACCEPTED;case o("WAWebPDFNTypes").DISCLOSURE_STAGE.OK:return o("WAWebWamEnumUserNoticeEvent").USER_NOTICE_EVENT.PDFN_OK}}l.logUserNoticeEvent=e,l.getNoticeEventFromDisclosureStage=s}),98);
__d("WAWebSetUserDisclosureStageAction",["WAWebPDFNLogging","WAWebSetUserDisclosureStageJob","WAWebWamEnumNoticeType","WAWebWamEnumUserNoticeEvent","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){try{var r=yield o("WAWebSetUserDisclosureStageJob").setUserDisclosureStage(e,t);return r&&o("WAWebPDFNLogging").logUserNoticeEvent({noticeId:e,noticeEvent:o("WAWebPDFNLogging").getNoticeEventFromDisclosureStage(t),noticeContentVersion:n==null?void 0:n.disclosureContentVersion,noticeType:o("WAWebWamEnumNoticeType").NOTICE_TYPE.PDFN_DISCLOSURE}),r}catch(t){throw o("WAWebPDFNLogging").logUserNoticeEvent({noticeId:e,noticeContentVersion:n==null?void 0:n.disclosureContentVersion,noticeEvent:o("WAWebWamEnumUserNoticeEvent").USER_NOTICE_EVENT.PDFN_ERROR_UNKNOWN,noticeType:o("WAWebWamEnumNoticeType").NOTICE_TYPE.PDFN_DISCLOSURE}),t}}),s.apply(this,arguments)}l.updateUserDisclosureStateAction=e}),98);
__d("WAWebWamEnumAiChatOriginsType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,AI_HOME:1,AI_TAB_TEXT:2,AI_TAB_VOICE:3});i.AI_CHAT_ORIGINS_TYPE=e}),66);
__d("WAWebWamEnumBizCatalogType",[],(function(t,n,r,o,a,i){var e=Object.freeze({SHOPS:0,NATIVE:1});i.BIZ_CATALOG_TYPE=e}),66);
__d("WAWebWamEnumBlockReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,NO_LONGER_NEEDED:1,NO_SIGN_UP:2,SPAM:3,OFFENSIVE_MESSAGES:4,OTP_DID_NOT_REQUEST:5,SCAM_OR_FRAUD:6});i.BLOCK_REASON=e}),66);
__d("WAWebWamEnumChatMutedType",[],(function(t,n,r,o,a,i){var e=Object.freeze({NOT_MUTED:1,MUTED_NO_NOTIFICATIONS:2,MUTED_SILENT_NOTIFICATIONS:3});i.CHAT_MUTED_TYPE=e}),66);
__d("WAWebWamEnumChatOriginsType",[],(function(t,n,r,o,a,i){var e=Object.freeze({LID_USERNAME:1,LID_CTWA:2,OTHERS:3});i.CHAT_ORIGINS_TYPE=e}),66);
__d("WAWebWamEnumChatType",[],(function(t,n,r,o,a,i){var e=Object.freeze({INDIVIDUAL:1,SMB:2,ENT:3,INTEROP:4,UNKNOWN:5,BUSINESS:6});i.CHAT_TYPE=e}),66);
__d("WAWebWamEnumGaStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({NEW:0,RETAINED:1,RESURRECTED:2});i.GA_STATUS=e}),66);
__d("WAWebWamEnumGroupInfoSettingType",[],(function(t,n,r,o,a,i){var e=Object.freeze({ADMINS_ONLY:1,ALL_PARTICIPANTS:2});i.GROUP_INFO_SETTING_TYPE=e}),66);
__d("WAWebChatMessageCountsWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAiChatOriginsType","WAWebWamEnumBizCatalogType","WAWebWamEnumBlockReason","WAWebWamEnumChatMutedType","WAWebWamEnumChatOriginsType","WAWebWamEnumChatType","WAWebWamEnumDisappearingChatInitiatorType","WAWebWamEnumEphemeralityInitiatorType","WAWebWamEnumEphemeralityTriggerActionType","WAWebWamEnumGaStatus","WAWebWamEnumGroupInfoSettingType","WAWebWamEnumOppositeVisibleIdentificationType","WAWebWamEnumTypeOfGroupEnum"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ChatMessageCounts:[1644,{aiChatOrigins:[224,o("WAWebWamEnumAiChatOriginsType").AI_CHAT_ORIGINS_TYPE],aiDiscoveryTab:[195,e.TYPES.STRING],audioMessagesReceived:[149,e.TYPES.INTEGER],audioMessagesSent:[150,e.TYPES.INTEGER],autoReplyFromIcebreakerSent:[190,e.TYPES.INTEGER],awayMsgsSent:[56,e.TYPES.INTEGER],bizCatalogType:[60,o("WAWebWamEnumBizCatalogType").BIZ_CATALOG_TYPE],bizConversationDepth:[65,e.TYPES.INTEGER],blockReason:[33,o("WAWebWamEnumBlockReason").BLOCK_REASON],bottomSheetAnimatedSent:[206,e.TYPES.INTEGER],bottomSheetEditedAnimatedSent:[207,e.TYPES.INTEGER],bottomSheetEditedSent:[208,e.TYPES.INTEGER],bottomSheetForwardMessagesSent:[196,e.TYPES.INTEGER],bottomSheetImagesEdited:[209,e.TYPES.INTEGER],bottomSheetImagesGenerated:[197,e.TYPES.INTEGER],bottomSheetMemuImagesGenerated:[220,e.TYPES.INTEGER],bottomSheetMemuInitiated:[221,e.TYPES.INTEGER],bottomSheetMemuMessagesSent:[222,e.TYPES.INTEGER],bottomSheetMessagesDownloaded:[198,e.TYPES.INTEGER],bottomSheetMessagesReceived:[199,e.TYPES.INTEGER],bottomSheetMessagesSent:[200,e.TYPES.INTEGER],bottomSheetPromptsInitiated:[201,e.TYPES.INTEGER],bottomSheetRegeneratedSent:[210,e.TYPES.INTEGER],broadcastMsgsReceived:[30,e.TYPES.INTEGER],broadcastMsgsSent:[29,e.TYPES.INTEGER],callOffersReceived:[27,e.TYPES.INTEGER],callOffersSent:[26,e.TYPES.INTEGER],callsResultBusy:[70,e.TYPES.INTEGER],callsResultCancelled:[71,e.TYPES.INTEGER],callsResultConnected:[72,e.TYPES.INTEGER],callsResultError:[78,e.TYPES.INTEGER],callsResultMissed:[73,e.TYPES.INTEGER],callsResultRejected:[74,e.TYPES.INTEGER],canEditDmSettings:[88,e.TYPES.BOOLEAN],cartViews:[86,e.TYPES.INTEGER],chatEphemeralityDuration:[15,e.TYPES.INTEGER],chatMuted:[8,o("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE],chatOrigins:[179,o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE],chatOverflowClicks:[79,e.TYPES.INTEGER],chatTypeInd:[2,o("WAWebWamEnumChatType").CHAT_TYPE],collectionInquiriesSent:[44,e.TYPES.INTEGER],commandSheetShow:[174,e.TYPES.INTEGER],commentsReceived:[126,e.TYPES.INTEGER],commerceMsgsReceived:[41,e.TYPES.INTEGER],commerceMsgsSent:[40,e.TYPES.INTEGER],deviceLanguage:[219,e.TYPES.STRING],disappearingChatInitiator:[59,o("WAWebWamEnumDisappearingChatInitiatorType").DISAPPEARING_CHAT_INITIATOR_TYPE],documentMessagesReceived:[151,e.TYPES.INTEGER],documentMessagesSent:[152,e.TYPES.INTEGER],editedMsgsSent:[100,e.TYPES.INTEGER],entryPointConversionApp:[47,e.TYPES.STRING],entryPointConversionSource:[46,e.TYPES.STRING],ephemeralMessagesExpired:[248,e.TYPES.INTEGER],ephemeralMessagesReceived:[14,e.TYPES.INTEGER],ephemeralMessagesSent:[13,e.TYPES.INTEGER],ephemeralMessagesUnreadExpired:[69,e.TYPES.INTEGER],ephemeralityInitiator:[109,o("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE],ephemeralityTriggerAction:[110,o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE],eventCreationMessagesReceived:[142,e.TYPES.INTEGER],eventCreationMessagesSent:[143,e.TYPES.INTEGER],eventResponseMessagesReceived:[144,e.TYPES.INTEGER],eventResponseMessagesSent:[145,e.TYPES.INTEGER],fbCtaInquiriesSent:[45,e.TYPES.INTEGER],firstResponseTime:[25,e.TYPES.INTEGER],fmxNotMvBottomSheetDismissedCount:[234,e.TYPES.INTEGER],fmxNotMvBottomSheetGetMvButtonClicks:[235,e.TYPES.INTEGER],fmxNotMvBottomSheetGetMvButtonImpressions:[236,e.TYPES.INTEGER],fmxNotMvBottomSheetImpressions:[237,e.TYPES.INTEGER],fmxNotMvBottomSheetLearnMoreButtonClicks:[238,e.TYPES.INTEGER],fmxNotMvClicks:[229,e.TYPES.INTEGER],forwardAudioMessagesReceived:[153,e.TYPES.INTEGER],forwardAudioMessagesSent:[154,e.TYPES.INTEGER],forwardDocumentMessagesReceived:[155,e.TYPES.INTEGER],forwardDocumentMessagesSent:[156,e.TYPES.INTEGER],forwardGifMessagesReceived:[157,e.TYPES.INTEGER],forwardGifMessagesSent:[158,e.TYPES.INTEGER],forwardMessagesReceived:[89,e.TYPES.INTEGER],forwardMessagesSent:[90,e.TYPES.INTEGER],forwardPhotoMessagesReceived:[128,e.TYPES.INTEGER],forwardPhotoMessagesSent:[129,e.TYPES.INTEGER],forwardPtvMessagesReceived:[159,e.TYPES.INTEGER],forwardPtvMessagesSent:[160,e.TYPES.INTEGER],forwardStatusReplyMessagesReceived:[161,e.TYPES.INTEGER],forwardStatusReplyMessagesSent:[162,e.TYPES.INTEGER],forwardStickerMessagesReceived:[163,e.TYPES.INTEGER],forwardStickerMessagesSent:[164,e.TYPES.INTEGER],forwardTextMessagesReceived:[130,e.TYPES.INTEGER],forwardTextMessagesSent:[131,e.TYPES.INTEGER],forwardUrlMessagesReceived:[132,e.TYPES.INTEGER],forwardUrlMessagesSent:[133,e.TYPES.INTEGER],forwardVideoMessagesReceived:[165,e.TYPES.INTEGER],forwardVideoMessagesSent:[166,e.TYPES.INTEGER],gaStatus:[22,o("WAWebWamEnumGaStatus").GA_STATUS],gifMessagesReceived:[167,e.TYPES.INTEGER],gifMessagesSent:[168,e.TYPES.INTEGER],googleSearchClick:[214,e.TYPES.INTEGER],googleSearchShow:[215,e.TYPES.INTEGER],greetingMsgsSent:[57,e.TYPES.INTEGER],groupContainsBiz:[75,e.TYPES.BOOLEAN],groupInfoSetting:[87,o("WAWebWamEnumGroupInfoSettingType").GROUP_INFO_SETTING_TYPE],groupLimitSharingOnCnt:[225,e.TYPES.INTEGER],groupMembershipReplies:[51,e.TYPES.INTEGER],groupPrivateReplies:[52,e.TYPES.INTEGER],groupSize:[19,e.TYPES.INTEGER],groupStatusLikesOthersToOthers:[249,e.TYPES.INTEGER],groupStatusLikesOthersToOwn:[250,e.TYPES.INTEGER],groupStatusLikesOwnToOthers:[251,e.TYPES.INTEGER],groupStatusLikesOwnToOwn:[252,e.TYPES.INTEGER],groupStatusRepliesOthersToOthers:[253,e.TYPES.INTEGER],groupStatusRepliesOthersToOwn:[254,e.TYPES.INTEGER],groupStatusRepliesOwnToOthers:[255,e.TYPES.INTEGER],groupStatusRepliesOwnToOwn:[256,e.TYPES.INTEGER],hasReplied1On1:[216,e.TYPES.BOOLEAN],hasUsername:[180,e.TYPES.BOOLEAN],hasUsernamePin:[228,e.TYPES.BOOLEAN],imagineCommandClick:[175,e.TYPES.INTEGER],imagineMeMessagesSent:[202,e.TYPES.INTEGER],imagineMePromptsInitiatedCount:[203,e.TYPES.INTEGER],imagineMentionClick:[146,e.TYPES.INTEGER],imagineMentionShow:[176,e.TYPES.INTEGER],isAContact:[6,e.TYPES.BOOLEAN],isAContactAtThreadCreation:[213,e.TYPES.BOOLEAN],isAGroup:[5,e.TYPES.BOOLEAN],isArchived:[10,e.TYPES.BOOLEAN],isAutoMuted:[108,e.TYPES.BOOLEAN],isBizMvFrictionEligible:[230,e.TYPES.BOOLEAN],isBlocked:[32,e.TYPES.BOOLEAN],isCartAddClicked:[36,e.TYPES.BOOLEAN],isCommerceViewed:[35,e.TYPES.BOOLEAN],isCtaOnPdpClicked:[37,e.TYPES.BOOLEAN],isDeleted:[185,e.TYPES.BOOLEAN],isGuestThread:[257,e.TYPES.BOOLEAN],isInviteCreatedThread:[106,e.TYPES.BOOLEAN],isLabelled:[54,e.TYPES.BOOLEAN],isManagedAccount:[260,e.TYPES.BOOLEAN],isMessageYourself:[91,e.TYPES.BOOLEAN],isMetaAiAssistant:[211,e.TYPES.BOOLEAN],isNewManagedAccountEmIgnored:[261,e.TYPES.BOOLEAN],isOppositePartyInitiated:[62,e.TYPES.BOOLEAN],isPinned:[9,e.TYPES.BOOLEAN],isPnhEnabledChat:[92,e.TYPES.BOOLEAN],isReported:[186,e.TYPES.BOOLEAN],isUser1pBizBotChat:[141,e.TYPES.BOOLEAN],isUser3pBotChat:[140,e.TYPES.BOOLEAN],isUserAgent:[111,e.TYPES.BOOLEAN],isUserCreatedAgent:[123,e.TYPES.BOOLEAN],isUsernameThread:[258,e.TYPES.BOOLEAN],isUsernameThreadAtCreation:[259,e.TYPES.BOOLEAN],isWaPayRegistered:[81,e.TYPES.BOOLEAN],labelledMsgs:[55,e.TYPES.INTEGER],limitSharingOption:[226,e.TYPES.BOOLEAN],locationsSent:[96,e.TYPES.INTEGER],markedReadCnt:[193,e.TYPES.INTEGER],markedReadMessageCnt:[194,e.TYPES.INTEGER],matchedMessagesMarkedAsReadWithDeltaTime:[246,e.TYPES.STRING],matchedMessagesReadWithDeltaTime:[247,e.TYPES.STRING],messagesRead:[127,e.TYPES.INTEGER],messagesReceived:[4,e.TYPES.INTEGER],messagesReceivedWithEnabledReadReceipt:[245,e.TYPES.INTEGER],messagesSent:[3,e.TYPES.INTEGER],messagesStarred:[12,e.TYPES.INTEGER],messagesUnread:[11,e.TYPES.INTEGER],metaAiMentionClick:[147,e.TYPES.INTEGER],metaAiMentionShow:[148,e.TYPES.INTEGER],newThread:[68,e.TYPES.BOOLEAN],notMvImpressions:[231,e.TYPES.INTEGER],odReceived:[82,e.TYPES.INTEGER],oppositePartyHasBadge:[240,e.TYPES.BOOLEAN],oppositePartyHasBusinessIntent:[204,e.TYPES.BOOLEAN],oppositePartyHasProfilePhoto:[217,e.TYPES.BOOLEAN],oppositePartyLimitSharingOption:[227,e.TYPES.BOOLEAN],oppositeVisibleIdentification:[181,o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE],ordersSent:[38,e.TYPES.INTEGER],p2mOdNnpTransactionsSent:[83,e.TYPES.INTEGER],p2mOdNpTransactionsSent:[84,e.TYPES.INTEGER],paymentsSent:[39,e.TYPES.INTEGER],pdpInquiriesSent:[42,e.TYPES.INTEGER],pdpViews:[61,e.TYPES.INTEGER],photoMessagesReceived:[134,e.TYPES.INTEGER],photoMessagesSent:[135,e.TYPES.INTEGER],pollCreationMessagesReceived:[115,e.TYPES.INTEGER],pollCreationMessagesSent:[116,e.TYPES.INTEGER],pollUpdateMessagesReceived:[117,e.TYPES.INTEGER],pollUpdateMessagesSent:[118,e.TYPES.INTEGER],profileReplies:[64,e.TYPES.INTEGER],profileViews:[63,e.TYPES.INTEGER],pttMessagesReceived:[119,e.TYPES.INTEGER],pttMessagesSent:[120,e.TYPES.INTEGER],ptvMessagesReceived:[121,e.TYPES.INTEGER],ptvMessagesSent:[122,e.TYPES.INTEGER],quickRepliesSent:[58,e.TYPES.INTEGER],reactionsReceived:[97,e.TYPES.INTEGER],reactionsSent:[98,e.TYPES.INTEGER],receiverDefaultDisappearingDuration:[21,e.TYPES.INTEGER],repliesSent:[80,e.TYPES.INTEGER],requestedPhoneNumber:[93,e.TYPES.BOOLEAN],seenMaskedPhoneNumber:[94,e.TYPES.BOOLEAN],senderDefaultDisappearingDuration:[20,e.TYPES.INTEGER],sharedPhoneNumber:[99,e.TYPES.BOOLEAN],sharesCommonGroup:[218,e.TYPES.BOOLEAN],smbMarketingMessagesReactionsSent:[101,e.TYPES.INTEGER],smbMarketingMessagesRepliesSent:[102,e.TYPES.INTEGER],smbMarketingMessagesSpamReports:[103,e.TYPES.INTEGER],smbMarketingMsgsReceived:[104,e.TYPES.INTEGER],smbMarketingMsgsSent:[105,e.TYPES.INTEGER],spamReports:[31,e.TYPES.INTEGER],startTime:[7,e.TYPES.INTEGER],statusReactionsReceived:[191,e.TYPES.INTEGER],statusReactionsSent:[192,e.TYPES.INTEGER],statusReplies:[50,e.TYPES.INTEGER],statusReplyMessagesReceived:[169,e.TYPES.INTEGER],statusViews:[49,e.TYPES.INTEGER],stickerMessagesReceived:[170,e.TYPES.INTEGER],stickerMessagesSent:[171,e.TYPES.INTEGER],storefrontInquiriesSent:[43,e.TYPES.INTEGER],suggestionPromptsClick:[177,e.TYPES.INTEGER],suggestionPromptsShow:[178,e.TYPES.INTEGER],textMessagesReceived:[136,e.TYPES.INTEGER],textMessagesSent:[137,e.TYPES.INTEGER],textMessagesToUserCreatedAgentCnt:[124,e.TYPES.INTEGER],threadCreationDate:[189,e.TYPES.STRING],threadDs:[66,e.TYPES.STRING],threadId:[67,e.TYPES.STRING],threadIdMonthly:[223,e.TYPES.STRING],tombstoneEphemeralMessagesReceived:[262,e.TYPES.INTEGER],tombstoneViewOnceMessagesReceived:[263,e.TYPES.INTEGER],totalCallDuration:[28,e.TYPES.INTEGER],totalMessageEditsFromAgentCnt:[112,e.TYPES.INTEGER],totalMessageFromAgentCnt:[113,e.TYPES.INTEGER],totalMessageToAgentCnt:[114,e.TYPES.INTEGER],totalMessagesToUserCreatedAgentCnt:[125,e.TYPES.INTEGER],typeOfGroup:[85,o("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM],urlMessagesReceived:[138,e.TYPES.INTEGER],urlMessagesSent:[139,e.TYPES.INTEGER],userHasBusinessIntent:[205,e.TYPES.BOOLEAN],viaContactlessChats:[107,e.TYPES.BOOLEAN],videoCallsOffered:[76,e.TYPES.INTEGER],videoMessagesReceived:[172,e.TYPES.INTEGER],videoMessagesSent:[173,e.TYPES.INTEGER],viewOnceMessagesOpened:[18,e.TYPES.INTEGER],viewOnceMessagesReceived:[17,e.TYPES.INTEGER],viewOnceMessagesSent:[16,e.TYPES.INTEGER],voiceCallsOffered:[77,e.TYPES.INTEGER]},[1,1,1],"regular"]},{ChatMessageCounts:[]});l.ChatMessageCountsWamEvent=s}),98);
__d("WATopLevelDomains",[],(function(t,n,r,o,a,i){var e=new Set(["aaa","abb","abbott","abogado","abudhabi","ac","academy","accountant","accountants","ad","adult","ae","aero","af","afl","africa","ag","agency","ai","aig","airforce","al","alsace","am","amazon","amex","amsterdam","android","ao","apartments","app","apple","ar","arab","archi","army","arpa","art","as","asia","associates","at","au","auction","audi","audio","auspost","auto","autos","aw","aws","ax","az","ba","baby","band","bank","bar","barcelona","barclaycard","barclays","bargains","basketball","bauhaus","bayern","bb","bbva","bd","be","beauty","beer","berlin","best","bet","bf","bg","bh","bi","bible","bid","bike","bingo","bio","biz","bj","black","blackfriday","blog","blue","bm","bmw","bn","bnpparibas","bo","boats","bond","boo","boston","bot","boutique","box","br","bradesco","broker","brother","brussels","bs","bt","build","builders","business","buzz","bw","by","bz","bzh","ca","cab","cafe","cam","camera","camp","canon","capetown","capital","car","cards","care","career","careers","cars","casa","cash","casino","cat","catering","cba","cc","cd","center","ceo","cern","cf","cfd","cg","ch","charity","chase","chat","cheap","christmas","chrome","church","ci","citic","city","ck","cl","claims","cleaning","click","clinic","clothing","cloud","club","clubmed","cm","cn","co","coach","codes","coffee","college","cologne","com","community","company","computer","condos","construction","consulting","contact","contractors","cooking","cool","coop","corsica","country","coupons","courses","cpa","cr","credit","cricket","crs","cu","cuisinella","cv","cw","cx","cy","cymru","cyou","cz","dad","dance","date","dating","day","de","dealer","deals","delivery","deloitte","democrat","dental","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","diy","dj","dk","dm","do","doctor","dog","domains","download","durban","dvag","dz","earth","ec","eco","edeka","edu","education","ee","eg","email","energy","engineer","engineering","enterprises","epson","equipment","es","esq","estate","et","eu","eus","events","exchange","expert","exposed","express","extraspace","fail","faith","family","fan","fans","farm","fashion","feedback","fi","film","finance","financial","fish","fishing","fit","fitness","fj","fk","flights","flir","florist","flowers","fm","fo","foo","food","football","forex","forsale","forum","foundation","fox","fr","frl","fujitsu","fun","fund","furniture","futbol","fyi","ga","gal","gallery","game","games","garden","gay","gd","gdn","ge","gent","gf","gg","gh","gi","gift","gifts","gives","giving","gl","glass","gle","global","globo","gm","gmbh","gn","godaddy","gold","golf","goog","google","gop","gov","gp","gq","gr","graphics","gratis","green","group","gs","gt","guide","guru","gw","gy","hair","hamburg","haus","health","healthcare","help","hermes","hiphop","hk","hm","hn","hockey","holdings","holiday","homes","honda","horse","host","hosting","house","how","hr","ht","hu","ice","icu","id","ie","ikano","il","im","immo","immobilien","in","inc","industries","info","ing","ink","institute","insurance","insure","int","international","investments","io","iq","ir","irish","is","ismaili","ist","istanbul","it","itau","itv","java","jcb","je","jetzt","jewelry","jio","jm","jnj","jo","jobs","joburg","jp","kaufen","ke","kg","kh","ki","kids","kim","kitchen","kiwi","kn","koeln","komatsu","kp","kpmg","kr","krd","kred","kw","ky","kyoto","kz","la","land","landrover","lat","law","lawyer","lb","lc","leclerc","legal","lgbt","li","lidl","life","lighting","lilly","limited","limo","link","live","lk","llc","loan","loans","local","lol","london","love","ls","lt","ltd","ltda","lu","lundbeck","luxe","luxury","lv","ly","ma","madrid","makeup","man","management","mango","market","marketing","markets","mba","mc","md","me","media","meet","melbourne","meme","memorial","men","menu","mg","mh","miami","microsoft","mil","mk","ml","mm","mn","mo","mobi","moda","moe","mom","monash","money","monster","mortgage","moscow","motorcycles","mov","movie","mp","mq","mr","ms","mt","mu","museum","music","mv","mw","mx","my","mz","na","nab","nagoya","name","navy","nc","ne","net","network","neustar","new","news","next","nexus","nf","ng","ngo","ni","nico","nike","ninja","nl","no","now","np","nr","nrw","ntt","nu","nyc","nz","observer","okinawa","om","one","ong","onion","onl","online","ooo","orange","org","organic","ovh","pa","page","panasonic","paris","partners","parts","party","pe","pet","pf","pg","ph","pharmacy","phd","photo","photography","photos","pics","pictet","pictures","pink","pioneer","pizza","pk","pl","place","plumbing","plus","pm","pn","poker","politie","porn","post","pr","press","pro","productions","prof","promo","properties","property","ps","pt","pub","pw","py","qa","qpon","quebec","quest","racing","radio","re","realestate","realtor","recipes","red","rehab","reisen","ren","rent","rentals","repair","report","republican","rest","restaurant","review","reviews","rio","rip","ro","rocks","rodeo","rs","rsvp","ru","rugby","ruhr","run","rw","ryukyu","sa","saarland","sale","salon","sandvik","sanofi","sap","sarl","saxo","sb","sbi","sbs","sc","scb","schmidt","school","schule","schwarz","science","scot","sd","se","seat","security","select","sener","services","sex","sexy","sg","sh","sharp","shell","shiksha","shoes","shop","shopping","show","si","singles","site","sk","ski","skin","sky","sl","sm","sn","sncf","so","soccer","social","software","solar","solutions","sony","soy","space","sport","sr","srl","ss","st","statebank","statefarm","stockholm","storage","store","stream","studio","study","style","su","sucks","supplies","supply","support","surf","surgery","suzuki","sv","swiss","sx","sy","sydney","systems","sz","taipei","tatamotors","tatar","tattoo","tax","taxi","tc","td","team","tech","technology","tel","tennis","teva","tf","tg","th","theater","tickets","tienda","tips","tirol","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","toshiba","total","tours","town","toyota","toys","tr","trade","trading","training","travel","tt","tube","tui","tv","tw","tz","ua","ug","uk","university","uno","uol","us","uy","uz","va","vacations","vanguard","vc","ve","vegas","ventures","vet","vg","vi","video","vin","vip","vision","vivo","vlaanderen","vn","vodka","vote","voto","voyage","vu","wales","wang","watch","webcam","weber","website","wedding","weir","wf","wien","wiki","williamhill","win","wine","woodside","work","works","world","ws","wtf","xin","xyz","yachts","yandex","ye","yoga","yokohama","youtube","yt","za","zappos","zara","zip","zm","zone","zw","\u0431\u0435\u043B","\u0434\u0435\u0442\u0438","\u043C\u043E\u0441\u043A\u0432\u0430","\u043E\u043D\u043B\u0430\u0439\u043D","\u0440\u0443\u0441","\u0440\u0444","\u0443\u043A\u0440","\u092D\u093E\u0930\u0924","\u09AD\u09BE\u09F0\u09A4","\u0AAD\u0ABE\u0AB0\u0AA4","\u0B2D\u0B3E\u0B30\u0B24","\u30BB\u30FC\u30EB","\u4E2D\u56FD","\u516C\u53F8","\u6211\u7231\u4F60","\u79FB\u52A8","\u7F51\u5740","\u7F51\u7AD9","\u7F51\u7EDC","\uB2F7\uB137","\uB2F7\uCEF4","\uD55C\uAD6D"]);i.TLD=e}),66);
/**
 * License: https://www.facebook.com/legal/license/NKF0mBOyBt2/
 */
__d("punycode-2.1.1",[],(function(t,n,r,o,a,i){"use strict";var e={},l={exports:e};function s(){var e=2147483647,t=36,n=1,r=26,o=38,a=700,i=72,s=128,u="-",c=/^xn--/,d=/[^\0-\x7E]/,m=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=t-n,f=Math.floor,g=String.fromCharCode;function h(e){throw new RangeError(p[e])}function y(e,t){for(var n=[],r=e.length;r--;)n[r]=t(e[r]);return n}function C(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(m,".");var o=e.split("."),a=y(o,t).join(".");return r+a}function b(e){for(var t=[],n=0,r=e.length;n<r;){var o=e.charCodeAt(n++);if(o>=55296&&o<=56319&&n<r){var a=e.charCodeAt(n++);(a&64512)==56320?t.push(((o&1023)<<10)+(a&1023)+65536):(t.push(o),n--)}else t.push(o)}return t}var v=function(t){return String.fromCodePoint.apply(String,t)},S=function(n){return n-48<10?n-22:n-65<26?n-65:n-97<26?n-97:t},R=function(t,n){return t+22+75*(t<26)-((n!=0)<<5)},L=function(n,i,l){var e=0;for(n=l?f(n/a):n>>1,n+=f(n/i);n>_*r>>1;e+=t)n=f(n/_);return f(e+(_+1)*n/(n+o))},E=function(a){var o=[],l=a.length,c=0,d=s,m=i,p=a.lastIndexOf(u);p<0&&(p=0);for(var _=0;_<p;++_)a.charCodeAt(_)>=128&&h("not-basic"),o.push(a.charCodeAt(_));for(var g=p>0?p+1:0;g<l;){for(var y=c,C=1,b=t;;b+=t){g>=l&&h("invalid-input");var v=S(a.charCodeAt(g++));(v>=t||v>f((e-c)/C))&&h("overflow"),c+=v*C;var R=b<=m?n:b>=m+r?r:b-m;if(v<R)break;var E=t-R;C>f(e/E)&&h("overflow"),C*=E}var k=o.length+1;m=L(c-y,k,y==0),f(c/k)>e-d&&h("overflow"),d+=f(c/k),c%=k,o.splice(c++,0,d)}return String.fromCodePoint.apply(String,o)},k=function(a){var o=[];a=b(a);var l=a.length,c=s,d=0,m=i;for(var p of a)p<128&&o.push(g(p));var _=o.length,y=_;for(_&&o.push(u);y<l;){var C=e;for(var v of a)v>=c&&v<C&&(C=v);var S=y+1;C-c>f((e-d)/S)&&h("overflow"),d+=(C-c)*S,c=C;for(var E of a)if(E<c&&++d>e&&h("overflow"),E==c){for(var k=d,I=t;;I+=t){var T=I<=m?n:I>=m+r?r:I-m;if(k<T)break;var D=k-T,x=t-T;o.push(g(R(T+D%x,0))),k=f(D/x)}o.push(g(R(k,0))),m=L(d,S,y==_),d=0,++y}++d,++c}return o.join("")},I=function(t){return C(t,function(e){return c.test(e)?E(e.slice(4).toLowerCase()):e})},T=function(t){return C(t,function(e){return d.test(e)?"xn--"+k(e):e})},D={version:"2.1.0",ucs2:{decode:b,encode:v},decode:E,encode:k,toASCII:T,toUnicode:I};l.exports=D}var u=!1;function c(){return u||(u=!0,s()),l.exports}function d(e){switch(e){case void 0:return c()}}a.exports=d}),null);
__d("punycode",["punycode-2.1.1"],(function(t,n,r,o,a,i){a.exports=n("punycode-2.1.1")()}),null);
__d("WALinkify",["WALogger","WATopLevelDomains","punycode"],(function(t,n,r,o,a,i,l){"use strict";var e,s=Array.from(o("WATopLevelDomains").TLD).join("|"),u="(?:http|https)://|mailto:",c=/^https?:\/\/$/gi,d="\\w|[^\\s\0-\x7F\xAB\xBB\u2018\u2019\u201C\u201D]|%[0-9a-f][0-9a-f]",m=s+"|xn--(?:"+d+")+",p="(?:"+d+")|(?:"+d+")(?:"+d+"|-)*(?:"+d+")",_="(?!_)(?:(?:"+p+")\\.)+("+m+")(?!\\."+p+")",f=":\\d{1,5}",g="@!.?,(\\[{<\xAB\u2018\u201C:",h="(?:"+d+"|[^\\s%])",y="/"+h+"*?",C="["+g+"]*(?!"+h+"|#)",b="\\?(?!"+C+")"+h+"*?",v="#"+h+"*?",S="0-9a-z!#$%&'*+/=?^_`{|}~\\-",R="\\b\\w["+S+"]*(?:\\.["+S+"]+)*",L="^|\\W\\.|[^/\\w.]|_",E="("+L+")("+u+")?("+R+"@)?("+_+")(?:(?!"+p+")|(?=_))(?:(?=[^:/?#])|("+f+")?("+y+")?("+b+")?("+v+")?(?="+C+"))",k=1,I=2,T=3,D=4,x=5,$=6,P=7,N=8,M=9,w=new Map([[34,34],[41,40],[62,60],[93,91],[125,123],[187,171],[8217,8216],[8221,8220]]),A=new Map([[34,34],[40,41],[60,62],[91,93],[123,125],[171,187],[8216,8217],[8220,8221]]),F=new RegExp(""+E,"ig"),O=new RegExp("\\.(?:"+m+")","i");function B(t){try{return F.exec(t)}catch(n){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["text size: ",", error: ",""])),t.length,String(n)).sendLogs("linkify-regex-error"),null}}function W(e,t){if(t===void 0&&(t=!1),!O.test(e))return[];F.lastIndex=0;for(var n=[],r;r=B(e);){var o=U(r,t);o&&n.push(o)}return n}function q(e,t){return t===void 0&&(t=!1),O.test(e)?(F.lastIndex=0,U(B(e),t)):null}function U(e,t){if(t===void 0&&(t=!1),!e)return null;var n=e[k].length,a=e[0],i=e.index+n,l=e.index,s=e[k]==="_";if(s&&l-1&&/\S/.test(e.input[l-1]))return null;var u=e[x];if(u&&u.startsWith("xn--")&&!o("WATopLevelDomains").TLD.has(r("punycode").toUnicode(u)))return null;if(e[$]){var d=parseInt(e[$].slice(1),10);if(e[$][1]==="0"||!(0<d&&d<65536))return null}var m=[M,N,P].find(function(t){return e&&e[t]})||0;if(m){var p=[],_=e[m];_.slice(-1)==="_"&&a[i-1]==="_"&&(a=a.slice(0,-1),e[m]=_=_.slice(0,-1));for(var f=0,g=0,h=0;h<_.length;h++){var y=_.charCodeAt(h);y===g?(g=p.pop()||0,g===0&&(f=h)):A.has(y)?(g!==0&&p.push(g),g=A.get(y)):w.has(y)||g===0&&(f=h)}if(f!==_.length-1)if(m===N&&g!==0)a=a.slice(n);else{var C=e.slice(I,m);C.splice(x-I,1),a=C.filter(function(e){return e}).join("")+_.slice(0,f+1),F.lastIndex=i+a.length}else a=a.slice(n)}else a=a.slice(n);var b=a,v=e[I],S=!!(v&&v.match(c));if(t&&!S)return null;v?v=v.toLowerCase():(b.toLowerCase().indexOf("irc.")===0?v="irc://":b.toLowerCase().indexOf("ftp.")===0?v="ftp://":e[T]?v="mailto:":v="http://",b=v+b);var R=e[D];return{href:b,url:a,index:i,input:e.input,scheme:v,username:e[T],domain:R,port:e[$],path:e[P],params:e[N],anchor:e[M],isHttp:S}}function V(e){var t=q(e);return t&&t.url===e&&t.scheme==="mailto:"&&t.username!=null&&t.username!==""&&(t.params==null||t.params==="")&&(t.anchor==null||t.anchor==="")?t:null}l.findLinks=W,l.findLink=q,l.validateEmail=V}),98);
__d("WALanguagesAndRegions",[],(function(t,n,r,o,a,i){"use strict";var e={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]};i.LANGUAGE_TO_REGIONS=e}),66);
__d("WAIdn",["WALanguagesAndRegions","WAStringz"],(function(t,n,r,o,a,i,l){"use strict";var e={\u00ED:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],\u00EE:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],\u00FC:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],\u010B:["mt"],\u012B:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],\u0131:["az","crh","tr"],\u013C:["lv"],\u0142:["dsb","nv","pl","hsb"],\u0161:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],\u0199:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],\u01C0:["naq"],\u01C1:["naq"],\u022F:["liv"],\u0251:["fmp","dud","tmh"],\u0253:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],\u1E0D:["tzm","kab","okr","shi","tmh","taq"],\u1E5B:["tzm","kab","shi"],\u1E6D:["tzm","kab","shi","tmh","taq"],\u1E89:[],\u1EA1:["izi","yaz","blt","vi"],\u1EB9:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],\u1ECB:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},s=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),u=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),c="\u0430\u0432\u0433\u0435\u043A\u043C\u043D\u043E\u0440\u0441\u0442\u0443\u0445\u0448\u0449\u044C\u0455\u0456\u0458\u0461\u0475\u04AF\u04BB\u04CF\u0501\u051B\u051D\u0527\uA699";function d(e){return s.has(e)}function m(e){return u.has(e)}function p(e){return c.includes(e)}var _=new RegExp("^[a-z0-9-]+$"),f=2;function g(t,n,r,a){var i=t.split("."),l,s=!1;if(i.forEach(function(e){if(s=!e.match(_),s)if(!l)l=e;else return null}),l==null||s)return null;for(var u=[],c=!0,g=o("WAStringz").toArray(l),h=0;h<g.length;h++){var y=g[h];if(c=c&&p(y),!c&&e[y]){if(u.length>=f)return null;u.push(y)}}if(c)return m(r)||m(n)||a.some(function(e){return d(e)})?null:new Set(g);if(!u.length)return null;var C=u.filter(function(t){var i=e[t];if(i==null||a.some(function(e){return i.includes(e)}))return!1;for(var l=new Set,s=0;s<i.length;s++){var u=o("WALanguagesAndRegions").LANGUAGE_TO_REGIONS[i[s]];if(u!=null)for(var c=0;c<u.length;c++)l.add(u[c])}return!(l.has(r)||l.has(n))});return C.length?new Set(C):null}l.findSuspiciousCharacters=g}),98);
__d("WASuspiciousLinks",["WAIdn","WAJids","WAPhoneFindCC"],(function(t,n,r,o,a,i,l){"use strict";var e=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i,s="ZZ";function u(t,n,r,a){var i=t.match(e),l=i&&i[1];if(l==null)return null;var u=o("WAPhoneFindCC").phoneCC(r),c;if(n==="whatsapp")c="";else{var d=o("WAJids").interpretAndValidateJid(n.toString());c=d.jidType!=="lidUser"?o("WAPhoneFindCC").phoneCC(o("WAJids").toPhoneUserJid(n)):s}var m=a.map(function(e){return e.toLowerCase()});return o("WAIdn").findSuspiciousCharacters(l,c,u,m)}l.findSuspiciousCharacters=u}),98);
__d("WAWebLinkify",["WAJids","WALinkify","WASuspiciousLinks","WAWebUserPrefsMeUser"],(function(t,n,r,o,a,i,l){function e(e,t,n){t===void 0&&(t=!1);var r=o("WALinkify").findLinks(e,t);return r.map(function(e){return c(e,n)})}function s(e,t,n){t===void 0&&(t=!1);var r=o("WALinkify").findLink(e,t);if(r!=null)return c(r,n)}function u(e){return e.body!=null&&s(e.body,!0)!=null}function c(e,t){var n=o("WAWebUserPrefsMeUser").getMaybeMePnUser(),r=null;if(t&&n){var a=t.isLid()?o("WAJids").toLidUserJid(t.user):o("WAJids").toPhoneUserJid(t.user);r=o("WASuspiciousLinks").findSuspiciousCharacters(e.domain,a,o("WAJids").toPhoneUserJid(n.user),[])}return babelHelpers.extends({},e,{suspiciousCharacters:r!=null?r:void 0})}l.findLinks=e,l.findLink=s,l.hasHttpLink=u}),98);
__d("LoggingPaymentLinkWithoutPreviewFeature",["PaymentLink","WAWebLinkify","WAWebUserPrefsMeUser"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("PaymentLink").shouldDetectInComposer()}function s(t,n,r){if(!e())return n;var a=t==null?void 0:t.psp;if(a==null&&t==null){var i=o("WAWebLinkify").findLink(r,!1,o("WAWebUserPrefsMeUser").getMeDevicePnOrThrow());a=i!=null?o("PaymentLink").getPSP(i.url):null}return a==null?n:babelHelpers.extends({},n,{provider:{paramsJson:JSON.stringify({name:a})}})}l.getMetadata=s}),98);
__d("PaymentLinkPSPImagePathMapper",["bx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=Object.freeze({"mercadopago-light":(e=r("bx")).getURL(e("32187")),"mercadopago-dark":e.getURL(e("32186"))});l.PaymentLinkPSPImagePathMapper=s}),98);
__d("PaymentLinkPreviewWithTrustSignalsFeature",["WALogger","WAWebABProps","WAWebLinkify","WAWebMobilePlatforms","WAWebMsgGetters","WAWebUserPrefsMeUser"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return o("WAWebMsgGetters").getHasPaymentLinkTrustSignals(e)}function c(e,t,n,r){if(e==null&&t==null)return!1;if(t==null||t.length===0||e!==!0)return!0;var a=n==null?void 0:n.psp;if(a==null||!d(a))return!1;var i=o("WAWebLinkify").findLinks(r,!1,o("WAWebUserPrefsMeUser").getMeDevicePnOrThrow());return i.length!==1||o("WAWebABProps").getABPropConfigValue("payment_br_holdout")?!1:o("WAWebABProps").getABPropConfigValue("payment_links_trust_signals_metatag_enabled")}function d(t){try{var n=JSON.parse(o("WAWebABProps").getABPropConfigValue("payment_links_trust_signals_metatag_psp_list")),r=n==null?void 0:n.psp;return Array.isArray(r)?r.includes(t):!1}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[PAYMENT LINK WITH TRUST SIGNALS] error while parsing json for ab prop payment_links_trust_signals_metatag_psp_list: ",""])),t),!1}}function m(e,t,n){var r,a;if(!o("WAWebMobilePlatforms").isSMB())return t;var i=e==null?void 0:e.previewMetadata;if(i==null)return t;var l=i.isBusinessVerified,u=(r=i.providerName)==null?void 0:r.trim();if(!c(l,u,e,n))return t;var d=t==null||(a=t.provider)==null?void 0:a.paramsJson;try{var m=d==null?null:JSON.parse(d);if(l!=null){var p;m=babelHelpers.extends({},m,{meta_tags:babelHelpers.extends({},(p=m)==null?void 0:p.meta_tags,{is_business_verified:l})})}if(u!=null&&u.length>0){var _;m=babelHelpers.extends({},m,{meta_tags:babelHelpers.extends({},(_=m)==null?void 0:_.meta_tags,{provider_name:u})})}return m==null?t:babelHelpers.extends({},t,{provider:{paramsJson:JSON.stringify(m)}})}catch(e){return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[PAYMENT LINK WITH TRUST SIGNALS] error while parsing paramsJson from payment link metadata: ",""])),e),t}}l.shouldShowPaymentLinkTrustSignals=u,l.isPSPInTrustSignalsFeatureAllowlist=d,l.setMetadata=m}),98);
__d("PaymentLinkTraceIdLoggingFeature",["WALogger","WAWebABProps","WAWebMobilePlatforms","WAWebPonyfillsCryptoRandomUUID"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n;if(!o("WAWebMobilePlatforms").isSMB()||!o("WAWebABProps").getABPropConfigValue("payment_link_trace_id_logging_enabled"))return t;var a=t==null||(n=t.provider)==null?void 0:n.paramsJson;try{if(a==null)return t;var i=JSON.parse(a);return i=babelHelpers.extends({},i,{payment_link_trace_id:r("WAWebPonyfillsCryptoRandomUUID")().toLowerCase()}),babelHelpers.extends({},t,{provider:{paramsJson:JSON.stringify(i)}})}catch(n){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[PAYMENT LINK TRACE ID LOGGING] error while parsing paramsJson from payment link metadata: ",""])),n).sendLogs("[PAYMENT LINK TRACE ID LOGGING] error while parsing paramsJson from payment link metadata"),t}}l.setTraceId=s}),98);
__d("PaymentLink",["LoggingPaymentLinkWithoutPreviewFeature","PaymentLinkPSPImagePathMapper","PaymentLinkPreviewWithTrustSignalsFeature","PaymentLinkTraceIdLoggingFeature","PaymentLinkWithCTAFeature","WAWebABProps","WAWebMobilePlatforms"],(function(t,n,r,o,a,i,l){"use strict";var e="Open payment link";function s(e,t){if(e==null)return null;var n=e+(t?"-dark":"-light");return Object.prototype.hasOwnProperty.call(o("PaymentLinkPSPImagePathMapper").PaymentLinkPSPImagePathMapper,n)?o("PaymentLinkPSPImagePathMapper").PaymentLinkPSPImagePathMapper[n]:null}function u(e){var t=JSON.parse(o("WAWebABProps").getABPropConfigValue("smb_payment_links_url_regex_list"));for(var n in t)if(e.match(n))return t[n];return null}function c(){return o("WAWebMobilePlatforms").isSMB()}function d(e,t){var n=null;return n=o("PaymentLinkWithCTAFeature").getMetadata(e,n),n=o("LoggingPaymentLinkWithoutPreviewFeature").getMetadata(e,n,t),n=o("PaymentLinkPreviewWithTrustSignalsFeature").setMetadata(e,n,t),n=o("PaymentLinkTraceIdLoggingFeature").setTraceId(n),n}function m(e){var t=JSON.parse(o("WAWebABProps").getABPropConfigValue("smb_payment_links_url_regex_list"));for(var n in t)if(e.match(n))return{psp:t[n],shouldDetectInComposer:c()};return null}l.CTA_TEXT=e,l.getPSPIconPath=s,l.getPSP=u,l.shouldDetectInComposer=c,l.getPaymentLinkMessageMetadata=d,l.getPaymentLinkUrlMetaData=m}),98);
__d("PaymentLinkWithCTAFeature",["$InternalEnum","PaymentLink","WALogger","WAWebABProps","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){"use strict";var e,s=n("$InternalEnum")({LINK_PREVIEW_HEADER_WITH_CTA:0,ORDER_HEADER_WITH_CTA:1,DEFAULT:2});function u(e){var t;return c()?!1:(e==null||(t=e.header)==null?void 0:t.headerType)===o("WAWebProtobufsE2E.pb").Message$PaymentLinkMetadata$PaymentLinkHeader$PaymentLinkHeaderType.ORDER}function c(){return o("WAWebABProps").getABPropConfigValue("smb_payment_links_cta_button_kill_switch")}function d(t){var n;if(c())return s.DEFAULT;try{var r=JSON.parse(o("WAWebABProps").getABPropConfigValue("smb_payment_links_cta_psp_list")),a=r==null?void 0:r.psp;if(!Array.isArray(a)||(a==null?void 0:a.includes(t))===!1)return s.DEFAULT}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[PAYMENT LINK WITH CTA] error while parsing json for ab prop smb_payment_links_cta_psp_list: ",""])),t),s.DEFAULT}return o("WAWebABProps").getABPropConfigValue("payment_br_holdout")?s.DEFAULT:(n=s.cast(o("WAWebABProps").getABPropConfigValue("smb_payment_links_cta_variant")))!=null?n:s.DEFAULT}function m(e,t){var n=e==null?void 0:e.psp;if(n==null)return t;var r=d(n);return r===s.LINK_PREVIEW_HEADER_WITH_CTA?babelHelpers.extends({},t,{button:{displayText:o("PaymentLink").CTA_TEXT},header:{headerType:o("WAWebProtobufsE2E.pb").Message$PaymentLinkMetadata$PaymentLinkHeader$PaymentLinkHeaderType.LINK_PREVIEW}}):r===s.ORDER_HEADER_WITH_CTA?babelHelpers.extends({},t,{button:{displayText:o("PaymentLink").CTA_TEXT},header:{headerType:o("WAWebProtobufsE2E.pb").Message$PaymentLinkMetadata$PaymentLinkHeader$PaymentLinkHeaderType.ORDER}}):r===s.DEFAULT?t:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+r)})()}l.PaymentLinkVariant=s,l.shouldShowPaymentLinkOrderHeader=u,l.isKillSwitchEnabled=c,l.getMetadata=m}),98);
__d("WAWebApi",["$InternalEnum"],(function(t,n,r,o,a,i){var e={GROUP_INVITE:"GROUP_INVITE",MSG_SEND:"MSG_SEND",INVALID:"INVALID",CATALOG:"CATALOG",PRODUCT:"PRODUCT",PUSH_NOTIFICATION:"PUSH_NOTIFICATION",CREATE_COMMUNITY:"CREATE_COMMUNITY",NEWSLETTER:"NEWSLETTER",AVATAR_STICKERPACK:"AVATAR_STICKERPACK",ADVERTISE:"ADVERTISE",MANAGE_ADS:"MANAGE_ADS",MESSAGE_YOURSELF:"MESSAGE_YOURSELF",BROADCAST:"BROADCAST",STATUS_POST:"STATUS_POST",EDIT_PROFILE_PICTURE:"EDIT_PROFILE_PICTURE",CALL_USER:"CALL_USER",PAYMENT_LINK:"PAYMENT_LINK",FAVORITES:"FAVORITES",OPEN_CATALOG:"OPEN_CATALOG",STICKER_PACK:"STICKER_PACK",CATALOG_LINKING_CHAT_PSA:"CATALOG_LINKING_CHAT_PSA",UGC_BOT:"UGC_BOT",CALL_LINK:"CALL_LINK",CTWA_ADS_DATA_SHARING:"CTWA_ADS_DATA_SHARING",WEB_REGISTRATION:"WEB_REGISTRATION",WEB_REGISTRATION_CAMPAIGN:"WEB_REGISTRATION_CAMPAIGN",BRAZIL_PAYMENTS:"BRAZIL_PAYMENTS",NEW_CHAT:"NEW_CHAT",NEW_CALL:"NEW_CALL",BIZ_AGENTS_ONBOARDING:"BIZ_AGENTS_ONBOARDING",BIZ_BROADCAST_AUDIENCE_MODAL:"BIZ_BROADCAST_AUDIENCE_MODAL",BIZ_BROADCAST_HOME:"BIZ_BROADCAST_HOME",WORK_CONTACT_SYNC:"WORK_CONTACT_SYNC",SEND_FILE:"SEND_FILE"},l=n("$InternalEnum").Mirrored(["PIX_FAQ","PIX_ONBOARDING"]);i.APICmd=e,i.BrazilPaymentResultSubtype=l}),66);
__d("WAWebApiParseUtils",["WAWebBuildConstants"],(function(t,n,r,o,a,i,l){var e=function(t){return t.replace(/\/+$/,"")},s=e(o("WAWebBuildConstants").BUILD_URL).replace(/[\/\.]/g,"\\$&"),u="((?:/\\w+)*)",c="(?:(?:/\\w+)*)";function d(e){var t=e.hostname;return t==="whatsapp.com"||t==="www.whatsapp.com"||t==="wa.me"}l.ORIGIN=s,l.OPTIONAL_PATH_PART=u,l.OPTIONAL_NON_CAPTURING_PATH_PART=c,l.isWhatsappHost=d}),98);
__d("WAWebBroadcastApiParse",["$InternalEnum","WAWebABProps","WAWebApiParseUtils"],(function(t,n,r,o,a,i,l){var e=new RegExp("^"+o("WAWebApiParseUtils").ORIGIN+o("WAWebApiParseUtils").OPTIONAL_PATH_PART+"/accept/?\\?channel_invite_code=(?:&.*)?$","i"),s=n("$InternalEnum").Mirrored(["Newsletter","Status"]);function u(e){return e.length===0||e.length===1&&e[0]===""}function c(t){try{var n=new URL(t),r=n.pathname,a=r.split("/"),i=a[0],l=a[1],c=babelHelpers.arrayLikeToArray(a).slice(2);if(o("WAWebApiParseUtils").isWhatsappHost(n)){if(!u(c))return null;e:{if(l==="channels"||l==="channel")return{feature:s.Newsletter,url:n.href};if(l==="status")return{feature:s.Status,url:n.href};if(l==="updates")return o("WAWebABProps").getABPropConfigValue("status_deeplink_enabled")?{feature:s.Status,url:n.href}:null;break e}}var d=t.match(e);if(d)return{feature:s.Newsletter,url:t}}catch(e){}return null}l.BroadcastFeatureType=s,l.parseBroadcastFeatureLink=c}),98);
__d("WAWebExternalCtxConfig",["WAWebABProps"],(function(t,n,r,o,a,i,l){var e="partnertoken",s="token";function u(){return o("WAWebABProps").getABPropConfigValue("external_ctx_authorise_wa_chat")}function c(){return o("WAWebABProps").getABPropConfigValue("external_ctx_foa_logging")===1}function d(){var e=o("WAWebABProps").getABPropConfigValue("external_ctx_authorise_existing_chats");return e===1?"NEW_CHATS_OR_EXISTING_CHATS_WITH_PARTNER_LINKS":e===2?"ALL_CHATS":"NEW_CHATS_ONLY"}function m(){var t=o("WAWebABProps").getABPropConfigValue("external_ctx_url_param_names")||"",n=t.split(",").map(function(e){return e.trim()}).filter(function(e){return e!==""});return n=n.length>0?n:[e],c()&&n.push(s),n}l.isCtxLoggingEnabled=u,l.getFirstMessageLoggingOption=d,l.getExternalCtxUrlParamNames=m}),98);
__d("WAWebNewsletterApiParse",["$InternalEnum","WAWebApiParseUtils","WAWebChatEntryPoint","WAWebWamEnumTsSurface"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum").Mirrored(["Handle","InviteCode","Id"]),s="channel",u="create",c="directory",d=new RegExp("^"+o("WAWebApiParseUtils").ORIGIN+o("WAWebApiParseUtils").OPTIONAL_PATH_PART+"/accept/?\\?channel_invite_code=(\\w+)(?:&.*)?$","i"),m=new RegExp("^whatsapp://("+s+")/(\\w+)/?(?:\\?.*)?$","i");function p(e){return e.length===0||e.length===1&&e[0]===""}function _(t,n){try{var r=new URL(t),a=r.pathname,i=a.split("/"),l=i[0],_=i[1],g=i[2],h=babelHelpers.arrayLikeToArray(i).slice(3);if(_===s&&o("WAWebApiParseUtils").isWhatsappHost(r)){if(p(h))switch(g){case u:return{type:"create",url:r.href};case c:return{type:"directory",url:r.href};default:if(g!=null&&g!=="")return{identifier:g,url:r.href,identifierType:e.InviteCode,type:"view",chatEntryPoint:o("WAWebChatEntryPoint").ChatEntryPoint.Link,discoverySurface:n!=null?n:o("WAWebWamEnumTsSurface").TS_SURFACE.CHANNEL_LINK}}if(g!==u&&g!==c&&(h.length===1||h.length===2&&h[1]==="")){var y=parseInt(h[0],10);return babelHelpers.extends({identifier:g,url:r.href,identifierType:e.InviteCode,type:"view",chatEntryPoint:o("WAWebChatEntryPoint").ChatEntryPoint.Link,discoverySurface:o("WAWebWamEnumTsSurface").TS_SURFACE.CHANNEL_LINK},!Number.isNaN(y)&&{serverId:y})}}var C=f(d,t);if(C!=null)return C;var b=f(m,t);return b!=null?b:null}catch(e){return null}}function f(t,n){var r=n.match(t);if(r){var a=r[2];return a===u?{type:"create",url:n}:a===c?{type:"directory",url:n}:{identifier:r[2],url:r[1]||"/",identifierType:e.InviteCode,type:"view",chatEntryPoint:o("WAWebChatEntryPoint").ChatEntryPoint.Deeplink,discoverySurface:o("WAWebWamEnumTsSurface").TS_SURFACE.CHANNEL_LINK}}return null}function g(e){return e==null?!1:e.startsWith("http://")||e.startsWith("https://")?_(e)!=null:_("https://"+e)!=null}l.NewsletterIdentifierType=e,l.parseNewsletter=_,l.isNewsletterInviteCode=g}),98);
__d("WAWebStatusApiParse",["$InternalEnum","WAWebApiParseUtils","WAWebPonyfillsUrlSearchParams"],(function(t,n,r,o,a,i,l){"use strict";var e="status",s="text",u="photo",c=n("$InternalEnum").Mirrored(["Text","Media"]);function d(e){return e.length===0||e.length===1&&e[0]===""}function m(t){try{var n=new URL(t),a=n.pathname;if(!o("WAWebApiParseUtils").isWhatsappHost(n))return null;var i=a.split("/"),l=i[0],m=i[1],p=babelHelpers.arrayLikeToArray(i).slice(2);if(!d(p)||m!==e)return null;var _=n.searchParams||new(r("WAWebPonyfillsUrlSearchParams"))(n.search),f=_.get(s);if(f!=null)return{postType:c.Text,url:n.href};var g=_.get(u);if(g!=null)return{postType:c.Media,url:n.href}}catch(e){}return null}l.StatusPostType=c,l.parseStatusPostFeatureLink=m}),98);
__d("WAWebUsernameTypes",["$InternalEnum","err"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({PNH_CTWA:"ctwa",GENERAL:"general"}),s=n("$InternalEnum").Mirrored(["INVALID_CHARACTER","INVALID_LENGTH","INVALID_NO_LETTERS","INVALID_PERIODS","INVALID_DOMAIN_SUFFIX","INVALID_WWW_PREFIX"]),u=3,c=35,d=4,m=/^[0-9]{4}$/;function p(e){return e.length===d&&m.test(e)}function _(e){if(!p(e))throw r("err")("[username][key] Cannot convert key string to UsernameKey");return e}l.LidOriginType=e,l.UsernameValidationErrorType=s,l.USERNAME_MIN_LENGTH=u,l.USERNAME_MAX_LENGTH=c,l.isUsernameKey=p,l.asUsernameKey=_}),98);
__d("WAWebWamEnumDeepLinkType",[],(function(t,n,r,o,a,i){var e=Object.freeze({DEEP_LINK_UNKNOWN:1,DEEP_LINK_CHAT:2,DEEP_LINK_CONTACT_QR_CODE:3,DEEP_LINK_PAYMENT:4,DEEP_LINK_PRODUCT:5,DEEP_LINK_CATALOG:6,DEEP_LINK_FUTURE_PROOF:7,DEEP_LINK_GROUP_INVITE:8,DEEP_LINK_MSG_FORWARD:9,DEEP_LINK_MESSAGE_QR_CODE:10,DEEP_LINK_OPT_IN_QR_CODE:11,DEEP_LINK_CTWA:12,DEEP_LINK_STICKERPACK:13,DEEP_LINK_NOVI_HUB:14,DEEP_LINK_NOVI_ADD_DEBIT_CARD:15,DEEP_LINK_NOVI_ADD_BANK_ACCOUNT:16,DEEP_LINK_NOVI_WITHDRAW:17,DEEP_LINK_NOVI_RESET_PASSWORD:18,DEEP_LINK_PAYMENT_SIGNUP:19,DEEP_LINK_BIZTOOLS_ACCOUNTS:20,DEEP_LINK_PAYMENT_VIRALITY:21,DEEP_LINK_SETTINGS_ACCOUNT_DELETE:22,DEEP_LINK_SETTINGS_ACCOUNT_REQUEST_INFO:23,DEEP_LINK_SETTINGS_CHATS_HISTORY:24,DEEP_LINK_DISAPPEARING_MODE:25,DEEP_LINK_ARCHIVE_SETTINGS:26,DEEP_LINK_TOS:27,DEEP_LINK_NOVI_CARE:28,DEEP_LINK_NOVI_TPP_ACCOUNT_LINKING:29,DEEP_LINK_CONTACT_SUPPORT:30,DEEP_LINK_BIZTOOLS_DIRECTORY:31,DEEP_LINK_DIRECTORY:32,DEEP_LINK_CALL:33,DEEP_LINK_DIRECTORY_DEEPER_CATEGORY_SELECTION:34,DEEP_LINK_PHOENIX:35,DEEP_LINK_HELP_CENTER_TO_SETTINGS_CHATS:36,DEEP_LINK_CREATE_COMMUNITY:37,DEEP_LINK_SMB_AD_CREATION:38,DEEP_LINK_SMB_MANAGE_ADS:39,DEEP_LINK_SMB_MANAGE_ADS_DETAIL:40,DEEP_LINK_STATUS_SHARE:41,DEEP_LINK_PREMIUM:42,DEEP_LINK_SETTINGS_LINKED_DEVICES:43,DEEP_LINK_SMB_AD_CREATION_FROM_CATALOG:44,DEEP_LINK_SMB_AD_CREATION_FROM_BIZTAB:45,DEEP_LINK_SMB_EDIT_PROFILE:46,DEEP_LINK_EDIT_PROFILE_PIC:47,DEEP_LINK_SMB_EDIT_CATALOG:48,DEEP_LINK_SMB_BIZ_HOURS:49,DEEP_LINK_SMB_LOCATION:50,DEEP_LINK_SMB_LINKED_ACCOUNTS:51,DEEP_LINK_PRIVACY_SETTINGS:52,DEEP_LINK_SMB_EDIT_DESCRIPTION:53,DEEP_LINK_SMB_AD_CREATION_RESUME:54,DEEP_LINK_PRIVACY_DISCLOSURE:55,DEEP_LINK_CHANNEL:56,DEEPLINK_SMB_BIZ_WEBSITE:57,DEEP_LINK_PRIVACY_CHECKUP:58,DEEP_LINK_SMB_SELF_CATALOG:59,DEEP_LINK_SCAN_MIGRATION_QR_CODE:60,DEEP_LINK_PROXY:61,DEEP_LINK_HELP:62,DEEP_LINK_PRICE_TIER:63,DEEP_LINK_CALLING_PRIVACY:64,DEEP_LINK_PAYMENTS_PUSH_PROVISIONING:65,DEEP_LINK_FB_EVENT_LINK:66,DEEP_LINK_SETTINGS_ACCOUNT_2FA:67,DEEP_LINK_SMB_ADVERTISE_PROFILE:68,DEEP_LINK_SMB_LABELS_WITH_BIZTAB:69,DEEP_LINK_SMB_GREETING_MESSAGE_WITH_BIZTAB:70,DEEP_LINK_SMB_AWAY_MESSAGE_WITH_BIZTAB:71,DEEP_LINK_SMB_ADVERTISE_LATEST_STATUS:72,DEEP_LINK_SMB_PROFILE_COMPLETENESS:73,DEEP_LINK_SMB_AD_DETAILS:74,DEEP_LINK_SETTINGS_ACCOUNT_SWITCHER:75,DEEP_LINK_CHAT_TRANSFER:76,DEEP_LINK_CODE_LINKING:77,DEEP_LINK_MARKETING_MESSAGE:78,DEEP_LINK_HOME_CHATS:79,DEEP_LINK_MESSAGE_YOURSELF:80,DEEP_LINK_SETTINGS_ACCOUNT_EMAIL:81,DEEP_LINK_EDIT_AD:82,DEEP_LINK_MESSAGING_GUIDE:83,DEEP_LINK_SMB_DRAFT_AD:84,DEEP_LINK_CALLING_AWARENESS_VOICE_CHAT:85,DEEP_LINK_CALLING_AWARENESS_SCHEDULED_CALL:86,DEEP_LINK_COEXISTENCE_ONBOARDING:87,DEEP_LINK_SETTINGS_STORAGE_MANAGEMENT:88,DEEP_LINK_PAYMENT_BRAZIL_MERCHANT:89,DEEP_LINK_PAYMENT_BRAZIL_BUYER:90,DEEP_LINK_PRIVACY_GROUPS:91,DEEP_LINK_PRIVACY_PROFILE:92,DEEP_LINK_AIS:93,DEEP_LINK_PENDING_AD_PAYMENT:94,DEEP_LINK_PENDING_AD_REVIEW:95,DEEP_LINK_SETTINGS_ACCOUNT_VERIFY_EMAIL:96,DEEP_LINK_CTWA_EXTERNAL:97,DEEP_LINK_SMB_BIZ_SEARCH_ONBOARDING_SHEET:98,DEEP_LINK_CALLING_AWARENESS_GROUP_CALL:99,DEEP_LINK_SMB_ORDERS_HOME:100,DEEP_LINK_ADS_DATA_SHARING:101,DEEP_LINK_VIDEO_PROMOTION:102,DEEP_LINK_CTWA_RECENTLY_SHARED_MEDIA:103,DEEP_LINK_MARKETING_MESSAGE_OPT_IN:104,DEEP_LINK_GROUPS_PRIVACY:105,DEEP_LINK_PROFILE_PRIVACY:106,DEEP_LINK_ORDERS_EDUCATION_VIDEO:107,DEEP_LINK_META_VERIFIED:108,DEEP_LINK_SMB_AGENT_ONBOARDING:109,DEEP_LINK_SETTINGS_CHATS_BACKUP:110,DEEP_LINK_COUPONS_PROMOTION_IMPRESSION:111,DEEP_LINK_INVITE_A_FRIEND:112,DEEP_LINK_UPDATES:113,DEEP_LINK_CONTACTS_PERMISSION:114,DEEP_LINK_NOTIFICATIONS_PERMISSION:115,DEEP_LINK_WABAI_ONBOARDING:116,DEEP_LINK_CHAT_LIST:117,DEEP_LINK_BRAZIL_MERCHANT_PIX_ADD:118,DEEP_LINK_PAYMENT_UPI_EXPLORE_BUSINESSES:119,DEEP_LINK_PAYMENT_UPI_ACCOUNT_RECOVERY:120,DEEP_LINK_PAYMENT_UPI_ADD_BANK_ACCOUNT:121,DEEP_LINK_PAYMENT_UPI_START_CAMERA:122,DEEP_LINK_PAYMENT_UPI_RESUME_ONBOARDING:123,DEEP_LINK_PAYMENT_UPI_ADD_NUMBER:124,DEEP_LINK_PAYMENT_UPI_SEND_PAYMENT:125,DEEP_LINK_PAYMENT_UPI_SET_PIN:126,DEEP_LINK_PAYMENT_UPI_SET_2FA:127,DEEP_LINK_SETTINGS_ACCOUNT_PASSKEYS:128,DEEP_LINK_DOWNLOAD_SOURCE_SFW:129,DEEP_LINK_AVATAR_EDITOR:130,DEEP_LINK_BIZTOOLS_ACCOUNTS_LINK_FB:131,DEEP_LINK_PAYMENT_UPI_PAYMENT_HISTORY:132,DEEP_LINK_PAYMENT_UPI_HELP_CENTER:133,DEEP_LINK_PAYMENT_UPI_ACCOUNT_DETAILS:134,DEEP_LINK_PAYMENT_UPI_INVITE_OTHERS:135,DEEP_LINK_PAYMENT_UPI_SEND_FIRST_PAYMENT:136,DEEP_LINK_CLICK_TO_CALL:137,DEEP_LINK_INTER_APP_IDENTITY_SWITCH:138,DEEP_LINK_LISTS:139,DEEP_LINK_META_AI_IMAGINE_ME_ONBOARDING:140,DEEP_LINK_MEDIA_SEND_LIVE_ACTIVITY_OPEN_APP:141,DEEP_LINK_WAMO:142,DEEP_LINK_PAYMENT_UPI_QR_PROMINENCE:143,DEEP_LINK_SURVEY:144,DEEP_LINK_SETTINGS_ACCOUNT_SECURITY_CHECKUP:145,DEEP_LINK_THUNDERSTORM:146,DEEP_LINK_HELP_BOTTOMSHEET:147,DEEP_LINK_FAVORITE_CHAT_FILTER:148,DEEP_LINK_CATALOG_CATEGORY:149,DEEP_LINK_CATALOG_COLLECTION:150,DEEP_LINK_MAIBA_WEB_COEX_ONBOARDING:151,DEEP_LINK_SMB_ADD_PRODUCT:152,DEEP_LINK_CALL_PHONE_NUMBER:153,DEEP_LINK_ABPROP_OVERRIDE:154,DEEP_LINK_PROFILE:155,DEEP_LINK_SETTINGS_CHAT_THEMES:156,DEEP_LINK_AIMEDIAINPUT:157,DEEP_LINK_AIVOICE:158,DEEP_LINK_NEW_CUSTOM_LIST:159,DEEP_LINK_SHARED_DEVICE_PRIVACY:160,DEEP_LINK_IPAD_LAUNCH_APPEVENT:161,DEEP_LINK_CATALOG_SETTINGS:162,DEEP_LINK_BOOST_CATALOG:163,DEEP_LINK_PRIVACY_STATUS:164,DEEP_LINK_INTEROP_SETTINGS:165,DEEP_LINK_SMB_AD_RESOLVE_PAYMENT:166,DEEP_LINK_CONSENT_LAUNCHER:167,DEEP_LINK_SETTINGS_HOME_SCREEN_NOTIFICATIONS:168,DEEP_LINK_WA_LINK_ACCOUNTS:169,DEEP_LINK_PAYMENT_PIX_DEEP_INTEGRATION:170,DEEP_LINK_ACCOUNT_TRANSFER:171,DEEP_LINK_SG_CONNECT_BOTTOMSHEET:172,DEEP_LINK_BIZ_AI_LEARNING_SUMMARY:173,DEEP_LINK_BIZ_AI_HUB:174,DEEP_LINK_BIZ_MANAGE_DATA_SHARING:175,DEEPLINK_SETTINGS_EDIT_PROFILE_PHOTO:176,DEEPLINK_ADD_STATUS_GALLERY:177,DEEP_LINK_TURN_OFF_DO_NOT_DISTURB:178,DEEP_LINK_SHARE_WHATSAPP_WEB:179,DEEP_LINK_ACCOUNTS_CENTER_ADD_ACCOUNT:180,DEEP_LINK_COEXISTENCE_REONBOARDING:181,DEEP_LINK_SMB_QUICK_REPLIES_WITH_BIZTAB:182,DEEP_LINK_STATUS_PRIVACY:183,DEEP_LINK_IAP_PB_SUBSCRIPTION_HUB:184,DEEP_LINK_SHARESHEET:185,DEEP_LINK_SETTINGS_RECOMMENDED_CHANNELS_NOTIFICATIONS:186,DEEP_LINK_PAA_LINKING:187,REGISTRATION:188,DEEP_LINK_SMB_LEARNING_HUB:189,DEEP_LINK_SUSPICIOUS_LINK:190,DEEP_LINK_REENGAGE_MESSAGE_REMINDER:191,DEEP_LINK_SETTINGS_BACKUP_TOKEN_EDUCATION_UPSELL:192,DEEP_LINK_WEB_SIGNUP:193,DEEP_LINK_SMB_BILLING_HUB:194,DEEP_LINK_WA_ME_DOWNLOAD:195,DEEP_LINK_SMB_DAILY_ADS_SUMMARY:196,DEEP_LINK_SET_ABOUT:197,DEEP_LINK_SMB_BIZTOOLS:198,DEEP_LINK_PRIVACY_ABOUT:199,DEEP_LINK_AUTOMATIC_EVENTS_ONBOARDING_NUX:200,DEEP_LINK_SERVER_INVITE:201,DEEP_LINK_PAYMENT_UPI_LITE_ONBOARD:202,DEEP_LINK_AVATAR_UNLOCKABLES:203,DEEP_LINK_SCALE_GOOD_CAMPAIGNS:204,DEEP_LINK_GOOGLE_ELIGIBILITY_API_OPT_OUT:205,DEEP_LINK_SMB_USERNAME:206,DEEP_LINK_PASSKEY_EMAIL_COMBINED_UPSELLS:207,DEEP_LINK_CALLING_AWARENESS_CALLS_TAB:208,DEEP_LINK_WATCH_UPSELL_BOTTOM_SHEET:209,DEEP_LINK_USERNAME:210,DEEP_LINK_WHATSAPP_DOWNLOAD:211,DEEP_LINK_SETTINGS_CHATS_PRIVATE_PROCESSING:212,DEEP_LINK_JOIN_NOVA_WAITLIST:213});i.DEEP_LINK_TYPE=e}),66);
__d("WAWebApiParse",["PaymentLink","WAArrayBufferUtils","WABase64","WABinary","WALogger","WAWebABProps","WAWebApi","WAWebApiParseUtils","WAWebBroadcastApiParse","WAWebExternalCtxConfig","WAWebNewsletterApiParse","WAWebPonyfillsUrlSearchParams","WAWebStatusApiParse","WAWebUsernameGatingUtils","WAWebUsernameTypes","WAWebVoipGatingUtils","WAWebWamEnumDeepLinkType","gkx","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p=new RegExp("^"+(m=o("WAWebApiParseUtils")).ORIGIN+m.OPTIONAL_PATH_PART+"/accept/?\\?code=(\\w+)(?:&.*)?$","i"),_=/^https?:\/\/chat\.whatsapp\.com\/invite\/(\w+)(?:\?.*)?$/i,f=/^https?:\/\/chat\.whatsapp\.com\/(\w+)(?:\?.*)?$/i,g=/^whatsapp:\/\/chat\/?\?code=(\w+)(?:&.*)?$/i,h=function(t){var e=Me(t),n=t.match(p);if(n)return babelHelpers.extends({code:n[2],url:n[1]||"/"},e!=null&&{utm:e});if(n=t.match(_),n)return babelHelpers.extends({code:n[1]},e!=null&&{utm:e});if(n=t.match(f),n)return babelHelpers.extends({code:n[1]},e!=null&&{utm:e});if(n=t.match(g),n)return babelHelpers.extends({code:n[1]},e!=null&&{utm:e})},y="utm_source",C="utm_campaign",b=["utm_source","utm_campaign","text","phone","source","context","icebreaker","source_url","type","token","attachment_uris","username","jid"];function v(e){return b.find(function(t){return t===e})}var S=32;function R(e){if(!(!e||typeof e!="string")){var t=o("WABinary").Binary.build(e);if(!(t.size()>o("WAWebABProps").getABPropConfigValue("ctwa_data_max_length")))return t.readBuffer()}}function L(e,t){var n=e,r=o("WABinary").numUtf8Bytes(n);r>S||(t.conversionTuple==null?t.conversionTuple={conversionSource:n}:t.conversionTuple.conversionSource=n)}function E(e,t,n){e:{if(e==="source_url"){n.ctwaContextLinkData!=null?n.ctwaContextLinkData.sourceUrl=t:n.ctwaContextLinkData={sourceUrl:t};break e}if(e==="context"){n.ctwaContextLinkData!=null?n.ctwaContextLinkData.context=t:n.ctwaContextLinkData={context:t};break e}if(e==="icebreaker"){n.ctwaContextLinkData!=null?n.ctwaContextLinkData.icebreaker=t:n.ctwaContextLinkData={icebreaker:t};break e}break e}}function k(t){if(t!=null&&t.split(".").length===3){var n=t.split(".")[1].replace(/\s/g,"");try{var r=o("WABase64").decodeB64UrlSafe(n);return JSON.parse(o("WAArrayBufferUtils").arrayBufferToString(r))}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseCTWADeeplinkToken: failed to parse token: ",""])),String(t)).sendLogs("ctwa-deeplink-token-parse-error").tags("ctwa-error"),{}}}return{}}function I(e){var t={};return Object.keys(e).forEach(function(n){var r=e[n];if(r!=null)switch(n){case"source":{L(r,t);break}case"source_url":case"context":case"icebreaker":{E(n,r,t);break}default:(n==="phone"||n==="text"||n==="type")&&(t[n]=r)}}),t}function T(e,t){var n={};if(new(r("WAWebPonyfillsUrlSearchParams"))(e).forEach(function(e,t){var r=v(t.toLowerCase());if(r!=null)switch(r){case"source":{L(e,n);break}case"source_url":case"context":case"icebreaker":E(r,e,n);break;case"utm_campaign":n.utm!=null?n.utm.campaign=e:n.utm={campaign:e};break;case"utm_source":n.utm!=null?n.utm.source=e:n.utm={source:e};break;case"token":{var a=k(e),i=I(a);Object.assign(n,i),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseMsgSendParams:parsed values"])));break}case"attachment_uris":n.attachmentUris=e.split(",");break;case"jid":n.jid=e;break;case"username":{var l=e.split(":"),u=l[0],c=l[1];n.username=u,c!=null&&o("WAWebUsernameTypes").isUsernameKey(c)&&(n.usernameKey=c)}break;default:n[r]=e}}),n.phone!=null&&n.phone!==""&&(n.phone=n.phone.replace(/\D/g,"")+"@c.us",n.ctwaContextLinkData&&(n.ctwaContextLinkData.phone=n.phone)),n.ctwaContextLinkData==null){var a=xe(t);a!=null&&(n.partnertoken=a)}if(!r("isStringNullOrEmpty")(n.phone)||!r("isStringNullOrEmpty")(n.text)||n.attachmentUris!=null&&n.attachmentUris.length>0||!r("isStringNullOrEmpty")(n.username))return n}var D=/^whatsapp:\/\/newchat\/?(\?.*)?$/i,x=/^whatsapp:\/\/newcall\/$/i,$=new RegExp("^"+m.ORIGIN+m.OPTIONAL_PATH_PART+"/sendfile/?\\?(.+)$","i"),P=new RegExp("^"+m.ORIGIN+m.OPTIONAL_PATH_PART+"/send/?\\?(.+)$","i"),N=/^https?:\/\/api\.whatsapp\.com\/send\/?\?(.+)$/i,M=/^whatsapp:\/\/send\/?\?(.*)$/i,w=/^https?:\/\/wa\.me\/?(?:([0-9.]{0,20}))\/?\??(.+)?$/i,A=/^https?:\/\/wa\.me\/?(?:([0-9a-z.]{5,35}))?\/?\??(.+)?$/i,F=/^https?:\/\/wa\.me\/?@?(?:([0-9a-z._]{3,30}))(?::([0-9]{4}))?(\/?\?(.*))?$/i,O=/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})$/i,B=/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})$/i,W=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([0-9]{0,20})/([0-9]{0,20})$","i"),q=/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})(\/?\?.*)$/i,U=/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})(\/?\?.*)$/i,V=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([0-9]{0,20})/([0-9]{0,20})(/?.*)$","i"),H=/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})$/i,G=/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})$/i,z=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([^/]{0,200})/([0-9]{0,20})$","i"),j=/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})(\/?\?.*)$/i,K=/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})(\/?\?.*)$/i,Q=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([^/]{0,200})/([0-9]{0,20})(/?.*)$","i"),X=/^https?:\/\/wa\.me\/biz-add-product\/?(.+)$/i,Y=/^whatsapp-smb:\/\/advertise\/?(.+)$/i,J=/^whatsapp-smb:\/\/manage-ads\/?(?:\?.*)?$/,Z=/^https?:\/\/wa\.me\/pay\/br\/merchant\/pix\/add\/?(.+)$/i,ee=/^https?:\/\/faq\.whatsapp\.com\/1013401987232838\/?(.+)$/i,te=new RegExp("^"+m.ORIGIN+m.OPTIONAL_PATH_PART+"/pay/br/merchant/pix/add/?(.+)$","i"),ne=/^whatsapp-smb:\/\/biztab\/manage-data-sharing\/?(?:\?.*)?$/i,re=/^whatsapp-smb:\/\/biz-agents-onboarding\/?(?:\?.*)?$/i,oe=/^whatsapp-smb:\/\/biz-broadcast-audience-modal\/?(?:\?.*)?$/i,ae=/^whatsapp-smb:\/\/biz-broadcast-home\/?(?:\?.*)?$/i,ie=/^https?:\/\/wa\.me\/biz-catalog-settings\/?(.+)$/i,le=/^https?:\/\/wa\.me\/biz-catalog-boost\/?(.+)$/i,se=/^whatsapp:\/\/message_yourself\/?(?:\?.*)?$/i,ue=/^https?:\/\/wa\.me\/message_yourself\/?(?:\?.*)?$/i,ce=new RegExp("^"+m.ORIGIN+m.OPTIONAL_PATH_PART+"/calluser/?\\?(.+)$","i"),de=/^https?:\/\/wa\.me\/call\?\\?(.+)$/i,me=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/reg/wacom[/\\?]{0,2}(.*)$","i"),pe=[O,B,H,G],_e=[W,z],fe=[V,Q],ge=[q,U,j,K],he=[].concat(pe,_e,fe,ge);function ye(e,t){for(var n=0;n<t.length;n++){var r=e.match(t[n]);if(r)return r}}var Ce=function(t){return ye(t,he)!=null},be=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/push/","i"),ve=/^https?:\/\/wa\.me\/c\/([0-9]{0,20})(?:\?.*)?$/i,Se=/^whatsapp:\/\/catalog\/([0-9]{0,20})(?:\?.*)?$/i,Re=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/catalog/([0-9]{0,20})?$","i"),Le=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/catalog/([0-9]{0,20})(/?.*)?$","i"),Ee=function(t){return[ve,Se,Re,Le].some(function(e){return t.match(e)})},ke=/^https?:\/\/wa\.me\/favorites\/?(?:\\?.*)?$/i,Ie=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/favorites/?(?:\\?.*)?$","i");function Te(e){if(o("WAWebUsernameGatingUtils").username1on1ChatCreationEnabled()){var t=e.match(F);if(t){var n=null;t[1]&&(n={username:t[1]});var r=t[2];if(r!=null&&o("WAWebUsernameTypes").isUsernameKey(r)&&(n=babelHelpers.extends({},n,{usernameKey:r})),t[3]){var a=T(t[3],e);a!=null&&(n=babelHelpers.extends({},n,a))}if(n!=null){var i=xe(e);i!=null&&(n=babelHelpers.extends({},n,{partnertoken:i}))}return n}}}function De(e){var t=e.match(P);if(t){var n=T(t[2],e);if(n)return n.url=t[1]||"/",n}if(t=e.match(N),t||(t=e.match(M),t))return T(t[1],e);if(t=e.match(w),t){var r,a=e.match(A);if(t[1]?r={phone:t[1]+"@c.us"}:a&&a[1]&&!a[2]&&(r={url:e,customUrl:a[1]},r=babelHelpers.extends({},r,Te(e))),t[2]){var i=T(t[2],e);i&&(r=babelHelpers.extends({},r,i))}if(r){var l=xe(e);l!=null&&(r.partnertoken=l)}if(r!=null||!o("WAWebUsernameGatingUtils").username1on1ChatCreationEnabled())return r}return Te(e)}function xe(e){var t=o("WAWebExternalCtxConfig").getExternalCtxUrlParamNames(),n=new URL(e);for(var r of t){var a=n.searchParams.get(r);if(a!=null)return a}return null}var $e=/^https?:\/\/wa\.me\/community\/create\/?(\?(.*))?$/i;function Pe(e){var t=e.match($e);if(t){var n=new(r("WAWebPonyfillsUrlSearchParams"))(t[1]).get("entrypoint");return{url:"/",entrypointType:n}}}function Ne(e,t){var n={catalogOwnerJid:e[1]+"@s.whatsapp.net"},r=xe(t);return r!=null&&(n.partnertoken=r),n}function Me(e){var t=new(r("WAWebPonyfillsUrlSearchParams"))(e),n=t.get(y),o=t.get(C);if(o==null&&n==null)return null;var a={};return n!=null&&(a.source=n),o!=null&&(a.campaign=o),a}function we(e){var t=e.match(ve)||e.match(Se);if(t)return Ne(t,e);if(t=e.match(Re),t)return babelHelpers.extends({},Ne(t,e),{url:"/"});if(t=e.match(Le),t){var n=Me(t[2]);return babelHelpers.extends({},Ne(t,e),n!=null&&{utm:n},{url:"/"})}}function Ae(e,t){var n={productId:e[1],businessOwnerJid:e[2]+"@s.whatsapp.net"},r=xe(t);return r!=null&&(n.partnertoken=r),n}function Fe(e){var t=ye(e,pe);if(t)return Ae(t,e);if(t=ye(e,_e),t)return babelHelpers.extends({},Ae(t,e),{url:"/"});if(t=ye(e,fe),t){var n=Me(t[3]);return babelHelpers.extends({},Ae(t,e),n!=null&&{utm:n},{url:"/"})}if(t=ye(e,ge),t){var r=Me(t[3]);return babelHelpers.extends({},Ae(t,e),r!=null&&{utm:r})}}function Oe(e){var t=e.match(be);if(t)return{url:"/"}}function Be(e){var t=new(r("WAWebPonyfillsUrlSearchParams"))(e),n=t.get("wa_campaign_id");if(!(n==null||n==="")){var o=t.get("wa_campaign_type");return o==null||o===""?null:{campaignId:n,campaignType:o}}}function We(e){var t=e.match(Y);if(t)return Be(t[1])}function qe(e){var t=e.match(X);if(t)return Be(t[1])}function Ue(e){var t=e.match(Z),n=null;if(t?n=t[1]:(t=e.match(te),t&&(n=t[2])),n!=null){var r=Be(n);if(r)return{resultType:"BRAZIL_PAYMENTS",data:babelHelpers.extends({},r,{subType:o("WAWebApi").BrazilPaymentResultSubtype.PIX_ONBOARDING})}}if(t=e.match(ee),t){var a=Be(t[1]);if(a)return{resultType:"BRAZIL_PAYMENTS",data:babelHelpers.extends({},a,{subType:o("WAWebApi").BrazilPaymentResultSubtype.PIX_FAQ})}}return null}function Ve(e){var t=e.match(ie);if(t){var n=Be(t[1]);if((n==null?void 0:n.campaignType)==="chat_psa")return{deepLinkType:o("WAWebWamEnumDeepLinkType").DEEP_LINK_TYPE.DEEP_LINK_CATALOG_SETTINGS}}var r=e.match(le);if(r){var a=Be(r[1]);if((a==null?void 0:a.campaignType)==="chat_psa")return{deepLinkType:o("WAWebWamEnumDeepLinkType").DEEP_LINK_TYPE.DEEP_LINK_BOOST_CATALOG}}}function He(e){return o("PaymentLink").getPaymentLinkUrlMetaData(e)}var Ge=/^https?:\/\/wa\.me\/stickerpack\/meta-avatar$/i,ze=/^https?:\/\/wa\.me\/edit-profile-picture$/i,je=/^https?:\/\/wa\.me\/stickerpack\/(?!meta-avatar)/i;function Ke(e){var t=e.match(je);return t!=null}function Qe(e){var t=e.match(Ge);return!!t}var Xe=/^https?:\/\/wa\.me\/ais\/(\d{14,20})\/?(\?.*)?$/i,Ye=new RegExp("^"+m.ORIGIN+m.OPTIONAL_NON_CAPTURING_PATH_PART+"/ais/(\\d{14,20})/?(\\?.*)?$","i");function Je(e){var t,n,r=((t=(n=e.match(Xe))!=null?n:e.match(Ye))!=null?t:[])[1];return r?{resultType:o("WAWebApi").APICmd.UGC_BOT,data:{fbid:r}}:null}function Ze(e){if(Ke(e)){var t=new URL(e),n=t.pathname.split("/"),r=n[0],o=n[1],a=n[2];return a}}function et(e){var t=e.match(je);if(t){var n=Ze(e);return{resultType:"STICKER_PACK",data:{url:n}}}}var tt=/^https:\/\/call\.whatsapp\.com\/(video|voice)\/(\w+)(?:\?.*)?$/i,nt=/^whatsapp:\/\/call\/(video|voice)\/(\w+)(?:\?.*)?$/i;function rt(e){var t=e.match(tt)||e.match(nt);if(t)return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Successfull parsed call link: ",""])),e),{resultType:"CALL_LINK",data:{token:t[2],callType:t[1]}};o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse call link: ",""])),e)}function ot(e){return rt(e)!=null}function at(e){var t=e.match(me);if(t&&t[0])return{referrer:"wacom",url:"/"}}function it(){var e=new(r("WAWebPonyfillsUrlSearchParams"))(window.location.search),t=e.get("work_contact_sync_data");return t!=null&&t!==""?{compressedData:t}:null}function lt(e){var t=e.match($);if(!t)return null;var n=new(r("WAWebPonyfillsUrlSearchParams"))(t[2]),a=n.get("sessionId");if(a==null||a.trim()==="")return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["parseSendFile: invalid or missing sessionId"]))).sendLogs("send-file-invalid-session-id"),null;var i=window.opener;return{originWindow:i,sessionId:a!=null?a:void 0,url:t[1]||"/"}}function st(e,t){if(typeof e!="string")return{resultType:o("WAWebApi").APICmd.INVALID};var n=h(e);if(n)return{resultType:o("WAWebApi").APICmd.GROUP_INVITE,data:n};var a=we(e);if(a)return{resultType:o("WAWebApi").APICmd.CATALOG,data:a};var i=Fe(e);if(i)return{resultType:o("WAWebApi").APICmd.PRODUCT,data:i};var l=Pe(e);if(l)return{resultType:o("WAWebApi").APICmd.CREATE_COMMUNITY,data:l};var s=Qe(e);if(s)return{resultType:o("WAWebApi").APICmd.AVATAR_STICKERPACK};var u=o("WAWebStatusApiParse").parseStatusPostFeatureLink(e);if(u)return{resultType:o("WAWebApi").APICmd.STATUS_POST,data:u};var c=o("WAWebBroadcastApiParse").parseBroadcastFeatureLink(e);if(c)return{resultType:o("WAWebApi").APICmd.BROADCAST,data:c};var d=o("WAWebNewsletterApiParse").parseNewsletter(e,t);if(d)return{resultType:o("WAWebApi").APICmd.NEWSLETTER,data:d};if([se,ue].some(function(t){return e.match(t)}))return{resultType:o("WAWebApi").APICmd.MESSAGE_YOURSELF};if([ke,Ie].some(function(t){return e.match(t)}))return{resultType:o("WAWebApi").APICmd.FAVORITES,data:{url:"/"}};var m=qe(e);if(m!=null)return{resultType:o("WAWebApi").APICmd.OPEN_CATALOG,data:m};var p=Ve(e);if(p!=null)return{resultType:o("WAWebApi").APICmd.CATALOG_LINKING_CHAT_PSA,data:p};var _=et(e);if(_){var f;return{resultType:o("WAWebApi").APICmd.STICKER_PACK,data:{url:(f=_.data.url)!=null?f:""}}}var g=Oe(e);if(g)return{resultType:o("WAWebApi").APICmd.PUSH_NOTIFICATION,data:g};var y=We(e);if(y!=null)return{resultType:o("WAWebApi").APICmd.ADVERTISE,data:y};if(o("WAWebVoipGatingUtils").callLinksEnabled()){var C=rt(e);if(C)return C}if(e.match(J))return{resultType:o("WAWebApi").APICmd.MANAGE_ADS,trigger:"chatListBanner"};if(e.match(ne)){var b=new URL(e),v=b.searchParams.get("source");return{resultType:o("WAWebApi").APICmd.CTWA_ADS_DATA_SHARING,source:v!=null?v:"unknown"}}if(e.match(re))return{resultType:o("WAWebApi").APICmd.BIZ_AGENTS_ONBOARDING};if(e.match(oe))return{resultType:o("WAWebApi").APICmd.BIZ_BROADCAST_AUDIENCE_MODAL};if(e.match(ae))return{resultType:o("WAWebApi").APICmd.BIZ_BROADCAST_HOME};var S=Ue(e);if(S)return S;if(e.match(ze))return{resultType:o("WAWebApi").APICmd.EDIT_PROFILE_PICTURE};if(o("WAWebABProps").getABPropConfigValue("wa_web_calling_deep_link_error")&&[ce,de].some(function(t){return e.match(t)}))return{resultType:o("WAWebApi").APICmd.CALL_USER,data:{url:"/"}};var R=He(e);if(R!=null)return{resultType:o("WAWebApi").APICmd.PAYMENT_LINK,data:R};var L=Je(e);if(L)return L;var E=De(e);if(E)return{resultType:o("WAWebApi").APICmd.MSG_SEND,data:E};var k=at(e);if(k!=null)return{resultType:o("WAWebApi").APICmd.WEB_REGISTRATION_CAMPAIGN,data:k};var I=e.match(D);if(I){var T=new(r("WAWebPonyfillsUrlSearchParams"))(I[1]),$=T.get("jid");return $!=null&&$!==""?{resultType:o("WAWebApi").APICmd.NEW_CHAT,data:{jid:$}}:{resultType:o("WAWebApi").APICmd.NEW_CHAT}}if(e.match(x))return{resultType:o("WAWebApi").APICmd.NEW_CALL};var P=r("gkx")("26258")?null:it();if(P)return{resultType:o("WAWebApi").APICmd.WORK_CONTACT_SYNC,data:P};var N=lt(e);return N?{resultType:o("WAWebApi").APICmd.SEND_FILE,data:N}:{resultType:o("WAWebApi").APICmd.INVALID}}l.parseConversionData=R,l.parseCTWADeeplinkToken=k,l.matchProductUrl=Ce,l.matchCatalogUrl=Ee,l.isStickerPackURL=Ke,l.parseCallLink=rt,l.isValidCallLink=ot,l.parseAPICmd=st}),98);
__d("WAWebBusinessProfileVersioningBridge",["WAWebBizGatingUtils"],(function(t,n,r,o,a,i,l){var e=3,s=4,u=16,c=32,d=64,m=128,p=256;function _(){return f(o("WAWebBizGatingUtils").webBizProfileOptions())}function f(t){var n=e|s|u|d|m|c;return o("WAWebBizGatingUtils").bizLinkedAccountsEnabled()&&(n|=p),t&n}l.DIRECT_CONNECTION_FLAG=m,l.getBusinessProfileQueryVersion=_,l.getBusinessProfileQueryVersionWithCustomBizProfileOptions=f}),98);
__d("WAWapDeprecatedSmaxID",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({SupportContactForm:3,CtwaGetContext:4,QueryOrder:5,CreateOrder:10,RefreshCart:11,CatalogGetProductList:21,SetCatalogVisibility:23,CommerceSettingsSet:25,CatalogGetSingleCollection:30,CatalogGetCollections:35,CatalogCreateCollection:36,CatalogUpdateCollection:40,CatalogDeleteCollections:43,CatalogAppealCollection:48,BizGetPublicKey:52,MerchantGetComplianceInfo:53,MerchantSetComplianceInfo:54,CatalogVerifyPostcode:70,BtmCustomUrlGet:78,BtmCustomUrlGetUser:79,QuerySubscription:90,UpdateCollectionList:92}),l=e;i.default=l}),66);
__d("WAWebBizGetMerchantComplianceQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25960403573553316"}),null);
__d("WAWebBizGetMerchantComplianceQuery.graphql",["WAWebBizGetMerchantComplianceQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"request"}],t={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"landline_number",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"mobile_number",storageKey:null},a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XFBWhatsAppBizMerchantGetComplianceInfoResponse",kind:"LinkedField",name:"xfb_whatsapp_biz_merchant_compliance_info",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBWhatsAppBizMerchantInfo",kind:"LinkedField",name:"merchant_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"entity_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entity_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entity_type_custom",storageKey:null},{alias:null,args:null,concreteType:"XFBWhatsAppBizMerchantInfoCustomerCareDetails",kind:"LinkedField",name:"customer_care_details",plural:!1,selections:[t,r,o],storageKey:null},{alias:null,args:null,concreteType:"XFBWhatsAppBizMerchantInfoGrievanceOfficerDetails",kind:"LinkedField",name:"grievance_officer_details",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t,r,o],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"WAWebBizGetMerchantComplianceQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"WAWebBizGetMerchantComplianceQuery",selections:a},params:{id:n("WAWebBizGetMerchantComplianceQuery_facebookRelayOperation"),metadata:{},name:"WAWebBizGetMerchantComplianceQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("WAWebBizSetMerchantComplianceMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25188352884120072"}),null);
__d("WAWebBizSetMerchantComplianceMutation.graphql",["WAWebBizSetMerchantComplianceMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"landline_number",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"mobile_number",storageKey:null},a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"input"}],concreteType:"XFBWhatsAppBizMerchantSetComplianceInfoResponse",kind:"LinkedField",name:"xfb_whatsapp_biz_merchant_set_compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XFBWhatsAppBizMerchantInfo",kind:"LinkedField",name:"merchant_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"entity_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entity_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entity_type_custom",storageKey:null},{alias:null,args:null,concreteType:"XFBWhatsAppBizMerchantInfoCustomerCareDetails",kind:"LinkedField",name:"customer_care_details",plural:!1,selections:[t,r,o],storageKey:null},{alias:null,args:null,concreteType:"XFBWhatsAppBizMerchantInfoGrievanceOfficerDetails",kind:"LinkedField",name:"grievance_officer_details",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t,r,o],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"WAWebBizSetMerchantComplianceMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"WAWebBizSetMerchantComplianceMutation",selections:a},params:{id:n("WAWebBizSetMerchantComplianceMutation_facebookRelayOperation"),metadata:{},name:"WAWebBizSetMerchantComplianceMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("WAWebBizSetMerchantCompliance",["Promise","WALogger","WAWebBizGatingUtils","WAWebBizSetMerchantComplianceMutation.graphql","WAWebFetchAdAccountToken","WAWebGraphQLServerError","WAWebNetworkStatus","WAWebRelayClient"],(function(t,n,r,o,a,i,l){var e,s,u,c,d;function m(e){if(e==null)return"Other";switch(e){case"SOLE_PROPRIETORSHIP":return"Sole proprietorship";case"PARTNERSHIP":return"Partnership";case"PRIVATE_COMPANY":return"Private Company";case"PUBLIC_COMPANY":return"Public Company";case"LIMITED_LIABILITY_PARTNERSHIP":return"Limited liability partnership";case"OTHER":return"Other";default:return"Other"}}var p={type:"error"},_=e!==void 0?e:e=n("WAWebBizSetMerchantComplianceMutation.graphql");function f(e){return o("WAWebBizGatingUtils").graphQLForSetComplianceInfo()?g(e).then(function(e){return e.type==="success"?(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["setMerchantComplianceGraphQL: success"]))),e):(e.type,o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose([' setMerchantCompliance: failed as "','"'])),e.type),e)}):(d||(d=n("Promise"))).resolve({type:"not-enabled"})}function g(e){return o("WAWebFetchAdAccountToken").fetchToken().then(function(t){return t.type==="success"?h(t.token,e).then(function(e){return e.type!=="success"&&e.type==="auth-failure"?o("WAWebFetchAdAccountToken").markTokenAsInvalid():e.type,e}):(t.type,t)})}function h(e,t){return r("WAWebNetworkStatus").waitIfOffline().then(function(){return o("WAWebRelayClient").commitMutation(_,{input:t},{environmentType:"facebook",accessToken:e})}).then(function(e){var t,n,r,o,a,i,l,s;if(e==null)return p;var u=(t=e.xfb_whatsapp_biz_merchant_set_compliance_info)==null?void 0:t.merchant_info;if(u==null)return p;var c=[{entity_name:u.entity_name||"",entity_type:m(u.entity_type),is_registered:u.is_registered||!1,entity_type_custom:u.entity_type_custom||"",customer_care_details:{email:((n=u.customer_care_details)==null?void 0:n.email)||"",landline_number:((r=u.customer_care_details)==null?void 0:r.landline_number)||"",mobile_number:((o=u.customer_care_details)==null?void 0:o.mobile_number)||""},grievance_officer_details:{name:((a=u.grievance_officer_details)==null?void 0:a.name)||"",email:((i=u.grievance_officer_details)==null?void 0:i.email)||"",landline_number:((l=u.grievance_officer_details)==null?void 0:l.landline_number)||"",mobile_number:((s=u.grievance_officer_details)==null?void 0:s.mobile_number)||""}}];return{type:"success",merchant_info:c}}).catch(function(e){return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["setMerchantComplianceWithToken: failed with error"]))),o("WAWebFetchAdAccountToken").hasGraphQLAuthError(e)?{type:"auth-failure"}:e instanceof o("WAWebGraphQLServerError").GraphQLServerError?{type:"graphql-error",error:e}:p})}l.mapEntityTypeToBusinessTypeOption=m,l.setMerchantCompliance=f}),98);
__d("WAWebBizGetMerchantCompliance",["Promise","WALogger","WAWebBizGatingUtils","WAWebBizGetMerchantComplianceQuery.graphql","WAWebBizSetMerchantCompliance","WAWebFetchAdAccountToken","WAWebGraphQLServerError","WAWebNetworkStatus","WAWebRelayClient"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m={type:"error"},p=e!==void 0?e:e=n("WAWebBizGetMerchantComplianceQuery.graphql");function _(e){return o("WAWebBizGatingUtils").graphQLForGetComplianceInfo()?f(e).then(function(e){return e.type==="success"?(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getMerchantComplianceImpl: success"]))),e):(e.type,o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(['fetchCatalog: failed as "','"'])),e.type),e)}):(d||(d=n("Promise"))).resolve({type:"not-enabled"})}function f(e){return r("WAWebNetworkStatus").waitIfOffline().then(function(){return o("WAWebRelayClient").fetchQuery(p,{request:e},{environmentType:"whatsapp_catalog"})}).then(function(e){var t,n,r,a,i,l,s,u;if(e==null)return m;var c=(t=e.xfb_whatsapp_biz_merchant_compliance_info)==null?void 0:t.merchant_info;if(c==null)return m;var d=[{entity_name:c.entity_name||"",entity_type:o("WAWebBizSetMerchantCompliance").mapEntityTypeToBusinessTypeOption(c.entity_type),is_registered:c.is_registered||!1,entity_type_custom:c.entity_type_custom||"",customer_care_details:{email:((n=c.customer_care_details)==null?void 0:n.email)||"",landline_number:((r=c.customer_care_details)==null?void 0:r.landline_number)||"",mobile_number:((a=c.customer_care_details)==null?void 0:a.mobile_number)||""},grievance_officer_details:{name:((i=c.grievance_officer_details)==null?void 0:i.name)||"",email:((l=c.grievance_officer_details)==null?void 0:l.email)||"",landline_number:((s=c.grievance_officer_details)==null?void 0:s.landline_number)||"",mobile_number:((u=c.grievance_officer_details)==null?void 0:u.mobile_number)||""}}];return{type:"success",merchant_info:d}}).catch(function(e){return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["getMerchantComplianceImpl: failed with error"]))),o("WAWebFetchAdAccountToken").hasGraphQLAuthError(e)?{type:"auth-failure"}:e instanceof o("WAWebGraphQLServerError").GraphQLServerError?{type:"graphql-error",error:e}:m})}l.getMerchantCompliance=_}),98);
__d("WAWebMaybeThrowCatalogErrors",["errorCode","$InternalEnum","WALogger","WAWebBackendErrors"],(function(t,n,r,o,a,i,l,s){var e,u,c=n("$InternalEnum").Mirrored(["GET_PRODUCT_CATALOG_OWNER_GRAPHQL"]);function d(t,n){var r=t.source.errors||[],a=r[0],i=a==null?void 0:a.code;if(i!=null){if(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["maybeThrowLocalErrorForCatalogQuery: error code ",""])),i),n===c.GET_PRODUCT_CATALOG_OWNER_GRAPHQL&&i===2498052)throw new(o("WAWebBackendErrors")).ServerStatusCodeError(404,t.message);switch(i){case 2498052:case 2498049:case 2498050:case 2498051:case 2498053:case 2498056:throw new(o("WAWebBackendErrors")).ServerStatusCodeError(400,t.message);case 2498048:throw new(o("WAWebBackendErrors")).E451;case 2498054:throw new(o("WAWebBackendErrors")).ServerStatusCodeError(421);case 2498103:case 2498102:throw new(o("WAWebBackendErrors")).CollectionReorderError}o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["maybeThrowLocalErrorForCatalogQuery: unknown error code ",""])),i)}}l.ErrorSourceForCatalogQuery=c,l.maybeThrowLocalErrorForCatalogQuery=d}),98);
__d("WAWebMerchantComplianceJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","WAWebBizGatingUtils","WAWebBizGetMerchantCompliance","WAWebBizSetMerchantCompliance","WAWebCommsWapMd","WAWebMaybeThrowCatalogErrors","WAWebUserPrefsMeUser","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e=function(t){var e,n,r;return{email:(t==null||(e=t.maybeChild("email"))==null?void 0:e.contentString())||"",landline_number:(t==null||(n=t.maybeChild("landline_number"))==null?void 0:n.contentString())||"",mobile_number:(t==null||(r=t.maybeChild("mobile_number"))==null?void 0:r.contentString())||""}},s=new(r("WADeprecatedWapParser"))("merchantComplianceResponse",function(t){t.assertTag("iq"),t.assertFromServer();var n=[];return t.forEachChildWithTag("merchant_info",function(t){var r,o,a,i,l=((r=t.maybeChild("entity_name"))==null?void 0:r.contentString())||"",s=((o=t.maybeChild("entity_type"))==null?void 0:o.contentString())||"",u=(a=t.maybeChild("entity_type_custom"))==null?void 0:a.contentString(),c=t.attrString("is_registered")==="true",d=t.maybeChild("customer_care_details"),m=t.maybeChild("grievance_officer_details"),p=babelHelpers.extends({},e(d)),_=babelHelpers.extends({name:(m==null||(i=m.maybeChild("name"))==null?void 0:i.contentString())||""},e(m));n.push({entity_name:l,entity_type:s,is_registered:c,entity_type_custom:u,customer_care_details:p,grievance_officer_details:_})}),n});function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebBizGatingUtils").graphQLForGetComplianceInfo()?d(e):p(e)}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebBizGetMerchantCompliance").getMerchantCompliance({biz_jid:e[0].wid.toJid()});if(t.type==="success")return t.merchant_info;throw t.type==="graphql-error"?o("WAWebMaybeThrowCatalogErrors").maybeThrowLocalErrorForCatalogQuery(t.error):t.type,r("err")("getMerchantComplianceGraphQL: error handling flow not implemented for "+JSON.stringify(t))}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=(t=o("WAWap")).wap("iq",{to:t.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:t.generateId(),type:"get",smax_id:t.SMAX_ID(r("WAWapDeprecatedSmaxID").MerchantGetComplianceInfo)},e.map(function(e){return o("WAWap").wap("merchant_info",{jid:o("WAWebCommsWapMd").USER_JID(e.wid)})})),a=yield o("WADeprecatedSendIq").deprecatedSendIq(n,s);if(a.success)return a.result;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(a.errorCode)}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e===void 0?{}:e,n=t.customerCareDetails,r=t.entityName,a=t.entityType,i=t.entityTypeCustom,l=t.grievanceOfficerDetails,s=t.isRegistered,u=s===void 0?!1:s;return o("WAWebBizGatingUtils").graphQLForSetComplianceInfo()?C(r,a,u,i,n,l):h({entityName:r,entityType:a,isRegistered:u,entityTypeCustom:i,customerCareDetails:n,grievanceOfficerDetails:l})}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e===void 0?{}:e,n=t.customerCareDetails,a=t.entityName,i=t.entityType,l=t.entityTypeCustom,u=t.grievanceOfficerDetails,c=t.isRegistered,d=c===void 0?!1:c,m=o("WAWap").wap("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:o("WAWap").generateId(),type:"set",smax_id:o("WAWap").SMAX_ID(r("WAWapDeprecatedSmaxID").MerchantSetComplianceInfo)},o("WAWap").wap("merchant_info",{is_registered:d?"true":"false"},a!==void 0?o("WAWap").wap("entity_name",null,a):null,i!==void 0?o("WAWap").wap("entity_type",null,i):null,l!==void 0?o("WAWap").wap("entity_type_custom",null,l):null,n?o("WAWap").wap("customer_care_details",null,n.email!==void 0?o("WAWap").wap("email",null,n.email):null,n.landlineNumber!==void 0?o("WAWap").wap("landline_number",null,n.landlineNumber):null,n.mobileNumber!==void 0?o("WAWap").wap("mobile_number",null,n.mobileNumber):null):null,u?o("WAWap").wap("grievance_officer_details",null,u.name!==void 0?o("WAWap").wap("name",null,u.name):null,u.email!==void 0?o("WAWap").wap("email",null,u.email):null,u.landlineNumber!==void 0?o("WAWap").wap("landline_number",null,u.landlineNumber):null,u.mobileNumber!==void 0?o("WAWap").wap("mobile_number",null,u.mobileNumber):null):null)),p=yield o("WADeprecatedSendIq").deprecatedSendIq(m,s);if(p.success)return p.result;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(p.errorCode)}),y.apply(this,arguments)}function C(e,t,n,r,o,a){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i,l){n===void 0&&(n=!1);var s=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),u={};if(u.is_registered=n,e!==void 0&&(u.entity_name=e),u.entity_type=v(t),a!==void 0&&(u.entity_type_custom=a),i){var c={};i.email!==void 0&&(c.email=i.email),i.landlineNumber!==void 0&&(c.landline_number=i.landlineNumber),i.mobileNumber!==void 0&&(c.mobile_number=i.mobileNumber),u.customer_care_details=c}if(l){var d={};l.name!==void 0&&(d.name=l.name),l.email!==void 0&&(d.email=l.email),l.landlineNumber!==void 0&&(d.landline_number=l.landlineNumber),l.mobileNumber!==void 0&&(d.mobile_number=l.mobileNumber),u.grievance_officer_details=d}var m=yield o("WAWebBizSetMerchantCompliance").setMerchantCompliance({biz_jid:s.toJid(),merchant_info:u});if(m.type==="success")return m.merchant_info;throw m.type==="graphql-error"?o("WAWebMaybeThrowCatalogErrors").maybeThrowLocalErrorForCatalogQuery(m.error):m.type,r("err")("setMerchantComplianceGraphQL: error handling flow not implemented for "+JSON.stringify(m))}),b.apply(this,arguments)}function v(e){return e==null?"OTHER":e==="Limited liability partnership"?"LIMITED_LIABILITY_PARTNERSHIP":e==="Sole proprietorship"?"SOLE_PROPRIETORSHIP":e==="Partnership"?"PARTNERSHIP":e==="Public Company"?"PUBLIC_COMPANY":e==="Private Company"?"PRIVATE_COMPANY":e==="Other"?"OTHER":(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}l.getMerchantCompliance=u,l.setMerchantCompliance=f}),98);
__d("WAWebCommonParsersParseBusinessProfile",["WAWebBizGatingUtils","WAWebBotTypes","WAWebBusinessProfileTypes","cr:5664","gkx"],(function(t,n,r,o,a,i,l){function e(e){var t,a,i,l=e.maybeChild("address"),c=l?l.contentString():void 0,d,m=e.maybeChild("description");m&&(d=m.contentString());var p=e.maybeChild("email"),_=p?p.contentString():void 0,f=e.maybeChild("latitude"),g=f?parseFloat(f.contentString()):void 0,h=e.maybeChild("longitude"),y=h?parseFloat(h.contentString()):void 0,C=[];e.forEachChildWithTag("website",function(e){C.push({url:e.contentString()})});var b;if(o("WAWebBizGatingUtils").getFmxAgmEnabled()){var v=e.maybeChild("member_since_text");v&&(b=v.contentString())}var S=[],R=e.maybeChild("categories");R&&R.forEachChildWithTag("category",function(e){var t=e.attrString("id");S.push({id:t,localized_display_name:e.contentString()})});var L,E=e.maybeChild("business_hours");if(E){var k=E.maybeAttrString("timezone"),I=[];E.forEachChildWithTag("business_hours_config",function(e){I.push({day_of_week:e.attrString("day_of_week"),mode:e.attrString("mode"),open_time:e.hasAttr("open_time")?parseInt(e.attrString("open_time"),10):0,close_time:e.hasAttr("close_time")?parseInt(e.attrString("close_time"),10):0})}),L={config:I},k!=null&&(L.timezone=k)}var T,D=e.maybeChild("profile_options");if(D){T={};var x=D.maybeChild("commerce_experience");if(x){var $;T.commerce_experience=($=o("WAWebBusinessProfileTypes").CommerceExperienceTypes.cast(x.contentString()))!=null?$:o("WAWebBusinessProfileTypes").CommerceExperienceTypes.NONE}var P=D.maybeChild("cart_enabled");P&&(T.cart_enabled=P.contentString()==="true");var N=D.maybeChild("shop_url");N&&(T.shop_url=N.contentString());var M=D.maybeChild("commerce_manager_url");M&&(T.commerce_manager_url=M.contentString());var w=D.maybeChild("is_banned");w&&(T.is_banned=w.contentString()==="true");var A=D.maybeChild("direct_connection");A&&(T.direct_connection=A.contentString()==="true");var F=D.maybeChild("is_profile_edit_disabled");F&&(T.is_profile_edit_disabled=F.contentString()==="true")}var O=e.maybeChild("direct_connection"),B;if(O){var W=O.maybeChild("default_postcode");B={enabled:O.maybeAttrString("enabled")==="true",defaultPostcode:W?{code:W.attrString("code"),locationName:W.attrString("location_name")}:void 0}}var q=[];e.forEachChildWithTag("service_area",function(e){var t=e.maybeChild("radius"),n=e.maybeChild("latitude"),r=e.maybeChild("longitude"),o=e.maybeChild("area_description");if(t&&n&&r){var a;q.push({radius:parseFloat(t.contentString()),latitude:parseFloat(n.contentString()),longitude:parseFloat(r.contentString()),areaDescription:(a=o==null?void 0:o.contentString())!=null?a:""})}});var U=e.maybeChild("catalog_status"),V=U?U.attrString("status"):void 0,H={},G={},z=!1,j,K=e.maybeChild("linked_accounts");if(K){z=!0;var Q=K.maybeChild("fb_page");if(Q){var X=Q.maybeChild("display_name"),Y=Q.maybeChild("likes");H.display_name=X==null?void 0:X.contentString(),H.likes=Y==null?void 0:Y.contentInt();var J=Q.maybeAttrString("id");J!=null&&(H.id=J)}var Z=K.maybeChild("ig_professional");if(Z){var ee=Z.maybeChild("ig_handle"),te=Z.maybeChild("followers");G={ig_handle:ee==null?void 0:ee.contentString(),followers:te==null?void 0:te.contentInt()}}}var ne=e.maybeChild("cover_photo"),re=ne?{id:ne.attrString("id"),url:new URL(ne.contentString())}:void 0;if(o("WAWebBizGatingUtils").isCustomURLViaBizProfileEnabled()){var oe=e.maybeChild("custom_url");oe&&(j=oe==null?void 0:oe.contentString())}var ae=o("WAWebBotTypes").BizBotAutomatedType.cast((t=e.maybeChild("automated_type"))==null?void 0:t.contentString()),ie=o("WAWebBotTypes").BotWelcomeMsgProtocolModeType.cast((a=e.maybeChild("welcome_message_protocol_mode"))==null?void 0:a.contentString()),le,se=e.maybeChild("prompts");se&&(le=s(se));var ue=(i=e.maybeChild("commands"))==null||(i=i.maybeChild("description"))==null?void 0:i.contentString(),ce,de=e.maybeChild("commands");de&&(ce=u(de)),!r("gkx")("26258")&&n("cr:5664")&&n("cr:5664").debugBotConfigs.injectBizBotFields===!0&&(ie=o("WAWebBotTypes").BotWelcomeMsgProtocolModeType.BASIC,d="Hello! I'm Midjourney, your personal assistant. I'm here to assist you with anything you might need, from travel information to workout plans, and even caring for your plants. I can even sketch your imagination!",le=[{emoji:"\u2728",text:"Create an alien world!"},{emoji:"\uD83D\uDD25",text:"Show a future city!"},{emoji:"\u2728",text:"Fantasy landscape? Generate now!"},{emoji:"\uD83D\uDD25",text:"Describe a mythical world filled with magical creatures and let the bot generate an image that brings it to life!"},{emoji:"\u2728",text:"Picture an enchanted forest with towering trees, sparkling fairies, and vibrant flora, and let the bot create an image that captures its magic!"},{emoji:"\uD83D\uDD25",text:"Imagine yourself as a time traveler who has just stepped into an ancient civilization. You find yourself surrounded by towering structures and exotic landscapes that are unfamiliar to you. Take a moment to observe the surroundings, notice the intricate details on the buildings and the unique attire worn by the people. Now, let the bot generate an image that captures the essence of this unexplored world, bringing forth a visual representation that transcends time and space!"}],ue="Try these commands to get started",ce=[{description:"Create images with Midjourney",name:"imagine"},{description:"View and adjust your personal settings",name:"settings"},{description:"Blend images together seamlessly",name:"blend"},{description:"View information about your profile",name:"info"},{description:"Subscribe to the profile for updates",name:"subscribe"}],C.length===0&&(C=[{url:"https://meta.com"}]));var me={address:c,description:d,email:_,latitude:g,longitude:y,website:C,categories:S,business_hours:L,catalog_status:V,profile_options:T,fb_page:H,ig_professional:G,profile_is_linked:z,directConnection:B,service_areas:q.length>0?q:void 0,cover_photo:re,custom_url:j,prompts:le,commands:ce,commands_description:ue,automated_type:ae,welcome_message_protocol_mode:ie,member_since_text:b};return Object.keys(me).forEach(function(e){me[e]==null&&delete me[e]}),me}function s(e){var t=[];return e.forEachChildWithTag("prompt",function(e){var n,r,o=e.maybeChild("emoji"),a=(n=o==null?void 0:o.contentString())!=null?n:"",i=e.maybeChild("text"),l=(r=i==null?void 0:i.contentString())!=null?r:"";t.push({emoji:a,text:l})}),t}function u(e){var t=[];return e.forEachChildWithTag("command",function(e){var n,r,o=e.maybeChild("name"),a=(n=o==null?void 0:o.contentString())!=null?n:"",i=e.maybeChild("description"),l=(r=i==null?void 0:i.contentString())!=null?r:"";t.push({name:a,description:l})}),t}l.default=e}),98);
__d("WAWebQueryBusinessProfileJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebBackendErrors","WAWebCommonParsersParseBusinessProfile","WAWebCommsWapMd","WAWebJidToWid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=new(r("WADeprecatedWapParser"))("businessProfileResponse",function(e){e.assertTag("iq"),e.assertFromServer();var t=e.child("business_profile"),n=[];return t.forEachChildWithTag("profile",function(e){var t=o("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("jid")),a=e.attrString("tag"),i=r("WAWebCommonParsersParseBusinessProfile")(e);Object.keys(i).length?n.push({wid:t,tag:a,profile:i}):n.push({wid:t,tag:a})}),n});function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r,a=(r=o("WAWap")).wap("iq",{to:r.S_WHATSAPP_NET,xmlns:"w:biz",id:r.generateId(),type:"get"},r.wap("business_profile",{v:r.INT(n)},t.map(function(e){return o("WAWap").wap("profile",{jid:o("WAWebCommsWapMd").USER_JID(e.wid),tag:e.tag!=null?o("WAWap").INT(e.tag):o("WAWap").DROP_ATTR})}))),i=yield o("WADeprecatedSendIq").deprecatedSendIq(a,e);if(i.success)return i.result;throw new(o("WAWebBackendErrors")).ServerStatusCodeError(i.errorCode)}),u.apply(this,arguments)}l.default=s}),98);
__d("WAWebQueryBusinessProfile",["Promise","WAWebBackendErrors","WAWebBusinessProfileVersioningBridge","WAWebMerchantComplianceJob","WAWebQueryBusinessProfileJob"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=o("WAWebBusinessProfileVersioningBridge").getBusinessProfileQueryVersion(),l;return a?l=(e||(e=n("Promise"))).all([r("WAWebQueryBusinessProfileJob")(t,i),o("WAWebMerchantComplianceJob").getMerchantCompliance(t)]).then(u):l=r("WAWebQueryBusinessProfileJob")(t,i),o("WAWebBackendErrors").attachErrorLogger(l,"Query business profile failed")}function u(e){var t=e[0],n=e[1];return t.map(function(e,t){return babelHelpers.extends({},e,{profile:babelHelpers.extends({},e.profile,{legal_entity_details:n[t]})})})}l.queryBusinessProfile=s}),98);
__d("WAWebChatThreadLoggingUtils",["WABase64","WACryptoHmac","WAJids","WALogger","WATimeUtils","WAWebApiContact","WAWebApiParse","WAWebBusinessProfileTypes","WAWebEphemeralityTypes","WAWebInteractiveMessagesNativeFlowName","WAWebLidAwareContactsDB","WAWebModelStorageUtils","WAWebMsgType","WAWebQueryBusinessProfile","WAWebUserPrefsMeUser","WAWebWamEnumChatOriginsType","WAWebWamEnumEphemeralityInitiatorType","WAWebWamEnumEphemeralityTriggerActionType","WAWebWamEnumOppositeVisibleIdentificationType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c=new TextEncoder,d=function(t){return c.encode(t).buffer};function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WACryptoHmac").hmacSha256(e,t);return o("WABase64").encodeB64(n)}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=d(t+n);return m(e,r)}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=d(t);return m(e,n)}),h.apply(this,arguments)}function y(e,t){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=d(t);return m(e,n)}),C.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield S(e),r=d(t);return m(n,r)}),v.apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=d(e);return self.crypto.subtle.digest("SHA-256",t)}),R.apply(this,arguments)}function L(e){return o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(e-8*o("WATimeUtils").HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")}function E(e,t){var n=t%o("WATimeUtils").DAY_SECONDS,r=t-n;return n>=e?r+e:r-o("WATimeUtils").DAY_SECONDS+e}function k(e,t,n){return E(e,t)>n}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,r;try{r=yield o("WAWebQueryBusinessProfile").queryBusinessProfile([{wid:t}])}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(['Thread Logging: Failed to query business profile to set "biz_catalog_type"']))).verbose().sendLogs("query-business-profile-fail"),null}var a=r[0];if(!a)return null;var i=(n=a.profile)==null||(n=n.profile_options)==null?void 0:n.commerce_experience;return i===o("WAWebBusinessProfileTypes").CommerceExperienceTypes.CATALOG?"native":i===o("WAWebBusinessProfileTypes").CommerceExperienceTypes.SHOP?"shop":null}),T.apply(this,arguments)}function D(e){return e.type!==o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT}function x(e){var t,n=new Set([o("WAWebMsgType").MSG_TYPE.PRODUCT,o("WAWebMsgType").MSG_TYPE.ORDER,o("WAWebMsgType").MSG_TYPE.LIST]);return n.has(e.type)||n.has((t=e.quotedMsg)==null?void 0:t.type)||!!(e.matchedText!=null&&e.matchedText!==""&&$(e.matchedText))||e.type===o("WAWebMsgType").MSG_TYPE.NATIVE_FLOW&&(e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS||e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS)}function $(e){return o("WAWebApiParse").matchCatalogUrl(e)||o("WAWebApiParse").matchProductUrl(e)}function P(e){if(e==null)return null;switch(e){case o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings:return o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.ACCOUNT_SETTINGS;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings:return o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.CHAT_SETTINGS;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange:return o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.BULK_CHANGE;default:return null}}function N(e){if(e==null)return null;switch(e){case o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings:return o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.ACCOUNT_SETTINGS;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings:return o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.CHAT_SETTINGS;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange:return o("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.BULK_CHANGE;default:return null}}function M(e){return e==null?null:e?o("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE.INITIATED_BY_ME:o("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE.INITIATED_BY_OTHER}function w(){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),t=yield r("WAWebLidAwareContactsDB").get(e.toJid());return(t==null?void 0:t.username)!=null&&t.username!==""}),A.apply(this,arguments)}function F(){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),t=yield r("WAWebLidAwareContactsDB").get(e.toJid());return(t==null?void 0:t.usernameKey)!=null}),O.apply(this,arguments)}function B(e){return W.apply(this,arguments)}function W(){return W=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return H(e)?null:o("WAWebModelStorageUtils").getStorage().lock(["contact"],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t,n;if(e.isLid()){var a=o("WAWebApiContact").getPhoneNumber(e);a==null?(t=e.toString(),n="lid"):(t=o("WAJids").toPhoneUserJid(a.user),n="pn")}else t=o("WAJids").toPhoneUserJid(e.user),n="pn";var i=yield r("WAWebLidAwareContactsDB").get(t);return i==null?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getOppositeVisibleIdentificationType: could not find contact with id ",""])),e),null):q(i,n)}))}),W.apply(this,arguments)}function q(e,t){if(e==null)return o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.PLACEHOLDER;var n=o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.MASKED_PHONE_NUMBER;return e==null?n=o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.PLACEHOLDER:e.isAddressBookContact?n=o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.SAVED_CONTACT_NAME:e.verifiedName?n=o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.VERIFIED_BUSINESS_NAME:t==="pn"?n=o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.PHONE_NUMBER:e.username!=null&&e.username!==""&&(n=o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE.USERNAME),n}function U(e){return V.apply(this,arguments)}function V(){return V=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return H(e)?null:o("WAWebModelStorageUtils").getStorage().lock(["chat"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],r=e.toString(),a=yield n.get(r);if(a==null){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["getChatOriginType: could not find chat with id ",""])),r);return}switch(a.lidOriginType){case"ctwa":return o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE.LID_CTWA;default:return o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE.OTHERS}});return function(e){return t.apply(this,arguments)}})())}),V.apply(this,arguments)}function H(e){return!e.isUser()||e.isPSA()||e.isBot()}l.generateThreadID=_,l.generateThreadIDHMAC=g,l.generateMessageIDHMAC=y,l.generateUserThreadIDHMAC=b,l.getThreadDs=L,l.computeStartTs=E,l.shouldUpdateChatEvent=k,l.getBizCatalogType=I,l.shouldIncrementMsgSendAndReceive=D,l.isCommerceMessage=x,l.getWamDisappearingModeTrigger=P,l.getWamDisappearingModeTriggerGroups=N,l.getWamDisappearingModeInitiatedByMe=M,l.getMeHasUsername=w,l.getMeHasUsernamePin=F,l.getOppositeVisibleIdentification=B,l.getOppositeVisibleIdentificationType=q,l.getChatOriginType=U}),98);
__d("WAWebThreadInteractionDataAiWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAiChatOriginsType"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ThreadInteractionDataAi:[6410,{aiChatOrigins:[1,o("WAWebWamEnumAiChatOriginsType").AI_CHAT_ORIGINS_TYPE],bottomSheetAnimatedSent:[2,e.TYPES.INTEGER],bottomSheetEditedAnimatedSent:[3,e.TYPES.INTEGER],bottomSheetEditedSent:[4,e.TYPES.INTEGER],bottomSheetImagesGenerated:[5,e.TYPES.INTEGER],bottomSheetMemuInitiated:[6,e.TYPES.INTEGER],bottomSheetMemuMessagesSent:[7,e.TYPES.INTEGER],bottomSheetMessagesSent:[8,e.TYPES.INTEGER],bottomSheetPromptsInitiated:[9,e.TYPES.INTEGER],bottomSheetRegeneratedSent:[10,e.TYPES.INTEGER],commandSheetShow:[11,e.TYPES.INTEGER],imagineCommandClick:[14,e.TYPES.INTEGER],imagineMeMessagesSent:[15,e.TYPES.INTEGER],imagineMePromptsInitiatedCount:[16,e.TYPES.INTEGER],metaAiMentionClick:[19,e.TYPES.INTEGER],metaAiMentionShow:[20,e.TYPES.INTEGER],suggestionPromptsClick:[21,e.TYPES.INTEGER],suggestionPromptsShow:[22,e.TYPES.INTEGER],threadCreationDate:[28,e.TYPES.STRING],threadDs:[17,e.TYPES.STRING],threadId:[26,e.TYPES.STRING],threadIdByLid:[27,e.TYPES.STRING],totalMessageFromAgentCnt:[24,e.TYPES.INTEGER],totalMessageToAgentCnt:[25,e.TYPES.INTEGER]},[1,1,1],"regular"]},{ThreadInteractionDataAi:[]});l.ThreadInteractionDataAiWamEvent=s}),98);
__d("WAWebThreadLoggingAi",["WALogger","WAWebThreadInteractionDataAiWamEvent"],(function(t,n,r,o,a,i,l){var e;function s(t){try{t.forEach(function(e){var t=e.event,n=e.threadDs,r=e.threadId,a={threadDs:n,threadId:r,totalMessageFromAgentCnt:t.botMessagesReceived,totalMessageToAgentCnt:t.botMessagesSent},i=new(o("WAWebThreadInteractionDataAiWamEvent")).ThreadInteractionDataAiWamEvent(a);i.commit()})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ctlv2: error uploading Ai WAM event: ",""])),String(t)).sendLogs("thread-logging-ai-upload-failure")}}l.ThreadInteractionAiWamTrigger=s}),98);
__d("WAWebThreadInteractionDataBizWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBizCatalogType","WAWebWamEnumChatOriginsType"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ThreadInteractionDataBiz:[6464,{awayMsgsSent:[1,e.TYPES.INTEGER],bizCatalogType:[2,o("WAWebWamEnumBizCatalogType").BIZ_CATALOG_TYPE],bizConversationDepth:[3,e.TYPES.INTEGER],cartViews:[4,e.TYPES.INTEGER],chatOrigins:[5,o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE],collectionInquiriesSent:[6,e.TYPES.INTEGER],commerceMsgsReceived:[7,e.TYPES.INTEGER],commerceMsgsSent:[8,e.TYPES.INTEGER],entryPointConversionApp:[9,e.TYPES.STRING],entryPointConversionSource:[10,e.TYPES.STRING],firstResponseTime:[11,e.TYPES.INTEGER],fmxNotMvBottomSheetDismissedCount:[41,e.TYPES.INTEGER],fmxNotMvBottomSheetGetMvButtonClicks:[42,e.TYPES.INTEGER],fmxNotMvBottomSheetGetMvButtonImpressions:[43,e.TYPES.INTEGER],fmxNotMvBottomSheetImpressions:[44,e.TYPES.INTEGER],fmxNotMvBottomSheetLearnMoreButtonClicks:[45,e.TYPES.INTEGER],fmxNotMvClicks:[46,e.TYPES.INTEGER],groupContainsBiz:[13,e.TYPES.BOOLEAN],isBizMvFrictionEligible:[47,e.TYPES.BOOLEAN],isCommerceViewed:[14,e.TYPES.BOOLEAN],isCtaOnPdpClicked:[15,e.TYPES.BOOLEAN],isLabelled:[16,e.TYPES.BOOLEAN],isOppositePartyInitiated:[36,e.TYPES.BOOLEAN],isUser1pBizBotChat:[17,e.TYPES.BOOLEAN],isUser3pBotChat:[18,e.TYPES.BOOLEAN],isUserAgent:[19,e.TYPES.BOOLEAN],isUserCreatedAgent:[20,e.TYPES.BOOLEAN],labelledMsgs:[21,e.TYPES.INTEGER],locationsSent:[37,e.TYPES.INTEGER],notMvImpressions:[48,e.TYPES.INTEGER],oppositePartyHasBadge:[40,e.TYPES.BOOLEAN],oppositePartyHasBusinessIntent:[22,e.TYPES.BOOLEAN],ordersSent:[23,e.TYPES.INTEGER],pdpInquiriesSent:[24,e.TYPES.INTEGER],pdpViews:[25,e.TYPES.INTEGER],quickRepliesSent:[26,e.TYPES.INTEGER],smbMarketingMessagesReactionsSent:[27,e.TYPES.INTEGER],smbMarketingMessagesRepliesSent:[28,e.TYPES.INTEGER],smbMarketingMessagesSpamReports:[29,e.TYPES.INTEGER],smbMarketingMsgsReceived:[30,e.TYPES.INTEGER],smbMarketingMsgsSent:[31,e.TYPES.INTEGER],threadCreationDate:[39,e.TYPES.STRING],threadDs:[32,e.TYPES.STRING],threadId:[33,e.TYPES.STRING],threadIdByLid:[38,e.TYPES.STRING],userHasBusinessIntent:[35,e.TYPES.BOOLEAN]},[1,1,1],"regular"]},{ThreadInteractionDataBiz:[]});l.ThreadInteractionDataBizWamEvent=s}),98);
__d("WAWebThreadLoggingBiz",["WALogger","WAWebThreadInteractionDataBizWamEvent","WAWebWamEnumBizCatalogType"],(function(t,n,r,o,a,i,l){var e;function s(e){if(e==="shop")return o("WAWebWamEnumBizCatalogType").BIZ_CATALOG_TYPE.SHOPS;if(e==="native")return o("WAWebWamEnumBizCatalogType").BIZ_CATALOG_TYPE.NATIVE}function u(t){try{t.forEach(function(e){var t=e.event,n=e.threadDs,r=e.threadId,a={threadDs:n,threadId:r,bizCatalogType:s(t.bizCatalogType),chatOrigins:t.chatOrigins,commerceMsgsReceived:t.commerceMsgsReceived,commerceMsgsSent:t.commerceMsgsSent,isCommerceViewed:t.isCommerceViewed,isCtaOnPdpClicked:t.isCtaOnPdpClicked,isUserAgent:t.isUserAgent,ordersSent:t.ordersSent,pdpInquiriesSent:t.pdpInquiriesSent,pdpViews:t.pdpViews},i=new(o("WAWebThreadInteractionDataBizWamEvent")).ThreadInteractionDataBizWamEvent(a);i.commit()})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ctlv2: error uploading Biz WAM event: ",""])),String(t)).sendLogs("thread-logging-biz-upload-failure")}}l.ThreadInteractionBizWamTrigger=u}),98);
__d("WAWebThreadInteractionDataCoreConsumerWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumChatMutedType","WAWebWamEnumChatType","WAWebWamEnumGaStatus","WAWebWamEnumOppositeVisibleIdentificationType","WAWebWamEnumTypeOfGroupEnum"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ThreadInteractionDataCoreConsumer:[6466,{audioMessagesReceived:[1,e.TYPES.INTEGER],audioMessagesSent:[2,e.TYPES.INTEGER],broadcastMsgsReceived:[3,e.TYPES.INTEGER],broadcastMsgsSent:[4,e.TYPES.INTEGER],chatEphemeralityDuration:[6,e.TYPES.INTEGER],chatMuted:[7,o("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE],chatOverflowClicks:[8,e.TYPES.INTEGER],chatTypeInd:[9,o("WAWebWamEnumChatType").CHAT_TYPE],commentsReceived:[10,e.TYPES.INTEGER],documentMessagesReceived:[13,e.TYPES.INTEGER],documentMessagesSent:[14,e.TYPES.INTEGER],editedMsgsSent:[15,e.TYPES.INTEGER],ephemeralMessagesExpired:[110,e.TYPES.INTEGER],ephemeralMessagesReceived:[16,e.TYPES.INTEGER],ephemeralMessagesSent:[17,e.TYPES.INTEGER],ephemeralMessagesUnreadExpired:[18,e.TYPES.INTEGER],eventCreationMessagesReceived:[21,e.TYPES.INTEGER],eventCreationMessagesSent:[22,e.TYPES.INTEGER],eventResponseMessagesReceived:[23,e.TYPES.INTEGER],eventResponseMessagesSent:[24,e.TYPES.INTEGER],forwardAudioMessagesReceived:[25,e.TYPES.INTEGER],forwardAudioMessagesSent:[26,e.TYPES.INTEGER],forwardDocumentMessagesReceived:[27,e.TYPES.INTEGER],forwardDocumentMessagesSent:[28,e.TYPES.INTEGER],forwardGifMessagesReceived:[29,e.TYPES.INTEGER],forwardGifMessagesSent:[30,e.TYPES.INTEGER],forwardMessagesReceived:[31,e.TYPES.INTEGER],forwardMessagesSent:[32,e.TYPES.INTEGER],forwardPhotoMessagesReceived:[33,e.TYPES.INTEGER],forwardPhotoMessagesSent:[34,e.TYPES.INTEGER],forwardStickerMessagesReceived:[35,e.TYPES.INTEGER],forwardStickerMessagesSent:[36,e.TYPES.INTEGER],forwardTextMessagesReceived:[37,e.TYPES.INTEGER],forwardTextMessagesSent:[38,e.TYPES.INTEGER],forwardUrlMessagesReceived:[39,e.TYPES.INTEGER],forwardUrlMessagesSent:[40,e.TYPES.INTEGER],forwardVideoMessagesReceived:[41,e.TYPES.INTEGER],forwardVideoMessagesSent:[42,e.TYPES.INTEGER],gaStatus:[43,o("WAWebWamEnumGaStatus").GA_STATUS],gifMessagesReceived:[44,e.TYPES.INTEGER],gifMessagesSent:[45,e.TYPES.INTEGER],groupMembershipReplies:[47,e.TYPES.INTEGER],groupPrivateReplies:[48,e.TYPES.INTEGER],groupSize:[49,e.TYPES.INTEGER],groupStatusLikesOthersToOthers:[113,e.TYPES.INTEGER],groupStatusLikesOthersToOwn:[114,e.TYPES.INTEGER],groupStatusLikesOwnToOthers:[115,e.TYPES.INTEGER],groupStatusLikesOwnToOwn:[116,e.TYPES.INTEGER],groupStatusRepliesOthersToOthers:[117,e.TYPES.INTEGER],groupStatusRepliesOthersToOwn:[118,e.TYPES.INTEGER],groupStatusRepliesOwnToOthers:[119,e.TYPES.INTEGER],groupStatusRepliesOwnToOwn:[120,e.TYPES.INTEGER],hasUsername:[50,e.TYPES.BOOLEAN],hasUsernamePin:[51,e.TYPES.BOOLEAN],isAContact:[52,e.TYPES.BOOLEAN],isAContactAtThreadCreation:[53,e.TYPES.BOOLEAN],isAGroup:[54,e.TYPES.BOOLEAN],isArchived:[55,e.TYPES.BOOLEAN],isDeleted:[57,e.TYPES.BOOLEAN],isGuestThread:[112,e.TYPES.BOOLEAN],isInviteCreatedThread:[58,e.TYPES.BOOLEAN],isManagedAccount:[121,e.TYPES.BOOLEAN],isMetaAiAssistant:[59,e.TYPES.BOOLEAN],isNewManagedAccountEmIgnored:[122,e.TYPES.BOOLEAN],isPinned:[60,e.TYPES.BOOLEAN],isPnhEnabledChat:[61,e.TYPES.BOOLEAN],isUsernameThread:[123,e.TYPES.BOOLEAN],limitSharingOption:[124,e.TYPES.BOOLEAN],markedReadCnt:[62,e.TYPES.INTEGER],markedReadMessageCnt:[63,e.TYPES.INTEGER],messagesRead:[64,e.TYPES.INTEGER],messagesReceived:[65,e.TYPES.INTEGER],messagesSent:[66,e.TYPES.INTEGER],messagesUnread:[68,e.TYPES.INTEGER],oppositePartyLimitSharingOption:[125,e.TYPES.BOOLEAN],oppositeVisibleIdentification:[69,o("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE],photoMessagesReceived:[70,e.TYPES.INTEGER],photoMessagesSent:[71,e.TYPES.INTEGER],pollCreationMessagesReceived:[72,e.TYPES.INTEGER],pollCreationMessagesSent:[73,e.TYPES.INTEGER],pollUpdateMessagesReceived:[74,e.TYPES.INTEGER],pollUpdateMessagesSent:[75,e.TYPES.INTEGER],profileReplies:[76,e.TYPES.INTEGER],profileViews:[77,e.TYPES.INTEGER],pttMessagesReceived:[78,e.TYPES.INTEGER],pttMessagesSent:[79,e.TYPES.INTEGER],ptvMessagesReceived:[80,e.TYPES.INTEGER],ptvMessagesSent:[81,e.TYPES.INTEGER],reactionsReceived:[82,e.TYPES.INTEGER],reactionsSent:[83,e.TYPES.INTEGER],repliesSent:[85,e.TYPES.INTEGER],requestedPhoneNumber:[86,e.TYPES.BOOLEAN],seenMaskedPhoneNumber:[87,e.TYPES.BOOLEAN],sharedPhoneNumber:[89,e.TYPES.BOOLEAN],sharesCommonGroup:[107,e.TYPES.BOOLEAN],statusReactionsReceived:[90,e.TYPES.INTEGER],statusReactionsSent:[126,e.TYPES.INTEGER],statusReplies:[91,e.TYPES.INTEGER],statusReplyMessagesReceived:[127,e.TYPES.INTEGER],statusViews:[92,e.TYPES.INTEGER],stickerMessagesReceived:[93,e.TYPES.INTEGER],stickerMessagesSent:[94,e.TYPES.INTEGER],textMessagesReceived:[95,e.TYPES.INTEGER],textMessagesSent:[96,e.TYPES.INTEGER],threadCreationDate:[111,e.TYPES.STRING],threadDs:[97,e.TYPES.STRING],threadId:[98,e.TYPES.STRING],threadIdByLid:[109,e.TYPES.STRING],tombstoneEphemeralMessagesReceived:[128,e.TYPES.INTEGER],tombstoneViewOnceMessagesReceived:[129,e.TYPES.INTEGER],typeOfGroup:[108,o("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM],urlMessagesReceived:[99,e.TYPES.INTEGER],urlMessagesSent:[100,e.TYPES.INTEGER],videoMessagesReceived:[102,e.TYPES.INTEGER],videoMessagesSent:[103,e.TYPES.INTEGER],viewOnceMessagesOpened:[104,e.TYPES.INTEGER],viewOnceMessagesReceived:[105,e.TYPES.INTEGER],viewOnceMessagesSent:[106,e.TYPES.INTEGER]},[1,1,1],"regular"]},{ThreadInteractionDataCoreConsumer:[]});l.ThreadInteractionDataCoreConsumerWamEvent=s}),98);
__d("WAWebThreadLoggingCoreConsumer",["WALogger","WAWebGroupType","WAWebThreadInteractionDataCoreConsumerWamEvent","WAWebWamEnumChatMutedType"],(function(t,n,r,o,a,i,l){var e;function s(t){try{t.forEach(function(e){var t=e.event,n=e.threadDs,r=e.threadId,a=t.contactInfo,i={threadDs:n,threadId:r,messagesSent:t.msgsSent,messagesReceived:t.msgsReceived,messagesRead:t.msgsRead,messagesUnread:t.messagesUnread,isAGroup:a.isAGroup,isAContact:a.isAGroup?void 0:a.isAContact,groupSize:a.isAGroup?a.groupSize:void 0,typeOfGroup:a.groupType!=null?o("WAWebGroupType").groupTypeToWamEnum(a.groupType):void 0,isArchived:t.isArchived,isPinned:t.isPinned,chatMuted:t.isMuted?o("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:o("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE.NOT_MUTED,isPnhEnabledChat:t.isPnhEnabledChat,hasUsername:t.hasUsername,hasUsernamePin:t.hasUsernamePin,oppositeVisibleIdentification:t.oppositeVisibleIdentification!=null?t.oppositeVisibleIdentification:void 0,reactionsSent:t.reactionsSent,reactionsReceived:t.reactionsReceived,forwardMessagesSent:t.forwardMessagesSent,forwardMessagesReceived:t.forwardMessagesReceived,editedMsgsSent:t.editedMsgsSent,viewOnceMessagesSent:t.viewOnceMsgsSent,viewOnceMessagesReceived:t.viewOnceMsgsReceived,viewOnceMessagesOpened:t.viewOnceMessagesOpened,commentsReceived:t.commentsReceived,eventCreationMessagesSent:t.eventCreationMessagesSent,eventCreationMessagesReceived:t.eventCreationMessagesReceived,eventResponseMessagesSent:t.eventResponseMessagesSent,eventResponseMessagesReceived:t.eventResponseMessagesReceived,profileViews:t.profileViews,profileReplies:t.profileReplies,statusViews:t.statusViews,statusReplies:t.statusReplies,groupMembershipReplies:t.groupMembershipReplies,groupPrivateReplies:t.groupPrivateReplies,chatOverflowClicks:t.chatOverflowClicks,repliesSent:t.repliesSent},l=new(o("WAWebThreadInteractionDataCoreConsumerWamEvent")).ThreadInteractionDataCoreConsumerWamEvent(i);l.commit()})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ctlv2: error uploading Core Consumer WAM event: ",""])),String(t)).sendLogs("thread-logging-core-consumer-upload-failure")}}l.ThreadInteractionCoreConsumerWamTrigger=s}),98);
__d("WAWebThreadInteractionDataIntegrityWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBlockReason"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ThreadInteractionDataIntegrity:[6468,{blockReason:[1,o("WAWebWamEnumBlockReason").BLOCK_REASON],isBlocked:[2,e.TYPES.BOOLEAN],isReported:[3,e.TYPES.BOOLEAN],smbMarketingMessagesSpamReports:[4,e.TYPES.INTEGER],spamReports:[5,e.TYPES.INTEGER],threadCreationDate:[9,e.TYPES.STRING],threadDs:[6,e.TYPES.STRING],threadId:[7,e.TYPES.STRING],threadIdByLid:[8,e.TYPES.STRING]},[1,1,1],"regular"]},{ThreadInteractionDataIntegrity:[]});l.ThreadInteractionDataIntegrityWamEvent=s}),98);
__d("WAWebThreadLoggingIntegrity",["WALogger","WAWebThreadInteractionDataIntegrityWamEvent"],(function(t,n,r,o,a,i,l){var e;function s(t){try{t.forEach(function(e){var t=e.threadDs,n=e.threadId,r={threadDs:t,threadId:n},a=new(o("WAWebThreadInteractionDataIntegrityWamEvent")).ThreadInteractionDataIntegrityWamEvent(r);a.commit()})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ctlv2: error uploading Integrity WAM event: ",""])),String(t)).sendLogs("thread-logging-integrity-upload-failure")}}l.ThreadInteractionIntegrityWamTrigger=s}),98);
__d("WAWebWamEnumClientGroupSizeBucket",[],(function(t,n,r,o,a,i){var e=Object.freeze({SMALL:1,MEDIUM:2,LARGE:3,EXTRA_LARGE:4,XX_LARGE:5,XXX_LARGE:6,LT1024:16,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15});i.CLIENT_GROUP_SIZE_BUCKET=e}),66);
__d("WAWebWamEnumGroupTypeClient",[],(function(t,n,r,o,a,i){var e=Object.freeze({REGULAR_GROUP:1,SUB_GROUP:2,DEFAULT_SUB_GROUP:3,PARENT_GROUP:4});i.GROUP_TYPE_CLIENT=e}),66);
__d("WAWebThreadInteractionDataNotificationWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumClientGroupSizeBucket","WAWebWamEnumGroupTypeClient"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ThreadInteractionDataNotification:[6412,{groupSizeBucket:[1,o("WAWebWamEnumClientGroupSizeBucket").CLIENT_GROUP_SIZE_BUCKET],groupTypeClient:[2,o("WAWebWamEnumGroupTypeClient").GROUP_TYPE_CLIENT],isAGroup:[3,e.TYPES.BOOLEAN],threadCreationDate:[26,e.TYPES.STRING],threadDs:[4,e.TYPES.STRING],threadId:[24,e.TYPES.STRING],threadIdByLid:[25,e.TYPES.STRING],totalLinkReshareMessageNotifShown:[6,e.TYPES.INTEGER],totalLinkReshareMessageNotifShownFb:[7,e.TYPES.INTEGER],totalLinkReshareMessageNotifShownIg:[8,e.TYPES.INTEGER],totalLinkReshareMessageNotifTapToOpen:[9,e.TYPES.INTEGER],totalLinkReshareMessageNotifTapToOpenFb:[10,e.TYPES.INTEGER],totalLinkReshareMessageNotifTapToOpenIg:[11,e.TYPES.INTEGER],totalMessageReminderNotifShown:[12,e.TYPES.INTEGER],totalMessageReminderNotifTapToOpen:[13,e.TYPES.INTEGER],totalNotifMarkAsRead:[14,e.TYPES.INTEGER],totalNotifMissedCallVoipCallback:[15,e.TYPES.INTEGER],totalNotifMissedCallVoipMessage:[16,e.TYPES.INTEGER],totalNotifOthers:[17,e.TYPES.INTEGER],totalNotifReply:[18,e.TYPES.INTEGER],totalNotifRtcVoipAccept:[19,e.TYPES.INTEGER],totalNotifRtcVoipDecline:[20,e.TYPES.INTEGER],totalNotifShowPreview:[21,e.TYPES.INTEGER],totalNotifShown:[22,e.TYPES.INTEGER],totalNotifTapToOpen:[23,e.TYPES.INTEGER]},[1,1,1],"regular"]},{ThreadInteractionDataNotification:[]});l.ThreadInteractionDataNotificationWamEvent=s}),98);
__d("WAWebThreadLoggingNotification",["WALogger","WAWebThreadInteractionDataNotificationWamEvent"],(function(t,n,r,o,a,i,l){var e;function s(t){try{t.forEach(function(e){var t=e.event,n=e.threadDs,r=e.threadId,a=t.contactInfo,i={threadDs:n,threadId:r,isAGroup:a.isAGroup},l=new(o("WAWebThreadInteractionDataNotificationWamEvent")).ThreadInteractionDataNotificationWamEvent(i);l.commit()})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ctlv2: error uploading Notification WAM event: ",""])),String(t)).sendLogs("thread-logging-notification-upload-failure")}}l.ThreadInteractionNotificationWamTrigger=s}),98);
__d("WAWebThreadInteractionDataVoipWamEvent",["WAWebWamCodegenUtils"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ThreadInteractionDataVoip:[6362,{callOffersReceived:[1,e.TYPES.INTEGER],callOffersSent:[2,e.TYPES.INTEGER],callsResultBusy:[3,e.TYPES.INTEGER],callsResultCancelled:[4,e.TYPES.INTEGER],callsResultConnected:[5,e.TYPES.INTEGER],callsResultError:[6,e.TYPES.INTEGER],callsResultMissed:[7,e.TYPES.INTEGER],callsResultRejected:[8,e.TYPES.INTEGER],threadCreationDate:[16,e.TYPES.STRING],threadDs:[9,e.TYPES.STRING],threadId:[14,e.TYPES.STRING],threadIdByLid:[15,e.TYPES.STRING],totalCallDuration:[11,e.TYPES.INTEGER],videoCallsOffered:[12,e.TYPES.INTEGER],voiceCallsOffered:[13,e.TYPES.INTEGER]},[1,1,1],"regular"]},{ThreadInteractionDataVoip:[]});l.ThreadInteractionDataVoipWamEvent=s}),98);
__d("WAWebThreadLoggingVoip",["WALogger","WAWebThreadInteractionDataVoipWamEvent"],(function(t,n,r,o,a,i,l){var e;function s(t){try{t.forEach(function(e){var t=e.event,n=e.threadDs,r=e.threadId,a={threadDs:n,threadId:r,callOffersReceived:t.callOffersReceived,callOffersSent:t.callOffersSent,totalCallDuration:t.totalCallDuration},i=new(o("WAWebThreadInteractionDataVoipWamEvent")).ThreadInteractionDataVoipWamEvent(a);i.commit()})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ctlv2: error uploading Voip WAM event: ",""])),String(t)).sendLogs("thread-logging-voip-upload-failure")}}l.ThreadInteractionVoipWamTrigger=s}),98);
__d("WAWebChatThreadLoggingEventUploader",["Promise","WALogger","WANullthrows","WATimeUtils","WAWebABProps","WAWebBotGating","WAWebBotTypes","WAWebChatMessageCountsWamEvent","WAWebChatThreadLoggingBoolFlagFields","WAWebChatThreadLoggingCountFields","WAWebChatThreadLoggingUtils","WAWebGroupType","WAWebThreadLoggingAi","WAWebThreadLoggingBiz","WAWebThreadLoggingCoreConsumer","WAWebThreadLoggingIntegrity","WAWebThreadLoggingNotification","WAWebThreadLoggingVoip","WAWebWamEnumChatMutedType","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p=o("WAWebABProps").getABPropConfigValue("threads_logging_v2_enabled"),_=(function(){function t(e,t){this.eventStore=t,this.metadataStore=e}var a=t.prototype;return a.uploadEvents=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a,i,l=this,_=(a=t==null?void 0:t.purgeAfter)!=null?a:!0,g=yield this.metadataStore.getOffset();if(g==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingBatchEventUploader: offset not in store!"]))),-1;var h=(i=t==null?void 0:t.lastStartTs)!=null?i:o("WAWebChatThreadLoggingUtils").computeStartTs(g,o("WATimeUtils").unixTime()-o("WATimeUtils").DAY_SECONDS);if(this.secret==null){var y=yield this.metadataStore.getSecret();if(y==null)return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingBatchEventUploader: secret not in store!"]))),-1;this.secret=y}var C=yield this.eventStore.getBeforeInclusive(h);if(p)try{yield f(C,r("WANullthrows")(this.secret))}catch(e){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["CTLV2: Error uploading all events"])))}try{yield(m||(m=n("Promise"))).all(C.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebChatThreadLoggingUtils").getThreadDs(e.startTs),n=yield o("WAWebChatThreadLoggingUtils").generateThreadID(r("WANullthrows")(l.secret),e.chatId,t),a=e.contactInfo,i={threadDs:t,threadId:n,messagesSent:e.msgsSent,messagesReceived:e.msgsReceived,commentsReceived:e.commentsReceived,viewOnceMessagesSent:e.viewOnceMsgsSent,viewOnceMessagesReceived:e.viewOnceMsgsReceived,viewOnceMessagesOpened:e.viewOnceMessagesOpened,isAGroup:e.contactInfo.isAGroup,groupSize:a.isAGroup?a.groupSize:void 0,isAContact:a.isAGroup?void 0:a.isAContact,isArchived:e.isArchived,isPinned:e.isPinned,messagesStarred:e.messagesStarred,messagesRead:e.msgsRead,messagesUnread:e.messagesUnread,chatMuted:e.isMuted?o("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:o("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE.NOT_MUTED,callOffersSent:e.callOffersSent,callOffersReceived:e.callOffersReceived,totalCallDuration:e.totalCallDuration,typeOfGroup:e.contactInfo.groupType!=null?o("WAWebGroupType").groupTypeToWamEnum(e.contactInfo.groupType):void 0,isPnhEnabledChat:e.isPnhEnabledChat,reactionsSent:e.reactionsSent,reactionsReceived:e.reactionsReceived,isMessageYourself:e.isMessageYourself,forwardMessagesSent:e.forwardMessagesSent,forwardMessagesReceived:e.forwardMessagesReceived,editedMsgsSent:e.editedMsgsSent,totalMessageToAgentCnt:e.botMessagesSent,totalMessageFromAgentCnt:e.botMessagesReceived,totalMessageEditsFromAgentCnt:e.botMessagesEdited,isUserAgent:e.isUserAgent,hasUsername:e.hasUsername,hasUsernamePin:e.hasUsernamePin,oppositeVisibleIdentification:e.oppositeVisibleIdentification!=null?e.oppositeVisibleIdentification:void 0,isUsernameThread:e.isUsernameThread,chatOrigins:e.chatOrigins!=null?e.chatOrigins:void 0,eventCreationMessagesReceived:e.eventCreationMessagesReceived,eventCreationMessagesSent:e.eventCreationMessagesSent,eventResponseMessagesReceived:e.eventResponseMessagesReceived,eventResponseMessagesSent:e.eventResponseMessagesSent},s=new(o("WAWebChatMessageCountsWamEvent")).ChatMessageCountsWamEvent(i);o("WAWebABProps").getABPropConfigValue("group_status_receiver_enabled")&&(s.groupStatusLikesOthersToOthers=e.eventGroupStatusLikeOthersToOthers,s.groupStatusLikesOthersToOwn=e.eventGroupStatusLikeOthersToOwn,s.groupStatusRepliesOthersToOthers=e.eventGroupStatusReplyOthersToOthers,s.groupStatusRepliesOthersToOwn=e.eventGroupStatusReplyOthersToOwn,s.groupStatusRepliesOwnToOthers=e.eventGroupStatusReplyOwnToOthers,s.groupStatusRepliesOwnToOwn=e.eventGroupStatusReplyOwnToOwn),e.ephemeralityTriggerAction!=null&&(s.ephemeralityTriggerAction=e.ephemeralityTriggerAction),e.ephemeralityInitiator!=null&&(s.ephemeralityInitiator=e.ephemeralityInitiator),o("WAWebChatThreadLoggingCountFields").COUNT_FIELD_NAMES.forEach(function(t){s[t]=e[t]}),o("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELD_NAMES.forEach(function(t){s[t]=e[t]}),a.isAGroup||(o("WAWebBotGating").isBizBot3pEnabled()&&(s.isUser3pBotChat=a.automatedType===o("WAWebBotTypes").BizBotAutomatedType.FULL_3P),o("WAWebBotGating").isBizBot1pEnabled()&&(s.isUser1pBizBotChat=a.automatedType===o("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P)),s.commit()});return function(t){return e.apply(this,arguments)}})()))}catch(e){o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: error uploading events: ",""])),r("getErrorSafe")(e).toString()).sendLogs("thread-logging-upload-failure")}if(_){var b=yield this.eventStore.deleteBeforeInclusive(h);b!==C.length&&o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["uploadEvents: uploaded "," events but only deleted "," (they should be the same!)"])),C.length,b)}return yield this.metadataStore.setLastUploadedStartTs(h),C.length});function a(e){return t.apply(this,arguments)}return a})(),t})();function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var r=yield(m||(m=n("Promise"))).all(e.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=o("WAWebChatThreadLoggingUtils").getThreadDs(e.startTs),r=yield o("WAWebChatThreadLoggingUtils").generateThreadID(t,e.chatId,n);return{event:e,threadDs:n,threadId:r}});return function(t){return e.apply(this,arguments)}})()));o("WAWebThreadLoggingCoreConsumer").ThreadInteractionCoreConsumerWamTrigger(r),o("WAWebThreadLoggingVoip").ThreadInteractionVoipWamTrigger(r),o("WAWebThreadLoggingBiz").ThreadInteractionBizWamTrigger(r),o("WAWebThreadLoggingAi").ThreadInteractionAiWamTrigger(r),o("WAWebThreadLoggingNotification").ThreadInteractionNotificationWamTrigger(r),o("WAWebThreadLoggingIntegrity").ThreadInteractionIntegrityWamTrigger(r)}),g.apply(this,arguments)}l.ChatThreadLoggingEventUploaderImpl=_}),98);
__d("WAWebChatThreadLoggingLocalstorageMetadataHandler",["Promise","WABase64","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=(function(){function t(){}var r=t.prototype;return r.setOffset=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield o("WAWebUserPrefsMultiDevice").setChatThreadLoggingOffset(e),!0});function t(t){return e.apply(this,arguments)}return t})(),r.getOffset=function(){return(e||(e=n("Promise"))).resolve(o("WAWebUserPrefsMultiDevice").getChatThreadLoggingOffset())},r.setSecret=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield o("WAWebUserPrefsMultiDevice").setChatThreadLoggingSecretB64(o("WABase64").encodeB64(e)),!0});function t(t){return e.apply(this,arguments)}return t})(),r.getSecret=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebUserPrefsMultiDevice").getChatThreadLoggingSecretB64();return e==null?null:o("WABase64").decodeB64(e)});function t(){return e.apply(this,arguments)}return t})(),r.setLastUploadedStartTs=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield o("WAWebUserPrefsMultiDevice").setChatThreadLoggingLastUploadedStartTs(e),!0});function t(t){return e.apply(this,arguments)}return t})(),r.getLastUploadedStartTs=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebUserPrefsMultiDevice").getChatThreadLoggingLastUploadedStartTs();return e!=null?e:0});function t(){return e.apply(this,arguments)}return t})(),t})();l.ChatThreadLoggingMetadataLocalStorage=s}),98);
__d("WAWebChatThreadLogging",["Promise","WALogger","WATimeUtils","WAWebABProps","WAWebChatThreadLoggingEventStore","WAWebChatThreadLoggingEventUploader","WAWebChatThreadLoggingLocalstorageMetadataHandler","WAWebChatThreadLoggingUtils","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v=null;function S(){return v==null&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getChatThreadLoggingState: init incomplete!"]))),v}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e===void 0&&(e=!0);var t=e&&o("WAWebABProps").getABPropConfigValue("message_count_logging_md_enabled");(yield o("WAWebUserPrefsMultiDevice").getChatThreadLoggingLastUploadedStartTs())==null&&(yield o("WAWebUserPrefsMultiDevice").setChatThreadLoggingLastUploadedStartTs(0));var r=new(o("WAWebChatThreadLoggingLocalstorageMetadataHandler")).ChatThreadLoggingMetadataLocalStorage,a=t?new(o("WAWebChatThreadLoggingEventStore")).ChatThreadLoggingEventStoreImpl(r):{handleMessages:function(){return(b||(b=n("Promise"))).resolve()},getEvent:function(){return(b||(b=n("Promise"))).resolve()},getBeforeInclusive:function(){return(b||(b=n("Promise"))).resolve([])},deleteBeforeInclusive:function(){return(b||(b=n("Promise"))).resolve(0)}},i=t?new(o("WAWebChatThreadLoggingEventUploader")).ChatThreadLoggingEventUploaderImpl(r,a):{uploadEvents:function(){return(b||(b=n("Promise"))).resolve(0)}},l=yield r.getOffset();l!=null&&$(l),v={metadataStore:r,eventStore:a,eventUploader:i},o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["chat thread logging initialized"])))}),L.apply(this,arguments)}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n;o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: setting offset"])));var r=(t=yield(n=S())==null?void 0:n.metadataStore.setOffset(e))!=null?t:!1;return r&&$(e),r}),k.apply(this,arguments)}function I(e){var t,r;return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: setting thread_id_user_secret"]))),(t=(r=S())==null?void 0:r.metadataStore.setSecret(e))!=null?t:(b||(b=n("Promise"))).resolve(!1)}function T(e){var t;o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: handling "," message(s)"])),e.length),(t=S())==null||t.eventStore.handleMessages(e).catch(function(e){o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: error handling activities"])))})}function D(e){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,r,a=yield(t=S())==null?void 0:t.metadataStore.getOffset();if(a==null){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: attempting to upload but offset is unset."])));return}var i=yield(n=S())==null?void 0:n.metadataStore.getSecret();if(i==null){o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: attempting to upload but secret is unset."])));return}var l=yield(r=S())==null?void 0:r.eventUploader.uploadEvents(e)}),x.apply(this,arguments)}function $(e){var t=o("WATimeUtils").unixTime(),r=t-t%86400,a=r+e,i=a-t;i<0&&(i+=o("WATimeUtils").DAY_SECONDS),self.setTimeout(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t;yield(t=S())==null?void 0:t.eventUploader.uploadEvents(),$(e)}),i*1e3)}function P(){if(!r("gkx")("26258"))return S()}function N(){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield S(),t=yield e==null?void 0:e.metadataStore.getSecret();return t==null?(o("WALogger").WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: cannot get user secret from the thread logging metadata store"]))).sendLogs("ctl-secret-unset"),null):t}),M.apply(this,arguments)}function w(e,t){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield N();if(n==null){o("WALogger").WARN(g||(g=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: cannot generate getChatThreadID because secret is unset."])));return}var r=o("WAWebChatThreadLoggingUtils").getThreadDs(t!=null?t:o("WATimeUtils").unixTime());return o("WAWebChatThreadLoggingUtils").generateThreadID(n,e,r)}),A.apply(this,arguments)}function F(e){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield N();return t==null?(o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[ctwa] labels: cannot generate getChatThreadIDHMAC because secret is unset"]))).sendLogs("ctwa-labels-thread-id-hmac-error"),null):o("WAWebChatThreadLoggingUtils").generateThreadIDHMAC(t,e)}),O.apply(this,arguments)}function B(e){return W.apply(this,arguments)}function W(){return W=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield N();return t==null?(o("WALogger").WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: cannot generate getMessageIDHMAC because secret is unset."]))),null):o("WAWebChatThreadLoggingUtils").generateMessageIDHMAC(t,e)}),W.apply(this,arguments)}function q(e){return U.apply(this,arguments)}function U(){return U=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{var t=o("WAWebUserPrefsMeUser").getMePnUserOrThrow().toJid(),n=e.key.id;return o("WAWebChatThreadLoggingUtils").generateUserThreadIDHMAC(t,n)}catch(e){return o("WALogger").WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["thread_logging: cannot generate getThreadIDHMAC due to error ",""])),e),null}}),U.apply(this,arguments)}l.initChatThreadLogging=R,l.setThreadDsTimeframeOffset=E,l.setThreadIdUserSecret=I,l.handleActivitiesForChatThreadLogging=T,l.uploadChatThreadLoggingEvents=D,l.getChatThreadLoggingStateDebug=P,l.getChatThreadID=w,l.getChatThreadIDHMAC=F,l.getMessageIDHMAC=B,l.getThreadIDHMAC=q}),98);
__d("WAWebPromiseQueue",["Promise","WALogger","WAPromiseQueue","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u=(function(t){function r(e){return t.call(this,e)||this}babelHelpers.inheritsLoose(r,t);var a=r.prototype;return a.wait=function(){return t.prototype.wait.call(this)},a.waitUntilResolved=(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a=this;if(r===void 0&&(r=0),r>9){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["PromiseQueue: wait called more than 10 times"]))).sendLogs("promise_queue_long_wait_time");return}var i=t.prototype.wait.call(this);return new(s||(s=n("Promise")))((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){try{yield i,i!==t.prototype.wait.call(a)&&(yield a.waitUntilResolved(r+1)),e()}catch(e){n(e)}});return function(t,n){return e.apply(this,arguments)}})())});function a(e){return r.apply(this,arguments)}return a})(),r})(o("WAPromiseQueue").PromiseQueue);l.PromiseQueue=u}),98);
__d("WAWebApiChatThreadLoggingPendingEvents",["WAWebChatThreadLoggingBoolFlagFields","WAWebChatThreadLoggingCountFields","WAWebPromiseQueue","WAWebSchemaChatThreadLoggingPendingEvents","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=Object.freeze({msgsSent:0,msgsReceived:0,msgsRead:0,viewOnceMsgsSent:0,viewOnceMsgsReceived:0,viewOnceMessagesOpened:0,callOffersSent:0,callOffersReceived:0,totalCallDuration:0,commerceMsgsSent:0,commerceMsgsReceived:0,pdpInquiriesSent:0,reactionsSent:0,reactionsReceived:0,forwardMessagesSent:0,forwardMessagesReceived:0,editedMsgsSent:0,botMessagesSent:0,botMessagesReceived:0,botMessagesEdited:0,eventCreationMessagesSent:0,eventCreationMessagesReceived:0,eventResponseMessagesSent:0,eventResponseMessagesReceived:0,eventGroupStatusReplyOthersToOwn:0,eventGroupStatusReplyOthersToOthers:0,eventGroupStatusReplyOwnToOthers:0,eventGroupStatusReplyOwnToOwn:0,eventGroupStatusLikeOthersToOthers:0,eventGroupStatusLikeOthersToOwn:0}),s=Object.freeze(babelHelpers.extends({},o("WAWebChatThreadLoggingCountFields").COUNT_FIELDS,o("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELDS,e)),u=new(o("WAWebPromiseQueue")).PromiseQueue;function c(e){return u.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().bulkGet(e.map(function(e){var t=e.chatId,n=e.startTs;return[t,n]})),n=t.map(function(t,n){var r=e[n],a=d(r.chatId,r.startTs,t);return o("WAWebChatThreadLoggingCountFields").COUNT_FIELD_NAMES.forEach(function(e){a[e]+=r[e]}),o("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELD_NAMES.forEach(function(e){a[e]=r[e]}),a.msgsSent+=r.addMsgsSent,a.msgsReceived+=r.addMsgsReceived,a.msgsRead+=r.addMsgsRead,a.viewOnceMsgsSent+=r.addViewOnceMsgsSent,a.viewOnceMsgsReceived+=r.addViewOnceMsgsReceived,a.viewOnceMessagesOpened+=r.addViewOnceMsgsOpened,a.callOffersSent+=r.addCallOffersSent,a.callOffersReceived+=r.addCallOffersReceived,a.totalCallDuration+=r.addTotalCallDuration,a.commerceMsgsSent+=r.addCommerceMsgsSent,a.commerceMsgsReceived+=r.addCommerceMsgsReceived,a.pdpInquiriesSent+=r.addPdpInquiriesSent,a.reactionsSent+=r.addReactionsSent,a.reactionsReceived+=r.addReactionsReceived,a.forwardMessagesSent+=r.addForwardMessagesSent,a.forwardMessagesReceived+=r.addForwardMessagesReceived,a.editedMsgsSent+=r.addEditedMsgsSent,a.botMessagesSent+=r.addBotMessagesSent,a.botMessagesReceived+=r.addBotMessagesReceived,a.botMessagesEdited+=r.addBotMessagesEdited,a.eventCreationMessagesSent+=r.addEventCreationMessagesSent,a.eventCreationMessagesReceived+=r.addEventCreationMessagesReceived,a.eventResponseMessagesSent+=r.addEventResponseMessagesSent,a.eventResponseMessagesReceived+=r.addEventResponseMessagesReceived,a.eventGroupStatusReplyOthersToOwn+=r.addEventGroupStatusReplyOthersToOwn,a.eventGroupStatusReplyOthersToOthers+=r.addEventGroupStatusReplyOthersToOthers,a.eventGroupStatusReplyOwnToOthers+=r.addEventGroupStatusReplyOwnToOthers,a.eventGroupStatusReplyOwnToOwn+=r.addEventGroupStatusReplyOwnToOwn,a.eventGroupStatusLikeOthersToOthers+=r.addEventGroupStatusLikeOthersToOthers,a.eventGroupStatusLikeOthersToOwn+=r.addEventGroupStatusLikeOthersToOwn,a});return o("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().bulkCreateOrReplace(n)}))}function d(t,n,r){return r==null?babelHelpers.extends({chatId:t,startTs:n},s):(o("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELD_NAMES.forEach(function(e){r[e]==null&&(r[e]=s[e])}),o("WAWebChatThreadLoggingCountFields").COUNT_FIELD_NAMES.forEach(function(e){r[e]==null&&(r[e]=s[e])}),Object.keys(e).forEach(function(e){r[e]==null&&(r[e]=s[e])}),r)}function m(e,t){return o("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().get([e,t])}function p(e){return o("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().lessThan(["startTs"],e,{inclusive:!0})}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().bulkDeleteRange(["startTs"],0,e+1);return t}),f.apply(this,arguments)}l.createOrUpdateChatEvents=c,l.getChatEvent=m,l.getBeforeInclusive=p,l.deleteBeforeInclusive=_}),98);
__d("WAWebDBBulkGetIsContactABusiness",["WAWebSchemaVerifiedBusinessName"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().bulkGet(e.map(function(e){var t;return(t=e==null?void 0:e.user)!=null?t:""})).then(function(e){return e.map(function(e){return e!=null})})}l.bulkGetIsContactABusiness=e}),98);
__d("WAWebDBGetStarredMessagesForChat",["Promise","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebSchemaMessage"],(function(t,n,r,o,a,i,l){var e;function s(t,r,a){return(e||(e=n("Promise"))).resolve().then(function(){if(a!=null)return o("WAWebSchemaMessage").getMessageTable().get(a.toString())}).then(function(e){var n=e==null?[o("WAWebDBMessageUtils").endOfChat(t),1/0]:[e.internalId,e.isStarred],a=[o("WAWebDBMessageUtils").beginningOfChat(t),0];return o("WAWebSchemaMessage").getMessageTable().between(["internalId","isStarred"],a,n,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:r}).then(function(e){return e.map(function(e){return o("WAWebDBMessageSerialization").messageFromDbRow(e)})})})}l.getStarredMessagesForChat=s}),98);
__d("WAWebDBGroupsGroupMetadata",["Promise","WABatcher","WAWebABProps","WAWebModelStorageUtils","WAWebSchemaGroupMetadata","WAWebUsernameGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupInfos,r=[];yield o("WAWebModelStorageUtils").getStorage().lock(["group-metadata"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],a=yield n.bulkGet(t.map(function(e){return e.id.toString()}));return r=t.map(function(e,t){var n,r,i,l,s,u,c,d,m,p,_,f=a[t],g={subject:e.subject,subjectTime:e.subjectTime||0},h={announce:e.announce,a_v_id:e.a_v_id||0},y={desc:e.desc,descId:e.descId,descOwner:(n=e.descOwner)==null?void 0:n.toString(),descTime:e.descTime||0};if(f){var C=f.subjectTime||0,b=f.a_v_id||0,v=f.descTime||0;C>g.subjectTime&&(g={subject:f.subject,subjectTime:C}),b>h.a_v_id&&(h={announce:f.announce,a_v_id:b}),v>y.descTime&&(y={desc:f.desc,descId:f.descId,descOwner:f.descOwner,descTime:v})}var S;o("WAWebABProps").getABPropConfigValue("dm_initiator_trigger_groups")?S={ephemeralDuration:e.ephemeralDuration||0,disappearingModeTrigger:e.disappearingModeTrigger,disappearingModeInitiatedByMe:e.disappearingModeInitiatedByMe}:S={ephemeralDuration:e.ephemeralDuration||0};var R=babelHelpers.extends({id:e.id.toString(),creation:e.creation,owner:(r=e.owner)==null?void 0:r.toString(),restrict:e.restrict,noFrequentlyForwarded:e.noFrequentlyForwarded,membershipApprovalMode:e.membershipApprovalMode,memberAddMode:e.memberAddMode,memberLinkMode:e.memberLinkMode,memberShareGroupHistoryMode:e.memberShareGroupHistoryMode,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,size:e.size||0,support:(i=e.support)!=null?i:!1,suspended:(l=e.suspended)!=null?l:!1,terminated:(s=e.terminated)!=null?s:!1,parentGroup:(u=e.parentGroup)==null?void 0:u.toString(),isParentGroup:e.isParentGroup,isParentGroupClosed:e.isParentGroupClosed,defaultSubgroup:e.defaultSubgroup,generalSubgroup:e.generalSubgroup,lastActivityTimestamp:(c=f==null?void 0:f.lastActivityTimestamp)!=null?c:0,lastSeenActivityTimestamp:(d=f==null?void 0:f.lastSeenActivityTimestamp)!=null?d:0,isLidAddressingMode:e.isLidAddressingMode,reportToAdminMode:(m=e.reportToAdminMode)!=null?m:!1,lastReportToAdminTimestamp:f==null?void 0:f.lastReportToAdminTimestamp,allowNonAdminSubGroupCreation:e.allowNonAdminSubGroupCreation,generalChatAutoAddDisabled:e.generalChatAutoAddDisabled,hasCapi:e.hasCapi===!0,hiddenSubgroup:e.hiddenSubgroup,groupSafetyCheck:e.groupSafetyCheck,lastCommunityPollTimestamp:f==null?void 0:f.lastCommunityPollTimestamp,isOpenBotGroup:(p=e==null?void 0:e.isOpenBotGroup)!=null?p:f==null?void 0:f.isOpenBotGroup,isTeeBotGroup:e==null?void 0:e.isTeeBotGroup},g,y,h,S);return e.hasIncompleteParticipantInformation!=null&&o("WAWebUsernameGatingUtils").usernameDisplayedEnabled()&&(R.hasIncompleteParticipantInformation=e.hasIncompleteParticipantInformation),e.groupAdder!=null?babelHelpers.extends({},R,{groupAdder:(_=e.groupAdder)==null?void 0:_.toString()}):R}),n.bulkCreateOrMerge(r)});return function(t){return e.apply(this,arguments)}})())}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,r,a,i,l,s,u,c,d,m,p,_=e.groupWid,f=yield o("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(String(_));return f?{id:_,owner:f.owner==null?null:o("WAWebWidFactory").createWid(f.owner),creation:f.creation,desc:(t=f.desc)!=null?t:void 0,descId:(n=f.descId)!=null?n:void 0,descOwner:f.descOwner==null?null:o("WAWebWidFactory").createWid(f.descOwner),descTime:(r=f.descTime)!=null?r:void 0,restrict:f.restrict||!1,announce:f.announce||!1,noFrequentlyForwarded:f.noFrequentlyForwarded||!1,ephemeralDuration:f.ephemeralDuration||0,membershipApprovalMode:(a=f.membershipApprovalMode)!=null?a:!1,memberAddMode:f.memberAddMode,memberLinkMode:f.memberLinkMode,subject:f.subject,support:f.support===!0,lastActivityTimestamp:(i=f.lastActivityTimestamp)!=null?i:0,lastSeenActivityTimestamp:(l=f.lastSeenActivityTimestamp)!=null?l:0,lastReportToAdminTimestamp:(s=f.lastReportToAdminTimestamp)!=null?s:null,isLidAddressingMode:f.isLidAddressingMode,allowNonAdminSubGroupCreation:(u=f.allowNonAdminSubGroupCreation)!=null?u:!1,generalChatAutoAddDisabled:(c=f.generalChatAutoAddDisabled)!=null?c:!1,hasCapi:f.hasCapi===!0,lastCommunityPollTimestamp:(d=f.lastCommunityPollTimestamp)!=null?d:0,isOpenBotGroup:(m=f.isOpenBotGroup)!=null?m:!1,isTeeBotGroup:(p=f.isTeeBotGroup)!=null?p:!1}:null}),d.apply(this,arguments)}var m=(function(){var e=3e3;return o("WABatcher").batch({delayMs:e},(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=n();return yield o("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkCreateOrMerge(t),e.map(function(e){});function n(){return Array.from(e.reduce(function(e,t){var n;return e.set(t.id,babelHelpers.extends({},(n=e.get(t.id))!=null?n:{},t)),e},new Map).values())}});return function(t){return e.apply(this,arguments)}})())})();function p(e,t,n){return n===void 0&&(n=!1),n?m(babelHelpers.extends({id:e.toString()},t)):o("WAWebSchemaGroupMetadata").getGroupMetadataTable().createOrMerge(e.toString(),babelHelpers.extends({id:e.toString()},t))}function _(e){return o("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(e.toString())}function f(t){return t.length===0?(e||(e=n("Promise"))).resolve([]):o("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkGet(t.map(function(e){return e==null?"":e.toString()}))}l.updateGroupMetadataTable=s,l.getGroupMetadataUNSAFE=c,l.persistGroupMetadata=p,l.getGroupMetadata=_,l.bulkGetGroupMetadata=f}),98);
__d("WAWebChatThreadLoggingEventStore",["Promise","WALogger","WAShiftTimer","WAWebABProps","WAWebApiChat","WAWebApiChatThreadLoggingPendingEvents","WAWebApiContact","WAWebBotTypes","WAWebChatThreadLoggingBoolFlagFields","WAWebChatThreadLoggingCountFields","WAWebChatThreadLoggingUtils","WAWebDBBulkGetIsContactABusiness","WAWebDBGetStarredMessagesForChat","WAWebDBGroupsGroupMetadata","WAWebGroupType","WAWebLidAwareContactsDB","WAWebLidMigrationUtils","WAWebSchemaBusinessProfile","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebUsernameTypes","WAWebWamEnumChatOriginsType","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p=5,_=(function(){function t(t,n){var r=this;this.metadataStore=t,this.$1=new Map,this.$2=n!=null?n:p,this.$3=new(o("WAShiftTimer")).ShiftTimer(function(){r.$4().catch(function(t){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStoreImpl: flush error"])))})})}var a=t.prototype;return a.handleMessages=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,n=yield this.metadataStore.getOffset();if(n==null){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStoreImpl: handleMessages: offset unset."])));return}var r=yield this.metadataStore.getLastUploadedStartTs();o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStoreImpl: lastUploadedStartTs=",""])),r),e.forEach(function(e){if(o("WAWebChatThreadLoggingUtils").shouldUpdateChatEvent(n,e.ts,r)){var a=o("WAWebChatThreadLoggingUtils").computeStartTs(n,e.ts),i=e.chatId.toString({legacy:!0}),l=i+"_"+String(a),s=t.$1.get(l),u=s!=null?s:babelHelpers.extends({},o("WAWebChatThreadLoggingCountFields").COUNT_FIELDS,o("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELDS,{startTs:a,chatId:i,addMsgsSent:0,addMsgsReceived:0,addMsgsRead:0,addViewOnceMsgsSent:0,addViewOnceMsgsReceived:0,addViewOnceMsgsOpened:0,addCallOffersSent:0,addCallOffersReceived:0,addTotalCallDuration:0,addCommerceMsgsSent:0,addCommerceMsgsReceived:0,addPdpInquiriesSent:0,addReactionsSent:0,addReactionsReceived:0,addForwardMessagesSent:0,addForwardMessagesReceived:0,addEditedMsgsSent:0,addBotMessagesSent:0,addBotMessagesReceived:0,addBotMessagesEdited:0,addEventCreationMessagesSent:0,addEventCreationMessagesReceived:0,addEventResponseMessagesSent:0,addEventResponseMessagesReceived:0,addEventGroupStatusReplyOthersToOwn:0,addEventGroupStatusReplyOthersToOthers:0,addEventGroupStatusReplyOwnToOwn:0,addEventGroupStatusReplyOwnToOthers:0,addEventGroupStatusLikeOthersToOthers:0,addEventGroupStatusLikeOthersToOwn:0});s==null&&t.$1.set(l,u);var d=o("WAWebChatThreadLoggingCountFields").toMaybeCountActionType(e.activityType),m=o("WAWebChatThreadLoggingBoolFlagFields").toMaybeBoolFlagActionType(e.activityType);if(d!=null)u[d]+=1;else if(m!=null)u[m]=e.boolValue===void 0?!0:e.boolValue;else switch(e.activityType){case"msgSend":u.addMsgsSent+=1,e.isViewOnce&&(u.addViewOnceMsgsSent+=1),e.isCommerceMessage===!0&&(u.addCommerceMsgsSent+=1),e.isPdpInquiry===!0&&(u.addPdpInquiriesSent+=1),e.isReply&&(u.repliesSent+=1),e.isReaction&&(u.addReactionsSent+=1),e.isForwarded&&(u.addForwardMessagesSent+=1),e.isEdit&&(u.addEditedMsgsSent+=1),e.isBot&&(u.addBotMessagesSent+=1),e.isEventCreation&&(u.addEventCreationMessagesSent+=1),e.isEventResponse&&(u.addEventResponseMessagesSent+=1);break;case"msgReceive":u.addMsgsReceived+=1,e.isViewOnce&&(u.addViewOnceMsgsReceived+=1),e.isCommerceMessage===!0&&(u.addCommerceMsgsReceived+=1),e.isReaction&&(u.addReactionsReceived+=1),e.isForwarded&&(u.addForwardMessagesReceived+=1),e.isBot&&(e.isEdit?u.addBotMessagesEdited+=1:u.addBotMessagesReceived+=1),e.isEventCreation&&(u.addEventCreationMessagesReceived+=1),e.isEventResponse&&(u.addEventResponseMessagesReceived+=1);break;case"msgRead":u.addMsgsRead+=e.readCount;break;case"groupStatusMsgReceive":u.addMsgsReceived+=1,e.isGroupStatusReplyOthersToOwn&&(u.addEventGroupStatusReplyOthersToOwn+=1),e.isGroupStatusReplyOthersToOthers&&(u.addEventGroupStatusReplyOthersToOthers+=1),e.isGroupStatusLikeOthersToOthers&&(u.addEventGroupStatusLikeOthersToOthers+=1),e.isGroupStatusLikeOthersToOwn&&(u.addEventGroupStatusLikeOthersToOwn+=1);break;case"groupStatusMsgSend":u.addMsgsSent+=1,e.isGroupStatusReplyOwnToOwn&&(u.addEventGroupStatusReplyOwnToOwn+=1),e.isGroupStatusReplyOwnToOthers&&(u.addEventGroupStatusReplyOwnToOthers+=1);break;case"viewOnceOpen":u.addViewOnceMsgsOpened+=1;break;case"voipCall":e.outgoing?u.addCallOffersSent+=1:u.addCallOffersReceived+=1,u.addTotalCallDuration+=e.durationInSeconds;break;default:o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Passed event store info type not valid: ",""])),e.activityType)}}}),yield this.$5()});function t(t){return e.apply(this,arguments)}return t})(),a.$5=function(){this.$3.onOrBefore(this.$2*1e3)},a.$4=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=Array.from(this.$1.values());this.$1.clear(),yield o("WAWebApiChatThreadLoggingPendingEvents").createOrUpdateChatEvents(e)});function t(){return e.apply(this,arguments)}return t})(),a.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebApiChat").bulkGetChats(e.map(function(e){return o("WAWebWidFactory").createWid(e.chatId)})),a=t.then(function(e){return D(e)}),i=t.then(function(e){return x(e)}),l=t.then(function(e){return $(e)}),s=t.then(function(e){return N(e)}),u=t.then(function(e){return M(e)}),c=t.then(P),p=yield(m||(m=n("Promise"))).all([t,a,i,l,c,s,u]),_=p[0],f=p[1],g=p[2],h=p[3],y=p[4],C=p[5],b=p[6],v=yield m.all([o("WAWebChatThreadLoggingUtils").getMeHasUsername(),o("WAWebChatThreadLoggingUtils").getMeHasUsernamePin()]),S=v[0],R=v[1],L=e.length,E={chatRows:_.length,starredCounts:f.length,isABusiness:g.length,groupMetadataRows:h.length,groupParticipantsRows:y.length,businessProfileRows:C.length,contactFromChatRows:b.length};for(var k of Object.entries(E)){var I=k[0],T=k[1];T!==L&&o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStore: Array length mismatch in "," (expected ",", got ",")"])),I,L,T).sendLogs("chatThreadLoggingEventStore-array-length-mismatch-"+I)}return m.all(e.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a,i,l,s,u,c,d=_[t],m=r("WAWebWid").isGroup(e.chatId),p=h[t],v=o("WAWebBotTypes").BizBotAutomatedType.cast((n=C[t])==null?void 0:n.automatedType),L=m?{isAGroup:m,groupSize:(a=(i=y[t])==null||(i=i.participants)==null?void 0:i.length)!=null?a:1,groupType:p==null?o("WAWebGroupType").GroupType.DEFAULT:o("WAWebGroupType").getGroupTypeFromGroupMetadata(p)}:{isAGroup:m,isAContact:yield o("WAWebApiContact").isAddressBookContact(e.chatId),automatedType:v},E=o("WAWebWidFactory").createWid(e.chatId),k=((l=d==null?void 0:d.pin)!=null?l:0)>0,I=(s=d==null?void 0:d.archive)!=null?s:!1,T=f[t],D=(u=d==null?void 0:d.unreadCount)!=null?u:0,x=((c=d==null?void 0:d.muteExpiration)!=null?c:0)!==0,$=g[t]?yield o("WAWebChatThreadLoggingUtils").getBizCatalogType(E):null,P=r("WAWebWid").isStringLid(e.chatId)||(p==null?void 0:p.defaultSubgroup)===!0,N=o("WAWebUserPrefsMeUser").isMeAccount(E),M=E.isBot(),w=o("WAWebChatThreadLoggingUtils").getWamDisappearingModeInitiatedByMe(d==null?void 0:d.disappearingModeInitiatedByMe),A=o("WAWebChatThreadLoggingUtils").getWamDisappearingModeTrigger(d==null?void 0:d.disappearingModeTrigger);o("WAWebABProps").getABPropConfigValue("dm_initiator_trigger_groups")&&r("WAWebWid").isGroup(d==null?void 0:d.id)&&(w=o("WAWebChatThreadLoggingUtils").getWamDisappearingModeInitiatedByMe(p==null?void 0:p.disappearingModeInitiatedByMe),A=o("WAWebChatThreadLoggingUtils").getWamDisappearingModeTriggerGroups(p==null?void 0:p.disappearingModeTrigger));var F=S,O=R,B=null,W=!1,q=b[t];if(q!=null){var U=o("WAWebWidFactory").createWid(q.id);B=o("WAWebChatThreadLoggingUtils").getOppositeVisibleIdentificationType(q,U.isLid()?"lid":"pn");var V=o("WAWebLidMigrationUtils").toPn(U)!=null,H=r("isStringNullOrEmpty")(q==null?void 0:q.username);W=!V&&H}var G=o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE.OTHERS;if(E.isLid()&&(G=o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE.LID_CTWA),d!=null&&d.lidOriginType)switch(d==null?void 0:d.lidOriginType){case o("WAWebUsernameTypes").LidOriginType.PNH_CTWA:G=o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE.LID_CTWA;break;case o("WAWebUsernameTypes").LidOriginType.GENERAL:G=o("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE.OTHERS;break}return babelHelpers.extends({},e,{isPinned:k,isArchived:I,contactInfo:L,messagesStarred:T,messagesUnread:D,isMuted:x,bizCatalogType:$,isPnhEnabledChat:P,isMessageYourself:N,isUserAgent:M,ephemeralityInitiator:w,ephemeralityTriggerAction:A,hasUsername:F,hasUsernamePin:O,oppositeVisibleIdentification:B,isUsernameThread:W,chatOrigins:G})});return function(t,n){return e.apply(this,arguments)}})()));function D(e){return(m||(m=n("Promise"))).all(e.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return e==null?0:(yield o("WAWebDBGetStarredMessagesForChat").getStarredMessagesForChat(o("WAWebWidFactory").createWid(e.id),Number.MAX_SAFE_INTEGER)).length});return function(t){return e.apply(this,arguments)}})()))}function x(e){return o("WAWebDBBulkGetIsContactABusiness").bulkGetIsContactABusiness(e.map(function(e){return e==null?null:o("WAWebWidFactory").createWid(e.id)}))}function $(e){return o("WAWebDBGroupsGroupMetadata").bulkGetGroupMetadata(e.map(function(e){return e==null?null:o("WAWebWidFactory").createWid(e.id)}))}function P(e){return o("WAWebSchemaParticipant").getParticipantTable().bulkGet(e.map(function(e){return e==null?"":o("WAWebWidFactory").createWid(e.id).toString()}))}function N(e){return o("WAWebSchemaBusinessProfile").getBusinessProfileTable().bulkGet(e.map(function(e){return e==null?"":o("WAWebWidFactory").createWid(e.id).toString()}))}function M(e){return r("WAWebLidAwareContactsDB").bulkGet(e.map(function(e){if(e==null)return"";var t=o("WAWebWidFactory").createWid(e.id);if(!t.isRegularUser())return"";if(!t.isLid())return t.toJid();var n=o("WAWebApiContact").getPhoneNumber(t);return n==null?t.toJid():""}))}});function t(t){return e.apply(this,arguments)}return t})(),a.getEvent=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){this.$1.size>0&&(yield this.$4());var n=yield o("WAWebApiChatThreadLoggingPendingEvents").getChatEvent(e,t);return n==null?null:(yield this.$6([n]))[0]});function t(t,n){return e.apply(this,arguments)}return t})(),a.getBeforeInclusive=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return this.$1.size>0&&(yield this.$4()),this.$6(yield o("WAWebApiChatThreadLoggingPendingEvents").getBeforeInclusive(e))});function t(t){return e.apply(this,arguments)}return t})(),a.deleteBeforeInclusive=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return this.$1.size>0&&(yield this.$4()),o("WAWebApiChatThreadLoggingPendingEvents").deleteBeforeInclusive(e)});function t(t){return e.apply(this,arguments)}return t})(),t})();l.ChatThreadLoggingEventStoreImpl=_}),98);
__d("WAWebDBMarkAsReadForTable",["WAWebModelStorageUtils","WAWebMsgKey","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return o("WAWebModelStorageUtils").getStorage().lock([e],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],o=yield n.anyOf(["msgKey"],t);return o.length!==0&&(yield n.bulkCreateOrReplace(o.map(function(e){return babelHelpers.extends({},e,{read:!0})}))),o.map(function(e){var t=e.msgKey;return r("WAWebMsgKey").from(t)})});return function(t){return e.apply(this,arguments)}})())}l.markAsReadForTable=e}),98);
__d("WAWebDBUpdateAddOnAcksForTable",["WANullthrows","WAWebModelStorageUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t,a){return o("WAWebModelStorageUtils").getStorage().lock([e],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],o=[],i=new Map;for(var l of t){var s=l.msgKey.toString();o.push(s),i.set(l.msgKey.toString(),l)}var u=yield n.anyOf(["msgKey"],o,{shouldDecrypt:!1}),c=[],d=[];for(var m of u){var p=r("WANullthrows")(i.get(m.msgKey));if(a(m,p)){var _=babelHelpers.extends({},m,{ack:p.ack});c.push(_),d.push(p)}}return yield n.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(c),d});return function(t){return e.apply(this,arguments)}})())}l.updateAddOnAcksForTable=e}),98);
__d("WAWebMessageAddOnType",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({Reaction:"reaction",ReactionEnc:"reaction_enc",PollVote:"poll_vote",KeepInChat:"keep_in_chat",MessageEdit:"message_edit",PinMessage:"pin_message",Comment:"comment",Unknown:"unknown"});i.MessageAddOnType=e}),66);
__d("WAWebDBCommentAddOnProvider",["Promise","WAWebDBMarkAsReadForTable","WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s={type:o("WAWebMessageAddOnType").MessageAddOnType.Comment,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.COMMENT},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.COMMENT},canRenderInUi:function(){return!0},processOrphansForNewMsg:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){return(e||(e=n("Promise"))).resolve()});function r(e,n){return t.apply(this,arguments)}return r})(),updateAcks:function(t,n){return o("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("comments",t,n)},markAsRead:function(t){return o("WAWebDBMarkAsReadForTable").markAsReadForTable("comments",t.map(String))}};l.commentsAddOnProvider=s}),98);
__d("WAWebEphemeralKeepInChatUtils",["WAWebBackendApi","WAWebEphemeralConstants","WAWebLidMigrationUtils","WAWebMsgGetters","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){return e!=null&&e===o("WAWebProtobufsE2E.pb").KeepType.KEEP_FOR_ALL?o("WAWebEphemeralConstants").KeepInChatState.KEPT:e!=null&&e===o("WAWebProtobufsE2E.pb").KeepType.UNDO_KEEP_FOR_ALL?o("WAWebEphemeralConstants").KeepInChatState.UNKEPT:null}function s(e){return e===o("WAWebEphemeralConstants").KeepInChatState.KEPT?o("WAWebProtobufsE2E.pb").KeepType.KEEP_FOR_ALL:e===o("WAWebEphemeralConstants").KeepInChatState.UNKEPT?o("WAWebProtobufsE2E.pb").KeepType.UNDO_KEEP_FOR_ALL:o("WAWebProtobufsE2E.pb").KeepType.UNKNOWN}function u(e){return e===o("WAWebEphemeralConstants").KeepInChatState.KEPT}function c(e){return e===o("WAWebEphemeralConstants").KeepInChatState.UNKEPT}function d(e){var t,n;return e.forEach(function(e){(!t||m(e,t)===1)&&(n=t,t=e)}),n!=null&&o("WAWebBackendApi").frontendFireAndForget("logTieBreakIgnoredKicWam",{keepInChatMessage:n}),t}function m(e,t){return e.senderTimestampMs==null?-1:t.senderTimestampMs==null||e.senderTimestampMs>t.senderTimestampMs||e.senderTimestampMs===t.senderTimestampMs&&e.id.id>t.id.id?1:-1}function p(e){if(e.kicKey!=null){var t,n,r,a=o("WAWebMsgGetters").getIsGroupMsg(e);if(((t=e.kicKey)==null?void 0:t.fromMe)===!0)return o("WAWebUserPrefsMeUser").getMaybeMePnUser();if(a&&((n=e.kicKey)==null?void 0:n.participant)!=null)return o("WAWebWidFactory").asUserWidOrThrow(e.kicKey.participant);if(!a&&((r=e.kicKey)==null?void 0:r.remote)!=null)return o("WAWebWidFactory").asUserWidOrThrow(e.kicKey.remote)}}function _(e){return c(e.kicState)&&r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(p(e),o("WAWebMsgGetters").getSender(e)))}l.parseKeepTypeToKicState=e,l.kicStateToKeepType=s,l.isKept=u,l.runKeepInChatTieBreaker=d,l.compareKeepInChatMessages=m,l.kicSenderSuperPowerActive=_}),98);
__d("WAWebMsgDataFromModel",[],(function(t,n,r,o,a,i){function e(t){var n=t.toJSON();return babelHelpers.extends({},n,{paymentNoteMsg:n.paymentNoteMsg?e(n.paymentNoteMsg):void 0})}i.msgDataFromMsgModel=e}),66);
__d("WAWebDBKeepInChatAddOnProvider",["WALogger","WAWebBackendApi","WAWebEphemeralKeepInChatUtils","WAWebMessageAddOnType","WAWebMsgDataFromModel","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s={type:o("WAWebMessageAddOnType").MessageAddOnType.KeepInChat,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT},canRenderInUi:function(){return!0},processOrphansForNewMsg:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=n.map(function(e){return e.parsedMsgPayload}),a=o("WAWebEphemeralKeepInChatUtils").runKeepInChatTieBreaker(r);if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["keepInChatAddOnProvider: found orphan"]))),a!=null){var i=o("WAWebMsgDataFromModel").msgDataFromMsgModel(a);yield o("WAWebBackendApi").frontendSendAndReceive("processKeepInChatMessage",{keepInChatMessage:i,allowNotification:!1})}});function r(e,n){return t.apply(this,arguments)}return r})()};l.keepInChatAddOnProvider=s}),98);
__d("WAWebDBReactionsAddOnProvider",["WAWebDBMarkAsReadForTable","WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAddOnType").MessageAddOnType.Reaction,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.REACTION},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.REACTION},canRenderInUi:function(){return!0},processOrphansForNewMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw r("err")("Reactions not yet integrated into orphan framework")});function t(){return e.apply(this,arguments)}return t})(),updateAcks:function(t,n){return o("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("reactions",t,n)},markAsRead:function(t){return o("WAWebDBMarkAsReadForTable").markAsReadForTable("reactions",t.map(String))}};l.reactionsAddOnProvider=e}),98);
__d("WAWebDBReactionsEncAddOnProvider",["WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAddOnType").MessageAddOnType.ReactionEnc,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.REACTION_ENC},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.REACTION_ENC},canRenderInUi:function(){return!0},processOrphansForNewMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw r("err")("Reactions provider is deprecated")});function t(){return e.apply(this,arguments)}return t})()};l.reactionsEncAddOnProvider=e}),98);
__d("WAWebDBAddOnProviders",["WAWebDBCommentAddOnProvider","WAWebDBKeepInChatAddOnProvider","WAWebDBMessageEditAddOnProvider","WAWebDBPinInChatAddOnProvider","WAWebDBPollVotesAddOnProvider","WAWebDBReactionsAddOnProvider","WAWebDBReactionsEncAddOnProvider"],(function(t,n,r,o,a,i,l){var e=[o("WAWebDBPollVotesAddOnProvider").pollVotesAddOnProvider,o("WAWebDBKeepInChatAddOnProvider").keepInChatAddOnProvider,o("WAWebDBReactionsAddOnProvider").reactionsAddOnProvider,o("WAWebDBReactionsEncAddOnProvider").reactionsEncAddOnProvider,o("WAWebDBMessageEditAddOnProvider").messageEditAddOnProvider,o("WAWebDBPinInChatAddOnProvider").pinInChatAddOnProvider,o("WAWebDBCommentAddOnProvider").commentsAddOnProvider];function s(t){var n;return(n=e.find(function(e){return e.type===t}))!=null?n:null}function u(t){return e.find(function(e){return e.matches(t)})}function c(t){return e.find(function(e){return e.matchesFutureproof(t)})}l.addOnProviders=e,l.getProviderForAddOnType=s,l.getAddOnProviderForMsg=u,l.getAddOnProviderForFutureproofMsg=c}),98);
__d("WAWebMessageEditUtils",["$InternalEnum","WATimeUtils","WAWebABProps","WAWebMsgType","WAWebWid"],(function(t,n,r,o,a,i,l){var e,s=2592e3;function u(e){if(e)return s;var t=o("WAWebABProps").getABPropConfigValue("message_edit_window_duration_seconds");return t==null||t<=0?1200:t}function c(e){if(e)return s;var t=o("WAWebABProps").getABPropConfigValue("message_edit_client_entry_point_limit_seconds");return t==null||t<=0?900:t}var d=n("$InternalEnum").Mirrored(["TextEdit","CaptionEdit","EventEdit","RichResponseEdit","LoadingMediaEdit"]);function m(e){switch(e){case o("WAWebMsgType").MSG_TYPE.CHAT:return d.TextEdit;case o("WAWebMsgType").MSG_TYPE.IMAGE:case o("WAWebMsgType").MSG_TYPE.VIDEO:case o("WAWebMsgType").MSG_TYPE.DOCUMENT:return d.CaptionEdit;case o("WAWebMsgType").MSG_TYPE.EVENT_CREATION:return d.EventEdit;case o("WAWebMsgType").MSG_TYPE.RICH_RESPONSE:return d.RichResponseEdit;case o("WAWebMsgType").MSG_TYPE.LOADING_MEDIA:return d.LoadingMediaEdit;default:return null}}var p=[(e=o("WAWebMsgType")).MSG_TYPE.CHAT,e.MSG_TYPE.IMAGE,e.MSG_TYPE.VIDEO,e.MSG_TYPE.DOCUMENT,e.MSG_TYPE.EVENT_CREATION,e.MSG_TYPE.RICH_RESPONSE,e.MSG_TYPE.LOADING_MEDIA];function _(e){return!!p.includes(e)}function f(e){var t=e.editTsInSeconds,n=e.msgKey,a=e.parentTsInSeconds,i=r("WAWebWid").isNewsletter(n.remote);return t!=null?t<a+u(i):o("WATimeUtils").unixTime()<a+u(i)}function g(e){var t=e.msgKey,n=e.parentTsInSeconds;return o("WATimeUtils").unixTime()<n+c(r("WAWebWid").isNewsletter(t.remote))}l.getMessageEditProcessingWindowDurationSeconds=u,l.MsgEditType=d,l.getMsgEditType=m,l.msgTypeSupportsEditing=_,l.isParentWithinEditProcessingWindow=f,l.isParentWithinEditUIWindow=g}),98);
__d("WAWebDBMessageEditAddOnProvider",["WAWebDBProcessEditProtocolMsgs","WAWebMessageAddOnType","WAWebMessageEditUtils","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAddOnType").MessageAddOnType.MessageEdit,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.PROTOCOL&&t.subtype==="message_edit"},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.PROTOCOL&&t.futureproofSubtype==="message_edit"},canRenderInUi:function(t){var e=t.editMsgType?o("WAWebMessageEditUtils").getMsgEditType(t.editMsgType):o("WAWebMessageEditUtils").MsgEditType.TextEdit;if(!e)return!1;switch(e){case o("WAWebMessageEditUtils").MsgEditType.EventEdit:return!1;case o("WAWebMessageEditUtils").MsgEditType.CaptionEdit:case o("WAWebMessageEditUtils").MsgEditType.TextEdit:case o("WAWebMessageEditUtils").MsgEditType.RichResponseEdit:case o("WAWebMessageEditUtils").MsgEditType.LoadingMediaEdit:return!0}},processOrphansForNewMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r=yield o("WAWebDBProcessEditProtocolMsgs").processEditProtocolMsgs(t.map(function(e){return e.parsedMsgPayload})),a=(n=r.find(function(t){return t.parentMsg.id.equals(e.id)}))==null?void 0:n.editedMsgData;a&&Object.assign(e,a)});function t(t,n){return e.apply(this,arguments)}return t})()};l.messageEditAddOnProvider=e}),98);
__d("WAWebPinMsgGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("pinned_messages_m1_receiver")}function s(){return o("WAWebABProps").getABPropConfigValue("pinned_messages_m1_sender")}function u(){return o("WAWebABProps").getABPropConfigValue("pinned_messages_m2")}function c(){return u()?o("WAWebABProps").getABPropConfigValue("pinned_messages_m2_pin_max"):1}l.isPinnedMessagesM1ReceiverEnabled=e,l.isPinnedMessagesM1SenderEnabled=s,l.isPinnedMessagesM2Enabled=u,l.getMaxPins=c}),98);
__d("WAWebDBPinInChatAddOnProvider",["WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","WAWebPinMessageProcessor","WAWebPinMsgGatingUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAddOnType").MessageAddOnType.PinMessage,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE},canRenderInUi:function(){return o("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled()},processOrphansForNewMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.map(function(e){return e.parsedMsgPayload});yield o("WAWebPinMessageProcessor").processPinMessages(e.id.remote,n)});function t(t,n){return e.apply(this,arguments)}return t})(),updateAcks:function(t,n){return o("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("pinned-messages",t,n)}};l.pinInChatAddOnProvider=e}),98);
__d("WAWebDBPollVotesAddOnProvider",["WAWebDBMarkAsReadForTable","WAWebDBProcessPollUpdateMsgs","WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAddOnType").MessageAddOnType.PollVote,matches:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&t.subtype==="poll_vote"},matchesFutureproof:function(t){return t.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&t.futureproofType===o("WAWebMsgType").MSG_TYPE.POLL_UPDATE},canRenderInUi:function(){return!0},processOrphansForNewMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=new Map;for(var a of t)n.set(a.msgKey,a);var i=yield o("WAWebDBProcessPollUpdateMsgs").processPollUpdateMsgs(t.map(function(e){var t=e.parsedMsgPayload;if(t.type===o("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&t.addonEncrypted)return t;throw r("err")("Invalid poll vote orphan type")}));return i.map(function(e){var t,r,o=e.read||((t=(r=n.get(e.msgKey.toString()))==null?void 0:r.read)!=null?t:!1);return e.read===o?e:babelHelpers.extends({},e,{read:o})})});function t(t,n){return e.apply(this,arguments)}return t})(),updateAcks:function(t,n){return o("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("poll-votes",t,n)},markAsRead:function(t){return o("WAWebDBMarkAsReadForTable").markAsReadForTable("poll-votes",t.map(String))}};l.pollVotesAddOnProvider=e}),98);
__d("WAWebDBUpdateLastAddOnPreviewChat",["WAWebApiChat"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebApiChat").bulkUpdateChatLastAddOnPreview(e)}l.updateDatabaseForLastAddOnPreview=e}),98);
__d("WAWebDBContactRemoveSoftDeletedUsernames",["WALogger","WAWebLidAwareContactsDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.map(function(e){return e.toJid()}),a=yield r("WAWebLidAwareContactsDB").bulkGet(n),i=0,l=a.reduce(function(e,t){return t==null?(i++,e):(t.username!=null&&t.usernameSoftDeleted===!0&&e.push(t.id),e)},[]);i>0&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["removeSoftDeletedUsernames: "," missing contacts"])),i),l.length>0&&(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["removeSoftDeletedUsernames: removing soft deleted usernames for "," LIDs"])),l.length),yield r("WAWebLidAwareContactsDB").bulkCreateOrMerge(l.map(function(e){return{id:e,username:void 0,usernameSoftDeleted:void 0}}),"DBContactRemoveSoftDeletedUsernames.removeSoftDeletedUsernames"))}),c.apply(this,arguments)}l.removeSoftDeletedUsernames=u}),98);
__d("WAWebDynamicThrottlingManager",[],(function(t,n,r,o,a,i){var e=(function(){function e(e,t){if(t===void 0&&(t=.2),t<=1e-5||t>=.8){var n=new Error("newValueRatio should be between 0.00001 and 0.8");throw n.stack,n}this.average=e,this.lastValue=e,this.newValueRatio=t}var t=e.prototype;return t.addObservation=function(t){this.average=this.average*(1-this.newValueRatio)+t*this.newValueRatio,this.lastValue=t},e})(),l=(function(){function t(n){var r,o,a,i,l;this.targetTimeMs=(r=n==null?void 0:n.targetTimeMs)!=null?r:t.DEFAULT_TARGET_TIME_MS,this.maxDelayTimeMs=(o=n==null?void 0:n.maxDelayTimeMs)!=null?o:t.DEFAULT_MAX_DELAY_TIME_MS,this.minBatchSize=(a=n==null?void 0:n.minBatchSize)!=null?a:t.DEFAULT_MIN_BATCH_SIZE,this.maxBatchSize=(i=n==null?void 0:n.maxBatchSize)!=null?i:t.DEFAULT_MAX_BATCH_SIZE,this.defaultBatchSize=(l=n==null?void 0:n.defaultBatchSize)!=null?l:t.DEFAULT_BATCH_SIZE,this.batchSize=this.defaultBatchSize,this.averageTotalTime=new e(this.targetTimeMs/1e3,.2)}var n=t.prototype;return n.getThrottleRate=function(){var e=this.getTotalTimeSeconds()*.5,t=Math.min(e,this.maxDelayTimeMs/1e3);return{batchSize:this.batchSize,delayMs:t*1e3}},n.setLastProcessTime=function(t,n){var e=t/1e3;this.averageTotalTime.addObservation(e);var r=this.targetTimeMs/1e3,o=this.getTotalTimeSeconds();o<r?o<r*.5?this.batchSize=this.batchSize>20?Math.floor(this.batchSize*1.2):this.batchSize+2:this.batchSize=this.batchSize>20?Math.floor(this.batchSize*1.1):this.batchSize+1:o>r*2?this.batchSize=this.batchSize>20?Math.floor(this.batchSize*.8):this.batchSize-2:this.batchSize=this.batchSize>20?Math.floor(this.batchSize*.9):this.batchSize-1,this.batchSize=Math.max(this.minBatchSize,Math.min(this.batchSize,this.maxBatchSize))},n.getTotalTimeSeconds=function(){return Math.max(this.averageTotalTime.average,this.averageTotalTime.lastValue)},n.reset=function(){this.batchSize=this.defaultBatchSize,this.averageTotalTime=new e(this.targetTimeMs/1e3,.2)},n.getMetrics=function(){return{batchSize:this.batchSize,avgTotalTimeMs:this.averageTotalTime.average*1e3,lastTotalTimeMs:this.averageTotalTime.lastValue*1e3}},t})();l.DEFAULT_TARGET_TIME_MS=400,l.DEFAULT_MAX_DELAY_TIME_MS=3e3,l.DEFAULT_MIN_BATCH_SIZE=1,l.DEFAULT_MAX_BATCH_SIZE=500,l.DEFAULT_BATCH_SIZE=50,i.DynamicThrottlingManager=l}),66);
__d("WAWebRunInBatches",["Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){var e;function l(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,o){for(var a,i,l=(a=o==null?void 0:o.batchSize)!=null?a:1e3,s=(i=o==null?void 0:o.delayMs)!=null?i:0,u=0;u<t.length;u+=l){var c;if(o!=null&&(c=o.abortController)!=null&&c.signal.aborted)return;var d=t.slice(u,u+l);yield r(d),yield new(e||(e=n("Promise")))(function(e){return self.setTimeout(e,s)})}}),s.apply(this,arguments)}i.runInBatches=l}),66);
__d("WAWebDBCreateLidPnMappings",["Promise","WAAsyncSleep","WALogger","WATimeUtils","WAWebABProps","WAWebApiContact","WAWebBackendApi","WAWebContactsDbLidMigrationUtils","WAWebDBContactRemoveSoftDeletedUsernames","WAWebDynamicThrottlingManager","WAWebEnvironment","WAWebIdentityChangeApi","WAWebRunInBatches","WAWebSchemaContact_DO_NOT_USE_DIRECTLY","WAWebUsernameGatingUtils","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f=new(o("WAWebDynamicThrottlingManager")).DynamicThrottlingManager({targetTimeMs:100,maxDelayTimeMs:1e3,minBatchSize:5,maxBatchSize:300,defaultBatchSize:30});function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.flushImmediately,n=e.identityChangeHandlingEnabled,a=e.learningSource,i=e.mappings;o("WAWebABProps").getABPropConfigValue("wa_web_history_sync_dynamic_throttling")?yield y({mappings:i,flushImmediately:t,identityChangeHandlingEnabled:n,learningSource:a}):r("WAWebEnvironment").isWindows?yield o("WAWebRunInBatches").runInBatches(i,function(e){return b({mappings:e,flushImmediately:t,identityChangeHandlingEnabled:n,learningSource:a})}):yield b({mappings:i,flushImmediately:t,identityChangeHandlingEnabled:n,learningSource:a})}),h.apply(this,arguments)}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.flushImmediately,n=e.identityChangeHandlingEnabled,r=e.learningSource,a=e.mappings;if(a.length!==0)for(var i=0;i<a.length;){var l=f.getThrottleRate(),s=Math.min(l.batchSize,a.length-i),u=a.slice(i,i+s),c=self.performance.now();yield b({mappings:u,flushImmediately:t,identityChangeHandlingEnabled:n,learningSource:r});var d=self.performance.now()-c;f.setLastProcessTime(d,u.length),l.delayMs>0&&(yield o("WAAsyncSleep").asyncSleep(l.delayMs)),i+=s}}),C.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.flushImmediately,r=e.identityChangeHandlingEnabled,a=e.learningSource,i=e.mappings,l=r!=null?r:!0,s=[],d=[],m=new Map(i.map(function(e){return[e.pn,e.lid]})),p=o("WATimeUtils").unixTime(),f=o("WATimeUtils").castToUnixTime(0),g=[],h=new Set;i.forEach(function(e){var n=e.lid,r=e.pn,i=o("WAWebApiContact").lidPnCache.getCurrentLid(r),u=o("WAWebApiContact").lidPnCache.getPhoneNumber(n),c=u==null,_=!c,y=(i==null?void 0:i.equals(n))===!0,C=_&&!y,b,v;switch(a){case"usync":b=!1,v=c||C;break;case"peer-pn-message":case"recipient-latest-lid":case"peer-lid-message":case"migration-sync-latest":case"migration-sync-old":case"blocklist-active":case"blocklist-inactive":b=!1,v=!y;break;default:b=C,v=c}if(v){i!=null&&l&&g.push(o("WAWebIdentityChangeApi").handleNewIdentity(r,!t));var S;a==="migration-sync-old"||a==="blocklist-inactive"?S=!0:S=m.get(r)!==n;var R=S?f:p;o("WAWebApiContact").warmUpLidPnMapping(n,r,R),s.push({lid:n.toString(),phoneNumber:r.toString()}),t?d.push({lid:n,pn:r,phoneNumberCreatedAt:R}):o("WAWebApiContact").lidPnCacheDirtySet.add(n.toString())}b&&h.add(r)}),t&&o("WAWebApiContact").lidPnCacheDirtySet.size>0&&k(d);var y=g.length>0?(_||(_=n("Promise"))).all(g).then(function(e){var t=0;for(var n of e){var r,i;t+=(r=n==null||(i=n.notifications)==null?void 0:i.length)!=null?r:0}o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["createLidPnMappings: "," identity change notifications generated, source ",""])),t,a)}):(_||(_=n("Promise"))).resolve();h.size!==0&&(o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["createLidPnMappings: "," contacts requiring usync, source ",""])),h.size,a),o("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("syncContactListJob",{contactIds:Array.from(h),shouldSyncDevice:!1,mode:"query"}));var C=[y];d.length>0&&C.push(I(d)),yield(_||(_=n("Promise"))).all(C),s.length>0&&(yield o("WAWebBackendApi").frontendSendAndReceive("bulkUpdatePhoneNumberJids",{lidPhoneNumberMappings:s}))}),v.apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{var t=yield o("WAWebSchemaContact_DO_NOT_USE_DIRECTLY").getContactTable().bulkGet(e);return new Map(t.filter(Boolean).map(function(e){return[e.id,e]}))}catch(e){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["getPnRowData failed! ",""])),r("getErrorSafe")(e).stack)}return new Map}),R.apply(this,arguments)}function L(){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var e=[];k(e),yield I(e)}catch(e){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["flushLidPnMappingsToDb failed!"]))).sendLogs("Failed to flushLidPnMappingsToDb")}}),E.apply(this,arguments)}function k(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["flush lidPnCacheDirtySet: get dirty updates for ",""])),Array.from(o("WAWebApiContact").lidPnCacheDirtySet).join(",")),o("WAWebApiContact").lidPnCacheDirtySet.forEach(function(e){var n=o("WAWebWidFactory").createUserLidOrThrow(e),r=o("WAWebApiContact").lidPnCache.getLidEntry(n);r!=null&&t.push({lid:n,pn:r.phoneNumber,phoneNumberCreatedAt:o("WATimeUtils").castToUnixTime(r.phoneNumberCreatedAt)})}),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["lidPnCacheDirtySet: "," flushed"])),o("WAWebApiContact").lidPnCacheDirtySet.size),o("WAWebApiContact").lidPnCacheDirtySet.clear()}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0){var t=yield S(e.map(function(e){var t=e.pn;return t.toJid()})),n=e.map(function(e){var n=e.lid,r=e.phoneNumberCreatedAt,a=e.pn,i=t.get(a.toJid());return babelHelpers.extends({id:n.toString(),phoneNumber:a.toString(),phoneNumberCreatedAt:r},i?o("WAWebContactsDbLidMigrationUtils").createContactLidRowFromPnRow(n,i):{contactHash:o("WAWebApiContact").getContactHash(n.toJid())})});o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["flushLidPnMappingsToDbImpl: "," records to update"])),n.length),yield o("WAWebSchemaContact_DO_NOT_USE_DIRECTLY").getContactTable().bulkCreateOrMerge(n),o("WAWebUsernameGatingUtils").usernameDisplayedEnabled()&&(yield o("WAWebDBContactRemoveSoftDeletedUsernames").removeSoftDeletedUsernames(e.map(function(e){var t=e.lid;return t})))}}),T.apply(this,arguments)}l.createLidPnMappingsInBatches=g,l.createLidPnMappings=b,l.flushLidPnMappingsToDb=L}),98);
__d("WAWebDBStoreMessageOrphans",["WALogger","WAWebDBAddOnProviders","WAWebDBMessageSerialization","WAWebMessageAddOnType","WAWebMsgGetters","WAWebSchemaMessageOrphans","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["storeMessageOrphans:"])));var a=t.map(function(e){var t,a;return babelHelpers.extends({msgKey:e.id.toString(),parentMsgKey:n(e).toString(),sender:o("WAWebMsgGetters").getSender(e).toString(),parsedMsgPayload:o("WAWebDBMessageSerialization").dbRowFromMessage(babelHelpers.extends({},e),r),type:(t=(a=o("WAWebDBAddOnProviders").addOnProviders.find(function(t){return t.matches(e)}))==null?void 0:a.type)!=null?t:o("WAWebMessageAddOnType").MessageAddOnType.Unknown,senderTimestampMs:e.senderTimestampMs,t:e.t},(r==null?void 0:r.storeReportingInfo)===!0&&e.reportingTokenInfo!=null&&{reportingTokenInfo:e.reportingTokenInfo})});yield o("WAWebSchemaMessageOrphans").getMessageOrphanTable().bulkCreateOrReplace(a)}),u.apply(this,arguments)}l.storeMessageOrphans=s}),98);
__d("WAWebEphemeralityUtils",["WAWebEphemeralityTypes","WAWebProtobufsE2E.pb","gkx","justknobx"],(function(t,n,r,o,a,i,l){function e(e){switch(e){case o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings:return 1;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange:return 3;default:return null}}function s(e,t){return t==null?e>0?1:null:e===t?2:1}function u(e){switch(e){case 1:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings;case 2:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings;case 3:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange;default:return null}}function c(e){switch(e){case"1":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings;case"2":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings;case"3":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange;default:return null}}function d(e){switch(e){case"chat_settings":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings;case"account_settings":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings;case"bulk_change":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange;case"biz_supports_fb_hosting":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BizSupportFbHosting;case"unknown_groups":return o("WAWebEphemeralityTypes").DisappearingModeTrigger.UnknownGroups;case"unknown":default:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown}}function m(e){switch(e){case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.CHAT_SETTING:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.ACCOUNT_SETTING:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BULK_CHANGE:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BIZ_SUPPORTS_FB_HOSTING:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BizSupportFbHosting;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN_GROUPS:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.UnknownGroups;default:return}}function p(e){return e.isEphemeralityDisabled===!0&&(!r("justknobx")._("5335")||!r("gkx")("26258"))}l.getGroupEphemeralTrigger=e,l.getEphemeralTriggerForGroupCreation=s,l.getDisappearingModeTrigger=u,l.getDisappearingModeTriggerString=c,l.getDisappearingModeTriggerFromString=d,l.getDisappearingModeTriggerFromProtobuf=m,l.isEphemeralityDisabledForMessagingWithContact=p}),98);
__d("WAWebDBEphemeralMessage",["Promise","WALogger","WATimeUtils","WAWebAppTracker","WAWebDBMessageDelete","WAWebEphemeralKeepInChatUtils","WAWebEphemeralityUtils","WAWebLidAwareContactsDB","WAWebLidMigrationUtils","WAWebMsgKey","WAWebSchemaMessage","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredMessages started"]))).tags("ephemeral-messages");var t=yield o("WAWebSchemaMessage").getMessageTable().lessThan(["expiredTimestamp"],o("WATimeUtils").unixTime(),{shouldDecrypt:!1}),n=t.filter(function(e){return!o("WAWebEphemeralKeepInChatUtils").isKept(e.kicState)});return n.length===0?[]:(o("WAWebAppTracker").AppTracker.start(o("WAWebAppTracker").AppTrackerType.PurgeEphemeral),yield o("WAWebDBMessageDelete").removeMessagesFromHistory(n.map(function(e){return e.id.toString()})).finally(function(){return o("WAWebAppTracker").AppTracker.stop(o("WAWebAppTracker").AppTrackerType.PurgeEphemeral)}),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredMessages completed"]))).tags("ephemeral-messages"),n)}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0)return o("WAWebAppTracker").AppTracker.start(o("WAWebAppTracker").AppTrackerType.PurgeEphemeral),o("WAWebDBMessageDelete").removeMessagesFromHistory(e.map(function(e){return e.id.toString()})).finally(function(){return o("WAWebAppTracker").AppTracker.stop(o("WAWebAppTracker").AppTrackerType.PurgeEphemeral)})}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.contactId,a=e.messageId,i=yield(c||(c=n("Promise"))).all([o("WAWebSchemaMessage").getMessageTable().get(a),r("WAWebLidAwareContactsDB").get(t)]),l=i[0],s=i[1];if(!(l==null||s==null)){var d=r("WAWebMsgKey").fromString(a);if(!d.fromMe&&!(!d.remote.isRegularUser()||d.participant!=null)){var m=o("WAWebWidFactory").createWid(t),p=o("WAWebLidMigrationUtils").toCommonAddressingMode(d.remote,m),_=p[0],f=p[1];if(r("WAWebWid").equals(_,f)&&o("WAWebEphemeralityUtils").isEphemeralityDisabledForMessagingWithContact(s)){var g=l.ephemeralDuration!=null&&l.ephemeralDuration>0,h=l.expiredTimestamp!=null;!g&&!h||(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["convertMessageNotEphemeralForContactWithEphmeralityDisabled: ephemerality disabled for a message"]))),yield o("WAWebSchemaMessage").getMessageTable().merge(a,{ephemeralDuration:0,ephemeralStartTimestamp:void 0,ephemeralSettingTimestamp:void 0,ephemeralOutOfSync:void 0,expiredTimestamp:void 0,ephemeralSettingUser:void 0}))}}}}),g.apply(this,arguments)}l.pruneExpiredMessages=d,l.removeExpiredMessagesFromHistory=p,l.convertMessageNotEphemeralForContactWithEphmeralityDisabled=f}),98);
__d("WAWebDBChatValidation",["WALogger","WAWebWid"],(function(t,n,r,o,a,i,l){var e;function s(t,n){if(t.accountLid!=null&&!r("WAWebWid").isStringLid(t.accountLid)){var a;o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",": accountLid is not a valid Lid. chatId: ",", accountLid: ",""])),n,(a=t.id)!=null?a:"unknown",t.accountLid).sendLogs("chat-table-invalid-account-lid")}}function u(e,t){for(var n of e)s(n,t)}l.validateAccountLidInChatRow=s,l.validateAccountLidInChatRows=u}),98);
__d("WAWebDBEncryptMultipleMsgs",["Promise","WAAsyncSleep","WALogger","WAWebBrokerGlobalAppState","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebDbEncryptionKey","WAWebLinkify","WAWebSchemaMessage","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="DroppingMsgRowDueToLogout",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){a===void 0&&(a=!1),yield o("WAWebDbEncryptionKey").DbEncKeyStore.waitForFinalDbMsgEncKey(),yield new(u||(u=n("Promise")))(function(e){return self.setTimeout(e,0)});var i;if(a){i=[];for(var l=0;l<t.length;l++)try{var d=t[l],m=yield p(d,l);i.push(m)}catch(t){if(t instanceof c)throw t;var _=r("getErrorSafe")(t);o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["processAndEncryptSingleMsgRow with throttle failed with error: ",", message: ",", stack: ",""])),_.name,_.message,_.stack).tags("message-store")}}else{var f=yield(u||(u=n("Promise"))).all(t.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield p(e).catch(function(e){if(e instanceof c)throw e;o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["processAndEncryptSingleMsgRow without throttle failed with error: ",", message: ",", stack: ",""])),e.name,e.message,e.stack).tags("message-store")}).finally(function(){});return t});return function(t){return e.apply(this,arguments)}})()));i=f.filter(Boolean)}return i}),m.apply(this,arguments)}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(r("WAWebBrokerGlobalAppState").isLogoutInProgress)return(u||(u=n("Promise"))).reject(new c);t!=null&&(yield o("WAAsyncSleep").asyncSleepAfterGivenLoopIteration(t,35,100));var a=o("WAWebSchemaMessage").getMessageTable(),i=o("WAWebDBMessageUtils").getVcardWids(e),l=o("WAWebDBMessageSerialization").dbRowFromMessage(e),s=yield a.preflightEncryptSingleRecord(babelHelpers.extends({},l)),d=babelHelpers.extends({},l,s);return i!=null&&(d.vcardWAids=i),[d,o("WAWebLinkify").hasHttpLink(e)]}),_.apply(this,arguments)}l.DroppingMsgRowDueToLogout=c,l.encryptMultipleDBMsgs=d,l.processAndEncryptSingleMsgRow=p}),98);
__d("WAWebUserPrefsPhoneNumberHidingThreadPromotionMigration",["WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(t,n,r,o,a,i,l){function e(e){r("WAWebUserPrefsStore").set(o("WAWebUserPrefsKeys").UserPrefs.PhoneNumberHidingThreadPromotionMigrationState,e)}function s(){var e=r("WAWebUserPrefsStore").get(o("WAWebUserPrefsKeys").UserPrefs.PhoneNumberHidingThreadPromotionMigrationState);return e==="unmigrated"||e==="migration_started"||e==="migrated"?e:"unmigrated"}function u(){return s()!=="unmigrated"}function c(){return s()==="migrated"}l.setPhoneNumberHidingThreadPromotionMigrationState=e,l.getPhoneNumberHidingThreadPromotionMigrationState=s,l.hasPhoneNumberHidingThreadPromotionMigrationStarted=u,l.isPhoneNumberHidingThreadPromotionMigrationComplete=c}),98);
__d("WAWebWamEnumWebcChatCreateCreationMethod",[],(function(t,n,r,o,a,i){var e=Object.freeze({MISSING_WHEN_SAVING_MESSAGE:0});i.WEBC_CHAT_CREATE_CREATION_METHOD=e}),66);
__d("WAWebWebcChatCreateWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumWebcChatCreateCreationMethod"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({WebcChatCreate:[6132,{creationMethod:[1,o("WAWebWamEnumWebcChatCreateCreationMethod").WEBC_CHAT_CREATE_CREATION_METHOD],noCreated:[2,o("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]},{WebcChatCreate:[]});l.WebcChatCreateWamEvent=e}),98);
__d("WAWebDBMessageBulkHelper",["Promise","WALogger","WALoggerUtils","WAWebApiContact","WAWebBackendApi","WAWebBizGatingUtils","WAWebCurrentUser","WAWebDBCAPIPermissions","WAWebDBChatValidation","WAWebDBEncryptMultipleMsgs","WAWebDBMessageUtils","WAWebDBStoreEncryptedMsgs","WAWebDBStoreNewsletterEncryptedMsgs","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebSchemaChat","WAWebSchemaGroupMetadata","WAWebUserPrefsMeUser","WAWebUserPrefsPhoneNumberHidingThreadPromotionMigration","WAWebUsernameGatingUtils","WAWebUsernameTypes","WAWebVoipGatingUtils","WAWebWamEnumWebcChatCreateCreationMethod","WAWebWebcChatCreateWamEvent","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","compactMap","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b;function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{yield E(e,t)}catch(a){var n=r("getErrorSafe")(a);if(o("WAWebDBStoreEncryptedMsgs").isEligibleForFallback(e.length,n))yield E(e,t,!0);else throw n}}),S.apply(this,arguments)}function R(e,t){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{var a,i=t.filter(function(e){var t=e.id.participant;return t&&t.isLid()&&o("WAWebLidMigrationUtils").toPn(t)==null&&e.id.remote.isGroup()&&!o("WAWebUserPrefsMeUser").isMeAccount(t)});if(o("WAWebUsernameGatingUtils").usernameDisplayedEnabled()){var l=r("compactMap")(i,function(e){return e.id.participant});if(l.length>0){var _=yield o("WAWebApiContact").bulkGetContactRecord(l),f=_.reduce(function(e,t){return(t==null?void 0:t.id)!=null&&(t==null?void 0:t.username)!=null&&e.add(t.id),e},new Set);i=i.filter(function(e){var t=e.id.participant;return t&&!f.has(t.toString())})}}if(i.length===0)return;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["logMissingGroupParticipantLids: has some participants with missing Lids"]))),i.forEach(function(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["logMissingGroupParticipantLids: Missing PN mappings while saving Lid group messages. type: ",", subtype: ",""])),e.type,e.subtype)});var g=new Set(i.map(function(e){return e.id.remote.toString()}));o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["logMissingGroupParticipantLids: number affected groups: ",""])),g.size);var h=yield o("WAWebSchemaGroupMetadata").getGroupMetadataTable().anyOf(["id"],Array.from(g));h.forEach(function(e){o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["logMissingGroupParticipantLids: Missing PN mappings while saving Lid group messages. is announce: ",", is parent: ",""])),e.announce,e.isParentGroup)});var y=h.filter(function(e){return(e==null?void 0:e.announce)===!1});if(y.length===0)return;o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["logMissingGroupParticipantLids: number non Cag Groups: ",""])),y.length);var C=y.filter(function(e){return e==null?void 0:e.isLidAddressingMode}).length,b=y.length-C;o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["logMissingGroupParticipantLids: Missing PN mappings while saving Lid group messages. lid groups count: ",", pn groups count: ",",\n          is history: ",""])),C,b,(a=n==null?void 0:n.toString())!=null?a:"na").sendLogs("no-pn-mapping-for-group-lid-message")}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Could not log missing Lids ",""])),e).sendLogs("could-not-log-missing-lids")}}),L.apply(this,arguments)}function E(e,t,n){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r){r===void 0&&(r=!1),o("WAWebCurrentUser").isEmployee()&&o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["persistNewMessagesInBulk: ",""])),e.map(function(e){var t;return e==null||(t=e.id)==null?void 0:t.id})),R(e);var a=yield(b||(b=n("Promise"))).all([D(e),o("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(e,!1)]),i=a[0],l=a[1],s=i.capiCallingPermissionUpdates,u=i.chatUpdates;yield o("WAWebModelStorageUtils").getStorage().lock(["chat","fts-indexing-queue","message","message-association"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],a=e[1],i=e[2],s=e[3];o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["persistNewMessagesInBulk: bulkCreateOrMerge"]))).tags("missing-lid"),o("WAWebDBChatValidation").validateAccountLidInChatRows(u,"persistNewMessagesInBulk"),yield n.bulkCreateOrMerge(u),yield o("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(l,t,!1,r)});return function(t){return e.apply(this,arguments)}})()),s.length>0&&o("WAWebBackendApi").frontendFireAndForget("bulkUpdateChatCapiCallingPermissionType",{updates:s})}),k.apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield(b||(b=n("Promise"))).all([D(e),o("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(e,!1)]),r=t[0],a=t[1],i=r.capiCallingPermissionUpdates,l=r.chatUpdates;yield o("WAWebModelStorageUtils").getStorage().lock(["chat","message","message-association"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0];o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["persistNewNewsletterMessagesInBulk: bulkCreateOrMerge"]))).tags("missing-lid"),o("WAWebDBChatValidation").validateAccountLidInChatRows(l,"persistNewNewsletterMessagesInBulk"),yield t.bulkCreateOrMerge(l),yield o("WAWebDBStoreNewsletterEncryptedMsgs").storeEncryptedNewsletterMessages(a)});return function(t){return e.apply(this,arguments)}})()),i.length>0&&o("WAWebBackendApi").frontendFireAndForget("bulkUpdateChatCapiCallingPermissionType",{updates:i})}),T.apply(this,arguments)}function D(e){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map;e.forEach(function(e){var n=e.id,r=n.remote.toString(),a=t.get(r)||{unread:0,t:0,unreadMentionsOfMe:[],broadcast:e.broadcast===!0};if(!o("WAWebMsgGetters").getIsStatus(e)&&o("WAWebMsgGetters").getIsUnreadType(e)){if(!n.fromMe&&(a.unread+=1,o("WAWebMsgGetters").getIsImportantMessage(e))){var i={id:e.id.toString(),timestamp:e.t};a.unreadMentionsOfMe?a.unreadMentionsOfMe.push(i):a.unreadMentionsOfMe=[i]}e.t!=null&&e.t>a.t&&(a.t=Math.max(e.t,a.t)),t.set(r,a)}else{var l=o("WAWebDBMessageUtils").isCoexCallingPermissionsRequestMessage(e),s=!l&&o("WAWebDBMessageUtils").isCoexCallingPermissionsResponseMessage(e);(l||s)&&o("WAWebVoipGatingUtils").isCoexCallingPermissionsEnabled()&&(l?a.capiCallingPermissionType=o("WAWebDBCAPIPermissions").CloudAPICallingPermissionType.PENDING:s&&(a.capiCallingPermissionType=o("WAWebDBMessageUtils").getSelectedCallingPermissions(e)),t.set(r,a))}});var n=Array.from(t.keys()),a=yield o("WAWebSchemaChat").getChatTable().bulkGet(n),i=o("WAWebBizGatingUtils").isBizBroadcastSendWebEnabled(),l=[],s=a.map(function(e,r){var a,s,u,c=n[r],d=t.get(c),m=(d==null?void 0:d.unread)||0,p=Math.max(0,e?e.unreadCount:0),_=(d==null?void 0:d.t)||void 0;e&&e.t!=null&&(_==null||e.t>_)&&(_=e.t);var f=[],g=(a=e==null?void 0:e.archiveAtMentionViewedInDrawer)!=null?a:!1,y=(s=d==null?void 0:d.unreadMentionsOfMe)!=null?s:[],C=(u=e==null?void 0:e.unreadMentionsOfMe)!=null?u:[];y.length>0&&(g=!1),f=y.concat(C);var b=void 0;i&&e==null&&(d==null?void 0:d.broadcast)===!0&&(b=!0);var v={id:c,unreadCount:p+m,t:_,unreadMentionsOfMe:f,archiveAtMentionViewedInDrawer:g,createdLocally:b},S=o("WAWebWidFactory").createWid(c),R=d==null?void 0:d.capiCallingPermissionType;return R!=null&&(v.capiCallingPermissionType=R,l.push({chatId:S,capiCallingPermissionType:R})),o("WAWebLidMigrationUtils").shouldHaveAccountLid(S)&&(e==null?(v.accountLid=o("WAWebLidMigrationUtils").toUserLidOrThrow(S).toString(),S.isLid()&&(o("WAWebApiContact").getPhoneNumber(S)!=null||o("WAWebUserPrefsPhoneNumberHidingThreadPromotionMigration").hasPhoneNumberHidingThreadPromotionMigrationStarted()?v.lidOriginType=o("WAWebUsernameTypes").LidOriginType.GENERAL:v.lidOriginType=o("WAWebUsernameTypes").LidOriginType.PNH_CTWA)):e.accountLid==null&&(o("WAWebLidMigrationUtils").logLidMetadata(),o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getUpdatedChatMetadata: chat "," from DB has no account_lid"])),S.toLogString()).sendLogs("chat-in-db-has-no-account-lid").tags("missing-lid"))),v});o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][msg-cache]: storing chat updates for "," chats"])),s.length);var u=a.some(function(e){return e==null});if(u){var c=new Set(a.map(function(e){return e==null?void 0:e.id})),d=n.filter(function(e){return r("WAWebWid").isRegularUserNoImply(e)&&!c.has(e)}).length;d>0&&(new(o("WAWebWebcChatCreateWamEvent")).WebcChatCreateWamEvent({creationMethod:o("WAWebWamEnumWebcChatCreateCreationMethod").WEBC_CHAT_CREATE_CREATION_METHOD.MISSING_WHEN_SAVING_MESSAGE,noCreated:d}).commit(),o("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][msg-cache]: missing chats when saving message: ",""])),d).sendLogs("missing-chats-when-saving-message",{sampling:r("gkx")("26258")?o("WALoggerUtils").dynamicLoggingSampling(1e-4):1}))}return{chatUpdates:s,capiCallingPermissionUpdates:l}}),x.apply(this,arguments)}l.persistNewMessagesInBulk=v,l.logMissingGroupParticipantLids=R,l.persistNewNewsletterMessagesInBulk=I}),98);
__d("WAWebDBDeleteAssociatedMsgsByMsgKey",["WAWebSchemaMessageAssociation"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebSchemaMessageAssociation").getMessageAssociationTable().bulkRemove(e)}function s(e){return o("WAWebSchemaMessageAssociation").getMessageAssociationTable().bulkRemoveByIndex(["msgKey"],e)}l.bulkDeleteMessagesByMsgKeyAndAssociationType=e,l.bulkDeleteMessagesByMsgKeys=s}),98);
__d("WAWebDBGetAssociatedMsgsByParentMsgKey",["WAWebSchemaMessageAssociation"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebSchemaMessageAssociation").getMessageAssociationTable().anyOf(["parentMsgKey"],e.map(String))}l.bulkGetMessagesByParentMsgKey=e}),98);
__d("WAWebMessageAssociationGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("message_association_infra_enabled")}function s(){return o("WAWebABProps").getABPropConfigValue("futureproof_associated_child_enabled")}l.isMessageAssociationInfraEnabled=e,l.isFutureproofAssociatedChildEnabled=s}),98);
__d("WAWebDBMessageDelete",["Promise","WALogger","WAWebDBDeleteAssociatedMsgsByMsgKey","WAWebDBGetAssociatedMsgsByParentMsgKey","WAWebDBQueryAndRemoveLocalLabelAssociation","WAWebDBReportingTokenUtils","WAWebDBStoreRevokeMsgs","WAWebMessageAssociationGatingUtils","WAWebModelStorageInitialize","WAWebModelStorageUtils","WAWebMsgKey","WAWebNoop","WAWebSchemaLabelAssociation","WAWebSchemaMessage","asyncToGeneratorRuntime","cr:375","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p=(e=n("cr:375"))!=null?e:{},_=p.ftsLightClient;function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){t===void 0&&(t={deleteAssociatedMsgs:!0});var a=t,i=a.deleteAssociatedMsgs;if(e.length!==0){var l=[];return o("WAWebModelStorageInitialize").initializeWithoutGKs().then(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=new Set(e),n=[],a=[];if(i&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var s=yield o("WAWebDBGetAssociatedMsgsByParentMsgKey").bulkGetMessagesByParentMsgKey(Array.from(e,function(e){return r("WAWebMsgKey").fromString(e)}));s.forEach(function(e){a.push([e.msgKey,e.associationType]),t.add(e.msgKey)})}var u=Array.from(t);return yield o("WAWebSchemaMessage").getMessageTable().bulkGet(u,!1).then(function(e){e.forEach(function(e){(e==null?void 0:e.rowId)!=null&&n.push(String(e.rowId));var t=e==null?void 0:e.associationType;t!=null&&e!=null&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&a.push([e.id.toString(),t]);var r=e==null?void 0:e.botResponseTargetId,i=e==null?void 0:e.internalId;(e==null?void 0:e.botPluginSearchProvider)!=null&&(e==null?void 0:e.botPluginSearchUrl)!=null&&r!=null&&i!=null&&l.push({internalId:i,targetId:r})})}),{deleteMsgIdsSet:t,msgRowIds:n,deleteAssociationMappings:a}})).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.deleteAssociationMappings,a=e.deleteMsgIdsSet;return yield o("WAWebModelStorageUtils").getStorage().lock(["message","label-association","chat","message-association"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var i=Array.from(a),d=[o("WAWebSchemaMessage").getMessageTable().bulkRemove(i)],p=o("WAWebDBQueryAndRemoveLocalLabelAssociation").queryAndRemoveLocalLabelAssociation(i.map(function(e){return{associationId:e,type:o("WAWebSchemaLabelAssociation").LabelAssociationType.Message}}));if(d.push(p),t.length>0&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[association-infra] Removing associations after delete for self"])));var _=o("WAWebDBDeleteAssociatedMsgsByMsgKey").bulkDeleteMessagesByMsgKeyAndAssociationType(t);d.push(_)}try{l.length>0&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[bot] Removing bot plugin msgs after delete for self"]))),yield o("WAWebDBStoreRevokeMsgs").findAndDeleteAssociatedPluginMsg(l))}catch(e){var f=r("getErrorSafe")(e);o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[bot] findAndDeleteAssociatedPluginMsg failed with error: ",", stack: ",""])),f.name,f.stack).sendLogs("Plugin carousel delete failed")}return(m||(m=n("Promise"))).all(d)});return function(t){return e.apply(this,arguments)}})()),{deleteMsgIdsSet:a,msgRowIds:e.msgRowIds}});return function(t){return e.apply(this,arguments)}})()).then(function(e){var t=e.deleteMsgIdsSet,n=e.msgRowIds;return n.length>0&&(_==null||_.purge(n).catch(r("WAWebNoop"))),t}).then(function(e){var t=Array.from(e);o("WAWebDBReportingTokenUtils").handleDeleteReportingInfos(t,{removeWholeRow:!0})}).catch(function(e){throw o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["removeMessagesFromHistory: error ",""])),e),e})}}),g.apply(this,arguments)}function h(e){var t=e.filter(function(e){return e.includes("status@broadcast")});return t.length>0?o("WAWebSchemaMessage").getMessageTable().bulkRemove(t):(m||(m=n("Promise"))).resolve()}l.removeMessagesFromHistory=f,l.removeStatusMessage=h}),98);
__d("WAWebDBMsgUtils",["$InternalEnum","WANullthrows","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebE2EProtoUtils","WAWebLid1X1MigrationGating","WAWebMsgKey","WAWebSchemaMessage","WAWebWid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({Message:1,MessageEdit:2});function s(e,t){return o("WAWebSchemaMessage").getMessageTable().bulkGet(e).then(function(e){return e.filter(Boolean).map(function(e){return o("WAWebDBMessageSerialization").messageFromDbRow(e,t)})})}function u(e,t){var n=[];return e.forEach(function(e){var o=new(r("WAWebMsgKey"))({fromMe:!0,remote:t,id:e});n.push(o.toString());var a=new(r("WAWebMsgKey"))({fromMe:!1,remote:t,id:e});n.push(a.toString())}),o("WAWebSchemaMessage").getMessageTable().startsWithAnyOf(["id"],n)}function c(e,t){var n;return e instanceof r("WAWebMsgKey")?n=e.toString():n=e,o("WAWebSchemaMessage").getMessageTable().get(n).then(function(e){return e?o("WAWebDBMessageSerialization").messageFromDbRow(e,t):null})}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t.length===0)return t;var n=t;o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated()&&r("WAWebWid").isUser(e)&&!r("WAWebWid").isStringLid(e)&&(n=t.map(function(t){var n=t.key,r=t.timestamp,o={};return r!=null&&(o.timestamp=r),n!=null&&(o.key=babelHelpers.extends({},n,{remoteJid:e})),o}));var a=n.map(function(e){return o("WAWebE2EProtoUtils").protobufToMsgKey(r("WANullthrows")(e.key)).toString()}),i=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(a,!1);return t.filter(function(e,t){return i[t]!=null})}),m.apply(this,arguments)}function p(e){return o("WAWebSchemaMessage").getMessageTable().bulkGet(e,!1).then(function(e){return e.map(Boolean)})}function _(e){return o("WAWebSchemaMessage").getMessageTable().between(["internalId"],o("WAWebDBMessageUtils").beginningOfChat(e),o("WAWebDBMessageUtils").endOfChat(e))}l.PendingReadReceiptType=e,l.getMsgsByMsgKey=s,l.getMsgsByMsgIdsAndChatId=u,l.getMsgByMsgKey=c,l.filterReceivedMessagesInRange=d,l.getMsgsExistByMsgKey=p,l.getMsgsByChatId=_}),98);
__d("WAWebDBMarkFutureproofMessagesReparsed",["WALogger","WAWebMsgType","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{if(t.length===0)return;var n=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(t),r=n.filter(function(e){return e!=null&&e.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN});if(r.length===0)return;var a=r.map(function(e){return{id:e.id.toString(),futureproofReparsed:!0}});yield o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(a)}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["markFutureproofMessagesReparsed: error ",""])),t),t}}),u.apply(this,arguments)}l.markFutureproofMessagesReparsed=s}),98);
__d("WAWebThreadCommonModelUtils",["WALogger","WATimeUtils","WAWebMsgKey"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.threadIds;if(n==null)return[];var a=t.t;if(a==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getThreadDetailUpdatesFromMessage: message has no timestamp"]))),[];var i=r("WAWebMsgKey").from(t.id),l=i.remote,s=o("WATimeUtils").castToUnixTime(a);return n.map(function(e){return{threadId:e,chatId:l,lastMessageTimestamp:s,creationTimestamp:s,aiThreadInfo:t.aiThreadInfo,botModeSelection:t.botModeSelection}})}function u(e){var t=new Map;for(var n of e){var r=s(n);for(var o of r){var a=o.threadId.toString(),i=t.get(a);if(i==null)t.set(a,o);else{var l=o.lastMessageTimestamp>=i.lastMessageTimestamp?[i,o]:[o,i],u=l[0],d=l[1],m=c(u,d);t.set(a,m)}}}return Array.from(t.values())}function c(e,t){var n,r={threadId:t.threadId,chatId:t.chatId,creationTimestamp:e.creationTimestamp,lastMessageTimestamp:t.lastMessageTimestamp};if(t.aiThreadInfo!=null){var o,a,i=(o=t.aiThreadInfo.title)!=null?o:(a=e.aiThreadInfo)==null?void 0:a.title;r.aiThreadInfo=babelHelpers.extends({},t.aiThreadInfo,{title:i})}else r.aiThreadInfo=e.aiThreadInfo;return r.botModeSelection=(n=t.botModeSelection)!=null?n:e.botModeSelection,r}l.getThreadDetailUpdatesFromMessage=s,l.getAggregatedThreadDetailUpdatesFromMessages=u}),98);
__d("WAWebFetchMessagesInThread",["WALogger","WAWebDBMessageUtils","WAWebSchemaMessage","WAWebThreadUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){var t=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e.type);return String(t)+"_"+e.key.toString()+"_/"}function u(e){var t=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e.type);return String(t)+"_"+e.key.toString()+"_g"}var c=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="NoOffsetMessageError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error)),d=20;function m(e,t,n,r){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a){n===void 0&&(n=d);var i=a==null?void 0:yield o("WAWebSchemaMessage").getMessageTable().equals(["id"],a.toString());if(a&&i!=null&&i.length===0)throw o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Offset message "," does not exist in message table"])),a&&a.toString()),new c;var l=i==null?void 0:i[0],m,p,_=!1;r==="before"?(m=s(t),p=l==null?u(t):o("WAWebDBMessageUtils").craftInternalThreadId(o("WAWebDBMessageUtils").getInChatMsgId(l.internalId||""),t),_=!0):(m=l==null?s(t):o("WAWebDBMessageUtils").craftInternalThreadId(o("WAWebDBMessageUtils").getInChatMsgId(l.internalId||""),t),p=u(t));var f=yield o("WAWebSchemaMessage").getMessageTable().between(["internalThreadIDs"],m,p,{lowerInclusive:!1,upperInclusive:!1,limit:n,reverse:_});return f}),p.apply(this,arguments)}l.beginningOfThread=s,l.endOfThread=u,l.NoOffsetMessageError=c,l.queryMessageForThreadId=m}),98);
__d("WAWebAiThreadTypeUtils",["WAWebProtobufsAICommon.pb","err"],(function(t,n,r,o,a,i,l){var e={Unknown:"unknown",Default:"default",Incognito:"incognito"};function s(t){switch(t){case e.Unknown:return e.Unknown;case e.Default:return e.Default;case e.Incognito:return e.Incognito;default:throw r("err")("getAiThreadTypeFromString error: invalid AI thread type")}}function u(t){return t==null?e.Unknown:t===o("WAWebProtobufsAICommon.pb").AIThreadInfo$AIThreadClientInfo$AIThreadType.DEFAULT?e.Default:t===o("WAWebProtobufsAICommon.pb").AIThreadInfo$AIThreadClientInfo$AIThreadType.INCOGNITO?e.Incognito:t===o("WAWebProtobufsAICommon.pb").AIThreadInfo$AIThreadClientInfo$AIThreadType.UNKNOWN?e.Unknown:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})()}function c(t){e:{if(t===e.Default)return o("WAWebProtobufsAICommon.pb").AIThreadInfo$AIThreadClientInfo$AIThreadType.DEFAULT;if(t===e.Incognito)return o("WAWebProtobufsAICommon.pb").AIThreadInfo$AIThreadClientInfo$AIThreadType.INCOGNITO;if(t===e.Unknown)return o("WAWebProtobufsAICommon.pb").AIThreadInfo$AIThreadClientInfo$AIThreadType.UNKNOWN;throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)}}function d(t,n){e:{if(n===e.Default)return{title:t,aiThreadType:e.Default};if(n===e.Incognito)return{title:t,aiThreadType:e.Incognito};throw n===e.Unknown?r("err")("getAiThreadInfoFromType error: Unknown AI thread type"):Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)}}l.AiThreadType=e,l.getAiThreadTypeFromString=s,l.getAiThreadTypeFromProto=u,l.getProtoTypeFromAiThreadType=c,l.getAiThreadInfoFromType=d}),98);
__d("WAWebThreadsMetadataIdUtils",["WAWebDBMessageUtils","WAWebProtobufsE2E.pb","WAWebThreadUtils","err"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e.type);if(t!==o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.AI_THREAD)throw r("err")("craftAiThreadDBId error: threadTypeEnum must be AI_THREAD");return String(t)+"_"+e.key.toString()}function s(e){var t=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e.type);if(t!==o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.VIEW_REPLIES)throw r("err")("craftViewRepliesThreadDBId error: threadTypeEnum must be VIEW_REPLIES");return String(t)+"_"+e.key.toString()}function u(e){var t=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e.type);return String(t)+"_"+e.key.toString()}function c(e,t,n){var r=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(e),a=o("WAWebDBMessageUtils").orderPreservingHex(n);return String(r)+"_"+t+"_"+a}function d(e,t){var n=o("WAWebThreadUtils").getThreadsTypeAsE2EValue(t);return String(n)+"_"+e+"_"}l.craftAiThreadDBId=e,l.craftViewRepliesThreadDBId=s,l.craftThreadMetadataDBId=u,l.craftThreadsMetadataInternalId=c,l.craftThreadsMetadataInternalIdPrefixForChatAndThreadType=d}),98);
__d("WAWebGetUpdatedThreadMetadataRecord",["WANullthrows","WAWebAiThreadTypeUtils","WAWebThreadUtils","WAWebThreadsMetadataIdUtils","WAWebWidToJid"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=o("WAWebWidToJid").widToChatJid(e.chatId),a=e.threadId.type,i=o("WAWebThreadsMetadataIdUtils").craftThreadsMetadataInternalId(a,n,e.lastMessageTimestamp),l=t==null?void 0:t.creationTimestamp,s=l==null?e.creationTimestamp:Math.min(e.creationTimestamp,l),u={internalId:i,creationTimestamp:s};if(a===o("WAWebThreadUtils").ThreadType.AiThread){var c,d,m,p,_,f,g,h,y=t==null?void 0:t.lastMessageTimestamp,C=y==null?e.lastMessageTimestamp:Math.max(e.lastMessageTimestamp,y),b=(t==null?void 0:t.aiThreadInfo)==null&&e.aiThreadInfo==null?void 0:o("WAWebAiThreadTypeUtils").getAiThreadInfoFromType((c=(d=e.aiThreadInfo)==null?void 0:d.title)!=null?c:t==null||(m=t.aiThreadInfo)==null?void 0:m.title,r("WANullthrows")((p=(_=e.aiThreadInfo)==null?void 0:_.aiThreadType)!=null?p:t==null||(f=t.aiThreadInfo)==null?void 0:f.aiThreadType,"aiThreadType")),v=(g=e.botModeSelection)!=null?g:t==null?void 0:t.botModeSelection;return babelHelpers.extends({id:o("WAWebThreadsMetadataIdUtils").craftAiThreadDBId(e.threadId)},u,{aiThreadInfo:b,unreadCount:(h=t==null?void 0:t.unreadCount)!=null?h:0,lastMessageTimestamp:C,botModeSelection:v})}return babelHelpers.extends({id:o("WAWebThreadsMetadataIdUtils").craftViewRepliesThreadDBId(e.threadId)},u,{lastMessageTimestamp:void 0,unreadCount:void 0,pinThreadTimestamp:void 0,aiThreadInfo:void 0,botModeSelection:void 0})}l.getUpdatedThreadMetadataRecord=e}),98);
__d("WAWebThreadMetadataBulkJob",["Promise","WAJobOrchestratorTypes","WALogger","WAWebBackendApi","WAWebDBDeleteAssociatedMsgsByMsgKey","WAWebFetchMessagesInThread","WAWebGetUpdatedThreadMetadataRecord","WAWebMessageAssociationGatingUtils","WAWebModelStorageUtils","WAWebOrchestratorNonPersistedJob","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebSchemaMessage","WAWebSchemaThreadsMetadata","WAWebThreadUtils","WAWebThreadsMetadataIdUtils","asyncToGeneratorRuntime","compactMap","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t.length!==0){var n=t.map(function(e){return o("WAWebThreadsMetadataIdUtils").craftThreadMetadataDBId(e.threadId)}),a=yield e.bulkGet(n),i=r("compactMap")(t,function(e,t){var n=a[t];return n==null?null:babelHelpers.extends({},n,{unreadCount:e.unreadCount})});return e.bulkCreateOrMerge(i)}}),c.apply(this,arguments)}function d(e){return o("WAWebModelStorageUtils").getStorage().lock(["thread-metadata"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0];return u(n,e)});return function(e){return t.apply(this,arguments)}})())}function m(t){return t.length===0?(s||(s=n("Promise"))).resolve([]):o("WAWebModelStorageUtils").getStorage().lock(["thread-metadata"],(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var a=n[0],i=[],l=t.map(function(e){return o("WAWebThreadsMetadataIdUtils").craftThreadMetadataDBId(e.threadId)}),s=yield a.bulkGet(l),u=0,c=r("compactMap")(t,function(e,t){var n,r=s[t];if(r==null)return u++,null;var o=Math.max(0,((n=r.unreadCount)!=null?n:0)+e.delta);return i.push({threadId:e.threadId,unreadCount:o}),babelHelpers.extends({},r,{unreadCount:o})});if(u>0){var d=t.filter(function(e,t){return s[t]==null}).slice(0,3).map(function(e){return e.threadId});o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["bulkIncrementThreadUnreadCount: no existing row for "," threadIds => ",""])),u,d)}return yield a.bulkMergeOnly(c),i});return function(e){return a.apply(this,arguments)}})())}function p(e){return o("WAWebModelStorageUtils").getStorage().lock(["thread-metadata"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0];if(e.length!==0){var r=yield n.bulkGet(e.map(function(e){return o("WAWebThreadsMetadataIdUtils").craftThreadMetadataDBId(e.threadId)})),a=e.map(function(e,t){var n=r[t];return o("WAWebGetUpdatedThreadMetadataRecord").getUpdatedThreadMetadataRecord(e,n)});return n.bulkCreateOrMerge(a)}});return function(e){return t.apply(this,arguments)}})())}function _(e){var t=e.threadIds;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("bulkDeleteThreadsMetadata",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(t.length!==0){var e=o("WAWebSchemaThreadsMetadata").getThreadsMetadataTable();yield e.bulkRemove(t)}}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function f(e,t){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("bulkDeleteThreads",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=[];if(t.length===0)return a;var i=t.map(function(e){if(e.type===o("WAWebThreadUtils").ThreadType.AiThread)return o("WAWebThreadsMetadataIdUtils").craftAiThreadDBId(e);if(e.type===o("WAWebThreadUtils").ThreadType.ViewAllReplies)return o("WAWebThreadsMetadataIdUtils").craftViewRepliesThreadDBId(e);throw r("err")("bulkDeleteThreads error: Unknown thread type: "+e.type)});yield _({threadIds:i});var l=yield(s||(s=n("Promise"))).all(t.map(function(e){return g(e)}));for(var u of l)a.push.apply(a,u);return yield o("WAWebPersistedJobManager").getJobManager().waitUntilPersisted(o("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(e.toString(),a)),o("WAWebBackendApi").frontendFireAndForget("deleteModelsForLastAddOnPreview",{messagesIds:a}),a}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebFetchMessagesInThread").beginningOfThread(e),r=o("WAWebFetchMessagesInThread").endOfThread(e),a=yield o("WAWebSchemaMessage").getMessageTable().between(["internalThreadIDs"],t,r,{lowerInclusive:!1,upperInclusive:!1,returnKeyType:"primary_key"}),i=[o("WAWebSchemaMessage").getMessageTable().bulkRemove(a)];return o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&i.push(o("WAWebDBDeleteAssociatedMsgsByMsgKey").bulkDeleteMessagesByMsgKeys(a)),yield(s||(s=n("Promise"))).all(i),a}),h.apply(this,arguments)}l.bulkUpdateThreadUnreadCountWithTable=u,l.bulkUpdateThreadUnreadCount=d,l.bulkIncrementThreadUnreadCount=m,l.bulkCreateOrUpdateThreadsMetadata=p,l.bulkDeleteThreadsMetadata=_,l.bulkDeleteThreads=f,l.queryAndRemoveThreadMessages=g}),98);
__d("WAWebDBThreadMetadataBulkHelper",["Promise","WALogger","WAWebBackendApi","WAWebMsgGetters","WAWebMsgKey","WAWebThreadCommonModelUtils","WAWebThreadId","WAWebThreadMetadataBulkJob","WAWebThreadUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length===0){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[persistNewMessagesThreadMetadataInBulk]: no messages to process"])));return}var r=t.flatMap(o("WAWebThreadCommonModelUtils").getThreadDetailUpdatesFromMessage);if(r.length===0){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[persistNewMessagesThreadMetadataInBulk]: no thread metadata updates to process"])));return}yield o("WAWebThreadMetadataBulkJob").bulkCreateOrUpdateThreadsMetadata(r);var a=r.filter(function(e){return e.threadId.type===o("WAWebThreadUtils").ThreadType.AiThread});a.length>0&&(yield o("WAWebBackendApi").frontendSendAndReceive("updateChatAiThreads",{aiThreads:a}));var i=_(t);if(i.length>0){var l=yield o("WAWebThreadMetadataBulkJob").bulkIncrementThreadUnreadCount(i);o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[persistNewMessagesThreadMetadataInBulk]: incremented unread counts for "," threads"])),i.length);var m=f(l,r);yield(d||(d=n("Promise"))).all(Array.from(m.values()).map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.chatId,n=e.unreadCounts;return yield o("WAWebBackendApi").frontendSendAndReceive("updateAiThreadUnreadCounts",{chatId:t,unreadCounts:n})});return function(t){return e.apply(this,arguments)}})()))}o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[persistNewMessagesThreadMetadataInBulk]: thread metadata updated successfully for "," messages"])),t.length)}),p.apply(this,arguments)}function _(e){var t=new Map;for(var n of e){var a=r("WAWebMsgKey").from(n.id),i=n.threadIds;if(!a.fromMe&&o("WAWebMsgGetters").getIsUnreadType(n)&&i!=null){for(var l of i)if(l.type===o("WAWebThreadUtils").ThreadType.AiThread){var s,u=l.toString(),c=(s=t.get(u))!=null?s:0;t.set(u,c+1)}}}return Array.from(t.entries(),function(e){var t=e[0],n=e[1];return{threadId:r("WAWebThreadId").from(t),delta:n}})}function f(e,t){var n=new Map;for(var r of t)r.threadId.type===o("WAWebThreadUtils").ThreadType.AiThread&&n.set(r.threadId.toString(),r.chatId);var a=new Map;for(var i of e){var l=i.threadId,s=i.unreadCount,u=n.get(l.toString());if(u!=null){var c=u.toString(),d=a.get(c);d==null&&(d={chatId:u,unreadCounts:[]},a.set(c,d)),d.unreadCounts.push({threadId:l,unreadCount:s})}}return a}l.persistNewMessagesThreadMetadataInBulk=m,l.calculateThreadUnreadDeltas=_,l.groupUnreadCountsByChatId=f}),98);
__d("WAWebEventsWaitForOfflineDeliveryEnd",["WACustomError","WALogger","WAPromiseTimeout","WAResolvable","WAWebBackendEventBus","WAWebEventsWaitForBbEvent","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u=3e5;function c(){s==null&&(s=r("WAWebEventsWaitForBbEvent")(o("WAWebBackendEventBus").BackendEventBus,"offline_delivery_end"),o("WAWebBackendEventBus").BackendEventBus.on("offline_delivery_state_reset",function(){s=r("WAWebEventsWaitForBbEvent")(o("WAWebBackendEventBus").BackendEventBus,"offline_delivery_end")}))}function d(){return o("WAWebBackendEventBus").BackendEventBus.isOfflineDeliveryEnd}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(!o("WAWebBackendEventBus").BackendEventBus.isOfflineDeliveryEnd){var n=t!=null?t:{},a=n.ignoreInit,i=a===void 0?!1:a,l=new(o("WAResolvable")).Resolvable;if(i)o("WAWebBackendEventBus").BackendEventBus.onceOfflineDeliveryEnd(function(){l.resolve()});else{if(s==null)throw r("err")("waitForOfflineDeliveryEnd called before init");s.then(function(){l.resolve()})}try{yield o("WAPromiseTimeout").promiseTimeout(l.promise,u)}catch(t){if(t instanceof o("WACustomError").TimeoutError)o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] offline delievery promise not resolved within 5 mins"]))).sendLogs("offline-resume-promise-unresolved",{sampling:.01});else throw t}yield l.promise}}),p.apply(this,arguments)}l.initWaitForOfflineDeliveryEnd=c,l.isOfflineDeliveryEnd=d,l.waitForOfflineDeliveryEnd=m}),98);
__d("WAWebWebcMessageProcessingPerfWamEvent",["WAWebWamCodegenUtils"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({WebcMessageProcessingPerf:[5790,{dbStoringT:[7,e.TYPES.INTEGER],decryptionT:[1,e.TYPES.INTEGER],isOffline:[2,e.TYPES.BOOLEAN],lidProcessingT:[8,e.TYPES.INTEGER],parsingT:[3,e.TYPES.INTEGER],postProcessingT:[4,e.TYPES.INTEGER],preProcessingT:[5,e.TYPES.INTEGER],processingT:[6,e.TYPES.INTEGER],reportTokenValidationT:[9,e.TYPES.INTEGER]},[1,1,100],"regular"]},{WebcMessageProcessingPerf:[]});l.WebcMessageProcessingPerfWamEvent=s}),98);
__d("WAWebOfflineResumeMsgProcessReporter",["$InternalEnum","WALogger","WAWebEventsWaitForOfflineDeliveryEnd","WAWebRuntimeEnvironmentUtils","WAWebWebcMessageProcessingPerfWamEvent"],(function(t,n,r,o,a,i,l){var e,s,u=n("$InternalEnum")({Decryption:0,Parsing:1,PreProcessing:2,Processing:3,PostProcessing:4,ProcessReportingTokenInfo:5,DBStoring:6}),c={ACTIVE:!1,CACHE:[]};function d(){var e={dbStoringT:0,decryptionT:0,lidProcessingT:0,parsingT:0,postProcessingT:0,preProcessingT:0,processingT:0,reportTokenValidationT:0};return c.CACHE.forEach(function(t){var n=t[0],r=t[1];e:{if(n===u.DBStoring){e.dbStoringT+=r;break e}if(n===u.Decryption){e.decryptionT+=r;break e}if(n===u.ProcessReportingTokenInfo){e.reportTokenValidationT+=r;break e}if(n===u.Parsing){e.parsingT+=r;break e}if(n===u.PostProcessing){e.postProcessingT+=r;break e}if(n===u.PreProcessing){e.preProcessingT+=r;break e}if(n===u.Processing){e.processingT+=r;break e}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)}}),Object.entries(e).forEach(function(t){var n=t[0],r=t[1];typeof r=="number"&&(e[n]=Math.round(r))}),e}function m(e){if(c.ACTIVE){var n=t.performance.now();return function(){var r=t.performance.now();c.CACHE.push([e,r-n])}}}function p(){c.ACTIVE=!0;var t=!1;o("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd().then(function(){if(t)o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Reporter is already triggered"]))).sendLogs("msg_process_reporter_already_triggered");else{if(!c.ACTIVE){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Reporter must be active to commit"]))).sendLogs("msg_process_reporter_not_active");return}t=!0,new(o("WAWebWebcMessageProcessingPerfWamEvent")).WebcMessageProcessingPerfWamEvent(babelHelpers.extends({},d(),{isOffline:!0})).commit(),c={ACTIVE:!1,CACHE:[]}}})}var _={stage:u,startMarker:m,activate:function(t){o("WAWebRuntimeEnvironmentUtils").isWorker()||(t.message>5,!(t.message<=100)&&p())}};l.msgProcessReporter=_}),98);
__d("WAWebThreadMsgUtils",["WALogger","WAWebThreadUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return e.threadIds==null?!1:e.threadIds.some(function(e){return e.equals(t)})}function u(e){return e.threadIds!=null&&e.threadIds.length>0}function c(t){var n;if(!t.id.remote.isBot())return null;var r=(n=t.threadIds)==null?void 0:n.filter(function(e){return e.type===o("WAWebThreadUtils").ThreadType.AiThread});return r==null||r.length===0?null:(r.length>1&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getMsgAiThread: multiple ai threads found for msg"]))).sendLogs("getMsgAiThread: more than one ai thread found for msg"),r[0])}function d(e){return m(e.threadIds)}function m(e){return(e==null?void 0:e.some(function(e){return e.type===o("WAWebThreadUtils").ThreadType.AiThread}))===!0}function p(e){var t,n;return(t=(n=e.threadIds)==null?void 0:n.find(function(e){return e.type===o("WAWebThreadUtils").ThreadType.ViewAllReplies}))!=null?t:null}l.isMsgInThread=s,l.isThreadMsg=u,l.getMsgAiThread=c,l.msgHasAiThread=d,l.threadsContainAiThread=m,l.getMsgViewAllRepliesThread=p}),98);
__d("WAWebDBProcessEditProtocolMsgs",["$InternalEnum","Promise","WAAckLevel","WALogger","WANullthrows","WATimeUtils","WAWeb-dexie","WAWebAddonQueryUtils","WAWebApiChat","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBMessageSerialization","WAWebDBMsgUtils","WAWebDBReportingTokenUtils","WAWebDBStoreMessageOrphans","WAWebDBThreadMetadataBulkHelper","WAWebHandleMsgValidate","WAWebLidMigrationUtils","WAWebMessageEditUtils","WAWebMessagingGatingUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebNoop","WAWebOfflineResumeMsgProcessReporter","WAWebThreadMsgUtils","WAWebUserPrefsMeUser","WAWebWid","asyncToGeneratorRuntime","compactMap","cr:375"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g=(e=n("cr:375"))!=null?e:{},h=g.ftsLightClient,y=n("$InternalEnum").Mirrored(["Added","Removed"]);function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t===void 0&&(t=!1),e.length===0)return[];var n=yield o("WAWebAddonQueryUtils").getParentMsgsByMsgKey(r("compactMap")(e,function(e){return e.protocolMessageKey})),a=R(e,n),i=[],l=[],s=[];a.sort(function(e,t){return r("WANullthrows")(t.latestEditSenderTimestampMs)-r("WANullthrows")(e.latestEditSenderTimestampMs)});for(var u of a){var c=u.protocolMessageKey&&n.get(u.protocolMessageKey.toString());if(!c||c.type===o("WAWebMsgType").MSG_TYPE.CIPHERTEXT)i.push(u);else{if(o("WAWebMessagingGatingUtils").isWebReportingTokenDelayProcessingEnabled()){var d=o("WAWebOfflineResumeMsgProcessReporter").msgProcessReporter.startMarker(o("WAWebOfflineResumeMsgProcessReporter").msgProcessReporter.stage.ProcessReportingTokenInfo);yield o("WAWebHandleMsgValidate").validateAndProcessReportingTokenInfo({renderableMsgs:[u]}),d==null||d()}l.push(P(c,u)),o("WAWebThreadMsgUtils").isThreadMsg(u)&&s.push(u)}}yield L(i);var m=l.filter(function(e){return e.isLatest});return yield v(l,m),t&&(yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(e.map(function(e){return e.id.toString()}))),yield o("WAWebDBThreadMetadataBulkHelper").persistNewMessagesThreadMetadataInBulk(s),m}),b.apply(this,arguments)}function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){e.length&&(yield k(e),T(e.filter(function(e){return e.isLatest&&!o("WAWebMsgGetters").getIsNewsletterMsg(e.parentMsg)}).map(function(e){return e.parentMsg})),yield F(e)),t.length&&o("WAWebBackendApi").frontendFireAndForget("updateEditedMessagesAction",{messageEdits:t})}),S.apply(this,arguments)}function R(e,t){return e.filter(function(e){var n=e.protocolMessageKey;if(!n)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] protocol msg is missing original msg key"]))).sendLogs("message-edit-missing-original-msg-key"),!1;var a=t.get(n.toString());if(a){var i=o("WAWebMessageEditUtils").msgTypeSupportsEditing(a.type)||a.type===o("WAWebMsgType").MSG_TYPE.CIPHERTEXT;if(!i)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] original message msgId::"," type is "," which cannot be edited"])),a.id,a.type).sendLogs("message-edit-unsupported-msg-type"),!1;if(a.isForwarded===!0)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] original message cannot be a forwarded message"]))).sendLogs("message-edit-forwarded-message"),!1;var l=r("WANullthrows")(a.t),_=r("WANullthrows")(e.t);if(!o("WAWebMessageEditUtils").isParentWithinEditProcessingWindow({parentTsInSeconds:l,editTsInSeconds:_,msgKey:a.id}))return o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] protocol msg exceeds edit window, will be dropped"]))),!1;var f=o("WAWebMsgGetters").getSender(a),g=o("WAWebMsgGetters").getSender(e);if(!o("WAWebMsgGetters").getIsNewsletterMsg(a)&&(!f||!g||!r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(f,g))))return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] sender is not the parent msg sender"]))).sendLogs("message-edit-sender-mismatch"),!1}return e.latestEditSenderTimestampMs==null?(o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] protocol msg does not have a valid sender timestamp"]))).sendLogs("message-edit-missing-timestamp"),!1):!0})}function L(e){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.length&&(yield o("WAWebDBStoreMessageOrphans").storeMessageOrphans(e,function(e){return e.protocolMessageKey},{storeReportingInfo:!0}))}),E.apply(this,arguments)}function k(e){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length){var t=[],r=[];yield o("WAWebModelStorageUtils").getStorage().lock(["message","chat"],(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var i=a[0],l=a[1],s=[],u=new Set;e.forEach(function(e){var n,a,i=e.editedMsgData,l=e.isLatest,c=e.parentMsg,d=e.protocolMsg;if(l){if(s.push(babelHelpers.extends({},c,i)),!o("WAWebMsgGetters").getIsSentByMe(d)){var m=c.id.remote.toString();u.add(m)}t.push(c.id.toString()),r.push([c.id,(n=(a=i.latestEditMsgKey)==null?void 0:a.id.toString())!=null?n:""])}});var c=[];if(s.length&&c.push(i.bulkCreateOrMerge(s.map(function(e){return o("WAWebDBMessageSerialization").dbRowFromMessage(e)}))),u.size){var d=Array.from(u,function(e){return{id:e,unreadEditTimestampMs:o("WATimeUtils").unixTimeMs()}});o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["storeMessageEdits: bulkCreateOrMerge"]))).tags("missing-lid"),c.push(l.bulkCreateOrMerge(d))}yield(f||(f=n("Promise"))).all(c)});return function(e){return a.apply(this,arguments)}})()),o("WAWebDBReportingTokenUtils").handleReportingInfosUpdateOnMessageEdit(r)}}),I.apply(this,arguments)}function T(e){if(e.length){var t=Array.from(new Set(e.map(function(e){return String(r("WANullthrows")(e.rowId))})));h==null||h.purge(t).catch(r("WAWebNoop")),r("WAWeb-dexie").ignoreTransaction(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield h==null?void 0:h.addToIndexingTable(t),h==null||h.index().catch(r("WAWebNoop"))}))}}function D(e,t){return o("WAWebMsgGetters").getIsNewsletterMsg(e)&&!o("WAWebUserPrefsMeUser").isMeAccount(t.from)||e.type===o("WAWebMsgType").MSG_TYPE.EVENT_CREATION}function x(e,t){if(o("WAWebMsgGetters").getIsSentByMe(e))return e.local===!0?D(e,t)?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.CLOCK:o("WAWebMsgKeyUtils").isNoteToSelf(e.id)?o("WAAckLevel").ACK.READ:o("WAAckLevel").ACK.SENT}var $=new Map;function P(e,t){var n,a,i=r("WANullthrows")(o("WAWebMessageEditUtils").getMsgEditType(e.type),"Unsupported message type for edits"),l=A(e,t,i);o("WAWebMsgGetters").getIsSentByMe(e)&&t.count!=null&&(l.count=t.count);var s=(n=(a=$.get(e.id.toString()))!=null?a:e.latestEditSenderTimestampMs)!=null?n:0,u=r("WANullthrows")(t.latestEditSenderTimestampMs),c=u>=s;if(i===o("WAWebMessageEditUtils").MsgEditType.EventEdit){var d=!!e.isEventCanceled,m=!!t.isEventCanceled;!d&&m?c=!0:d&&!m&&(c=!1)}c&&$.set(e.id.toString(),u);var p;if(i!==o("WAWebMessageEditUtils").MsgEditType.EventEdit&&!o("WAWebMsgGetters").getIsSentByMe(e)){var _=o("WAWebMsgGetters").getHasMentionOfMe(e),f=o("WAWebMsgGetters").getHasMentionOfMe(babelHelpers.extends({},e,l));_&&!f?p=y.Removed:!_&&f&&(p=y.Added)}if((o("WAWebMsgGetters").getIsMetaBotResponse(e)||e.botEditType!=null)&&(l.botEditType=t.botEditType,l.botEditTargetId=t.botEditTargetId),o("WAWebMsgGetters").getGroupHistoryBundleMessageKey(e)){var g=o("WAWebMsgGetters").getGroupHistoryIndividualMessageInfo(e);g!=null&&(l.groupHistoryIndividualMessageInfo=babelHelpers.extends({},g,{isEditedAfterReceivedAsHistory:!0}))}return{parentMsg:e,protocolMsg:t,editedMsgData:l,isLatest:c,mentionOfMe:p}}function N(e){return{aiThreadInfo:e.aiThreadInfo,botPluginSearchUrl:e.botPluginSearchUrl,botPluginSearchProvider:e.botPluginSearchProvider,botPluginReferenceIndex:e.botPluginReferenceIndex,botPluginType:e.botPluginType,botPluginMaybeParent:e.botPluginMaybeParent,botReelPluginThumbnailCdnUrl:e.botReelPluginThumbnailCdnUrl,botPluginSearchQuery:e.botPluginSearchQuery,botMessageDisclaimerText:e.botMessageDisclaimerText}}function M(e){var t;return{deprecatedMms3Url:e.deprecatedMms3Url,directPath:e.directPath,staticUrl:e.staticUrl,mimetype:e.mimetype,caption:e.caption,filehash:e.filehash,encFilehash:e.encFilehash,size:e.size,height:e.height,width:e.width,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,interactiveAnnotations:e.interactiveAnnotations,scanLengths:(t=e.scanLengths)!=null?t:[],scansSidecar:e.scansSidecar,isViewOnce:e.isViewOnce,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:e.thumbnailSha256,thumbnailEncSha256:e.thumbnailEncSha256,body:r("WANullthrows")(e.body),type:"image",kind:"image"}}function w(e){return{deprecatedMms3Url:e.deprecatedMms3Url,directPath:e.directPath,staticUrl:e.staticUrl,mimetype:e.mimetype,caption:e.caption,filehash:e.filehash,encFilehash:e.encFilehash,size:e.size,height:e.height,width:e.width,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,body:r("WANullthrows")(e.body),interactiveAnnotations:e.interactiveAnnotations,isViewOnce:e.isViewOnce,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:e.thumbnailSha256,thumbnailEncSha256:e.thumbnailEncSha256,isGif:e.isGif,gifAttribution:e.gifAttribution,accessibilityLabel:e.accessibilityLabel,duration:e.duration,streamingSidecar:e.streamingSidecar,type:"video",kind:"video"}}function A(e,t,n){var r={latestEditMsgKey:t.latestEditMsgKey,latestEditSenderTimestampMs:t.latestEditSenderTimestampMs,errorCode:t.errorCode,ack:x(e,t),pendingReadReceipt:o("WAWebMsgGetters").getIsSentByMe(e)?void 0:o("WAWebDBMsgUtils").PendingReadReceiptType.MessageEdit,hasPaidPartnershipLabel:t.hasPaidPartnershipLabel};switch(n){case o("WAWebMessageEditUtils").MsgEditType.TextEdit:{var a,i,l,s,u,c=!!t.matchedText||!!t.description||!!t.title;return babelHelpers.extends({},r,N(t),{subtype:c?"url":void 0,body:t.body,mentionedJidList:t.mentionedJidList,groupMentions:t.groupMentions,title:t.title,description:t.description,matchedText:t.matchedText,inviteGrpType:t.inviteGrpType,thumbnail:t.thumbnail,richPreviewType:t.richPreviewType,doNotPlayInline:t.doNotPlayInline,paymentLinkMetadata:t.paymentLinkMetadata,thumbnailDirectPath:(a=t.thumbnailDirectPath)!=null?a:void 0,thumbnailSha256:(i=t.thumbnailSha256)!=null?i:void 0,thumbnailEncSha256:(l=t.thumbnailEncSha256)!=null?l:void 0,thumbnailHeight:(s=t.thumbnailHeight)!=null?s:void 0,thumbnailWidth:(u=t.thumbnailWidth)!=null?u:void 0,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp})}case o("WAWebMessageEditUtils").MsgEditType.CaptionEdit:return babelHelpers.extends({},r,{caption:t.caption,mentionedJidList:t.mentionedJidList,groupMentions:t.groupMentions,isCaptionByUser:!0});case o("WAWebMessageEditUtils").MsgEditType.EventEdit:return babelHelpers.extends({},r,{eventName:t.eventName,eventDescription:t.eventDescription,eventLocation:t.eventLocation,eventStartTime:t.eventStartTime,eventEndTime:t.eventEndTime,eventJoinLink:t.eventJoinLink,isEventCanceled:t.isEventCanceled});case o("WAWebMessageEditUtils").MsgEditType.RichResponseEdit:return babelHelpers.extends({},r,N(t),{richResponse:t.richResponse,unifiedResponse:t.unifiedResponse});case o("WAWebMessageEditUtils").MsgEditType.LoadingMediaEdit:{var d=t.mimetype;if(d!=null){if(d.startsWith("image"))return babelHelpers.extends({},r,N(t),M(t),{subtype:null});if(d.startsWith("video"))return babelHelpers.extends({},r,N(t),w(t),{subtype:null})}return babelHelpers.extends({},r,N(t),{type:"loading_media"})}}}function F(e){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,n=new Map;for(var r of e){var a=r.mentionOfMe,i=r.parentMsg,l=i.id.remote.toString();if(a)switch(a){case y.Removed:{var s=i.id.toString(),u=t.get(l);u||(u=[],t.set(l,u)),u.push(s);break}case y.Added:{var c=n.get(l);c||(c=[],n.set(l,c));var d={id:i.id.toString(),timestamp:i.t};c.push(d)}}}t.size&&(yield o("WAWebApiChat").removeUnreadMentionChat(t)),n.size&&(yield o("WAWebApiChat").addUnreadMentionChat(n))}),O.apply(this,arguments)}l.EditedMentionOfMe=y,l.processEditProtocolMsgs=C,l.updateMessageEditsLocally=v,l.generateMessageEdit=P}),98);
__d("WAWebAssociationProcessorConstants",[],(function(t,n,r,o,a,i){var e=Object.freeze({Regular:"Regular",WithDetachedMessages:"WithDetachedMessages"});i.AssociationProcessorType=e}),66);
__d("WAWebCreateAssociationProcessor",["WAWebAssociationProcessorConstants"],(function(t,n,r,o,a,i,l){function e(e){return babelHelpers.extends({},e,{processorType:o("WAWebAssociationProcessorConstants").AssociationProcessorType.WithDetachedMessages})}l.createAssociationMsgProcessorWithDetachedMessages=e}),98);
__d("WAWebAlbumAssociationProcessor",["WAWebCreateAssociationProcessor","WAWebMessageAssociation.flow","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e=o("WAWebCreateAssociationProcessor").createAssociationMsgProcessorWithDetachedMessages({type:o("WAWebMessageAssociation.flow").MessageAssociationType.MEDIA_ALBUM,viewMode:o("WAWebViewMode.flow").ViewModeType.MEDIA_ALBUM}),s=e;l.default=s}),98);
__d("WAWebBotPluginAssociationProcessor",["WAWebAssociationProcessorConstants","WAWebMessageAssociation.flow","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e={processorType:o("WAWebAssociationProcessorConstants").AssociationProcessorType.Regular,type:o("WAWebMessageAssociation.flow").MessageAssociationType.BOT_PLUGIN,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE},s=e;l.default=s}),98);
__d("WAWebDualUploadsAssociationProcessor",["WAWebAssociationProcessorConstants","WAWebMessageAssociation.flow","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAssociation.flow").MessageAssociationType.HD_IMAGE_DUAL_UPLOAD,viewMode:o("WAWebViewMode.flow").ViewModeType.HIDDEN,processorType:o("WAWebAssociationProcessorConstants").AssociationProcessorType.Regular},s={type:o("WAWebMessageAssociation.flow").MessageAssociationType.HD_VIDEO_DUAL_UPLOAD,viewMode:o("WAWebViewMode.flow").ViewModeType.HIDDEN,processorType:o("WAWebAssociationProcessorConstants").AssociationProcessorType.Regular},u={type:o("WAWebMessageAssociation.flow").MessageAssociationType.HEVC_VIDEO_DUAL_UPLOAD,viewMode:o("WAWebViewMode.flow").ViewModeType.HIDDEN,processorType:o("WAWebAssociationProcessorConstants").AssociationProcessorType.Regular};l.ImageDualUploadsAssociationProcessor=e,l.VideoDualUploadsAssociationProcessor=s,l.HevcDualUploadsAssociationProcessor=u}),98);
__d("WAWebMediaPollAssociationProcessor",["WAWebMessageAssociation.flow","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e={processorType:"Regular",type:o("WAWebMessageAssociation.flow").MessageAssociationType.MEDIA_POLL,viewMode:o("WAWebViewMode.flow").ViewModeType.POLL_MEDIA},s=e;l.default=s}),98);
__d("WAWebUnknownAssociationProcessor",["WAWebAssociationProcessorConstants","WAWebMessageAssociation.flow","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e={type:o("WAWebMessageAssociation.flow").MessageAssociationType.UNKNOWN,viewMode:o("WAWebViewMode.flow").ViewModeType.HIDDEN,processorType:o("WAWebAssociationProcessorConstants").AssociationProcessorType.Regular},s=e;l.default=s}),98);
__d("WAWebAssociationProcessor",["WAWebAlbumAssociationProcessor","WAWebBotPluginAssociationProcessor","WAWebDualUploadsAssociationProcessor","WAWebMediaPollAssociationProcessor","WAWebUnknownAssociationProcessor","justknobx"],(function(t,n,r,o,a,i,l){var e=r("justknobx")._("4912"),s=[r("WAWebAlbumAssociationProcessor"),r("WAWebUnknownAssociationProcessor"),r("WAWebBotPluginAssociationProcessor"),r("WAWebMediaPollAssociationProcessor"),e?o("WAWebDualUploadsAssociationProcessor").ImageDualUploadsAssociationProcessor:null,e?o("WAWebDualUploadsAssociationProcessor").VideoDualUploadsAssociationProcessor:null,e?o("WAWebDualUploadsAssociationProcessor").HevcDualUploadsAssociationProcessor:null].filter(Boolean);function u(e){var t,n=e.associationType;return(t=s.find(function(e){return e.type===n}))!=null?t:null}function c(e){var t;return(t=s.find(function(t){return t.type===e}))!=null?t:null}l.getAssociationProcessor=u,l.getAssociationProcessorByAssociationType=c}),98);
__d("WAWebHandlePlaceholderMsgKeyHashUtils",["WABase64","WACryptoHmac","WAWebABProps","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=null,s=new TextEncoder,u=function(t){return s.encode(t).buffer};function c(){return e||(e=o("WAWebUserPrefsMultiDevice").getChatThreadLoggingSecretB64().then(function(e){return e==null?null:o("WABase64").decodeB64(e)})),e}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,r,a,i=yield c();if(!i)return null;var l=u(e.id.id+(e.id.fromMe?"1":"0")+((t=(n=e.id.remote)==null?void 0:n.toString({legacy:!0}))!=null?t:"")+((r=(a=e.id.participant)==null?void 0:a.toString({legacy:!0}))!=null?r:"")),s=yield o("WACryptoHmac").hmacSha256(i,l);return o("WABase64").encodeB64(s)}),m.apply(this,arguments)}function p(){return o("WAWebABProps").getABPropConfigValue("placeholder_message_key_hash_logging")}l.getMessageKeyHash=d,l.messageKeyHashEnabled=p}),98);
__d("WAWebWamEnumAddressingMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({PN:1,LID:2});i.ADDRESSING_MODE=e}),66);
__d("WAWebWamEnumE2eDeviceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({MY_PRIMARY:1,OTHER_PRIMARY:2,MY_COMPANION:3,OTHER_COMPANION:4,MY_HOSTED_COMPANION:5,OTHER_HOSTED_COMPANION:6});i.E2E_DEVICE_TYPE=e}),66);
__d("WAWebWamEnumEncryptionTypeCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({E2EE:1,COEX:2,SELF_COEX:3,CAPI:4,BSP:5,GUEST:6,TEE:7});i.ENCRYPTION_TYPE_CODE=e}),66);
__d("WAWebWamEnumPlaceholderAction",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,ADD:1,VIEW:2,POPULATE:3});i.PLACEHOLDER_ACTION=e}),66);
__d("WAWebWamEnumPlaceholderChatType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4,CHANNEL:5,INTEROP:6});i.PLACEHOLDER_CHAT_TYPE=e}),66);
__d("WAWebWamEnumPlaceholderPopulationType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,RETRY:1,PEER_MESSAGE:2,RESEND:3});i.PLACEHOLDER_POPULATION_TYPE=e}),66);
__d("WAWebWamEnumPlaceholderReasonType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,SIGNAL_NO_SESSION:1,DEVICE_VERIFICATION_FAILURE:2,UNKNOWN_SELF_DEVICE:3,SIGNAL_INVALID_KEY:4,SIGNAL_INVALID_KEY_ID:5,SIGNAL_INVALID_MESSAGE:6,DEVICE_VERIFICATION_FAILURE_SELF_PEER:7,UNKNOWN_COMPANION_NO_PREKEY:8,BAD_EPHEMERAL_SETTING:9,SIGNAL_FUTURE_MESSAGE:10,SIGNAL_INVALID_SIGNATURE:11,SIGNAL_BAD_MAC:12,SIGNAL_INVALID_SESSION:13});i.PLACEHOLDER_REASON_TYPE=e}),66);
__d("WAWebWamEnumPlaceholderType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,CIPHERTEXT:1,FANOUT:2,DOWNGRADE:3,FIXED_CONTENT:4,TEMPORARY:5,DROP:6});i.PLACEHOLDER_TYPE=e}),66);
__d("WAWebWamEnumSizeBucket",[],(function(t,n,r,o,a,i){var e=Object.freeze({LT32:1,LT64:2,LT128:3,LT256:4,LT512:5,LT1000:6,LT1024:16,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15});i.SIZE_BUCKET=e}),66);
__d("WAWebPlaceholderActivityWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAddressingMode","WAWebWamEnumE2eDeviceType","WAWebWamEnumEncryptionTypeCode","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumPlaceholderAction","WAWebWamEnumPlaceholderChatType","WAWebWamEnumPlaceholderPopulationType","WAWebWamEnumPlaceholderReasonType","WAWebWamEnumPlaceholderType","WAWebWamEnumSizeBucket","WAWebWamEnumTypeOfGroupEnum"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({PlaceholderActivity:[1980,{deviceCount:[9,e.TYPES.INTEGER],deviceSizeBucket:[8,o("WAWebWamEnumSizeBucket").SIZE_BUCKET],e2eSenderType:[16,o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE],encryptionType:[22,o("WAWebWamEnumEncryptionTypeCode").ENCRYPTION_TYPE_CODE],isHostedChat:[19,e.TYPES.BOOLEAN],isLid:[12,e.TYPES.BOOLEAN],isSimpleSignal:[23,e.TYPES.BOOLEAN],localAddressingMode:[20,o("WAWebWamEnumAddressingMode").ADDRESSING_MODE],messageBeforeReg:[15,e.TYPES.BOOLEAN],messageIsRevoke:[7,e.TYPES.BOOLEAN],messageKeyHash:[14,e.TYPES.STRING],messageMediaType:[6,o("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[5,o("WAWebWamEnumMessageType").MESSAGE_TYPE],participantCount:[10,e.TYPES.INTEGER],placeholderActionInd:[2,o("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION],placeholderAddReason:[11,o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE],placeholderChatTypeInd:[3,o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE],placeholderPopulationType:[17,o("WAWebWamEnumPlaceholderPopulationType").PLACEHOLDER_POPULATION_TYPE],placeholderTimePeriod:[4,e.TYPES.INTEGER],placeholderTypeInd:[1,o("WAWebWamEnumPlaceholderType").PLACEHOLDER_TYPE],typeOfGroup:[13,o("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]},{PlaceholderActivity:[]});l.PlaceholderActivityWamEvent=s}),98);
__d("WAWebWamGroupMetadataMetricUtils",["WAWebDBGroupsGroupMetadata","WAWebGroupType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e!=null&&e.isGroup()){var t=yield o("WAWebDBGroupsGroupMetadata").getGroupMetadata(e);if(t!=null)return o("WAWebGroupType").groupTypeToWamEnum(o("WAWebGroupType").getGroupTypeFromGroupMetadata(t))}}),s.apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebDBGroupsGroupMetadata").getGroupMetadata(e);return t==null?null:d(t)}),c.apply(this,arguments)}function d(e){return o("WAWebGroupType").getGroupTypeFromGroupMetadata(e)===o("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP}l.getGroupTypeFromChatWid=e,l.isCagFromChatWid=u,l.isCagFromGroupMetadata=d}),98);
__d("WAWebWamNumberToSizeBucket",["WAWebWamEnumSizeBucket"],(function(t,n,r,o,a,i,l){function e(e){return e<32?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT32:e<64?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT64:e<128?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT128:e<256?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT256:e<512?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT512:e<1024?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT1024:e<1500?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT1500:e<2e3?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT2000:e<2500?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT2500:e<3e3?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT3000:e<3500?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT3500:e<4e3?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT4000:e<4500?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT4500:e<5e3?o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT5000:o("WAWebWamEnumSizeBucket").SIZE_BUCKET.LARGEST_BUCKET}l.default=e}),98);
__d("WAWebWamGroupMetricUtils",["WAWebWamNumberToSizeBucket"],(function(t,n,r,o,a,i,l){function e(e){return Math.max(e,32)}function s(t){var n={},r=t.participants.length;r!=null&&(n.participantCount=e(r));var o=t.cachedDeviceCount;return o!=null&&(n.deviceCount=e(o)),n}function u(t){return{participantCount:e(t.participants.length),deviceCount:e(t.senderKey.size),deviceSizeBucket:r("WAWebWamNumberToSizeBucket")(t.senderKey.size)}}l.capCount=e,l.getGroupCountMetricsFromGroupMetadata=s,l.getGroupMetricsFromDbRecord=u}),98);
__d("WAWebWamGroupMetricCache",["Promise","WALogger","WAWebSchemaParticipant","WAWebWamGroupMetricUtils"],(function(t,n,r,o,a,i,l){var e,s,u=new Map;function c(e){if(!e.isGroup())return(s||(s=n("Promise"))).resolve(null);var t=e.toString();return u.has(t)||u.set(t,d(t)),u.get(t)||(s||(s=n("Promise"))).resolve(null)}function d(t){return o("WAWebSchemaParticipant").getParticipantTable().get(t).then(function(e){return e&&o("WAWebWamGroupMetricUtils").getGroupMetricsFromDbRecord(e)}).catch(function(n){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["_getGroupMetricsFromDb: failed to get for ",": ",""])),t,n)})}function m(e){e.participants==null||e.senderKey==null||u.set(e.groupId,(s||(s=n("Promise"))).resolve(o("WAWebWamGroupMetricUtils").getGroupMetricsFromDbRecord(e)))}l.getGroupMetrics=c,l.cacheGroupMetrics=m}),98);
__d("WAWebInteractiveMessageType",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({NATIVE_FLOW:"native_flow",SHOPS_STOREFRONT:"shops_storefront",CAROUSEL:"carousel"}),l=e;i.default=l}),66);
__d("WAWebWamEnumAgentEngagementEnumType",[],(function(t,n,r,o,a,i){var e=Object.freeze({DIRECT_CHAT:0,INVOKED:1,MEMBER:2});i.AGENT_ENGAGEMENT_ENUM_TYPE=e}),66);
__d("WAWebWamEnumBotType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,METABOT:1,BOT_1P_BIZ:2,BOT_3P_BIZ:3,UGC:4,META_CHARACTER:5,TEE_BOT:6});i.BOT_TYPE=e}),66);
__d("WAWebWamEnumInvisibleMessageCategoryType",[],(function(t,n,r,o,a,i){var e=Object.freeze({PEER:1,INVISIBLE_KEY_DISTRIBUTION:2,OTHER:3,MEDIA_EXPRESS_NOTIFY:4,EPHEMERAL_SYNC_RESPONSE:5,GROUP_MEMBER_TAG:6});i.INVISIBLE_MESSAGE_CATEGORY_TYPE=e}),66);
__d("WAWebWamMsgUtils",["WAWebApiParse","WAWebBotTypes","WAWebHandleMsgCommon","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgGetters","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumE2eDeviceType","WAWebWamEnumInvisibleMessageCategoryType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWid"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebMsgGetters").getIsStatus(e)?o("WAWebWamEnumMessageType").MESSAGE_TYPE.STATUS:o("WAWebMsgGetters").getIsGroupMsg(e)?o("WAWebWamEnumMessageType").MESSAGE_TYPE.GROUP:r("WAWebWid").isBroadcast(e.id.remote)||o("WAWebMsgGetters").getBroadcastId(e)!=null?o("WAWebWamEnumMessageType").MESSAGE_TYPE.BROADCAST:r("WAWebWid").isNewsletter(e.id.remote)?o("WAWebWamEnumMessageType").MESSAGE_TYPE.CHANNEL:o("WAWebWamEnumMessageType").MESSAGE_TYPE.INDIVIDUAL}function s(e){return e==="chat"?o("WAWebWamEnumMessageType").MESSAGE_TYPE.INDIVIDUAL:e==="group"?o("WAWebWamEnumMessageType").MESSAGE_TYPE.GROUP:e==="peer_broadcast"||e==="other_broadcast"?o("WAWebWamEnumMessageType").MESSAGE_TYPE.BROADCAST:e==="direct_peer_status"||e==="other_status"?o("WAWebWamEnumMessageType").MESSAGE_TYPE.STATUS:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function u(e){if(e.isDynamicReplyButtonsMsg===!0)return o("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_MESSAGE;switch(e.type){case"image":return o("WAWebWamEnumMediaType").MEDIA_TYPE.PHOTO;case"video":return e.isGif===!0?o("WAWebWamEnumMediaType").MEDIA_TYPE.GIF:o("WAWebWamEnumMediaType").MEDIA_TYPE.VIDEO;case"ptv":return o("WAWebWamEnumMediaType").MEDIA_TYPE.PUSH_TO_VIDEO;case"audio":return o("WAWebWamEnumMediaType").MEDIA_TYPE.AUDIO;case"ptt":return o("WAWebWamEnumMediaType").MEDIA_TYPE.PTT;case"document":return o("WAWebWamEnumMediaType").MEDIA_TYPE.DOCUMENT;case"unknown":return o("WAWebWamEnumMediaType").MEDIA_TYPE.FUTURE;case"location":return e.isLive===!0?o("WAWebWamEnumMediaType").MEDIA_TYPE.LIVE_LOCATION:o("WAWebWamEnumMediaType").MEDIA_TYPE.LOCATION;case"vcard":return o("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT;case"multi_vcard":return o("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT_ARRAY;case"chat":return e.matchedText!=null?o("WAWebApiParse").matchCatalogUrl(e.matchedText)?o("WAWebWamEnumMediaType").MEDIA_TYPE.CATALOG_LINK:o("WAWebApiParse").matchProductUrl(e.matchedText)?o("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_LINK:o("WAWebWamEnumMediaType").MEDIA_TYPE.URL:o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"sticker":return o("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER;case"product":return o("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_IMAGE;case"list":{var t,n,r=(t=(n=e.list)==null?void 0:n.listType)!=null?t:o("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.UNKNOWN;switch(r){case o("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.SINGLE_SELECT:return o("WAWebWamEnumMediaType").MEDIA_TYPE.LIST;case o("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.PRODUCT_LIST:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_LIST;default:return o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}}case"list_response":return o("WAWebWamEnumMediaType").MEDIA_TYPE.LIST_REPLY;case"buttons_response":return o("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case"order":return o("WAWebWamEnumMediaType").MEDIA_TYPE.ORDER;case"interactive":return c(e);case"reaction":case"reaction_enc":return o("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;case"poll_creation":return o("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_CREATE;case"poll_result_snapshot":return o("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_RESULT_SNAPSHOT;case"poll_update":return e.subtype==="poll_vote"?o("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE:o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"keep_in_chat":return e.keepType===o("WAWebProtobufsE2E.pb").KeepType.KEEP_FOR_ALL?o("WAWebWamEnumMediaType").MEDIA_TYPE.KEEP:o("WAWebWamEnumMediaType").MEDIA_TYPE.UNKEEP;case"pin_message":return o("WAWebWamEnumMediaType").MEDIA_TYPE.PIN_IN_CHAT;case"protocol":return e.subtype==="ephemeral_sync_response"?o("WAWebWamEnumMediaType").MEDIA_TYPE.EPHEMERAL_SYNC_RESPONSE:o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"event_creation":return o("WAWebWamEnumMediaType").MEDIA_TYPE.EVENT_CREATE;case"event_response":return o("WAWebWamEnumMediaType").MEDIA_TYPE.EVENT_RESPOND;case"album":return o("WAWebWamEnumMediaType").MEDIA_TYPE.MEDIA_ALBUM;case"sticker-pack":return o("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER_PACK;default:return e.type,o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}}function c(e){var t=e.interactiveType;if(t==null)return o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;switch(t){case r("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return o("WAWebWamEnumMediaType").MEDIA_TYPE.SHOP_STOREFRONT;case r("WAWebInteractiveMessageType").NATIVE_FLOW:return d(e);case r("WAWebInteractiveMessageType").CAROUSEL:return o("WAWebWamEnumMediaType").MEDIA_TYPE.INTERACTIVE_CAROUSEL}}function d(e){return e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW?o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE:o("WAWebWamEnumMediaType").MEDIA_TYPE.INTERACTIVE_NFM}function m(e){return e instanceof r("WAWebWid")?o("WAWebUserPrefsMeUser").isMeAccount(e)?e.isCompanion()?o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE.MY_COMPANION:o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE.MY_PRIMARY:e.isCompanion()?o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE.OTHER_COMPANION:o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE.OTHER_PRIMARY:null}function p(e){if(e.id.remote.isBot())return o("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.DIRECT_CHAT;var t=o("WAWebMsgGetters").getIsBotQuery(e),n=o("WAWebMsgGetters").getIsMetaBotResponse(e);return t||n?o("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.INVOKED:null}function _(e,t,n){if(e!=null&&e.isBot())return o("WAWebWamEnumBotType").BOT_TYPE.METABOT;if(t){if(t===o("WAWebBotTypes").BizBotType.BIZ_1P)return o("WAWebWamEnumBotType").BOT_TYPE.BOT_1P_BIZ;if(t===o("WAWebBotTypes").BizBotType.BIZ_3P)return o("WAWebWamEnumBotType").BOT_TYPE.BOT_3P_BIZ}if(n){if(n===o("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P)return o("WAWebWamEnumBotType").BOT_TYPE.BOT_1P_BIZ;if(n===o("WAWebBotTypes").BizBotAutomatedType.FULL_3P)return o("WAWebWamEnumBotType").BOT_TYPE.BOT_3P_BIZ}return o("WAWebWamEnumBotType").BOT_TYPE.UNKNOWN}function f(e){if(e==null||e==="")return null;switch(e){case o("WAWebHandleMsgCommon").MSG_CATEGORY.peer:return o("WAWebWamEnumInvisibleMessageCategoryType").INVISIBLE_MESSAGE_CATEGORY_TYPE.PEER;default:return null}}function g(e,t,n){if(t.isGroup())return!!n;if(t.isStatus()){var r,o;return(r=(o=e.id.participant)==null?void 0:o.isLid())!=null?r:!1}return e.from.isLid()||e.to.isLid()}l.getWamMessageType=e,l.getMessageTypeFromMsgInfoType=s,l.getWamMediaType=u,l.getInteractiveWamType=c,l.getWamE2eSenderType=m,l.getWamAgentEngagementType=p,l.getWamBotType=_,l.getWamInvisibleMessageCatgoryType=f,l.msgIsLid=g}),98);
__d("WAWebHandlePlaceholderWam",["Promise","WATimeUtils","WAWebDBGroupsGroupMetadata","WAWebDBMessageSerialization","WAWebGroupType","WAWebHandlePlaceholderMsgKeyHashUtils","WAWebMsgGetters","WAWebPlaceholderActivityWamEvent","WAWebWamEnumPlaceholderAction","WAWebWamEnumPlaceholderChatType","WAWebWamEnumPlaceholderType","WAWebWamGroupMetadataMetricUtils","WAWebWamGroupMetricCache","WAWebWamMsgUtils","WAWebWid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield g(e,o("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.ADD);t.forEach(function(e){return e.commit()})}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){return o("WAWebDBMessageSerialization").messageFromDbRow(e)}),n=yield g(t,o("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.VIEW);n.forEach(function(e){return e.commit()})}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield g(e,o("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.POPULATE);t.forEach(function(e){return e.commit()})}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a,i=e.id.remote,l=!!(t!=null&&t.isLidAddressingMode),s=o("WAWebWamMsgUtils").msgIsLid(e,i,l),u=new(o("WAWebPlaceholderActivityWamEvent")).PlaceholderActivityWamEvent({placeholderChatTypeInd:S(i),placeholderTimePeriod:Math.max(o("WATimeUtils").unixTime()-((a=e.t)!=null?a:0),0),placeholderActionInd:n,placeholderTypeInd:e.subtype==="fanout"?o("WAWebWamEnumPlaceholderType").PLACEHOLDER_TYPE.FANOUT:o("WAWebWamEnumPlaceholderType").PLACEHOLDER_TYPE.CIPHERTEXT,messageIsRevoke:o("WAWebMsgGetters").getIsRevoke(e),messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(e),messageType:o("WAWebWamMsgUtils").getWamMessageType(e),isLid:s});return e.placeholderAddReason!=null&&(u.placeholderAddReason=e.placeholderAddReason),n===o("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.POPULATE&&e.placeholderPopulationType!=null&&(u.placeholderPopulationType=e.placeholderPopulationType),e.e2eSenderType!=null&&(u.e2eSenderType=e.e2eSenderType),r("WAWebWid").isGroup(i)?yield y(u,e,t):r("WAWebWid").isUser(i)&&(u.isLid=i.isLid()),yield b(u,e),u}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=[],i=[];for(var l of t)R(l)&&(o("WAWebMsgGetters").getIsGroupMsg(l)?i.push(l):a.push(l));var s=(yield o("WAWebDBGroupsGroupMetadata").bulkGetGroupMetadata(i.map(function(e){return e.id.remote}))).map(function(e,t){return[i[t],e]});return(e||(e=n("Promise"))).all([].concat(a.map(function(e){return _(e,null,r)}),s.map(function(e){var t=e[0],n=e[1];return _(t,n,r)})))}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("WAWebWamGroupMetricCache").getGroupMetrics(t.id.remote);if(r!=null&&(r.participantCount!=null&&(e.participantCount=r.participantCount),r.deviceCount!=null&&(e.deviceCount=r.deviceCount),r.deviceSizeBucket!=null&&(e.deviceSizeBucket=r.deviceSizeBucket)),n){var a=o("WAWebWamGroupMetadataMetricUtils").isCagFromGroupMetadata(n);e.isLid=a&&o("WAWebMsgGetters").getIsReaction(t),e.typeOfGroup=o("WAWebGroupType").groupTypeToWamEnum(o("WAWebGroupType").getGroupTypeFromGroupMetadata(n))}}),C.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(o("WAWebHandlePlaceholderMsgKeyHashUtils").messageKeyHashEnabled()){var n=yield o("WAWebHandlePlaceholderMsgKeyHashUtils").getMessageKeyHash(t);n!=null&&(e.messageKeyHash=n)}}),v.apply(this,arguments)}function S(e){return r("WAWebWid").isGroup(e)?o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.GROUP:r("WAWebWid").isStatus(e)?o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.STATUS:r("WAWebWid").isBroadcast(e)?o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.BROADCAST:r("WAWebWid").isUser(e)?o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.INDIVIDUAL:r("WAWebWid").isNewsletter(e)?o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.CHANNEL:o("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.OTHER}function R(e){return e.subtype!=="view_once_unavailable_fanout"}l.postPlaceholderActivityAddEvent=s,l.postPlaceholderActivityViewEvent=c,l.postPlaceholderActivityPopulateEvent=m}),98);
__d("WAWebDBProcessMessage",["Promise","WALogger","WAWeb-dexie","WAWebAssociationProcessor","WAWebAssociationProcessorConstants","WAWebCommonMsgUtils","WAWebDBDeleteAssociatedMsgsByMsgKey","WAWebDBMessageBulkHelper","WAWebDBMessageSerialization","WAWebDBStoreMessage","WAWebDbEncryptionKey","WAWebHandlePlaceholderWam","WAWebLinkify","WAWebMessageAssociationGatingUtils","WAWebModelStorageUtils","WAWebNoop","WAWebSchemaMessage","WAWebSyncGatingUtils","WAWebViewMode.flow","asyncToGeneratorRuntime","cr:375","err"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p=(e=n("cr:375"))!=null?e:{},_=p.ftsLightClient,f=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="NoMessageToUpdateError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error)),g=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="DuplicateMessageError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error)),h=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="PreviousMsgNotUpdatableError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a){return a===void 0&&(a=!1),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["storeMessages: store ",", for chat ",", isHistorySync: ",""])),e.length,t.toLogString(),a),o("WAWebDBMessageBulkHelper").logMissingGroupParticipantLids(e,a),o("WAWebCommonMsgUtils").logUndefinedMessage(e),yield o("WAWebDbEncryptionKey").DbEncKeyStore.waitForFinalDbMsgEncKey(),(m||(m=n("Promise"))).resolve(o("WAWebDBStoreMessage").storeMessageInTransaction(e,t,a)).then(function(){_==null||_.index().catch(r("WAWebNoop"))}).catch(function(e){throw e instanceof r("WAWeb-dexie").BulkError||e instanceof r("WAWeb-dexie").ConstraintError?new g:(o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Error storing messages"]))),e)})}),C.apply(this,arguments)}function b(e,t){var a,i=t==null?(a=e[0])==null?void 0:a.id.remote:t;if(i){var l=e.map(function(e){var t=o("WAWebDBMessageSerialization").dbRowFromMessage(e);return o("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:t,chatId:i.toString(),hasLink:o("WAWebLinkify").hasHttpLink(e),pendingReadReceipt:!1})});return(m||(m=n("Promise"))).resolve(o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(l)).then(function(){_==null||_.index().catch(r("WAWebNoop"))}).catch(function(e){throw o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error storing messages"]))),e})}return(m||(m=n("Promise"))).resolve()}function v(e){return o("WAWebCommonMsgUtils").isPlaceholderMsg(e.type)?(m||(m=n("Promise"))).resolve(e):o("WAWebModelStorageUtils").getStorage().lock(["message"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],a=yield n.get(e.id.toString());if(!a)throw new f("[messaging] updateMessage: msgId::"+e.id.toString()+", Failed to find previous message row in message table");if(!o("WAWebCommonMsgUtils").isPlaceholderMsg(a.type)&&!o("WAWebCommonMsgUtils").isFutureproofMsg(a.type)&&!o("WAWebCommonMsgUtils").isCallLogMsg(a.type))throw o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["updateMessage: msgId::",", Previous row in message table is not a placeholder or futureproof"])),e.id.toString()).tags("messaging"),new h;var i=e.from,l=babelHelpers.extends({},e);a.t!=null&&(l.t=a.t),a.ack>e.ack&&(l.ack=a.ack);var s=o("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:o("WAWebDBMessageSerialization").dbRowFromMessage(l),chatId:i.toString(),hasLink:o("WAWebLinkify").hasHttpLink(l),rowId:void 0,inChatMsgId:void 0,pendingReadReceipt:a.pendingReadReceipt});if(s.rowId=a.rowId,s.internalId=a.internalId,s.rowId==null||s.internalId==null)throw r("err")("[messaging] updateMessage: msgId::"+e.id.toString()+", missing rowId or internalId");return yield n.createOrReplace(s),o("WAWebCommonMsgUtils").isPlaceholderMsg(a.type)&&o("WAWebHandlePlaceholderWam").postPlaceholderActivityPopulateEvent([o("WAWebDBMessageSerialization").messageFromDbRow(a)]),_==null||_.index().catch(r("WAWebNoop")),l});return function(e){return t.apply(this,arguments)}})())}function S(e){return o("WAWebSchemaMessage").getMessageTable().bulkGet(e).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[],r=e.filter(Boolean).map(function(e){var n={id:e.id,isStarred:o("WAWebSyncGatingUtils").shouldPopulateStarMessageWithTimestamp()?e.t:e.rowId},r=e.associationType;if(r!=null&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var a=o("WAWebAssociationProcessor").getAssociationProcessorByAssociationType(r);a&&a.processorType===o("WAWebAssociationProcessorConstants").AssociationProcessorType.WithDetachedMessages&&(t.push([e.id,r]),n=babelHelpers.extends({},n,{associationType:null,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,parentMsgKey:null}))}return n}),a=[o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(r)];t.length&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&a.push(o("WAWebDBDeleteAssociatedMsgsByMsgKey").bulkDeleteMessagesByMsgKeyAndAssociationType(t)),yield(m||(m=n("Promise"))).all(a)});return function(t){return e.apply(this,arguments)}})())}function R(e){return o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(e.map(function(e){return{id:e,isStarred:void 0}}))}l.NoMessageToUpdateError=f,l.DuplicateMessageError=g,l.PreviousMsgNotUpdatableError=h,l.storeMessages=y,l.updateExistingMessages=b,l.updateMessage=v,l.starMessages=S,l.unstarMessages=R}),98);
__d("WAWebLastAddOnDBSerialization",["WANullthrows"],(function(t,n,r,o,a,i,l){function e(e){switch(e.type){case"reaction":return{type:"reaction",msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,reactionText:e.reactionText,sender:e.sender,timestamp:e.timestamp};case"poll_vote":return{type:"poll_vote",msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,sender:e.sender,timestamp:e.timestamp};case"comment":return{type:"comment",msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,sender:e.sender,timestamp:e.timestamp};case"event_response":return{type:"event_response",msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,sender:e.sender,timestamp:e.timestamp,eventResponse:e.eventResponse}}}function s(e){return{msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,sender:e.senderUserJid,reactionText:e.reactionText,timestamp:e.timestamp,isOrphan:e.orphan===1,type:"reaction"}}function u(e,t){return{msgKey:e.msgKey.toString(),isOrphan:t,selectedOptionsCount:e.selectedOptionLocalIds.length,parentMsgKey:e.parentMsgKey.toString(),sender:e.sender.toString(),timestamp:e.senderTimestampMs,type:"poll_vote"}}function c(e){return{msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,sender:e.sender,timestamp:e.t*1e3,isOrphan:!1,type:"comment"}}function d(e){return{msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,sender:e.senderUserJid,timestamp:e.timestamp,reactionText:r("WANullthrows")(e.reactionText),type:"reaction"}}l.lastAddOnPreviewFromCandidate=e,l.lastAddOnPreviewCandidateFromReactionRowType=s,l.lastAddOnPreviewCandidateFromVoteData=u,l.lastAddOnPreviewCandidateFromCommentRowType=c,l.lastAddOnPreviewFromDeprecatedLastReactionPreview=d}),98);
__d("WAWebDBProcessPollUpdateMsgs",["Promise","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBPollsGetParentMessages","WAWebDBPollsUpsertVotes","WAWebDBStoreMessageOrphans","WAWebDBUpdateLastAddOnPreviewChat","WAWebLastAddOnDBSerialization","WAWebPollsExtractVotes","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length===0)return[];var r=yield o("WAWebDBPollsGetParentMessages").getParentMessages(t),a=r.orphans,i=r.pollUpdateMsgsToParentMsgs;for(var l of i.entries()){var s=l[0],u=l[1];u.pollInvalidated===!0&&i.delete(s)}var c=yield(e||(e=n("Promise"))).all([n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(a.length!==0){yield o("WAWebDBStoreMessageOrphans").storeMessageOrphans(a,function(e){return e.pollUpdateParentKey});var e=a.map(function(e){return e.id.toString()});yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(e)}})(),n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(i.size!==0){var e=yield o("WAWebDBPollsUpsertVotes").upsertVotesDb(yield o("WAWebPollsExtractVotes").extractVotes(i));yield o("WAWebBackendApi").frontendSendAndReceive("upsertVotesModelCollection",{votes:e,votesToRemove:null,restoredFromDb:!1});var t=e.map(function(e){return e.msgKey.toString()});yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(t);var n=yield o("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(e.map(function(e){return o("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromVoteData(e,!1)}));return n.size>0&&(yield o("WAWebDBUpdateLastAddOnPreviewChat").updateDatabaseForLastAddOnPreview(n),o("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:n})),e}})()]),d=c[1];return d!=null?d:[]}),u.apply(this,arguments)}l.processPollUpdateMsgs=s}),98);
__d("WAWebDBProcessReplyMsgs",["WANullthrows","WAWebDBMessageSerialization","WAWebDBMsgUtils","WAWebGroupType","WAWebMessageEditUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebUserPrefsMeUser","asyncToGeneratorRuntime","isStringNullOrEmpty","lodash"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length){var t=yield o("WAWebModelStorageUtils").getStorage().lock(["message"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],a=new Set;e.forEach(function(e){var t=u(e);t!=="missing-stanza-id"&&a.add(t.toString())});var i=(yield o("WAWebDBMsgUtils").getMsgsByMsgKey(Array.from(a.values()))).filter(function(e){var t=o("WAWebMessageEditUtils").getMsgEditType(e.type);return t!=null}),l=new Map(i.map(function(e){return[e.id.toString(),e]})),s=e.filter(function(e){var t=u(e);return t==="missing-stanza-id"?!1:l.has(t.toString())});if(s.length){var c=[];if(s.forEach(function(e){var t=u(e);if(t!=="missing-stanza-id"){var n=r("WANullthrows")(l.get(t.toString()));e.quotedMsg==null?c.push(babelHelpers.extends({},e,{quotedMsg:n})):d(r("WANullthrows")(e.quotedMsg),n)&&c.push(babelHelpers.extends({},e,{quotedMsg:n}))}}),!!c.length)return yield n.bulkCreateOrMerge(c.map(function(e){return o("WAWebDBMessageSerialization").dbRowFromMessage(e)})),c}});return function(e){return t.apply(this,arguments)}})());t!=null&&t.length&&t.forEach(function(t){var n=r("WANullthrows")(e.find(function(e){return e.id.equals(t.id)}));n.quotedMsg=t.quotedMsg})}}),s.apply(this,arguments)}function u(e){var t,n;if(r("isStringNullOrEmpty")(e.quotedStanzaID))return"missing-stanza-id";var a=(t=e.quotedParticipant)!=null?t:void 0,i=(n=e.quotedRemoteJid)!=null?n:e.id.remote;return new(r("WAWebMsgKey"))({id:e.quotedStanzaID,fromMe:o("WAWebUserPrefsMeUser").isMeAccount(a),remote:i,participant:o("WAWebMsgGetters").getIsGroupMsg(e)||a!=null&&a.isBot()?a:void 0})}var c={inviteGrpType:o("WAWebGroupType").GroupType.DEFAULT,thumbnail:"",body:"",caption:"",interactiveAnnotations:[],scanLengths:[],staticUrl:"",pageCount:0};function d(e,t){var n,o=(n=r("lodash")).pickBy(e,function(e,t){return e!=null&&t!=="kind"}),a=n.pickBy(t,function(e,t){return Object.prototype.hasOwnProperty.call(o,t)&&t!=="kind"});return n.defaults(o,c),n.defaults(a,c),!r("lodash").isEqual(o,a)}l.processReplyMsgs=e,l.createQuotedMsgKey=u}),98);
__d("WAWebHandleMessageTypes.flow",[],(function(t,n,r,o,a,i){var e=Object.freeze({ReportingInfo:"reporting_info"});i.MsgAdditionalInfoType=e}),66);
__d("WAWebDBReportingTokenUtils",["Promise","WALogger","WAStanzaUtils","WATimeUtils","WAWebGetMessageCache","WAWebHandleMessageTypes.flow","WAWebMessagingGatingUtils","WAWebMsgKey","WAWebReportingTokenUtils","WAWebSchemaReportingInfo","WAWebSchemaReportingToken","WAWebWidToJid","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s=["reportingTag"],u,c=-1;function d(e){var t,n,a=e.reportingTokenInfo;if(a==null)return null;var i=a.reportingTag,l=a.version,s=e.t;if(i==null||s==null)return null;var u=(t=(n=e.protocolMessageKey)==null?void 0:n.toString())!=null?t:e.id.toString(),c={msgKey:u,stanzaId:r("WAWebMsgKey").from(u).id,msgTs:s,receivedTs:o("WATimeUtils").unixTimeMs(),reportingTag:i};return l!=null&&(c.version=l),c}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!(!o("WAWebMessagingGatingUtils").isReportingTagSyncingEnabled()||e.length===0)){var t=r("compactMap")(e,function(e){return d(e)});return o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkCreate(t)}}),p.apply(this,arguments)}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebSchemaReportingInfo").getReportingInfoTable().anyOf(["msgKey"],e)}),f.apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!(e==null||e<=c)){if(e===0){yield(u||(u=n("Promise"))).all([o("WAWebSchemaReportingToken").getReportingTokenTable().clear(),o("WAWebSchemaReportingInfo").getReportingInfoTable().clear()]);return}var t=o("WATimeUtils").unixTimeMs()-e*o("WATimeUtils").DAY_MILLISECONDS,r=yield o("WAWebSchemaReportingToken").getReportingTokenTable().lessThan(["ts"],t),a=yield o("WAWebSchemaReportingInfo").getReportingInfoTable().lessThan(["receivedTs"],t);yield(u||(u=n("Promise"))).all([o("WAWebSchemaReportingToken").getReportingTokenTable().bulkRemove(r.map(function(e){return e.id})),o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkRemove(a.map(function(e){return e.id}))])}}),h.apply(this,arguments)}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!(e<=c)){var t=o("WATimeUtils").unixTimeMs()-e*o("WATimeUtils").DAY_MILLISECONDS,n=yield o("WAWebSchemaReportingInfo").getReportingInfoTable().lessThan(["receivedTs"],t),r=n.map(function(e){return babelHelpers.extends({},e,{reportingToken:null,reportingTokenContentOpaqueData:null,version:null})});yield o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkCreateOrReplace(r)}}),C.apply(this,arguments)}function b(e){var t=e.incomingMsgReportingTokenInfo,n=e.msgKey,r=e.msgTs,a=e.stanzaId;if(o("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled()&&t!=null){var i=t.reportingTag;i!=null&&o("WAWebGetMessageCache").getMessageCache().addAdditionalInfo({type:o("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingInfo,data:{msgKey:n.toString(),stanzaId:a,reportingTag:i,msgTs:r,receivedTs:o("WATimeUtils").unixTimeMs()}},!0)}}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.sort(function(e,t){var n,r;return((n=e.ts)!=null?n:0)-((r=t.ts)!=null?r:0)});var t=e.map(function(e){return e.id}),n=yield o("WAWebSchemaReportingToken").getReportingTokenTable().bulkGet(t),r=new Map,a=new Set;e.forEach(function(e,t){var o=n[t];if((o==null||o.reportingTag==null)&&!a.has(e.id))r.set(e.id,e);else{var i=e.reportingTag,l=babelHelpers.objectWithoutPropertiesLoose(e,s);r.set(e.id,babelHelpers.extends({},r.get(e.id),l))}a.add(e.id)}),yield o("WAWebSchemaReportingToken").getReportingTokenTable().bulkCreateOrMerge(Array.from(r.values()))}),S.apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkCreate(e)}),L.apply(this,arguments)}function E(e,t){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{if(t.length===0)return;if(n.removeWholeRow)return o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkRemoveByIndex(["msgKey"],t);var r=yield o("WAWebSchemaReportingInfo").getReportingInfoTable().equals(["msgKey"],t);if(r.length===0)return;var a=r.map(function(e){return babelHelpers.extends({},e,{reportingToken:null,reportingTokenContentOpaqueData:null,version:null})});yield o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkCreateOrReplace(a)}catch(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error deleting reporting infos"])))}}),k.apply(this,arguments)}function I(e,t,n,r){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=e.version,i=a===void 0?-1:a,l=e.reportingTokenContentOpaqueData,s=e.reportingToken,u=e.reportingTokenKey,c=l!=null?{reportingContentElementValue:l}:null,d;u!=null?d=u:n!=null&&r!=null&&t!=null&&(d=yield o("WAWebReportingTokenUtils").genReportingTokenKeyFromMessageSecret({messageSecret:n,stanzaId:e.stanzaId,senderJid:o("WAWebWidToJid").widToUserJid(r),remoteJid:t}));var m=d!=null?new Uint8Array(d):new Uint8Array(o("WAWebReportingTokenUtils").REPORTING_TOKEN_KEY_SIZE),p=i!=null&&s!=null?{reportingTokenV:i,reportingTokenElementValue:s,reportingTokenKeyElementValue:m}:null;return{reportingTagElementValue:e.reportingTag,reportingTagTsS:e.msgTs,reportingTagId:o("WAStanzaUtils").toStanzaId(e.stanzaId),reportingContentArgs:c,contentValidationArgs:p}}),T.apply(this,arguments)}function D(e){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0){var t=new Map;for(var n of e){var r=n[0],a=n[1];t.set(r.toString(),a)}var i=Array.from(t.keys()),l=yield _(i);if(l.length!==0){var s=[];l.forEach(function(e){var n=t.get(e.msgKey);e.stanzaId!==n&&s.push(babelHelpers.extends({},e,{reportingToken:null,reportingTokenContentOpaqueData:null,version:null}))}),yield o("WAWebSchemaReportingInfo").getReportingInfoTable().bulkCreateOrReplace(s)}}}),x.apply(this,arguments)}l.DEFAULT_RT_CLEANUP_OLDER_THAN_DAYS=c,l.msgToReportingInfoRow=d,l.handleHistorySyncedReportingInfo=m,l.getReportingInfosFromMsgKeys=_,l.cleanupReportingTable=g,l.cleanupReportingTokenAndContent=y,l.maybeStoreReportingTag=b,l.handleAddReportingTokenInfos=v,l.handleAddReportingInfos=R,l.handleDeleteReportingInfos=E,l.createReportingValidationArgs=I,l.handleReportingInfosUpdateOnMessageEdit=D}),98);
__d("WAWebDBStoreMessageAssociations",["Promise","WALogger","WAWebSchemaMessageAssociation","compactMap"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return o("WAWebSchemaMessageAssociation").getMessageAssociationTable().bulkCreate(e)}function c(t,a){a===void 0&&(a=!1);var i=r("compactMap")(t,function(e){var t=e.associationType,n=e.internalId,r=e.parentMsgKey;return r!=null&&t!=null&&n!=null?{msgKey:e.id.toString(),parentMsgKey:r,associationType:t,msgKeyInternalId:n}:null});return a&&o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: "," associations stored"])),i.length),i.length?u(i):(s||(s=n("Promise"))).resolve()}l.bulkStoreMessageAssociations=c}),98);
__d("WAWebDBStoreMsgsUtils",[],(function(t,n,r,o,a,i){var e=1e9;function l(t,n){return n===void 0&&(n=!1),t.all({reverse:!n,limit:1,index:["rowId"],returnKeyType:"keys"}).then(function(t){return t.length===0?e:t[0]})}i.INLINE_MESSAGE_STARTING_INDEX=e,i.getLastRowId=l}),66);
__d("WAWebDBStoreEncryptedMsgs",["Promise","WALogger","WAPromiseMap","WAWeb-dexie","WAWebDBMessageUtils","WAWebDBMsgUtils","WAWebDBStoreMessage","WAWebDBStoreMessageAssociations","WAWebDBStoreMsgsUtils","WAWebMessageAssociationGatingUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebNoop","WAWebPostIncomingMessageDropMetric","WAWebWidFactory","asyncToGeneratorRuntime","compactMap","cr:375","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k=(e=n("cr:375"))!=null?e:{},I=k.ftsLightClient;function T(e,t,a,i,l){return a===void 0&&(a=!1),i===void 0&&(i=!1),o("WAWebModelStorageUtils").getStorage().lock(["message","message-association"],(function(){var y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(y){a&&o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: lock acquired"])),e.length);var C=y[0],b=y[1],v=e;if(i){var S=yield o("WAWebDBMsgUtils").getMsgsExistByMsgKey(e.map(function(e){var t=e[0];return t.id.toString()}));if(v=e.filter(function(e,t){return!S[t]}),o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: perform fallback for "," out of original "," messages"])),v.length,e.length),v.length===0)return}var R=yield o("WAWebDBStoreMsgsUtils").getLastRowId(C,a);a&&o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: got last row id ",""])),e.length,R);var L=t.map(function(e){return o("WAWebWidFactory").createWid(e)}),E=new Map;yield P(L,a,C,E,o("WAWebDBMessageUtils").InternalIdPrefix.Default,l),a&&o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: chat map built"])),e.length),v.some(function(e){var t=e[0],n=e[1];return t.isGroupStatus===!0})&&(yield P(L.filter(function(e){return e.isGroup()}),a,C,E,o("WAWebDBMessageUtils").InternalIdPrefix.GroupStatus,l),a&&o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: group status map built"])),e.length));var k=l!=null,I=a?-1:1,T=a||k?-1:1,N=(yield o("WAPromiseMap").promiseMap(v,(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e[0],i=e[1];a&&(n.isMdHistoryMsg=!0);var l=r("WAWebMsgKey").fromString(n.id),s=l.remote.toString(),u=R+I*(t+1),c=M(s,o("WAWebDBMessageUtils").getPrefixForInternalId(n)),d=E.get(c);if(d==null||Number.isNaN(d)){var m=a?"history-sync-":"",_=d==null?"null":"nan";o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[storeEncryptedMessage][lastChatMsgId] lastInChatMsgIdMap is "," before calculation with message type ",", sub type ",""])),_,n.type,n.subtype).sendLogs(""+m+_+"-error-check-lastinchatmsgidmap-lastChatMsgId");return}var f=d+T*1;E.set(c,f);var g=!a&&o("WAWebDBStoreMessage").isPendingUnreadReceipt(l,n),h=o("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:n,chatId:s,hasLink:i,rowId:u,inChatMsgId:f,pendingReadReceipt:g});return h});return function(t,n){return e.apply(this,arguments)}})())).filter(Boolean);a&&o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: got "," hydrated messages"])),e.length,N.length);try{o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&(yield o("WAWebDBStoreMessageAssociations").bulkStoreMessageAssociations(N,!0),a&&o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: associations stored"])),e.length)),yield C.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(N,!!a),a&&o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: stored"])),e.length)}catch(t){var w=r("getErrorSafe")(t);if(a&&w instanceof r("WAWeb-dexie").BulkError)o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: BulkError in bulkCreate for history sync msgs, retrying with bulk create or replace"]))),yield C.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(N);else throw(i||!D(e.length,w))&&(x(N,w),$(N)),w}return N});return function(e){return y.apply(this,arguments)}})()).then(function(t){t&&t.length>0&&r("WAWeb-dexie").ignoreTransaction(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){a&&o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: adding "," to indexing table"])),e.length,t.length),yield I==null?void 0:I.addToIndexingTable(r("compactMap")(t,function(e){return e.rowId!=null?String(e.rowId):null})),a&&o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: storing "," messages: schedule fts indexing for "," messages"])),e.length,t.length),I==null||I.index().catch(r("WAWebNoop"))}))})}function D(e,t){return e>1&&t instanceof r("WAWeb-dexie").BulkError}function x(e,t){r("WAWeb-dexie").ignoreTransaction(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=e;if(t instanceof r("WAWeb-dexie").BulkError){var a=e.map(function(e){var t=e.id;return t.toString()}),i=yield o("WAWebDBMsgUtils").getMsgsExistByMsgKey(a);n=e.filter(function(e,t){return!i[t]})}n.length>0?(o("WALogger").WARN(b||(b=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: dropping "," out of "," message(s): ",", due to DB error: ",""])),n.length,e.length,n.map(function(e){var t=e.id;return t}),t),o("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropDBOperationFailedForMsgRows(n)):o("WALogger").WARN(v||(v=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: all "," message(s) are already in the DB"])),e.length)})).catch(function(e){o("WALogger").ERROR(S||(S=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: failed to post db error metrics: ",""])),e).sendLogs("failed-to-post-db-error-metrics")})}function $(e){if(!r("gkx")("26258")){var t=function(t){var e=new Set,n=function(r,a){Object.entries(r).forEach(function(t){var r=t[0],i=t[1];if(typeof i=="function"){var l=[].concat(a,[r]).join(".");o("WALogger").WARN(R||(R=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: message prop '","' is a function and cannot be cloned: ",""])),l,i)}else if(i!=null&&typeof i=="object"){if(e.has(i))return;e.add(i),n(i,[].concat(a,[r]))}})};n(t,[])};try{e.forEach(t)}catch(e){o("WALogger").WARN(L||(L=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: failed to log bad message properties: ",""])),e)}}}function P(e,t,n,r,o,a){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r,a,i,l){if(i===void 0&&(i=o("WAWebDBMessageUtils").InternalIdPrefix.Default),l===void 0&&(l=null),e.length===0)return(E||(E=n("Promise"))).resolve();var s=i;yield(E||(E=n("Promise"))).all(e.map(function(e){if(!(i===o("WAWebDBMessageUtils").InternalIdPrefix.GroupStatus&&!e.isGroup())){if(l!=null&&l.chatId.equals(e)){a.set(M(e.toString(),s),l.anchorInChatMsgId);return}var n=s+o("WAWebDBMessageUtils").beginningOfChat(e),u=s+o("WAWebDBMessageUtils").endOfChat(e);return r.between(["internalId"],n,u,{limit:1,reverse:!t,returnKeyType:"keys"}).then(function(t){var n=o("WAWebDBStoreMsgsUtils").INLINE_MESSAGE_STARTING_INDEX;t.length>0&&t[0]!=null&&(n=o("WAWebDBMessageUtils").getInChatMsgId(t[0])),a.set(M(e.toString(),s),n)})}}))}),N.apply(this,arguments)}function M(e,t){return t===void 0&&(t=""),t+e}l.storeEncryptedDBMessages=T,l.isEligibleForFallback=D,l.buildLastInChatMsgIdMap=P}),98);
__d("WAWebDBGroupHistoryPreProcessor",["WAWebABProps","WAWebApiHydrateWidsUtil","WAWebDBMessageSerialization","WAWebUserPrefsMeUser"],(function(t,n,r,o,a,i,l){function e(e){return!(e.type!=="gp2"||e.subtype!=="add"&&e.subtype!=="community_participant_add_rich"||e.recipients==null||!Array.isArray(e.recipients)||!o("WAWebApiHydrateWidsUtil").hydrateWids(e.recipients).some(function(e){return o("WAWebUserPrefsMeUser").isMeAccount(e)}))}function s(t){return e(o("WAWebDBMessageSerialization").dbRowFromMessage(t))?o("WAWebABProps").getABPropConfigValue("group_history_bump_message_id"):0}l.isMeJoined=e,l.getBumpIdCountForGroupJoin=s}),98);
__d("WAWebMediaHubGating",["WAWebABProps","justknobx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("WAWebABProps").getABPropConfigValue("files_media_hub_web_variant")}function s(){return o("WAWebABProps").getABPropConfigValue("files_media_hub_web")}function u(){return d()?e()===1||e()===2||e()===4||s():!1}function c(){return d()?e()!==0||s():!1}function d(){return r("justknobx")._("4159")}function m(){return o("WAWebABProps").getABPropConfigValue("enable_tooltip_for_media_hub")}function p(){return o("WAWebABProps").getABPropConfigValue("media_hub_history_max_days")}function _(){var t=r("justknobx")._("4160");return t?e()===4||s():!1}l.isFilesMediaHubSidebarEnabled=u,l.isFilesMediaHubComponentEnabled=c,l.isMediaHubM0Enabled=d,l.isNuxMediaHubEnabled=m,l.getMaxDaysInMediaHub=p,l.isMediaHubM1Enabled=_}),98);
__d("WAWebMsgDataUtils",["WALogger","WATimeUtils","WAWebAck","WAWebBizGatingUtils","WAWebBotTypes","WAWebChatGetters","WAWebCommonMsgUtils","WAWebCurrentUser","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){var t=e.type,n=e.subtype,a;return t===o("WAWebMsgType").MSG_TYPE.GP2?n==="subject"?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:n==="add"||n==="invite"||n==="invite_auto_add"||n==="linked_group_join"||n==="community_invite_auto_add_rich"?e.recipients&&o("WAWebUserPrefsMeUser").isMePrimary(e.recipients[0])?a=o("WAWebCommonMsgUtils").EventType.SIGNIFICANT:a=o("WAWebCommonMsgUtils").EventType.IGNORE:n==="community_owner_update"?e.recipients&&o("WAWebUserPrefsMeUser").isMePrimary(e.recipients[0])?a=o("WAWebCommonMsgUtils").EventType.DEFAULT:a=o("WAWebCommonMsgUtils").EventType.IGNORE:n==="linked_group_promote"||n==="linked_group_demote"?r("WAWebWid").isGroup(e.id.remote)&&e.recipients&&o("WAWebUserPrefsMeUser").isMePrimary(e.recipients[0])&&!o("WAWebUserPrefsMeUser").isMeAccount(e.author)?a=o("WAWebCommonMsgUtils").EventType.SIGNIFICANT:a=o("WAWebCommonMsgUtils").EventType.IGNORE:n==="remove"?e.recipients&&o("WAWebUserPrefsMeUser").isMePrimary(e.recipients[0])?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:a=o("WAWebCommonMsgUtils").EventType.IGNORE:n==="create"||n==="empty_subgroup_create"||n==="general_chat_add"?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:n==="created_subgroup_suggestion"?a=o("WAWebCommonMsgUtils").EventType.DEFAULT:n==="parent_group_link"||n==="auto_add"||n==="default_sub_group_admin_add"||n==="community_participant_add_rich"||n==="subgroup_admin_triggered_auto_add"||n==="subgroup_admin_triggered_invite_auto_add"||n==="sibling_group_link"||n==="community_invite_rich"||n==="sub_group_participant_add_rich"||n==="sub_group_invite_rich"||n==="community_link_parent_group_rich"?a=o("WAWebCommonMsgUtils").EventType.SIGNIFICANT:n==="membership_approval_request"||n==="created_membership_requests"||n==="sibling_group_unlink"?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:a=o("WAWebCommonMsgUtils").EventType.IGNORE:t===o("WAWebMsgType").MSG_TYPE.BROADCAST_NOTIFICATION||t===o("WAWebMsgType").MSG_TYPE.NOTIFICATION||t===o("WAWebMsgType").MSG_TYPE.E2E_NOTIFICATION?n==="create"?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:a=o("WAWebCommonMsgUtils").EventType.IGNORE:t===o("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE&&o("WAWebUserPrefsMeUser").isMePrimary(e.from)?a=o("WAWebCommonMsgUtils").EventType.IGNORE:t===o("WAWebMsgType").MSG_TYPE.CALL_LOG?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:e.broadcast===!0?r("WAWebWid").isBroadcast(e.id.remote)?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:a=o("WAWebCommonMsgUtils").EventType.IGNORE:o("WAWebMsgGetters").getIsGroupStatus(e)||t===o("WAWebMsgType").MSG_TYPE.REVOKED?a=o("WAWebCommonMsgUtils").EventType.IGNORE:r("WAWebWid").isPSA(e.id.remote)?a=e.ack===o("WAWebAck").ACK.RECEIVED?o("WAWebCommonMsgUtils").EventType.DEFAULT:o("WAWebCommonMsgUtils").EventType.AMBIENT:t===o("WAWebMsgType").MSG_TYPE.CIPHERTEXT||t===o("WAWebMsgType").MSG_TYPE.OVERSIZED?a=o("WAWebCommonMsgUtils").EventType.AMBIENT:t===o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE?n==="sender_invite"||(n==="chat_assignment"||n==="chat_assignment_unassign")&&o("WAWebBizGatingUtils").shouldReorderChatOnAssignment(n==="chat_assignment_unassign")?a=o("WAWebCommonMsgUtils").EventType.NOTEWORTHY:a=o("WAWebCommonMsgUtils").EventType.IGNORE:t===o("WAWebMsgType").MSG_TYPE.PROTOCOL&&n==="ephemeral_setting"||t===o("WAWebMsgType").MSG_TYPE.REACTION?a=o("WAWebCommonMsgUtils").EventType.IGNORE:a=o("WAWebCommonMsgUtils").EventType.DEFAULT,a}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a,i=t.id,l=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),s=o("WAWebUserPrefsMeUser").getMeLidUserOrThrow(),u=t.id.isLid()?s:l,c=void 0;if(o("WAWebChatGetters").getIsGroup(t)){var d;if(u=((d=t.groupMetadata)==null?void 0:d.isLidAddressingMode)===!0?s:l,c=o("WAWebWidFactory").asUserWidOrThrow(u),o("WAWebCurrentUser").isEmployee()){var m;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["genOutgoingMsgData: generating key for group ",", has metadata: ",",\n          isLidAddressingMode: ",", participant: ",""])),i.toString(),t.groupMetadata!=null,(m=t.groupMetadata)==null?void 0:m.isLidAddressingMode,c)}}else t.id.isStatus()&&(c=l);var p=new(r("WAWebMsgKey"))({from:u,to:i,id:yield r("WAWebMsgKey").newId(),participant:c,selfDir:"out"}),_=(a=t.contact.businessProfile)==null?void 0:a.automatedType,f;return _&&(f=_===o("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P?o("WAWebBotTypes").BizBotType.BIZ_1P:_===o("WAWebBotTypes").BizBotAutomatedType.FULL_3P?o("WAWebBotTypes").BizBotType.BIZ_3P:_===o("WAWebBotTypes").BizBotAutomatedType.UNKNOWN?null:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+_)})()),{id:p,from:u,to:i,type:n,t:o("WATimeUtils").unixTime(),viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,isNewMsg:!0,local:!0,ack:o("WAWebAck").ACK.CLOCK,bizBotType:f}}),c.apply(this,arguments)}l.eventTypeFromMsgType=s,l.genOutgoingMsgData=u}),98);
__d("WAWebDBStoreMessage",["Promise","WAJids","WALogger","WAPromiseMap","WAWeb-dexie","WAWebCommonMsgUtils","WAWebDBGroupHistoryPreProcessor","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebDBMsgUtils","WAWebLinkify","WAWebMediaHubGating","WAWebModelStorageUtils","WAWebMsgDataUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebNewsletterDBUtils","WAWebSchemaFtsIndexingQueue","WAWebSyncGatingUtils","WAWebWid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d=[o("WAWebMsgType").MSG_TYPE.IMAGE,o("WAWebMsgType").MSG_TYPE.VIDEO,o("WAWebMsgType").MSG_TYPE.AUDIO],m=1e9;function p(e){return e.some(function(e){return e.type!==o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE})}function _(t,a,i){i===void 0&&(i=!1);var l=a==null?t[0].id.remote:a,s=o("WAWebDBMessageUtils").beginningOfChat(l),u=o("WAWebDBMessageUtils").endOfChat(l),d=C("storeMessageInTransaction: "+t.length+" message(s), chat "+((l==null?void 0:l.toString())||"-"));return o("WAWebModelStorageUtils").getStorage().lock(["chat","message"],(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a=r[0],_=r[1];d.addStage("got table lock");var h=yield a.get(l.toString());if(d.addStage("got chat"),!l.isStatus()&&(h!=null||p(t))){var C=g(h,t,l);o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["storeMessageInTransaction: createOrMerge ",". chat exists: ",""])),l.toLogString(),h!=null),yield a.createOrMerge(l.toString(),C)}d.addStage("got messages meta");var b=_.all({reverse:!i,limit:1,index:["rowId"],returnKeyType:"keys"}).then(function(e){return d.addStage("got boundary row id"),e.length===0?m:e[0]}),v=_.between(["internalId"],s,u,{limit:1,reverse:!i,returnKeyType:"keys"}).then(function(e){return d.addStage("got chat msg boundary id"),e.length===0?m:o("WAWebDBMessageUtils").getInChatMsgId(e[0])}),S=yield(c||(c=n("Promise"))).all([b,v]),R=S[0],L=S[1];d.addStage("got boundaries");var E=i?R-t.length:R+1,k=i?L-t.length:L+1,I=yield o("WAPromiseMap").promiseMap(t,(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r=o("WAWebDBMessageSerialization").dbRowFromMessage(e),a=!i&&f(e.id,e);return y({msg:r,chatId:l.toString(),hasLink:o("WAWebLinkify").hasHttpLink(e),rowId:E+t,inChatMsgId:o("WAWebMsgGetters").getIsNewsletterMsg(e)?(n=e.serverId)!=null?n:yield o("WAWebNewsletterDBUtils").getTemporaryServerId(l):k+t+o("WAWebDBGroupHistoryPreProcessor").getBumpIdCountForGroupJoin(e),pendingReadReceipt:a})});return function(t,n){return e.apply(this,arguments)}})());return d.addStage("messages ready for storing in db"),_.bulkCreate(I).then(function(){return I})});return function(e){return r.apply(this,arguments)}})()).then(function(e){d.done(),r("WAWeb-dexie").ignoreTransaction(function(){o("WAWebSchemaFtsIndexingQueue").getFtsIndexingQueueTable().bulkCreateOrReplace(e.map(function(e){return{id:String(e.rowId)}}))})})}function f(e,t){if(e.fromMe||e.remote.isStatus())return!1;var n=o("WAWebMsgDataUtils").eventTypeFromMsgType(t);return n===o("WAWebCommonMsgUtils").EventType.AMBIENT||n===o("WAWebCommonMsgUtils").EventType.DEFAULT}function g(e,t,n){var r,a,i=void 0,l=Math.max(0,(r=e==null?void 0:e.unreadCount)!=null?r:0),s=(a=e==null?void 0:e.unreadMentionsOfMe)!=null?a:[];return t.forEach(function(e){var t=o("WAWebMsgDataUtils").eventTypeFromMsgType(e);if(t!==o("WAWebCommonMsgUtils").EventType.IGNORE){e&&e.t!=null&&(i==null||e.t>i)&&(i=e.t),(t===o("WAWebCommonMsgUtils").EventType.AMBIENT||t===o("WAWebCommonMsgUtils").EventType.DEFAULT)&&!e.id.fromMe&&(l+=1);var n=f(e.id,e);if(n&&o("WAWebMsgGetters").getIsImportantMessage(e)){var r={id:e.id.toString(),timestamp:e.t};s.push(r)}}}),e&&e.t!=null&&(i==null||e.t>i)&&(i=e.t),{id:n.toString(),unreadCount:l,t:i,unreadMentionsOfMe:s}}function h(e,t){var n=0;switch(e){case o("WAWebMsgType").MSG_TYPE.DOCUMENT:{n|=o("WAWebMsgType").MESSAGE_TYPE_FLAGS.DOC_MSG;break}case o("WAWebMsgType").MSG_TYPE.IMAGE:case o("WAWebMsgType").MSG_TYPE.VIDEO:{n|=o("WAWebMsgType").MESSAGE_TYPE_FLAGS.MEDIA_MSG;break}default:break}return t&&(n|=o("WAWebMsgType").MESSAGE_TYPE_FLAGS.HAS_LINK),n===0?void 0:n}function y(e){var t,n,a=e.chatId,i=e.hasLink,l=e.inChatMsgId,u=e.msg,c=e.pendingReadReceipt,m=e.rowId,p=d.includes(u.type),_=o("WAWebSyncGatingUtils").shouldPopulateStarMessageWithTimestamp()?u.t:m,f=u.type==="chat"&&i,g=babelHelpers.extends({},u,{vcardWAids:u.vcardWAids||o("WAWebDBMessageUtils").getVcardWids(u),id:u.id.toString(),isStarred:u.star?_:void 0,hasLink:f?m:void 0,isMediaMsg:p?m:void 0,isDocMsg:u.type===o("WAWebMsgType").MSG_TYPE.DOCUMENT?m:void 0,isCallLogMsg:u.type===o("WAWebMsgType").MSG_TYPE.CALL_LOG?u.t:void 0,isCarouselMsg:u.carouselCardsParsed!=null?m:void 0,isEventMsg:u.type===o("WAWebMsgType").MSG_TYPE.EVENT_CREATION?m:void 0,expiredTimestamp:(t=o("WAWebMsgGetters").getEphemeralExpirationTimestamp(u))!=null?t:void 0}),y=o("WAWebModelStorageUtils").getStorage(),C=y.doesLocalSchemaIncludeVersion((n=y.versions)==null?void 0:n.version(167)),b=o("WAWebMediaHubGating").isFilesMediaHubComponentEnabled(),v=a!=null&&!r("WAWebWid").isStatus(a)&&!r("WAWebWid").isNewsletter(a)&&C&&b;if(v){var S=h(u.type,f);S!=null&&(g.typeFlag=S)}if(m!=null&&(g.rowId=m),l!=null){var R=o("WAWebDBMessageUtils").getPrefixForInternalId(u);g.internalId=o("WAWebDBMessageUtils").craftInternalId(a,l,R)}l!=null&&u.threadIds!=null&&(g.internalThreadIDs=u.threadIds.map(function(e){return o("WAWebDBMessageUtils").craftInternalThreadId(l,e)})),c&&a!==o("WAJids").STATUS_JID&&(g.pendingReadReceipt=o("WAWebDBMsgUtils").PendingReadReceiptType.Message);var L=u.c2sTimestamp;if(u.id.fromMe){var E;L=(E=u.c2sTimestamp)!=null?E:u.t}else L=u.t;try{u.type!==o("WAWebMsgType").MSG_TYPE.REACTION&&(g.messageRangeIndex=o("WAWebDBMessageUtils").craftMessageRangeIndex(a,!r("WAWebMsgKey").fromString(u.id).fromMe,o("WAWebMsgType").SYSTEM_MESSAGE_TYPES.includes(u.type),L))}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[process-msg] craftMessageRangeIndex failed with error ",""])),e)}return g}function C(e){var t=5e3,n=Date.now(),r=[];return{addStage:function(t){r.push([t,Date.now()-n])},done:function(){if(Date.now()-n>t){for(var a of r)var i=a[0],l=a[1];o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",": completed in ","ms"])),e,Date.now()-n)}}}}l.storeMessageInTransaction=_,l.isPendingUnreadReceipt=f,l.getMsgFlagType=h,l.addMsgMetadataToMsgRow=y}),98);
__d("WAWebApiOrphanRevoke",["WANullthrows","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebProcessBaseMsgInfo","WAWebSchemaOrphanRevoke","WAWebViewMode.flow","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=new Map,s=!1,u={reset:function(){e=new Map,s=!1},bulkRemoveOrphans:function(n){return n.forEach(function(t){e.delete(t.msgKey)}),o("WAWebSchemaOrphanRevoke").getOrphanRevokeTable().bulkRemove(n.map(function(e){return e.msgKey}))},bulkCreateOrReplaceOrphanRevokes:function(n){return n.forEach(function(t){e.has(t.msgKey)&&e.delete(t.msgKey),e.set(t.msgKey,t)}),o("WAWebSchemaOrphanRevoke").getOrphanRevokeTable().bulkCreateOrReplace(n)},getAllOrphanRevokes:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!s){var t=yield o("WAWebSchemaOrphanRevoke").getOrphanRevokeTable().all();e=new Map(t.map(function(e){return[e.msgKey,e]})),s=!0}return e});function r(){return t.apply(this,arguments)}return r})()};function c(e){return u.bulkCreateOrReplaceOrphanRevokes(e)}function d(){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return u.getAllOrphanRevokes()}),m.apply(this,arguments)}function p(e){return u.bulkRemoveOrphans(e)}function _(e,t){var n;return{id:e.id,to:e.to,author:e.author,revokeSender:o("WAWebWidFactory").createWidFromWidLike((n=t.sender)!=null?n:o("WAWebMsgGetters").getSender(e)),type:o("WAWebMsgType").MSG_TYPE.REVOKED,kind:o("WAWebMsgType").MsgKind.RevokedMessage,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:t.subtype==="admin_revoke"?"admin":"sender",protocolMessageKey:e.id,from:e.from,t:e.t,broadcast:e.broadcast}}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield u.getAllOrphanRevokes(),n=[],a=[];return e.forEach(function(e){var i=e.id.toString();if(t.has(i)){var l=r("WANullthrows")(t.get(i));a.push(babelHelpers.extends({},o("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(e),{id:r("WAWebMsgKey").fromString(l.msgKey),type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.ProtocolRevoke,subtype:l.subtype==="admin_revoke"?"admin_revoke":"sender_revoke",protocolMessageKey:e.id,t:l.timestamp})),n.push(l)}}),yield u.bulkRemoveOrphans(n),a}),g.apply(this,arguments)}l.addOrphanRevokes=c,l.getOrphansRevokesCache=d,l.bulkRemoveOrphansUsingOrphansCache=p,l.createRevokeMsgFromOrphanRevoke=_,l.applyAddonRevokes=f}),98);
__d("WAWebDBAssociatedMsgsAttachDetachAPI",["$InternalEnum","WALogger","WAWebAssociationProcessor","WAWebAssociationProcessorConstants","WAWebBackendApi","WAWebDBGetAssociatedMsgsByParentMsgKey","WAWebMessageAssociationGatingUtils","WAWebSchemaMessage","WAWebViewMode.flow","asyncToGeneratorRuntime","nullthrows"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum").Mirrored(["Attach","Detach"]);function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield d(e.map(function(e){return e.id})),n=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(t.map(function(e){return e.msgKey.toString()}),!1),a=_(n.filter(Boolean),s.Attach).filter(Boolean);yield o("WAWebSchemaMessage").getMessageTable().bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(a);var i=new Map;a.forEach(function(e){var t=r("nullthrows")(e.viewMode);i.set(e.id,t)}),o("WAWebBackendApi").frontendFireAndForget("updateViewModeForMsgs",{msgIdsViewModeMap:i})}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(!o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled())return[];var n=yield o("WAWebDBGetAssociatedMsgsByParentMsgKey").bulkGetMessagesByParentMsgKey(t);return n.length&&o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[viewModeUpdate] found associated msgs"]))),n}),m.apply(this,arguments)}function p(e,t){var n=[];return e.map(function(e){var r=o("WAWebAssociationProcessor").getAssociationProcessorByAssociationType(e.associationType);if(r){var a=!0;t===s.Detach&&(a=(r==null?void 0:r.processorType)===o("WAWebAssociationProcessorConstants").AssociationProcessorType.WithDetachedMessages),r&&a&&n.push(e)}}),n}function _(e,t){return o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()?e.map(function(e){if(!e.associationType)return null;var n=o("WAWebAssociationProcessor").getAssociationProcessorByAssociationType(e.associationType);return n==null?null:babelHelpers.extends({},e,{viewMode:t===s.Detach?o("WAWebViewMode.flow").ViewModeType.VISIBLE:n.viewMode})}):[]}function f(e){return o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()?e.map(function(e){if(!e.associationType)return null;var t=o("WAWebAssociationProcessor").getAssociationProcessorByAssociationType(e.associationType);return t==null?null:babelHelpers.extends({},e,{viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,parentMsgKey:void 0,associationType:void 0})}):[]}l.ViewModeUpdateType=s,l.processOrphansFromAssociationsTableForNewMsg=u,l.getAssociatedMsgsByParentMsgKeyFromAssociationTable=d,l.getValidAssociatedMsgs=p,l.getDetachedForeverAssociatedMsgs=f}),98);
__d("WAWebRevokeMsgConstants",["WATimeUtils"],(function(t,n,r,o,a,i,l){var e=2.5*o("WATimeUtils").DAY_SECONDS,s=12*o("WATimeUtils").HOUR_SECONDS,u=30*o("WATimeUtils").DAY_SECONDS;l.REVOKE_WINDOW=e,l.REVOKE_WINDOW_RECEIVER_MARGIN=s,l.NEWSLETTER_REVOKE_WINDOW=u}),98);
__d("WAWebRevoke",["WAWebMsgKey","WAWebRevokeMsgConstants","WAWebWid"],(function(t,n,r,o,a,i,l){function e(e){var t=e.originalKey,n=e.revokeKey;return new(r("WAWebMsgKey"))({fromMe:t.fromMe,id:n.id,remote:t.remote,participant:t.participant})}function s(e){var t=e.revokedMsgKey,n=e.revokedMsgTimestamp,a=e.revokeTimestamp,i=r("WAWebWid").isNewsletter(t.remote)?o("WAWebRevokeMsgConstants").NEWSLETTER_REVOKE_WINDOW:o("WAWebRevokeMsgConstants").REVOKE_WINDOW,l=i+o("WAWebRevokeMsgConstants").REVOKE_WINDOW_RECEIVER_MARGIN;return a-n<=l}l.getMsgKeyAfterRevoke=e,l.isWithinRevokeWindow=s}),98);
__d("WAWebDBStoreRevokeMsgs",["Promise","WALogger","WAWebAddonProcessRevoke","WAWebApiChat","WAWebApiOrphanRevoke","WAWebBackendApi","WAWebDBAssociatedMsgsAttachDetachAPI","WAWebDBReportingTokenUtils","WAWebLidMigrationUtils","WAWebMessageAssociationGatingUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebNoop","WAWebRevoke","WAWebSchemaMessage","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","cr:375","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b=(e=n("cr:375"))!=null?e:{},v=b.ftsLightClient,S=20;function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Set,a=[],i=[],l=new Map,b=new Map,S=[],R=[],L=e.filter(function(e){var t=e.newMsgKey,n=e.revokeMsgKey,a=e.subtype,i=!0;return a==="admin_revoke"?!r("WAWebWid").isGroup(n.remote)&&!r("WAWebWid").isNewsletter(n.remote)?(i=!1,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: "," has not been revoked"])),String(n)),o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: admin revoke has to be sent to a group or newsletter chat"]))).sendLogs("process-admin-revoke-message")):r("WAWebWid").equals(n.remote,t.remote)||(i=!1,o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: "," has not been revoked"])),String(n)),o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: admin revoke came for the different group than the original message was in"]))).sendLogs("process-admin-revoke-message")):(i=r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(n.remote,t.remote))&&r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(n.participant,t.participant))&&n.fromMe===t.fromMe,i||(o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: invalid revoke request ",", ",""])),String(n),String(t)),o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: sending invalid revoke for secondary validation as bot invoker revoke"]))),b.set(e.revokeMsgKey.id,e))),i});if(b.size>0)try{var k=Array.from(b.entries()),I=k.map(function(e){return e[1].revokeMsgKey.toString()}),T=k.map(function(e){var t;return(t=o("WAWebLidMigrationUtils").getAlternateMsgKey(e[1].revokeMsgKey))==null?void 0:t.toString()}),D=yield o("WAWebSchemaMessage").getMessageTable().bulkGet([].concat(I,T),!1);D.forEach(function(e){var t=!1;if(e!=null){var n=r("WAWebMsgKey").from(e.id),a=b.get(n.id);if(a!=null){var i=a.newMsgKey,l=a.sender,s=a.subtype;if(s!=="admin_revoke"){var u=n.remote,c=e.botTargetSenderJid?o("WAWebWidFactory").createWidFromWidLike(e.botTargetSenderJid):null;if(!(c==null||u==null)){var d=e.botPluginSearchUrl!=null&&e.botResponseTargetId!=null,m=!d&&e.botPluginMaybeParent===!0;if(u.isGroup()?r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(c,i.participant))&&(t=!0):u.isBot()||r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(c,l))&&(t=!0),t){S.push(a);var p=e.botResponseTargetId,_=e.internalId;(d||m)&&_!=null&&p!=null&&R.push({internalId:_,targetId:p})}}}}}}),L.push.apply(L,S)}catch(e){var x=r("getErrorSafe")(e);o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Store Revoked Msg: re-validate bot revoke failed with error: ",", stack: ",""])),x.name,x.stack).sendLogs("Re-validate revoke failed")}if(R.length>0)try{yield E(R)}catch(e){var $=r("getErrorSafe")(e);o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Store Revoked Msg: delete associated carousel revoke failed with error: ",", stack: ",""])),$.name,$.stack).sendLogs("Plugin carousel delete revoke failed")}var P=[],N=yield(C||(C=n("Promise"))).all([o("WAWebModelStorageUtils").getStorage().lock(["message","message-association"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var s=e[0],u=e[1],c=[].concat(L.map(function(e){return e.revokeMsgKey}),L.map(function(e){return o("WAWebLidMigrationUtils").getAlternateMsgKey(e.revokeMsgKey)}),L.map(function(e){return e.newMsgKey})),d=[];if(o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var m=yield o("WAWebDBAssociatedMsgsAttachDetachAPI").getAssociatedMsgsByParentMsgKeyFromAssociationTable(c.filter(Boolean)),p=o("WAWebDBAssociatedMsgsAttachDetachAPI").getValidAssociatedMsgs(m,o("WAWebDBAssociatedMsgsAttachDetachAPI").ViewModeUpdateType.Detach);d=p.map(function(e){return e.msgKey})}var _=[].concat(c.map(function(e){return e?e.toString():""}),d),f=yield s.bulkGet(_,!1),b=[],v=L.length,S=f.slice(0,v),R=f.slice(v,v*2),E=f.slice(v*2,v*3),k=f.slice(v*3).filter(Boolean),I=[];if(L.forEach(function(e,n){var s,u,c=(s=S[n])!=null?s:R[n],d=E[n];if(c==null){o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsg: revoke is orphan or an addon ",""])),e.revokeMsgKey),b.push(e);return}if(!o("WAWebRevoke").isWithinRevokeWindow({revokedMsgKey:r("WAWebMsgKey").fromString(c.id),revokedMsgTimestamp:c.t,revokeTimestamp:e.revokeTimestamp})){o("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: "," is outside revoke window"])),String(e.revokeMsgKey));return}t.add(c.id),i.push(String(c.rowId)),o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&c.associationType!=null&&P.push([c.id,c.associationType]);var m=o("WAWebRevoke").getMsgKeyAfterRevoke({originalKey:r("WAWebMsgKey").from(c.id),revokeKey:e.newMsgKey}),p={id:m.toString(),ack:c.ack,to:c.to,author:c.author,type:o("WAWebMsgType").MSG_TYPE.REVOKED,subtype:e.subtype==="admin_revoke"?"admin":"sender",revokeSender:e.sender,protocolMessageKey:c.id,protocolMessageRowId:d==null?void 0:d.rowId,from:c.from,t:c.t,rowId:c.rowId,internalId:c.internalId,messageRangeIndex:c.messageRangeIndex,revokeTimestamp:e.revokeTimestamp,disappearingModeInitiator:c.disappearingModeInitiator,ephemeralDuration:c.ephemeralDuration,ephemeralSettingTimestamp:c.ephemeralSettingTimestamp,viewMode:(u=e.viewMode)!=null?u:c.viewMode};if(a.push(p),o("WAWebMsgGetters").getIsImportantMessage(c)){var _=r("WAWebMsgKey").fromString(c.id),f=_.remote.toString();if(l.has(f)){var y,C=(y=l.get(f))!=null?y:[];l.set(f,[].concat(C,[c.id]))}else l.set(f,[c.id])}}),k!=null&&k.length){var T=o("WAWebDBAssociatedMsgsAttachDetachAPI").getDetachedForeverAssociatedMsgs(k).filter(Boolean);T.forEach(function(e){e!=null&&!t.has(e.id)&&I.push(e)}),k.forEach(function(e){P.push([e.id,e.associationType])}),o("WAWebBackendApi").frontendFireAndForget("detachAssociatedMsgsForever",{msgIds:T.map(function(e){return e.id})})}var D=[],x=[];return t.size>0&&D.push(s.bulkRemove(Array.from(t)).catch(function(e){throw o("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Store Revoked Msg: failed to remove "," revoked messages: ",""])),t.size,e).sendLogs("store-revoked-msg-failed-to-remove-revoked-messages"),e})),P.length>0&&D.push(u.bulkRemove(P)),yield(C||(C=n("Promise"))).all(D),(a.length>0||I.length>0)&&x.push(s.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY([].concat(a,I))),yield C.all(x),b});return function(t){return e.apply(this,arguments)}})()),o("WAWebAddonProcessRevoke").processRevokeMsgs(L)]),M=N[0],w=N[1];if(M.length>0){var A=M.filter(function(e){return w.has(e.revokeMsgKey)}).map(function(e){var t;return{msgKey:e.revokeMsgKey.toString(),sender:e.sender,timestamp:e.timestamp,subtype:(t=e.subtype)!=null?t:"sender_revoke"}});A.length>0&&(yield o("WAWebApiOrphanRevoke").addOrphanRevokes(A))}v==null||v.purge(i).catch(r("WAWebNoop")),o("WAWebDBReportingTokenUtils").handleDeleteReportingInfos(t?Array.from(t):[],{removeWholeRow:!1}),l.size>0&&o("WAWebApiChat").removeUnreadMentionChat(l)}),L.apply(this,arguments)}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[],a=[],i=e.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield I(e),r=n.pluginLinkMsgIds,i=n.pluginLinkMsgIdsRowIds;t=[].concat(t,r),a=[].concat(a,i),yield o("WAWebSchemaMessage").getMessageTable().bulkRemove(t)});return function(t){return e.apply(this,arguments)}})());yield(C||(C=n("Promise"))).all(i),v==null||v.purge(a).catch(r("WAWebNoop")),o("WAWebBackendApi").frontendFireAndForget("deleteAssociatedBotCarouselMsgs",{msgKeys:t})}),k.apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[],n=[],r=e.internalId,a=e.targetId,i=r.split("_")[0];return yield o("WAWebSchemaMessage").getMessageTable().between(["internalId"],r,i+"_g",{reverse:!1,limit:S,shouldDecrypt:!1},function(e){if(e.botResponseTargetId===a)t.push(e.id),n.push(String(e.rowId));else return!0;return!1}),{pluginLinkMsgIds:t,pluginLinkMsgIdsRowIds:n}}),T.apply(this,arguments)}l.processRevokeMsgs=R,l.findAndDeleteAssociatedPluginMsg=E,l.findAssociatedPluginMsgs=I}),98);
__d("WAWebDeviceListPk",["invariant"],(function(t,n,r,o,a,i,l,s){function e(e){return e.server==="lid"||e.server==="hosted.lid"?e.user+"@lid":e.server==="c.us"||e.server==="hosted"?e.user:e.server==="bot"?e.user+"@bot":e.server==="s.whatsapp.net"||e.server==="g.us"||e.server==="broadcast"||e.server==="call"||e.server==="newsletter"?s(!1,'Jid %s is not fully qualified to create a device list pk, jid.server should be "c.us" or "lid"',e.toString({legacy:!0})):(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e.server)})()}l.createDeviceListPK=e}),98);
__d("WAWebApiDeviceList",["Promise","WAJids","WALogger","WALruCache","WAWebApiContact","WAWebDeviceListPk","WAWebSchemaDeviceList","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u,c=new(o("WALruCache")).LruCache({sizeLimit:5e3,getSize:function(){return 1}});function d(e){var t,r=o("WAWebDeviceListPk").createDeviceListPK(e);if(!c.has(r)){var a=o("WAWebSchemaDeviceList").getDeviceListTable().get(r);c.put(r,a)}return c.get(r)!=null&&o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_API_DEVICE_LIST_GET_DEVICE_RECORD),(t=c.get(r))!=null?t:(u||(u=n("Promise"))).resolve(null)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[];if(e.forEach(function(e){c.has(o("WAWebDeviceListPk").createDeviceListPK(e))||t.push(o("WAWebDeviceListPk").createDeviceListPK(e))}),t.length>0){var r=yield o("WAWebSchemaDeviceList").getDeviceListTable().bulkGet(t);r.forEach(function(e,r){c.put(t[r],(u||(u=n("Promise"))).resolve(e))})}var a=e.filter(function(e){return c.get(o("WAWebDeviceListPk").createDeviceListPK(e))!=null});return a.length>0&&o("WAWebApiContact").checkPnToLidMapping(a,o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_API_DEVICE_LIST_BULK_GET_DEVICE_RECORD),(u||(u=n("Promise"))).all(e.map(function(e){return c.get(o("WAWebDeviceListPk").createDeviceListPK(e))}))}),p.apply(this,arguments)}function _(t){if(t.deleted){var n=o("WAWebWidFactory").createUserWidFromDeviceListPk(t.id);o("WAWebUserPrefsMeUser").isMeAccount(n)&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["syncd: trying to delete own device list"])))}}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WAWebApiContact").checkPnToLidMapping([o("WAWebWidFactory").createUserWidFromDeviceListPk(e.id)],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_API_DEVICE_LIST_CREATE_OR_REPLACE_DEVICE_RECORD),yield o("WAWebSchemaDeviceList").getDeviceListTable().createOrReplace(e),c.put(e.id,(u||(u=n("Promise"))).resolve(e)),_(e)}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WAWebApiContact").checkPnToLidMapping(e.map(function(e){return o("WAWebWidFactory").createUserWidFromDeviceListPk(e.id)}),o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_API_DEVICE_LIST_BULK_CREATE_OR_REPLACE_DEVICE_RECORD),yield o("WAWebSchemaDeviceList").getDeviceListTable().bulkCreateOrReplace(e),e.forEach(function(e){c.put(e.id,(u||(u=n("Promise"))).resolve(e)),_(e)})}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){t===void 0&&(t=!1);var n=Array.from(yield m(e));if(t){var r=new Map;n.forEach(function(e){e!=null&&r.set(e.id,e)});var a=new Map;e.forEach(function(e,t){a.set(e.toString(),t)});var i=e.reduce(function(e,t){if(!t.isUser())return e;var n=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").asUserWidOrThrow(t));return n!=null&&e.push(n),e},[]),l=yield m(i);l.forEach(function(e,t){if(!(!e||e.deleted)){var l=i[t],s=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").asUserWidOrThrow(l));if(s!=null){var u=r.get(o("WAWebDeviceListPk").createDeviceListPK(s));if(u){if(!u.deleted){var c=new Set(u.devices.map(function(e){return e.id}));e.devices.forEach(function(e){c.has(e.id)||u.devices.push(e)})}}else{var d=a.get(s.toString());d!=null&&(n[d]={id:o("WAWebDeviceListPk").createDeviceListPK(s),deleted:e.deleted,devices:e.devices,currentIndex:e.currentIndex,rawId:e.rawId,timestamp:e.timestamp,validIndexes:e.validIndexes})}}}})}return n.map(function(e){if(e&&!e.deleted){var t=e.devices.map(function(e){return{id:e.id,isHosted:e.isHosted}});return{id:e.id,devices:t}}return null})}),b.apply(this,arguments)}function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t===o("WAJids").DEFAULT_DEVICE_ID)return!0;var n=yield C([e]),r=n[0];return!(!r||!r.devices.some(function(e){return e.id===t}))}),S.apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield m(e);return t.map(function(e){if(e&&!e.deleted){var t=e.devices.map(function(e){return{id:e.id,isHosted:e.isHosted}});return{id:e.id,devices:t,timestamp:e.timestamp,expectedTs:e.expectedTs}}return null})}),L.apply(this,arguments)}function E(){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=o("WAWebUserPrefsMeUser").getMeDevicePnOrThrow(),t=yield d(e);if(!t||t.deleted){var n=o("WAWebUserPrefsMeUser").getMeDeviceLidOrThrow(),a=yield d(n);throw o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncd: cannot find my device list: PN record exists: "," deleted: ",". LID record exists: "," deleted: ",""])),t!=null,(t==null?void 0:t.deleted)===!0,a!=null,(a==null?void 0:a.deleted)===!0),r("err")("syncd: cannot find my device list")}return t}),k.apply(this,arguments)}function I(){return o("WAWebSchemaDeviceList").getDeviceListTable().all()}l.getDeviceRecord=d,l.bulkGetDeviceRecord=m,l.createOrReplaceDeviceRecord=f,l.bulkCreateOrReplaceDeviceRecord=h,l.getDeviceIds=C,l.hasDevice=v,l.getDeviceInfoForSync=R,l.getMyDeviceList=E,l.getAllDeviceLists=I}),98);
__d("WAWebBroadcastInvalidChannelsContextSourceMessageDropWamEvent",["WAWebWamCodegenUtils"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({BroadcastInvalidChannelsContextSourceMessageDrop:[7284,{wasDropped:[1,o("WAWebWamCodegenUtils").TYPES.BOOLEAN]},[1,1,1],"private",0]},{BroadcastInvalidChannelsContextSourceMessageDrop:[]});l.BroadcastInvalidChannelsContextSourceMessageDropWamEvent=e}),98);
__d("WAWebHandleMsgMetaUtils",["WAWebHandleMsgCommon","WAWebMsgType"],(function(t,n,r,o,a,i,l){var e=function(t){return(t==null?void 0:t.type)===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction},s=function(t){return(t==null?void 0:t.type)===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll&&(t==null?void 0:t.pollType)===o("WAWebHandleMsgCommon").POLL_TYPES.vote},u=function(t){return(t==null?void 0:t.type)===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text&&(t==null?void 0:t.threadMsgId)!=null&&(t==null?void 0:t.threadMsgSenderJid)!=null},c=function(t){return(t==null?void 0:t.type)===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event&&(t==null?void 0:t.eventType)===o("WAWebHandleMsgCommon").EVENT_TYPES.response},d=function(t){return(t==null?void 0:t.type)===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event&&(t==null?void 0:t.eventType)===o("WAWebHandleMsgCommon").EVENT_TYPES.edit},m=function(t){return(t==null?void 0:t.type)===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.media};function p(e){if(e!=null&&u(e))return o("WAWebMsgType").MSG_TYPE.COMMENT}l.isReactionMsgMeta=e,l.isPollVoteMsgMeta=s,l.isCommentMsgMeta=u,l.isEventResponseMsgMeta=c,l.isEventEditMsgMeta=d,l.isMediaMsgMeta=m,l.getMsgTypeFromMsgMeta=p}),98);
__d("WAWebBotGroupGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("WAWebABProps").getABPropConfigValue("web_ai_group_open_support")!==!0?!1:o("WAWebABProps").getABPropConfigValue("ai_group_participation_enabled")===!0}function s(){return o("WAWebABProps").getABPropConfigValue("web_ai_group_open_support")!==!0?!1:o("WAWebABProps").getABPropConfigValue("ai_group_participation_add_tee_enabled")===!0}function u(){return o("WAWebABProps").getABPropConfigValue("web_ai_group_open_support")!==!0?!1:o("WAWebABProps").getABPropConfigValue("ai_group_participation_send_enabled")===!0}l.isOpenGroupBotParticipantAddEnabled=e,l.isTEEGroupBotParticipantAddEnabled=s,l.isOpenGroupBotSendEnabled=u}),98);
__d("WAWebPhashUtils",["WABase64","WACryptoSha256","WALogger","WAWebBotGroupGatingUtils","WAWebBotUtils","WAWebWidFactory","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){r("gkx")("26258")||o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[phashV1] calculating phash for ",""])),t.join(","));for(var n=t.map(function(e){return o("WAWebWidFactory").asUserWidOrThrow(e).toString({legacy:!0})}).sort().join(""),a=[],i=0;i<n.length;i++)a.push(n.charCodeAt(i));var l=new Uint8Array(a),s=yield self.crypto.subtle.digest({name:"SHA-1"},l);return"1:"+o("WABase64").encodeB64(s.slice(0,6))}),c.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){t===void 0&&(t=!1),r("gkx")("26258")||o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[phashV2] calculating phash for ",""])),e.join(",")),o("WAWebBotGroupGatingUtils").isOpenGroupBotParticipantAddEnabled()&&t===!0&&e.push(o("WAWebBotUtils").META_BOT_FBID_WID);for(var n=e.map(function(e){return e.toString({legacy:!0,formatFull:!0})}).sort().join(""),a=[],i=0;i<n.length;i++)a.push(n.charCodeAt(i));var l=new Uint8Array(a),u=yield o("WACryptoSha256").sha256(l);return"2:"+o("WABase64").encodeB64(u.slice(0,6))}),m.apply(this,arguments)}l.phashV1=u,l.phashV2=d}),98);
__d("WAWebSimpleSignalPNToFBIDMigration",["WAWebABProps","WAWebBotTypes","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e="867051314767696",s=new Map([["867051314767696","13135550002"],["1061492271844689","13135550005"],["245886058483988","13135550009"],["3509905702656130","13135550012"],["1059680132034576","13135550013"],["715681030623646","13135550014"],["1644971366323052","13135550015"],["582497970646566","13135550019"],["645459357769306","13135550022"],["294997126699143","13135550023"],["1522631578502677","13135550027"],["719421926276396","13135550030"],["1788488635002167","13135550031"],["24232338603080193","13135550033"],["689289903143209","13135550035"],["871626054177096","13135550039"],["362351902849370","13135550042"],["1744617646041527","13135550043"],["893887762270570","13135550046"],["1155032702135830","13135550047"],["333931965993883","13135550048"],["853748013058752","13135550049"],["1559068611564819","13135550053"],["890487432705716","13135550054"],["240254602395494","13135550055"],["1578420349663261","13135550062"],["322908887140421","13135550065"],["3713961535514771","13135550067"],["997884654811738","13135550070"],["403157239387035","13135550081"],["535242369074963","13135550082"],["946293427247659","13135550083"],["3664707673802291","13135550084"],["1821827464894892","13135550085"],["1760312477828757","13135550086"],["439480398712216","13135550087"],["1876735582800984","13135550088"],["984025089825661","13135550089"],["1001336351558186","13135550090"],["3739346336347061","13135550091"],["3632749426974980","13135550092"],["427864203481615","13135550093"],["1434734570493055","13135550094"],["992873449225921","13135550095"],["813087747426445","13135550096"],["806369104931434","13135550098"],["1220982902403148","13135550099"],["1365893374104393","13135550100"],["686482033622048","13135550200"],["1454999838411253","13135550201"],["718584497008509","13135550202"],["743520384213443","13135550301"],["1147715789823789","13135550302"],["1173034540372201","13135550303"],["974785541030953","13135550304"],["1122200255531507","13135550305"],["899669714813162","13135550306"],["631880108970650","13135550307"],["435816149330026","13135550308"],["1368717161184556","13135550309"],["7849963461784891","13135550310"],["3609617065968984","13135550312"],["356273980574602","13135550313"],["1043447920539760","13135550314"],["1052764336525346","13135550315"],["2631118843732685","13135550316"],["510505411332176","13135550317"],["1945664239227513","13135550318"],["1518594378764656","13135550319"],["1378821579456138","13135550320"],["490214716896013","13135550321"],["1028577858870699","13135550322"],["308915665545959","13135550323"],["845884253678900","13135550324"],["995031308616442","13135550325"],["2787365464763437","13135550326"],["1532790990671645","13135550327"],["302617036180485","13135550328"],["723376723197227","13135550329"],["8393570407377966","13135550330"],["1931159970680725","13135550331"],["401073885688605","13135550332"],["2234478453565422","13135550334"],["814748673882312","13135550335"],["26133635056281592","13135550336"],["1439804456676119","13135550337"],["889851503172161","13135550338"],["1018283232836879","13135550339"],["1012781386779537","13135559000"],["823280953239532","13135559001"],["1597090934573334","13135559002"],["485965054020343","13135559003"],["1033381648363446","13135559004"],["491802010206446","13135559005"],["1017139033184870","13135559006"],["499638325922174","13135559008"],["468946335863664","13135559009"],["1570389776875816","13135559010"],["1004342694328995","13135559011"],["1012240323971229","13135559012"],["392171787222419","13135559013"],["952081212945019","13135559016"],["444507875070178","13135559017"],["1274819440594668","13135559018"],["1397041101147050","13135559019"],["425657699872640","13135559020"],["532292852562549","13135559021"],["705863241720292","13135559022"],["476449815183959","13135559023"],["488071553854222","13135559024"],["468693832665397","13135559025"],["517422564037340","13135559026"],["819805466613825","13135559027"],["1847708235641382","13135559028"],["716282970644228","13135559029"],["521655380527741","13135559030"],["476193631941905","13135559031"],["485600497445562","13135559032"],["440217235683910","13135559033"],["523342446758478","13135559034"],["514784864360240","13135559035"],["505790121814530","13135559036"],["420008964419580","13135559037"],["492141680204555","13135559038"],["388462787271952","13135559039"],["423473920752072","13135559040"],["489574180468229","13135559041"],["432360635854105","13135559042"],["477878201669248","13135559043"],["351656951234045","13135559044"],["430178036732582","13135559045"],["434537312944552","13135559046"],["1240614300631808","13135559047"],["473135945605128","13135559048"],["423669800729310","13135559049"],["3685666705015792","13135559050"],["504196509016638","13135559051"],["346844785189449","13135559052"],["504823088911074","13135559053"],["402669415797083","13135559054"],["490939640234431","13135559055"],["875124128063715","13135559056"],["468788962654605","13135559057"],["562386196354570","13135559058"],["372159285928791","13135559059"],["531017479591050","13135559060"],["1328873881401826","13135559061"],["1608363646390484","13135559062"],["1229628561554232","13135559063"],["348802211530364","13135559064"],["3708535859420184","13135559065"],["415517767742187","13135559066"],["479330341612638","13135559067"],["480785414723083","13135559068"],["387299107507991","13135559069"],["333389813188944","13135559070"],["391794130316996","13135559071"],["457893470576314","13135559072"],["435550496166469","13135559073"],["1620162702100689","13135559074"],["867491058616043","13135559075"],["816224117357759","13135559076"],["334065176362830","13135559077"],["489973170554709","13135559078"],["473060669049665","13135559079"],["1221505815643060","13135559080"],["889000703096359","13135559081"],["475235961979883","13135559082"],["3434445653519934","13135559084"],["524503026827421","13135559085"],["1179639046403856","13135559086"],["471563305859144","13135559087"],["533896609192881","13135559088"],["365443583168041","13135559089"],["836082305329393","13135559090"],["1056787705969916","13135559091"],["503312598958357","13135559092"],["3718606738453460","13135559093"],["826066052850902","13135559094"],["1033611345091888","13135559095"],["3868390816783240","13135559096"],["7462677740498860","13135559097"],["436288576108573","13135559098"],["1047559746718900","13135559099"],["1099299455255491","13135559100"],["1202037301040633","13135559101"],["1720619402074074","13135559102"],["1030422235101467","13135559103"],["827238979523502","13135559104"],["1516443722284921","13135559105"],["1174442747196709","13135559106"],["1653165225503842","13135559107"],["1037648777635013","13135559108"],["551617757299900","13135559109"],["1158813558718726","13135559110"],["2463236450542262","13135559111"],["1550393252501466","13135559112"],["2057065188042796","13135559113"],["506163028760735","13135559114"],["2065249100538481","13135559115"],["1041382867195858","13135559116"],["886500209499603","13135559117"],["1491615624892655","13135559118"],["486563697299617","13135559119"],["1175736513679463","13135559120"],["491811473512352","13165550064"]]),u=new Map(Array.from(s.entries(),function(e){var t=e[0],n=e[1];return[n,t]}));function c(e){return m(o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_receive_enabled"),e)}function d(e){return m(o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_invoke_receive_enabled"),e)}function m(e,t){if(e===!0&&t.isFbidBot()){var n=s.get(t.user);if(n!=null)return o("WAWebWidFactory").createWid(n+"@s.whatsapp.net")}}function p(e){return f(o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_sending"),e)}function _(e){return f(o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_invoke_send_enabled"),e)}function f(e,t){if(e===!0&&t.isPnBot()){var n=u.get(t.user);if(n!=null)return o("WAWebWidFactory").createWid(n+"@bot")}}function g(e){return u.has(e.user)}function h(e){if(e.isPnBot()&&g(e)&&o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_sending")){var t=p(e);if(t!=null)return t}return e}function y(e){if(e.isFbidBot()&&o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_sending")){var t=c(e);if(t!=null)return t}return e}function C(t){return t.isFbidBot()&&o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_sending")?e===t.user?o("WAWebBotTypes").BotPersonaType.DEFAULT:s.has(t.user)?o("WAWebBotTypes").BotPersonaType.FIRST_PARTY_CHARACTER:o("WAWebBotTypes").BotPersonaType.UGC:null}function b(e,t){if(e.type!=="addon"){var n=e.data,r=n.get(t);if(r!=null&&g(r)&&o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_invoke_send_enabled")){var a=_(r);a!=null&&n.set(t,a)}}}function v(e){var t=e.data.to;if(g(t)&&o("WAWebABProps").getABPropConfigValue("ai_fbid_migration_sending")){var n=p(t);n!=null&&(e.type==="message"?e.data.to=n:e.type==="addon"&&(e.data=babelHelpers.extends({},e.data,{to:n})))}}l.getDeprecatedPnChatForFbidThread=c,l.getDeprecatedPnChatForFbidInvoke=d,l.maybeReplaceDeprecatedBotPnWithFbid=h,l.maybeReplaceFbidWithDeprecatedBotPn=y,l.getFbidBotPersonaType=C,l.maybeReplaceWidWithFbIdForInvoke=b,l.maybeReplaceWidWithFbIdForBotSend=v}),98);
__d("WAWebHandleMsgValidate",["WAJids","WALogger","WATimeUtils","WAWebABProps","WAWebAck","WAWebApiContact","WAWebApiDeviceList","WAWebBizGatingUtils","WAWebBotUtils","WAWebBroadcastInvalidChannelsContextSourceMessageDropWamEvent","WAWebE2EProtoUtils","WAWebGetMessageCache","WAWebHandleMessageTypes.flow","WAWebHandleMsgCommon","WAWebHandleMsgError","WAWebHandleMsgMetaUtils","WAWebHandleMsgTypes.flow","WAWebMessagingGatingUtils","WAWebMobilePlatforms","WAWebMsgGetters","WAWebMsgType","WAWebNewsletterGatingUtils","WAWebPhashUtils","WAWebReportingTokenUtils","WAWebSimpleSignalPNToFBIDMigration","WAWebUserPrefsMeUser","WAWebWamEnumE2eFailureReason","WAWebWid","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v="message_edit";function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r,a=(n=t.preMatChat)!=null?n:t.chat;if(!L({encDestination:e,envelopeDestination:a}))return o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["encDestination: ",", destination: ",", type: ",""])),e.toString(),a.toString(),t.type).sendLogs("validateMsgDestination: drop due to the deviceSentMessage meta mismatch."),!1;var i=t.author;if(!o("WAWebUserPrefsMeUser").isMeAccount(i))return o("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["sender: ",""])),i.toString()).sendLogs("validateMsgDestination: drop due to msg is not sent from your own device."),!1;var l=yield o("WAWebApiDeviceList").hasDevice(i,(r=i.device)!=null?r:0);return l||o("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["no record found for sender: ",""])),i.toString()).sendLogs("validateMsgDestination:drop due to invalid device"),l}),R.apply(this,arguments)}function L(t){var n=t.encDestination,a=t.envelopeDestination;if(n.equals(a))return!0;var i=o("WAWebSimpleSignalPNToFBIDMigration").getDeprecatedPnChatForFbidThread(n);if(r("WAWebWid").equals(i,a))return!0;if(n.isUser()&&r("WAWebWid").equals(o("WAWebApiContact").getAlternateUserWid(n),a)){var l=a.toLogString(),s=n.toLogString();return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["validateMsgDestination: match but addressing mode mismatch: envelope: ",", enc: ",""])),l,s).sendLogs("validateMsgDestination-addressing-mode-mismatch"),!0}return!1}function E(e,t){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r=t.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?t.bclParticipants.map(function(e){var t;return(t=e.preMatWid)!=null?t:e.wid}):(n=t.directPeerStatusBclParticipants)!=null?n:[],a=yield o("WAWebPhashUtils").phashV2(r);return a!==e?(o("WALogger").ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["received: "," from peer, computed: ",""])),e,a).sendLogs("validateBclHash: drop due to invalid hash."),!1):(t.bclHashValidated=!0,!0)}),k.apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.device==null?o("WAJids").DEFAULT_DEVICE_ID:e.device;if(t===o("WAJids").DEFAULT_DEVICE_ID)return!0;var n=yield o("WAWebApiDeviceList").getDeviceIds([e]),r=n[0];return r!=null&&r.devices.some(function(e){return e.id===t})}),T.apply(this,arguments)}function D(e,t){var n=e.buttonsMessage,r=e.highlyStructuredMessage,a=e.listMessage,i=e.templateMessage;if(a&&(t==null?void 0:t.verifiedListEnvelope)!==!0)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["no biz node found in list message"]))).sendLogs("validateBizNode:drop due to missing biz node in invalid SMAX in list message",{sampling:.01}),!1;if(n){var l,d,m=(t==null?void 0:t.verifiedButtonsEnvelope)===!0||(t==null?void 0:t.nativeFlowName)!=null||((l=n.contextInfo)==null?void 0:l.isForwarded)===!0&&(n==null||(d=n.buttons)==null?void 0:d.length)===0;return m||o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["button message is invalid"]))).sendLogs("validateBizNode:drop due to invalid SMAX for buttons message"),m}return(r||i)&&(t==null?void 0:t.verifiedHsmEnvelope)!==!0?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["no biz node found in HSM"]))).sendLogs("validateBizNode:drop due to missing biz node in invalid SMAX in HSM"),!1):!0}function x(e){var t,n=(t=e.ctwaContext)==null?void 0:t.alwaysShowAdAttribution;if(!o("WAWebMobilePlatforms").isSMB()&&!o("WAWebUserPrefsMeUser").isMeAccount(o("WAWebMsgGetters").getSender(e))&&n===!0&&o("WAWebABProps").getABPropConfigValue("ctwa_suppress_message_via_ad_spam_web"))throw new(o("WAWebHandleMsgError")).MessageValidationError("This is a spam message sent to consumer number with 'Message Via Ad' header",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}function $(e){for(var t of Object.keys(e)){var n=e[t];if(n!=null&&typeof n=="object"&&"contextInfo"in n){var r=n.contextInfo;if(r!=null)return r}}return null}function P(e,t){var n=$(e),r=n==null?void 0:n.externalAdReply;if(!o("WAWebMobilePlatforms").isSMB()&&!o("WAWebMsgGetters").getIsSentByMe(t)&&r!=null&&o("WAWebBizGatingUtils").suppressMessageWithExternalAdReplyConsumerEnabled())throw o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Message suppressed with externalAdReply from consumer number"]))),new(o("WAWebHandleMsgError")).MessageValidationError("This is a spam message sent to consumer number with externalAdReply",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}function N(e,t){var n=(e==null?void 0:e.context_source)===o("WAWebHandleMsgCommon").CONTEXT_SOURCE;if(n&&t.type!==o("WAWebMsgType").MSG_TYPE.NEWSLETTER_FOLLOWER_INVITE&&o("WAWebNewsletterGatingUtils").isChannelInviteContactsToFollowInvalidDroppingEnabled()){var r;throw o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Dropping NEWSLETTER_FOLLOWER_INVITE message without valid context_source. Message type: ",", Context source: ",""])),t.type,(r=e==null?void 0:e.context_source)!=null?r:"null").sendLogs("newsletter-follower-invite-invalid-context-source"),new(o("WAWebBroadcastInvalidChannelsContextSourceMessageDropWamEvent")).BroadcastInvalidChannelsContextSourceMessageDropWamEvent({wasDropped:!0}).commit(),new(o("WAWebHandleMsgError")).MessageValidationError("NEWSLETTER_FOLLOWER_INVITE message without valid context_source",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}}function M(e){var t=e.bizInfo,n=e.info,a=e.msgMeta,i=e.proto,l=e.renderableMsgs;if(l.length>0&&!D(i,t))throw new(o("WAWebHandleMsgError")).BizNodeValidationError("[messaging] Biz node validation failed due to absence of biz node in SMAX");var s=l[0];if(s!=null){if(o("WAWebHandleMsgMetaUtils").isReactionMsgMeta(a)&&s.type!==o("WAWebMsgType").MSG_TYPE.REACTION&&s.type!==o("WAWebMsgType").MSG_TYPE.REACTION_ENC)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_REACTION_STANZA);if(o("WAWebHandleMsgMetaUtils").isPollVoteMsgMeta(a)){var u=s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&s.futureproofType===o("WAWebMsgType").MSG_TYPE.POLL_UPDATE,c=s.type===o("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&s.subtype==="poll_vote";if(!u&&!c)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_POLL_UPDATE_STANZA)}if(o("WAWebHandleMsgMetaUtils").isCommentMsgMeta(a)){var d=s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&s.futureproofType===o("WAWebMsgType").MSG_TYPE.COMMENT,m=new Set([o("WAWebMsgType").MsgKind.CommentEncrypted,o("WAWebMsgType").MsgKind.CommentDecrypted,o("WAWebMsgType").MsgKind.RevokedAddon,o("WAWebMsgType").MsgKind.ProtocolRevoke,o("WAWebMsgType").MsgKind.NewsletterQuestionResponse]);if(!d&&!m.has(s.kind))throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_COMMENT_STANZA)}if(n.edit!==o("WAWebAck").EDIT_ATTR.NONE)if(n.edit===o("WAWebAck").EDIT_ATTR.PIN_IN_CHAT){var h=s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&s.futureproofType===o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE;if(s.type!==o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE&&!h)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_PIN_IN_CHAT_STANZA)}else if(n.edit===o("WAWebAck").EDIT_ATTR.MESSAGE_EDIT&&!(o("WAWebHandleMsgMetaUtils").isEventEditMsgMeta(a)||o("WAWebHandleMsgMetaUtils").isMediaMsgMeta(a)&&o("WAWebBotUtils").isMetaAiBot(n.author))){var y=s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&s.futureproofSubtype===v;if(s.subtype!==v&&!y)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EDIT_STANZA)}else{if(n.edit===o("WAWebAck").EDIT_ATTR.NEWSLETTER_MSG_EDIT)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_NEWSLETTER_EDIT_STANZA);if(o("WAWebABProps").getABPropConfigValue("revoke_edit_attribute_validation_enabled"))if(n.edit===o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE){if(s.type!==o("WAWebMsgType").MSG_TYPE.PROTOCOL)throw r("gkx")("26259")&&o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["RenderableMessagesValidation: msg.type: ",""])),s.type).sendLogs("invalid-edit-attribute-admin-revoke"),new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EDIT_STANZA)}else if(n.edit===o("WAWebAck").EDIT_ATTR.SENDER_REVOKE){var C,b=[(C=o("WAWebMsgType")).MSG_TYPE.REACTION,C.MSG_TYPE.REACTION_ENC,C.MSG_TYPE.PROTOCOL,C.MSG_TYPE.KEEP_IN_CHAT];if(!b.includes(s.type))throw r("gkx")("26259")&&o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["RenderableMessagesValidation: msg.type: ",""])),s.type).sendLogs("invalid-edit-attribute-sender-revoke"),new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EDIT_STANZA)}else o("WALogger").WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["RenderableMessagesValidation: Unvalidated edit attribute ",""])),n.edit).sendLogs("unvalidated-edit-attribute")}if(o("WAWebHandleMsgMetaUtils").isEventResponseMsgMeta(a)){var S=s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&s.futureproofType===o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,R=s.type===o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE;if(!S&&!R)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EVENT_RESPONSE_STANZA)}if(o("WAWebHandleMsgMetaUtils").isEventEditMsgMeta(a)){var L=s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&s.futureproofType===o("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED,E=s.type===o("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED;if(!L&&!E)throw new(o("WAWebHandleMsgError")).MessageProtobufMismatchError(o("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EVENT_EDIT_STANZA)}if(r("gkx")("26259")){var k=o("WAWebE2EProtoUtils").typeAttributeFromProtobuf(i);k!==(a==null?void 0:a.type)&&o("WALogger").ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Type in stanza [","] is different from the one derived from protobuf [","]. Message type: ",""])),a==null?void 0:a.type,k,s.type).tags("messaging").sendLogs("report-token-stanza-protobuf-type-mismatched",{sampling:.01})}N(a,s),P(i,s),x(s)}}function w(e){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,r=e.forceDualEncryptedValidation,a=r===void 0?!1:r,i=e.renderableMsgs;if(o("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled()){var l=i[0];if(!(l==null||l.plainProtobufBytes==null||l.reportingTokenInfo==null)){var s=l.plainProtobufBytes,u=l.reportingTokenInfo,c=u.reportingTag,d=u.reportingToken,m=u.version,p=m===void 0?o("WAWebReportingTokenUtils").REPORTING_TOKEN_VERSION.DEFAULT:m;if(c!=null){var _=(t=l.protocolMessageKey)==null?void 0:t.toString(),f={msgKey:_!=null?_:l.id.toString(),stanzaId:l.id.id,reportingTag:c,receivedTs:o("WATimeUtils").unixTimeMs(),msgTs:(n=l.t)!=null?n:0};if(l.kind===o("WAWebMsgType").MsgKind.Unknown){o("WAWebGetMessageCache").getMessageCache().addAdditionalInfo({type:o("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingInfo,data:babelHelpers.extends({},f)},_!=null);return}if(!((l.kind===o("WAWebMsgType").MsgKind.CommentEncrypted||l.kind===o("WAWebMsgType").MsgKind.EventEditEncrypted)&&a===!1)){var g=yield o("WAWebReportingTokenUtils").validateReportingTokenInfo(l,s),h=g.reportingTokenContent,y=g.reportingTokenKey,C=g.res,b=F(l,d)?babelHelpers.extends({reportingToken:d==null?void 0:d.slice(0,C?o("WAWebReportingTokenUtils").REPORTING_TOKEN_STORAGE_SIZE:o("WAWebReportingTokenUtils").REPORTING_TOKEN_INVALID_STORAGE_SIZE),reportingTokenContentOpaqueData:h,version:p},y!=null&&{reportingTokenKey:y}):null;o("WAWebGetMessageCache").getMessageCache().addAdditionalInfo({type:o("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingInfo,data:babelHelpers.extends({},f,b)},_!=null||a===!0)}}}}}),A.apply(this,arguments)}function F(e,t){return!(t==null||o("WAWebReportingTokenUtils").shouldSkipProcessingEditedMsg(e)||o("WAWebReportingTokenUtils").shouldSkipProcessingDualEncryptedMsg(e))}l.validateMsgDestination=S,l.validateBclHash=E,l.isFromKnownDevice=I,l.validateBizNode=D,l.renderableMessagesValidation=M,l.validateAndProcessReportingTokenInfo=w}),98);
__d("WAPromiseLoop",["asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";function e(e,t){return l.apply(this,arguments)}function l(){return l=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){for(var n=!1,r,o=function(t){n=!0,r=t},a=0,i=t;!n;)i=yield e(o,i,a),a++;return r}),l.apply(this,arguments)}i.promiseLoop=e}),66);
__d("WAWebApiFilterAndReplaceMessages",["WALogger","WAWebApiOrphanRevoke","WAWebLidMigrationUtils","WAWebMessageAssociationGatingUtils","WAWebWid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return function(t){return t.associationType!=null&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()?e.get(t.id.toString()):t}}function u(e,t){var n=[];return e.forEach(function(e){if(e!=null)if(t){var r=t(e);r&&n.push(r)}else n.push(e)}),n}function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=yield o("WAWebApiOrphanRevoke").getOrphansRevokesCache(),i=[],l=[];return t.forEach(function(t){var s,u=t.id.toString(),c=o("WAWebLidMigrationUtils").getAlternateMsgKey(t.id),d=(s=a.get(u))!=null?s:c&&a.get(c.toString());if(d)o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["filterAndReplaceMessages: found orphan revoke for message id: ",""])),t.id.id),r("WAWebWid").isStatus(t.id.remote)||l.push(o("WAWebApiOrphanRevoke").createRevokeMsgFromOrphanRevoke(t,d)),i.push(d);else if(n){var m=n(t);m&&l.push(m)}else l.push(t)}),o("WAWebApiOrphanRevoke").bulkRemoveOrphansUsingOrphansCache(i),{newMsgs:l}}),d.apply(this,arguments)}l.validateMsgFn=s,l.filterAndReplaceMessagesInitialHistorySync=u,l.filterAndReplaceMessages=c}),98);
__d("WAWebApiGroupInviteV4Store",["WATimeUtils","WAWebSchemaGroupInviteV4","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return o("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().createOrMerge(e,t)}function s(e){return o("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().bulkCreateOrMerge(e)}function u(e,t,n,r){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=yield o("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().equals(["from","to","groupId"],[e,t,n]).then(function(e){return e.filter(function(e){return!e.expired&&e.expiration<=r})});return yield o("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().bulkCreateOrReplace(a.map(function(e){return babelHelpers.extends({},e,{expired:!0})})),a}),c.apply(this,arguments)}function d(e,t){var n=o("WAWebUserPrefsMeUser").getMePnUserOrThrow().toString(),r=o("WAWebUserPrefsMeUser").getMeLidUserOrThrow().toString(),a=t?r:n;return o("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().equals(["from","groupId"],[a,e.toString()]).then(function(e){return e.filter(function(e){return!e.expired&&o("WATimeUtils").unixTime()<=e.expiration})}).then(function(e){return e.map(function(e){return e.to})})}l.persistGroupInviteV4Msg=e,l.persistGroupInviteV4Msgs=s,l.revokeGroupInvites=u,l.getPendingParticipants=d}),98);
__d("WAWebHandleForMessageRangeEnums",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["DropMessage","SkipUI"]),l=n("$InternalEnum").Mirrored(["DOES_NOT_CONTAIN","CONTAINS_BY_TIMESTAMP","CONTAINS_BY_ADDITIONAL"]);i.ActiveRangeHandlerAction=e,i.RangeContain=l}),66);
__d("WAWebHandleSingleMsg",["Promise","WABackoffUtils","WALogger","WAPromiseDelays","WAPromiseLoop","WATimeUtils","WAWebApiChat","WAWebApiFilterAndReplaceMessages","WAWebApiGroupInviteV4Store","WAWebBackendApi","WAWebBackendErrors","WAWebCheckUpdateOrphanReactions","WAWebDBProcessMessage","WAWebDBStoreRevokeMsgs","WAWebHandleForMessageRange","WAWebHandleForMessageRangeEnums","WAWebHandleMsgTypes.flow","WAWebHandlePlaceholderWam","WAWebMsgGetters","WAWebMsgType","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","asyncToGeneratorRuntime","getErrorSafe","gkx","nullthrows"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v;function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t.chatId,i=t.newMsg,l=t.handleSingleMsgOrigin,S=t.messageOverwriteOption,R=S===void 0?o("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE:S,L=t.preserveOrder,E=L===void 0?!0:L;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: called with msgId::",", chat id::"," type::",",",""])),i.id.id,a.toLogString(),i.type,i.subtype).tags("messaging");var k=R!==o("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE,I=R===o("WAWebHandleMsgTypes.flow").MessageOverwriteOption.VOIP_CALL_LOG,T={add:"after",update:k,isHistory:!1},D=i.type===o("WAWebMsgType").MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(i.subtype),x=i;if(!D){var $=yield o("WAWebApiFilterAndReplaceMessages").filterAndReplaceMessages([x]),P=$.newMsgs;if(P.length===0)return;x=P[0]}var N=yield o("WAWebHandleForMessageRange").handleForActiveMessageRange(a,x);if(!N.has(o("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.DropMessage)){var M=N.has(o("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.SkipUI);try{o("WAWebMsgGetters").getIsStatus(i)&&(yield o("WAWebBackendApi").frontendSendAndReceive("handleStatusUpdate",{rawMsg:x,checksum:null,isMsgUpdate:!1})),yield o("WAPromiseLoop").promiseLoop((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,i){var l=o("WAPromiseDelays").delayMs(o("WABackoffUtils").expBackoff(i,12e4,1e3,.1));try{var f;if(k)try{x=yield o("WAWebDBProcessMessage").updateMessage(x),f=!1,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["placeholder populate successful"]))).tags("handleSingleMsg")}catch(e){if(e instanceof o("WAWebDBProcessMessage").NoMessageToUpdateError&&I)f=!0,o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Msg overwrite failed, will fall back to creation"])));else throw e}if(!k||f===!0)if(D){var g=r("nullthrows")(x.t,"revoke timestamp is null");yield o("WAWebDBStoreRevokeMsgs").processRevokeMsgs([{revokeMsgKey:x.protocolMessageKey,newMsgKey:x.id,timestamp:g,subtype:x.subtype,sender:x.author,revokeTimestamp:g}]),o("WAWebBackendApi").frontendFireAndForget("deleteModelsForLastAddOnPreview",{messagesIds:[x.protocolMessageKey.toString()]}),yield o("WAWebPersistedJobManager").getJobManager().waitUntilPersisted(o("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(a.toString(),[x.protocolMessageKey.toString()]))}else try{yield o("WAWebDBProcessMessage").storeMessages([x],a),x.type===o("WAWebMsgType").MSG_TYPE.CIPHERTEXT&&o("WAWebHandlePlaceholderWam").postPlaceholderActivityAddEvent([x])}catch(e){if(e instanceof o("WAWebDBProcessMessage").DuplicateMessageError)x.type===o("WAWebMsgType").MSG_TYPE.CIPHERTEXT?o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["processPlaceholderMsg: skip creating duplicate placeholder"]))):(o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop: detect resend message"]))),x=yield o("WAWebDBProcessMessage").updateMessage(x),T.update=!0);else throw e}if(x.type===o("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE){var h=x.id.toString();yield o("WAWebApiGroupInviteV4Store").persistGroupInviteV4Msg(h,{id:h,from:x.from.toString(),to:x.to.toString(),groupId:x.inviteGrp,expiration:parseInt(x.inviteCodeExp,10),expired:o("WATimeUtils").unixTime()>=parseInt(x.inviteCodeExp,10)})}o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop"]))).tags("handleSingleMsg"),e()}catch(e){return o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop: failed with error ","."])),e).tags("handleSingleMsg"),i>3?(o("WALogger").WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop: Gave up after "," tries"])),i),(v||(v=n("Promise"))).reject(e)):l}});return function(t,n,r){return e.apply(this,arguments)}})()),o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: msgId::",", chat id::"," type: "," "," write message to db done, overwrite: ",", skipUI: ",""])),x.id.id,a.toLogString(),x.type,x.subtype,k,M).tags("messaging");try{yield o("WAWebBackendApi").frontendSendAndReceive("checkOrphanMutations",{msgIds:[x.id.toString()],chatIds:[a.toString()]}),yield o("WAWebCheckUpdateOrphanReactions").checkUpdateForOrphanReactions([x.id.toString()])}catch(e){var w=r("getErrorSafe")(e);o("WALogger").ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: checkOrphanMutations failed during handleSingleMsg for: "," chat: "," Error: ",", message: ",", stack: ",""])),String(x.id),String(a),w.name,w.message,w.stack)}var A=!1;if(l==="createChat"&&x.type!==o("WAWebMsgType").MSG_TYPE.CHAT&&a.isRegularUser()){var F=yield o("WAWebApiChat").getChatRecord(a);F==null&&(A=!0,o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: non existing chat while adding a system message to a new chat. chatId: ",""])),a.toLogString()))}!M&&!A&&(yield o("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:a,msgObjs:[babelHelpers.extends({},x,{recvFresh:!0,isNewMsg:!0})],meta:T,processMessagesOrigin:l,chatMsgsCollection:null,preserveOrder:E}))}catch(e){if(e instanceof o("WAWebBackendErrors").LogoutDrop)return;if(e instanceof o("WAWebDBProcessMessage").PreviousMsgNotUpdatableError){o("WALogger").WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Msg: "," chat: "," Error: PreviousMsgNotUpdatableError"])),String(x.id),String(a));return}var O=r("getErrorSafe")(e);r("gkx")("26258")?o("WALogger").WARN(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Msg: "," chat: "," Error: ",", message: ",", stack: ",""])),String(x.id),String(a),O.name,O.message,O.stack).tags("messaging"):o("WALogger").WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Msg: "," chat: "," Error: ",", message: ",", stack: ",""])),String(x.id),String(a),O.name,O.message,O.stack).tags("messaging").sendLogs("msg_handler: error storing/processing single message")}}}),R.apply(this,arguments)}l.handleSingleMsg=S}),98);
__d("WAWebShouldUpdateLastAddOnPreview",["WAWebBackendApi","WAWebDBUpdateLastAddOnPreviewChat","WAWebLastAddOnDBSerialization","WAWebMsgKey","WAWebReactionsBEUtils","WAWebSchemaChat","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){var t=r("WAWebMsgKey").fromString(e.parentMsgKey);return e.type==="comment"?!0:(o("WAWebUserPrefsMeUser").isSerializedWidMe(e.sender)||t.fromMe)&&!e.isOrphan}function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,n=yield o("WAWebSchemaChat").getChatTable().bulkGet(e);return n.forEach(function(e){var n;e!=null&&t.set(e.id.toString(),(n=e.chatlistPreview)!=null?n:e.lastReactionPreview)}),t}),u.apply(this,arguments)}function c(e){var t=r("WAWebMsgKey").fromString(e.parentMsgKey);return t.remote.toString()}function d(e,t){return g(e)?e.sender===t.sender&&e.parentMsgKey===t.parentMsgKey&&e.timestamp>=t.timestamp:!1}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.filter(function(t){return e(t)}),a=new Map;if(!n.length)return a;var i=new Set(n.map(function(e){var t=r("WAWebMsgKey").fromString(e.parentMsgKey);return t.remote.toString()})),l=yield s(Array.from(i));return n.forEach(function(e){var t=c(e),n=l.get(t),r=a.get(t),i=r!=null?r:n;g(e)?i&&d(e,i)&&e.timestamp>=i.timestamp&&a.set(t,void 0):i?e.timestamp>=i.timestamp&&a.set(t,o("WAWebLastAddOnDBSerialization").lastAddOnPreviewFromCandidate(e)):a.set(t,o("WAWebLastAddOnDBSerialization").lastAddOnPreviewFromCandidate(e))}),a}),p.apply(this,arguments)}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield m(e);t.size>0&&(yield o("WAWebDBUpdateLastAddOnPreviewChat").updateDatabaseForLastAddOnPreview(t),o("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:t}))}),f.apply(this,arguments)}function g(e){return e.type==="poll_vote"?e.selectedOptionsCount===0:e.reactionText===o("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT}l.isAddOnPreviewUpdateCandidate=e,l.bulkGetChatLastAddOnPreviewMap=s,l.filterChatsWithAddOnPreviewUpdates=m,l.filterAndUpdateChatPreviews=_}),98);
__d("WAWebApiOrphanReceipt",["WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebSchemaOrphanReceipt","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebSchemaOrphanReceipt").getOrphanReceiptTable().remove(e)}function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[e];if(e.remote.isUser()){var n=o("WAWebLidMigrationUtils").getAlternateMsgKey(e);n!=null&&t.push(n)}var r=yield o("WAWebSchemaOrphanReceipt").getOrphanReceiptTable().bulkGet(t.map(String));return r.find(function(e){return e!=null})}),u.apply(this,arguments)}function c(e,t,n){return o("WAWebModelStorageUtils").getStorage().lock(["orphan-receipt"],function(r){var o=r[0];return o.bulkGet(n).then(function(r){var a=n.reduce(function(n,o,a){var i=r[a];i==null&&(i={msgKey:o});var l=i[e];return(l==null||l>t)&&(i[e]=t,n.push(i)),n},[]);return o.bulkCreateOrReplace(a)})})}l.removeOrphanReceipt=e,l.getOrphanReceipt=s,l.createOrUpdateOrphanReceipt=c}),98);
__d("WAWebLidStatusMigrationGating",["WAWebABProps"],(function(t,n,r,o,a,i,l){var e;function s(){return e!=null||(o("WAWebABProps").getABPropConfigValue("lid_status_send_enabled")?e="mat":e="pre_mat"),e}function u(){return s()==="mat"}function c(t){e=t}l.getLidStatusMigrationStage=s,l.getLidStatusSendEnabled=u,l.setLidStatusMigrationStage=c}),98);
__d("WAWebLidStatusMigrationUtils",["WAWebLidMigrationUtils","WAWebLidStatusMigrationGating"],(function(t,n,r,o,a,i,l){function e(e){var t,n;if(!e.isRegularUser())return e;var r=o("WAWebLidStatusMigrationGating").getLidStatusMigrationStage();return r==="pre_mat"?(t=o("WAWebLidMigrationUtils").toPn(e))!=null?t:e:r==="mat"?(n=o("WAWebLidMigrationUtils").toLid(e))!=null?n:e:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+r)})()}l.matWidConvert=e}),98);
__d("WAWebLidStatusMigrationKeyUtils",["WAWebLidStatusMigrationUtils","WAWebMsgKey"],(function(t,n,r,o,a,i,l){function e(e){return e.remote.isStatus()?new(r("WAWebMsgKey"))({fromMe:e.fromMe,remote:e.remote,id:e.id,participant:e.participant?o("WAWebLidStatusMigrationUtils").matWidConvert(e.participant):void 0}):e}l.matKeyConvert=e}),98);
__d("WAWebDBBulkGetRootMsgs",["WALogger","WAWebLid1X1MigrationGating","WAWebLidMigrationUtils","WAWebLidStatusMigrationGating","WAWebLidStatusMigrationKeyUtils","WAWebMsgKey","WAWebSchemaChat","WAWebSchemaMessage","WAWebWidFactory","asyncToGeneratorRuntime","nullthrows"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e;o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated()?n=yield h(e):o("WAWebLidStatusMigrationGating").getLidStatusSendEnabled()&&(n=e.map(function(e){return o("WAWebLidStatusMigrationKeyUtils").matKeyConvert(r("WAWebMsgKey").fromString(e)).toString()}));var a=yield f(n,t);return a.some(function(e){return e==null})&&!o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated()&&(yield p(n,a,t)),a}),m.apply(this,arguments)}function p(e,t,n){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){for(var a=e.map(function(e){return r("WAWebMsgKey").fromString(e)}),i=[],l=0;l<t.length;l++)t[l]==null&&a[l].remote.isLid()&&i.push({key:a[l],idxInOriginalMsgKeys:l});if(i.length!==0){var s=C(i.map(function(e){return e.key})),u=(yield f(s.map(String),n)).filter(Boolean);u.forEach(function(a,l){if(a!=null){var s=a.id,u=r("nullthrows")(i[l]).idxInOriginalMsgKeys;if(u==null){var d=s==null?"null":s,m=e.length;o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["fillMissingLidMessages: no original idx found for pn msgkey. shouldDecrypt ",", record id: ",", keys ",""])),n,d,m).sendLogs("fillMissingLidMessages-no-original-idx");return}t[u]=a}})}}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){for(var n=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(e,t),r=new Map,a=0;a<e.length;a++){var i;((i=n[a])==null?void 0:i.subtype)==="message_edit"&&(r.set(e[a],a),n[a]=null)}if(r.size===0)return n;var l=yield o("WAWebSchemaMessage").getMessageTable().anyOf(["latestEditMsgKey"],Array.from(r.keys()));for(var s of l)if(!(s.latestEditMsgKey==null||s.subtype==="message_edit")){var u=r.get(s.latestEditMsgKey);u!=null&&(n[u]=s)}return n}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated())return e;var t=e.map(function(e){return r("WAWebMsgKey").fromString(e)}),n=b(t.map(function(e){return e.remote})),a=yield o("WAWebSchemaChat").getChatTable().anyOf(["accountLid"],Array.from(n,function(e){return e.toString()})),i=new Map(a.map(function(e){return[o("WAWebWidFactory").createWid(r("nullthrows")(e.accountLid)),o("WAWebWidFactory").createWid(e.id)]}));return v(t,i).map(String)}),y.apply(this,arguments)}function C(e){var t=e.reduce(function(e,t){var n=o("WAWebLidMigrationUtils").toPn(t.remote);return n==null?e:e.set(t.remote,n)},new Map);return v(e,t)}function b(t){var n=t.filter(function(e){return e.isRegularUser()}).map(function(e){return o("WAWebLidMigrationUtils").toLid(e)});return n.some(function(e){return e==null})&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["_bulkGetRootMsgsByAccountLid: missing mapping for PN remote"]))),new Set(n.filter(Boolean))}function v(e,t){return e.map(function(e){var n=e.remote;if(n.isStatus())return o("WAWebLidStatusMigrationKeyUtils").matKeyConvert(e);if(!n.isRegularUser())return e;var a=o("WAWebLidMigrationUtils").toUserLid(n);if(a==null)return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["_bulkGetRootMsgsByAccountLid: couldn't find lid for PN (might be orphan)"]))),e;var i=t.get(a);return i==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["_bulkGetRootMsgsByAccountLid: no chat record found for accountLid (might be orphan)"]))),e):r("WAWebMsgKey").from({fromMe:e.fromMe,remote:i,id:e.id})})}l.bulkGetRootMsgs=d,l.fixMsgKeysWithChatId=h,l.fixMsgKeysWithPnMapping=C}),98);
__d("WAWebHandleMsgReceiptCommon",["WALogger","WATimeUtils","WAWebAck","WAWebActiveMessageRanges","WAWebApiActiveMessageRanges","WAWebApiChat","WAWebApiOrphanReceipt","WAWebBackendApi","WAWebChatThreadLogging","WAWebDBBulkGetRootMsgs","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebMarkAddOnsAsReadJob","WAWebMsgKey","WAWebNewsletterDBUtils","WAWebNewsletterGatingUtils","WAWebPromiseQueue","WAWebSchemaMessage","asyncToGeneratorRuntime","lodash"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_=new(o("WAWebPromiseQueue")).PromiseQueue;function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebApiActiveMessageRanges").getActiveMessageRanges(e),a=n.filter(function(e){return e.action==="markChatAsRead"&&e.actionValue.read===!1&&e.actionValue.messageRange!=null});if(a.length===0)return!0;var i=a[0],l=t.some(function(e){return!o("WAWebActiveMessageRanges").rangeContainsMessage(i.actionValue.messageRange,{id:r("WAWebMsgKey").fromString(e.id),t:e.t})});return l}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["updateChatPeerRead"])));var n=t.map(String),a=null,i=yield o("WAWebDBBulkGetRootMsgs").bulkGetRootMsgs(t.map(String),!1),l=i.find(Boolean),s=l?r("WAWebMsgKey").fromString(l.id).remote:e,u=[];i.forEach(function(e,t){if(!e)u.push(n[t]);else{if(e.pendingReadReceipt==null)return;e.rowId!=null&&(a==null||e.rowId>a)&&(a=e.rowId)}}),u.length>0&&o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["updateChatPeerRead: maybeOrphans ",""])),u.length);var c;if(u.length===0)c=new Set;else{var g=yield o("WAWebMarkAddOnsAsReadJob").markUnclassifiedAddOnsAsReadJob(u.map(function(e){return r("WAWebMsgKey").from(e)})),h=g.updatedAddOns,y=g.updatedOrphans;c=new Set([].concat(y,r("lodash").flatten(Array.from(h.values()))).map(String))}var C=u.filter(function(e){return!c.has(e)});_.enqueue(function(){return o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["updateChatPeerRead: storing "," orphan acks"])),C.length),o("WAWebApiOrphanReceipt").createOrUpdateOrphanReceipt(o("WAWebAck").ACK_STRING.READ,0,C)});var b=yield f(s.toString(),i.filter(Boolean)),v=yield o("WAWebApiChat").markMessageAndChatAsRead({lastReadRowId:a,chatId:String(s),keepChatUnread:!b}),S=v.fullyReadThreadIds;if(S.length>0&&(yield o("WAWebBackendApi").frontendSendAndReceive("resetAiThreadUnreadCounts",{chatId:s,threadIds:S})),s.isNewsletter()){o("WAWebNewsletterGatingUtils").isNewsletterEnabled()&&(yield o("WAWebBackendApi").frontendSendAndReceive("updateNewsletterUnreadMsgCount",{id:s}));return}yield o("WAWebBackendApi").frontendSendAndReceive("updateChatUnreadMsgCountAndClearMentions",{remote:s})}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.map(function(e){return o("WAWebDBMessageUtils").craftInternalId(t.toJid(),e)}),a=yield o("WAWebSchemaMessage").getMessageTable().anyOf(["internalId"],n),i=a.map(function(e){return r("WAWebMsgKey").fromString(e.id)});return yield o("WAWebNewsletterDBUtils").updateMsgViewReceipt(i),o("WAWebBackendApi").frontendFireAndForget("updateMsgsViewed",{ids:i})}),b.apply(this,arguments)}function v(t,n,r){_.enqueue(function(){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateMsgAcks: store "," orphan acks"])),t.length);var a=null;if(n===o("WAWebAck").ACK.PLAYED?a=o("WAWebAck").ACK_STRING.PLAYED:n===o("WAWebAck").ACK.READ&&(a=o("WAWebAck").ACK_STRING.READ),a)return o("WAWebApiOrphanReceipt").createOrUpdateOrphanReceipt(a,r,t.map(String))})}function S(e){return _.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WAWebApiOrphanReceipt").getOrphanReceipt(e);if(t==null){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["processOrphanPeerReceipt: no orphan ack found for incoming ",""])),e);return}t[o("WAWebAck").ACK_STRING.PLAYED]!=null&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["processOrphanPeerReceipt: orphan played ack found for incoming ",""])),e),yield o("WAWebBackendApi").frontendSendAndReceive("updateMsgPeerAcks",{msgKeys:[e],ack:o("WAWebAck").ACK.PLAYED,t:t[o("WAWebAck").ACK_STRING.PLAYED]})),t[o("WAWebAck").ACK_STRING.READ]!=null&&(o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["processOrphanPeerReceipt: orphan read ack found for incoming ",""])),e),h(e.remote,[e])),yield o("WAWebApiOrphanReceipt").removeOrphanReceipt(t.msgKey)}))}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(String),n=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(t,!1);o("WAWebChatThreadLogging").handleActivitiesForChatThreadLogging(n.filter(Boolean).map(function(e){return o("WAWebDBMessageSerialization").messageFromDbRow(e)}).filter(function(e){return e.isViewOnce}).map(function(e){var t;return{activityType:"viewOnceOpen",ts:(t=e.t)!=null?t:o("WATimeUtils").unixTime(),chatId:e.id.remote}}))}),L.apply(this,arguments)}l.updateChatPeerRead=h,l.updateMsgViewed=C,l.updateOrphanPeerReceipt=v,l.processOrphanPeerReceipt=S,l.handleViewOnceOpenedIfNecessary=R}),98);
__d("WAWebOfflineDeviceCache",["WAComms","WADeprecatedSendIq","WALogger","WAShiftTimer","WAWebApiPendingDeviceSync","WAWebPromiseQueue","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u=3e3,c=(function(){function t(){var e=this;this.pendingDeviceCache=new Set,this.pendingAcks=[],this.snapshotTimer=new(o("WAShiftTimer")).ShiftTimer(function(){e.createSnapshot()}),this.checkpointQueue=new(o("WAWebPromiseQueue")).PromiseQueue}var r=t.prototype;return r.addOfflinePendingDevice=function(n,r){this.pendingDeviceCache.add(n),r&&this.pendingAcks.push(r),this.snapshotTimer.isScheduled()||(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][device-cache]: creating snapshot: schedule in "," ms"])),u),this.snapshotTimer.onOrAfter(u))},r.createSnapshot=function(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();var e=Array.from(this.pendingDeviceCache),t=this.pendingAcks;o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][device-cache]: creating snapshot for pending devices ",""])),e.join(",")),this.checkpointQueue.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync(e),t.forEach(function(e){return o("WADeprecatedSendIq").deprecatedCastStanza(e)}),o("WAComms").cancelDeadSocketTimer()})),this.pendingDeviceCache=new Set,this.pendingAcks=[]},t})(),d=new c;l.OfflinePendingDeviceCache=d}),98);
__d("WASmaxOutOfflineBatchRequest",["WASmaxJsx","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.offlineBatchCount,n=o("WASmaxJsx").smax("ib",null,o("WASmaxJsx").smax("offline_batch",{count:o("WAWap").INT(t)}));return n}l.makeBatchRequest=e}),98);
__d("WASmaxOfflineBatchRPC",["WAComms","WASmaxOutOfflineBatchRequest","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WASmaxOutOfflineBatchRequest").makeBatchRequest(e);yield o("WAComms").castSmaxStanza(t)}),s.apply(this,arguments)}l.sendBatchRPC=e}),98);
__d("WAWebEventsWaitForReadyForOffline",["Promise","WAWebBackendEventBus","WAWebEventsWaitForBbEvent","err"],(function(t,n,r,o,a,i,l){var e,s;function u(){s==null&&(s=r("WAWebEventsWaitForBbEvent")(o("WAWebBackendEventBus").BackendEventBus,o("WAWebBackendEventBus").BackendEvent.OFFLINE_PROCESS_READY))}function c(){return s==null?(e||(e=n("Promise"))).reject(r("err")("waitForOfflineProcessReady called before init")):s}l.initWaitForOfflineProcessReady=u,l.waitForOfflineProcessReady=c}),98);
__d("WAWebHandleOfflineAbProps",["WAWebABProps","WAWebRuntimeEnvironmentUtils"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("web_non_blocking_offline_resume_max_message_count")}function s(){return o("WAWebABProps").getABPropConfigValue("web_offline_stage_manager_singleton_enabled")}function u(){return!o("WAWebRuntimeEnvironmentUtils").isServiceWorker()&&o("WAWebABProps").getABPropConfigValue("web_offline_dynamic_batch_size_enabled")}function c(){var e=JSON.parse(o("WAWebABProps").getABPropConfigValue("web_offline_dynamic_batch_config")),t=parseFloat(e.multiplier),n=e.version||"default";return{multiplier:Number.isNaN(t)?.2:t,version:n}}l.getNonBlockingOfflineResumeMaxMessageCount=e,l.isNonBlockingOfflineResumeExpEnabled=s,l.isOfflineDynamicBatchSizeEnabled=u,l.getOfflineDynamicBatchConfig=c}),98);
__d("WAWebOfflineHandler",["invariant","WALogger","WASmaxOfflineBatchRPC","WAWebAppTracker","WAWebBackendEventBus","WAWebEventsWaitForReadyForOffline","WAWebHandleOfflineAbProps","WAWebOfflineResumeUtils","WAWebPageLoadLogging","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l,s){var e,u,c,d,m,p,_,f,g,h,y=200,C=10,b=200,v=100,S=new Map([[0,200],[1,100],[2,50],[3,10]]),R=k(),L=(function(){function t(){this.$2=!1,this.$3=0,this.$4=!1,this.$5=!1,this.$7=y,this.$8=0,this.$9=!1,this.$10=0}var r=t.prototype;return r.initState=function(n){this.offlineResumeManager!=null&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] initState called more than once"]))),this.offlineResumeManager=n.getBlockingStageManager(),o("WAWebPageLoadLogging").addPageLoadQplAnnotation({blocking_resume:!0}),this.$1=n.getNonblockingStageManager},r.processOfflinePreviewIb=function(t){if(o("WAWebPageLoadLogging").addPageLoadQplPoint("offline_preview_received"),o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,"OfflinePreviewReceived"),o("WAWebAppTracker").AppTracker.start(o("WAWebAppTracker").AppTrackerType.OfflineResume),this.$12(),this.$9=o("WAWebHandleOfflineAbProps").isOfflineDynamicBatchSizeEnabled(),this.$1!=null){var e=this.$1;o("WAWebBackendEventBus").BackendEventBus.isMainStreamReadyMd&&this.isResumeFromRestartComplete()?I(t.message)?(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab][non-blocking] resume from current state of app"]))),this.offlineResumeManager=e({mainScreenLoaded:!0})):(o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab] restart client due to exceed the LIMIT, message: ",""])),t.message),o("WAWebOfflineResumeUtils").refreshWindow()):!this.$2&&!this.isResumeFromRestartComplete()&&I(t.message)&&(o("WAWebPageLoadLogging").addPageLoadQplAnnotation({blocking_resume:!1}),this.offlineResumeManager=e())}this.$2=!0,this.offlineResumeManager.processOfflinePreview(t)},r.processMessageDecryptResult=function(t){this.offlineResumeManager.processDecryptResult(t),this.$3-=1,this.$13()},r.addOfflinePendingMessage=function(){this.isResumeFromRestartComplete()||(this.$3+=1)},r.newOfflineStanza=function(t,n,r){var e=this;return this.$4=!1,this.$8=Math.max(this.$8,r),this.$6==null&&(this.$6=self.setTimeout(function(){e.$13(),e.$6=null,o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _endBatchCheck: done"])))},0)),this.offlineResumeManager.newOfflineStanza(t,n,r)},r.offlineStanzaReceivedAfterComplete=function(){return this.offlineResumeManager.offlineStanzaReceivedAfterComplete()},r.getOfflineDeliveryProgress=function(){return this.offlineResumeManager.getOfflineDeliveryProgress()},r.getOfflineMessageCount=function(){return Math.max(this.offlineResumeManager.offlineMessagePreviewCounter,0)},r.isResumeOnSocketDisconnectInProgress=function(){return this.offlineResumeManager.isResumeOnSocketDisconnectInProgress()},r.isResumeFromRestartComplete=function(){return this.offlineResumeManager.isResumeFromRestartComplete()},r.isResumeComplete=function(){return this.offlineResumeManager.isResumeComplete()},r.getHasMessagesToDownload=function(){return this.offlineResumeManager.getHasMessagesToDownload()},r.getFinishedDownloading=function(){return this.getOfflineDeliveryProgress()===100},r.processOfflineIb=function(t){return o("WAWebPageLoadLogging").addPageLoadQplPoint("offline_received"),o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,"OfflineIbReceived"),this.offlineResumeManager.processOfflineSessionComplete(t).finally(function(){o("WAWebAppTracker").AppTracker.stop(o("WAWebAppTracker").AppTrackerType.OfflineResume)})},r.shouldUseOfflineResumeScreen=function(){return this.offlineResumeManager.shouldUseOfflineResumeScreen()},r.getResumeUIProgressBarType=function(){return this.offlineResumeManager.getResumeUIProgressBarType()},r.hasInitOfflineResumeManager=function(){return this.offlineResumeManager!=null},r.getResumeType=function(){return this.offlineResumeManager.resumeType},r.$12=function(){this.$4=!1,this.$5=!1,this.$10=0},r.$14=function(t,n){var e=this;n===void 0&&(n=!1);var r=n===!0||this.$10===0;this.$11!=null&&self.clearTimeout(this.$11),r?(o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive][debounced] _maybeRequestMoreStanza: request next batch, pending message ",""])),this.$3),o("WASmaxOfflineBatchRPC").sendBatchRPC({offlineBatchCount:t}),this.$10=Date.now(),this.$8=0,this.$4=!0,this.$5=!1):this.$11=self.setTimeout(function(){e.$15()},v)},r.$15=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e===void 0&&(e=!1);var t=Date.now()-this.$10,n=e||!this.isResumeComplete()&&this.$3<=y&&t>=v&&this.$4===!1&&this.$5===!0;if(!((this.isResumeComplete()||this.$4||this.$5)&&(this.isResumeComplete()||o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive][debounced] _maybeRequestMoreStanzaDebounced: skipDebouncing: ",", prevPending: ",", currentPending: ",", complete: ",""])),n,this.$4,this.$5,this.isResumeComplete()),n===!1))&&this.$3<=y){o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive][debounced] _maybeRequestMoreStanzaDebounced: start request next batch"]))),this.$5=!0,yield o("WAWebEventsWaitForReadyForOffline").waitForOfflineProcessReady();var r=y;r=R(this.$8,this.$7),this.$7=r,this.$14(r,n)}});function t(t){return e.apply(this,arguments)}return t})(),r.$13=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e===void 0&&(e=!1),this.$9)return this.$15(e);if(this.isResumeComplete()||this.$4||this.$5){this.isResumeComplete()||o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _maybeRequestMoreStanza: skip, prevPending: ",", currentPending: ",", complete: ",""])),this.$4,this.$5,this.isResumeComplete());return}this.$3<=y&&(o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _maybeRequestMoreStanza: start request next batch"]))),this.$5=!0,yield o("WAWebEventsWaitForReadyForOffline").waitForOfflineProcessReady(),o("WASmaxOfflineBatchRPC").sendBatchRPC({offlineBatchCount:y}),this.$5=!1,this.$4=!0,o("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _maybeRequestMoreStanza: request next batch, pending message ",""])),this.$3))});function t(t){return e.apply(this,arguments)}return t})(),t})();function E(e,t,n,r){if(r===void 0&&(r=.2),e===0)return b;if(e>3)return C;var o=null,a=e-(t!=null?t:0);if(a===0){var i;o=Math.floor(n*r)+n,((i=S.get(e-1))!=null?i:b)<=o&&(o=n)}else o=S.get(e);return o!=null||s(0,75725,e,t!=null?t:"N/A",n),o!=null?o:b}function k(){var e=null;return function(t,n){var r=o("WAWebHandleOfflineAbProps").getOfflineDynamicBatchConfig(),a=r.multiplier,i=r.version,l=e;return e=t,i==="progressive"?E(t,l,n,a):b}}function I(e){return!(e>=o("WAWebHandleOfflineAbProps").getNonBlockingOfflineResumeMaxMessageCount())}var T=new L;l.DEFAULT_MAX_BATCH_SIZE=b,l.OfflineMessageHandlerImpl=L,l.OfflineMessageHandler=T}),98);
__d("WAWebDBProcessGroupInviteMsgs",["WALogger","WATimeUtils","WAWebApiGroupInviteV4Store","WAWebLid1X1MigrationGating","WAWebLidMigrationUtils","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){return p(e)});yield o("WAWebApiGroupInviteV4Store").persistGroupInviteV4Msgs(t)}),m.apply(this,arguments)}function p(t){var n=o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated(),r=n?o("WAWebLidMigrationUtils").toLid(t.from):t.from,a=n?o("WAWebLidMigrationUtils").toLid(t.to):t.to;if(!r||!a){var i=o("WAWebUserPrefsMeUser").isMeAccount(t.author);o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[group-invites] isLidMigrated: ",", validMsgAuthor: ",", isPeerMsg: ",""])),n,t.author!=null,i),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[group-invites] failed to get lid mapping for "," ",""])),r?"":"msg.from &",a?"":"msg.to");var l="[group-invites] failed to get lid mapping for *incoming* group invite";o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",""])),l).sendLogs(l)}var d=o("WAWebLidMigrationUtils").getAddressingModeString(r==null?void 0:r.isLid()),m=o("WAWebLidMigrationUtils").getAddressingModeString(a==null?void 0:a.isLid());return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[group-invites] incoming invite has fields with the following addressing mode: from = ",", to = ",""])),d,m),{id:t.id.toString(),from:r==null?void 0:r.toString(),to:a==null?void 0:a.toString(),groupId:t.inviteGrp,expiration:parseInt(t.inviteCodeExp,10),expired:o("WATimeUtils").unixTime()>=parseInt(t.inviteCodeExp,10)}}l.processGroupInviteMessages=d}),98);
__d("WAWebDBReplaceUnknownAssociations",["WAWebMessageAssociation.flow","WAWebSchemaMessageAssociation"],(function(t,n,r,o,a,i,l){function e(e){var t=[];if(e.length){var n=e.map(function(e){return[e.msgKey,o("WAWebMessageAssociation.flow").MessageAssociationType.UNKNOWN]});t.push(o("WAWebSchemaMessageAssociation").getMessageAssociationTable().bulkRemove(n)),t.push(o("WAWebSchemaMessageAssociation").getMessageAssociationTable().bulkCreateOrReplace(e))}return t}l.replaceUnknownAssociations=e}),98);
__d("WAWebMessageAssociationUIUpdateFromStorage",["WAWebBackendApi","WAWebHandleMsgTypes.flow"],(function(t,n,r,o,a,i,l){"use strict";function e(e){e.forEach(function(e){o("WAWebBackendApi").frontendFireAndForget("updateMessageUI",{chatId:e.id.remote,msg:e,messageOverwriteOption:o("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE,preserveOrder:!0})})}l.updateAssociatedMsgsUIFromStorage=e}),98);
__d("WAWebStoreMsgs",["Promise","WALogger","WAWebAddonGatingUtils","WAWebAddonProcessMsgs","WAWebAddonProcessMsgsUtils","WAWebApiFilterAndReplaceMessages","WAWebApiOrphanRevoke","WAWebBackendApi","WAWebBackendEventBus","WAWebBizCoexGatingUtils","WAWebCastToReactionMsg","WAWebCheckUpdateOrphanReactions","WAWebCommonMsgUtils","WAWebDBAddOnProviders","WAWebDBMessageBulkHelper","WAWebDBMessageSerialization","WAWebDBProcessEditProtocolMsgs","WAWebDBProcessGroupInviteMsgs","WAWebDBProcessPaymentMessages","WAWebDBProcessPollUpdateMsgs","WAWebDBProcessReactionsMsgs","WAWebDBProcessReplyMsgs","WAWebDBReplaceUnknownAssociations","WAWebDBStoreMessage","WAWebDBStoreRevokeMsgs","WAWebDBThreadMetadataBulkHelper","WAWebHandleForMessageRange","WAWebHandlePlaceholderWam","WAWebLinkify","WAWebMessageAssociationGatingUtils","WAWebMessageAssociationUIUpdateFromStorage","WAWebMsgGetters","WAWebMsgType","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebProcessMessageAssociationMessages","WAWebSchemaMessage","WAWebStoreOrphans","asyncToGeneratorRuntime","compactMap","gkx","nullthrows"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f;function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebSchemaMessage").getMessageTable().bulkRemove(e.map(function(e){return e.id.toString()}))}),h.apply(this,arguments)}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length!==0)try{var a=yield S(t),i=r("compactMap")(Object.entries(a),function(e){var t=e[0],n=e[1];if(Array.isArray(n)&&n.length>0)return t+": "+n.length;if(n instanceof Map&&n.size>0)return t+": "+n.size}).join(", ");o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] start: ",""])),i);var l=[],m=a.botInvokeSystemMsgs,p=a.chatsWithNewOfflineMsg,_=a.editProtocolMsgs,h=a.groupInviteMsgs,y=a.keepInChatMessages,C=a.newAssociatedMsgs,R=a.newMsgsMap,L=a.newsletterMsgs,E=a.paymentMsgs,k=a.pollUpdateMsgs,I=a.reactionMsgs,T=a.removedPlaceholders,D=a.replaceCommentMsgs,x=a.replaceMsgs,$=a.replyMsgs,P=a.revokeMsgs,N=a.unifiedAddons,M=yield o("WAWebProcessMessageAssociationMessages").classifyAssociatedMsgsUsingExistingParentsCache(C,R),w=Array.from(R.values());if(M!=null&&M.orphanAssociatedMsgs.length){var A;l=l.concat((A=M==null?void 0:M.orphanAssociatedMsgs)!=null?A:[])}var F;M&&(F=o("WAWebApiFilterAndReplaceMessages").validateMsgFn(M==null?void 0:M.validAssociatedMsgs));var O=yield o("WAWebApiFilterAndReplaceMessages").filterAndReplaceMessages(w,F),B=O.newMsgs;yield o("WAWebDBMessageBulkHelper").persistNewMessagesInBulk(B,p),yield o("WAWebDBMessageBulkHelper").persistNewNewsletterMessagesInBulk(L),yield o("WAWebDBThreadMetadataBulkHelper").persistNewMessagesThreadMetadataInBulk(B);var W=[o("WAWebSchemaMessage").getMessageTable().bulkCreateOrReplace(x)],q=[];x.forEach(function(e){e.associationType!=null&&e.parentMsgKey!=null&&e.internalId!=null&&q.push({msgKey:e.id,parentMsgKey:e.parentMsgKey,associationType:e.associationType,msgKeyInternalId:e.internalId})}),q.length>0&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&W.push.apply(W,o("WAWebDBReplaceUnknownAssociations").replaceUnknownAssociations(q)),yield(f||(f=n("Promise"))).all(W),yield g(D);var U=yield o("WAWebAddonProcessMsgs").processMsgsAndGetOrphans(N),V=U.orphans;V.length&&(l=l.concat(V)),l.length!==0&&(yield o("WAWebStoreOrphans").storeOrphans(l));var H=yield o("WAWebApiOrphanRevoke").applyAddonRevokes(N);if(H.length>0)for(var G of H)P.push(G);if(yield v(P),yield o("WAWebDBProcessPaymentMessages").processPaymentMessages(E),yield o("WAWebDBProcessReactionsMsgs").processReactionMsgs(I),yield o("WAWebDBProcessGroupInviteMsgs").processGroupInviteMessages(h),M!=null&&M.detachedAssociatedMsgs.length&&o("WAWebMessageAssociationUIUpdateFromStorage").updateAssociatedMsgsUIFromStorage(M==null?void 0:M.detachedAssociatedMsgs),yield o("WAWebBackendApi").frontendSendAndReceive("processKeepInChatMessages",{keepInChatMessages:y,allowNotification:!1}),yield o("WAWebDBProcessEditProtocolMsgs").processEditProtocolMsgs(_),yield o("WAWebDBProcessReplyMsgs").processReplyMsgs($),yield o("WAWebDBProcessPollUpdateMsgs").processPollUpdateMsgs(k),yield o("WAWebHandleForMessageRange").handleOfflineForMessageRange(t),m.length>0){var z=new Set;m.forEach(function(e){z.has(e.id.remote.toString())||(z.add(e.id.remote.toString()),o("WAWebBackendApi").frontendFireAndForget("updateBotInvokeSystemMsgCreated",{chatId:e.id.remote}))})}var j=t.map(function(e){return e.id.toString()});try{yield o("WAWebBackendApi").frontendSendAndReceive("checkOrphanMutations",{msgIds:j,chatIds:p}),yield o("WAWebCheckUpdateOrphanReactions").checkUpdateForOrphanReactions(j)}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["storeMsgs: checkOrphanMutations failed during handleSingleMsg for: "," chat: "," Error: ",", message: ",", stack: ",""])),String(j.join(" ")),String(t[0].id.remote),e.name,e.message,e.stack)}b(w,T),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] done: ",""])),i)}catch(e){r("gkx")("26258")?o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] Error: ",", message: ",", stack: ",""])),e.name,e.message,e.stack).sendLogs("storeMsgs-error",{sampling:.01}):o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] Error: ",", message: ",", stack: ",""])),e.name,e.message,e.stack).sendLogs("storeMsgs-error: "+e.message)}}),C.apply(this,arguments)}function b(e,t){var n=e.filter(function(e){return o("WAWebCommonMsgUtils").isPlaceholderMsg(e.type)&&e.type!==o("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER});n.length>0&&o("WAWebHandlePlaceholderWam").postPlaceholderActivityAddEvent(n),t.length>0&&o("WAWebHandlePlaceholderWam").postPlaceholderActivityPopulateEvent(t)}function v(e){var t=[];return e.forEach(function(e){if(e.protocolMessageKey){var n=r("nullthrows")(e.t,"revoke timestamp is null");t.push({revokeMsgKey:e.protocolMessageKey,newMsgKey:e.id,timestamp:n,subtype:e.subtype,sender:o("WAWebMsgGetters").getSender(e),revokeTimestamp:n,viewMode:e.viewMode})}}),o("WAWebDBStoreRevokeMsgs").processRevokeMsgs(t).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(t.length>0){var n=[],r=new Set;t.forEach(function(e){n.push(e.revokeMsgKey.toString());var t=e.revokeMsgKey.remote.toString();r.add(t)}),yield o("WAWebPersistedJobManager").getJobManager().waitUntilPersisted(o("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(Array.from(r.values()).join(","),n))}return e});return function(t){return e.apply(this,arguments)}})())}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(e.map(function(e){return String(e.id)}),!1),n=[],r=[],a=[],i=[],l=[],s=[],u=[],c=[],d=[],f=[],g=[],h=[],y=new Set,C=new Map,b=new Map,v=[],S=[],R=[];return e.forEach(function(e,_){var k=e,I=String(e.id),T=t[_];if(T!=null&&E(e,T)){if(e.type===o("WAWebMsgType").MSG_TYPE.COMMENT){var D=o("WAWebAddonProcessMsgsUtils").castToAddonMsgData(k);o("WAWebAddonGatingUtils").isUnifiedInfraEnabled(e)&&D!=null&&h.push(D),S.push(e)}else{var x,$=o("WAWebDBMessageSerialization").dbRowFromMessage(k);$.t=T.t,$.internalId=T.internalId,$.rowId=T.rowId,$.pendingReadReceipt=T.pendingReadReceipt,o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&T.placeholderCreatedWhenAccountIsHosted===!1&&$.senderOrRecipientAccountTypeHosted===!0&&(x=e.id)!=null&&(x=x.remote)!=null&&x.isUser()&&($.hostedBizEncStateMismatch=!0,o("WAWebBackendEventBus").BackendEventBus.isMainStreamReadyMd&&o("WAWebBackendApi").frontendFireAndForget("updateMsgModelHostedBizEncStateMismatchFlagToTrue",{msgId:e.id}));var P=o("WAWebDBStoreMessage").isPendingUnreadReceipt(k.id,k),N=o("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:$,chatId:k.id.remote.toString(),hasLink:o("WAWebLinkify").hasHttpLink(k),pendingReadReceipt:P});r.push(N)}o("WAWebCommonMsgUtils").isPlaceholderMsg(T.type)&&b.set(I,k)}else if(T&&!(o("WAWebCommonMsgUtils").isFutureproofMsg(T.type)&&L(e)))n.push(e.id.id);else{var M=C.get(I),w=M!=null&&!o("WAWebCommonMsgUtils").isPlaceholderMsg(M.type);if(w)n.push(e.id.id);else if(e.type===o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE&&e.subtype==="bot_invoke_disclaimer"&&v.push(k),o("WAWebMsgGetters").getIsNewsletterMsg(e)&&e.type!==o("WAWebMsgType").MSG_TYPE.PROTOCOL&&e.subtype!=="admin_revoke")g.push(k);else if(o("WAWebAddonGatingUtils").isUnifiedInfraEnabled(e)&&o("WAWebAddonProcessMsgsUtils").castToAddonMsgData(k)!=null){var A=o("WAWebAddonProcessMsgsUtils").castToAddonMsgData(k);A!=null&&h.push(A)}else e.type===o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT?u.push(k):o("WAWebCastToReactionMsg").castToReactionMsgData(k)!=null?i.push(o("WAWebCastToReactionMsg").assertReactionMsgData(k)):e.kind===o("WAWebMsgType").MsgKind.PollVoteEncrypted?s.push(e):e.kind===o("WAWebMsgType").MsgKind.ProtocolRevoke?a.push(e):["sender_revoke","admin_revoke"].includes(e.subtype)?(a.push(e),o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["storeMsgs: receive a protocol message with a type ",""])),e.type).tags("messaging").sendLogs("storeMsgs-protocol",{sampling:.01})):e.type===o("WAWebMsgType").MSG_TYPE.PAYMENT&&e.subtype==="send"||e.subtype==="payment_action_request_declined"||e.subtype==="payment_transaction_request_cancelled"?(l.push(k),C.set(I,k),y.add(String(e.id.remote))):e.type===o("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE?(c.push(k),C.set(I,k),y.add(String(e.id.remote))):e.type===o("WAWebMsgType").MSG_TYPE.PROTOCOL&&e.subtype==="message_edit"?d.push(k):e.quotedMsg||e.quotedStanzaID!=null?(f.push(k),C.set(I,k),y.add(String(e.id.remote))):e.associationType!=null?(C.set(I,k),R.push(e),y.add(String(e.id.remote))):e.type!==o("WAWebMsgType").MSG_TYPE.PROTOCOL?(C.set(I,k),y.add(String(e.id.remote))):o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["storeMsgs: skipping unhandled message with type "," and subtype ",""])),e.type,e.subtype)}}),n.length>0&&o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] [classify-msgs]: skip for "," duplicate messages, with id ",""])),n.length,n),{newMsgsMap:C,newAssociatedMsgs:R,chatsWithNewOfflineMsg:Array.from(y),removedPlaceholders:Array.from(b.values()),replaceMsgs:r,revokeMsgs:a,paymentMsgs:l,reactionMsgs:i,pollUpdateMsgs:s,keepInChatMessages:u,groupInviteMsgs:c,editProtocolMsgs:d,replyMsgs:f,newsletterMsgs:g,unifiedAddons:h,botInvokeSystemMsgs:v,replaceCommentMsgs:S}}),R.apply(this,arguments)}function L(e){return o("WAWebAddonGatingUtils").isUnifiedInfraEnabled(e)?!0:!!o("WAWebDBAddOnProviders").getAddOnProviderForMsg(e)}function E(e,t){return o("WAWebCommonMsgUtils").isPlaceholderMsg(t.type)&&!o("WAWebCommonMsgUtils").isPlaceholderMsg(e.type)||o("WAWebCommonMsgUtils").isFutureproofMsg(t.type)&&!o("WAWebCommonMsgUtils").isFutureproofMsg(e.type)&&!L(e)||o("WAWebCommonMsgUtils").isRichResponseMsg(t.type)&&o("WAWebCommonMsgUtils").isSomewhatParsedRichResponseMsg(e)}l.storeMsgs=y,l.classifyMsgs=S}),98);
__d("WAWebStoreOrphans",["WAWebAddonProcessMsgsUtils","WAWebDBStoreMessageOrphans","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.length!==0&&(yield o("WAWebDBStoreMessageOrphans").storeMessageOrphans(e,function(e){return o("WAWebAddonProcessMsgsUtils").getParentMsgKey(e)}))}),s.apply(this,arguments)}l.storeOrphans=e}),98);
__d("WAWebMarkAddOnsAsReadJob",["Promise","WAJobOrchestratorTypes","WAWebAddOnsMarkAddOnsAsReadDb","WAWebAddonMarkAsReadUtils","WAWebBackendApi","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markAddOnsAsRead",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebAddOnsMarkAddOnsAsReadDb").markAddOnsAsReadDb(e.updates),o("WAWebBackendApi").frontendFireAndForget("markAddOnsAsReadUi",{updatedMsgKeys:e.updates})});return function(t){return e.apply(this,arguments)}})(),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted({updates:e})}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markAddOnsAsReadUsingAddonInfra",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebAddonMarkAsReadUtils").processMarkAsRead(e.addons)});return function(t){return e.apply(this,arguments)}})(),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted({addons:e})}),d.apply(this,arguments)}function m(t){return t.length===0?(e||(e=n("Promise"))).resolve({updatedAddOns:new Map,updatedOrphans:[]}):o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markUnclassifiedAddOnsAsRead",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebAddOnsMarkAddOnsAsReadDb").markUnclassifiedAddOnsAsReadDb(e.msgKeys);return o("WAWebBackendApi").frontendFireAndForget("markAddOnsAsReadUi",{updatedMsgKeys:t.updatedAddOns}),t});return function(t){return e.apply(this,arguments)}})(),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted({msgKeys:t})}l.markAddOnsAsReadJob=s,l.markAddOnsAsReadUsingAddonInfraJob=c,l.markUnclassifiedAddOnsAsReadJob=m}),98);
__d("WAWebGetIdentityKeysJob",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebCryptoCurve25519","WAWebJidToWid","WAWebSignalCommonUtils","WAWebSignalProtocolStore","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u=new(r("WADeprecatedWapParser"))("identityKeysParser",function(e){return e.child("list").mapChildren(function(e){if(e.hasChild("error")){var t=e.child("error"),n=t.attrInt("code"),a=t.attrString("text");throw r("err")("identityKeysParser bad response: "+n+" "+a)}else return{type:e.child("type").contentBytes(1),identity:e.child("identity").contentBytes(32),user:o("WAWebJidToWid").deviceJidToDeviceWid(e.attrDeviceJid("jid"))}})});function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkLoadIdentityKey(t.map(function(e){return String(o("WAWebSignalCommonUtils").createSignalAddress(e))})),r=t.filter(function(e,t){return n[t]==null});if(r.length===0){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getAndStoreIdentityKeys: got 0 missing keys"])));return}o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getAndStoreIdentityKeys: query "," missing keys for "," contacts"])),r.length,t.length);var a=yield m(r),i=a.map(function(e){var t=e.identity,n=o("WAWebCryptoCurve25519").toSignalCurvePubKey(t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset)),r=o("WAWebSignalCommonUtils").bufferToStr(n),a=o("WAWebSignalCommonUtils").createSignalAddress(e.user);return{identityKey:r,identifier:a.toString()}});return o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkCreateIdentity(i)}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=e.map(function(e){return o("WAWap").wap("user",{jid:o("WAWebCommsWapMd").DEVICE_JID(e)})}),a=(t=o("WAWap")).wap("iq",{xmlns:"encrypt",type:"get",to:t.S_WHATSAPP_NET,id:t.generateId()},t.wap("identity",null,n)),i=yield o("WADeprecatedSendIq").deprecatedSendIq(a,u);if(!i.success)throw r("err")("getIdentityKeys bad response "+String(i));return i.result}),p.apply(this,arguments)}l.getAndStoreIdentityKeys=c}),98);
__d("WAWebSendAggregateDeliveryReceipts",["$InternalEnum","Promise","WAWebBackendApi","WAWebBackendEventBus","WAWebBoolFunc","WAWebDBMsgUtils","WAWebHandleMsgMetaUtils","WAWebMsgProcessingApiUtils","WAWebPollsVotesSchema","WAWebSchemaReactions","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum").Mirrored(["Message","Reaction","PollVote","NotSupportedAddon"]),u=function(t){return t.hasHideFailEnc?o("WAWebHandleMsgMetaUtils").isPollVoteMsgMeta(t.msgMeta)?s.PollVote:o("WAWebHandleMsgMetaUtils").isReactionMsgMeta(t.msgMeta)?s.Reaction:s.NotSupportedAddon:s.Message};function c(e){var t=new Map;return e.forEach(function(e){var n,r=u(e),o=(n=t.get(r))!=null?n:t.set(r,[]).get(r);o==null||o.push(e)}),t}function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.map(function(e){var t=e.msgInfo;return o("WAWebMsgProcessingApiUtils").messageInfoToKey(t)}),a=o("WAWebBackendEventBus").BackendEventBus.isMainStreamReadyMd?yield t(r):r.map(o("WAWebBoolFunc").returnFalse),i=new Set,l=[];for(var s of a.entries()){var u=s[0],c=s[1];c?i.add(r[u].toString()):l.push(r[u].toString())}if(l.length===0)return i;var d=yield n(l);return new Set([].concat(Array.from(i),Array.from(d)))}),m.apply(this,arguments)}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e===s.Message?d(t,function(e){return o("WAWebBackendApi").frontendSendAndReceive("hasMsgsInCollection",{msgKeys:e})},(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Set;return o("WAWebDBMsgUtils").getMsgsExistByMsgKey(e).then(function(n){for(var r of n.entries()){var o=r[0],a=r[1];a&&t.add(e[o])}return t})});return function(t){return e.apply(this,arguments)}})()):e===s.Reaction?d(t,function(e){return o("WAWebBackendApi").frontendSendAndReceive("hasReactionsInCollection",{msgKeys:e})},function(e){var t=new Set;return o("WAWebSchemaReactions").getReactionsTable().anyOf(["msgKey"],e).then(function(e){for(var n of e)t.add(n.msgKey);return t})}):e===s.PollVote?d(t,function(e){return o("WAWebBackendApi").frontendSendAndReceive("hasPollVotesInCollection",{msgKeys:e})},function(e){return o("WAWebPollsVotesSchema").getTable().anyOf(["msgKey"],e,{shouldDecrypt:!1}).then(function(e){var t=new Set;for(var n of e)t.add(n.msgKey);return t})}):e===s.NotSupportedAddon?new Set(t.map(function(e){var t=e.msgInfo;return o("WAWebMsgProcessingApiUtils").messageInfoToKey(t).toString()})):(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0],n=e[1],r=[],a=[];for(var i of n)i.msgReceivedTimes>1?r.push({isInDB:!0,receipt:i}):a.push(i);if(a.length>0){var l=yield p(t,a);r=r.concat(a.map(function(e){return{isInDB:l.has(o("WAWebMsgProcessingApiUtils").messageInfoToKey(e.msgInfo).toString()),receipt:e}}))}return r}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r,o=c(t),a=yield(e||(e=n("Promise"))).all(Array.from(o.entries(),f));return(r=[]).concat.apply(r,a)}),y.apply(this,arguments)}l.aggregateDeliveryReceipts=h}),98);
__d("WAWebUnknownStanzaWamEvent",["WAWebWamCodegenUtils"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({UnknownStanza:[3448,{unknownStanzaDropReason:[3,e.TYPES.INTEGER],unknownStanzaTag:[1,e.TYPES.STRING],unknownStanzaType:[2,e.TYPES.STRING]},[1,1,1],"regular"]},{UnknownStanza:[]});l.UnknownStanzaWamEvent=s}),98);
__d("WAWebPostUnknownStanzaMetric",["WAWebUnknownStanzaWamEvent"],(function(t,n,r,o,a,i,l){function e(e){var t;new(o("WAWebUnknownStanzaWamEvent")).UnknownStanzaWamEvent({unknownStanzaTag:e.tag,unknownStanzaType:(t=e.attrs.type)==null?void 0:t.toString()}).commit()}l.postUnknownStanzaMetric=e}),98);
__d("WAWebCreateNackFromStanza",["$InternalEnum","WALogger","WAWap","WAWebCurrentUser","WAWebPostUnknownStanzaMetric","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_=n("$InternalEnum")({StaleGroupAddressingMode:421,NewChatMessagesCapped:475,ParsingError:487,UnrecognizedStanza:488,UnrecognizedStanzaClass:489,UnrecognizedStanzaType:490,InvalidProtobuf:491,InvalidHostedCompanionStanza:493,MissingMessageSecret:495,SignalErrorOldCounter:496,MessageDeletedOnPeer:499,UnhandledError:500,UnsupportedAdminRevoke:550,UnsupportedLIDGroup:551,DBOperationFailed:552});function f(t,n){var a,i,l=t==null?void 0:t.tag,p=t==null||(a=t.attrs)==null?void 0:a.id,f=t==null||(i=t.attrs)==null||(i=i.type)==null?void 0:i.toString(),h=_.getName(n);try{var y,C;if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: class: '","' type: '","' id: '","' reason: '","'"])),l,f,p,h),l==="receipt"&&n===_.UnrecognizedStanza&&o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unrecognized receipt stanza: type: '","'"])),f).sendLogs("unrecognized-receipt-stanza",{sampling:o("WAWebCurrentUser").isEmployee()?1:.001}),((y=t.attrs.type)==null?void 0:y.toString())==="text"&&t.tag==="message"&&o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: unknown text type stanza"]))).sendLogs("createNackFromStanza-unknown-text-type-stanza",{sampling:.01}),p!=null&&(t==null||(C=t.attrs)==null?void 0:C.from)!=null)return g(t,n);o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: failed: 'id' or 'form' is null for class: '","' type: '","' reason: '","'"])),l,f,h),o("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(t)}catch(e){var b;o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: failed for class: '","' type: '","' id: '","' reason: '","'"])),l,f,p,h);var v=r("getErrorSafe")(e);o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: failed with unhandled reason: ",""])),(b=v.message)!=null?b:e).sendLogs("send-nack-exception")}return"NO_ACK"}function g(e,t){var n=e.attrs;if(t===_.UnrecognizedStanza)return o("WAWap").wap("ack",{class:o("WAWap").CUSTOM_STRING(e.tag),id:n.id,to:n.from,type:n.type||o("WAWap").DROP_ATTR,participant:n.participant||o("WAWap").DROP_ATTR,error:o("WAWap").INT(t)});switch(e.tag){case"notification":return o("WAWap").wap("ack",{class:"notification",id:n.id,to:n.from,type:n.type||o("WAWap").DROP_ATTR,participant:n.participant||o("WAWap").DROP_ATTR,error:o("WAWap").INT(t)});case"message":return o("WAWap").wap("ack",{class:"message",id:n.id,to:n.from,type:n.type||o("WAWap").DROP_ATTR,participant:n.participant||o("WAWap").DROP_ATTR,error:o("WAWap").INT(t)});case"receipt":return o("WAWap").wap("ack",{class:"receipt",id:n.id,to:n.from,type:n.type||o("WAWap").DROP_ATTR,participant:n.participant||o("WAWap").DROP_ATTR,error:o("WAWap").INT(t)});default:return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["sendNack called with unsupported stanza tag: ",""])),e.tag).sendLogs("unsupported-nack"),o("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(e),"NO_ACK"}}l.NackReason=_,l.createNackFromStanza=f}),98);
__d("WAWebHandleMsgSendAck",["WADeprecatedSendIq","WALogger","WAWap","WAWebCommsWapMd","WAWebCreateNackFromStanza","WAWebUserPrefsMeUser"],(function(t,n,r,o,a,i,l){var e;function s(e,t,n,r){o("WADeprecatedSendIq").deprecatedCastStanza(o("WAWap").wap("ack",{id:o("WAWap").CUSTOM_STRING(e),class:"message",from:o("WAWebCommsWapMd").DEVICE_JID(o("WAWebUserPrefsMeUser").getMeDevicePnOrThrow()),to:t?o("WAWebCommsWapMd").JID(t):o("WAWap").DROP_ATTR,participant:r?o("WAWebCommsWapMd").DEVICE_JID(r):o("WAWap").DROP_ATTR,type:n!=null?n:o("WAWap").DROP_ATTR}))}function u(t,n,r,a,i,l){var s=null;i===o("WAWebCreateNackFromStanza").NackReason.InvalidProtobuf&&(l!=null?s=o("WAWap").wap("meta",{failure_reason:o("WAWap").INT(l)}):o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendNack: InvalidProtobuf error is missing e2eFailureReason"]))).sendLogs("invalid-protobuf-nack-missing-failure-reason")),o("WADeprecatedSendIq").deprecatedCastStanza(o("WAWap").wap("ack",{id:o("WAWap").CUSTOM_STRING(t),class:"message",from:o("WAWebCommsWapMd").DEVICE_JID(o("WAWebUserPrefsMeUser").getMeDevicePnOrThrow()),to:n?o("WAWebCommsWapMd").JID(n):o("WAWap").DROP_ATTR,participant:a?o("WAWebCommsWapMd").DEVICE_JID(a):o("WAWap").DROP_ATTR,type:r!=null?r:o("WAWap").DROP_ATTR,error:o("WAWap").INT(i)},s))}l.sendAck=s,l.sendNack=u}),98);
__d("WAWebPendingMessageKey",[],(function(t,n,r,o,a,i){function e(e,t,n){var r=n.map(function(e){return String(e.e2eType)+":"+e.retryCount}).join(",");return e.toString()+"_"+t.toString()+"_"+r}i.createPendingMessageKey=e}),66);
__d("WAWebMessageDedupUtils",["WALogger","WAWebABProps","WAWebPendingMessageKey"],(function(t,n,r,o,a,i,l){var e,s,u,c=new Map;function d(){return o("WAWebABProps").getABPropConfigValue("web_pending_message_cache_enabled")}function m(t,n,r){var a,i=o("WAWebPendingMessageKey").createPendingMessageKey(t,n,r),l=((a=c.get(i))!=null?a:0)+1;return c.set(i,l),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[message-dedup] add message: ",", total: ",""])),i,l),l}function p(e,t,n){var r=o("WAWebPendingMessageKey").createPendingMessageKey(e,t,n),a=c.get(r);return a==null?!1:(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[message-dedup] message "," is pending, total: ",""])),r,a),!0)}function _(e){e===0&&(c.size>0&&o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[message-dedup] message cache cleared, total: ",""])),c.size),c.clear())}l.isPengingMessageCacheEnabled=d,l.addPendingMessage=m,l.hasPendingMessage=p,l.maybeClearPendingMessages=_}),98);
__d("WAWebOffdStorageUtils",["invariant","Promise","WAWebIdb","WAWebStorage","err"],(function(t,n,r,o,a,i,l,s){var e,u="offd-storage",c=null;function d(){var e=new(r("WAWebIdb"))(u);c=new(o("WAWebStorage")).Storage(e)}function m(){return c!=null||s(0,56317),c}function p(){return c==null?(e||(e=n("Promise"))).reject(r("err")("[offd-storage] Storage should be created first before being destroyed")):c.purge().then(function(){c=null}).catch(function(e){throw c=null,e})}l.DATABASE_NAME=u,l.createStorage=d,l.getStorage=m,l.destroyStorage=p}),98);
__d("WAWebSchemaDanglingReceipt",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addAutoIncrementingPrimaryKey,u=e.addColumn;function c(){o("WAWebOffdStorageUtils").getStorage().add("dangling-receipt").version(o("WAWebOffdStorageUtils").getStorage().versions.version(1),[s("id"),u("receipts"),u("acks")]).view(function(e){return e})}function d(){return o("WAWebOffdStorageUtils").getStorage().table("dangling-receipt")}l.addTable=c,l.getTable=d}),98);
__d("WAWebCommsAckParser",["WAJids","WAWebWidToJid"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WAJids").extractJidFromJidWithType(o("WAWebWidToJid").widToJidWithType(e.from)),n=e.participant==null?void 0:o("WAWebWidToJid").widToDeviceJid(e.participant),r=e.recipient==null?void 0:o("WAWebWidToJid").widToUserJid(e.recipient);return babelHelpers.extends({},e,{from:t,participant:n,recipient:r})}l.toCoreAckTemplate=e}),98);
__d("WAWebSendReceiptJobCommon",["Promise","WADeprecatedSendIq","WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebABProps","WAWebCommsAckParser","WAWebCommsWapMd","WAWebCurrentUser","WAWebLidMigrationUtils","WAWebLidStatusMigrationGating","WAWebPrivacySettings","WAWebUserPrefsGeneral","asyncToGeneratorRuntime","lodash"],(function(t,n,r,o,a,i,l){var e,s,u,c,d=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"}),m=256,p=new(r("WADeprecatedWapParser"))("readReceiptAckParser",function(e){return e.assertTag("ack"),{readReceipts:e.hasAttr("readreceipts")?e.attrEnum("readreceipts",o("WAWebPrivacySettings").ALL_NONE):null}});function _(e,t){var n=r("lodash").flatten(Array.from(t.values())),a=n[0],i=babelHelpers.arrayLikeToArray(n).slice(1),l=i.length>0?o("WAWap").wap("list",null,i.map(function(e){return o("WAWap").wap("item",{id:o("WAWap").CUSTOM_STRING(e)})})):null,s=o("WAWap").wap("ack",{id:o("WAWap").CUSTOM_STRING(a),to:o("WAWebCommsWapMd").JID(e),class:"message",type:"text"},l);return o("WADeprecatedSendIq").deprecatedCastStanza(s)}function f(e,t,n,r){var a=e[0],i=babelHelpers.arrayLikeToArray(e).slice(1),l=i.length>0?o("WAWap").wap("list",null,i.map(function(e){return o("WAWap").wap("item",{id:o("WAWap").CUSTOM_STRING(e)})})):null,s=o("WAWap").wap("ack",{id:o("WAWap").CUSTOM_STRING(a),to:o("WAWebCommsWapMd").JID(t),recipient:n!=null?o("WAWebCommsWapMd").USER_JID(n):o("WAWap").DROP_ATTR,participant:r!=null?o("WAWebCommsWapMd").USER_JID(r):o("WAWap").DROP_ATTR,class:"message",type:"text"},l);return o("WADeprecatedSendIq").deprecatedCastStanza(s)}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupedReceipt,r=e.recipient,a=e.t,i=e.to,l=e.type;if(i.isNewsletter()&&l===d.DELIVERY)return _(i,t);var s=l===d.READ||l===d.PLAYED||l===d.READ_SELF||l===d.PLAYED_SELF||l===d.HISTORY_SYNC_COMPLETION;yield(c||(c=n("Promise"))).all(Array.from(t.keys(),function(e){var _=t.get(e);if(!(!_||_.length===0)){var g=!i.isBot()&&e.isBot();if(l===d.DELIVERY&&g){var h,C,b;i.isUser()?(h=e,C=i):(h=i,b=e),f(_,h,C,b);return}var v=i.isUser()||i.isNewsletter()?null:e,S=i,R=r;R==null&&i.isUser()&&!i.isBot()&&e.isBot()&&(S=e,R=i);for(var L=[],E=function(){var e=_.splice(0,m),t=null;e.length>1&&(t=o("WAWap").wap("list",null,e.slice(1).map(function(e){return o("WAWap").wap("item",{id:o("WAWap").CUSTOM_STRING(e)})})));var r,i;v!=null&&(v.isPSA()?r=o("WAWebCommsWapMd").JID(v):v.isUser()&&(r=o("WAWebCommsWapMd").DEVICE_JID(v),o("WAWebABProps").getABPropConfigValue("lid_status_non_soaked_client_support_enabled")&&o("WAWebLidStatusMigrationGating").getLidStatusSendEnabled()&&S.toString()===o("WAJids").STATUS_JID&&v.isLid()&&l===d.READ&&(i=o("WAWebLidMigrationUtils").toPn(v)))),R&&y(R,S);var c=o("WAWap").wap("receipt",{to:o("WAWebCommsWapMd").JID(S),type:l===d.DELIVERY?o("WAWap").DROP_ATTR:l,id:o("WAWap").CUSTOM_STRING(e[0]),t:a!=null?o("WAWap").CUSTOM_STRING(a):o("WAWap").DROP_ATTR,participant:r!=null?r:o("WAWap").DROP_ATTR,peer_participant_pn:i?o("WAWebCommsWapMd").USER_JID(i):o("WAWap").DROP_ATTR,recipient:R?o("WAWebCommsWapMd").USER_JID(R):o("WAWap").DROP_ATTR},t);if(s){var f=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t={id:e[0],from:S,class:"receipt",type:l,participant:v,recipient:R};if(l===d.READ||l===d.READ_SELF){var n=yield o("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(c,o("WAWebCommsAckParser").toCoreAckTemplate(t)),r=p.parse(n);if(r.error)o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[messaging] sendAggregateReceipts: Invalid ack from server"]))).sendLogs("Invalid-Receipt-Ack");else{var a=r.success.readReceipts;a!=null&&o("WAWebUserPrefsGeneral").setUserPrivacySettings(babelHelpers.extends({},o("WAWebUserPrefsGeneral").getUserPrivacySettings(),{readReceipts:a}))}}else return o("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(c,o("WAWebCommsAckParser").toCoreAckTemplate(t))});return function(){return t.apply(this,arguments)}})();L.push(f())}else L.push(o("WADeprecatedSendIq").deprecatedCastStanza(c))};_.length>0;)E();return(c||(c=n("Promise"))).all(L)}}))}),h.apply(this,arguments)}function y(t,n){if(t){var r=t.isLid()&&n.isUser()&&!n.isLid(),a=t.isUser()&&!t.isLid()&&n.isLid();(r||a)&&(o("WAWebCurrentUser").isEmployee()?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[sendDeliveryReceipt] will send mixed sender receipt (is employee). "," ",""])),t.toLogString(),n.toLogString()).sendLogs("mixed-sender-receipt"):o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[sendDeliveryReceipt] will send mixed sender receipt. "," ",""])),t.toLogString(),n.toLogString()).sendLogs("mixed-sender-receipt"))}}l.RECEIPT_TYPE=d,l.sendBotInvokeResponseAcks=f,l.sendAggregateReceipts=g,l.logMixedSenderReceipt=y}),98);
__d("WAWebSendOfflineDeliveryReceiptJob",["Promise","WAComms","WALogger","WATimeUtils","WAWebCreateNackFromStanza","WAWebHandleMsgSendAck","WAWebLid1X1MigrationGating","WAWebMessageDedupUtils","WAWebPostIncomingMessageDropMetric","WAWebSchemaDanglingReceipt","WAWebSendAggregateDeliveryReceipts","WAWebSendReceiptJobCommon","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m;function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=[];if(t.length===0)return n;var r=yield o("WAWebSendAggregateDeliveryReceipts").aggregateDeliveryReceipts(t);for(var a of r){var i=a.isInDB,l=a.receipt,c=l.author,d=l.enc,m=l.externalId,p=l.from,_=l.msgInfo,f=l.msgMeta,g=p.isUser()||p.isNewsletter()?null:c;i?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendAggregateOfflineReceipts: duplicate message exists in the db: ",""])),m),o("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropDuplicateMessage({msgMeta:f,msgInfo:_,enc:d}),o("WAWebMessageDedupUtils").isPengingMessageCacheEnabled()?o("WAWebHandleMsgSendAck").sendAck(m,p,f.type,g):(_.category==="peer"&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[sendDeliveryReceipt] peer receipt using aggregated receipt flow ",""])),o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated()).sendLogs("peer-receipt-using-aggregated-receipt"),n.push({externalId:m,from:p,author:c}))):(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["sendAggregateOfflineReceipts: duplicate message does not exist in the db: ",""])),m),o("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropOldCounter({msgMeta:f,msgInfo:_,enc:d}),o("WAWebHandleMsgSendAck").sendNack(m,p,f.type,g,o("WAWebCreateNackFromStanza").NackReason.SignalErrorOldCounter))}return n}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["sendAggregateOfflineReceipts"])));var t=[],r=[];for(var a of e){var i=a.duplicateMsgReceiptInfo,l=a.receiptInfo;i!=null&&r.push(i),l!=null&&t.push(l)}t=t.concat(yield p(r)),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["sendAggregateOfflineReceipts: "," receipts are ready to be sent"])),t.length);var s=new Map,u=[];t.forEach(function(e){var t=e.author,n=e.externalId,r=e.from,o=s.get(r);o||(o=new Map,s.set(r,o));var a=o.get(t);a||(a=[],o.set(t,a)),a.push(n),u.push({from:String(r),author:String(t),externalId:n})});var _=String(o("WATimeUtils").unixTime());(m||(m=n("Promise"))).all(Array.from(s.keys(),function(e){var t=s.get(e);if(t){var n=e.isUser()&&o("WAWebUserPrefsMeUser").isMeAccount(e);return o("WAWebSendReceiptJobCommon").sendAggregateReceipts({to:e,type:n?o("WAWebSendReceiptJobCommon").RECEIPT_TYPE.SENDER:o("WAWebSendReceiptJobCommon").RECEIPT_TYPE.DELIVERY,t:_,groupedReceipt:t,recipient:n?e:null})}})),o("WAComms").cancelDeadSocketTimer(),u.length>0&&(yield o("WAWebSchemaDanglingReceipt").getTable().create({receipts:u,acks:[]}))}),g.apply(this,arguments)}l.handleDuplicateMsgReceipts=p,l.sendAggregateOfflineReceipts=f}),98);
__d("WAWebWamEnumReportingTokenValidationFailureReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({MISSING_MESSAGE_SECRET:0,EMPTY_REPORTING_TOKEN_CONTENT:1,MISMATCH_REPORTING_TOKEN:2,UNSUPPORTED_VERSION:3});i.REPORTING_TOKEN_VALIDATION_FAILURE_REASON=e}),66);
__d("WAWebReportingTokenValidationFailureSenderWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType","WAWebWamEnumE2eDeviceType","WAWebWamEnumEditType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumReportingTokenValidationFailureReason"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ReportingTokenValidationFailureSender:[6094,{clientMessageId:[1,e.TYPES.STRING],e2eReceiverType:[2,o("WAWebWamEnumDeviceType").DEVICE_TYPE],e2eSenderType:[3,o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE],editType:[4,o("WAWebWamEnumEditType").EDIT_TYPE],isLid:[5,e.TYPES.BOOLEAN],isMessageMediaRetry:[14,e.TYPES.BOOLEAN],isMessageRetry:[6,e.TYPES.BOOLEAN],isSecretEncryptedMsg:[12,e.TYPES.BOOLEAN],messageIsForward:[15,e.TYPES.BOOLEAN],messageMediaType:[7,o("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[8,o("WAWebWamEnumMessageType").MESSAGE_TYPE],offline:[9,e.TYPES.BOOLEAN],reportingTokenValidationFailureReason:[10,o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON],reportingTokenVersion:[13,e.TYPES.INTEGER],senderJid:[11,e.TYPES.STRING]},[1,1,1],"private",113760892]},{ReportingTokenValidationFailureSender:[]});l.ReportingTokenValidationFailureSenderWamEvent=s}),98);
__d("WAWebReportingTokenValidationFailureWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumEditType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumReportingTokenValidationFailureReason"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ReportingTokenValidationFailure:[5466,{editType:[1,o("WAWebWamEnumEditType").EDIT_TYPE],isLid:[5,e.TYPES.BOOLEAN],isMessageMediaRetry:[10,e.TYPES.BOOLEAN],isMessageRetry:[6,e.TYPES.BOOLEAN],isSecretEncryptedMsg:[8,e.TYPES.BOOLEAN],messageIsForward:[11,e.TYPES.BOOLEAN],messageMediaType:[2,o("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[3,o("WAWebWamEnumMessageType").MESSAGE_TYPE],offline:[7,e.TYPES.BOOLEAN],reportingTokenValidationFailureReason:[4,o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON],reportingTokenVersion:[9,e.TYPES.INTEGER]},[1,1,1],"regular"]},{ReportingTokenValidationFailure:[]});l.ReportingTokenValidationFailureWamEvent=s}),98);
__d("WAWebWamReportingTokenMismatchReporter",["WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebReportingTokenValidationFailureSenderWamEvent","WAWebReportingTokenValidationFailureWamEvent","WAWebWamEnumDeviceType","WAWebWamMsgUtils"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.msg,r=e.reason,a=e.reportingTokenVersion,i=(t=n.senderWithDevice)!=null?t:o("WAWebMsgGetters").getSender(n);new(o("WAWebReportingTokenValidationFailureWamEvent")).ReportingTokenValidationFailureWamEvent({editType:o("WAWebMsgGetters").getWamEditType(n),messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(n),messageType:o("WAWebWamMsgUtils").getWamMessageType(n),reportingTokenValidationFailureReason:r,isLid:o("WAWebMsgKeyUtils").isLidMsgKey(n.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Message),isMessageRetry:n.isRetry===!0,offline:n.isOffline===!0,reportingTokenVersion:a,messageIsForward:o("WAWebMsgGetters").getIsForwarded(n),isSecretEncryptedMsg:n.kind===o("WAWebMsgType").MsgKind.CommentEncrypted}).commit();var l={clientMessageId:n.id.id,e2eReceiverType:o("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION,editType:o("WAWebMsgGetters").getWamEditType(n),messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(n),messageType:o("WAWebWamMsgUtils").getWamMessageType(n),reportingTokenValidationFailureReason:r,isLid:o("WAWebMsgKeyUtils").isLidMsgKey(n.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Message),isMessageRetry:n.isRetry===!0,offline:n.isOffline===!0,reportingTokenVersion:a,messageIsForward:o("WAWebMsgGetters").getIsForwarded(n),isSecretEncryptedMsg:n.kind===o("WAWebMsgType").MsgKind.CommentEncrypted};if(i!=null){l.senderJid=i.toString();var s=o("WAWebWamMsgUtils").getWamE2eSenderType(i);s!=null&&(l.e2eSenderType=s)}new(o("WAWebReportingTokenValidationFailureSenderWamEvent")).ReportingTokenValidationFailureSenderWamEvent(l).commit()}l.logReportingTokenValidationEvent=e}),98);
__d("WAWebReportingTokenUtils",["WABase64","WABinary","WACryptoHkdf","WACryptoHmac","WACryptoUtils","WAJids","WALogger","WATimeUtils","WAUseCaseSecret","WAWap","WAWebApiContact","WAWebCreateNackFromStanza","WAWebDBMessageSerialization","WAWebHandleMsgTypes.flow","WAWebLidMigrationUtils","WAWebMessageInsertDebugPlaceholder","WAWebMessagePluginGenerateReportingTokenContent","WAWebMessageSecretErrorsWamEvent","WAWebMessagingGatingUtils","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebReportingTokenConfig","WAWebReportingTokenContent","WAWebSchemaMessage","WAWebUserPrefsMeUser","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType","WAWebWamEnumReportingTokenValidationFailureReason","WAWebWamMsgUtils","WAWebWamReportingTokenMismatchReporter","WAWebWid","WAWebWidFactory","WAWebWidToJid","asyncToGeneratorRuntime","encodeProtobuf","isEmptyObject"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p=16,_=32,f=6,g=7,h={DEFAULT:1,HISTORY_SYNC:-1},y={sampling:.01},C={sampling:1};function b(e){var t=o("WAWebMsgGetters").getSender(e);return t==null?null:t.isLid()?o("WAWebLidMigrationUtils").toPn(t):t}function v(e){var t=o("WAWebMsgGetters").getSender(e);if(t==null)return null;if(t.isLid())return t;if(e.preMatChat!=null)return e.preMatChat;var n=o("WAWebApiContact").getCurrentLid(o("WAWebWidFactory").asUserWidOrThrow(t));return n!=null?o("WAWebWidFactory").createWid(n.toString()):null}function S(e){var t=o("WAWebMsgGetters").getSender(e);if(t==null)return[];var n=e.id.remote.isRegularUser();if(!n||o("WAWebMsgGetters").getBroadcastId(e)!=null){var r=M(e),a=b(e),i=v(e);return[{senderWid:t,receiverWid:r},{senderWid:t.isLid()?a:i,receiverWid:r}]}var l=b(e),s=v(e),u=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),c=o("WAWebUserPrefsMeUser").getMeLidUserOrThrow(),d=t.isLid()?[{senderWid:s,receiverWid:c},{senderWid:l,receiverWid:u}]:[{senderWid:l,receiverWid:u},{senderWid:s,receiverWid:c}];return o("WAWebMessagingGatingUtils").isReportingTokenSwappedFallbackValidationEnabled()&&d.push({senderWid:s,receiverWid:u},{senderWid:l,receiverWid:c}),d}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.messageSecret,n=e.remoteJid,r=e.senderJid,a=e.stanzaId,i=o("WABinary").Binary.build(a,r,n,o("WAUseCaseSecret").UseCaseSecretModificationType.REPORT_TOKEN).readBuffer();return o("WACryptoHkdf").extractAndExpand(t instanceof ArrayBuffer?new Uint8Array(t):t,i,_)}),L.apply(this,arguments)}function E(e){return o("WAJids").extractFromJid(o("WAWebWidToJid").widToJidWithType(M(e)))}function k(e){var t=o("WAWebWidToJid").widToJidWithType(e.id.remote);return{jidType:t.jidType,remoteJid:o("WAJids").extractFromJid(t)}}function I(e){var t,n;if(e.encFilehash==null&&e.caption==null)return null;var r=new Uint8Array(o("WABase64").decodeB64((t=e.encFilehash)!=null?t:"")),a=new TextEncoder().encode((n=e.caption)!=null?n:""),i=new Uint8Array(r.length+a.length);return i.set(r),i.set(a,r.length),self.crypto.getRandomValues(new Uint8Array(i.length))}function T(e,t){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r;if(!(o("WAWebMessagingGatingUtils").isReportingTokenSendingEnabled()&&o("WAWebMessagePluginGenerateReportingTokenContent").isMsgTypeReportingTokenCompatible(e.type,e.subtype)))return null;var a=(n=e.messageSecret)!=null?n:(r=t.messageContextInfo)==null?void 0:r.messageSecret,i=o("WAWebMsgGetters").getSender(e),l=k(e),s=l.jidType,u=l.remoteJid;if(s==="interopUser")return null;if(a==null)return new(o("WAWebMessageSecretErrorsWamEvent")).MessageSecretErrorsWamEvent({messageSecretAllowedList:o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_REPORTING_TOKEN,messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(e),messageSecretError:o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.MISSING_MESSAGE_SECRET}).commit(),null;if(i==null||u==null)return null;var c=o("WAWebMessagingGatingUtils").getSenderReportingTokenVersion(),d=yield R({messageSecret:a,stanzaId:e.id.id,senderJid:o("WAWebWidToJid").widToUserJid(o("WAWebWidFactory").asUserWidOrThrow(i)),remoteJid:u}),m;if(e.reportingTokenContent!=null)m=e.reportingTokenContent;else{var _=o("encodeProtobuf").encodeProtobuf(o("WAWebProtobufsE2E.pb").MessageSpec,t);m=new(o("WAWebReportingTokenContent")).ReportingTokenContentCalculator(_.readByteArrayView(),o("WAWebReportingTokenConfig").getReportingTokenConfig(c)).getReportingTokenContent()}if(m==null||m.length===0)return null;var f=yield o("WACryptoHmac").hmacSha256(new Uint8Array(d),m!=null?m:new Uint8Array(0),p);return{version:c,reportingToken:new Uint8Array(f)}}),D.apply(this,arguments)}function x(e,t){return $.apply(this,arguments)}function $(){return $=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{var r,a=(r=yield T(t,n))!=null?r:{},i=a.reportingToken,l=a.version;return i==null||l==null?null:o("WAWap").wap("reporting",null,o("WAWap").wap("reporting_token",{v:o("WAWap").CUSTOM_STRING(String(l))},i))}catch(t){return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["unexpected exception in generating reporting token body: ",""])),t).tags("messaging","wa-ice","report-token").sendLogs("report-token-unexpected-exception",y),null}}),$.apply(this,arguments)}function P(e,t){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n,r=(n=yield T(e,t))!=null?n:{},a=r.reportingToken,i=r.version;return a==null||i==null?null:{reportingTokenV:i,reportingTokenElementValue:a}}catch(e){return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["unexpected exception in generating reporting token mixin args: ",""])),e).tags("messaging","wa-ice","report-token").sendLogs("report-token-unexpected-exception",y),null}}),N.apply(this,arguments)}function M(e){var t=o("WAWebMsgGetters").getBroadcastId(e);if(t!=null)return t;var n=e.id.remote;return n.isRegularUser()?n.isLid()?o("WAWebUserPrefsMeUser").getMeLidUserOrThrow():o("WAWebUserPrefsMeUser").getMePnUserOrThrow():n}function w(e){return o("WAWebMsgGetters").getIsEdited(e)&&!o("WAWebMessagingGatingUtils").isReportingTokenEditReceiveEnabled()}function A(e){return(e.kind===o("WAWebMsgType").MsgKind.CommentEncrypted||e.kind===o("WAWebMsgType").MsgKind.EventEditEncrypted)&&!o("WAWebMessagingGatingUtils").isDualEncryptedReportingTokenReceiveEnabled()}function F(e,t){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n;if(!o("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled())return{res:!0,reportingTokenContent:null,reportingTokenKey:null};var a=e.reportingTokenInfo;if(a==null||r("isEmptyObject")(a))return{res:!0,reportingTokenContent:null,reportingTokenKey:null};if(a.reportingTag==null)return{res:!0,reportingTokenContent:null,reportingTokenKey:null};var i=a.reportingToken,l=(n=a.version)!=null?n:h.DEFAULT,s={msg:e,reportingTokenVersion:l};if(i==null)return{res:!0,reportingTokenContent:null,reportingTokenKey:null};if(!o("WAWebMessagePluginGenerateReportingTokenContent").isMsgTypeReportingTokenCompatible(e.type,e.subtype))return{res:!0,reportingTokenContent:null,reportingTokenKey:null};if(w(e)||A(e))return{res:!0,reportingTokenContent:null,reportingTokenKey:null};var p;if(o("WAWebMsgGetters").getIsEdited(e)&&(p=yield V(e.protocolMessageKey)),p=p!=null?p:e.messageSecret,p==null)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["message secret cannot be null for validating reporting token info: ","-",""])),e.type,e.subtype).tags("messaging","wa-ice","report-token").sendLogs("report-token-null-message-secret",C),o("WAWebWamReportingTokenMismatchReporter").logReportingTokenValidationEvent(babelHelpers.extends({},s,{reason:o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON.MISSING_MESSAGE_SECRET})),{res:!1,reportingTokenContent:null,reportingTokenKey:null};var _=new(o("WAWebReportingTokenContent")).ReportingTokenContentCalculator(t,o("WAWebReportingTokenConfig").getReportingTokenConfig(l)).getReportingTokenContent();if(_.length===0)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["reporting token content cannot be empty for validating reporting token info. Message: ","-",""])),e.type,e.subtype).tags("messaging","wa-ice","report-token").sendLogs("report-token-empty-reporting-token-content",C),o("WAWebWamReportingTokenMismatchReporter").logReportingTokenValidationEvent(babelHelpers.extends({},s,{reason:l>o("WAWebMessagingGatingUtils").getSenderReportingTokenVersion()?o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON.UNSUPPORTED_VERSION:o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON.EMPTY_REPORTING_TOKEN_CONTENT})),{res:!1,reportingTokenContent:null,reportingTokenKey:null};var f=yield B({messageSecret:p,msg:e,receivedReportingToken:i,derivedReportingTokenContent:_});if(f.res===!0)return f;if(o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Franking tag doesn't match for message ",": ","-",". Received version: ",""])),e.id.toString(),e.type,e.subtype,l).tags("messaging","wa-ice","report-token").sendLogs("report-token-mismatch",C),l>o("WAWebMessagingGatingUtils").getSenderReportingTokenVersion()?o("WAWebWamReportingTokenMismatchReporter").logReportingTokenValidationEvent({msg:e,reason:o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON.UNSUPPORTED_VERSION,reportingTokenVersion:l}):o("WAWebWamReportingTokenMismatchReporter").logReportingTokenValidationEvent({msg:e,reason:o("WAWebWamEnumReportingTokenValidationFailureReason").REPORTING_TOKEN_VALIDATION_FAILURE_REASON.MISMATCH_REPORTING_TOKEN,reportingTokenVersion:l}),q(l)){var g=U(e);o("WAWebMessageInsertDebugPlaceholder").maybeInsertDebugPlaceholder({externalId:g.externalId,nackReason:o("WAWebCreateNackFromStanza").NackReason.ParsingError,msgInfo:g,offline:!1,additionalInfo:"reporting token validation failed for msg "+e.id.toString()})}return f}catch(e){return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["unexpected exception in validating reporting token info: ",""])),e).tags("messaging","wa-ice","report-token").sendLogs("report-token-unexpected-exception",y),{res:!1,reportingTokenContent:null,reportingTokenKey:null}}}),O.apply(this,arguments)}function B(e){return W.apply(this,arguments)}function W(){return W=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.derivedReportingTokenContent,n=e.messageSecret,r=e.msg,a=e.receivedReportingToken,i=S(r);if(i.length===0)return{res:!1,reportingTokenContent:null,reportingTokenKey:null};var l=null;for(var s of i){var u,c=s.receiverWid,d=s.senderWid;if(!(d==null||c==null)){var m=o("WAJids").extractFromJid(o("WAWebWidToJid").widToJidWithType(c)),_=o("WAWebWidToJid").widToUserJid(d),f=new Uint8Array(yield R({messageSecret:n,stanzaId:r.id.id,senderJid:_,remoteJid:m}));l=f;var g=new Uint8Array(yield o("WACryptoHmac").hmacSha256(f,t,p)),h=o("WACryptoUtils").uint8ArraysEqual(g,(u=a.subarray(0,32))!=null?u:new Uint8Array(0));if(h)return{res:!0,reportingTokenContent:t,reportingTokenKey:f}}}return{res:!1,reportingTokenContent:t,reportingTokenKey:l}}),W.apply(this,arguments)}function q(e){return e>o("WAWebMessagingGatingUtils").getSenderReportingTokenVersion()?!1:o("WAWebMessagingGatingUtils").isReportingTokenValidationFailureDebugPlaceholderEnabled()}function U(e){var t,n,a=e.id.id+"DEBUG",i=e.id.remote,l={author:(t=o("WAWebMsgGetters").getSender(e))!=null?t:e.from,chat:i,count:null,edit:-1,isHsm:!1,externalId:a,pushname:"Debug",ts:o("WATimeUtils").castToUnixTime(((n=e.t)!=null?n:0)+1)};return r("WAWebWid").isGroup(i)?babelHelpers.extends({},l,{type:o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.GROUP,isDirect:!1}):babelHelpers.extends({},l,{type:o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT})}function V(e){return H.apply(this,arguments)}function H(){return H=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e==null)return null;var t=yield o("WAWebSchemaMessage").getMessageTable().get(e.toString());if(t==null)return null;var n=o("WAWebDBMessageSerialization").messageFromDbRow(t);return n.messageSecret}),H.apply(this,arguments)}l.REPORTING_TOKEN_KEY_SIZE=_,l.REPORTING_TOKEN_STORAGE_SIZE=f,l.REPORTING_TOKEN_INVALID_STORAGE_SIZE=g,l.REPORTING_TOKEN_VERSION=h,l.genReportingTokenKeyFromMessageSecret=R,l.getRemoteJidOnReceiverSide=E,l.getMediaReportingTokenContent=I,l.genReportingToken=T,l.genReportingTokenBody=x,l.genClientReportingTokenMixinArgs=P,l.shouldSkipProcessingEditedMsg=w,l.shouldSkipProcessingDualEncryptedMsg=A,l.validateReportingTokenInfo=F,l.showDebugPlaceholderForReportingTokenMismatch=q}),98);
__d("WAWebSetPrivacyTokensJob",["$InternalEnum","WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebBackendErrors","WAWebCommsWapMd","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=new(r("WADeprecatedWapParser"))("setPrivacyTokensParser",function(e){var t={stanzaId:e.attrString("id")};return t}),s=n("$InternalEnum")({TrustedContact:"trusted_contact"});function u(e,t,n){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a,i=n.map(function(e){return o("WAWap").wap("token",{jid:o("WAWebCommsWapMd").USER_JID(t),t:o("WAWap").CUSTOM_STRING(String(r)),type:o("WAWap").CUSTOM_STRING(e)})}),l=yield o("WADeprecatedSendIq").deprecatedSendIq((a=o("WAWap")).wap("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:a.generateId()},a.wap("tokens",null,i)),e);if(!l.success)throw new(o("WAWebBackendErrors")).ServerStatusCodeError(l.errorCode,l.errorText)}),c.apply(this,arguments)}l.TokenType=s,l.issuePrivacyToken=u}),98);
__d("WAWebTrustedContactsUtils",["$InternalEnum","WABase64","WATimeUtils","WAWebABProps"],(function(t,n,r,o,a,i,l){var e=15552e3,s=n("$InternalEnum")({Sender:"sender",Receiver:"receiver"});function u(t){var n=t===s.Receiver?"tctoken_duration":"tctoken_duration_sender";return Math.min(o("WAWebABProps").getABPropConfigValue(n),e)}function c(e,t){return e<d(t)}function d(e){var t=e===s.Receiver?"tctoken_num_buckets":"tctoken_num_buckets_sender",n=o("WAWebABProps").getABPropConfigValue(t),r=u(e),a=Math.floor(o("WATimeUtils").unixTime()/r),i=a-(n-1);return o("WATimeUtils").castToUnixTime(i*r)}function m(e){if(e==null)return!0;var t=o("WAWebABProps").getABPropConfigValue("tctoken_duration_sender"),n=Math.floor(o("WATimeUtils").unixTime()/t),r=Math.floor(e/t);return n>r}function p(e){return o("WABase64").encodeB64(e)}l.TcTokenMode=s,l.getTcTokenDuration=u,l.isTokenExpired=c,l.tokenExpirationCutoff=d,l.shouldSendNewToken=m,l.encodeTcTokenForMex=p}),98);
__d("WAWebSendTcTokenWhenDeviceIdentityChange",["WALogger","WATimeUtils","WAWebABProps","WAWebApiChat","WAWebLid1X1MigrationGating","WAWebLidMigrationUtils","WAWebSetPrivacyTokensJob","WAWebTrustedContactsUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n;if(o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated()){var r=o("WAWebLidMigrationUtils").toUserLid(t);r!=null&&(n=(yield o("WAWebApiChat").getChatRecordByAccountLid(r))[0])}else n=yield o("WAWebApiChat").getChatRecord(t);if(n!=null){var a=n.tcTokenSenderTimestamp;if(a!=null&&!o("WAWebTrustedContactsUtils").isTokenExpired(a,o("WAWebTrustedContactsUtils").TcTokenMode.Sender))try{var i;if(o("WAWebABProps").getABPropConfigValue("lid_trusted_token_issue_to_lid")){var l;i=(l=o("WAWebLidMigrationUtils").toLid(t))!=null?l:t}else{var s;i=(s=o("WAWebLidMigrationUtils").toPn(t))!=null?s:t}yield o("WAWebSetPrivacyTokensJob").issuePrivacyToken(i,[o("WAWebSetPrivacyTokensJob").TokenType.TrustedContact],o("WATimeUtils").castToUnixTime(a))}catch(t){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendTcTokenWhenDeviceIdentityChange failed - ",""])),t).verbose().sendLogs("send-tc-token-device-identity-change-failed")}}}),u.apply(this,arguments)}l.sendTcTokenWhenDeviceIdentityChange=s}),98);
__d("WAWebSyncDeviceAdvDeviceListJob",["WAJobOrchestratorTypes","WAWebAdvSyncDeviceListApi","WAWebOrchestratorNonPersistedJob"],(function(t,n,r,o,a,i,l){function e(e,t,n){var r={wids:e,context:t,phash:n};return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("syncDeviceList",function(e){return o("WAWebAdvSyncDeviceListApi").syncDeviceList(e)}).waitUntilCompleted(r)}function s(){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("syncMyDeviceList",function(e){return o("WAWebAdvSyncDeviceListApi").syncMyDeviceList()},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted()}l.syncDeviceListJob=e,l.syncMyDeviceListJob=s}),98);
__d("WAWebBackendJobs.flow",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg",Msmsg:"msmsg"}),l=n("$InternalEnum")({Image:"image",Video:"video",Ptv:"ptv",Audio:"audio",Ptt:"ptt",Location:"location",VCard:"vcard",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"livelocation",ProfilePic:"profile_pic",Sticker:"sticker",StickerPack:"sticker_pack",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product",NativeFlowResponse:"native_flow_response",GroupHistory:"group_history"}),s=n("$InternalEnum")({Hide:"hide",Show:"show"});i.CiphertextType=e,i.EncMediaType=l,i.DecryptFailType=s}),66);
__d("WAWebGetPlatformFromStanzaId",[],(function(t,n,r,o,a,i){var e=new Map([["3E","web"],["AC","android"],["A5","android_smb"],["A3","wearos"],["A4","ar_devices"],["A6","wearm"],["A8","smart_glasses"],["1A","iphone_intent_extensions"],["2A","iphone_smb"],["3A","iphone"],["4A","iphone_share_extension"],["5A","iphone_xctest"],["6A","iphone_unknown_extension"],["1B","macos_native_intent_extensions"],["2B","macos_native_smb"],["3B","macos_native"],["4B","macos_native_share_extension"],["5B","macos_native_xctest"],["6B","macos_unknown_extension"],["1C","ipad_intent_extensions"],["2C","ipad_smb"],["3C","ipad"],["4C","ipad_share_extension"],["5C","ipad_xctest"],["6C","ipad_unknown_extension"],["3F","windows"]]);function l(t){var n,r=t.slice(0,2);return(n=e.get(r))!=null?n:"unknown"}i.getPlatformFromStanzaId=l}),66);
__d("WAWebSignalCommonErrors",["WACustomError"],(function(t,n,r,o,a,i,l){var e=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="SignalDecryptionError",n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError),s=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="SignalMessageCounterError",n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError);l.SignalDecryptionError=e,l.SignalMessageCounterError=s}),98);
__d("WAWebVerifyProtobufMsgObjectKeys",["$InternalEnum","WALogger","WAWebCurrentUser","WAWebHandleMsgError","WAWebMsgType","WAWebProtobufsE2E.pb","err"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum")({Buttons:1,Template:2,SenderKeyDistribution:3,UnknownMessageKey:4});function u(e,t){var n,r;return e==="$$unknownFieldCount"?t[e]===0?null:o("WAWebMsgType").MSG_TYPE.UNKNOWN:e==="messageContextInfo"?null:e==="contactMessage"?o("WAWebMsgType").MSG_TYPE.VCARD:e==="contactsArrayMessage"?o("WAWebMsgType").MSG_TYPE.MULTI_VCARD:e==="conversation"||e==="extendedTextMessage"?o("WAWebMsgType").MSG_TYPE.CHAT:e==="imageMessage"?o("WAWebMsgType").MSG_TYPE.IMAGE:e==="locationMessage"||e==="liveLocationMessage"?o("WAWebMsgType").MSG_TYPE.LOCATION:e==="documentMessage"?o("WAWebMsgType").MSG_TYPE.DOCUMENT:e==="audioMessage"?o("WAWebMsgType").MSG_TYPE.AUDIO:e==="videoMessage"?o("WAWebMsgType").MSG_TYPE.VIDEO:e==="protocolMessage"||e==="highlyStructuredMessage"?o("WAWebMsgType").MSG_TYPE.PROTOCOL:e==="statusNotificationMessage"?o("WAWebMsgType").MSG_TYPE.STATUS_NOTIFICATION:e==="sendPaymentMessage"||e==="requestPaymentMessage"||e==="paymentInviteMessage"?o("WAWebMsgType").MSG_TYPE.PAYMENT:e==="declinePaymentRequestMessage"||e==="cancelPaymentRequestMessage"?o("WAWebMsgType").MSG_TYPE.UNKNOWN:e==="stickerMessage"?o("WAWebMsgType").MSG_TYPE.STICKER:e==="groupInviteMessage"?o("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE:e==="templateButtonReplyMessage"?o("WAWebMsgType").MSG_TYPE.TEMPLATE_BUTTON_REPLY:e==="productMessage"?o("WAWebMsgType").MSG_TYPE.PRODUCT:e==="listMessage"?o("WAWebMsgType").MSG_TYPE.LIST:e==="orderMessage"?o("WAWebMsgType").MSG_TYPE.ORDER:e==="listResponseMessage"?o("WAWebMsgType").MSG_TYPE.LIST_RESPONSE:e==="buttonsResponseMessage"?o("WAWebMsgType").MSG_TYPE.BUTTONS_RESPONSE:e==="interactiveMessage"?o("WAWebMsgType").MSG_TYPE.INTERACTIVE:e==="interactiveResponseMessage"?o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE:e==="reactionMessage"?o("WAWebMsgType").MSG_TYPE.REACTION:e==="encReactionMessage"?o("WAWebMsgType").MSG_TYPE.REACTION_ENC:e==="encCommentMessage"?o("WAWebMsgType").MSG_TYPE.COMMENT:e==="pinInChatMessage"?o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE:e==="pollCreationMessage"||e==="pollCreationMessageV2"||e==="pollCreationMessageV3"||e==="pollCreationMessageV5"?o("WAWebMsgType").MSG_TYPE.POLL_CREATION:e==="pollUpdateMessage"?o("WAWebMsgType").MSG_TYPE.POLL_UPDATE:e==="keepInChatMessage"?o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT:e==="requestPhoneNumberMessage"?o("WAWebMsgType").MSG_TYPE.REQUEST_PHONE_NUMBER:e==="ptvMessage"?o("WAWebMsgType").MSG_TYPE.PTV:e==="callLogMesssage"?o("WAWebMsgType").MSG_TYPE.CALL_LOG:e==="buttonsMessage"?s.Buttons:e==="templateMessage"?s.Template:e==="senderKeyDistributionMessage"||e==="fastRatchetKeySenderKeyDistributionMessage"?s.SenderKeyDistribution:e==="newsletterAdminInviteMessage"?o("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE:e==="newsletterFollowerInviteMessageV2"?o("WAWebMsgType").MSG_TYPE.NEWSLETTER_FOLLOWER_INVITE:e==="eventMessage"?o("WAWebMsgType").MSG_TYPE.EVENT_CREATION:e==="encEventResponseMessage"?o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE:e==="secretEncryptedMessage"&&((n=t[e])==null?void 0:n.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT?o("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED:e==="secretEncryptedMessage"&&((r=t[e])==null?void 0:r.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.MESSAGE_EDIT?o("WAWebMsgType").MSG_TYPE.MESSAGE_EDIT_ENCRYPTED:e==="albumMessage"?o("WAWebMsgType").MSG_TYPE.ALBUM:e==="stickerPackMessage"?o("WAWebMsgType").MSG_TYPE.STICKER_PACK:e==="pollResultSnapshotMessage"||e==="pollResultSnapshotMessageV3"?o("WAWebMsgType").MSG_TYPE.POLL_RESULT_SNAPSHOT:e==="richResponseMessage"?o("WAWebMsgType").MSG_TYPE.RICH_RESPONSE:e==="messageHistoryBundle"?o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_BUNDLE:e==="messageHistoryNotice"?o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_NOTICE:e==="associatedChildMessage"||e==="bcallMessage"||e==="botForwardedMessage"||e==="botInvokeMessage"||e==="botTaskMessage"||e==="call"||e==="chat"||e==="commentMessage"||e==="deviceSentMessage"||e==="documentWithCaptionMessage"||e==="editedMessage"||e==="ephemeralMessage"||e==="eventCoverImage"||e==="groupMentionedMessage"||e==="groupStatusMentionMessage"||e==="groupStatusMessage"||e==="groupStatusMessageV2"||e==="invoiceMessage"||e==="lottieStickerMessage"||e==="newsletterAdminProfileMessage"||e==="newsletterAdminProfileMessageV2"||e==="placeholderMessage"||e==="pollCreationMessageV4"||e==="pollCreationOptionImageMessage"||e==="scheduledCallCreationMessage"||e==="scheduledCallEditMessage"||e==="secretEncryptedMessage"||e==="statusAddYours"||e==="statusMentionMessage"||e==="statusQuotedMessage"||e==="statusStickerInteractionMessage"||e==="stickerSyncRmrMessage"||e==="viewOnceMessage"||e==="viewOnceMessageV2"||e==="viewOnceMessageV2Extension"||e==="limitSharingMessage"||e==="questionMessage"||e==="statusQuestionAnswerMessage"||e==="questionResponseMessage"||e==="questionReplyMessage"?s.UnknownMessageKey:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function c(e){if(e!=null&&typeof e=="object"&&"message"in e){var t=e.message;if(t!=null&&typeof t=="object")return t}return null}function d(e){_(e);var t;for(var n of Object.keys(e)){var r=c(e[n]);if(r!=null){var o=m(r);for(var a of o){var i=a[0],l=a[1];typeof i!="number"&&(t=r)}}else{var s=u(n,e);s!=null&&(t=e)}if(t!=null)break}return t}function m(e){var t=[];for(var n of Object.keys(e)){var r=c(e[n]);if(r!=null){var a=m(r);a.length===0?t.push([o("WAWebMsgType").MSG_TYPE.UNKNOWN,n]):t.push.apply(t,m(r))}else{var i=u(n,e);i!=null&&t.push([i,n])}}return t}function p(e){return!!e.find(function(e){var t=e[0];return typeof t=="number"&&t===s.SenderKeyDistribution})}function _(t){var n=m(t),r=n.length===1||n.length===2&&p(n);if(!r)throw o("WAWebCurrentUser").isEmployee()&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Protobuf message keys validation failed: ",""])),n.join()).sendLogs("protobuf-msg-keys-validation-failed-intern"),new(o("WAWebHandleMsgError")).MessageProtobufInvalidMessageTypes(n.map(function(e){var t=e[0],n=e[1];return n}))}function f(e){var t=new Set;for(var n of m(e)){var o=n[0],a=n[1];if(typeof o!="number")t.add(o);else if(s.cast(o)!=null&&(o===s.Buttons||o===s.Template))throw r("err")("Undeclared message types")}return t}function g(e,t){return f(e).has(t)}l.UndeclaredMessageType=s,l.getWrappedMessage=c,l.getUnwrappedProtobufMessage=d,l.getProtobufMessageTypesToKeys=m,l.verifyProtobufMessageObjectKeys=_,l.getProtobufMessageTypesSet=f,l.isProtobufHasMessageType=g}),98);
__d("WAWebWamEnumE2eCiphertextType",[],(function(t,n,r,o,a,i){var e=Object.freeze({MESSAGE:0,PREKEY_MESSAGE:1,SENDER_KEY_MESSAGE:2,MESSAGE_SECRET_MESSAGE:3});i.E2E_CIPHERTEXT_TYPE=e}),66);
__d("WAWebWamEnumE2eDestination",[],(function(t,n,r,o,a,i){var e=Object.freeze({INDIVIDUAL:0,GROUP:1,LIST:2,STATUS:3,CHANNEL:4,INTEROP:5});i.E2E_DESTINATION=e}),66);
__d("WAWebBackendJobsCommon",["WAJobOrchestratorTypes","WALogger","WAStanzaUtils","WAWap","WAWebAck","WAWebBackendJobs.flow","WAWebGetPlatformFromStanzaId","WAWebHandleMsgCommon","WAWebHandleMsgError","WAWebLidStatusMigrationGating","WAWebSendMsgCommonApi","WAWebSignalCommonErrors","WAWebUserPrefsMeUser","WAWebVerifyProtobufMsgObjectKeys","WAWebWamEnumE2eCiphertextType","WAWebWamEnumE2eDestination","WAWebWamEnumEditType","WAWebWamEnumMediaType","WAWebWamEnumPlaceholderReasonType","err","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m=2;function p(e){return e===o("WAWebBackendJobs.flow").CiphertextType.Skmsg?o("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE:e===o("WAWebBackendJobs.flow").CiphertextType.Pkmsg?o("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE:e===o("WAWebBackendJobs.flow").CiphertextType.Msg?o("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.MESSAGE:e===o("WAWebBackendJobs.flow").CiphertextType.Msmsg?o("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.MESSAGE_SECRET_MESSAGE:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function _(e){var t=e.encMediaType,n=e.msgPollType,r=e.msgType;if(r===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction)return o("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;if(r===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.medianotify)return o("WAWebWamEnumMediaType").MEDIA_TYPE.MEDIA_EXPRESS_NOTIFY;if(n===o("WAWebHandleMsgCommon").POLL_TYPES.creation)return o("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_CREATE;if(n===o("WAWebHandleMsgCommon").POLL_TYPES.vote)return o("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE;if(t)switch(t){case o("WAWebBackendJobs.flow").EncMediaType.Image:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PHOTO;case o("WAWebBackendJobs.flow").EncMediaType.Video:return o("WAWebWamEnumMediaType").MEDIA_TYPE.VIDEO;case o("WAWebBackendJobs.flow").EncMediaType.Ptv:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PUSH_TO_VIDEO;case o("WAWebBackendJobs.flow").EncMediaType.Audio:return o("WAWebWamEnumMediaType").MEDIA_TYPE.AUDIO;case o("WAWebBackendJobs.flow").EncMediaType.Ptt:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PTT;case o("WAWebBackendJobs.flow").EncMediaType.Location:return o("WAWebWamEnumMediaType").MEDIA_TYPE.LOCATION;case o("WAWebBackendJobs.flow").EncMediaType.VCard:return o("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT;case o("WAWebBackendJobs.flow").EncMediaType.Document:return o("WAWebWamEnumMediaType").MEDIA_TYPE.DOCUMENT;case o("WAWebBackendJobs.flow").EncMediaType.Url:return o("WAWebWamEnumMediaType").MEDIA_TYPE.URL;case o("WAWebBackendJobs.flow").EncMediaType.Call:return o("WAWebWamEnumMediaType").MEDIA_TYPE.CALL;case o("WAWebBackendJobs.flow").EncMediaType.Gif:return o("WAWebWamEnumMediaType").MEDIA_TYPE.GIF;case o("WAWebBackendJobs.flow").EncMediaType.Future:return o("WAWebWamEnumMediaType").MEDIA_TYPE.FUTURE;case o("WAWebBackendJobs.flow").EncMediaType.ContactArray:return o("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT_ARRAY;case o("WAWebBackendJobs.flow").EncMediaType.LiveLocation:return o("WAWebWamEnumMediaType").MEDIA_TYPE.LIVE_LOCATION;case o("WAWebBackendJobs.flow").EncMediaType.ProfilePic:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PROFILE_PIC;case o("WAWebBackendJobs.flow").EncMediaType.Sticker:return o("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER;case o("WAWebBackendJobs.flow").EncMediaType.StickerPack:return o("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER_PACK;case o("WAWebBackendJobs.flow").EncMediaType.Hsm:return o("WAWebWamEnumMediaType").MEDIA_TYPE.HSM;case o("WAWebBackendJobs.flow").EncMediaType.ProductImage:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_IMAGE;case o("WAWebBackendJobs.flow").EncMediaType.Template:return o("WAWebWamEnumMediaType").MEDIA_TYPE.TEMPLATE;case o("WAWebBackendJobs.flow").EncMediaType.MdAppState:return o("WAWebWamEnumMediaType").MEDIA_TYPE.MD_APP_STATE;case o("WAWebBackendJobs.flow").EncMediaType.MdHistorySync:return o("WAWebWamEnumMediaType").MEDIA_TYPE.MD_HISTORY_SYNC;case o("WAWebBackendJobs.flow").EncMediaType.List:return o("WAWebWamEnumMediaType").MEDIA_TYPE.LIST;case o("WAWebBackendJobs.flow").EncMediaType.ListResponse:return o("WAWebWamEnumMediaType").MEDIA_TYPE.LIST_REPLY;case o("WAWebBackendJobs.flow").EncMediaType.Button:return o("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_MESSAGE;case o("WAWebBackendJobs.flow").EncMediaType.ButtonResponse:return o("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case o("WAWebBackendJobs.flow").EncMediaType.Order:return o("WAWebWamEnumMediaType").MEDIA_TYPE.ORDER;case o("WAWebBackendJobs.flow").EncMediaType.Product:return o("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_IMAGE;case o("WAWebBackendJobs.flow").EncMediaType.NativeFlowResponse:return o("WAWebWamEnumMediaType").MEDIA_TYPE.INTERACTIVE_RESPONSE_NFM;case o("WAWebBackendJobs.flow").EncMediaType.GroupHistory:return o("WAWebWamEnumMediaType").MEDIA_TYPE.GROUP_HISTORY}return o("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}function f(e){var t;if(e.deviceSentMessage){var n=e.deviceSentMessage.message;return n?f(n):null}else if(e.ephemeralMessage){var r=e.ephemeralMessage.message;return r?f(r):null}else if(e.groupMentionedMessage){var a=e.groupMentionedMessage.message;return a?f(a):null}else if(e.viewOnceMessageV2Extension){var i=e.viewOnceMessageV2Extension.message;return i?f(i):null}else if(e.viewOnceMessage){var l=e.viewOnceMessage.message;return l?f(l):null}else if(e.documentWithCaptionMessage){var s=e.documentWithCaptionMessage.message;return s?f(s):null}else if(e.botInvokeMessage){var u=e.botInvokeMessage.message;return u?f(u):null}else if(e.associatedChildMessage){var c=e.associatedChildMessage.message;return c?f(c):null}else if(e.pollCreationOptionImageMessage){var d=e.pollCreationOptionImageMessage.message;return d?f(d):null}else{if(e.imageMessage)return o("WAWebBackendJobs.flow").EncMediaType.Image;if(e.stickerMessage)return o("WAWebBackendJobs.flow").EncMediaType.Sticker;if(e.stickerPackMessage)return o("WAWebBackendJobs.flow").EncMediaType.StickerPack;if(e.lottieStickerMessage)return o("WAWebBackendJobs.flow").EncMediaType.Sticker;if(e.locationMessage)return e.locationMessage.isLive===!0?o("WAWebBackendJobs.flow").EncMediaType.LiveLocation:o("WAWebBackendJobs.flow").EncMediaType.Location;if(e.contactMessage)return o("WAWebBackendJobs.flow").EncMediaType.VCard;if(e.contactsArrayMessage)return o("WAWebBackendJobs.flow").EncMediaType.ContactArray;if(e.documentMessage)return o("WAWebBackendJobs.flow").EncMediaType.Document;if(e.audioMessage)return e.audioMessage.ptt===!0?o("WAWebBackendJobs.flow").EncMediaType.Ptt:o("WAWebBackendJobs.flow").EncMediaType.Audio;if(e.videoMessage)return e.videoMessage.gifPlayback===!0?o("WAWebBackendJobs.flow").EncMediaType.Gif:o("WAWebBackendJobs.flow").EncMediaType.Video;if(e.ptvMessage)return o("WAWebBackendJobs.flow").EncMediaType.Ptv;if(e.buttonsMessage)return o("WAWebBackendJobs.flow").EncMediaType.Button;if(e.buttonsResponseMessage)return o("WAWebBackendJobs.flow").EncMediaType.ButtonResponse;if(e.listMessage)return o("WAWebBackendJobs.flow").EncMediaType.List;if(e.listResponseMessage)return o("WAWebBackendJobs.flow").EncMediaType.ListResponse;if(e.orderMessage)return o("WAWebBackendJobs.flow").EncMediaType.Order;if(e.productMessage)return o("WAWebBackendJobs.flow").EncMediaType.Product;if(e.groupInviteMessage)return o("WAWebBackendJobs.flow").EncMediaType.Url;if(e.interactiveResponseMessage)return o("WAWebBackendJobs.flow").EncMediaType.NativeFlowResponse;if(e.messageHistoryBundle)return o("WAWebBackendJobs.flow").EncMediaType.GroupHistory;if(((t=e.extendedTextMessage)==null?void 0:t.matchedText)!=null&&e.extendedTextMessage.matchedText.trim()!=="")return o("WAWebBackendJobs.flow").EncMediaType.Url;if(e.questionMessage){var m=e.questionMessage.message;return m?f(m):null}else if(e.questionReplyMessage){var p=e.questionReplyMessage.message;return p?f(p):null}}return null}function g(e){var t=function(){switch(e){case o("WAWebBackendJobs.flow").EncMediaType.Image:return"image";case o("WAWebBackendJobs.flow").EncMediaType.Video:return"video";case o("WAWebBackendJobs.flow").EncMediaType.Ptv:return"ptv";case o("WAWebBackendJobs.flow").EncMediaType.Audio:return"audio";case o("WAWebBackendJobs.flow").EncMediaType.Ptt:return"ptt";case o("WAWebBackendJobs.flow").EncMediaType.VCard:return"vcard";case o("WAWebBackendJobs.flow").EncMediaType.Document:return"document";case o("WAWebBackendJobs.flow").EncMediaType.Gif:return"gif";case o("WAWebBackendJobs.flow").EncMediaType.ContactArray:return"contact_array";case o("WAWebBackendJobs.flow").EncMediaType.Location:return"location";case o("WAWebBackendJobs.flow").EncMediaType.LiveLocation:return"livelocation";case o("WAWebBackendJobs.flow").EncMediaType.Sticker:return"sticker";case o("WAWebBackendJobs.flow").EncMediaType.List:return"list";case o("WAWebBackendJobs.flow").EncMediaType.ListResponse:return"list_response";case o("WAWebBackendJobs.flow").EncMediaType.ButtonResponse:return"buttons_response";case o("WAWebBackendJobs.flow").EncMediaType.Order:return"order";case o("WAWebBackendJobs.flow").EncMediaType.Product:return"product";case o("WAWebBackendJobs.flow").EncMediaType.Url:return"url";case o("WAWebBackendJobs.flow").EncMediaType.NativeFlowResponse:return"native_flow_response";case o("WAWebBackendJobs.flow").EncMediaType.StickerPack:return"sticker_pack";case o("WAWebBackendJobs.flow").EncMediaType.GroupHistory:return"group_history";default:return null}},n=t();if(n)return o("WAWap").CUSTOM_STRING(n);throw r("err")("Unsupported type")}function h(e){return function(t){return t==null?o("WAWap").DROP_ATTR:e(t)}}var y=h(g);function C(e){switch(e){case o("WAWebBackendJobs.flow").DecryptFailType.Show:return o("WAWap").DROP_ATTR;case o("WAWebBackendJobs.flow").DecryptFailType.Hide:return"hide"}}function b(e){if(e.isUser())return o("WAWebWamEnumE2eDestination").E2E_DESTINATION.INDIVIDUAL;if(e.isGroup())return o("WAWebWamEnumE2eDestination").E2E_DESTINATION.GROUP;if(e.isStatus())return o("WAWebWamEnumE2eDestination").E2E_DESTINATION.STATUS;if(e.isBroadcast())return o("WAWebWamEnumE2eDestination").E2E_DESTINATION.LIST;if(e.isNewsletter())return o("WAWebWamEnumE2eDestination").E2E_DESTINATION.CHANNEL}function v(t,n){if(t instanceof o("WAWebHandleMsgError").UnknownDeviceMessageError)return o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.UNKNOWN_COMPANION_NO_PREKEY;if(t instanceof o("WAWebSignalCommonErrors").SignalDecryptionError){var a=r("gkx")("26258")?.001:.01;switch(t.message){case"errSignalNoSession":case"errLoadSenderKeySession":return o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_NO_SESSION;case"errSignalInvalidMsg":return o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_INVALID_MESSAGE;case"errSignalInvalidKey":case"errSignalInvalidOneTimeKey":case"errSignalInvalidSignedPreKey":try{if(n.msgInfo.chat.isStatus()){var i=o("WAWebUserPrefsMeUser").isMeAccount(n.msgInfo.author),l=o("WAWebGetPlatformFromStanzaId").getPlatformFromStanzaId(o("WAStanzaUtils").toStanzaId(n.msgInfo.externalId)),m=n.msgInfo.participantLid==null,p=o("WAWebLidStatusMigrationGating").getLidStatusSendEnabled();o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getPlaceholderAddReason errSignalInvalidKey details: is status lid migrated: ",",\n            isFromPeer: ",", sender platform: ",", isLidMessage: ",""])),p,i,l,m)}}catch(e){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["error printing extra details for placeholder: ",""])),e)}return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["getPlaceholderAddReason errSignalInvalidKey reason: ",""])),t.message).sendLogs("placeholder-add-reason-errSignalInvalidKey",{sampling:a}),o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_INVALID_KEY;case"errSignalTooManyMessagesInFuture":case"errSignalGrpTooManyMessagesInFuture":return o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_FUTURE_MESSAGE;case"errInvalidMacWithDecryptedPlaintext":case"errInvalidMacInvalidCipherKey":case"errInvalidMacInvalidCipherKeyNewChain":{var _="MsgPlaceholderBadMac-"+t.message;return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["getPlaceholderAddReason SignalBadMac reason"]))).sendLogs(_,{sampling:a}),o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_BAD_MAC}}var f="MsgPlaceholderOther-"+t.message;return o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["getPlaceholderAddReason Other reason"]))).sendLogs(f,{sampling:a}),o("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.OTHER}}function S(e){if(e.interactiveResponseMessage){var t;return(t=e.interactiveResponseMessage.nativeFlowResponseMessage)==null?void 0:t.name}return null}var R=h(function(e){return o("WAWap").CUSTOM_STRING(e)});function L(e){switch(e){case o("WAWebAck").EDIT_ATTR.SENDER_REVOKE:return o("WAWebWamEnumEditType").EDIT_TYPE.SENDER_REVOKE;case o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE:return o("WAWebWamEnumEditType").EDIT_TYPE.ADMIN_REVOKE;case o("WAWebAck").EDIT_ATTR.MESSAGE_EDIT:return o("WAWebWamEnumEditType").EDIT_TYPE.EDITED;default:return o("WAWebWamEnumEditType").EDIT_TYPE.NOT_EDITED}}function E(e,t){var n,r=(n=o("WAWebVerifyProtobufMsgObjectKeys").getUnwrappedProtobufMessage(e))!=null?n:e;return o("WAWebSendMsgCommonApi").isRevokeMsg(r)?t.subtype==="admin_revoke"?o("WAWebWamEnumEditType").EDIT_TYPE.ADMIN_REVOKE:o("WAWebWamEnumEditType").EDIT_TYPE.SENDER_REVOKE:o("WAWebSendMsgCommonApi").isEditMsg(r)?o("WAWebWamEnumEditType").EDIT_TYPE.EDITED:o("WAWebWamEnumEditType").EDIT_TYPE.NOT_EDITED}function k(e){return e?o("WAJobOrchestratorTypes").JOB_PRIORITY.OFFLINE:o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}l.CIPHERTEXT_VERSION=m,l.getMetricE2eCiphertextType=p,l.getMetricMediaType=_,l.mediaTypeFromProtobuf=f,l.encodeMaybeMediaType=y,l.encodeMaybeDecryptFail=C,l.getMetricE2eDestination=b,l.getPlaceholderAddReason=v,l.nativeFlowNameTypeFromProtobuf=S,l.encodeMaybeNativeFlowName=R,l.getMetricEditType=L,l.getMetricEditTypeFromMsg=E,l.getNonCriticalNotificationPriority=k}),98);
__d("WAWebAddOnsMarkAddOnsAsReadDb",["Promise","WANullthrows","WAWebDBAddOnProviders","WAWebDBMarkAsReadForTable","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield(e||(e=n("Promise"))).allSettled(Array.from(t.entries(),function(e){var t=e[0],n=e[1],a=r("WANullthrows")(o("WAWebDBAddOnProviders").getProviderForAddOnType(t));return a.markAsRead==null?void 0:a.markAsRead(n)}));for(var i of a)if(i.status==="rejected")throw i.reason}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=new Map,a=o("WAWebDBAddOnProviders").addOnProviders.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.markAsRead==null?void 0:e.markAsRead(t);r.set(e.type,n!=null?n:[])});return function(t){return e.apply(this,arguments)}})()),i=[],l=o("WAWebDBMarkAsReadForTable").markAsReadForTable("message-orphans",t.map(String)).then(function(e){i.push.apply(i,e)}),s=yield(e||(e=n("Promise"))).allSettled([].concat(a,[l]));for(var u of s)if(u.status==="rejected")throw u.reason;return{updatedAddOns:r,updatedOrphans:i}}),d.apply(this,arguments)}l.markAddOnsAsReadDb=s,l.markUnclassifiedAddOnsAsReadDb=c}),98);
__d("WAWebApiTasksScheduledTime",["WAWebModelStorageUtils","WAWebSchemaTasksScheduledTime"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebSchemaTasksScheduledTime").getTasksScheduledTimeTable().get(e).then(function(e){return e==null?void 0:e.time})}function s(e,t){return o("WAWebModelStorageUtils").getStorage().lock(["tasks-scheduled-time"],function(n){var r=n[0],o={taskName:e,time:t};return r.createOrReplace(o)})}l.getTaskScheduledTime=e,l.updateTaskScheduledTime=s}),98);
__d("WAWebLastADVCheckTimeApi",["Promise","WAWebApiTasksScheduledTime"],(function(t,n,r,o,a,i,l){var e,s;function u(){return s==null&&(s=o("WAWebApiTasksScheduledTime").getTaskScheduledTime("advDeviceInfoCheck")),s}function c(t){s=(e||(e=n("Promise"))).resolve(t)}l.getLastADVDeviceInfoCheckTime=u,l.setLastADVDeviceInfoCheckTime=c}),98);
__d("WAWebAdvHandlerApi",["Promise","WALogger","WAPromiseDelays","WAWebApiDeviceList","WAWebAppTracker","WAWebBizCoexGatingUtils","WAWebBizCoexUtils","WAWebCryptoCurve25519","WAWebDeviceListPk","WAWebHandleAdvForMessageApi","WAWebHandleAdvForUsyncApi","WAWebIdentityUpdateDeviceTableApi","WAWebLastADVCheckTimeApi","WAWebProtobufsAdv.pb","WAWebSignalCommonUtils","WAWebSignalProtocolStore","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s;function u(e,t,n,r,o,a,i){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a,i,l){i===void 0&&(i=!1);var s=yield o("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime();return o("WAWebHandleAdvForMessageApi").handleADVDeviceUpdateForMessage(e,t,n,r,a,i,s,l)}),c.apply(this,arguments)}function d(e){var t=e.devices,o=e.type,a=e.wid;return o==null?(s||(s=n("Promise"))).reject(r("err")("handleADVDeviceNotification: notification without type")):p(a,t,o)}function m(e){return o("WAWebAppTracker").AppTracker.start(o("WAWebAppTracker").AppTrackerType.ADVProcessing),f(e).finally(function(){o("WAWebAppTracker").AppTracker.stop(o("WAWebAppTracker").AppTrackerType.ADVProcessing)})}function p(e,t,n){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=null;if(n==="add"){var a=yield o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().loadIdentityKey(o("WAWebSignalCommonUtils").createSignalAddress(e).toString());if(r=a!=null?o("WAWebCryptoCurve25519").toCurveKeyPubKey(o("WAWebSignalCommonUtils").strToBuffer(a)):null,!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&t.deviceList!=null){var i;t.deviceList=(i=t.deviceList)==null?void 0:i.filter(function(e){return e.id!==o("WAWebBizCoexUtils").HOSTED_DEVICE_ID})}}var l=yield o("WAWebApiDeviceList").getDeviceRecord(e),s=yield o("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime(),u=o("WAWebHandleAdvForUsyncApi").handleDeviceNotification(e,n,t,r,l,s);if(u){if(u.clearRecord){var c;yield o("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(e,(l==null?void 0:l.devices)||[],!1,l==null?void 0:l.advAccountType,u==null||(c=u.update)==null?void 0:c.advAccountType)}return o("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate([{wid:e,update:u.update,currentRecord:l}])}}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()||t.forEach(function(e){var t,n;(e==null||(t=e.devices)==null?void 0:t.deviceList)!=null&&(e.devices.deviceList=(n=e.devices.deviceList)==null?void 0:n.filter(function(e){return e.id!==o("WAWebBizCoexUtils").HOSTED_DEVICE_ID}))}),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleADVDeviceSyncResultImpl: start to handling "," updates"])),t.length);var r=t.map(function(e){return e.wid}),a=t.filter(function(e){var t;return(t=e.devices.keyIndex)==null?void 0:t.signedKeyIndexBytes}),i=yield o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkLoadIdentityKey(a.map(function(e){return o("WAWebSignalCommonUtils").createSignalAddress(e.wid).toString()})),l=new Map;a.forEach(function(e,t){var n=i[t];n!=null&&l.set(o("WAWebDeviceListPk").createDeviceListPK(e.wid),n)});var u=yield o("WAWebApiDeviceList").bulkGetDeviceRecord(r),c=[],d=[],m=!1,p=[],_=self.performance.now();for(var f of t.entries()){var g=f[0],y=f[1],C=l.get(o("WAWebDeviceListPk").createDeviceListPK(y.wid)),b=C!=null?o("WAWebCryptoCurve25519").toCurveKeyPubKey(o("WAWebSignalCommonUtils").strToBuffer(C)):null,v=u[g],S=o("WAWebHandleAdvForUsyncApi").handleADVSyncResult(y.wid,y.devices,b,v);if(self.performance.now()-_>h&&(yield o("WAPromiseDelays").releaseToMainThread(),_=self.performance.now()),S!=null)if(S.identityUpdatePromise&&p.push(S.identityUpdatePromise),S.clearRecord){var R;c.push({wid:y.wid,currentList:(v==null?void 0:v.devices)||[],currentAdvAccountType:v==null?void 0:v.advAccountType,incomingAdvAccountType:(R=S.update)==null?void 0:R.advAccountType}),d.push({wid:y.wid,currentRecord:{id:o("WAWebDeviceListPk").createDeviceListPK(y.wid),deleted:!0},update:S.update})}else{if((S==null?void 0:S.fromHandleOmittedResult)===!0){var L;(v==null?void 0:v.advAccountType)===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(S==null||(L=S.update)==null?void 0:L.advAccountType)===o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE&&(m=!0)}d.push({wid:y.wid,currentRecord:v,update:S.update})}}p.length>0&&(yield(s||(s=n("Promise"))).all(p)),yield(s||(s=n("Promise"))).all(c.map(function(e){var t=e.currentAdvAccountType,n=e.currentList,r=e.incomingAdvAccountType,a=e.wid;return o("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(a,n,!1,t,r)})),yield o("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate(d,!1,m)}),g.apply(this,arguments)}var h=100;l.handleADVDeviceUpdateForMessage=u,l.handleADVDeviceNotification=d,l.handleADVDeviceSyncResult=m}),98);
__d("WAWebSignalConst",[],(function(t,n,r,o,a,i){var e={REG_ID:"signal_reg_id",STATIC_PUBKEY:"signal_static_pubkey",STATIC_PRIVKEY:"signal_static_privkey",NEXT_PK_ID:"signal_next_pk_id",LAST_SPK_ID:"signal_last_spk_id",FIRST_UNUPLOAD_PK_ID:"signal_first_unupload_pk_id",SERVER_HAS_KEY:"signal_sever_has_pre_keys",ADV_SIGNED_IDENTITY:"adv_signed_identity"};i.META_KEYS=e}),66);
__d("WAWebSignalStorageUtils",["invariant","Promise","WAWebIdb","WAWebStorage","err"],(function(t,n,r,o,a,i,l,s){var e,u="signal-storage",c=null;function d(){var e=new(r("WAWebIdb"))(u);c=new(o("WAWebStorage")).Storage(e)}function m(){return c!=null||s(0,56356),c}function p(){return c==null?(e||(e=n("Promise"))).reject(r("err")("[signal-storage] Storage should be created first before being destroyed")):c.purge().then(function(){c=null}).catch(function(e){throw c=null,e})}l.DATABASE_NAME=u,l.createStorage=d,l.getStorage=m,l.destroyStorage=p}),98);
__d("WAWebSignalStorageVersions",["WAWebSignalStorageUtils"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebSignalStorageUtils").getStorage().versions.version(0)}function s(){return o("WAWebSignalStorageUtils").getStorage().versions.version(1)}function u(){return o("WAWebSignalStorageUtils").getStorage().versions.version(2)}function c(){return o("WAWebSignalStorageUtils").getStorage().versions.version(3)}function d(){return o("WAWebSignalStorageUtils").getStorage().versions.version(4)}function m(){return o("WAWebSignalStorageUtils").getStorage().versions.version(5)}function p(){return o("WAWebSignalStorageUtils").getStorage().versions.version(6)}l.identityCreateTable=e,l.metaCreateTable=s,l.preKeyCreateTable=u,l.sessionCreateTable=c,l.signedPreKeyCreateTable=d,l.baseKeyCreateTable=m,l.senderKeyCreateTable=p}),98);
__d("WAWebSchemaBasekey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addAutoIncrementingPrimaryKey,u=e.addColumn,c=e.addCompositeIndex;function d(){o("WAWebSignalStorageUtils").getStorage().add("baseKey-store").version(o("WAWebSignalStorageVersions").baseKeyCreateTable(),[s("id"),u("address"),u("originalMsgId"),u("baseKey"),c(["address","originalMsgId"])]).view(function(e){return{id:e.id,address:e.address,originalMsgId:e.originalMsgId,baseKey:e.baseKey}})}function m(){return o("WAWebSignalStorageUtils").getStorage().table("baseKey-store")}l.addTable=d,l.getTable=m}),98);
__d("WAWebSchemaIdentity",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addColumn,u=e.addUserDefinedPrimaryKey;function c(){o("WAWebSignalStorageUtils").getStorage().add("identity-store").version(o("WAWebSignalStorageVersions").identityCreateTable(),[u("identifier"),s("identityKey"),s("rowId"),s("sentAddonRowId")]).view(function(e){return{identifier:e.identifier,identityKey:e.identityKey,rowId:e.rowId,sentAddonRowId:e.sentAddonRowId}})}function d(){return o("WAWebSignalStorageUtils").getStorage().table("identity-store")}l.addTable=c,l.getTable=d}),98);
__d("WAWebSchemaMeta",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addColumn,u=e.addUserDefinedPrimaryKey;function c(){o("WAWebSignalStorageUtils").getStorage().add("signal-meta-store").version(o("WAWebSignalStorageVersions").metaCreateTable(),[u("key"),s("value")]).view(function(e){return{key:e.key,value:e.value}})}function d(){return o("WAWebSignalStorageUtils").getStorage().table("signal-meta-store")}l.addTable=c,l.getTable=d}),98);
__d("WAWebSchemaPrekey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addAutoIncrementingPrimaryKey,u=e.addColumn;function c(){o("WAWebSignalStorageUtils").getStorage().add("prekey-store").version(o("WAWebSignalStorageVersions").preKeyCreateTable(),[s("keyId"),u("keyPair"),u("isDirectDistribution")]).view(function(e){return{keyId:e.keyId,keyPair:e.keyPair,isDirectDistribution:e.isDirectDistribution}})}function d(){return o("WAWebSignalStorageUtils").getStorage().table("prekey-store")}l.addTable=c,l.getTable=d}),98);
__d("WAWebSchemaSenderkey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addColumn,u=e.addIndex,c=e.addUserDefinedPrimaryKey;function d(){o("WAWebSignalStorageUtils").getStorage().add("senderkey-store").version(o("WAWebSignalStorageVersions").senderKeyCreateTable(),[c("senderKeyName"),s("senderKey"),s("senderId"),u("senderId")]).view(function(e){return{senderKeyName:e.senderKeyName,senderKey:e.senderKey,senderId:e.senderId}})}function m(){return o("WAWebSignalStorageUtils").getStorage().table("senderkey-store")}l.addTable=d,l.getTable=m}),98);
__d("WAWebSchemaSession",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addColumn,u=e.addUserDefinedPrimaryKey;function c(){o("WAWebSignalStorageUtils").getStorage().add("session-store").version(o("WAWebSignalStorageVersions").sessionCreateTable(),[u("address"),s("session")]).view(function(e){return{address:e.address,session:e.session}})}function d(){return o("WAWebSignalStorageUtils").getStorage().table("session-store")}l.addTable=c,l.getTable=d}),98);
__d("WAWebSchemaSignedPrekey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addAutoIncrementingPrimaryKey,u=e.addColumn;function c(){o("WAWebSignalStorageUtils").getStorage().add("signed-prekey-store").version(o("WAWebSignalStorageVersions").signedPreKeyCreateTable(),[s("keyId"),u("keyPair"),u("signature")]).view(function(e){return{keyId:e.keyId,keyPair:e.keyPair,signature:e.signature}})}function d(){return o("WAWebSignalStorageUtils").getStorage().table("signed-prekey-store")}l.addTable=c,l.getTable=d}),98);
__d("WAWebSignalStorage",["WALogger","WAWeb-dexie","WAWebDbRolloutUtil","WAWebDexieCastTypes","WAWebSchemaBasekey","WAWebSchemaIdentity","WAWebSchemaMeta","WAWebSchemaPrekey","WAWebSchemaSenderkey","WAWebSchemaSession","WAWebSchemaSignedPrekey","WAWebSignalStorageUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return s==null&&(yield o("WAWebDbRolloutUtil").loadSchemaVersions(),o("WAWebSignalStorageUtils").createStorage(),o("WAWebSchemaBasekey").addTable(),o("WAWebSchemaIdentity").addTable(),o("WAWebSchemaMeta").addTable(),o("WAWebSchemaPrekey").addTable(),o("WAWebSchemaSenderkey").addTable(),o("WAWebSchemaSession").addTable(),o("WAWebSchemaSignedPrekey").addTable(),s=o("WAWebSignalStorageUtils").getStorage().initialize().catch(function(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]))).verbose().sendLogs("Failed to initialize signal storage",{sendLogsType:o("WALogger").SendLogsType.CRASH_OR_UNRECOVERABLE_ERROR_SAD}),t})),s}),c.apply(this,arguments)}function d(){return o("WAWebSignalStorageUtils").destroyStorage().catch(function(){return o("WAWebDexieCastTypes").dexieCastToPromise(new(r("WAWeb-dexie"))(o("WAWebSignalStorageUtils").DATABASE_NAME).delete())}).finally(function(){s=null})}l.getBaseKeyTable=o("WAWebSchemaBasekey").getTable,l.getIdentityTable=o("WAWebSchemaIdentity").getTable,l.getMetaTable=o("WAWebSchemaMeta").getTable,l.getPreKeyTable=o("WAWebSchemaPrekey").getTable,l.getSenderKeyTable=o("WAWebSchemaSenderkey").getTable,l.getSessionTable=o("WAWebSchemaSession").getTable,l.getSignedPreKeyTable=o("WAWebSchemaSignedPrekey").getTable,l.initialize=u,l.destroy=d}),98);
__d("WAWebSignalStoreApi",["Promise","WALogger","WASignalKeys","WAWebNoop","WAWebSignalCommonUtils","WAWebSignalConst","WAWebSignalStorage","WAWebSignalStorageUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u=1,c=(function(){function t(){this.idToSignedPreKey=new Map}var a=t.prototype;return a.getMeta=function(t){var e=o("WAWebSignalStorage").getMetaTable();return e.get(t).then(function(e){return e?e.value:null})},a.putMeta=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebSignalStorage").getMetaTable(),r=e.map(function(e){return t.createOrReplace(e)});yield(s||(s=n("Promise"))).all(r)});function t(t){return e.apply(this,arguments)}return t})(),a.setServerHasPreKeys=function(t){this.putMeta([{key:o("WAWebSignalConst").META_KEYS.SERVER_HAS_KEY,value:t}])},a.getServerHasPreKeys=function(){return this.getMeta(o("WAWebSignalConst").META_KEYS.SERVER_HAS_KEY)},a.putADVSignedIdentity=function(t){return this.putMeta([{key:o("WAWebSignalConst").META_KEYS.ADV_SIGNED_IDENTITY,value:t}])},a.getADVSignedIdentity=function(){return this.getMeta(o("WAWebSignalConst").META_KEYS.ADV_SIGNED_IDENTITY)},a.getPreKeysByRange=function(t,n){var e=o("WAWebSignalStorage").getPreKeyTable();return e.greaterThan(["keyId"],t-1,{limit:n})},a.getPreKeyById=function(t){var e=o("WAWebSignalStorage").getPreKeyTable();return e.get(t)},a.removePreKeyById=function(t){var e=o("WAWebSignalStorage").getPreKeyTable();return e.remove(t)},a.bulkRemovePreKey=function(t){var e=o("WAWebSignalStorage").getPreKeyTable();return e.bulkRemove(t)},a.putPreKeys=function(t){var e=o("WAWebSignalStorage").getPreKeyTable();return e.bulkCreateOrReplace(t)},a.markPreKeyAsDirectDistribution=function(t){var e=o("WAWebSignalStorage").getPreKeyTable();return e.merge(t,{isDirectDistribution:1})},a.getSignedPreKey=function(){var e=this;return this.getMeta(o("WAWebSignalConst").META_KEYS.LAST_SPK_ID).then(function(t){return e.getSignedPreKeyById(t)})},a.getSignedPreKeyById=function(t){var e=this;if(this.idToSignedPreKey.has(t))return(s||(s=n("Promise"))).resolve(this.idToSignedPreKey.get(t));var r=o("WAWebSignalStorage").getSignedPreKeyTable();return r.get(t).then(function(n){return e.idToSignedPreKey.set(t,n),n})},a.putSignedPreKeys=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebSignalStorage").getSignedPreKeyTable(),a=e.map(function(e){var n=e.keyId,o=e.keyPair,a=e.signature;return t.get(n).then(function(e){if(e)throw r("err")("signed preKey id "+n+" already exists");var i={keyId:n,keyPair:o,signature:a};return t.create(i)})});yield(s||(s=n("Promise"))).all(a)});function t(t){return e.apply(this,arguments)}return t})(),a.putSession=function(t,n){var e=o("WAWebSignalStorage").getSessionTable();return e.createOrReplace({address:t,session:n})},a.bulkPutSession=function(t){var e=o("WAWebSignalStorage").getSessionTable();return e.bulkCreateOrReplace(t)},a.removeSession=function(t){var e=o("WAWebSignalStorage").getSessionTable();return e.remove(t)},a.bulkRemoveSession=function(t){var e=o("WAWebSignalStorage").getSessionTable();return e.bulkRemove(t)},a.getSession=function(t){var e=o("WAWebSignalStorage").getSessionTable();return e.get(t).then(function(e){return e?e.session:null})},a.bulkGetSession=function(t){var e=o("WAWebSignalStorage").getSessionTable();return e.bulkGet(t).then(function(e){return e.map(function(e){return e?e.session:null})})},a.putIdentity=function(t,n){var e=o("WAWebSignalStorage").getIdentityTable();return e.createOrReplace({identifier:t,identityKey:n})},a.bulkPutIdentity=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.bulkCreateOrReplace(t)},a.bulkGetIdentity=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.bulkGet(t).then(function(e){return e.map(function(e){return e?e.identityKey:null})})},a.getIdentity=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.get(t).then(function(e){return e?e.identityKey:null})},a.removeIdentity=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.remove(t)},a.bulkRemoveIdentity=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.bulkRemove(t)},a.getIdentityKeyWithRowId=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.get(t).then(function(e){return e?{identityKey:e.identityKey,rowId:e.rowId,sentAddonRowId:e.sentAddonRowId}:null})},a.bulkGetIdentityKeyWithRowId=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.bulkGet(t).then(function(e){return e.map(function(e){return e?{identityKey:e.identityKey,rowId:e.rowId}:null})})},a.bulkPutIdentityKeyWithRowId=function(t){var e=o("WAWebSignalStorage").getIdentityTable();return e.bulkCreateOrReplace(t)},a.saveBaseKey=function(t,n,r){var e=o("WAWebSignalStorage").getBaseKeyTable();return e.createOrReplace({address:t,originalMsgId:n,baseKey:r})},a.loadBaseKey=function(t,n){var e=o("WAWebSignalStorage").getBaseKeyTable();return e.equals(["address","originalMsgId"],[t,n]).then(function(e){return e&&e.length!==0?e[0].baseKey:null})},a.deleteBaseKey=function(t,n){var e=o("WAWebSignalStorage").getBaseKeyTable();return e.equals(["address","originalMsgId"],[t,n]).then(function(t){if(t&&t.length!==0)return e.remove(t[0].id)})},a.putSenderKey=function(t,n,r){var e=o("WAWebSignalStorage").getSenderKeyTable();return e.createOrReplace({senderKeyName:t,senderId:n,senderKey:r})},a.bulkPutSenderKey=function(t){var e=o("WAWebSignalStorage").getSenderKeyTable();return e.bulkCreateOrReplace(t)},a.removeSenderKey=function(t){var e=o("WAWebSignalStorage").getSenderKeyTable();return e.remove(t)},a.getSenderKey=function(t){var e=o("WAWebSignalStorage").getSenderKeyTable();return e.get(t).then(function(e){return e?e.senderKey:null})},a.removeSenderKeyBySenderId=function(t){var e=o("WAWebSignalStorage").getSenderKeyTable();return e.equals(["senderId"],t).then(function(t){return e.bulkRemove(t.map(function(e){return e.senderKeyName}))})},a.clearCredential=function(){var e,t=[(e=o("WAWebSignalStorage")).getIdentityTable(),e.getMetaTable(),e.getPreKeyTable(),e.getSessionTable(),e.getSignedPreKeyTable()];return(s||(s=n("Promise"))).all(t.map(function(e){return e.clear()})).then(r("WAWebNoop"))},a.getRegistrationInfo=function(){var e=this;return this.registrationInfo!=null?(s||(s=n("Promise"))).resolve(this.registrationInfo):(s||(s=n("Promise"))).all([this.getMeta(o("WAWebSignalConst").META_KEYS.REG_ID),this.getMeta(o("WAWebSignalConst").META_KEYS.STATIC_PUBKEY),this.getMeta(o("WAWebSignalConst").META_KEYS.STATIC_PRIVKEY)]).then(function(t){var r=t[0],a=t[1],i=t[2];if(!(!r||!a||!i))return(s||(s=n("Promise"))).all([o("WAWebSignalCommonUtils").decryptRegistrationMaterial(a),o("WAWebSignalCommonUtils").decryptRegistrationMaterial(i)]).then(function(t){var n=t[0],o=t[1];return e.registrationInfo={registrationId:r,identityKeyPair:{pubKey:n,privKey:o}},e.registrationInfo})})},a.setRegistrationInfo=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;yield(s||(s=n("Promise"))).all([o("WAWebSignalCommonUtils").encryptRegistrationMaterial(e.identityKeyPair.pubKey),o("WAWebSignalCommonUtils").encryptRegistrationMaterial(e.identityKeyPair.privKey)]).then(function(r){var a=r[0],i=r[1];return(s||(s=n("Promise"))).all([t.putMeta([{key:o("WAWebSignalConst").META_KEYS.REG_ID,value:e.registrationId},{key:o("WAWebSignalConst").META_KEYS.STATIC_PUBKEY,value:a},{key:o("WAWebSignalConst").META_KEYS.STATIC_PRIVKEY,value:i}])])})});function t(t){return e.apply(this,arguments)}return t})(),a.getOrGenPreKeys=function(r,a){var t=this;return o("WAWebSignalStorageUtils").getStorage().lock(["signal-meta-store","prekey-store"],function(){return(s||(s=n("Promise"))).all([t.getMeta(o("WAWebSignalConst").META_KEYS.FIRST_UNUPLOAD_PK_ID),t.getMeta(o("WAWebSignalConst").META_KEYS.NEXT_PK_ID)]).then(function(i){var l=i[0],c=i[1],m=l||u,p=c||u,_=p-m,f=r-_;if(f<=0)return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getPreKeys: no prekey needs to be generated, available: ",", need: ",""])),_,r),t.getPreKeysByRange(m,r);var g=d(p,p+f).map(function(e){return a(e)});return(s||(s=n("Promise"))).all(g).then(function(e){return t.savePreKeys(e)}).then(function(){return t.getPreKeysByRange(m,r)})})})},a.getOrGenSinglePreKey=function(t){return this.getOrGenPreKeys(1,t).then(function(e){if(e.length!==1)throw r("err")("Expected to get exactly one key but got "+e.length);return e[0]})},a.savePreKeys=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0){var t=e[e.length-1];yield(s||(s=n("Promise"))).all([this.putMeta([{key:o("WAWebSignalConst").META_KEYS.NEXT_PK_ID,value:t.keyId+1}]),this.putPreKeys(e)])}});function t(t){return e.apply(this,arguments)}return t})(),a.markKeyAsUploaded=function(t){var e=this;return(s||(s=n("Promise"))).all([this.getMeta(o("WAWebSignalConst").META_KEYS.FIRST_UNUPLOAD_PK_ID),this.getMeta(o("WAWebSignalConst").META_KEYS.NEXT_PK_ID)]).then(function(n){var a=n[0],i=n[1];if(t<0||!i||t>=i)throw r("err")("markKeyAsUploaded: key "+t+" is out of boundary.");var l=a?Math.max(a,t+1):t+1;return e.putMeta([{key:o("WAWebSignalConst").META_KEYS.FIRST_UNUPLOAD_PK_ID,value:l}])})},a.rotateSignedPreKey=function(t,n){var e=this;return o("WAWebSignalStorageUtils").getStorage().lock(["signal-meta-store","signed-prekey-store"],function(){return e.getMeta(o("WAWebSignalConst").META_KEYS.LAST_SPK_ID).then(function(r){var a=r==null||r+1>=o("WASignalKeys").PRE_KEY_NON_INCLUSIVE_UPPER_BORDER?u:r+1;return n(t,a).then(function(t){return e.putSignedPreKeys([t]),e.putMeta([{key:o("WAWebSignalConst").META_KEYS.LAST_SPK_ID,value:a}]),t})})})},t})();function d(e,t){for(var n=[],r=e;r<t;r++)n.push(r);return n}var m=new c;l.waSignalStore=m}),98);
__d("WAWebAdvSignatureApi",["invariant","Promise","WABase64","WABinary","WAByteArray","WALogger","WAWebAdvHandlerApi","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebBizCoexHostedAddVerification","WAWebCryptoCurve25519","WAWebCurrentUser","WAWebProtobufsAdv.pb","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebSignalStoreApi","WAWebSignalUtilsApi","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l,s){var e,u,c,d,m,p,_,f,g,h,y;function C(e,t,n,r){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a){a===void 0&&(a=!1);var i=!1;o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(i=t.isHosted());try{var l=o("WAWebWidFactory").asUserWidOrThrow(t),g=o("WAByteArray").uint8ArrayToBuffer(r),h=yield o("WAWebSignalProtocolStore").getSignalProtocolStore().loadIdentityKey(o("WAWebSignalCommonUtils").createSignalAddress(t).toString());if(h!=null){var y=o("WAWebCryptoCurve25519").toCurveKeyPubKey(o("WAWebSignalCommonUtils").strToBuffer(h));if(o("WAWebSignalCommonUtils").bufferEqual(y,g))return!0}var C=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,n);C!=null||s(0,56342);var b=yield o("WAWebSignalProtocolStore").getSignalProtocolStore().loadIdentityKey(o("WAWebSignalCommonUtils").createSignalAddress(l).toString()),v=b!=null?o("WAWebCryptoCurve25519").toCurveKeyPubKey(o("WAWebSignalCommonUtils").strToBuffer(b)):null;if(!w(C,g,v))return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: invalid account signature"]))),!1;if(!q(C,g,v,i))return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: invalid device signature"]))),!1;var S=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVDeviceIdentitySpec,C.details);S!=null||s(0,56341);var R=C.accountSignatureKey;o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(S.accountType===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: add to coex cache for ",""])),t==null?void 0:t.toLogString()),o("WAWebBizCoexHostedAddVerification").addToCoexHostedVerificationCache(t)),R=R&&R.byteLength>0?R:void 0);try{yield o("WAWebAdvHandlerApi").handleADVDeviceUpdateForMessage(t,S,v,R,g,a,S.accountType)}catch(e){if(!o("WAWebCurrentUser").isEmployee())o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: process adv device identity failed: ",""])),e);else{var L=t.device;o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["advDeviceIdentity failed for deviceId: ",""])),L),o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: process adv device identity failed: ",""])),e).sendLogs("validate-adv-identity-handle-update-for-message-failed")}return!1}return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: successfully verified accountSignature and deviceSignature"]))),!0}catch(e){return o("WALogger").WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: failed"]))),!1}}),b.apply(this,arguments)}function v(e,t,n,r){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){r===void 0&&(r=!1);var a=n.find(function(e){return e.e2eType===o("WAWebBackendJobs.flow").CiphertextType.Pkmsg});if(!a)return!0;o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["validateADVwithEncs: start validate prekey msg "])));try{e!=null||s(0,56346);var i=o("WAWebSignalUtilsApi").extractIdentityKey(a.ciphertext);i!=null||s(0,56345);var l=yield C(e,t,new Uint8Array(i),r);return yield o("WAWebSignalProtocolStore").getSignalProtocolStore().flushBufferToDiskIfNotMemOnlyMode(),l}catch(e){return o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["validateADVwithEncs: failed ",""])),e),!1}}),S.apply(this,arguments)}var R=new Uint8Array([6,5]),L=new Uint8Array([6,6]),E=new Uint8Array([6,0]),k=new Uint8Array([6,1]),I=new Uint8Array([6,2]);function T(){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=new Uint8Array(32);self.crypto.getRandomValues(e);var t=o("WABase64").encodeB64(e);return yield o("WAWebUserPrefsMultiDevice").setADVSecretKey(t),t}),D.apply(this,arguments)}function x(){return $.apply(this,arguments)}function $(){return $=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebUserPrefsMultiDevice").getADVSecretKey();if(e==null)throw r("err")("secretKey is null or undefined");return e}),$.apply(this,arguments)}function P(e){return e==null?(y||(y=n("Promise"))).reject(r("err")("advSignedDeviceIdentity is null or undefined")):e.deviceSignature==null?(y||(y=n("Promise"))).reject(r("err")("advSignedDeviceIdentity is missing deviceSignature")):o("WAWebSignalStoreApi").waSignalStore.putADVSignedIdentity(e)}function N(){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebSignalStoreApi").waSignalStore.getADVSignedIdentity();if(e==null)throw r("err")("advSignedDeviceIdentity is null or undefined");if(e.deviceSignature==null)throw r("err")("advSignedDeviceIdentity is missing deviceSignature");return o("encodeProtobuf").encodeProtobuf(o("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,e).readByteArrayView()}),M.apply(this,arguments)}function w(e,t,n){var r=F(e,n),o=r.accountSignature,a=r.accountSignatureKey,i=r.advDeviceIdentityDetails;return A(i,o,t,a)}function A(e,t,n,r){var a=E;if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){var i=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVDeviceIdentitySpec,e);i.deviceType===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(a=R)}r!=null||s(0,56344),t!=null||s(0,56295);var l=o("WABinary").Binary.build(a,e,n).readByteArrayView();return o("WAWebCryptoCurve25519").verifySignature(new Uint8Array(r),l,new Uint8Array(t))}function F(e,t){var n=e.details,r=e.accountSignatureKey||t;o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(r=r&&r.byteLength>0?r:t),r!=null||s(0,56344);var a=e.accountSignature;return a!=null||s(0,56295),n!=null||s(0,70451),{accountSignatureKey:r,accountSignature:a,advDeviceIdentityDetails:n}}function O(e,t,n){var r=e.details,a=o("WABinary").Binary.build(k,r,t.pubKey,n).readByteArrayView().buffer;return o("WAWebCryptoCurve25519").calculateSignature(t,a)}function B(e,t,n,r,a){var i=k;o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&n===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(i=L);var l=o("WABinary").Binary.build(i,e,t,a).readByteArrayView();return o("WAWebCryptoCurve25519").verifySignature(new Uint8Array(t),l,new Uint8Array(r))}function W(e,t){var n=e.details,r=e.deviceSignature;r!=null||s(0,56343);var a=e.accountSignatureKey||t;return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(a=a&&a.byteLength>0?a:t),a!=null||s(0,56344),n!=null||s(0,70451),{accountSignatureKey:a,deviceSignature:r,advDeviceIdentityDetails:n}}function q(e,t,n,r){r===void 0&&(r=!1);var a=W(e,n),i=a.accountSignatureKey,l=a.advDeviceIdentityDetails,s=a.deviceSignature,u=o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE;return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&r&&(u=o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED),B(l,t,u,s,i)}function U(e){if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){var t=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVDeviceIdentitySpec,e.details);t!=null||s(0,56341);var n=t.accountType,r=t.deviceType;n!==o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE||s(0,70449),r!==o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE||s(0,70450)}}function V(){return H.apply(this,arguments)}function H(){return H=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o("WAWebUserPrefsMultiDevice").setADVSecretKey(void 0)}),H.apply(this,arguments)}function G(e,t){var n=e.details,r=e.accountSignature;r!=null||s(0,56295);var a=o("WABinary").Binary.build(I,n).readByteArrayView();return o("WAWebCryptoCurve25519").verifySignature(new Uint8Array(t),a,new Uint8Array(r))}l.validateADVwithIdentityKey=C,l.validateADVwithEncs=v,l.ADV_HOSTED_PREFIX_DEVICE_IDENTITY_ACCOUNT_SIGNATURE=R,l.generateADVSecretKey=T,l.getADVSecretKey=x,l.setADVSignedIdentity=P,l.getADVEncodedIdentity=N,l.verifyDeviceIdentityAccountSignature=w,l.generateDeviceSignature=O,l.clearADVSecretKey=V,l.verifyKeyIndexListAccountSignature=G}),98);
__d("WAWebHandleAdvForMessageApi",["invariant","WAJids","WALogger","WAWebApiDeviceList","WAWebCurrentUser","WAWebHandleAdvListResetApi","WAWebHandleAdvNoListResetApi","WAWebSignalCommonUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l,s){var e;function u(e,t,n,r,o,a,i,l){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a,i,l,u,c){l===void 0&&(l=!1);var d=n.keyIndex,m=n.rawId,p=n.timestamp;m!=null||s(0,56258),p!=null||s(0,56257),d!=null||s(0,56256);var _={rawId:m,timestamp:p,keyIndex:d},f=t.device;f!=null&&f!==o("WAJids").DEFAULT_DEVICE_ID||s(0,56259);var g=o("WAWebWidFactory").asUserWidOrThrow(t),h=yield o("WAWebApiDeviceList").getDeviceRecord(g),y=r==null||a!=null&&!o("WAWebSignalCommonUtils").bufferEqual(r,a);return o("WAWebCurrentUser").isEmployee()&&o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleADVDeviceIdentity: isNewPrimaryIdentity-",""])),y),!h||h.deleted||h.rawId!==m||y?o("WAWebHandleAdvListResetApi").handleListReset(t,_,y?a:null,i,h,l,u,c):o("WAWebHandleAdvNoListResetApi").handleNoListReset(t,_,i,h,l,u,c)}),c.apply(this,arguments)}l.handleADVDeviceUpdateForMessage=u}),98);
__d("WAWebAdvExpectedTsApi",["WATimeUtils"],(function(t,n,r,o,a,i,l){function e(e,t,n){var r=t==null?void 0:t.timestamp;if(r==null)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};var o,a,i;return t!=null&&!t.deleted&&(o=t.expectedTs,a=t.expectedTsLastDeviceJobTs,i=t.expectedTsUpdateTs),s(e,r,n,o,a,i)}function s(e,t,n,r,a,i){var l={expectedTs:r,expectedTsLastDeviceJobTs:a,expectedTsUpdateTs:i};return t>=e||r!=null&&r>=e||(l.expectedTs=e,l.expectedTsLastDeviceJobTs=n!=null?n:void 0,(r==null||t>=r)&&(l.expectedTsUpdateTs=o("WATimeUtils").unixTimeWithoutClockSkewCorrection())),l}function u(e,t,n,r){return n==null||n.deleted||n.expectedTs==null?!1:e>=n.expectedTs||e<n.expectedTs&&t===n.expectedTs&&r!=null&&(n.expectedTsLastDeviceJobTs==null||r>n.expectedTsLastDeviceJobTs)}l.computeExpectedTsForDeviceRecord=e,l.computeNewExpectedTs=s,l.shouldClearExpectedTs=u}),98);
__d("WAWebHandleAdvListResetApi",["invariant","WAJids","WALogger","WALongInt","WATimeUtils","WAWebABProps","WAWebAdvExpectedTsApi","WAWebBizCoexGatingUtils","WAWebCryptoCurve25519","WAWebDeviceListPk","WAWebIdentityUpdateDeviceTableApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l,s){var e;function u(e,t,n,r,o,a,i,l){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,u,c,d){var m;u===void 0&&(u=!1);var p=n.keyIndex,_=n.rawId,f=n.timestamp,g=o("WALongInt").numberOrThrowIfTooLarge(f),h=t.device;h!=null&&h!==o("WAJids").DEFAULT_DEVICE_ID||s(0,56259);var y=o("WAWebWidFactory").asUserWidOrThrow(t),C=0;if(C=(m=l==null?void 0:l.timestamp)!=null?m:o("WATimeUtils").pastUnixTime((o("WAWebABProps").getABPropConfigValue("num_days_key_index_list_expiration")-1)*o("WATimeUtils").DAY_SECONDS),l!=null&&!l.deleted){if(l.timestamp>g)throw o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleADVDeviceIdentity:handleListReset: incomingTs: "," localDeviceRecord.timestamp: ",""])),g,l.timestamp),r("err")("handleADVDeviceIdentity:handleListReset: out-of-order timestamp detected");yield o("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(y,l.devices,u)}a&&(yield o("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(o("WAWebSignalCommonUtils").createSignalAddress(y).toString(),o("WAWebCryptoCurve25519").toSignalCurvePubKey(a)));var b={id:o("WAWebDeviceListPk").createDeviceListPK(t),rawId:_,timestamp:C,devices:[{id:h,keyIndex:p},{id:o("WAJids").DEFAULT_DEVICE_ID,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1},v=o("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(g,b,c);b.expectedTs=v.expectedTs,b.expectedTsLastDeviceJobTs=v.expectedTsLastDeviceJobTs,b.expectedTsUpdateTs=v.expectedTsUpdateTs,o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&d!=null&&(b.advAccountType=d),yield o("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate([{wid:y,update:b,currentRecord:null}],u),yield o("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(o("WAWebSignalCommonUtils").createSignalAddress(t).toString(),o("WAWebCryptoCurve25519").toSignalCurvePubKey(i))}),c.apply(this,arguments)}l.handleListReset=u}),98);
__d("WAWebHandleAdvNoListResetApi",["invariant","WAJids","WALogger","WALongInt","WAWebAdvExpectedTsApi","WAWebBizCoexGatingUtils","WAWebCryptoCurve25519","WAWebIdentityUpdateDeviceTableApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l,s){var e;function u(e,t,n,r,o,a,i){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,u,c){l===void 0&&(l=!1);var d=n.keyIndex,m=n.timestamp,p=o("WALongInt").numberOrThrowIfTooLarge(m),_=t.device;if(_!=null&&_!==o("WAJids").DEFAULT_DEVICE_ID||s(0,56259),i.timestamp>=p&&i.validIndexes&&!i.validIndexes.includes(d))throw o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleADVDeviceIdentity:handleNoListReset: incomingTs: "," localDeviceRecord.timestamp: "," incomingKeyIndex "," localDeviceRecord.validIndexes: ",""])),p,i.timestamp,d,i.validIndexes),r("err")("handleADVDeviceIdentity:handleNoListReset: out-of-order timestamp detected");var f=new Map(i.devices.map(function(e){return[e.id,e.keyIndex]}));if(!f.has(_)||f.get(_)!==d){f.set(_,d);var g=Array.from(f.entries(),function(e){var t=e[0],n=e[1];return{id:t,keyIndex:n}}),h=babelHelpers.extends({},i,{devices:g,deleted:!1}),y=o("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(p,h,u);h.expectedTs=y.expectedTs,h.expectedTsLastDeviceJobTs=y.expectedTsLastDeviceJobTs,h.expectedTsUpdateTs=y.expectedTsUpdateTs,o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(h.advAccountType=c),yield o("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate([{wid:o("WAWebWidFactory").asUserWidOrThrow(t),update:h,currentRecord:i}],l,!0),yield o("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(o("WAWebSignalCommonUtils").createSignalAddress(t).toString(),o("WAWebCryptoCurve25519").toSignalCurvePubKey(a))}}),c.apply(this,arguments)}l.handleNoListReset=u}),98);
__d("WAWebHandleAdvDeviceNotificationApi",["WAJids","WALogger","WALongInt","WAWebAdvExpectedTsApi","WAWebBizCoexGatingUtils","WAWebBizCoexHostedAddVerification","WAWebBizCoexUtils","WAWebDeviceListPk","WAWebHandleAdvDeviceNotificationUtils","WAWebProtobufsAdv.pb"],(function(t,n,r,o,a,i,l){var e,s;function u(t,n,r,a,i,l,u){if(!l||l.deleted)return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&o("WAWebBizCoexUtils").triggerUsyncForCoexDeviceAdd(n,t),null;if(r<l.timestamp||i==null)return null;var c=o("WAWebHandleAdvDeviceNotificationUtils").decodeSignedKeyIndexBytes(i,a);if(!c)return null;var d=c.rawId,m=o("WALongInt").numberOrThrowIfTooLarge(c.timestamp),p=null;if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(p=c.accountType,p===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleDeviceAddNotification: add to coex cache for ",""])),t==null?void 0:t.toLogString()),o("WAWebBizCoexHostedAddVerification").addToCoexHostedVerificationCache(t))),m!==r)return null;var _=!1,f=null,g=l.timestamp;l.rawId!==d?_=!0:f=l.devices,o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&l.advAccountType!=null&&l.advAccountType!==p&&(_=!0,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Clear record due to mismatch between local ADV account type and incoming ADV account type of "," for ",""])),p,t==null?void 0:t.toLogString()));var h=new Set(c.validIndexes),y=c.currentIndex||0,C=f==null?[]:f.filter(function(e){return e.id!==o("WAJids").DEFAULT_DEVICE_ID&&(h.has(e.keyIndex)||e.keyIndex>y)});n.forEach(function(e){var t=e.id,n=e.keyIndex;t!==o("WAJids").DEFAULT_DEVICE_ID&&n!=null&&h.has(n)&&C.push({id:t,keyIndex:n})}),C.push({id:o("WAJids").DEFAULT_DEVICE_ID,keyIndex:0});var b={id:o("WAWebDeviceListPk").createDeviceListPK(t),rawId:d,timestamp:g,validIndexes:Array.from(h),devices:C,currentIndex:c.currentIndex,deleted:!1},v=o("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(m,b,u);return b.expectedTs=v.expectedTs,b.expectedTsLastDeviceJobTs=v.expectedTsLastDeviceJobTs,b.expectedTsUpdateTs=v.expectedTsUpdateTs,o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&p!=null&&(b.advAccountType=p),{update:b,clearRecord:_}}function c(e,t,n){if(n==null||n.deleted||t<n.timestamp)return null;var r=new Map(e.map(function(e){return[e.id,e.keyIndex]})),a=n.devices.filter(function(e){if(e.id!==o("WAJids").DEFAULT_DEVICE_ID){var t=r.get(e.id);return t==null||t!==e.keyIndex}return!1});return a.push({id:o("WAJids").DEFAULT_DEVICE_ID,keyIndex:0}),{update:babelHelpers.extends({},n,{devices:a}),clearRecord:!1}}l.handleDeviceAddNotification=u,l.handleDeviceRemoveNotification=c}),98);
__d("WAWebHandleAdvDeviceNotificationUtils",["WALogger","WAWebAdvSignatureApi","WAWebCryptoCurve25519","WAWebProtobufsAdv.pb","WAWebSignalCommonUtils","WAWebSignalProtocolStore","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s,u,c,d;function m(e,t){var n;try{n=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVSignedKeyIndexListSpec,t)}catch(e){return null}if(!o("WAWebAdvSignatureApi").verifyKeyIndexListAccountSignature(n,e))return null;var r;try{r=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVKeyIndexListSpec,n.details)}catch(e){return null}var a=r,i=a.accountType,l=a.currentIndex,s=a.rawId,u=a.timestamp,c=a.validIndexes;return u==null||s==null?null:{timestamp:u,rawId:s,validIndexes:c,currentIndex:l,accountType:i}}function p(t,n){var r;try{r=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVSignedKeyIndexListSpec,n)}catch(e){return null}var a=r.accountSignatureKey;if(a==null)return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["accountSignatureKey is null"]))).tags("verifySKeyIndexWithAccSigKey"),null;if(!o("WAWebAdvSignatureApi").verifyKeyIndexListAccountSignature(r,a))return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["account signature verification failed"]))).tags("verifySKeyIndexWithAccSigKey"),null;var i;try{i=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsAdv.pb").ADVKeyIndexListSpec,r.details)}catch(e){return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["decode failed"]))).tags("verifySKeyIndexWithAccSigKey"),null}var l=i,m=l.accountType,p=l.currentIndex,_=l.rawId,f=l.timestamp,g=l.validIndexes;if(f==null)return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["timestamp is null"]))).tags("verifySKeyIndexWithAccSigKey"),null;if(_==null)return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["rawId is null"]))).tags("verifySKeyIndexWithAccSigKey"),null;var h=o("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(o("WAWebSignalCommonUtils").createSignalAddress(t).toString(),o("WAWebCryptoCurve25519").toSignalCurvePubKey(a));return{timestamp:f,rawId:_,validIndexes:g,currentIndex:p,accountType:m,identityUpdatePromise:h}}l.decodeSignedKeyIndexBytes=m,l.verifySKeyIndexWithAccSigKey=p}),98);
__d("WAWebHandleAdvOmittedResultApi",["WAJids","WAWebAdvExpectedTsApi","WAWebProtobufsAdv.pb"],(function(t,n,r,o,a,i,l){function e(e,t,n,r){if(!t||t.deleted||e!=null&&e<t.timestamp)return null;var a=babelHelpers.extends({},t);return e!=null&&(a.timestamp=e,o("WAWebAdvExpectedTsApi").shouldClearExpectedTs(e,n,t,r)&&(a.expectedTs=void 0,a.expectedTsLastDeviceJobTs=void 0,a.expectedTsUpdateTs=void 0)),a.devices=[{id:o("WAJids").DEFAULT_DEVICE_ID,keyIndex:0}],t.advAccountType===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(a.advAccountType=o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE),{update:a,clearRecord:!1,fromHandleOmittedResult:!0}}l.handleOmittedResult=e}),98);
__d("WAWebHandleAdvForUsyncApi",["invariant","WAJids","WALogger","WAWebHandleAdvDeviceNotificationApi","WAWebHandleAdvKeyIndexResultApi","WAWebHandleAdvOmittedResultApi"],(function(t,n,r,o,a,i,l,s){var e;function u(t,n,r,a,i){var l=n.deviceList,s=n.keyIndex;if(s==null||s.signedKeyIndexBytes==null){if(l!=null&&l.some(function(e){return e.id!==o("WAJids").DEFAULT_DEVICE_ID})){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["processADVSyncResult: drop response with companion device but no keyIndexbytes"])));return}return o("WAWebHandleAdvOmittedResultApi").handleOmittedResult(s==null?void 0:s.ts,a,s==null?void 0:s.expectedTs,i)}var u=s.expectedTs,c=s.signedKeyIndexBytes,d=s.ts;return o("WAWebHandleAdvKeyIndexResultApi").handleKeyIndexResult(t,l,d,c,r,a,i,u)}function c(e,t,n,r,a,i){var l=n.deviceList,u=n.keyIndex;l!=null||s(0,75739,t),u!=null||s(0,75740,t);var c=u.signedKeyIndexBytes,d=u.ts;if(t==="add")return c!=null||s(0,75741,t),o("WAWebHandleAdvDeviceNotificationApi").handleDeviceAddNotification(e,l,d,c,r,a,i);if(t==="remove")return o("WAWebHandleAdvDeviceNotificationApi").handleDeviceRemoveNotification(l,u.ts,a)}l.handleADVSyncResult=u,l.handleDeviceNotification=c}),98);
__d("WAWebHandleAdvKeyIndexResultApi",["invariant","WAJids","WALogger","WALongInt","WAWebAdvExpectedTsApi","WAWebBizCoexGatingUtils","WAWebBizCoexHostedAddVerification","WAWebDeviceListPk","WAWebHandleAdvDeviceNotificationUtils","WAWebProtobufsAdv.pb"],(function(t,n,r,o,a,i,l,s){var e,u,c=99;function d(t,n,r,a,i,l,d,m){if((l==null?void 0:l.timestamp)!=null&&r<l.timestamp)return null;var p=null;if(o("WAWebBizCoexGatingUtils").hostedOverrideAdvAccountSignatureKeyEnabled()&&n!=null&&n.some(function(e){return!!e.isHosted})){if(p=o("WAWebHandleAdvDeviceNotificationUtils").verifySKeyIndexWithAccSigKey(t,a),!p)return null}else if(i==null||(p=o("WAWebHandleAdvDeviceNotificationUtils").decodeSignedKeyIndexBytes(i,a),!p))return null;var _=p.rawId,f=o("WALongInt").numberOrThrowIfTooLarge(p.timestamp),g=null;if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(g=p.accountType,g===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleKeyIndexResult: add to coex cache for ",""])),t==null?void 0:t.toLogString()),o("WAWebBizCoexHostedAddVerification").addToCoexHostedVerificationCache(t))),f!==r)return null;var h=!1,y=null,C=n;if(l&&!l.deleted){if(C==null&&(C=l.devices),l.rawId!==_?h=!0:y=l.devices,o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){var b=l.advAccountType!=null&&l.advAccountType!==g||l!=null&&g===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&g!==(l==null?void 0:l.advAccountType);b&&(h=!0,o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Clear record due to mismatch between local ADV account type and incoming ADV account type of "," for ",""])),g,t==null?void 0:t.toLogString()))}}else if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){var v=g===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(l==null?void 0:l.deletedChangedToHost)!==!0;v&&(h=!0)}var S=new Map,R=new Set(p.validIndexes),L=p.currentIndex||0;C&&C.forEach(function(e){var t=e.keyIndex;t!=null&&R.has(t)&&(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&e.id===c&&(e.isHosted===!0||s(0,76137)),S.set(e.id,t))}),y!=null&&y.forEach(function(e){e.keyIndex>L&&S.set(e.id,e.keyIndex)}),S.set(o("WAJids").DEFAULT_DEVICE_ID,0);var E=Array.from(S.entries()).map(function(e){var t=e[0],n=e[1];return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&t===c?{id:t,keyIndex:n,isHosted:!0}:{id:t,keyIndex:n}}),k=f,I={id:o("WAWebDeviceListPk").createDeviceListPK(t),rawId:_,timestamp:k,validIndexes:Array.from(R),devices:E,currentIndex:p.currentIndex,deleted:!1,advAccountType:g};return!h&&!o("WAWebAdvExpectedTsApi").shouldClearExpectedTs(f,m,l,d)&&l&&!l.deleted&&(I.expectedTs=l.expectedTs,I.expectedTsLastDeviceJobTs=l.expectedTsLastDeviceJobTs,I.expectedTsUpdateTs=l.expectedTsUpdateTs),p.identityUpdatePromise?{update:I,clearRecord:h,identityUpdatePromise:p.identityUpdatePromise}:{update:I,clearRecord:h}}l.handleKeyIndexResult=d}),98);
__d("WAWebCommonMsgSubtypeTypes",[],(function(t,n,r,o,a,i){var e=Object.freeze({Subject:"subject",Add:"add",Remove:"remove",Leave:"leave",Picture:"picture",Modify:"modify",Suspend:"suspend",Delete:"delete",Create:"create",Promote:"promote",Demote:"demote",Invite:"invite",RevokeInvite:"revoke_invite",Description:"description",ParentGroupDescription:"parent_group_description",Restrict:"restrict",Announce:"announce",AnnounceMsgBounce:"announce_msg_bounce",V4AddInviteSent:"v4_add_invite_sent",V4AddInviteJoin:"v4_add_invite_join",NoFrequentlyForwarded:"no_frequently_forwarded",InitialPHashMismatch:"initial_pHash_mismatch",Ephemeral:"ephemeral",GrowthLocked:"growth_locked",GrowthUnlocked:"growth_unlocked",ParentGroupLink:"parent_group_link",SiblingGroupLink:"sibling_group_link",SubGroupLink:"sub_group_link",ParentGroupUnlink:"parent_group_unlink",SiblingGroupUnlink:"sibling_group_unlink",SubGroupUnlink:"sub_group_unlink",LinkedGroupJoin:"linked_group_join",DeleteParentGroup:"delete_parent_group",DeleteParentGroupUnlink:"delete_parent_group_unlink",DeleteParentSubGroupUnlink:"delete_parent_sub_group_unlink",IntegrityParentGroupUnlink:"integrity_parent_group_unlink",IntegritySubGroupUnlink:"integrity_sub_group_unlink",LinkedGroupPromote:"linked_group_promote",LinkedGroupDemote:"linked_group_demote",MembershipApprovalMode:"membership_approval_mode",MembershipApprovalRequest:"membership_approval_request",MemberAddMode:"member_add_mode",MemberLinkMode:"member_link_mode",MemberShareGroupHistoryMode:"member_share_group_history_mode",CreatedMembershipRequests:"created_membership_requests",RevokedMembershipRequests:"revoked_membership_requests",AutoAdd:"auto_add",DefaultSubGroupAdminAdd:"default_sub_group_admin_add",DefaultSubGroupPromote:"default_sub_group_promote",DefaultSubGroupDemote:"default_sub_group_demote",InviteAutoAdd:"invite_auto_add",CommunityParticipantAddRich:"community_participant_add_rich",CommunityInviteRich:"community_invite_rich",SubGroupParticipantAddRich:"sub_group_participant_add_rich",SubGroupInviteRich:"sub_group_invite_rich",CommunityLinkParentGroupRich:"community_link_parent_group_rich",CommunityInviteAutoAddRich:"community_invite_auto_add_rich",AllowNonAdminSubGroupCreation:"allow_non_admin_sub_group_creation",AllowAdminReports:"allow_admin_reports",CreatedSubgroupSuggestion:"created_subgroup_suggestion",RevokedSubGroupSuggestions:"revoked_sub_group_suggestions",AdminReportReceived:"admin_report_received",SubgroupSuggestionsChangeNumber:"subgroup_suggestions_change_number",SubgroupAdminTriggeredAutoAdd:"subgroup_admin_triggered_auto_add",SubgroupAdminTriggeredInviteAutoAdd:"subgroup_admin_triggered_invite_auto_add",EmptySubgroupCreate:"empty_subgroup_create",GeneralChatAdd:"general_chat_add",GeneralChatAutoAddDisabled:"general_chat_auto_add_disabled",CommunityOwnerUpdate:"community_owner_update",HiddenGroup:"hidden_group",GroupSafetyCheck:"group_safety_check",GroupAdder:"group_adder",MemberLabel:"member_label",MessageHistoryBundle:"message_history_bundle",MessageHistoryNotice:"message_history_notice",Url:"url",Encrypt:"encrypt",EncryptNow:"encrypt_now",E2EIdentityUnavailable:"e2e_identity_unavailable",Identity:"identity",Device:"device",ChatPsa:"chat_psa",ErrorInDeviceList:"error_in_device_list",Miss:"miss",MissVideo:"miss_video",MissGroup:"miss_group",MissGroupVideo:"miss_group_video",Silence:"silence",AdminRevoke:"admin_revoke",SenderRevoke:"sender_revoke",EphemeralSetting:"ephemeral_setting",EphemeralSyncResponse:"ephemeral_sync_response",SharePhoneNumber:"share_phone_number",AppStateFatalExceptionNotification:"app_state_fatal_exception_notification",AppStateSyncKeyShare:"app_state_sync_key_share",AppStateSyncKeyRequest:"app_state_sync_key_request",HistorySyncNotification:"history_sync_notification",MessageEdit:"message_edit",MessageEditDecrypted:"message_edit_decrypted",BotFeedback:"bot_feedback",BotMemuOnboarding:"bot_memu_onboarding",BotRequestWelcome:"bot_request_welcome",StatusMentionMessage:"status_mention_message",StatusGroupMentionMessage:"status_group_mention_message",StatusNotificationMessage:"status_notification_message",Request:"request",Send:"send",Ciphertext:"ciphertext",Futureproof:"futureproof",PollVote:"poll_vote",Sender:"sender",Admin:"admin",Phone:"phone",PhoneOnlyFeature:"phone_only_feature",Reaction:"reaction",NonVerifiedTransition:"non_verified_transition",UnverifiedTransition:"unverified_transition",VerifiedTransition:"verified_transition",VerifiedLowUnknown:"verified_low_unknown",VerifiedHigh:"verified_high",VerifiedInitialUnknown:"verified_initial_unknown",VerifiedInitialLow:"verified_initial_low",VerifiedInitialHigh:"verified_initial_high",VerifiedTransitionAnyToNone:"verified_transition_any_to_none",VerifiedTransitionAnyToHigh:"verified_transition_any_to_high",VerifiedTransitionHighToLow:"verified_transition_high_to_low",VerifiedTransitionHighToUnknown:"verified_transition_high_to_unknown",VerifiedTransitionUnknownToLow:"verified_transition_unknown_to_low",VerifiedTransitionLowToUnknown:"verified_transition_low_to_unknown",VerifiedTransitionNoneToLow:"verified_transition_none_to_low",VerifiedTransitionNoneToUnknown:"verified_transition_none_to_unknown",PaymentTransactionStatusUpdateFailed:"payment_transaction_status_update_failed",PaymentTransactionStatusUpdateRefunded:"payment_transaction_status_update_refunded",PaymentTransactionStatusUpdateRefundFailed:"payment_transaction_status_update_refund_failed",PaymentTransactionStatusReceiverPendingSetup:"payment_transaction_status_receiver_pending_setup",PaymentTransactionStatusReceiverSuccessAfterHiccup:"payment_transaction_status_receiver_success_after_hiccup",PaymentTransactionRequestCancelled:"payment_transaction_request_cancelled",PaymentActionAccountSetupReminder:"payment_action_account_setup_reminder",PaymentActionSendPaymentReminder:"payment_action_send_payment_reminder",PaymentActionSendPaymentInvitation:"payment_action_send_payment_invitation",PaymentActionRequestDeclined:"payment_action_request_declined",PaymentActionRequestExpired:"payment_action_request_expired",PaymentInviteAccountSetUp:"payment_invite_account_set_up",BizVerifiedTransitionTopToBottom:"biz_verified_transition_top_to_bottom",BizVerifiedTransitionBottomToTop:"biz_verified_transition_bottom_to_top",BizIntroTop:"biz_intro_top",BizIntroBottom:"biz_intro_bottom",BizNameChange:"biz_name_change",BizMoveToConsumerApp:"biz_move_to_consumer_app",BizTwoTierMigrationTop:"biz_two_tier_migration_top",BizTwoTierMigrationBottom:"biz_two_tier_migration_bottom",SenderInvite:"sender_invite",ReceiverInvite:"receiver_invite",ChangeNumber:"change_number",ChangeUsername:"change_username",ChangeLid:"change_lid",MaskedThreadCreated:"masked_thread_created",PhoneNumberThreadPromotion:"pnh_thread_promotion",CagMaskedThreadCreated:"cag_masked_thread_created",InfoEncrypted:"info_encrypted",DescAdd:"desc_add",DescRemove:"desc_remove",Fanout:"fanout",BotUnavailableFanout:"bot_unavailable_fanout",HostedUnavailableFanout:"hosted_unavailable_fanout",ViewOnceUnavailableFanout:"view_once_unavailable_fanout",DisappearingMode:"disappearing_mode",DisappearingModeUpdate:"disappearing_mode_update",DisappearingModeUnsupported:"disappearing_mode_unsupported",BlockContact:"block_contact",CommunityCreate:"community_create",EphemeralKeepInChat:"ephemeral_keep_in_chat",KeepInChat:"keep_in_chat",ChatAssignment:"chat_assignment",PeerDataOperationRequestMessage:"peer_data_operation_request_message",ChatAssignmentUnassign:"chat_assignment_unassign",PeerDataOperationRequestResponseMessage:"peer_data_operation_request_response_message",MarketingMessagesFromBusinessStopped:"marketing_messages_from_business_stopped",MarketingMessagesFromBusinessResumed:"marketing_messages_from_business_resumed",NewsletterCreated:"newsletter_created",NewsletterPrivacy:"newsletter_privacy",NewsletterDeleted:"newsletter_deleted",NewsletterAdminContextCard:"newsletter_admin_context_card",PollCreation:"poll_creation",PollUpdate:"poll_update",ContactInfoCard:"contact_info_card",OrderEphemeralExemption:"order_ephemeral_exemption",BotInit:"bot_init",BotTypingPlaceholder:"bot_typing_placeholder",BotInvokeDisclaimer:"bot_invoke_disclaimer",BizBot1PDisclosure:"biz_bot_1p_disclosure",BizBot3PDisclosure:"biz_bot_3p_disclosure",BotSessionTransparencyNotice:"bot_session_transparency_notice",BlueMsgBspFbToBspPremise:"blue_msg_bsp_fb_to_bsp_premise",BlueMsgBspFbToSelfFb:"blue_msg_bsp_fb_to_self_fb",BlueMsgBspFbToSelfPremise:"blue_msg_bsp_fb_to_self_premise",BlueMsgBspFbUnverified:"blue_msg_bsp_fb_unverified",BlueMsgBspFbUnverifiedToBspPremiseVerified:"blue_msg_bsp_fb_unverified_to_bsp_premise_verified",BlueMsgBspFbUnverifiedToSelfFbVerified:"blue_msg_bsp_fb_unverified_to_self_fb_verified",BlueMsgBspFbUnverifiedToSelfPremiseVerified:"blue_msg_bsp_fb_unverified_to_self_premise_verified",BlueMsgBspFbVerified:"blue_msg_bsp_fb_verified",BlueMsgBspFbVerifiedToBspPremiseUnverified:"blue_msg_bsp_fb_verified_to_bsp_premise_unverified",BlueMsgBspFbVerifiedToSelfFbUnverified:"blue_msg_bsp_fb_verified_to_self_fb_unverified",BlueMsgBspFbVerifiedToSelfPremiseUnverified:"blue_msg_bsp_fb_verified_to_self_premise_unverified",BlueMsgBspPremiseToSelfPremise:"blue_msg_bsp_premise_to_self_premise",BlueMsgBspPremiseUnverified:"blue_msg_bsp_premise_unverified",BlueMsgBspPremiseUnverifiedToSelfPremiseVerified:"blue_msg_bsp_premise_unverified_to_self_premise_verified",BlueMsgBspPremiseVerified:"blue_msg_bsp_premise_verified",BlueMsgBspPremiseVerifiedToSelfPremiseUnverified:"blue_msg_bsp_premise_verified_to_self_premise_unverified",BlueMsgConsumerToBspFbUnverified:"blue_msg_consumer_to_bsp_fb_unverified",BlueMsgConsumerToBspPremiseUnverified:"blue_msg_consumer_to_bsp_premise_unverified",BlueMsgConsumerToSelfFbUnverified:"blue_msg_consumer_to_self_fb_unverified",BlueMsgConsumerToSelfPremiseUnverified:"blue_msg_consumer_to_self_premise_unverified",BlueMsgSelfFbToBspPremise:"blue_msg_self_fb_to_bsp_premise",BlueMsgSelfFbToSelfPremise:"blue_msg_self_fb_to_self_premise",BlueMsgSelfFbUnverified:"blue_msg_self_fb_unverified",BlueMsgSelfFbUnverifiedToBspPremiseVerified:"blue_msg_self_fb_unverified_to_bsp_premise_verified",BlueMsgSelfFbUnverifiedToSelfPremiseVerified:"blue_msg_self_fb_unverified_to_self_premise_verified",BlueMsgSelfFbVerified:"blue_msg_self_fb_verified",BlueMsgSelfFbVerifiedToBspPremiseUnverified:"blue_msg_self_fb_verified_to_bsp_premise_unverified",BlueMsgSelfFbVerifiedToSelfPremiseUnverified:"blue_msg_self_fb_verified_to_self_premise_unverified",BlueMsgSelfPremiseToBspPremise:"blue_msg_self_premise_to_bsp_premise",BlueMsgSelfPremiseUnverified:"blue_msg_self_premise_unverified",BlueMsgSelfPremiseVerified:"blue_msg_self_premise_verified",BlueMsgToBspFb:"blue_msg_to_bsp_fb",BlueMsgToConsumer:"blue_msg_to_consumer",BlueMsgToSelfFb:"blue_msg_to_self_fb",BlueMsgUnverifiedToBspFbVerified:"blue_msg_unverified_to_bsp_fb_verified",BlueMsgUnverifiedToBspPremiseVerified:"blue_msg_unverified_to_bsp_premise_verified",BlueMsgUnverifiedToSelfFbVerified:"blue_msg_unverified_to_self_fb_verified",BlueMsgUnverifiedToVerified:"blue_msg_unverified_to_verified",BlueMsgVerifiedToBspFbUnverified:"blue_msg_verified_to_bsp_fb_unverified",BlueMsgVerifiedToBspPremiseUnverified:"blue_msg_verified_to_bsp_premise_unverified",BlueMsgVerifiedToSelfFbUnverified:"blue_msg_verified_to_self_fb_unverified",BlueMsgVerifiedToUnverified:"blue_msg_verified_to_unverified",BizPrivacyModeInitFb:"biz_privacy_mode_init_fb",BizPrivacyModeInitBsp:"biz_privacy_mode_init_bsp",BizPrivacyModeToFb:"biz_privacy_mode_to_fb",BizPrivacyModeToBsp:"biz_privacy_mode_to_bsp",SagaInit:"saga_init",SupportSystemMessage:"support_system_message",BizAccountTypeChangedToHosted:"biz_account_type_changed_to_hosted",BizMeAccountTypeIsHostedSystemMsg:"biz_me_account_type_is_hosted",BizMeAccountTypeIsHostedSystemMsgTransition:"biz_me_account_type_is_hosted_transition",BizAccountTypeIsHostedSystemMsg:"biz_account_type_is_hosted",EventEditDecrypted:"event_edit_decrypted",HostedGroup:"is_capi_hosted_group",LimitSharingSystemMessage:"limit_sharing_system_message",BizAutomaticallyLabeledChatSystemMessage:"biz_automatically_labeled_chat_system_message",GuestUpsell:"guest_upsell",BizPerCustomer3pdDataShareOptIn:"biz_per_customer_3pd_data_share_opt_in",BizPerCustomer3pdDataShareOptOut:"biz_per_customer_3pd_data_share_opt_out",LoadingImage:"loading_image",LoadingVideo:"loading_video",HostedGroupDoNotUseS440891:"is_hosted_group",GroupTransitionToBotGroupSystemMsg:"group_transition_to_bot_group",BizBroadcastProcessing:"biz_broadcast_processing"});i.MsgSubtype=e}),66);
__d("WAWebMediaCryptoEligibilityUtils",["WAWebChatGetters","WAWebMmsMediaTypes","WAWebMsgGetters"],(function(t,n,r,o,a,i,l){var e;function s(e){return!o("WAWebChatGetters").getIsNewsletter(e)}function u(e){return!o("WAWebMsgGetters").getIsNewsletterMsg(e)}var c=new Set([(e=o("WAWebMmsMediaTypes")).MEDIA_TYPES.NEWSLETTER_AUDIO,e.MEDIA_TYPES.NEWSLETTER_DOCUMENT,e.MEDIA_TYPES.NEWSLETTER_GIF,e.MEDIA_TYPES.NEWSLETTER_IMAGE,e.MEDIA_TYPES.NEWSLETTER_PTT,e.MEDIA_TYPES.NEWSLETTER_PTV,e.MEDIA_TYPES.NEWSLETTER_STICKER,e.MEDIA_TYPES.NEWSLETTER_THUMBNAIL_LINK,e.MEDIA_TYPES.NEWSLETTER_VIDEO,e.MEDIA_TYPES.NEWSLETTER_STICKER_PACK,e.MEDIA_TYPES.NEWSLETTER_MUSIC_ARTWORK]);function d(e){return c.has(e)}function m(e){return!d(e)}function p(e){return!d(e)}l.isMediaCryptoExpectedForChat=s,l.isMediaCryptoExpectedForMsg=u,l.isMediaCryptoExpectedForMediaType=m,l.isRmrSupportedForMediaType=p}),98);
__d("WAWebE2EProtoParserApi",["WABase64","WALogger","WAWebGroupType","WAWebMediaCryptoEligibilityUtils","WAWebProtobufsE2E.pb","WAWebWid","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m;function p(e){return e===o("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.PARENT?o("WAWebGroupType").GroupType.COMMUNITY:e===o("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.SUB?o("WAWebGroupType").GroupType.LINKED_SUBGROUP:e===o("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.DEFAULT_SUB?o("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP:e===o("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.DEFAULT?o("WAWebGroupType").GroupType.DEFAULT:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function _(e){return e!=null&&!e.includes("/u/")?e:void 0}function f(e){return e?o("WABase64").encodeB64(e):void 0}function g(t,n){if(h(t,n)){var r=t.type;if(!o("WAWebMediaCryptoEligibilityUtils").isMediaCryptoExpectedForMsg(t)){n.directPath==null&&o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["directPath missing from msg type ",""])),r).sendLogs(r+"-unencrypted-message-missing-direct-path");return}n.directPath==null&&n.fileEncSha256==null?o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["directPath and fileEncSha256 missing from msg type ",""])),r).sendLogs(r+"-message-missing-direct-path-and-file-enc"):n.directPath==null?o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["directPath missing from msg type ",""])),r).sendLogs(r+"-message-missing-direct-path"):n.fileEncSha256==null&&o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["fileEncSha256 missing from msg type ",""])),r).sendLogs(r+"-message-missing-file-enc"),n.url==null&&o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["url(deprecatedMms3Url) is missing from msg type ",""])),r).sendLogs(r+"-message-missing-mms3-url"),n.mediaKey==null&&o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["mediaKey is missing from msg type ",""])),r).sendLogs(r+"-message-missing-media-key")}}function h(e,t){var n;return!(r("gkx")("26258")&&Math.random()>.001||!e.id||((n=e.id.remote)==null?void 0:n.user)==="status"&&r("WAWebWid").isPSA(e.author)&&t.staticUrl==null)}l.parseInviteGrpType=p,l.decodeUrl=_,l.decodeBytes=f,l.validateRequiredMediaProperties=g,l.shouldLogE2eProtoValidation=h}),98);
__d("WAWebEphemeralKeepInChat",["WANullthrows","WAWebEphemeralKeepInChatUtils","WAWebMsgKey","WAWebWidFactory","err"],(function(t,n,r,o,a,i,l){function e(e){var t=e.keepInChat;if(t!=null&&t.key!=null){var n=t.key,a=n.fromMe,i=n.id,l=n.participant,s=n.remoteJid,u=t.keepType,c=t.serverTimestampMs;if(i==null||u==null||c==null||s==null)throw r("err")("parseKeepInChatHistorySyncMessage: malformed KIC WebMessageInfo");var d=o("WAWebEphemeralKeepInChatUtils").parseKeepTypeToKicState(u);if(d==null)throw r("err")("parseKeepInChatHistorySyncMessage: KeepType has unsupported value");return{kicKey:new(r("WAWebMsgKey"))({fromMe:r("WANullthrows")(a),id:r("WANullthrows")(i),remote:r("WANullthrows")(o("WAWebWidFactory").createWidFromWidLike(s)),participant:l!=null?o("WAWebWidFactory").createWidFromWidLike(l):void 0}),kicState:d,kicTimestampMs:parseInt(c,10)}}}l.parseKeepInChatHistorySyncMessage=e}),98);
__d("WAWebParseWebMessageInfoApi",["WAJids","WALogger","WANullthrows","WATimeUtils","WAWebABProps","WAWebABPropsSaga","WAWebBizCoexGatingUtils","WAWebBotGroupGatingUtils","WAWebBotTypes","WAWebCommonMsgSubtypeTypes","WAWebE2EProtoParser","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebEphemeralKeepInChat","WAWebGroupHistoryProtoUtils","WAWebLimitSharingProtoUtils","WAWebMessagingGatingUtils","WAWebMsgKey","WAWebMsgType","WAWebProcessBaseMsgInfo","WAWebProtobufsWeb.pb","WAWebReportingTokenUtils","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWid","WAWebWidFactory","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(e){return e.originalSelfAuthorUserJidString==null?o("WAWebUserPrefsMeUser").getMaybeMePnUser():o("WAWebE2EProtoUtils").decodeJid(e.originalSelfAuthorUserJidString)}function m(t,n){var a=o("WAWebE2EProtoUtils").decodeJidAndValidate(n.remoteJid,"remoteJid"),i=o("WAWebE2EProtoUtils").decodeJidAndValidate(n.participant,"participant"),l=d(t),s=o("WAWebE2EProtoUtils").decodeJidAndValidate(t.participant,"participant");i==null&&a!=null&&r("WAWebWid").isWid(a)&&a===o("WAWebWidFactory").createWid(o("WAJids").PSA_JID)&&(i=o("WAWebWidFactory").createWid(o("WAJids").PSA_JID)),(r("WAWebWid").isGroup(a)||r("WAWebWid").isStatus(a))&&(i==null&&(n.fromMe===!0?i=l:t.participant!=null&&(i=o("WAWebE2EProtoUtils").decodeJid(t.participant))),s=s!=null?s:i);try{var u=new(r("WAWebMsgKey"))({fromMe:r("WANullthrows")(n.fromMe),remote:a,id:r("WANullthrows")(n.id),participant:i});return{msgKey:u,author:s}}catch(t){var c=r("getErrorSafe")(t);o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["drop: cannot create MsgKey: ",", ",""])),c.message,c.stack).sendLogs("history-sync-message-drop-cannot-create-msgkey",{sampling:.01});return}}function p(e){var t,n,a,i,l,c,p=e.key,f=o("WAWebE2EProtoUtils").decodeJidAndValidate(p.remoteJid,"remoteJid"),g=d(e),h=p.fromMe===!0?f:g,y=p.fromMe===!0?g:f,C=m(e,p);if(C!=null){var b=C.author,v=C.msgKey;if(h==="broadcast"){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["drop: broadcast"])));return}var S=!1;S=e.reactions.some(function(e){return e.text!=null});var R={id:v,from:y,to:h,participant:v.participant,type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,kind:o("WAWebMsgType").MsgKind.Unknown,t:(t=e.messageTimestamp)!=null?t:0,ack:e.status-1,author:b,invis:!!e.ignore,star:!!e.starred,broadcast:p.fromMe===!0&&e.broadcast,notifyName:e.pushName||"",encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(e.mediaCiphertextSha256),shareDuration:e.duration,labels:e.labels,ephemeralStartTimestamp:e.ephemeralStartTimestamp,ephemeralOutOfSync:e.ephemeralOutOfSync,bizPrivacyStatus:e.bizPrivacyStatus,verifiedBizName:e.verifiedBizName,reactions:e.reactions,hasReaction:S,agentId:e.agentId,revokeTimestamp:e.revokeMessageTimestamp,kicKey:void 0,kicState:void 0,pollInvalidated:((n=e.pollAdditionalMetadata)==null?void 0:n.pollInvalidated)===!0,eventInvalidated:((a=e.eventAdditionalMetadata)==null?void 0:a.isStale)===!0,replyCount:(i=e.commentMetadata)==null?void 0:i.replyCount,originalSelfAuthor:o("WAWebE2EProtoUtils").decodeJidAndValidate(e.originalSelfAuthorUserJidString,"originalSelfAuthorUserJidString"),kicTimestampMs:void 0,pinInChat:e.pinInChat,pmCampaignId:(l=e.premiumMessageInfo)==null?void 0:l.serverCampaignId,galaxyFlowDisabled:e.interactiveMessageAdditionalMetadata!=null?e.interactiveMessageAdditionalMetadata.isGalaxyFlowCompleted===!0:void 0,bizSource:((c=e.premiumMessageInfo)==null?void 0:c.serverCampaignId)!=null?"smb_promo":void 0,bizBotType:e.is1PBizBotMessage===!0?o("WAWebBotTypes").BizBotType.BIZ_1P:null,botTargetSenderJid:e.botMessageInvokerJid!=null?o("WAWebE2EProtoUtils").decodeJidAndValidate(e.botMessageInvokerJid,"botMessageInvokerJid"):null,groupHistoryBundleInfo:e.groupHistoryBundleInfo};if(r("WAWebWid").isCAPISupportAccount(v.remote)&&(e.isSupportAiMessage!=null&&o("WAWebABPropsSaga").getIsSagaProtobufAIStardustEnabled()&&(R.isSupportAIMessage=e.isSupportAiMessage),e.supportAiCitations!=null&&e.supportAiCitations.length>0&&(R.supportCitations=e.supportAiCitations)),o("WAWebMessagingGatingUtils").isReportingTagSyncingEnabled()){var L;R.reportingTokenInfo=e.reportingTokenInfo!=null?{reportingTag:(L=e.reportingTokenInfo)==null?void 0:L.reportingTag,version:o("WAWebReportingTokenUtils").REPORTING_TOKEN_VERSION.HISTORY_SYNC}:null}if(e.keepInChat!=null)try{var E=o("WAWebEphemeralKeepInChat").parseKeepInChatHistorySyncMessage(e);E!=null&&Object.assign(R,E)}catch(e){o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["parseWebMessageInfo: KIC fields are malformed"])))}var k=o("WAWebGroupHistoryProtoUtils").getGroupHistoryIndividualMessageInfoMetadataFromProto(e.groupHistoryIndividualMessageInfo);return k!=null&&(R.groupHistoryIndividualMessageInfo=k),e.message?o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:e.message,message:R,msgContext:"history",paymentInfo:e.paymentInfo,finalLocation:e.finalLiveLocation,quotedPaymentInfo:e.quotedPaymentInfo,bizSource:R.bizSource}):(o("WAWebLimitSharingProtoUtils").parseLimitSharingFromProtocolHistorySyncMessage(e,R),_(e,R))}}function _(e,t){if(e.messageStubType!=null){var n=o("WAWebProtobufsWeb.pb").WebMessageInfo$StubType,r;e:{if(e.messageStubType===n.REVOKE){t.type="revoked",t.subtype="sender",t.kind=o("WAWebMsgType").MsgKind.RevokedMessage;var a=e.messageStubParameters,i=a!=null&&a.length>0?a[0]:null;if(i!=null){var l;t.protocolMessageKey=(l=m(e,babelHelpers.extends({},e.key,{id:i})))==null?void 0:l.msgKey}r=t;break e}if(e.messageStubType===n.CIPHERTEXT){t.type="ciphertext",t.kind=o("WAWebMsgType").MsgKind.Ciphertext,r=t;break e}if(e.messageStubType===n.OVERSIZED){t.type="oversized",t.kind=o("WAWebMsgType").MsgKind.Oversized,r=t;break e}if(e.messageStubType===n.FUTUREPROOF){t.kind=o("WAWebMsgType").MsgKind.Unknown,t.subtype="phone",r=t;break e}if(e.messageStubType===n.CAPI_GROUP_NE2EE_SYSTEM_MESSAGE){t.type="notification_template",t.subtype="is_capi_hosted_group",r=t;break e}if(e.messageStubType===n.QUARANTINED_MESSAGE){var s,u;t.type=o("WAWebMsgType").MSG_TYPE.QUARANTINED,t.kind=o("WAWebMsgType").MsgKind.QuarantinedMessage,t.quarantineOriginalProtobuf=(s=e.quarantinedMessage)==null?void 0:s.originalData,t.quarantineExtractedText=(u=e.quarantinedMessage)==null?void 0:u.extractedText,r=t;break e}{r=f(e,t);break e}}return r}}function f(e,t){var n,a,i;if(e.messageStubType!=null){var l=o("WAWebProtobufsWeb.pb").WebMessageInfo$StubType;if(t.type="notification_template",t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.templateParams=Array.isArray(e.messageStubParameters)?e.messageStubParameters.map(function(t){return e.messageStubType===l.GROUP_CREATE||e.messageStubType===l.GROUP_CHANGE_SUBJECT?t:o("WAWebE2EProtoUtils").decodeJid(t)}):void 0,e.messageStubType==null)return t.templateParams=void 0,t;switch(e.messageStubType){case l.NON_VERIFIED_TRANSITION:t.subtype="non_verified_transition";break;case l.UNVERIFIED_TRANSITION:t.subtype="unverified_transition";break;case l.VERIFIED_TRANSITION:t.subtype="verified_transition";break;case l.VERIFIED_LOW_UNKNOWN:t.subtype="verified_low_unknown";break;case l.VERIFIED_HIGH:t.subtype="verified_high";break;case l.VERIFIED_INITIAL_UNKNOWN:t.subtype="verified_initial_unknown";break;case l.VERIFIED_INITIAL_LOW:t.subtype="verified_initial_low";break;case l.VERIFIED_INITIAL_HIGH:t.subtype="verified_initial_high";break;case l.VERIFIED_TRANSITION_ANY_TO_NONE:t.subtype="verified_transition_any_to_none";break;case l.VERIFIED_TRANSITION_ANY_TO_HIGH:t.subtype="verified_transition_any_to_high";break;case l.VERIFIED_TRANSITION_HIGH_TO_LOW:t.subtype="verified_transition_high_to_low";break;case l.VERIFIED_TRANSITION_HIGH_TO_UNKNOWN:t.subtype="verified_transition_high_to_unknown";break;case l.VERIFIED_TRANSITION_UNKNOWN_TO_LOW:t.subtype="verified_transition_unknown_to_low";break;case l.VERIFIED_TRANSITION_LOW_TO_UNKNOWN:t.subtype="verified_transition_low_to_unknown";break;case l.VERIFIED_TRANSITION_NONE_TO_LOW:t.subtype="verified_transition_none_to_low";break;case l.VERIFIED_TRANSITION_NONE_TO_UNKNOWN:t.subtype="verified_transition_none_to_unknown";break;case l.GROUP_CREATE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="create",t.body=t.templateParams[0],t.templateParams=void 0;break;case l.REPORT_TO_ADMIN_ENABLED_STATUS:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="allow_admin_reports";break;case l.GROUP_DELETE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="delete",t.templateParams=void 0;break;case l.GROUP_CHANGE_SUBJECT:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="subject",t.body=t.templateParams[0],t.templateParams=void 0;break;case l.GROUP_CHANGE_ICON:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="picture",t.body=t.templateParams[0],t.templateParams=void 0;break;case l.GROUP_CHANGE_INVITE_LINK:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="revoke_invite";break;case l.GROUP_CHANGE_DESCRIPTION:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="description",t.body=t.templateParams[0];break;case l.GROUP_CHANGE_RESTRICT:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="restrict",t.body=t.templateParams[0];break;case l.GROUP_CHANGE_ANNOUNCE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="announce",t.body=t.templateParams[0];break;case l.GROUP_CHANGE_NO_FREQUENTLY_FORWARDED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="no_frequently_forwarded",t.body=t.templateParams[0];break;case l.GROUP_ANNOUNCE_MODE_MESSAGE_BOUNCE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="announce_msg_bounce",t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_ADD:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="add",t.recipients=t.templateParams,t.templateParams=void 0,Array.isArray(t.recipients)&&t.recipients.length===1&&t.author===t.recipients[0]&&(t.author=void 0);break;case l.GROUP_PARTICIPANT_REMOVE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="remove",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_PROMOTE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="promote",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_DEMOTE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="demote",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_INVITE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="invite",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_LEAVE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="leave",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_CHANGE_NUMBER:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="modify",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_V4_ADD_INVITE_SENT:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="v4_add_invite_sent",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_ADD_REQUEST_JOIN:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="v4_add_invite_join",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GROUP_INVITE_LINK_GROWTH_LOCKED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype=t.templateParams[0]==="true"?"growth_locked":"growth_unlocked",t.body="invite",t.templateParams=void 0;break;case l.GROUP_PARTICIPANT_LINKED_GROUP_JOIN:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="linked_group_join",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.BROADCAST_CREATE:t.type="broadcast_notification",t.kind=o("WAWebMsgType").MsgKind.BroadcastNotification,t.subtype="create",t.body=(n=t.templateParams[0])!=null?n:"0",t.templateParams=void 0;break;case l.BROADCAST_ADD:t.type="broadcast_notification",t.kind=o("WAWebMsgType").MsgKind.BroadcastNotification,t.subtype="add",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.BROADCAST_REMOVE:t.type="broadcast_notification",t.kind=o("WAWebMsgType").MsgKind.BroadcastNotification,t.subtype="remove",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.GENERIC_NOTIFICATION:t.type="notification",t.kind=o("WAWebMsgType").MsgKind.Notification,t.body=t.templateParams[0],t.templateParams=void 0;break;case l.E2E_IDENTITY_CHANGED:t.type="e2e_notification",t.kind=o("WAWebMsgType").MsgKind.E2eNotification,t.subtype="identity",t.body=t.templateParams[0]instanceof r("WAWebWid")?t.templateParams[0].toString():t.templateParams[0],t.templateParams=void 0;break;case l.E2E_IDENTITY_UNAVAILABLE:t.type="e2e_notification",t.kind=o("WAWebMsgType").MsgKind.E2eNotification,t.subtype="e2e_identity_unavailable";break;case l.CHAT_PSA:t.type="e2e_notification",t.kind=o("WAWebMsgType").MsgKind.E2eNotification,t.subtype="chat_psa";break;case l.E2E_DEVICE_CHANGED:t.type="e2e_notification",t.kind=o("WAWebMsgType").MsgKind.E2eNotification,t.subtype="device",t.body=t.templateParams[0]instanceof r("WAWebWid")?t.templateParams[0].toString():t.templateParams[0],t.devicesAdded=parseInt(t.templateParams[1],10),t.devicesRemoved=parseInt(t.templateParams[2],10),t.templateParams=void 0;break;case l.E2E_ENCRYPTED:t.type="e2e_notification",t.kind=o("WAWebMsgType").MsgKind.E2eNotification,t.subtype="encrypt";break;case l.E2E_ENCRYPTED_NOW:t.type="e2e_notification",t.kind=o("WAWebMsgType").MsgKind.E2eNotification,t.subtype="encrypt_now";break;case l.CALL_MISSED_VOICE:t.type="call_log",t.kind=o("WAWebMsgType").MsgKind.CallLog,t.subtype="miss";break;case l.CALL_MISSED_VIDEO:t.type="call_log",t.kind=o("WAWebMsgType").MsgKind.CallLog,t.subtype="miss_video";break;case l.CALL_MISSED_GROUP_VOICE:t.type="call_log",t.kind=o("WAWebMsgType").MsgKind.CallLog,t.subtype="miss_group";break;case l.CALL_MISSED_GROUP_VIDEO:t.type="call_log",t.kind=o("WAWebMsgType").MsgKind.CallLog,t.subtype="miss_group_video";break;case l.SILENCED_UNKNOWN_CALLER_AUDIO:case l.SILENCED_UNKNOWN_CALLER_VIDEO:t.type="call_log",t.kind=o("WAWebMsgType").MsgKind.CallLog,t.subtype="silence";break;case l.INDIVIDUAL_CHANGE_NUMBER:t.subtype="change_number";break;case l.SENDER_INVITE:t.subtype="sender_invite";break;case l.RECEIVER_INVITE:t.subtype="receiver_invite";break;case l.MASKED_THREAD_CREATED:t.subtype="masked_thread_created";break;case l.CAG_MASKED_THREAD_CREATED:t.subtype="cag_masked_thread_created";break;case l.CHANGE_EPHEMERAL_SETTING:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="ephemeral",t.author=t.templateParams[1];break;case l.PAYMENT_CIPHERTEXT:if(t.type="payment",t.kind=o("WAWebMsgType").MsgKind.Payment,t.subtype="ciphertext",e.paymentInfo!=null){var s=o("WAWebE2EProtoUtils").parseMsgPaymentInfo(e.paymentInfo);t.paymentStatus=s.paymentStatus,t.paymentTxnStatus=s.paymentTxnStatus,t.paymentCurrency=s.paymentCurrency,t.paymentAmount1000=s.paymentAmount1000,t.paymentMessageReceiverJid=s.paymentMessageReceiverJid,t.paymentExpiryTimestamp=s.paymentExpiryTimestamp,t.paymentTransactionTimestamp=s.paymentTransactionTimestamp}break;case l.PAYMENT_FUTUREPROOF:if(t.type="payment",t.kind=o("WAWebMsgType").MsgKind.Payment,t.subtype="futureproof",e.paymentInfo!=null){var u=o("WAWebE2EProtoUtils").parseMsgPaymentInfo(e.paymentInfo);t.paymentStatus=u.paymentStatus,t.paymentTxnStatus=u.paymentTxnStatus,t.paymentCurrency=u.paymentCurrency,t.paymentAmount1000=u.paymentAmount1000,t.paymentMessageReceiverJid=u.paymentMessageReceiverJid,t.paymentExpiryTimestamp=u.paymentExpiryTimestamp,t.paymentTransactionTimestamp=u.paymentTransactionTimestamp}break;case l.PAYMENT_ACTION_REQUEST_CANCELLED:t.subtype="payment_transaction_request_cancelled";break;case l.PAYMENT_TRANSACTION_STATUS_UPDATE_FAILED:t.subtype="payment_transaction_status_update_failed";break;case l.PAYMENT_TRANSACTION_STATUS_UPDATE_REFUNDED:t.subtype="payment_transaction_status_update_refunded";break;case l.PAYMENT_TRANSACTION_STATUS_UPDATE_REFUND_FAILED:t.subtype="payment_transaction_status_update_refund_failed";break;case l.PAYMENT_TRANSACTION_STATUS_RECEIVER_PENDING_SETUP:t.subtype="payment_transaction_status_receiver_pending_setup";break;case l.PAYMENT_TRANSACTION_STATUS_RECEIVER_SUCCESS_AFTER_HICCUP:t.subtype="payment_transaction_status_receiver_success_after_hiccup";break;case l.PAYMENT_ACTION_ACCOUNT_SETUP_REMINDER:t.subtype="payment_action_account_setup_reminder";break;case l.PAYMENT_ACTION_SEND_PAYMENT_REMINDER:t.subtype="payment_action_send_payment_reminder";break;case l.PAYMENT_ACTION_SEND_PAYMENT_INVITATION:t.subtype="payment_action_send_payment_invitation";break;case l.PAYMENT_ACTION_REQUEST_DECLINED:t.subtype="payment_action_request_declined";break;case l.PAYMENT_ACTION_REQUEST_EXPIRED:t.subtype="payment_action_request_expired";break;case l.BIZ_VERIFIED_TRANSITION_TOP_TO_BOTTOM:t.subtype="biz_verified_transition_top_to_bottom";break;case l.BIZ_VERIFIED_TRANSITION_BOTTOM_TO_TOP:t.subtype="biz_verified_transition_bottom_to_top";break;case l.BIZ_INTRO_TOP:t.subtype="biz_intro_top";break;case l.BIZ_INTRO_BOTTOM:t.subtype="biz_intro_bottom";break;case l.BIZ_NAME_CHANGE:t.subtype="biz_name_change";break;case l.BIZ_MOVE_TO_CONSUMER_APP:t.subtype="biz_move_to_consumer_app";break;case l.BIZ_TWO_TIER_MIGRATION_TOP:t.subtype="biz_two_tier_migration_top";break;case l.BIZ_TWO_TIER_MIGRATION_BOTTOM:t.subtype="biz_two_tier_migration_bottom";break;case l.BLUE_MSG_BSP_FB_TO_BSP_PREMISE:t.subtype="blue_msg_bsp_fb_to_bsp_premise";break;case l.BLUE_MSG_BSP_FB_TO_SELF_FB:t.subtype="blue_msg_bsp_fb_to_self_fb";break;case l.BLUE_MSG_BSP_FB_TO_SELF_PREMISE:t.subtype="blue_msg_bsp_fb_to_self_premise";break;case l.BLUE_MSG_BSP_FB_UNVERIFIED:t.subtype="blue_msg_bsp_fb_unverified";break;case l.BLUE_MSG_BSP_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:t.subtype="blue_msg_bsp_fb_unverified_to_bsp_premise_verified";break;case l.BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_FB_VERIFIED:t.subtype="blue_msg_bsp_fb_unverified_to_self_fb_verified";break;case l.BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:t.subtype="blue_msg_bsp_fb_unverified_to_self_premise_verified";break;case l.BLUE_MSG_BSP_FB_VERIFIED:t.subtype="blue_msg_bsp_fb_verified";break;case l.BLUE_MSG_BSP_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:t.subtype="blue_msg_bsp_fb_verified_to_bsp_premise_unverified";break;case l.BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_FB_UNVERIFIED:t.subtype="blue_msg_bsp_fb_verified_to_self_fb_unverified";break;case l.BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:t.subtype="blue_msg_bsp_fb_verified_to_self_premise_unverified";break;case l.BLUE_MSG_BSP_PREMISE_TO_SELF_PREMISE:t.subtype="blue_msg_bsp_premise_to_self_premise";break;case l.BLUE_MSG_BSP_PREMISE_UNVERIFIED:t.subtype="blue_msg_bsp_premise_unverified";break;case l.BLUE_MSG_BSP_PREMISE_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:t.subtype="blue_msg_bsp_premise_unverified_to_self_premise_verified";break;case l.BLUE_MSG_BSP_PREMISE_VERIFIED:t.subtype="blue_msg_bsp_premise_verified";break;case l.BLUE_MSG_BSP_PREMISE_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:t.subtype="blue_msg_bsp_premise_verified_to_self_premise_unverified";break;case l.BLUE_MSG_CONSUMER_TO_BSP_FB_UNVERIFIED:t.subtype="blue_msg_consumer_to_bsp_fb_unverified";break;case l.BLUE_MSG_CONSUMER_TO_BSP_PREMISE_UNVERIFIED:t.subtype="blue_msg_consumer_to_bsp_premise_unverified";break;case l.BLUE_MSG_CONSUMER_TO_SELF_FB_UNVERIFIED:t.subtype="blue_msg_consumer_to_self_fb_unverified";break;case l.BLUE_MSG_CONSUMER_TO_SELF_PREMISE_UNVERIFIED:t.subtype="blue_msg_consumer_to_self_premise_unverified";break;case l.BLUE_MSG_SELF_FB_TO_BSP_PREMISE:t.subtype="blue_msg_self_fb_to_bsp_premise";break;case l.BLUE_MSG_SELF_FB_TO_SELF_PREMISE:t.subtype="blue_msg_self_fb_to_self_premise";break;case l.BLUE_MSG_SELF_FB_UNVERIFIED:t.subtype="blue_msg_self_fb_unverified";break;case l.BLUE_MSG_SELF_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:t.subtype="blue_msg_self_fb_unverified_to_bsp_premise_verified";break;case l.BLUE_MSG_SELF_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:t.subtype="blue_msg_self_fb_unverified_to_self_premise_verified";break;case l.BLUE_MSG_SELF_FB_VERIFIED:t.subtype="blue_msg_self_fb_verified";break;case l.BLUE_MSG_SELF_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:t.subtype="blue_msg_self_fb_verified_to_bsp_premise_unverified";break;case l.BLUE_MSG_SELF_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:t.subtype="blue_msg_self_fb_verified_to_self_premise_unverified";break;case l.BLUE_MSG_SELF_PREMISE_TO_BSP_PREMISE:t.subtype="blue_msg_self_premise_to_bsp_premise";break;case l.BLUE_MSG_SELF_PREMISE_UNVERIFIED:t.subtype="blue_msg_self_premise_unverified";break;case l.BLUE_MSG_SELF_PREMISE_VERIFIED:t.subtype="blue_msg_self_premise_verified";break;case l.BLUE_MSG_TO_BSP_FB:t.subtype="blue_msg_to_bsp_fb";break;case l.BLUE_MSG_TO_CONSUMER:t.subtype="blue_msg_to_consumer";break;case l.BLUE_MSG_TO_SELF_FB:t.subtype="blue_msg_to_self_fb";break;case l.BLUE_MSG_UNVERIFIED_TO_BSP_FB_VERIFIED:t.subtype="blue_msg_unverified_to_bsp_fb_verified";break;case l.BLUE_MSG_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:t.subtype="blue_msg_unverified_to_bsp_premise_verified";break;case l.BLUE_MSG_UNVERIFIED_TO_SELF_FB_VERIFIED:t.subtype="blue_msg_unverified_to_self_fb_verified";break;case l.BLUE_MSG_UNVERIFIED_TO_VERIFIED:t.subtype="blue_msg_unverified_to_verified";break;case l.BLUE_MSG_VERIFIED_TO_BSP_FB_UNVERIFIED:t.subtype="blue_msg_verified_to_bsp_fb_unverified";break;case l.BLUE_MSG_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:t.subtype="blue_msg_verified_to_bsp_premise_unverified";break;case l.BLUE_MSG_VERIFIED_TO_SELF_FB_UNVERIFIED:t.subtype="blue_msg_verified_to_self_fb_unverified";break;case l.BLUE_MSG_VERIFIED_TO_UNVERIFIED:t.subtype="blue_msg_verified_to_unverified";break;case l.BIZ_PRIVACY_MODE_INIT_FB:t.subtype="biz_privacy_mode_init_fb",(a=t.id)!=null&&(a=a.remote)!=null&&a.isBot()&&(t.subtype="bot_init");break;case l.BIZ_PRIVACY_MODE_INIT_BSP:t.subtype="biz_privacy_mode_init_bsp";break;case l.BIZ_PRIVACY_MODE_TO_FB:t.subtype="biz_privacy_mode_to_fb",(i=t.id)!=null&&(i=i.remote)!=null&&i.isBot()&&(t.subtype="bot_init");break;case l.BIZ_PRIVACY_MODE_TO_BSP:t.subtype="biz_privacy_mode_to_bsp";break;case l.DISAPPEARING_MODE:t.subtype="disappearing_mode";break;case l.BLOCK_CONTACT:t.subtype="block_contact";break;case l.ADMIN_REVOKE:{var d;t.type="revoked",t.subtype="admin",t.kind=o("WAWebMsgType").MsgKind.RevokedMessage,t.revokeSender=t.templateParams[1]instanceof r("WAWebWid")?t.templateParams[1]:void 0,t.revokeSender||o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["ProtocolParser: admin revoke came without admin JID"])));var p=t.templateParams[0];t.protocolMessageKey=(d=m(e,{remoteJid:e.key.remoteJid,fromMe:o("WAWebUserPrefsMeUser").isMeAccount(t.from),id:p,participant:e.key.participant}))==null?void 0:d.msgKey,t.templateParams=void 0;break}case l.COMMUNITY_LINK_PARENT_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="parent_group_link";break;case l.COMMUNITY_LINK_SIBLING_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="sibling_group_link";break;case l.COMMUNITY_LINK_SUB_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="sub_group_link";break;case l.COMMUNITY_CREATE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_create";break;case l.COMMUNITY_UNLINK_PARENT_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="parent_group_unlink";break;case l.INTEGRITY_UNLINK_PARENT_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="integrity_parent_group_unlink";break;case l.COMMUNITY_UNLINK_SIBLING_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="sibling_group_unlink";break;case l.COMMUNITY_UNLINK_SUB_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="sub_group_unlink";break;case l.COMMUNITY_PARTICIPANT_PROMOTE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="linked_group_promote",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.COMMUNITY_PARTICIPANT_DEMOTE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="linked_group_demote",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.EPHEMERAL_KEEP_IN_CHAT:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="ephemeral_keep_in_chat";break;case l.GROUP_MEMBERSHIP_JOIN_APPROVAL_MODE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="membership_approval_mode";break;case l.GROUP_MEMBER_ADD_MODE:{t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="member_add_mode";break}case l.GROUP_MEMBERSHIP_JOIN_APPROVAL_REQUEST_NON_ADMIN_ADD:{t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.recipients=t.templateParams,t.subtype="created_membership_requests";break}case l.GROUP_MEMBERSHIP_JOIN_APPROVAL_REQUEST:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="membership_approval_request";break;case l.GROUP_PARTICIPANT_JOINED_GROUP_AND_PARENT_GROUP:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="auto_add";break;case l.COMMUNITY_PARENT_GROUP_DELETED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="delete_parent_group";break;case l.BIZ_CHAT_ASSIGNMENT:t.subtype="chat_assignment";break;case l.BIZ_CHAT_ASSIGNMENT_UNASSIGN:t.subtype="chat_assignment_unassign";break;case l.COMMUNITY_PARENT_GROUP_SUBJECT_CHANGED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="subject",t.body=t.templateParams[1];break;case l.CAG_INVITE_AUTO_ADD:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="invite_auto_add",t.recipients=[o("WAWebUserPrefsMeUser").getMaybeMePnUser()];break;case l.CAG_INVITE_AUTO_JOINED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="invite_auto_add",t.recipients=t.templateParams,t.templateParams=void 0;break;case l.COMMUNITY_PARTICIPANT_ADD_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_participant_add_rich";break;case l.SUB_GROUP_PARTICIPANT_ADD_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="sub_group_participant_add_rich";break;case l.SUB_GROUP_INVITE_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="sub_group_invite_rich",t.author=void 0;break;case l.COMMUNITY_INVITE_AUTO_ADD_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_invite_auto_add_rich",t.author=void 0;break;case l.COMMUNITY_INVITE_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_invite_rich",t.author=void 0;break;case l.COMMUNITY_LINK_PARENT_GROUP_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_link_parent_group_rich";break;case l.COMMUNITY_CHANGE_DESCRIPTION:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="parent_group_description",t.body=t.templateParams[0];break;case l.PINNED_MESSAGE_IN_CHAT:{t.type="pinned_message",t.kind=o("WAWebMsgType").MsgKind.PinnedMessage;break}case l.COMMUNITY_ALLOW_MEMBER_ADDED_GROUPS:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="allow_non_admin_sub_group_creation";break;case l.EMPTY_SUBGROUP_CREATE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="empty_subgroup_create";break;case l.SUGGESTED_SUBGROUP_ANNOUNCE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="created_subgroup_suggestion";break;case l.SUBGROUP_ADMIN_TRIGGERED_AUTO_ADD_RICH:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="subgroup_admin_triggered_auto_add";break;case l.GENERAL_CHAT_ADD:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="general_chat_add";break;case l.GENERAL_CHAT_AUTO_ADD_DISABLED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="general_chat_auto_add_disabled";break;case l.BIZ_BOT_1P_MESSAGING_ENABLED:t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="biz_bot_1p_disclosure";break;case l.BIZ_BOT_3P_MESSAGING_ENABLED:t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="biz_bot_3p_disclosure";break;case l.CHANGE_USERNAME:t.subtype="change_username";break;case l.BIZ_COEX_PRIVACY_INIT_SELF:if(!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){t.templateParams=void 0;break}t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="biz_me_account_type_is_hosted";break;case l.BIZ_COEX_PRIVACY_TRANSITION_SELF:if(!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){t.templateParams=void 0;break}t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="biz_me_account_type_is_hosted_transition";break;case l.BIZ_COEX_PRIVACY_INIT:if(!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){t.templateParams=void 0;break}t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="biz_account_type_is_hosted";break;case l.BIZ_COEX_PRIVACY_TRANSITION:if(!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){t.templateParams=void 0;break}t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="biz_account_type_changed_to_hosted";break;case l.SUPPORT_AI_EDUCATION:t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate,t.subtype="saga_init";break;case l.EVENT_CANCELED:case l.EVENT_UPDATED:{var _,f=babelHelpers.extends({},o("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(t),{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,subtype:"event_edit_decrypted",kind:o("WAWebMsgType").MsgKind.ProtocolEventEdit,eventName:t.templateParams[0],eventStartTime:o("WATimeUtils").unixTime(),isEventCanceled:e.messageStubType===l.EVENT_CANCELED,protocolMessageKey:r("WANullthrows")((_=m(e,r("WANullthrows")(e.targetMessageId)))==null?void 0:_.msgKey,"Error: buildMsgKey or targetMessageId is null or missing for event edit system message history sync parsing"),editMsgType:o("WAWebMsgType").MSG_TYPE.EVENT_CREATION,latestEditMsgKey:void 0,latestEditSenderTimestampMs:void 0});return f}case l.COMMUNITY_OWNER_UPDATED:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_owner_update";break;case l.COMMUNITY_SUB_GROUP_VISIBILITY_HIDDEN:t.templateParams[0]==="on"&&(t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype="community_hidden_group");break;case l.SUPPORT_SYSTEM_MESSAGE:o("WAWebABProps").getABPropConfigValue("support_use_dedicated_system_event")?t.subtype="support_system_message":t.subtype="biz_privacy_mode_init_fb";break;case l.BIZ_AUTOMATICALLY_LABELED_CHAT_SYSTEM_MESSAGE:t.subtype="biz_automatically_labeled_chat_system_message",t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate;break;case l.GROUP_OPEN_BOT_ADDED:if(o("WAWebBotGroupGatingUtils").isOpenGroupBotParticipantAddEnabled()){t.subtype="group_transition_to_bot_group",t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate;break}else{t.templateParams=void 0;break}case l.BIZ_CUSTOMER_3PD_DATA_SHARING_OPT_IN_MESSAGE:t.subtype="biz_per_customer_3pd_data_share_opt_in",t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate;break;case l.BIZ_CUSTOMER_3PD_DATA_SHARING_OPT_OUT_MESSAGE:t.subtype="biz_per_customer_3pd_data_share_opt_out",t.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,t.kind=o("WAWebMsgType").MsgKind.NotificationTemplate;break;case l.GROUP_MEMBER_SHARE_GROUP_HISTORY_MODE:t.type="gp2",t.kind=o("WAWebMsgType").MsgKind.Gp2,t.subtype=o("WAWebCommonMsgSubtypeTypes").MsgSubtype.MemberShareGroupHistoryMode;break;default:t.templateParams=void 0;break}return t}}l.buildMsgKey=m,l.parseWebMessageInfo=p,l.parseMsgStubProto=_}),98);
__d("WAWebWamEnumMessageChatType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4,CHANNEL:5});i.MESSAGE_CHAT_TYPE=e}),66);
__d("WAWebGetMessageChatTypeFromWid",["WAWebWamEnumMessageChatType"],(function(t,n,r,o,a,i,l){function e(e){return e.isUser()?o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.INDIVIDUAL:e.isGroup()?o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.GROUP:e.isBroadcast()?o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.BROADCAST:e.isStatus()?o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.STATUS:e.isNewsletter()?o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.CHANNEL:o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.OTHER}l.getMessageChatTypeFromWid=e}),98);
__d("WAWebWamEnumExpiryReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({USER_LEAVE:1,DEVICE_UNPAIR:2,IDENTITY_CHANGE:3,AUDIENCE_CHANGE:4,PERIODIC_ROTATION:5,KEY_CORRUPTION:6,PEER_COMPANION_UNPAIR:7,OTHER_DEVICE_UNPAIR:8});i.EXPIRY_REASON=e}),66);
__d("WAWebSenderKeyExpiredWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumExpiryReason","WAWebWamEnumMessageChatType","WAWebWamEnumSizeBucket"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({SenderKeyExpired:[3130,{chatType:[1,o("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE],deviceSizeBucket:[2,o("WAWebWamEnumSizeBucket").SIZE_BUCKET],expiryReason:[3,o("WAWebWamEnumExpiryReason").EXPIRY_REASON]},[1,1,1],"regular"]},{SenderKeyExpired:[]});l.SenderKeyExpiredWamEvent=e}),98);
__d("WAWebPostSenderKeyExpiredMetric",["WAWebGetMessageChatTypeFromWid","WAWebSenderKeyExpiredWamEvent","WAWebWamNumberToSizeBucket","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.chatId,n=e.deviceCount,a=e.expiryReason,i=new(o("WAWebSenderKeyExpiredWamEvent")).SenderKeyExpiredWamEvent;if(a!=null&&(i.expiryReason=a),t!=null){var l=o("WAWebWidFactory").createWidFromWidLike(t);i.chatType=o("WAWebGetMessageChatTypeFromWid").getMessageChatTypeFromWid(l)}n!=null&&n>0&&(i.deviceSizeBucket=r("WAWebWamNumberToSizeBucket")(n)),i.commit()}l.postSenderKeyExpiredMetric=e}),98);
__d("WAWebAdvUpdateParticipantApi",["WAJids","WALogger","WAWebPostSenderKeyExpiredMetric","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebWamEnumExpiryReason","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(e,t,n){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a;try{a=yield o("WAWebSchemaParticipant").getParticipantTable().equals(["participants"],String(t))}catch(t){throw t.toString().includes("Failed to read large IndexedDB value")&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateGroupParticipantsInTransaction: error: ",""])),t).sendLogs("indexeddb-participant-read-large-value"),t}var i=a.map(function(e){var a=e.rotateKey,i=new Map(e.senderKey);return r.forEach(function(e){var n,r=String(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(t.user,t.server,e));a=a||((n=i.get(r))!=null?n:!1),i.delete(r)}),a&&i.forEach(function(e,t){return i.set(t,!1)}),n.forEach(function(e){i.set(String(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(t.user,t.server,e)),!1)}),p(t,a,e,n,r),babelHelpers.extends({},e,{senderKey:i,rotateKey:a})});return o("WAWebSchemaParticipant").getParticipantTable().bulkCreateOrReplace(i)}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length!==0){var t;try{t=yield o("WAWebSchemaParticipant").getParticipantTable().anyOf(["participants"],e.map(function(e){return String(e.wid)}))}catch(e){throw e.toString().includes("Failed to read large IndexedDB value")&&o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateGroupParticipantsInTransaction: error: ",""])),e).sendLogs("indexeddb-participant-bulk-read-large-value"),e}if(t.length!==0){var n=new Map;e.forEach(function(e){n.set(String(e.wid),e)});var r=t.map(function(e){var t=e.rotateKey,r=new Map(e.senderKey);return e.participants.forEach(function(a){var i=n.get(a);if(i){var l=i.added,s=i.removed,u=i.wid;s.forEach(function(e){var n,a=String(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(i.wid.user,i.wid.server,e));t=t||((n=r.get(a))!=null?n:!1),r.delete(a)}),t&&r.forEach(function(e,t){return r.set(t,!1)}),l.forEach(function(e){r.set(String(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(i.wid.user,i.wid.server,e)),!1)}),p(u,t,e,l,s)}}),babelHelpers.extends({},e,{senderKey:r,rotateKey:t})});return o("WAWebSchemaParticipant").getParticipantTable().bulkCreateOrReplace(r)}}}),m.apply(this,arguments)}function p(e,t,n,r,a){if(t&&!n.rotateKey){var i,l;a.includes(o("WAJids").DEFAULT_DEVICE_ID)&&r.includes(o("WAJids").DEFAULT_DEVICE_ID)?l=o("WAWebWamEnumExpiryReason").EXPIRY_REASON.IDENTITY_CHANGE:(i=o("WAWebUserPrefsMeUser").getMaybeMePnUser())!=null&&i.equals(e)?l=o("WAWebWamEnumExpiryReason").EXPIRY_REASON.PEER_COMPANION_UNPAIR:l=o("WAWebWamEnumExpiryReason").EXPIRY_REASON.OTHER_DEVICE_UNPAIR,o("WAWebPostSenderKeyExpiredMetric").postSenderKeyExpiredMetric({chatId:n.groupId,deviceCount:n.senderKey.size,expiryReason:l})}}l.updateGroupParticipantsInTransaction=u,l.bulkUpdateGroupParticipantsInTransaction=d}),98);
__d("WAWebFMXGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("fmx_ctwa_kill_switch")}function s(){return o("WAWebABProps").getABPropConfigValue("enable_fmx_logging")}l.fmxCTWAKillSwitchEnabled=e,l.fmxLoggingEnabled=s}),98);
__d("WAWebContactSystemMsg",["WATimeUtils","WAWebApiContact","WAWebBizGatingUtils","WAWebFMXGatingUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","WAWebViewMode.flow","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),a=new(r("WAWebMsgKey"))({fromMe:o("WAWebUserPrefsMeUser").isMeAccount(t),remote:e,id:r("WAWebMsgKey").newId_DEPRECATED()});return{id:a,t:o("WATimeUtils").unixTime(),type:"e2e_notification",kind:o("WAWebMsgType").MsgKind.E2eNotification,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:"identity",from:e,to:n,body:t.toString()}}function s(e,t){return t===void 0&&(t="encrypt"),f(e,{type:"e2e_notification",kind:o("WAWebMsgType").MsgKind.E2eNotification,subtype:t,templateParams:[]})}function u(e){return f(e,{type:"e2e_notification",kind:o("WAWebMsgType").MsgKind.E2eNotification,subtype:"encrypt_now",templateParams:[]})}function c(e,t,n){return n===void 0&&(n=[]),f(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:t,templateParams:n})}function d(e,t,n){var a=n?o("WAWebUserPrefsMeUser").getMePnUserOrThrow():e;if(a==null)throw r("err")("Cannot set null initiator for DDM system message: "+e.toString()+" / "+String(n));return f(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"disappearing_mode",templateParams:[],ephemeralDuration:t,ephemeralSettingUser:a})}function m(e,t,n){return f(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"disappearing_mode_update",templateParams:[],ephemeralDuration:t,ephemeralSettingUser:n})}function p(e){var t=e.chatId,n=e.displayName,r=e.newUsername,a=e.oldUsername,i=e.wid;return f(t,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"change_username",templateParams:[a!=null?a:"",r!=null?r:"",i,n!=null?n:""]})}function _(e){return f(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"disappearing_mode_unsupported",templateParams:[]})}function f(e,t){var n=o("WAWebUserPrefsMeUser").getMaybeMeDeviceLid(),a=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),i=new(r("WAWebMsgKey"))({fromMe:o("WAWebUserPrefsMeUser").isMeAccount(e),remote:e,id:r("WAWebMsgKey").newId_DEPRECATED()});return babelHelpers.extends({id:i,t:o("WATimeUtils").unixTime(),from:e,to:e.isLid()&&n!=null?n:a},t)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t.isEnterprise&&!o("WAWebBizGatingUtils").getFmxAgmEnabled()||t.isEnterprise&&!t.isFMXCtWA&&o("WAWebBizGatingUtils").getFmxAgmEnabled()||!e.isUser()||t.isWASupportStartingChat||t.iAmStartingChat&&!t.isFMXCtWA||t.isFromCTWA&&!t.isFMXCtWA&&o("WAWebFMXGatingUtils").fmxCTWAKillSwitchEnabled()||e.isBot())return null;var n=yield o("WAWebApiContact").isAddressBookContact(e.toJid());return n?null:f(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"contact_info_card",templateParams:[e]})}),h.apply(this,arguments)}function y(e,t){return f(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"limit_sharing_system_message",limitSharing:t,templateParams:[]})}l.genSecurityCodeNotificationMsg=e,l.genEncryptNotificationMsg=s,l.genEncryptNotificationMsgAfterBotRemoved=u,l.genNonE2ENotificationMsg=c,l.genDefaultDisappearingModeSystemMsg=d,l.genDisappearingModeUpdateSystemMsg=m,l.genUsernameChangeSystemMsg=p,l.genDisappearingModeUnsupportedSystemMsg=_,l.genNotificationMsg=f,l.genContactInfoCardMsg=g,l.genLimitSharingUpdateSystemMsg=y}),98);
__d("WAWebIdentityChangeApi",["Promise","WAJids","WANullthrows","WAWebAdvUpdateParticipantApi","WAWebApiContact","WAWebApiDeviceList","WAWebBizCoexGatingUtils","WAWebBizCoexUtils","WAWebContactSystemMsg","WAWebDeviceListPk","WAWebHandleSingleMsg","WAWebModelStorageUtils","WAWebMsgType","WAWebOfflineDeviceCache","WAWebProtobufsAdv.pb","WAWebSchemaChat","WAWebSecurityCodeApi","WAWebSendTcTokenWhenDeviceIdentityChange","WAWebSignal","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r=(n=e.device)!=null?n:o("WAJids").DEFAULT_DEVICE_ID,a=o("WAWebWidFactory").asUserWidOrThrow(e);if(r===o("WAJids").DEFAULT_DEVICE_ID){yield c({wid:a});var i=yield o("WAWebSecurityCodeApi").addSecurityCodeChangedNotifications({user:a,offline:t});return o("WAWebSendTcTokenWhenDeviceIdentityChange").sendTcTokenWhenDeviceIdentityChange(a),i}}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t.offline,i=t.stanzaLid,l=t.wid,s=[o("WAJids").DEFAULT_DEVICE_ID],u=[o("WAJids").DEFAULT_DEVICE_ID],c=!1;if(a===!0)o("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(String(l),null),yield o("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){return o("WAWebAdvUpdateParticipantApi").updateGroupParticipantsInTransaction(l,u,s)});else{var d=yield o("WAWebApiDeviceList").getDeviceRecord(l);if(d&&!d.deleted&&(d.devices.forEach(function(e){e.id!==o("WAJids").DEFAULT_DEVICE_ID&&s.push(e.id)}),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&d.advAccountType===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(c=!0)),(e||(e=n("Promise"))).all(s.map(function(t){return t===o("WAJids").DEFAULT_DEVICE_ID?(e||(e=n("Promise"))).resolve():o("WAWebSignal").Session.deleteRemoteInfo(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(l.user,l.server,t))})),yield e.all([o("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){return o("WAWebAdvUpdateParticipantApi").updateGroupParticipantsInTransaction(l,u,s)}),o("WAWebApiDeviceList").createOrReplaceDeviceRecord({id:o("WAWebDeviceListPk").createDeviceListPK(l),deleted:!0})]),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&c===!0){yield o("WAWebApiContact").updateContactAdvHostedType(l,o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE);var m=[l.toString()];if(l.isLid()){var p=o("WAWebApiContact").getPnIfLidIsLatestMapping(l);p!=null&&m.push(p.toString())}else i!=null&&m.push(i.toString());var _=yield o("WAWebSchemaChat").getChatTable().bulkGet(m,!1),f=_.find(Boolean);if(f!=null){var g=o("WAWebWidFactory").createWid(f.id),h=o("WAWebContactSystemMsg").genNotificationMsg(g,{type:"e2e_notification",kind:o("WAWebMsgType").MsgKind.E2eNotification,subtype:"encrypt_now",templateParams:[]});yield o("WAWebHandleSingleMsg").handleSingleMsg({chatId:r("WANullthrows")(h.from),newMsg:h,handleSingleMsgOrigin:"bizStateChangeNotification"})}o("WAWebBizCoexUtils").triggerUsyncForCoexUpdate(l)}}}),d.apply(this,arguments)}l.handleNewIdentity=s,l.clearDeviceRecordForIdentityChange=c}),98);
__d("WAWebAdvHostedAccountTypeSystemMsg",["WATimeUtils","WAWebBizCoexGatingUtils","WAWebMsgKey","WAWebMsgType","WAWebProtobufsAdv.pb","WAWebUserPrefsMeUser","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){function e(e,t,n,a){if(a===void 0&&(a=!1),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){if(!e.isUser())return null;var i=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),l=new(r("WAWebMsgKey"))({fromMe:o("WAWebUserPrefsMeUser").isMeAccount(t),remote:e,id:r("WAWebMsgKey").newId_DEPRECATED()});if(n===o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE)return{id:l,t:o("WATimeUtils").unixTime(),type:"e2e_notification",kind:o("WAWebMsgType").MsgKind.E2eNotification,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:a&&o("WAWebBizCoexGatingUtils").hostedOverrideAdvAccountSignatureKeyEnabled()?"encrypt_now":"encrypt",from:e,to:i};if(n===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED)return{id:l,t:o("WATimeUtils").unixTime(),type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:"biz_account_type_changed_to_hosted",from:e,to:i}}return null}function s(e,t){if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){if(!e.isUser())return null;var n=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),a=new(r("WAWebMsgKey"))({fromMe:o("WAWebUserPrefsMeUser").isMeAccount(t),remote:e,id:r("WAWebMsgKey").newId_DEPRECATED()});return{id:a,t:o("WATimeUtils").unixTime(),type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:"biz_me_account_type_is_hosted",from:e,to:n}}return null}function u(e,t){if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){if(!e.isUser())return null;var n=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),a=new(r("WAWebMsgKey"))({fromMe:o("WAWebUserPrefsMeUser").isMeAccount(t),remote:e,id:r("WAWebMsgKey").newId_DEPRECATED()});return{id:a,t:o("WATimeUtils").unixTime(),type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:"biz_account_type_is_hosted",from:e,to:n}}return null}function c(e,t){if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&o("WAWebBizCoexGatingUtils").smbHostedLazySystemMsgInsertInHistorySyncEnabled()&&e.isUser()){var n=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),a=new(r("WAWebMsgKey"))({fromMe:o("WAWebUserPrefsMeUser").isMeAccount(t),remote:e,id:r("WAWebMsgKey").newId_DEPRECATED()});return{id:a,t:o("WATimeUtils").unixTime(),type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:"biz_me_account_type_is_hosted_transition",from:e,to:n}}return null}l.genAdvAccountTypeChangeNotificationMsg=e,l.genAdvMeAccountIsHostedNotificationMsg=s,l.genAdvAccountTypeInitialSysMsg=u,l.genAdvAccountTypeSelfTransitionToCoexNotificationMsg=c}),98);
__d("WAWebAdvDeviceNotificationApi",["Promise","WALogger","WAWebAdvHostedAccountTypeSystemMsg","WAWebBizCoexGatingUtils","WAWebBizCoexHostedAddVerification","WAWebProtobufsAdv.pb","WAWebSchemaChat","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","compactMap","err"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a={notifications:[],chatIds:[]};if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){var i=[];if(t.equals(o("WAWebUserPrefsMeUser").getMePnUserOrThrow()))o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["SMB unexpected self adv system msg"]))).tags("generateAdvAccountTypeChangeNotifications");else{n===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["accountTypeChangeNotification: check coex cache for ",""])),t==null?void 0:t.toLogString()),o("WAWebBizCoexHostedAddVerification").assertThrowsWidAdvTypeFromVerificationCache(t));try{var l=yield o("WAWebSchemaChat").getChatTable().get(String(t),!1);l&&i.push(o("WAWebWidFactory").createWid(l.id))}catch(e){throw r("err")("get chays failed")}}var u=r("compactMap")(i,function(e){return o("WAWebAdvHostedAccountTypeSystemMsg").genAdvAccountTypeChangeNotificationMsg(e,t,n,!0)});return a.notifications=u,a.chatIds=i.map(String),a}return a}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled())throw r("err")("hosted system msg gen: unexpected env");var t=[],a=new Set,i=yield(u||(u=n("Promise"))).all(e.map(function(e){var t=e.newAdvAccountType,r=e.wid;return t!=null?c(r,t):(u||(u=n("Promise"))).resolve(null)}));return i.forEach(function(e){e&&(t=t.concat(e.notifications),e.chatIds.forEach(function(e){return a.add(e)}))}),t.length>0?{notifications:t,chatIds:Array.from(a)}:{notifications:[],chatIds:[]}}),p.apply(this,arguments)}l.bulkGenerateDeviceAndAdvAccountTypeChangeNotifications=m}),98);
__d("WAWebApiGetDeviceUpdateLock",["WAWebBizCoexGatingUtils","WAWebModelStorageUtils"],(function(t,n,r,o,a,i,l){function e(e,t,n,r){n===void 0&&(n=!1),r===void 0&&(r=!1);var a=["participant","device-list"];return t&&(a=[].concat(a,["message","message-association"])),n&&(a=[].concat(a,["missing-keys"])),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&r&&(a=[].concat(a,["contact"])),o("WAWebModelStorageUtils").getStorage().lock(a,function(){return e()})}l.getDeviceUpdateLock=e}),98);
__d("WAWebCollectionVersionStore",["WAWebSchemaCollectionVersion"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){}var t=e.prototype;return t.get=function(t){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().get(t)},t.bulkGet=function(t){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().bulkGet(t)},t.getAll=function(){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().all()},t.update=function(t,n){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().createOrMerge(t,babelHelpers.extends({collection:t},n))},t.bulkUpdate=function(t){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().bulkCreateOrMerge(t)},t.clear=function(){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().clear()},e})();e.locks=["collection-version"],l.WAWebCollectionVersionStore=e}),98);
__d("WAWebSyncdDb",["WASyncdKeyTypes","WAWebSchemaCollectionVersion","WAWebSchemaMissingKeys","WAWebSchemaPendingMutations","WAWebSchemaSyncActions","WAWebSchemaSyncKeys","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebSchemaPendingMutations").getPendingMutationsTable().all()}function s(e,t){return o("WAWebSchemaPendingMutations").getPendingMutationsTable().equals(e,t)}function u(e,t){return o("WAWebSchemaPendingMutations").getPendingMutationsTable().equals(e,t)}function c(e){return o("WAWebSchemaPendingMutations").getPendingMutationsTable().bulkCreate(e)}function d(e){return o("WAWebSchemaPendingMutations").getPendingMutationsTable().bulkRemove(e)}function m(e,t,n){return o("WAWebSchemaCollectionVersion").getCollectionVersionTable().createOrMerge(e,{collection:e,version:t,ltHash:n})}function p(e){return o("WAWebSchemaSyncActions").getSyncActionsTable().get(e)}function _(e,t){return o("WAWebSchemaSyncActions").getSyncActionsTable().anyOf(e,t)}function f(e){return o("WAWebSchemaSyncActions").getSyncActionsTable().createOrReplace(e)}function g(e){return o("WAWebSchemaSyncActions").getSyncActionsTable().bulkCreateOrReplace(e)}function h(e){return o("WAWebSchemaSyncActions").getSyncActionsTable().bulkCreateOrMerge(e.map(function(e){return babelHelpers.extends({},e)}))}function y(e){return o("WAWebSchemaSyncActions").getSyncActionsTable().bulkRemove(e)}function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaSyncKeys").getSyncKeysTable().get(new Uint8Array(o("WASyncdKeyTypes").fromSyncKeyId(e)));return t==null?t:o("WAWebSchemaSyncKeys").convertToSyncKeyFromRow(t)}),b.apply(this,arguments)}function v(){return o("WAWebSchemaSyncKeys").getSyncKeysTable().all().then(function(e){return e.map(o("WAWebSchemaSyncKeys").convertToSyncKeyFromRow)})}function S(e){return o("WAWebSchemaSyncKeys").getSyncKeysTable().createOrReplace(o("WAWebSchemaSyncKeys").convertFromSyncKeyToRow(e)).then(function(e){return o("WASyncdKeyTypes").toSyncKeyId(e.buffer)})}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaSyncKeys").getSyncKeysTable().equals(["keyEpoch"],e);t.forEach(function(e){return o("WAWebSchemaSyncKeys").getSyncKeysTable().merge({keyId:e.keyId},{timestamp:0})})}),L.apply(this,arguments)}function E(){return o("WAWebSchemaMissingKeys").getMissingKeysTable().count()}function k(e){return o("WAWebSchemaMissingKeys").getMissingKeysTable().bulkGet(e).then(function(e){return e.map(function(e){return e==null?null:o("WAWebSchemaMissingKeys").convertToMissingKeyFromRow(e)})})}function I(){return o("WAWebSchemaMissingKeys").getMissingKeysTable().all().then(function(e){return e.map(o("WAWebSchemaMissingKeys").convertToMissingKeyFromRow)})}function T(e){return o("WAWebSchemaMissingKeys").getMissingKeysTable().bulkRemove(e)}function D(e){return o("WAWebSchemaMissingKeys").getMissingKeysTable().bulkCreateOrMerge(e.map(o("WAWebSchemaMissingKeys").convertFromMissingKeyToRow))}l.getAllPendingMutationsRows=e,l.getPendingMutationsRows=s,l.getPendingMutationsRowsByIndex=u,l.appendPendingMutationsRows=c,l.bulkRemovePendingMutations=d,l.setCollectionVersion=m,l.getSyncAction=p,l.getSyncActionsRows=_,l.setSyncAction=f,l.setSyncActionRows=g,l.updateSyncActionRows=h,l.deleteSyncActionRows=y,l.getSyncKey=C,l.getAllSyncKeys=v,l.createSyncKey=S,l.expireSyncKey=R,l.getMissingKeyCount=E,l.bulkGetMissingKeys=k,l.getAllMissingKeys=I,l.bulkRemoveMissingKeys=T,l.createOrUpdateMissingKeys=D}),98);
__d("WAWebMissingKeyStore",["WAWebSchemaMissingKeys","WAWebSyncdDb"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){}var t=e.prototype;return t.getAll=function(){return o("WAWebSyncdDb").getAllMissingKeys()},t.bulkGet=function(t){return o("WAWebSyncdDb").bulkGetMissingKeys(t)},t.count=function(){return o("WAWebSyncdDb").getMissingKeyCount()},t.bulkUpdate=function(t){return o("WAWebSyncdDb").createOrUpdateMissingKeys(t)},t.bulkRemove=function(t){return o("WAWebSyncdDb").bulkRemoveMissingKeys(t)},t.clear=function(){return o("WAWebSchemaMissingKeys").getMissingKeysTable().clear()},e})();e.locks=["missing-keys"],l.WAWebMissingKeyStore=e}),98);
__d("WAWebPendingMutationStore",["WAWebNoop","WAWebSchemaPendingMutations","WAWebSyncdDb","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){}var t=e.prototype;return t.getByCollection=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSyncdDb").getPendingMutationsRows(["collection"],e);return t.map(o("WAWebSchemaPendingMutations").convertToPendingMutationFromRow)});function t(t){return e.apply(this,arguments)}return t})(),t.getAll=function(){return o("WAWebSyncdDb").getAllPendingMutationsRows()},t.bulkCreate=function(t){return o("WAWebSyncdDb").appendPendingMutationsRows(t).then(r("WAWebNoop"))},t.bulkRemove=function(t){return o("WAWebSyncdDb").bulkRemovePendingMutations(t)},t.clear=function(){return o("WAWebSchemaPendingMutations").getPendingMutationsTable().clear()},e})();e.locks=["pending-mutations"],l.WAWebPendingMutationStore=e}),98);
__d("WAWebSyncActionStore",["Promise","WAWebSchemaSyncActions","WAWebSyncdDb","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=(function(){function t(){}var r=t.prototype;return r.count=function(){return o("WAWebSchemaSyncActions").getSyncActionsTable().count()},r.get=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSyncdDb").getSyncAction(e);return t==null?null:o("WAWebSchemaSyncActions").convertToSyncActionFromRow(t)});function t(t){return e.apply(this,arguments)}return t})(),r.getByCollections=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSyncdDb").getSyncActionsRows(["collection"],e.map(function(e){return e}));return t.map(o("WAWebSchemaSyncActions").convertToSyncActionFromRow)});function t(t){return e.apply(this,arguments)}return t})(),r.getByIndexMacs=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return e.length<7?this.getByIndexMacsMultiQuery(e):this.getByIndexMacsSingleQuery(e)});function t(t){return e.apply(this,arguments)}return t})(),r.getByIndexMacsMultiQuery=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=yield(e||(e=n("Promise"))).all(t.map(function(e){return o("WAWebSyncdDb").getSyncActionsRows(["indexMac"],[e])}));return r.flat().map(o("WAWebSchemaSyncActions").convertToSyncActionFromRow)});function r(e){return t.apply(this,arguments)}return r})(),r.getByIndexMacsSingleQuery=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSyncdDb").getSyncActionsRows(["indexMac"],e.map(function(e){return e}));return t.map(o("WAWebSchemaSyncActions").convertToSyncActionFromRow)});function t(t){return e.apply(this,arguments)}return t})(),r.getByActionStates=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSyncdDb").getSyncActionsRows(["actionState"],e.map(function(e){return e}));return t.map(o("WAWebSchemaSyncActions").convertToSyncActionFromRow)});function t(t){return e.apply(this,arguments)}return t})(),r.getByModelInfos=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSyncdDb").getSyncActionsRows(["modelId","modelType","actionState"],e.map(function(e){return e}));return t.map(o("WAWebSchemaSyncActions").convertToSyncActionFromRow)});function t(t){return e.apply(this,arguments)}return t})(),r.getAll=function(){return o("WAWebSchemaSyncActions").getSyncActionsTable().all().then(function(e){return e.map(o("WAWebSchemaSyncActions").convertToSyncActionFromRow)})},r.bulkSet=function(t){return o("WAWebSyncdDb").setSyncActionRows(t.map(o("WAWebSchemaSyncActions").convertFromSyncActionToRow))},r.bulkUpdate=function(t){return o("WAWebSyncdDb").updateSyncActionRows(t.map(o("WAWebSchemaSyncActions").convertFromSyncActionToRow))},r.bulkRemove=function(t){return o("WAWebSyncdDb").deleteSyncActionRows(t)},r.clear=function(){return o("WAWebSchemaSyncActions").getSyncActionsTable().clear()},t})();s.locks=["sync-actions"],l.WAWebSyncActionStore=s}),98);
__d("WAWebSyncKeyStore",["WAWebNoop","WAWebSchemaSyncKeys","WAWebSyncdDb"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){}var t=e.prototype;return t.get=function(t){return o("WAWebSyncdDb").getSyncKey(t)},t.getAll=function(){return o("WAWebSyncdDb").getAllSyncKeys()},t.set=function(t){return o("WAWebSyncdDb").createSyncKey(t).then(r("WAWebNoop"))},t.expire=function(t){return o("WAWebSyncdDb").expireSyncKey(t)},t.clear=function(){return o("WAWebSchemaSyncKeys").getSyncKeysTable().clear()},e})();e.locks=["sync-keys"],l.WAWebSyncKeyStore=e}),98);
__d("WAWebRunInTransaction",["Promise","WAWeb-dexie","WAWebCollectionVersionStore","WAWebMissingKeyStore","WAWebModelStorageUtils","WAWebPendingMutationStore","WAWebSyncActionStore","WAWebSyncKeyStore","err"],(function(t,n,r,o,a,i,l){var e,s={SyncActionStore:o("WAWebSyncActionStore").WAWebSyncActionStore,CollectionVersionStore:o("WAWebCollectionVersionStore").WAWebCollectionVersionStore,PendingMutationStore:o("WAWebPendingMutationStore").WAWebPendingMutationStore,MissingKeyStore:o("WAWebMissingKeyStore").WAWebMissingKeyStore,SyncKeyStore:o("WAWebSyncKeyStore").WAWebSyncKeyStore},u=function(a,i){if(r("WAWeb-dexie").currentTransaction!=null)return(e||(e=n("Promise"))).reject(r("err")("Calling runInTransaction recursively. This is not allowed."));var t=Object.keys(a),l=t.flatMap(function(e){return s[e].locks});return o("WAWebModelStorageUtils").getStorage().lock(l,function(){var e={};for(var n of t)e[n]=new s[n];return i(e)})};l.runInTransaction=u}),98);
__d("WAWebGetMissingKey",["WAWebRunInTransaction"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},function(e){var t=e.MissingKeyStore;return t.getAll()})}function s(e){return o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},function(t){var n=t.MissingKeyStore;return n.bulkGet(e)})}function u(){return o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},function(e){var t=e.MissingKeyStore;return t.count()})}function c(e){return o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},function(t){var n=t.MissingKeyStore;return n.bulkUpdate(e)})}l.getAllMissingKeysInTransaction=e,l.bulkGetMissingKeysInTransaction=s,l.getMissingKeyCountTransaction=u,l.bulkUpdateMissingKeysInTransaction=c}),98);
__d("WAWebGetSyncKey",["WAWebRunInTransaction"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WAWebRunInTransaction").runInTransaction({SyncKeyStore:!0},function(t){var n=t.SyncKeyStore;return n.get(e)})}function s(){return o("WAWebRunInTransaction").runInTransaction({SyncKeyStore:!0},function(e){var t=e.SyncKeyStore;return t.getAll()})}function u(e){return o("WAWebRunInTransaction").runInTransaction({SyncKeyStore:!0},function(t){var n=t.SyncKeyStore;return n.set(e)})}function c(e){return o("WAWebRunInTransaction").runInTransaction({SyncKeyStore:!0},function(t){var n=t.SyncKeyStore;return n.expire(e)})}l.getSyncKeyInTransaction_DO_NOT_USE=e,l.getAllSyncKeysInTransaction=s,l.setSyncKeyInTransaction=u,l.expireSyncKeyInTransaction=c}),98);
__d("WAWebSyncdCryptoUtils",["WACryptoUtils","WASyncdKeyTypes","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e.length===0)throw r("err")("buffers length is zero");if(e.length===1)return e[0];var t=e.map(function(e){return e.byteLength}),n=t.reduce(function(e,t){return e+t}),o=new Uint8Array(n),a=0,i;for(i=0;i<e.length;i++)o.set(new Uint8Array(e[i]),a),a+=e[i].byteLength;return o.buffer}function s(e,t,n){if(t<0||n<0)throw r("err")("buffers length is zero");var o=new Array(3),a=new Uint8Array(e);return o[0]=a.slice(0,t).buffer,o[1]=a.slice(t,t+n).buffer,o[2]=a.slice(t+n).buffer,o}function u(e){return Uint8Array.from(e.split(" ").map(function(e){return parseInt(e,16)}))}function c(e){return Array.from(new Uint8Array(o("WASyncdKeyTypes").fromSyncKeyId(e)),function(e){return e.toString(16)}).toString().replace(/,/g," ")}function d(e){return Array.from(new Uint8Array(e),function(e){return e.toString(16).padStart(2,"0")}).join("")}function m(e){var t=new ArrayBuffer(8);return new DataView(t).setUint32(4,e,!1),t}function p(e,t){return o("WACryptoUtils").arrayBuffersEqual(o("WASyncdKeyTypes").fromSyncKeyId(e),o("WASyncdKeyTypes").fromSyncKeyId(t))}l.combine=e,l.split=s,l.hexToUint8Array=u,l.syncKeyIdToHex=c,l.arrayBufferToHexPadded=d,l.to64BitNetworkOrder=m,l.syncKeyIdsEqual=p}),98);
__d("WAWebSyncdGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("syncd_key_max_use_days")}function s(){return o("WAWebABProps").getABPropConfigValue("syncd_sentinel_timeout_seconds")}function u(){return o("WAWebABProps").getABPropConfigValue("syncd_inline_mutations_max_count")}function c(){return o("WAWebABProps").getABPropConfigValue("syncd_patch_protobuf_max_size")}function d(){return o("WAWebABProps").getABPropConfigValue("syncd_wait_for_key_timeout_days")}l.getSyncdKeyMaxUseDays=e,l.getSyncdSentinelTimeoutSeconds=s,l.getSyncdInlineMutationsMaxCount=u,l.getSyncdPatchProtobufMaxSize=c,l.getSyncdWaitForKeyTimeoutDays=d}),98);
__d("WAWebSyncdUploadFatalErrorMetricEmitter",[],(function(t,n,r,o,a,i){"use strict";var e=null;function l(t){e=t}function s(t,n,r,o,a,i,l,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$){e==null||e(t,n,r,o,a,i,l,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$)}i.listenForUploadFatalErrorMetric=l,i.emitUploadFatalErrorMetric=s}),66);
__d("WAWebWamEnumIsPureSyncdSessionEnum",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:1,YES:2,NO:3,PROBABLY_YES:4,PROBABLY_NO:5});i.IS_PURE_SYNCD_SESSION_ENUM=e}),66);
__d("WAWebWamEnumLidMigrationStageEnum",[],(function(t,n,r,o,a,i){var e=Object.freeze({NOT_MIGRATED:1,PEER_MIGRATED:2,HISTORY_MIGRATED:3});i.LID_MIGRATION_STAGE_ENUM=e}),66);
__d("WAWebWamEnumRecoveryStatusEnum",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRIMARY_UNSUPPORTED:1,ABPROP_OFF:2,NOT_FATAL:3,COLLECTION_UNSUPPORTED:4,MUTATION_COUNT_TOO_HIGH:5,PRIMARY_DID_NOT_RESPOND:6});i.RECOVERY_STATUS_ENUM=e}),66);
__d("WAWebSyncdMetricFatalError",["$InternalEnum","WALogger","WAWebSyncdMetricFatalErrorListener","WAWebSyncdUploadFatalErrorMetricEmitter","WAWebWamEnumRecoveryStatusEnum"],(function(t,n,r,o,a,i,l){"use strict";var e=["type"],s,u,c=n("$InternalEnum").Mirrored(["PATCH_PROTOBUF_SERIALIZATION_FAILED","MUTATIONS_PROTOBUF_SERIALIZATION_FAILED","ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED","ENCRYPTION_FAILED","MISSING_SNAPSHOT_VERSION","MISSING_SNAPSHOT_MAC","MISSING_SNAPSHOT_KEY_ID","MISSING_PATCH_VERSION","PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS","MISSING_PATCH_SNAPSHOT_MAC","MISSING_PATCH_MAC","MISSING_PATCH_KEY_ID","MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY","MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH","MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256","MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256","MISSING_MUTATION_OPERATION","MISSING_MUTATION_RECORD","MISSING_MUTATION_INDEX","MISSING_MUTATION_VALUE","MISSING_MUTATION_KEY_ID","EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED","SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED","PATCH_PROTOBUF_DESERIALIZATION_FAILED","MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED","ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED","MISSING_ACTION_INDEX","MISSING_ACTION_VERSION","SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT","SNAPSHOT_MAC_MISMATCH_IN_PATCH","MAC_MISMATCH_PATCH","DECRYPTION_FAILED","DUPLICATE_PATCH_VERSION_IN_COLLECTION","SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH","SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT","MISSING_ACTION_VALUE","MISSING_ACTION_TIMESTAMP","XMPP_BAD_REQUEST_FOR_COLLECTION","XMPP_NOT_FOUND_FOR_COLLECTION","CYCLIC_MUTATION_DEPENDENCY_IN_PATCH","SERVER_DID_NOT_SEND_ALL_PATCHES","TERMINAL_PATCH_MISSING_DATA","TERMINAL_PATCH_DESERIALIZATION_ERROR","TERMINAL_PATCH_UNKNOWN","INVALID_ACTION_INDEX","XMPP_BAD_REQUEST_GLOBAL_ERROR","XMPP_NOT_FOUND_GLOBAL_ERROR","XMPP_BAD_METHOD_GLOBAL_ERROR","XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR","TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D","TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY","MISSING_KEY_ON_ALL_CLIENTS"]),d=[];function m(t,n){for(n===void 0&&(n=!0);d.length>0;){var r=d.pop();if(r!=null){n&&(r.recoveryStatus=o("WAWebWamEnumRecoveryStatusEnum").RECOVERY_STATUS_ENUM.PRIMARY_DID_NOT_RESPOND),r.recoveryRequestDurationMs=t,r.isFatal=n,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncd: flush fatal error after failed shapshot recovery: ",""])),r.type);var a=r.type,i=babelHelpers.objectWithoutPropertiesLoose(r,e);p(a,i,!1)}}}function p(e,t,n){var r,a,i,l,s,c,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w;if(n===!0){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["syncd: deferring fatal error due to inflight shapshot recovery: ",""])),e),d.push(babelHelpers.extends({type:e},t));return}o("WAWebSyncdUploadFatalErrorMetricEmitter").emitUploadFatalErrorMetric(o("WAWebSyncdMetricFatalErrorListener").convertSyncdErrorCode(e),(r=t==null?void 0:t.collection)!=null?r:null,(a=t==null?void 0:t.patchSnapshotMutationCount)!=null?a:void 0,(i=t==null?void 0:t.patchVersion)!=null?i:void 0,(l=t==null?void 0:t.isFatal)!=null?l:void 0,(s=t==null?void 0:t.isLtHashConsistent)!=null?s:void 0,(c=t==null?void 0:t.macFatalCollectionNameMismatch)!=null?c:void 0,(m=t==null?void 0:t.macFatalCurrentLthashMismatch)!=null?m:void 0,(p=t==null?void 0:t.macFatalNewLthashMismatch)!=null?p:void 0,(_=t==null?void 0:t.macFatalPatchVersionMismatch)!=null?_:void 0,(f=t==null?void 0:t.macFatalNewLthashSubtractMismatch)!=null?f:void 0,(g=t==null?void 0:t.macFatalNumberHasOverrideMutation)!=null?g:void 0,(h=t==null?void 0:t.macFatalNumberNumAddMutation)!=null?h:void 0,(y=t==null?void 0:t.macFatalNumberNumRemoveMutation)!=null?y:void 0,(C=t==null?void 0:t.macFatalSenderCurrentLthashToLocalCalculatedCurrentLthashMismatch)!=null?C:void 0,(b=t==null?void 0:t.isPatchSenderPrimary)!=null?b:void 0,(v=t==null?void 0:t.macFatalDidUseMacFetchFallback)!=null?v:void 0,(S=t==null?void 0:t.macFatalHasMissingRemove)!=null?S:void 0,(R=t==null?void 0:t.macFatalNumberAddMismatch)!=null?R:void 0,(L=t==null?void 0:t.macFatalNumberRemoveMismatch)!=null?L:void 0,(E=t==null?void 0:t.macFatalDidPreviousPatchFailPostSaveValidation)!=null?E:void 0,(k=t==null?void 0:t.macFatalPreviousPatchNewLthashToCurrentPatchCurrentLthash)!=null?k:void 0,(I=t==null?void 0:t.isPreviousPatchAnIncomingPatch)!=null?I:void 0,(T=t==null?void 0:t.isLastPatchSenderAPrimaryDevice)!=null?T:void 0,(D=t==null?void 0:t.isSenderIndexSameAsPreviousSenderIndex)!=null?D:void 0,(x=t==null?void 0:t.didBootstrapFromSnapshot)!=null?x:void 0,($=t==null?void 0:t.isThereAnotherSyncdCompanion)!=null?$:void 0,(P=t==null?void 0:t.isPureSyncdSession)!=null?P:void 0,(N=t==null?void 0:t.lidMigrationStage)!=null?N:void 0,(M=t==null?void 0:t.recoveryRequestDurationMs)!=null?M:void 0,(w=t==null?void 0:t.recoveryStatus)!=null?w:void 0)}l.SyncdFatalErrorType=c,l.flushDeferredFatalError=m,l.reportSyncdFatalError=p}),98);
__d("WAWebWamEnumMdSyncdFatalErrorCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:1,SERVER_DATA_MISMATCH:2,PROTOBUF_DESERIALIZATION_FAILED:3,EXTERNAL_PATCH_EXPIRED:4,MISSING_OR_EMPTY_INDEX:5,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:6,DECRYPTION_FAILED:7,MISSING_PATCH_VERSION:8,DUPLICATE_PATCH_VERSION_IN_COLLECTION:9,ENCRYPTION_FAILED:10,MISSING_MUTATION_VERSION:11,MISSING_MUTATION_VALUE:12,INVALID_MUTATION_INDEX:13,PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:14,MISSING_MUTATION_OPERATION:15,MISSING_MUTATION_RECORD:16,MISSING_MUTATION_KEY_ID:17,PATCH_PROTOBUF_DESERIALIZATION_FAILED:18,ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:19,MISSING_MUTATION_INDEX:20,MISSING_ACTION_INDEX:21,INVALID_ACTION_INDEX:22,MISSING_ACTION_VALUE:23,MISSING_ACTION_VERSION:24,MISSING_ACTION_TIMESTAMP:25,MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:26,MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:27,PATCH_PROTOBUF_SERIALIZATION_FAILED:28,ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:29,MISSING_KEY_ON_ALL_CLIENTS:30,TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY:31,MAC_MISMATCH_SNAPSHOT:33,MAC_MISMATCH_PATCH:34,DB_STORE_NOT_READY:35,TERMINAL_PATCH_MISSING_DATA:36,TERMINAL_PATCH_DESERIALIZATION_ERROR:37,TERMINAL_PATCH_UNKNOWN:38,CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:39,MISSING_SNAPSHOT_VERSION:45,MISSING_SNAPSHOT_MAC:46,MISSING_PATCH_SNAPSHOT_MAC:47,MISSING_PATCH_MAC:48,MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:49,MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:50,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:51,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:52,INVALID_KEY_SHARE_KEY_ID:53,MISSING_PATCH_KEY_ID:56,INVALID_KEY_SHARE_KEY_DATA:57,SNAPSHOT_EXPIRED:58,MISSING_SNAPSHOT_KEY_ID:59,SNAPSHOT_MAC_MISMATCH_IN_PATCH:60,SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:61,XMPP_BAD_REQUEST_FOR_COLLECTION:62,XMPP_NOT_FOUND_FOR_COLLECTION:63,XMPP_BAD_REQUEST_GLOBAL_ERROR:64,XMPP_NOT_FOUND_GLOBAL_ERROR:65,XMPP_BAD_METHOD_GLOBAL_ERROR:66,XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:67,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:68,EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:69,SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:70,REQUESTING_MISSING_KEY_WITH_NO_CLIENTS:71,DB_STORE_NOT_READY_LOW_DISK_SPACE:72,SERVER_DID_NOT_SEND_ALL_PATCHES:73,SERVER_SENT_EARLIER_PATCH:74,MISSING_KEY_FOR_MUTATION_IN_LOCAL_SNAPSHOT:75,MISSING_ACTIVE_KEY_AFTER_ROTATION:76,MISSING_ACTIVE_KEY_FOR_ENCRYPTION:77,MISSING_CURRENT_EPOCH_FOR_ACTIVE_KEY_VALIDATION:78,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_OUTGOING_PATCH:79,INVALID_SNAPSHOT_RECORDS:80,MISSING_EXTERNAL_BLOB_REFERENCE_HANDLE:81,INVALID_EXTERNAL_BLOB_REFERENCE_UPLOADED:82,INVALID_PATCH_KEY_ID_SIZE:83,INVALID_PATCH_MAC_SIZE:84,INVALID_PATCH_SNAPSHOT_MAC_SIZE:85,INVALID_COLLECTION_SNAPSHOT_HASH_SIZE:86,MISSING_COLLECTION_SNAPSHOT_HASH:87,INVALID_PATCH_KEY_ID_DEVICE_ID:88,INVALID_PATCH_KEY_ID_EPOCH:89,DECRYPTION_FAILED_KEY_ID_MISMATCH:90,DECRYPTION_FAILED_VALUE_MAC_MISMATCH:91,DECRYPTION_FAILED_INDEX_MAC_MISMATCH:92,EXTERNAL_PATCH_MISSING_BLOB:93,COLLECTION_PULL_REQUEST_RECEIVED_PUSH_RESPONSE_WITH_UPDATED_VERSION:94,COLLECTION_PUSH_REQUEST_RECEIVED_RESPONSE_WITH_VERSION_MISMATCH:95,MMS_ERROR_INVALID_FILEHASH:96,UNKNOWN:97,MALFORMED_MUTATION_CLEAR_CHAT:98,MALFORMED_MUTATION_DELETE_CHAT:99,FAILED_MUTATION_CLEAR_CHAT:100,FAILED_MUTATION_DELETE_CHAT:101,CHAT_DB_CORRUPTION:102,LID_BLOCKLIST_PN_WHEN_MIGRATED:103});i.MD_SYNCD_FATAL_ERROR_CODE=e}),66);
__d("WAWebSyncdMetricFatalErrorListener",["WAWebSyncdMetricFatalError","WAWebWamEnumMdSyncdFatalErrorCode"],(function(t,n,r,o,a,i,l){function e(e){return e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.PATCH_PROTOBUF_SERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_SERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.ENCRYPTION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.ENCRYPTION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_SNAPSHOT_VERSION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_VERSION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_SNAPSHOT_MAC?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_MAC:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_SNAPSHOT_KEY_ID?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_KEY_ID:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_VERSION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_VERSION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_SNAPSHOT_MAC?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_SNAPSHOT_MAC:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_MAC?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_MAC:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_KEY_ID?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_KEY_ID:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_OPERATION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_OPERATION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_RECORD?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_RECORD:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_INDEX?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_INDEX:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_VALUE?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_VALUE:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_KEY_ID?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_KEY_ID:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.PATCH_PROTOBUF_DESERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_DESERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_INDEX?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_INDEX:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_VERSION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VERSION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_PATCH?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_PATCH:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MAC_MISMATCH_PATCH?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MAC_MISMATCH_PATCH:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.DECRYPTION_FAILED?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.DUPLICATE_PATCH_VERSION_IN_COLLECTION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.DUPLICATE_PATCH_VERSION_IN_COLLECTION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_VALUE?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VALUE:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_TIMESTAMP?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_TIMESTAMP:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.XMPP_BAD_REQUEST_FOR_COLLECTION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_FOR_COLLECTION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.XMPP_NOT_FOUND_FOR_COLLECTION?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_FOR_COLLECTION:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.SERVER_DID_NOT_SEND_ALL_PATCHES?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.SERVER_DID_NOT_SEND_ALL_PATCHES:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.TERMINAL_PATCH_MISSING_DATA?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_MISSING_DATA:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.TERMINAL_PATCH_DESERIALIZATION_ERROR?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_DESERIALIZATION_ERROR:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.TERMINAL_PATCH_UNKNOWN?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_UNKNOWN:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.INVALID_ACTION_INDEX?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.XMPP_BAD_REQUEST_GLOBAL_ERROR?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_GLOBAL_ERROR:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.XMPP_NOT_FOUND_GLOBAL_ERROR?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_GLOBAL_ERROR:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.XMPP_BAD_METHOD_GLOBAL_ERROR?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_METHOD_GLOBAL_ERROR:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY:e===o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_KEY_ON_ALL_CLIENTS?o("WAWebWamEnumMdSyncdFatalErrorCode").MD_SYNCD_FATAL_ERROR_CODE.MISSING_KEY_ON_ALL_CLIENTS:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}l.convertSyncdErrorCode=e}),98);
__d("WAWebSyncdStoreMissingKeys",["Promise","WAAsyncSleep","WALogger","WATimeUtils","WAWebBackendApi","WAWebGetMissingKey","WAWebGetSyncKey","WAWebRunInTransaction","WAWebSyncdCryptoUtils","WAWebSyncdGatingUtils","WAWebSyncdMetricFatalError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S;function R(){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=(yield o("WAWebBackendApi").frontendSendAndReceive("getDeviceFingerprint",{})).deviceIndexes;return o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=t.MissingKeyStore,o=yield r.getAll();if(o.length===0)return(v||(v=n("Promise"))).resolve();o.forEach(function(t){var n=t.deviceResponses;n.forEach(function(n,r){e.includes(r)||t.deviceResponses.delete(r)})}),yield r.bulkUpdate(o),yield N({MissingKeyStore:r})});return function(e){return t.apply(this,arguments)}})())}),L.apply(this,arguments)}function E(t,r){var a=[],i=[];return t.forEach(function(e){var t=e.keyData,n=o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e.keyId);t?a.push(n):i.push(n)}),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeys from device ","\n    	keys with keyData: ","\n    	keys without keyData: ",""],["syncd: updateMissingKeys from device ","\n    \\tkeys with keyData: ","\n    \\tkeys without keyData: ",""])),r,a,i),o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.MissingKeyStore;if(a.length>0&&(yield t.bulkRemove(a),yield I({MissingKeyStore:t})),i.length>0){var n=(yield t.bulkGet(i)).filter(Boolean);n.forEach(function(e){return e.deviceResponses.set(r,!1)}),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeys: begin updating missing keys from device ","\n      	missingKeys: [","]"],["syncd: updateMissingKeys: begin updating missing keys from device ","\n      \\tmissingKeys: [","]"])),r,i),yield t.bulkUpdate(n),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeys: finish updating missing keys from device ",""])),r),yield N({MissingKeyStore:t})}});return function(t){return e.apply(this,arguments)}})())}function k(){return o("WAWebRunInTransaction").runInTransaction({MissingKeyStore:!0},function(e){var t=e.MissingKeyStore;return I({MissingKeyStore:t})})}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.MissingKeyStore;clearTimeout(S),S=null;var n=yield t.getAll();if(n.length!==0){o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["syncd: _setMissingKeyTimeout: missing keys: ",""])),n.map(function(e){return o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e.keyId)}));var r=n.reduce(function(e,t){return e.timestamp<t.timestamp?e:t}),a=o("WAWebSyncdGatingUtils").getSyncdWaitForKeyTimeoutDays()*o("WATimeUtils").DAY_MILLISECONDS-(-r.timestamp+o("WATimeUtils").unixTimeMs());o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["syncd: earliest missing key: ",", timestamp=",", timeoutMs=",""])),o("WAWebSyncdCryptoUtils").syncKeyIdToHex(r.keyId),r.timestamp,a),S=setTimeout(D,a)}}),T.apply(this,arguments)}function D(){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["syncd: _timeoutWhileWaitingForMissingKey"]))),!(yield $())){o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["syncd: _timeoutWhileWaitingForMissingKey: no expired keys"])));return}o("WAWebSyncdMetricFatalError").reportSyncdFatalError(o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY),o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: timeout while waiting for missing key"]))).sendLogs("syncd fatal error: timeout while waiting for missing key"),o("WAWebBackendApi").frontendFireAndForget("handleSyncdFatal",{})}),x.apply(this,arguments)}function $(){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["syncd: check if has expired keys"])));var e=(yield o("WAWebGetSyncKey").getAllSyncKeysInTransaction()).map(function(e){return o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e.keyId)});o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["syncd: all keys: ",""])),e);var t=yield o("WAWebGetMissingKey").getAllMissingKeysInTransaction();o("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing keys: ",""])),t.map(function(e){return o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e.keyId)}));var n=t.filter(function(t){return!e.includes(t.keyHex)});o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["syncd: actually missing keys: ",""])),t.map(function(e){return o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e.keyId)}));var r=n.filter(function(e){return o("WAWebSyncdGatingUtils").getSyncdWaitForKeyTimeoutDays()*o("WATimeUtils").DAY_MILLISECONDS<o("WATimeUtils").unixTimeMs()-e.timestamp});return o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["syncd: expired keys: ",""])),r.map(function(e){return o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e.keyId)})),r.length>0}),P.apply(this,arguments)}function N(e){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.MissingKeyStore,n=yield t.getAll();for(var r of n){var a=!0;for(var i of r.deviceResponses.values())if(i==null){a=!1;break}if(a){o("WALogger").ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: missing key on all clients"]))).sendLogs("syncd: fatal error: missing key on all clients"),o("WAWebSyncdMetricFatalError").reportSyncdFatalError(o("WAWebSyncdMetricFatalError").SyncdFatalErrorType.MISSING_KEY_ON_ALL_CLIENTS),yield o("WAAsyncSleep").asyncSleep(5e3),o("WAWebBackendApi").frontendFireAndForget("handleSyncdFatal",{});return}}}),M.apply(this,arguments)}function w(e,t){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=function(){var e=new Map;return t.forEach(function(t){return e.set(t,null)}),e},r=e.map(function(e){return{keyHex:o("WAWebSyncdCryptoUtils").syncKeyIdToHex(e),keyId:e,timestamp:o("WATimeUtils").unixTimeMs(),deviceResponses:n()}});yield o("WAWebGetMissingKey").bulkUpdateMissingKeysInTransaction(r),yield k()}),A.apply(this,arguments)}l.updateMissingKeyDevices=R,l.updateMissingKeys=E,l.setMissingKeyTimeoutInTransaction=k,l.hasExpiredKeys=$,l.addMissingKeys=w}),98);
__d("WAWebIdentityUpdateDeviceTableApi",["Promise","WAJids","WALogger","WAWebAdvDeviceNotificationApi","WAWebAdvUpdateParticipantApi","WAWebApiContact","WAWebApiDeviceList","WAWebApiGetDeviceUpdateLock","WAWebBackendApi","WAWebBizCoexGatingUtils","WAWebBizCoexHostedAddVerification","WAWebBizCoexUtils","WAWebDBEncryptMultipleMsgs","WAWebDBStoreEncryptedMsgs","WAWebDeviceListPk","WAWebGetMessageCache","WAWebProtobufsAdv.pb","WAWebSignalSessionApi","WAWebSyncdStoreMissingKeys","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p;function _(e,t){if(o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled())return e==null?t===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED?t:null:e===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED?t===o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE?t:null:e===o("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE?t===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED?t:null:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})();if(t===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED)throw r("err")("Unexpected account type");return null}function f(e,t,n,r,o){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,u){i===void 0&&(i=!1),yield(p||(p=n("Promise"))).all(a.filter(function(e){return e.id!==o("WAJids").DEFAULT_DEVICE_ID}).map(function(e){return v(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(t.user,t.server,e.id))}));var c=[],d=a.map(function(e){return e.id}).filter(function(e){return e!==o("WAJids").DEFAULT_DEVICE_ID}),m=_(l,u);o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&m===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["clearDeviceRecord: check coex cache for ",""])),t==null?void 0:t.toLogString()),o("WAWebBizCoexHostedAddVerification").assertThrowsWidAdvTypeFromVerificationCache(t),yield o("WAWebUserPrefsMultiDevice").setHaveProcessedCoexAdv());var f=yield C([{wid:t,added:c,removed:d,isNewRecord:!1,newAdvAccountType:m}],i,m!=null),g=f.chatIds,h=f.encryptedNotifications;yield o("WAWebApiGetDeviceUpdateLock").getDeviceUpdateLock(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=h.length>0?o("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(h,[],g,!1):(p||(p=n("Promise"))).resolve(),a=o("WAWebAdvUpdateParticipantApi").updateGroupParticipantsInTransaction(t,c,d),i={id:o("WAWebDeviceListPk").createDeviceListPK(t),deleted:!0};o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&m===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(i.deletedChangedToHost=!0);var l=o("WAWebApiDeviceList").createOrReplaceDeviceRecord(i).catch(function(e){throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["remove from device list table failed"]))).verbose().sendLogs("remove from device list table failed when clearing device record"),r("err")("remove from device list table failed")}),u=(p||(p=n("Promise"))).resolve();o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&m!=null&&(u=o("WAWebApiContact").updateContactAdvHostedType(t,m)),yield p.all([e,a,l,u])}),h.length>0,!1,m!=null),o("WAWebBizCoexUtils").sendWamCoexPrivacySysMsgInsertSuccess(h)}),g.apply(this,arguments)}function h(e,t,n){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a){t===void 0&&(t=!1),a===void 0&&(a=!1);var i=[],l=[],s=!1,m=!1,f=!1;e.forEach(function(e){var t=e.currentRecord,n=e.update,r=e.wid,a=n.devices,c=a.map(function(e){return e.id}),d=t&&!t.deleted?t.devices.map(function(e){return e.id}):[],p=Array.from(new Set(c).difference(new Set(d))).filter(function(e){return e!==o("WAJids").DEFAULT_DEVICE_ID}),g=Array.from(new Set(d).difference(new Set(c))).filter(function(e){return e!==o("WAJids").DEFAULT_DEVICE_ID}),h=t==null,y=o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()?_(t==null?void 0:t.advAccountType,n==null?void 0:n.advAccountType):null;o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&y===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["bulkApplyDeviceUpdates: check coex cache for ",""])),r==null?void 0:r.toLogString()),o("WAWebBizCoexHostedAddVerification").assertThrowsWidAdvTypeFromVerificationCache(r)),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(y!=null&&(m=!0),y===o("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(f=!0)),i.push({wid:r,added:p,removed:g,isNewRecord:h,newAdvAccountType:y}),g.forEach(function(e){l.push(o("WAWebWidFactory").createDeviceWidFromUserAndDevice(r.user,r.server,e))}),o("WAWebDeviceListPk").createDeviceListPK(r)===o("WAWebDeviceListPk").createDeviceListPK(o("WAWebUserPrefsMeUser").getMePnUserOrThrow())&&g.length>0&&(s=!0)}),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&f===!0&&(yield o("WAWebUserPrefsMultiDevice").setHaveProcessedCoexAdv());var g=yield C(i,t,(t||a)&&m),h=g.chatIds,y=g.encryptedNotifications;(p||(p=n("Promise"))).all(l.map(function(e){return v(e)}));var b=o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(y==null?void 0:y.length)>0;yield o("WAWebApiGetDeviceUpdateLock").getDeviceUpdateLock(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=y.length>0?o("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(y,[],h,!1):(p||(p=n("Promise"))).resolve(),a=o("WAWebAdvUpdateParticipantApi").bulkUpdateGroupParticipantsInTransaction(i),l=o("WAWebApiDeviceList").bulkCreateOrReplaceDeviceRecord(e.map(function(e){return e.update})).catch(function(e){throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["bulkCreateOrReplace into device list table failed"]))).verbose().sendLogs("bulkCreateOrReplace into device list table failed when applying device update"),r("err")("bulkCreateOrReplace into device list table failed")}),u=s?l.then(function(){return o("WAWebSyncdStoreMissingKeys").updateMissingKeyDevices().catch(function(e){o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeyDevices failed with error:\n        ",""])),e)})}):(p||(p=n("Promise"))).resolve(),m=[];o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&b&&i.forEach(function(e){var t=e.newAdvAccountType,n=e.wid;t!=null&&m.push(o("WAWebApiContact").updateContactAdvHostedType(n,t))}),yield(p||(p=n("Promise"))).all([t,a,l,u].concat(m))}),y.length>0,s,b),o("WAWebBizCoexUtils").sendWamCoexPrivacySysMsgInsertSuccess(y)}),y.apply(this,arguments)}function C(e,t,n){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){n===void 0&&(n=!1);var r=o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&n,a=r===!0?yield o("WAWebAdvDeviceNotificationApi").bulkGenerateDeviceAndAdvAccountTypeChangeNotifications(e):{notifications:[],chatIds:[]},i=a.chatIds,l=a.notifications,s=r&&l.some(function(e){return o("WAWebBizCoexUtils").isCoexSystemMsgType(e.subtype)});if(!t||s){var u=yield o("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(l);return R(l),{chatIds:i,encryptedNotifications:u}}return o("WAWebGetMessageCache").getMessageCache().addMessages(l.map(function(e){return{msg:e}}),!1),{chatIds:[],encryptedNotifications:[]}}),b.apply(this,arguments)}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{yield(p||(p=n("Promise"))).all([o("WAWebSignalSessionApi").deleteRemoteInfo(e),o("WAWebSignalSessionApi").deleteDeviceSenderKey(e)])}catch(t){o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification: failed to clean the signal info for ",""])),e.user)}}),S.apply(this,arguments)}function R(e){return(p||(p=n("Promise"))).all(e.map(function(e){return o("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:e.from,msgObjs:[babelHelpers.extends({},e,{recvFresh:!0,isNewMsg:!0})],meta:{add:"after",isHistory:!1},processMessagesOrigin:"updateDeviceTableApi"})}))}l.clearDeviceRecord=f,l.bulkApplyDeviceUpdate=h}),98);
__d("WAWebWamEnumPushNotificationInteractions",[],(function(t,n,r,o,a,i){var e=Object.freeze({SHOWN:1,CLICKED:2});i.PUSH_NOTIFICATION_INTERACTIONS=e}),66);
__d("WAWebWamEnumWebNotificationSettingType",[],(function(t,n,r,o,a,i){var e=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3});i.WEB_NOTIFICATION_SETTING_TYPE=e}),66);
__d("WAWebWamEnumOffboardSources",[],(function(t,n,r,o,a,i){var e=Object.freeze({IN_APP_SETTING:1,OS_SETTING:2});i.OFFBOARD_SOURCES=e}),66);
__d("WAWebWamEnumOnboardSources",[],(function(t,n,r,o,a,i){var e=Object.freeze({DEFAULT:1,BACKGROUND_SYNC_BUTTERBAR:2,WEB_NOTIFICATION_BUTTERBAR:3,IN_APP_SETTING:4,AUTO_ENABLE:5});i.ONBOARD_SOURCES=e}),66);
__d("WAWebWebcBackgroundSyncAdoptionWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOffboardSources","WAWebWamEnumOnboardSources","WAWebWamEnumPushNotificationInteractions","WAWebWamEnumWebNotificationSettingType"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({WebcBackgroundSyncAdoption:[5302,{offboardSource:[1,o("WAWebWamEnumOffboardSources").OFFBOARD_SOURCES],onboardSource:[2,o("WAWebWamEnumOnboardSources").ONBOARD_SOURCES],pushNotificationInteraction:[3,o("WAWebWamEnumPushNotificationInteractions").PUSH_NOTIFICATION_INTERACTIONS],webOsNotificationSetting:[4,o("WAWebWamEnumWebNotificationSettingType").WEB_NOTIFICATION_SETTING_TYPE]},[1,1,1],"regular"]},{WebcBackgroundSyncAdoption:[]});l.WebcBackgroundSyncAdoptionWamEvent=e}),98);
__d("WAWebBackgroundSyncReporter",["WAWebUserPrefsGeneral","WAWebWamEnumPushNotificationInteractions","WAWebWamEnumWebNotificationSettingType","WAWebWebcBackgroundSyncAdoptionWamEvent","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t,n,r=yield o("WAWebUserPrefsGeneral").getOfflineNotificationEngagement(),a=((t=r==null?void 0:r.totalNotifShown)!=null?t:0)>0,i=((n=r==null?void 0:r.totalNotifTapToOpen)!=null?n:0)>0;i?e=o("WAWebWamEnumPushNotificationInteractions").PUSH_NOTIFICATION_INTERACTIONS.CLICKED:a&&(e=o("WAWebWamEnumPushNotificationInteractions").PUSH_NOTIFICATION_INTERACTIONS.SHOWN)}),u.apply(this,arguments)}function c(t){var n,r,a=t.offboardSource,i=t.onboardSource,l=o("WAWebWamEnumWebNotificationSettingType").WEB_NOTIFICATION_SETTING_TYPE.UNKNOWN;((n=window.Notification)==null?void 0:n.permission)==="granted"?l=o("WAWebWamEnumWebNotificationSettingType").WEB_NOTIFICATION_SETTING_TYPE.ALLOWED:((r=window.Notification)==null?void 0:r.permission)==="denied"&&(l=o("WAWebWamEnumWebNotificationSettingType").WEB_NOTIFICATION_SETTING_TYPE.BLOCKED);var s=new(o("WAWebWebcBackgroundSyncAdoptionWamEvent")).WebcBackgroundSyncAdoptionWamEvent;s.set({offboardSource:a,onboardSource:i,pushNotificationInteraction:e,webOsNotificationSetting:l}),s.commit()}l.setPushNotificationInteractionStatus=s,l.logBackgroundSyncAdoptionEvent=c}),98);
__d("WAWebNotificationConstants",[],(function(t,n,r,o,a,i){var e="granted",l="default",s="denied";i.PERMISSION_ALLOWED=e,i.PERMISSION_DEFAULT=l,i.PERMISSION_DENIED=s}),66);
__d("WAWebUserPrefsNotifications",["WATimeUtils","WAWebBackgroundSyncReporter","WAWebEnvironment","WAWebNotificationConstants","WAWebPrivacySettings","WAWebUserPrefsGeneral","WAWebUserPrefsKeys","WAWebUserPrefsStore","WAWebWamEnumOnboardSources","cr:5151"],(function(t,n,r,o,a,i,l){function e(){return r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_SOUNDS)!==!0}function s(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_SOUNDS,!e)}function u(){return r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_CALL_RINGTONE)!==!0}function c(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_CALL_RINGTONE,!e)}function d(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_NOTIFICATIONS);if(typeof e!="boolean"){var t;return r("WAWebEnvironment").isWindows?!0:((t=window.Notification)==null?void 0:t.permission)===o("WAWebNotificationConstants").PERMISSION_ALLOWED}return!e}function m(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_NOTIFICATIONS,!e)}function p(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_CALL_NOTIFICATIONS);return typeof e!="boolean"?!0:!e}function _(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_CALL_NOTIFICATIONS,!e)}function f(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED);if(typeof e!="boolean"){var t,n=((t=window.Notification)==null?void 0:t.permission)===o("WAWebNotificationConstants").PERMISSION_ALLOWED;return n&&o("WAWebBackgroundSyncReporter").logBackgroundSyncAdoptionEvent({offboardSource:null,onboardSource:o("WAWebWamEnumOnboardSources").ONBOARD_SOURCES.DEFAULT}),n}return e}function g(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED,e)}function h(){var e=o("WAWebUserPrefsGeneral").getUserPrivacySettings();return r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.SECURITY_NOTIFICATIONS)!==!0||e.defenseMode!=null&&e.defenseMode!==o("WAWebPrivacySettings").DEFENSE_MODE_STATE.off}function y(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.SECURITY_NOTIFICATIONS,!e)}var C={isDismissed:!1,firstSeenTime:null,lastDismissTime:null};function b(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.WEB_NOTIFICATIONS_BB_STATUS);if(e==null||typeof e!="object"||e instanceof Array)return C;var t={isDismissed:e.isDismissed===!0,firstSeenTime:typeof e.firstSeenTime=="number"?o("WATimeUtils").castToUnixTime(e.firstSeenTime):null,lastDismissTime:typeof e.lastDismissTime=="number"?o("WATimeUtils").castToUnixTime(e.lastDismissTime):null};return t}function v(e){var t,n,a=b(),i=a.firstSeenTime,l=i===void 0?null:i,s=a.lastDismissTime,u=s===void 0?null:s,c=(t=e.firstSeenTime)!=null?t:l,d=(n=e.lastDismissTime)!=null?n:u;r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.WEB_NOTIFICATIONS_BB_STATUS,{isDismissed:e.isDismissed,firstSeenTime:c,lastDismissTime:d})}var S={isDismissed:!1,firstSeenTime:null,isLongResumeTime:!1};function R(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.OFFLINE_NOTIFICATIONS_BB_STATUS);if(e==null||typeof e!="object"||e instanceof Array)return S;var t={isDismissed:e.isDismissed===!0,firstSeenTime:typeof e.firstSeenTime=="number"?o("WATimeUtils").castToUnixTime(e.firstSeenTime):null,isLongResumeTime:e.isLongResumeTime===!0};return t}function L(e){var t,n,a,i=R(),l=i.firstSeenTime,s=l===void 0?null:l,u=i.isDismissed,c=u===void 0?!1:u,d=i.isLongResumeTime,m=d===void 0?!1:d,p=(t=e.isDismissed)!=null?t:c,_=(n=e.firstSeenTime)!=null?n:s,f=(a=e.isLongResumeTime)!=null?a:m;r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.OFFLINE_NOTIFICATIONS_BB_STATUS,{isDismissed:p,firstSeenTime:_,isLongResumeTime:f})}function E(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_PREVIEWS);return typeof e!="boolean"&&r("WAWebEnvironment").isWindows?!0:e!==!0}function k(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_PREVIEWS,!e)}function I(){return n("cr:5151")?r("WAWebUserPrefsStore").getUser(n("cr:5151").IGNORE_NONDIRECT_GROUP_MSG)===!0:!1}function T(e){n("cr:5151")&&r("WAWebUserPrefsStore").setUser(n("cr:5151").IGNORE_NONDIRECT_GROUP_MSG,e)}function D(){return r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.OUTGOING_MESSAGE_SOUND)===!0}function x(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.OUTGOING_MESSAGE_SOUND,e)}function $(){return r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_COLLAPSE_MUTED)===!0}function P(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_COLLAPSE_MUTED,e)}function N(){return r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED_ONCE)===!0}function M(){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED_ONCE,!0)}function w(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_NOTIFICATIONS_ENABLED);return typeof e!="boolean"?d():e}function A(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_NOTIFICATIONS_ENABLED,e)}function F(e){var t=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_NOTIFICATION_REACTIONS_ENABLED);return typeof t!="boolean"?e!=null?e:!1:t}function O(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_NOTIFICATION_REACTIONS_ENABLED,e)}function B(){var t=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_SOUNDS_ENABLED);return typeof t!="boolean"?e():t}function W(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_SOUNDS_ENABLED,e)}function q(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_GROUP_NOTIFICATIONS_ENABLED);return typeof e!="boolean"?w():e}function U(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_GROUP_NOTIFICATIONS_ENABLED,e)}function V(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_GROUP_NOTIFICATION_REACTIONS_ENABLED);return typeof e!="boolean"?F():e}function H(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_GROUP_NOTIFICATION_REACTIONS_ENABLED,e)}function G(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_GROUP_SOUNDS_ENABLED);return typeof e!="boolean"?B():e}function z(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_GROUP_SOUNDS_ENABLED,e)}function j(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_STATUS_NOTIFICATIONS_ENABLED);return typeof e!="boolean"?w():e}function K(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_STATUS_NOTIFICATIONS_ENABLED,e)}function Q(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_STATUS_NOTIFICATION_REACTIONS_ENABLED);return typeof e!="boolean"?F():e}function X(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_STATUS_NOTIFICATION_REACTIONS_ENABLED,e)}function Y(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_STATUS_SOUNDS_ENABLED);return typeof e!="boolean"?B():e}function J(e){r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").KEYS.GLOBAL_STATUS_SOUNDS_ENABLED,e)}var Z={isDismissed:!1,dismissedTime:null};function ee(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").KEYS.NOTIFICATIONS_GRANULARITY_AWARENESS_BANNER_STATUS);if(e==null||typeof e!="object"||e instanceof Array)return Z;var t={isDismissed:e.isDismissed===!0,dismissedTime:typeof e.dismissedTime=="number"?o("WATimeUtils").castToUnixTime(e.dismissedTime):null};return t}l.getGlobalSounds=e,l.setGlobalSounds=s,l.getGlobalCallRingtone=u,l.setGlobalCallRingtone=c,l.getGlobalNotifications=d,l.setGlobalNotifications=m,l.getGlobalCallNotifications=p,l.setGlobalCallNotifications=_,l.getGlobalOfflineNotifications=f,l.setGlobalOfflineNotifications=g,l.getGlobalSecurityNotifications=h,l.setGlobalSecurityNotifications=y,l.DEFAULT_NOTIFICATION_BB_STATUS=C,l.getWebNotificationsBBStatus=b,l.setWebNotificationsBBStatus=v,l.DEFAULT_OFFLINE_NOTIFICATION_BB_STATUS=S,l.getOfflineNotificationsBBStatus=R,l.setOfflineNotificationsBBStatus=L,l.getGlobalPreviews=E,l.setGlobalPreviews=k,l.getIgnoreNondirectGroupMsg=I,l.setIgnoreNondirectGroupMsg=T,l.getOutgoingMessageSound=D,l.setOutgoingMessageSound=x,l.getCollapseMuted=$,l.setCollapseMuted=P,l.getOfflineNotificationsEnabledOnce=N,l.setOfflineNotificationsEnabledOnce=M,l.getGlobalNotificationsEnabled=w,l.setGlobalNotificationsEnabled=A,l.getGlobalNotificationReactionsEnabled=F,l.setGlobalNotificationReactionsEnabled=O,l.getGlobalSoundsEnabled=B,l.setGlobalSoundsEnabled=W,l.getGlobalGroupNotificationsEnabled=q,l.setGlobalGroupNotificationsEnabled=U,l.getGlobalGroupNotificationReactionsEnabled=V,l.setGlobalGroupNotificationReactionsEnabled=H,l.getGlobalGroupSoundsEnabled=G,l.setGlobalGroupSoundsEnabled=z,l.getGlobalStatusNotificationsEnabled=j,l.setGlobalStatusNotificationsEnabled=K,l.getGlobalStatusNotificationReactionsEnabled=Q,l.setGlobalStatusNotificationReactionsEnabled=X,l.getGlobalStatusSoundsEnabled=Y,l.setGlobalStatusSoundsEnabled=J,l.getNotificationsGranularityAwarenessBannerStatus=ee}),98);
__d("WAWebSecurityCodeApi",["WALogger","WAWebApiContact","WAWebBackendApi","WAWebContactSystemMsg","WAWebDBEncryptMultipleMsgs","WAWebDBStoreEncryptedMsgs","WAWebGetMessageCache","WAWebSchemaChat","WAWebSchemaGroupMetadata","WAWebSchemaParticipant","WAWebUserPrefsNotifications","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.offline,r=t.stanzaLid,a=t.user;if(!a.isBot()){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["addSecurityCodeChangedNotifications"])));var i=null;a.isLid()?i=o("WAWebApiContact").getPnIfLidIsLatestMapping(a):a.isRegularUser()&&r!=null&&(i=r);var l=yield d(a,i),s=l.notifications,u=l.chatIds;if(s.length!==0){if(!n){s=s.map(function(e){return babelHelpers.extends({},e,{recvFresh:!0,isNewMsg:!0})});for(var c of s)o("WAWebBackendApi").frontendFireAndForget("processMultipleMessages",{chatId:c.from,msgObjs:[c],meta:{add:"after",isHistory:!1},processMessagesOrigin:"securityCodeApi"});var m=yield o("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(s);return yield o("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(m,u,!1),l}return o("WAWebGetMessageCache").getMessageCache().addMessages(s.map(function(e){return{msg:e}}),!1),l}}}),c.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n={notifications:[],chatIds:[]},a=t==null?[e]:[e,t];if(!o("WAWebUserPrefsNotifications").getGlobalSecurityNotifications())return n;var i=[];try{var l=(yield o("WAWebSchemaChat").getChatTable().bulkGet(a.map(function(e){return e.toString()}),!1)).filter(Boolean);i.push.apply(i,l.map(function(e){return{chatId:o("WAWebWidFactory").createWid(e.id),codeChangedUser:o("WAWebWidFactory").createUserWidOrThrow(e.id)}}));var u=yield o("WAWebSchemaParticipant").getParticipantTable().anyOf(["participants"],a.map(String)),c=new Map;if(u.length>0){var d=u.map(function(e){return e.groupId});(yield o("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkGet(d)).forEach(function(e){e!=null&&c.set(e.id,e)})}u.forEach(function(t){var n=c.get(t.groupId);n!=null&&n.defaultSubgroup&&e.isLid()||i.push({chatId:o("WAWebWidFactory").createWid(t.groupId),codeChangedUser:e})})}catch(e){throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["get chats failed"]))).verbose().sendLogs("get chats failed when creating device notification"),r("err")("get chats failed")}var m=i.map(function(e){var t=e.chatId,n=e.codeChangedUser;return o("WAWebContactSystemMsg").genSecurityCodeNotificationMsg(t,n)});return n.notifications=m,n.chatIds=i.map(function(e){var t=e.chatId;return t.toString()}),n}),m.apply(this,arguments)}l.addSecurityCodeChangedNotifications=u,l.generateSecurityCodeChangedNotifications=d}),98);
__d("WAWebDeviceSentMessageProtoUtils",[],(function(t,n,r,o,a,i){function e(e,t){var n=e==null?void 0:e.messageContextInfo;if(n==null){var r={deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:e}};return r}return{messageContextInfo:babelHelpers.extends({},n),deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:babelHelpers.extends({},e,{messageContextInfo:void 0})}}}function l(e){var t,n,r,o,a,i,l,s,u,c,d,m,p,_,f,g=e==null||(t=e.deviceSentMessage)==null?void 0:t.message;if(g==null)return null;var h=babelHelpers.extends({},g.messageContextInfo,{messageSecret:(n=g==null||(r=g.messageContextInfo)==null?void 0:r.messageSecret)!=null?n:e==null||(o=e.messageContextInfo)==null?void 0:o.messageSecret,messageAssociation:(a=g==null||(i=g.messageContextInfo)==null?void 0:i.messageAssociation)!=null?a:e==null||(l=e.messageContextInfo)==null?void 0:l.messageAssociation,limitSharingV2:e==null||(s=e.messageContextInfo)==null?void 0:s.limitSharingV2,threadId:(u=(c=g==null||(d=g.messageContextInfo)==null?void 0:d.threadId)!=null?c:e==null||(m=e.messageContextInfo)==null?void 0:m.threadId)!=null?u:[],botMetadata:(p=g==null||(_=g.messageContextInfo)==null?void 0:_.botMetadata)!=null?p:e==null||(f=e.messageContextInfo)==null?void 0:f.botMetadata});return babelHelpers.extends({},g,{messageContextInfo:h})}i.wrapDeviceSentMessage=e,i.unwrapDeviceSentMessage=l}),66);
__d("WAWebProtobufsEphemeral.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e={};e.name="EphemeralSetting",e.internalSpec={duration:[1,o("WAProtoConst").TYPES.SFIXED32],timestamp:[2,o("WAProtoConst").TYPES.SFIXED64]},l.EphemeralSettingSpec=e}),98);
__d("WAWebEphemeralDecodeBroadcastSetting",["WABase64","WABinary","WACustomError","WATimeUtils","WAWebProtobufsEphemeral.pb","asyncToGeneratorRuntime","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){var e=new Uint8Array(32);function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=yield self.crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveKey"]),o=yield self.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:e,info:n},r,{name:"HMAC",hash:"SHA-256"},!0,["verify"]);return self.crypto.subtle.exportKey("raw",o)}),u.apply(this,arguments)}function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.slice(0,12),o=e.slice(12,44),a=yield self.crypto.subtle.importKey("raw",o,"AES-GCM",!1,["decrypt"]);return self.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(r),additionalData:n},a,t)}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.broadcastJid,n=e.ephSetting,a=e.recipient,i=e.sender,l=e.sharedSecret,u=t.toString({legacy:!0}),d=a.toString({legacy:!0}),m=i.toString({legacy:!0}),p="Ephemeral "+d+" "+u,f=o("WABinary").Binary.build(p).readByteArrayView(),g=new Uint8Array(l),h=o("WABase64").decodeB64(n),y=o("WABinary").Binary.build(m).readBuffer(),C=yield s(g,f);try{var b=yield c(C,h,y),v=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsEphemeral.pb").EphemeralSettingSpec,b),S=v.duration,R=v.timestamp;if(S==null||R==null)throw r("err")("ephSetting decoded into malformed proto");return{ephemeralDuration:S,ephemeralSettingTimestamp:o("WATimeUtils").castLongIntToUnixTime(R)}}catch(e){throw new _(e instanceof Error?e.message:String(e))}}),p.apply(this,arguments)}var _=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="BroadcastEphSettingsError",n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError);l.deriveKey=s,l.decodeBroadcastEphemeralSetting=m,l.BroadcastEphSettingsError=_}),98);
__d("WAWebCtwaAGMUtils",["WALogger","WAWebBizGatingUtils","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s={URL:"url",CALL:"call",CATALOG:"catalog",FLOW:"flow"},u={FACEBOOK:"facebook",INSTAGRAM:"instagram",WHATSAPP:"whatsapp"};function c(t){if(t.ctaPayload==null)return null;try{var n,a=JSON.parse(t.ctaPayload);return{ctaType:a.cta_type,ctaText:a.cta_text,ctaPayload:(n=a.cta_payload)!=null?n:null}}catch(t){return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["drop: cannot parse CtWA CTA payload: ",""])),r("getErrorSafe")(t).stack),null}}function d(e){var t=o("WAWebBizGatingUtils").getFmxAgmEnabled();return o("WAWebBizGatingUtils").getWamoAgmEnabled()?t:t&&e!==u.WHATSAPP}l.AGM_CTA_TYPE=s,l.AGM_SOURCE_APP=u,l.extractAGMPayload=c,l.isWamoAGMIntegrationEnabled=d}),98);
__d("WAWebWamEnumCtwaBizUserJourneyOperation",[],(function(t,n,r,o,a,i){var e=Object.freeze({AGM_INJECTED:1,AGM_CTA_CLICKED:2,AGM_VIEW_DETAILS_CLICKED:3,AGM_BOTTOMSHEET_SHOWN:4,AGM_BOTTOMSHEET_CLOSED:5,AGM_BOTTOMSHEET_EXTERNAL_NAVIGATION:6,DUPLICATED_AGM_NOT_INJECTED:7,AGM_WELCOME_MESSAGE_NULL:8,AGM_INVALID_CTA_TYPE_FROM_MESSAGE:9,AGM_INVALID_CTA_PAYLOAD_FROM_MESSAGE:10,AGM_INVALID_SOURCE_APP_FROM_MESSAGE:11,AGM_BOTTOMSHEET_IMAGE_ERROR:12,AGM_BOTTOMSHEET_TEXT_ERROR:13,AD_PREVIEW_DEEPLINK_V1_CLICKED:14,AD_PREVIEW_FETCH_FROM_DEEPLINK_V2_STARTED:15,AD_PREVIEW_FETCH_FROM_DEEPLINK_V2_SUCCESS:16,AD_PREVIEW_FETCH_FROM_DEEPLINK_V2_FAILED:17,AD_PREVIEW_OPEN:18,AD_PREVIEW_CLOSE:19,AD_PREVIEW_RENDER_FAILED:20});i.CTWA_BIZ_USER_JOURNEY_OPERATION=e}),66);
__d("WAWebCtwaBizUserJourneyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCtwaBizUserJourneyOperation"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({CtwaBizUserJourney:[5992,{adId:[3,e.TYPES.STRING],bizFeatureEnabled:[4,e.TYPES.STRING],ctwaBizEventReason:[7,e.TYPES.STRING],ctwaBizUserJouneryEntryPoint:[6,e.TYPES.STRING],ctwaBizUserJourneyMetadata:[1,e.TYPES.STRING],ctwaBizUserJourneyOperation:[2,o("WAWebWamEnumCtwaBizUserJourneyOperation").CTWA_BIZ_USER_JOURNEY_OPERATION]},[1,1,1],"regular"]},{CtwaBizUserJourney:[]});l.CtwaBizUserJourneyWamEvent=s}),98);
__d("WAWebWamEnumCtwaAdVariantType",[],(function(t,n,r,o,a,i){var e=Object.freeze({CTWA:1,CAWC:2,WAMO:3});i.CTWA_AD_VARIANT_TYPE=e}),66);
__d("WAWebWamEnumCtwaChatCreationMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({JID:0,LID:1});i.CTWA_CHAT_CREATION_MODE=e}),66);
__d("WAWebWamEnumCtwaUserJourneyOperationType",[],(function(t,n,r,o,a,i){var e=Object.freeze({LAND_ON_WHATSAPP:1,GET_CONTEXT_CALL_INITIATED:2,GET_CONTEXT_CALL_SUCCESS:3,AD_CONTEXT_FALLBACK_RENDERED:4,AD_CONTEXT_DISMISSED:5,KILL_APP:6,BACK_BUTTON_CLICKED:7,CALL_BUSINESS_BUTTON_CLICKED:8,VIEW_CATALOG_BUTTON_CLICKED:9,PROFILE_PHOTO_CLICKED:10,BIZ_PROFILE_CLICKED:11,GET_CONTEXT_CALL_FAILED:12,CHAT_SETTINGS_CLICKED:13,FIRST_CUSTOM_MESSAGE_SENT_WITH_AD_CONTEXT:14,FIRST_CUSTOM_MESSAGE_SENT_WITHOUT_AD_CONTEXT:15,ICEBREAKER_SENT:16,AD_CONTEXT_FULLPREVIEW_RENDERED:17,TRUST_BANNER_SHOWN:18,TRUST_BANNER_DISMISSED:19,CTWA_ADD_CONTACT_DIALOG_OPEN:20,CTWA_ADD_CONTACT_CREATE_NEW:21,CTWA_ADD_CONTACT_EXISTING:22,CTWA_ARCHIVE_THREAD:23,CTWA_DELETE_THREAD:24,CTWA_PARSE_DEEP_LINK_START:25,CTWA_PARSE_DEEP_LINK_SUCCESS:26,CTWA_PARSE_DEEP_LINK_FAILURE:27,CTWA_CONSUMER_DISCLOSURE_SHOWN_BLOCKING:28,CTWA_CONSUMER_DISCLOSURE_SHOWN_NONBLOCKING:29,CTWA_CONSUMER_DISCLOSURE_NOT_SHOWN_ACCEPTED:30,CTWA_CONSUMER_DISCLOSURE_NOT_SHOWN_COOLDOWN:31,CTWA_CONSUMER_DISCLOSURE_NOT_SHOWN_OTHER:32,CTWA_CONSUMER_DISCLOSURE_ACCEPTED:33,CTWA_CONSUMER_DISCLOSURE_NOT_ACCEPTED:34,FIRST_MESSAGE_SENT_WITHOUT_AD_PAYLOAD:35,FIRST_MESSAGE_SENT_WITH_AD_PAYLOAD:36,CALL_SENT_WITHOUT_AD_PAYLOAD:37,CALL_SENT_WITH_AD_PAYLOAD:38,CTWA_CONSUMER_DISCLOSURE_SHOWN_INTHREAD_BLOCKING:39,CONSUMER_DISCLOSURE_NOT_SHOWN_EXEMPT:40,AGM_SPINNER_HIDES_FROM_GET_CONTEXT_COMPLETION:41,AGM_SPINNER_HIDES_FROM_USER_ACTION:42,AGM_SPINNER_HIDES_FROM_MAX_LOADING_TIME:43,AGM_INJECTED:44,AGM_CTA_CLICKED:45,AGM_VIEW_DETAILS_CLICKED:46,AGM_BOTTOMSHEET_SHOWN:47,AGM_BOTTOMSHEET_CLOSED:48,AGM_BOTTOMSHEET_EXTERNAL_NAVIGATION:49,DUPLICATED_AGM_NOT_INJECTED:50,AGM_WELCOME_MESSAGE_NULL:51,AGM_INVALID_CTA_TYPE_FROM_ACTION_LINK:52,AGM_INVALID_CTA_PAYLOAD_FROM_ACTION_LINK:53,AGM_INVALID_SOURCE_APP_FROM_ACTION_LINK:54,AGM_BOTTOMSHEET_IMAGE_ERROR:55,AGM_BOTTOMSHEET_TEXT_ERROR:56,AGM_SPINNER_SHOWN:57,LAND_ON_CHAT_THREAD:58,AD_CONTEXT_PREVIEW_CLICKED:60,BIZ_CONTEXT_CARD_CLICKED:61,BIZ_CONTEXT_CARD_INSERTED:62,BIZ_CONTEXT_CARD_EXIST:63,LAND_ON_EMPTY_CHAT_THREAD:64,AGM_NOT_INJECTED_TIMEOUT:65,AGM_NOT_INJECTED_OTHER:66,AGM_AD_PREVIEW_OPENED:67,AGM_AD_PREVIEW_CLOSED:68,BIZ_CONTEXT_CARD_NOT_INSERTED:69,GET_CONTEXT_CALL_SUCCESS_PROCESSED:70,AD_CONTEXT_NOT_SHOWN:71,AD_PREVIEW_MEDIA_NOT_AVAILABLE:72,AD_PREVIEW_MEDIA_URL_EXPIRED:73,CALL_CONFIRMATION_BOTTOMSHEET_SHOWN:74,CALL_CONFIRMATION_BOTTOMSHEET_DISMISSED:75,CALL_CONFIRMATION_BOTTOMSHEET_CLICKED:76,AD_PREVIEW_FETCH_FROM_DEEPLINK_V2_STARTED:77,AD_PREVIEW_FETCH_FROM_DEEPLINK_V2_SUCCESS:78,AD_PREVIEW_FETCH_FROM_DEEPLINK_V2_FAILED:79,AD_PREVIEW_DEEPLINK_V1_CLICKED:80});i.CTWA_USER_JOURNEY_OPERATION_TYPE=e}),66);
__d("WAWebWamEnumTrustBannerAction",[],(function(t,n,r,o,a,i){var e=Object.freeze({VIEWED:0,DISMISSED:1});i.TRUST_BANNER_ACTION=e}),66);
__d("WAWebCtwaUserJourneyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCtwaAdVariantType","WAWebWamEnumCtwaChatCreationMode","WAWebWamEnumCtwaUserJourneyOperationType","WAWebWamEnumTrustBannerAction"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({CtwaUserJourney:[3466,{adId:[1,e.TYPES.STRING],businessJid:[2,e.TYPES.STRING],ctwaAdVariant:[14,o("WAWebWamEnumCtwaAdVariantType").CTWA_AD_VARIANT_TYPE],ctwaChatCreationMode:[6,o("WAWebWamEnumCtwaChatCreationMode").CTWA_CHAT_CREATION_MODE],ctwaEventReason:[15,e.TYPES.STRING],ctwaUserJourneyMetadata:[12,e.TYPES.STRING],ctwaUserJourneyOperation:[3,o("WAWebWamEnumCtwaUserJourneyOperationType").CTWA_USER_JOURNEY_OPERATION_TYPE],elapsedTimeInMs:[13,e.TYPES.INTEGER],featureEnabled:[9,e.TYPES.STRING],icebreakersShown:[4,e.TYPES.BOOLEAN],sequenceNumber:[5,e.TYPES.INTEGER],threadCreationDate:[10,e.TYPES.STRING],threadIdHmac:[11,e.TYPES.STRING],trustBannerAction:[7,o("WAWebWamEnumTrustBannerAction").TRUST_BANNER_ACTION],trustBannerType:[8,e.TYPES.STRING]},[1,1,1],"private",113760892]},{CtwaUserJourney:[]});l.CtwaUserJourneyWamEvent=s}),98);
__d("WAWebCtwaLogger",["WAWebBizGatingUtils","WAWebCtwaBizUserJourneyWamEvent","WAWebCtwaUserJourneyWamEvent","WAWebLid1X1MigrationGating","WAWebLidMigrationUtils","WAWebWamEnumCtwaBizUserJourneyOperation","WAWebWamEnumCtwaUserJourneyOperationType"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=["agm"],d=c.join(", "),m={injected:"injected",duplicated:"duplicated",null_greeting_message:"null_greeting_message",invalid_source_app:"invalid_source_app",bottomsheet_text_error:"bottomsheet_text_error",agm_cta_clicked:"agm_cta_clicked",agm_bottomsheet_external_navigation:"agm_bottomsheet_external_navigation",agm_view_details_clicked:"agm_view_details_clicked",agm_bottom_sheet_shown:"agm_bottom_sheet_shown",agm_bottom_sheet_closed:"agm_bottom_sheet_closed",agm_invalid_cta_payload:"agm_invalid_cta_payload",agm_bottom_sheet_image_error:"agm_bottom_sheet_image_error"},p=(e={},e[m.injected]="AGM_INJECTED",e[m.duplicated]="DUPLICATED_AGM_NOT_INJECTED",e[m.null_greeting_message]="AGM_WELCOME_MESSAGE_NULL",e[m.bottomsheet_text_error]="AGM_BOTTOMSHEET_TEXT_ERROR",e[m.agm_cta_clicked]="AGM_CTA_CLICKED",e[m.agm_bottomsheet_external_navigation]="AGM_BOTTOMSHEET_EXTERNAL_NAVIGATION",e[m.agm_view_details_clicked]="AGM_VIEW_DETAILS_CLICKED",e[m.agm_bottom_sheet_shown]="AGM_BOTTOMSHEET_SHOWN",e[m.agm_bottom_sheet_closed]="AGM_BOTTOMSHEET_CLOSED",e[m.agm_bottom_sheet_image_error]="AGM_BOTTOMSHEET_IMAGE_ERROR",e),_=babelHelpers.extends({},p,(s={},s[m.invalid_source_app]="AGM_INVALID_SOURCE_APP_FROM_MESSAGE",s[m.agm_invalid_cta_payload]="AGM_INVALID_CTA_PAYLOAD_FROM_MESSAGE",s)),f=babelHelpers.extends({},p,(u={},u[m.invalid_source_app]="AGM_INVALID_SOURCE_APP_FROM_ACTION_LINK",u[m.agm_invalid_cta_payload]="AGM_INVALID_CTA_PAYLOAD_FROM_ACTION_LINK",u));function g(e){var t,n=e.adId,r=e.agmPayload,a=e.businessWid,i=e.fromBusiness,l=e.operationType,s={ctaType:(t=r==null?void 0:r.ctaType)!=null?t:null,adID:n};if(i){var c=_[l];y(babelHelpers.extends({},s,{operation:o("WAWebWamEnumCtwaBizUserJourneyOperation").CTWA_BIZ_USER_JOURNEY_OPERATION[c]}))}else{var u=f[l];h(babelHelpers.extends({},s,{businessPhoneNumber:a,operation:o("WAWebWamEnumCtwaUserJourneyOperationType").CTWA_USER_JOURNEY_OPERATION_TYPE[u]}))}}function h(e){if(o("WAWebBizGatingUtils").getFmxAgmEnabled()&&o("WAWebBizGatingUtils").getCtwaLogUserJourneyEnabled()){var t=e.adID,n=e.businessPhoneNumber,r=e.ctaType,a=e.operation;new(o("WAWebCtwaUserJourneyWamEvent")).CtwaUserJourneyWamEvent(babelHelpers.extends({adId:String(t),ctwaUserJourneyOperation:a},n!=null?{businessJid:b(n)}:null,{icebreakersShown:!1,ctwaUserJourneyMetadata:JSON.stringify({agm_cta_type:r}),featureEnabled:d})).commit()}}function y(e){if(o("WAWebBizGatingUtils").getFmxAgmEnabled()){var t=e.adID,n=e.ctaType,r=e.operation;new(o("WAWebCtwaBizUserJourneyWamEvent")).CtwaBizUserJourneyWamEvent({adId:String(t),ctwaBizUserJourneyOperation:r,bizFeatureEnabled:d,ctwaBizUserJourneyMetadata:JSON.stringify({agm_cta_type:n})}).commit()}}function C(e){return e!=null?e.toString():"null"}function b(e){var t=o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated(),n=t?o("WAWebLidMigrationUtils").toLid(e):null,r=n!=null?n:e;return C(r)}l.AGM_OPERATION_TYPE=m,l.logAGMOperation=g}),98);
__d("WAWebMsgAGMProcessing",["WALogger","WATimeUtils","WAWebCtwaAGMUtils","WAWebCtwaLogger","WAWebDBMessageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebSchemaMessage","WAWebViewMode.flow","asyncToGeneratorRuntime","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";var e,s=50;function u(e){var t=e.ctwaContext,n=e.from,r=e.msgKey,a=e.msgTimestamp,i=e.to;if(t.greetingMessageBody==null||t.automatedGreetingMessageShown!==!0||t.sourceId==null)return null;var l=a!=null?o("WATimeUtils").castToUnixTime(parseInt(a,10)):o("WATimeUtils").unixTimeMs(),s={id:r,t:l,type:o("WAWebMsgType").MSG_TYPE.AUTOMATED_GREETING_MESSAGE,kind:o("WAWebMsgType").MsgKind.AutomatedGreetingMessage,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,from:n,to:i,ctwaContext:t,body:t.greetingMessageBody};return s}function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=t.ctwaContext;try{if(a==null)return[t];var i=o("WAWebCtwaAGMUtils").extractAGMPayload(a),l=o("WAWebMsgGetters").getIsSentByMe(t);if(a.automatedGreetingMessageShown!==!0||a.sourceId==null)return[t];if(r("isStringNullOrEmpty")(a.greetingMessageBody))return o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.null_greeting_message,fromBusiness:!l,agmPayload:i,businessWid:t.to,adId:a.sourceId}),[t];if(a.sourceApp!=null&&!Object.values(o("WAWebCtwaAGMUtils").AGM_SOURCE_APP).includes(a.sourceApp))return o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.invalid_source_app,fromBusiness:!l,agmPayload:i,businessWid:t.to,adId:a.sourceId}),[t];(i==null?void 0:i.ctaType)!=null&&!Object.values(o("WAWebCtwaAGMUtils").AGM_CTA_TYPE).includes(i==null?void 0:i.ctaType)&&o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.agm_invalid_cta_payload,fromBusiness:!l,agmPayload:i,businessWid:t.to,adId:a.sourceId});var s=t.from,u=t.id,c=t.t,d=t.to,p=t.viewMode,f=s,g=d,h=yield m(n.chat),y=_(a==null?void 0:a.sourceId,h);if(y)return o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.duplicated,fromBusiness:!l,agmPayload:i,businessWid:g,adId:a.sourceId}),[t];var C={id:new(r("WAWebMsgKey"))({remote:n.chat,fromMe:!u.fromMe,id:yield r("WAWebMsgKey").newId()}),ctwaContext:a,body:a.greetingMessageBody,from:g,to:f,type:o("WAWebMsgType").MSG_TYPE.AUTOMATED_GREETING_MESSAGE,kind:o("WAWebMsgType").MsgKind.AutomatedGreetingMessage,viewMode:p,t:c!=null?c:o("WATimeUtils").unixTimeMs()};return o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.injected,fromBusiness:!l,agmPayload:i,businessWid:g,adId:a.sourceId}),r("isStringNullOrEmpty")(a.description)&&o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.bottomsheet_text_error,fromBusiness:!l,agmPayload:i,businessWid:g,adId:a.sourceId}),r("isStringNullOrEmpty")(a.originalImageUrl)&&o("WAWebCtwaLogger").logAGMOperation({operationType:o("WAWebCtwaLogger").AGM_OPERATION_TYPE.agm_bottom_sheet_image_error,fromBusiness:!l,agmPayload:i,businessWid:g,adId:a.sourceId}),[C,t]}catch(n){return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["generateAGMMsgs: cannot create MsgKey: ",""])),n),[t]}}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebDBMessageUtils").beginningOfChat(e),n=o("WAWebDBMessageUtils").endOfChat(e),r=yield o("WAWebSchemaMessage").getMessageTable().between(["internalId"],t,n,{lowerInclusive:!0,upperInclusive:!1,limit:s,reverse:!0});return r.filter(function(e){return e.type===o("WAWebMsgType").MSG_TYPE.AUTOMATED_GREETING_MESSAGE})}),p.apply(this,arguments)}function _(e,t){return e==null?!1:t.some(function(t){var n=t.ctwaContext;return n!=null&&n.sourceId===e})}l.genHistoryAutomatedGreetingMsg=u,l.generateAutomatedGreetingMsgs=c}),98);
__d("WAWebMsmsgMsgSecretCache",["WAWebBackendEventBus","WAWebLidMigrationUtils","WAWebMsgKey"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){var e=this;this.cache=new Map,o("WAWebBackendEventBus").BackendEventBus.onLogout(function(){return e.clearCache()})}var t=e.prototype;return t.addMsmsgMsgSecretToCache=function(t,n){this.cache.set(t,n)},t.getMsmsgMsgSecretFromCache=function(t){return this.cache.get(t)},t.clearCache=function(){this.cache=new Map},e})(),s=(function(){function e(){var e=this;this.cache=new Map,o("WAWebBackendEventBus").BackendEventBus.onLogout(function(){e.cache=new Map})}var t=e.prototype;return t.addMsmsgBotGroupGossipDataToCache=function(t,n){this.cache.set(t,n)},t.getMsmsgBotGroupGossipDataFromCache=function(t,n,a,i){var e=new(r("WAWebMsgKey"))({fromMe:t,remote:n,id:a,participant:i}).toString(),l=this.cache.get(e);if(l==null){var s,u=new(r("WAWebMsgKey"))({fromMe:t,remote:n,id:a,participant:(s=o("WAWebLidMigrationUtils").toPn(i))!=null?s:i}).toString();l=this.cache.get(u)}return l},t.deleteMsmsgBotGroupGossipDataFromCache=function(t){this.cache.delete(t)},e})(),u=new e,c=new s;l.msmsgMsgSecretCache=u,l.msmsgBotGroupGossipDataCache=c}),98);
__d("WAWebMsgProcessingApiUtils",["Promise","WAJids","WALogger","WANullthrows","WAWebABProps","WAWebAck","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebBizGatingUtils","WAWebBotGroupGatingUtils","WAWebBotUtils","WAWebBusinessHSMTypes","WAWebDBMessageSerialization","WAWebDeviceSentMessageProtoUtils","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebEphemeralDecodeBroadcastSetting","WAWebHandleMsgCommon","WAWebHandleMsgError","WAWebHandleMsgMetaUtils","WAWebHandleMsgTypes.flow","WAWebLidMigrationUtils","WAWebMarketingMessagesUserFeedbackGatingUtils","WAWebMsgAGMProcessing","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebMsmsgMsgSecretCache","WAWebSchemaMessage","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWamEnumDeviceType","WAWebWamEnumDsmError","WAWebWamMsgUtils","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err","getErrorSafe"],(function(t,n,r,o,a,i,l){var e=["msgProtobuf"],s=["msgProtobuf"],u=["msgProtobuf"],c=["decrypted","reparsing"],d,m,p,_,f;function g(e){var t,n,r,a,i,l,s,u="";((t=e.protocolMessage)==null?void 0:t.historySyncNotification)!=null?u="historySyncNotification":((n=e.protocolMessage)==null?void 0:n.initialSecurityNotificationSettingSync)!=null?u="initialSecurityNotificationSettingSync":((r=e.protocolMessage)==null?void 0:r.appStateSyncKeyRequest)!=null?u="appStateSyncKeyRequest":((a=e.protocolMessage)==null?void 0:a.appStateSyncKeyShare)!=null?u="appStateSyncKeyShare":((i=e.protocolMessage)==null?void 0:i.peerDataOperationRequestResponseMessage)!=null?u="peerDataOperationRequestResponseMessage":((l=e.protocolMessage)==null?void 0:l.peerDataOperationRequestMessage)!=null?u="peerDataOperationRequestMessage":((s=e.protocolMessage)==null?void 0:s.cloudApiThreadControlNotification)!=null&&(u="cloudApiThreadControlNotification"),o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["protocol message: wid error in type ",""])),u).sendLogs("wid error")}function h(e){var t,n,a,i,l,s,u,c=e.bizInfo,d=e.info,m=e.msgBotInfo,p=e.msgProtobuf,_=e.paymentInfo,f,h=V(d);if(!o("WAWebUserPrefsMeUser").isMeAccountNonLid(h)){g(p);return}if(((t=p.protocolMessage)==null?void 0:t.historySyncNotification)!=null){var y=o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:p,message:w(d),msgContext:"relay",paymentInfo:_,bizInfo:c});A(y,m),f={history:r("WANullthrows")(y.historySyncMetaData)}}else if(((n=p.protocolMessage)==null?void 0:n.initialSecurityNotificationSettingSync)!=null){var C;f={securityNotificationEnabled:{isEnabled:(C=p.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)!=null?C:!0}}}else if(((a=p.protocolMessage)==null?void 0:a.appStateSyncKeyShare)!=null)f={appStateSyncKeyShare:p.protocolMessage.appStateSyncKeyShare};else if(((i=p.protocolMessage)==null?void 0:i.appStateSyncKeyRequest)!=null)f={appStateSyncKeyRequest:p.protocolMessage.appStateSyncKeyRequest};else if(((l=p.protocolMessage)==null?void 0:l.peerDataOperationRequestResponseMessage)!=null){var b;f={peerDataOperationRequestResponseMessage:(b=p.protocolMessage)==null?void 0:b.peerDataOperationRequestResponseMessage}}else if(((s=p.protocolMessage)==null?void 0:s.peerDataOperationRequestMessage)!=null){var v;f={peerDataOperationRequestMessage:(v=p.protocolMessage)==null?void 0:v.peerDataOperationRequestMessage}}else if(((u=p.protocolMessage)==null?void 0:u.cloudApiThreadControlNotification)!=null){var S;f={cloudApiThreadControlNotification:(S=p.protocolMessage)==null?void 0:S.cloudApiThreadControlNotification}}return f}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,a,i,l,s,u,c,d=e.info,m=e.msgProtobuf;if(((t=m.protocolMessage)==null?void 0:t.historySyncNotification)!=null||((n=m.protocolMessage)==null?void 0:n.initialSecurityNotificationSettingSync)!=null||((a=m.protocolMessage)==null?void 0:a.appStateSyncKeyShare)!=null||((i=m.protocolMessage)==null?void 0:i.appStateSyncKeyRequest)!=null||((l=m.protocolMessage)==null?void 0:l.peerDataOperationRequestResponseMessage)!=null||((s=m.protocolMessage)==null?void 0:s.peerDataOperationRequestMessage)!=null||((u=m.protocolMessage)==null?void 0:u.cloudApiThreadControlNotification)!=null)return h({info:d,msgProtobuf:m,paymentInfo:e.paymentInfo,bizInfo:e.bizInfo,hsmInfo:e.hsmInfo});if(((c=m.protocolMessage)==null?void 0:c.lidMigrationMappingSyncMessage)!=null)return{lidMigrationSyncMessage:m.protocolMessage.lidMigrationMappingSyncMessage};switch(d.type){case o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT:return o("WAWebUserPrefsMeUser").isMeAccount(d.author)?S(e):k(e);case o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.GROUP:return d.isDirect&&o("WAWebUserPrefsMeUser").isMeAccount(d.author)&&!H(e)?S(e):k(e);case o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST:{if(e.ciphertextType===o("WAWebBackendJobs.flow").CiphertextType.Skmsg){if(!d.bclHashValidated)throw r("err")("parseMessage: participants for peer broadcast message is not validated");return k(e)}return L(e)}case o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST:return k(e);case o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.DIRECT_PEER_STATUS:return d.isDirect===!0?b(e):L(e);case o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS:return k(e);default:throw r("err")("Unrecognized MESSAGE_TYPE")}}),C.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{return yield S(e)}catch(n){if(n instanceof o("WAWebHandleMsgError").DeviceSentMessageError){var t=Object.keys(e.msgProtobuf).filter(function(e){return e!=="$$unknownFieldCount"&&e!=="messageContextInfo"});if(t.length===1&&t[0]==="senderKeyDistributionMessage")return k(e)}throw n}}),v.apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.msgProtobuf,r=babelHelpers.objectWithoutPropertiesLoose(t,e),a=n.deviceSentMessage;if(a==null)throw new(o("WAWebHandleMsgError")).DeviceSentMessageError(U(r.info.author),o("WAWebWamEnumDsmError").DSM_ERROR.MISSING_DSM);if(a.destinationJid==null)throw new(o("WAWebHandleMsgError")).DeviceSentMessageError(U(r.info.author),o("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM);var i=a.destinationJid,l=yield T(o("WAWebDeviceSentMessageProtoUtils").unwrapDeviceSentMessage(n),r);return babelHelpers.extends({deviceSent:{destination:o("WAWebWidFactory").createWid(i)}},l)}),R.apply(this,arguments)}function L(e){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.msgProtobuf,n=babelHelpers.objectWithoutPropertiesLoose(e,s),r=n.info,a=t.deviceSentMessage;if(a==null)throw new(o("WAWebHandleMsgError")).DeviceSentMessageError(U(r.author),o("WAWebWamEnumDsmError").DSM_ERROR.MISSING_DSM);if(a.phash==null)throw new(o("WAWebHandleMsgError")).DeviceSentMessageError(U(r.author),o("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM);var i=a.phash,l=yield T(o("WAWebDeviceSentMessageProtoUtils").unwrapDeviceSentMessage(t),n);return babelHelpers.extends({deviceSent:{phash:i,info:r}},l)}),E.apply(this,arguments)}function k(e){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.msgProtobuf,n=babelHelpers.objectWithoutPropertiesLoose(e,u);if(t.deviceSentMessage!=null)throw new(o("WAWebHandleMsgError")).DeviceSentMessageError(U(n.info.author),o("WAWebWamEnumDsmError").DSM_ERROR.INVALID_SENDER);var r=yield T(t,n);return babelHelpers.extends({deviceSent:null},r)}),I.apply(this,arguments)}function T(e,t){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a,i,l,s,u,d=t.bizInfo,m=t.hidePlaceholder,_=t.hsmInfo,f=t.info,g=t.isMessageRetry,h=t.isOffline,y=t.msgBotInfo,C=t.paymentInfo,b=t.processDecryptedProtoParams,v=t.protobufBytes,S=t.reportingTokenInfo;if(e==null)return{senderKey:null,storeMsg:null,renderableMsgs:[]};var R=babelHelpers.extends({},o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:e,message:w(f),msgContext:"relay",paymentInfo:C,bizInfo:d,editAttr:f.edit,rcat:b==null?void 0:b.rcat,bizSource:b==null||(n=b.msgMeta)==null?void 0:n.bizSource,msgMeta:b==null?void 0:b.msgMeta,msgBotInfo:y})),L=R,E=L.disappearingModeTrigger,k=(a=R.id.remote)!=null?a:R.from;if(k!=null&&r("WAWebWid").isGroup(k)&&E!=null&&o("WAWebABProps").getABPropConfigValue("dm_initiator_trigger_groups")){var I=yield o("WAWebE2EProtoUtils").updateDisappearingModeForGroups(E,k);I!=null&&(R=babelHelpers.extends({},R,I))}if(A(R,y,b==null||(i=b.msgMeta)==null?void 0:i.targetSenderJid,b==null||(l=b.msgMeta)==null?void 0:l.targetId),o("WAWebBotGroupGatingUtils").isOpenGroupBotParticipantAddEnabled()&&(b==null||(s=b.msgMeta)==null?void 0:s.targetId)!=null&&k!=null&&r("WAWebWid").isGroup(k))try{var T,D;yield F(R,k,b==null||(T=b.msgMeta)==null?void 0:T.targetSenderJid,b==null||(D=b.msgMeta)==null?void 0:D.targetId)}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[bot group] processBotGroupGossip failed with error: ",""])),e).sendLogs("failed-to-process-bot-group-gossip")}if(_!=null){var $=_.category,P=_.tag;R.hsmTag=P,R.hsmCategory=$,P===o("WAWebBusinessHSMTypes").HSM_TAG_TYPE.MARKETING&&o("WAWebMarketingMessagesUserFeedbackGatingUtils").triggerExposureMMUserControls()}if((b==null||(u=b.msgMeta)==null?void 0:u.bizSource)!=null){var N;R.bizSource=b==null||(N=b.msgMeta)==null?void 0:N.bizSource}var M=e.senderKeyDistributionMessage!=null?x(f,e.senderKeyDistributionMessage):null,O=R.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&M==null,W=R.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&M!=null,q=null;if(O&&b!=null){var U=b.decrypted,V=b.reparsing,H=babelHelpers.objectWithoutPropertiesLoose(b,c);R.futureproofParams=H,R.futureproofBuffer=U}if(f.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS&&(R.campaignId=f.campaignId,R.campaignDuration=f.campaignDuration),f.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST&&(R.broadcastId=f.chat,R.bclParticipants=f.bclParticipants,q=R),f.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST){var G;R.broadcastId=f.chat;var z=(G=f.preMatChat)!=null?G:f.author,j=f.ephSetting,K=R.ephemeralSharedSecret;if(j!=null&&K!=null){var Q=yield o("WAWebEphemeralDecodeBroadcastSetting").decodeBroadcastEphemeralSetting({broadcastJid:f.chat,recipient:z.isLid()?o("WAWebUserPrefsMeUser").getMeLidUserOrThrow():o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),sender:z,ephSetting:j,sharedSecret:K}),X=Q.ephemeralDuration,Y=Q.ephemeralSettingTimestamp;R.ephemeralDuration=X,R.ephemeralSettingTimestamp=Y}}var J=[],Z=R.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN,ee=W||Z&&m===!0&&R.futureproofType==null;return ee||(f.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?J=yield B(R,f.bclParticipants):(R.subtype==="payment_transaction_request_cancelled"||R.subtype==="payment_action_request_declined")&&R.paymentRequestMessageKey==null||(R.reportingTokenInfo=S,R.plainProtobufBytes=v,R.preMatChat=f.preMatChat,R.isRetry=g,R.isOffline=h,(f.author!==R.from||f.author!==R.author)&&(R.senderWithDevice=f.author),o("WAWebBizGatingUtils").shouldGenerateAGMMsgs(R.ctwaContext)?J=yield o("WAWebMsgAGMProcessing").generateAutomatedGreetingMsgs(R,f):J=[R])),{senderKey:M,storeMsg:q,renderableMsgs:J}}),D.apply(this,arguments)}function x(e,t){if(!e.chat.isGroup()&&!e.chat.isBroadcast())throw r("err")("should not have senderkey");var n=t.axolotlSenderKeyDistributionMessage,a=t.groupId;if(a==null||e.chat.toString({legacy:!0})!==a)throw o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["parseSenderKeyDistribution: expected: ",", got: ",""])),e.chat.toString(),a!=null?a:"null"),r("err")("parseSenderKeyDistribution: stanza group id mismatched with protobuf");if(!n)throw r("err")("senderKeyDistributionMessage: from "+e.author.toString()+" has no content");return{groupId:a,key:n}}function $(e){return!(e.edit===o("WAWebAck").EDIT_ATTR.SENDER_REVOKE&&e.type!==o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST||e.edit===o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE)}function P(e){var t=e.msgInfo,n=e.msgMeta,r=e.placeholderAddReason,a=e.placeholderType;if(!$(t))return null;var i=a===o("WAWebHandleMsgTypes.flow").PlaceholderType.E2E?void 0:a===o("WAWebHandleMsgTypes.flow").PlaceholderType.BOT_UNAVAILABLE_FANOUT?"bot_unavailable_fanout":a===o("WAWebHandleMsgTypes.flow").PlaceholderType.HOSTED_UNAVAILABLE_FANOUT?"hosted_unavailable_fanout":a===o("WAWebHandleMsgTypes.flow").PlaceholderType.VIEW_ONCE_UNAVAILABLE_FANOUT?"view_once_unavailable_fanout":a===o("WAWebHandleMsgTypes.flow").PlaceholderType.FANOUT?"fanout":(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+a)})(),l=o("WAWebHandleMsgMetaUtils").getMsgTypeFromMsgMeta(n),s=babelHelpers.extends({},w(t),{type:o("WAWebMsgType").MSG_TYPE.CIPHERTEXT,kind:o("WAWebMsgType").MsgKind.Ciphertext,subtype:i,e2eSenderType:o("WAWebWamMsgUtils").getWamE2eSenderType(t.author),placeholderAddReason:r,bclParticipants:t.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?t.bclParticipants:void 0});return l!=null?babelHelpers.extends({},s,{parentMsgKey:o("WAWebE2EProtoUtils").createMsgKeyFromThreadInfo(n,t,l),kind:o("WAWebMsgType").MsgKind.PlaceholderAddon,realType:l}):babelHelpers.extends({},s,{kind:o("WAWebMsgType").MsgKind.PlaceholderMessage})}function N(e,t){var n=babelHelpers.extends({},w(e),{type:o("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER,kind:o("WAWebMsgType").MsgKind.DebugPlaceholder,body:t.toString()});return n}function M(e,t){if(t.botParticipant!=null)return t.botParticipant;if(!e.fromMe&&r("WAWebWid").isGroup(e.remote)||r("WAWebWid").isStatus(e.remote))return e.participant;if(!o("WAWebUserPrefsMeUser").isMeDevice(t.author)&&o("WAWebUserPrefsMeUser").isMeAccount(t.author))return t.author}function w(e){var t,n,a,i=q(e),l=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),s=o("WAWebUserPrefsMeUser").getMeLidUserOrThrow(),u;i.fromMe&&r("WAWebWid").isGroup(i.remote)&&e.author.isLid()&&s!=null?u=s:u=l;var c=i.fromMe?u:i.remote,d={id:i,from:c,to:i.fromMe?i.remote:l,type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,t:e.ts||0,ack:o("WAWebMsgKeyUtils").isNoteToSelf(i)?o("WAWebAck").ACK.READ:o("WAWebAck").ACK.SENT,author:M(i,e),notifyName:e.pushname||"",invis:!1,count:e.count,clientReceivedTsMillis:e.clientReceivedTsMillis};return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&e.hostedBizEncStateMismatch===!0&&(t=d.id)!=null&&(t=t.remote)!=null&&t.isUser()&&(d.hostedBizEncStateMismatch=!0),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&e.senderOrRecipientAccountTypeHosted===!0&&(n=d.id)!=null&&(n=n.remote)!=null&&n.isUser()&&(d.senderOrRecipientAccountTypeHosted=!0),o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&e.placeholderCreatedWhenAccountIsHosted!=null&&(a=d.id)!=null&&(a=a.remote)!=null&&a.isUser()&&(d.placeholderCreatedWhenAccountIsHosted=e.placeholderCreatedWhenAccountIsHosted),d}function A(e,t,n,r){if(t!=null){var o=e;Object.assign(o,{botEditTargetId:t.botEditTargetId,botEditType:t.botEditType,bizBotType:t.bizBotType,botTargetSenderJid:n,botMsgBodyType:t.botMsgBodyType,botResponseTargetId:r})}}function F(e,t,n,r){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a){var i;if(!(n==null||a==null)){var l=n?o("WAWebUserPrefsMeUser").isMeAccount(n):!0,s={fromMe:l,remote:t,id:a},u=null;u=o("WAWebMsmsgMsgSecretCache").msmsgBotGroupGossipDataCache.getMsmsgBotGroupGossipDataFromCache(l,t,a,n),s.participant=(i=o("WAWebLidMigrationUtils").toPn(n))!=null?i:n;var c=new(r("WAWebMsgKey"))(s).toString();if(u==null){var d=yield o("WAWebSchemaMessage").getMessageTable().get(c);if(d!=null){var m;u=(m=o("WAWebDBMessageSerialization").messageFromDbRow(d))==null?void 0:m.botGroupParticipant}}else o("WAWebMsmsgMsgSecretCache").msmsgBotGroupGossipDataCache.deleteMsmsgBotGroupGossipDataFromCache(c);if(u!=null&&u.user===o("WAWebBotUtils").META_BOT_FBID_WID.user){var p=e;Object.assign(p,{botGroupParticipant:u})}}}),O.apply(this,arguments)}function B(e,t){return W.apply(this,arguments)}function W(){return W=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=yield(f||(f=n("Promise"))).all(t.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.ephSetting,a=t.preMatWid,i=t.wid,l=a!=null?a:r("WANullthrows")(i),s;try{s=new(r("WAWebMsgKey"))({remote:i,fromMe:!0,id:e.id.id})}catch(e){return o("WALogger").WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["drop: cannot create MsgKey: ",""])),r("getErrorSafe")(e).stack),null}var u,c,d=e.ephemeralSharedSecret,m=e.broadcastId;if(m!=null&&n!=null&&d!=null){var p=yield o("WAWebEphemeralDecodeBroadcastSetting").decodeBroadcastEphemeralSetting({broadcastJid:m,recipient:l,sender:l.isLid()?o("WAWebUserPrefsMeUser").getMeLidUserOrThrow():o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),ephSetting:n,sharedSecret:d});u=p.ephemeralDuration,c=p.ephemeralSettingTimestamp}var f=babelHelpers.extends({},e,{id:s,from:o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),to:l,broadcast:!0,ephemeralDuration:u,ephemeralSettingTimestamp:c,protocolMessageKey:e.protocolMessageKey==null?void 0:new(r("WAWebMsgKey"))({remote:l,fromMe:!0,id:e.protocolMessageKey.id})});return f});return function(e){return t.apply(this,arguments)}})()));return a.filter(Boolean)}),W.apply(this,arguments)}function q(e){return e.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST?new(r("WAWebMsgKey"))({remote:o("WAWebWidFactory").asUserWidOrThrow(e.author),fromMe:!1,id:e.externalId}):e.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT?e.botParticipant!=null?new(r("WAWebMsgKey"))({remote:e.chat,fromMe:o("WAWebUserPrefsMeUser").isMeAccount(e.author),id:e.externalId,participant:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(e.botParticipant))}):new(r("WAWebMsgKey"))({remote:e.chat,fromMe:o("WAWebUserPrefsMeUser").isMeAccount(e.author),id:e.externalId}):new(r("WAWebMsgKey"))({remote:e.chat,fromMe:o("WAWebUserPrefsMeUser").isMeAccount(e.author),participant:o("WAWebWidFactory").asUserWidOrThrow(e.author),id:e.externalId})}function U(e){return e.device==null||e.device===o("WAJids").DEFAULT_DEVICE_ID?o("WAWebWamEnumDeviceType").DEVICE_TYPE.PRIMARY:o("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION}function V(e){return e.type===o("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT?e.author:e.chat}function H(e){var t;return((t=e.meta)==null?void 0:t.appdata)===o("WAWebHandleMsgCommon").APPDATA.default&&e.msgProtobuf.senderKeyDistributionMessage!=null}function G(e,t){if(e===o("WAWebBackendJobs.flow").CiphertextType.Pkmsg){var n=t.msgInfo.chat.isGroup(),r=t.msgMeta.capi===!0;return n&&r}return!1}l.parseProtocolMessage=h,l.parseMessage=y,l.isRevokeInfo=$,l.generatePlaceholder=P,l.genDebugPlaceholderMsg=N,l.generateBaseMsg=w,l.generateBclMsgs=B,l.messageInfoToKey=q,l.getDeviceType=U,l.getFrom=V,l.shouldOmitSessionPersistence=G}),98);
__d("WAWebWamEnumMessageDropReasonType",[],(function(t,n,r,o,a,i){var e=Object.freeze({SYNCD_DELETION:1,ADMIN_REVOKE_NOT_ENABLED:2,RECEIVED_WITH_OLD_COUNTER:3,INVALID_STANZA:4,INVALID_PROTOBUF:5,MESSAGE_SECRET_ERROR:6,INVALID_LID_ADDRESSED_MESSAGE:7,UNKNOWN_MESSAGE_TYPE:8,DB_OPERATION_FAILED:9,INTERNAL_ERROR:10,EXPIRED:11,INVALID_HOSTED_COMPANION_STANZA:12,MESSAGE_REVOKED:13,PAYMENT_MESSAGE_REVOKED:14,DUPLICATE_MESSAGE:15,DUPLICATE_DELIVERY:16,INVALID_MESSAGE_REFERENCE:17,UNSUPPORTED_MESSAGE:18,MALICIOUS_DUPLICATE_MESSAGE:19,PEER_MESSAGE_FROM_OTHER_USER:20,INVALID_PEER_MESSAGE:21,INVALID_REPORTING_TOKEN:22,MISSING_REPORTING_TOKEN:23});i.MESSAGE_DROP_REASON_TYPE=e}),66);
__d("WAWebIncomingMessageDropWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAddressingMode","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumE2eCiphertextType","WAWebWamEnumE2eDestination","WAWebWamEnumE2eDeviceType","WAWebWamEnumE2eFailureReason","WAWebWamEnumEncryptionTypeCode","WAWebWamEnumInvisibleMessageCategoryType","WAWebWamEnumMediaType","WAWebWamEnumMessageDropReasonType","WAWebWamEnumRevokeType","WAWebWamEnumTypeOfGroupEnum"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({IncomingMessageDrop:[3724,{agentEngagementType:[12,o("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE],botType:[14,o("WAWebWamEnumBotType").BOT_TYPE],e2eCiphertextType:[1,o("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE],e2eDestination:[2,o("WAWebWamEnumE2eDestination").E2E_DESTINATION],e2eFailureReason:[9,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON],e2eSenderType:[3,o("WAWebWamEnumE2eDeviceType").E2E_DEVICE_TYPE],encryptionType:[18,o("WAWebWamEnumEncryptionTypeCode").ENCRYPTION_TYPE_CODE],invisibleMessageCategory:[13,o("WAWebWamEnumInvisibleMessageCategoryType").INVISIBLE_MESSAGE_CATEGORY_TYPE],isLid:[15,e.TYPES.BOOLEAN],isPq:[20,e.TYPES.BOOLEAN],isSimpleSignal:[19,e.TYPES.BOOLEAN],localAddressingMode:[16,o("WAWebWamEnumAddressingMode").ADDRESSING_MODE],messageDropReason:[4,o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE],messageMediaType:[5,o("WAWebWamEnumMediaType").MEDIA_TYPE],offline:[6,e.TYPES.BOOLEAN],offlineCount:[11,e.TYPES.INTEGER],retryCount:[7,e.TYPES.INTEGER],revokeType:[8,o("WAWebWamEnumRevokeType").REVOKE_TYPE],typeOfGroup:[10,o("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]},{IncomingMessageDrop:[]});l.IncomingMessageDropWamEvent=s}),98);
__d("WAWebPostIncomingMessageDropMetric",["WADeprecatedWapParser","WAWebAck","WAWebBackendJobs.flow","WAWebBackendJobsCommon","WAWebDBMessageSerialization","WAWebHandleMsgCommon","WAWebIncomingMessageDropWamEvent","WAWebJidToWid","WAWebMsgGetters","WAWebMsgProcessingApiUtils","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumMessageDropReasonType","WAWebWamEnumRevokeType","WAWebWamMsgUtils"],(function(t,n,r,o,a,i,l){var e=new(r("WADeprecatedWapParser"))("incomingMsgParserForMetric",function(e){var t={};try{t.type=e.attrEnum("type",o("WAWebHandleMsgCommon").STANZA_MSG_TYPES)}catch(e){}try{t.pollType=t.type===o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll?e.child("meta").attrEnumOrNullIfUnknown("polltype",o("WAWebHandleMsgCommon").POLL_TYPES):null}catch(e){}try{var n,r;t.from=o("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("from")),(n=t.from)!=null&&n.isUser()?t.author=t.from:(r=t.from)!=null&&r.isGroup()&&(t.author=e.hasAttr("participant")?o("WAWebJidToWid").deviceJidToDeviceWid(e.attrDeviceJid("participant")):null)}catch(e){}try{t.offline=e.attrInt("offline")}catch(e){}try{t.edit=e.attrInt("edit")}catch(e){}try{var a=e.attrString("category"),i=o("WAWebWamMsgUtils").getWamInvisibleMessageCatgoryType(a);i!=null&&(t.invisibleMessageCategoryType=i)}catch(e){}var l=e.maybeChild("enc");if(l!=null){try{t.e2eType=l.attrEnumValues("type",o("WAWebBackendJobs.flow").CiphertextType.members())}catch(e){}try{t.encMediaType=o("WAWebBackendJobs.flow").EncMediaType.cast(l.maybeAttrString("mediatype"))}catch(e){}try{t.retryCount=l.attrInt("count")}catch(e){}}try{var s;if(t.botType=o("WAWebWamEnumBotType").BOT_TYPE.UNKNOWN,(s=t.author)!=null&&s.isBot())t.botType=o("WAWebWamEnumBotType").BOT_TYPE.METABOT;else{var u,c=(u=e.maybeChild("bot"))==null?void 0:u.maybeAttrString("biz_bot");c==="1"?t.botType=o("WAWebWamEnumBotType").BOT_TYPE.BOT_1P_BIZ:c==="3"&&(t.botType=o("WAWebWamEnumBotType").BOT_TYPE.BOT_3P_BIZ)}}catch(e){}return t});function s(t){var n,r,a,i,l,s,u,c,d,m,p,_,f,g,h,y=t.messageDropReason,C=t.stanza,b=null;try{b=e.parse(C).success}catch(e){}var v=new(o("WAWebIncomingMessageDropWamEvent")).IncomingMessageDropWamEvent({messageDropReason:y,offline:((n=b)==null?void 0:n.offline)!=null,offlineCount:(r=b)==null?void 0:r.offline,messageMediaType:o("WAWebBackendJobsCommon").getMetricMediaType({encMediaType:(a=b)==null?void 0:a.encMediaType,msgType:(i=b)==null?void 0:i.type,msgPollType:(l=b)==null?void 0:l.pollType})});if(((s=b)==null?void 0:s.from)!=null){var S=o("WAWebBackendJobsCommon").getMetricE2eDestination(b.from);S!=null&&(v.e2eDestination=S)}if(((u=b)==null?void 0:u.author)!=null){var R=o("WAWebWamMsgUtils").getWamE2eSenderType(b.author);R!=null&&(v.e2eSenderType=R)}if(((c=b)==null?void 0:c.e2eType)!=null&&(v.e2eCiphertextType=o("WAWebBackendJobsCommon").getMetricE2eCiphertextType(b.e2eType)),((d=b)==null?void 0:d.retryCount)!=null&&(v.retryCount=b.retryCount),((m=b)==null?void 0:m.edit)===o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE?v.revokeType=o("WAWebWamEnumRevokeType").REVOKE_TYPE.ADMIN:((p=b)==null?void 0:p.edit)===o("WAWebAck").EDIT_ATTR.SENDER_REVOKE&&(v.revokeType=o("WAWebWamEnumRevokeType").REVOKE_TYPE.SENDER),((_=b)==null?void 0:_.from)!=null&&((f=b)==null?void 0:f.author)!=null){var L;if(((L=b)==null||(L=L.author)==null?void 0:L.isBot())===!0){var E;((E=b)==null||(E=E.from)==null?void 0:E.isBot())===!0?v.agentEngagementType=o("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.DIRECT_CHAT:v.agentEngagementType=o("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.INVOKED}}if(((g=b)==null?void 0:g.botType)!=null){var k;v.botType=(k=b)==null?void 0:k.botType}((h=b)==null?void 0:h.invisibleMessageCategoryType)!=null&&(v.invisibleMessageCategory=b.invisibleMessageCategoryType),v.commit()}function u(e){s({messageDropReason:o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_STANZA,stanza:e})}function c(e){s({messageDropReason:o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.UNKNOWN_MESSAGE_TYPE,stanza:e})}function d(e){s({messageDropReason:o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INTERNAL_ERROR,stanza:e})}function m(e){s({messageDropReason:o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.DB_OPERATION_FAILED,stanza:e})}function p(e){s({messageDropReason:o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_HOSTED_COMPANION_STANZA,stanza:e})}function _(e,t){var n=e.enc,r=e.error,a=e.msgInfo,i=e.msgMeta,l=new(o("WAWebIncomingMessageDropWamEvent")).IncomingMessageDropWamEvent({messageDropReason:t,e2eCiphertextType:o("WAWebBackendJobsCommon").getMetricE2eCiphertextType(n.e2eType),messageMediaType:o("WAWebBackendJobsCommon").getMetricMediaType({encMediaType:n.encMediaType,msgType:i.type,msgPollType:i.pollType}),retryCount:n.retryCount,offline:a.offline!=null,e2eFailureReason:r==null?void 0:r.e2eFailureReason}),s=o("WAWebMsgProcessingApiUtils").getFrom(a),u=o("WAWebBackendJobsCommon").getMetricE2eDestination(s);if(u!=null&&(l.e2eDestination=u),s){var c=o("WAWebWamMsgUtils").getWamE2eSenderType(s);c!=null&&(l.e2eSenderType=c)}a.edit===o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE?l.revokeType=o("WAWebWamEnumRevokeType").REVOKE_TYPE.ADMIN:a.edit===o("WAWebAck").EDIT_ATTR.SENDER_REVOKE&&(l.revokeType=o("WAWebWamEnumRevokeType").REVOKE_TYPE.SENDER);var d=o("WAWebWamMsgUtils").getWamInvisibleMessageCatgoryType(a.category);if(d!=null&&(l.invisibleMessageCategory=d),a.offline!=null){var m=parseInt(a.offline,10);Number.isNaN(m)||(l.offlineCount=m)}l.commit()}function f(e){_(e,o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.RECEIVED_WITH_OLD_COUNTER)}function g(e){_(e,o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.DUPLICATE_MESSAGE)}function h(e){_(e,o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_PROTOBUF)}function y(e){_(e,o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_STANZA)}function C(e){_(e,o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.EXPIRED)}function b(e){for(var t of e){var n=o("WAWebDBMessageSerialization").messageFromDbRow(t),r=new(o("WAWebIncomingMessageDropWamEvent")).IncomingMessageDropWamEvent({messageDropReason:o("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.DB_OPERATION_FAILED,messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(n)}),a=o("WAWebMsgGetters").getFrom(n),i=o("WAWebBackendJobsCommon").getMetricE2eDestination(a);i!=null&&(r.e2eDestination=i),r.commit()}}l.postIncomingMessageDropInvalidStanza=u,l.postIncomingMessageDropUnknownMessageType=c,l.postIncomingMessageDropInternalError=d,l.postIncomingMessageDropDBOperationFailed=m,l.postIncomingMessageDropInvalidHostedCompanionStanza=p,l.postIncomingMessageDropOldCounter=f,l.postIncomingMessageDropDuplicateMessage=g,l.postIncomingMessageDropInvalidProtobuf=h,l.postIncomingMessageDropInvalidStanzaFromDecryptedMessageInfo=y,l.postIncomingMessageDropExpired=C,l.postIncomingMessageDropDBOperationFailedForMsgRows=b}),98);
__d("WAWebGetMessageCache",["WAWebMessageProcessorCache"],(function(t,n,r,o,a,i,l){var e=null;function s(){return e==null&&(e=o("WAWebMessageProcessorCache").messageProcessorCache),e}l.getMessageCache=s}),98);
__d("WAWebCommsSendPing",["WAComms","WACustomError","WALogger","WAPromiseTimeout","WATimeUtils","WAWebABProps","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d=null;function m(){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(o("WAWebABProps").getABPropConfigValue("web_offline_resume_wait_for_ping_response_enabled")){var t=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["blockSendPing: sending ping..."])));var t=yield o("WAPromiseTimeout").promiseTimeout(o("WAComms").sendPing(),r*1e3);return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["blockSendPing: is connected: ",""])),t),t}catch(e){if(e instanceof o("WACustomError").TimeoutError)return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["blockSendPing: no response in ","s"])),r),!1;throw o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["blockSendPing: failed to send ping: ",""])),e),e}finally{d=null}});return function(){return t.apply(this,arguments)}})();if(d!=null)return d;var r=o("WAWebABProps").getABPropConfigValue("web_offline_resume_wait_for_ping_timeout_seconds");return d=t(),d}return o("WAComms").sendPing()}),p.apply(this,arguments)}function _(e){o("WATimeUtils").setClockSkew(e)}l.blockSendPing=m,l.updateClockSkew=_}),98);
__d("WAWebOfflineResumePreAckHandler",["WABatcher","WADeprecatedSendIq","WALogger","WAWap","WAWebCommsWapMd","WAWebSchemaDanglingReceipt","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u=o("WAWap").S_WHATSAPP_NET.toString(),c=o("WAWap").G_US.toString();function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,r,o,a=e.attrs.class.toString();if(!(a!=="notification"&&a!=="receipt")){var i=e.attrs.id.toString(),l=e.tag,s=e.attrs.to.toString(),u=(t=e.attrs.participant)==null?void 0:t.toString(),c=(n=e.attrs.type)==null?void 0:n.toString(),d=(r=e.attrs)!=null&&r.error?parseInt((o=e.attrs)==null?void 0:o.error.toString(),10):void 0;g({ackClass:a,ackId:i,to:s,tag:l,participant:u,type:c,error:d})}}),m.apply(this,arguments)}function p(e){switch(e){case c:return o("WAWap").G_US;case u:return o("WAWap").S_WHATSAPP_NET;default:return o("WAWebCommsWapMd").JID(o("WAWebWidFactory").createWidFromWidLike(e))}}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.type!=null?o("WAWap").CUSTOM_STRING(e.type):o("WAWap").DROP_ATTR;try{var n=o("WAWap").wap("ack",{id:o("WAWap").CUSTOM_STRING(e.ackId),class:o("WAWap").CUSTOM_STRING(e.ackClass),to:p(e.to),type:t,participant:e.participant!=null?o("WAWebCommsWapMd").DEVICE_JID(o("WAWebWidFactory").createWid(e.participant)):o("WAWap").DROP_ATTR,error:e.error!=null?o("WAWap").INT(e.error):o("WAWap").DROP_ATTR});return o("WADeprecatedSendIq").deprecatedCastStanza(n,{preAck:!0})}catch(t){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to send offline pre-ack for envelope: "," with error: ",""])),e.ackClass,t).sendLogs("offline-pre-ack")}}),f.apply(this,arguments)}var g=(function(){return o("WABatcher").batch({delayMs:3e3,maxSize:400},(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{o("WAWebUserPrefsMultiDevice").isRegistered()&&(yield o("WAWebSchemaDanglingReceipt").getTable().create({receipts:[],acks:t}))}catch(n){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["persistPreAcksBatched: failed for "," pre-acks: ",", stack: ",""])),t.length,n,n instanceof Error?n.stack:"").sendLogs("persist-pre-acks-batched-failed",{sampling:.01})}return[]});return function(e){return t.apply(this,arguments)}})())})();l.parseAndSerializeOfflinePreAck=d,l.sendOfflinePreAck=_}),98);
__d("WAWebWamEnumOfflineResumeModes",[],(function(t,n,r,o,a,i){var e=Object.freeze({RESUME_FROM_RESTART:1,RESUME_FROM_OPEN_TAB:2,UNKNOWN:3,CONNECT_REASON_USER:4,CONNECT_REASON_PUSH:5,CONNECT_REASON_BACKOFF:6});i.OFFLINE_RESUME_MODES=e}),66);
__d("WAWebWamEnumOfflineResumeStages",[],(function(t,n,r,o,a,i){var e=Object.freeze({PAGE_LOAD:1,SOCKET_CONNECT:2,PROCESS_COMPLETE:3,SCREEN_LOAD:4,OFFLINE_PREVIEW:5,OFFLINE_COMPLETE_RECEIVED:6,PREACKS_SENT:7});i.OFFLINE_RESUME_STAGES=e}),66);
__d("WAWebOfflineResumeStageWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOfflineResumeModes","WAWebWamEnumOfflineResumeStages"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({OfflineResumeStage:[3536,{attemptId:[13,e.TYPES.INTEGER],chatThreadCount:[4,e.TYPES.INTEGER],currentOfflineStage:[1,o("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES],isResumeInForeground:[5,e.TYPES.BOOLEAN],isResumeStartedInForeground:[14,e.TYPES.BOOLEAN],lastPushTimestampMs:[12,e.TYPES.INTEGER],mailboxAge:[6,e.TYPES.INTEGER],offlineCallCount:[15,e.TYPES.INTEGER],offlineDecryptErrorCount:[7,e.TYPES.INTEGER],offlineMessageCount:[8,e.TYPES.INTEGER],offlineNotificationCount:[9,e.TYPES.INTEGER],offlineReceiptCount:[10,e.TYPES.INTEGER],offlineResumeMode:[11,o("WAWebWamEnumOfflineResumeModes").OFFLINE_RESUME_MODES],offlineSessionId:[2,e.TYPES.STRING],offlineSizeBytes:[16,e.TYPES.INTEGER],offlineStageTimestampMs:[3,e.TYPES.INTEGER],passiveModeT:[17,e.TYPES.TIMER]},[1,1,1],"regular"]},{OfflineResumeStage:[]});l.OfflineResumeStageWamEvent=s}),98);
__d("WAWebWamEnumOfflineResumeResultType",[],(function(t,n,r,o,a,i){var e=Object.freeze({COMPLETE:1,INCOMPLETE_UNKNOWN_ERROR:2,INCOMPLETE_DISCONNECT:3,INCOMPLETE_APP_RESTART:4});i.OFFLINE_RESUME_RESULT_TYPE=e}),66);
__d("WAWebOfflineResumeWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOfflineResumeResultType"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({OfflineResume:[3112,{affectedBySleepMode:[35,e.TYPES.BOOLEAN],appContext:[49,e.TYPES.STRING],appContextBitfield:[50,e.TYPES.INTEGER],attemptNumber:[36,e.TYPES.INTEGER],chatThreadCount:[1,e.TYPES.INTEGER],dbDurationT:[39,e.TYPES.TIMER],dbMainThreadDurationT:[40,e.TYPES.TIMER],dbMainThreadReadsCount:[41,e.TYPES.INTEGER],dbMainThreadWritesCount:[42,e.TYPES.INTEGER],dbReadsCount:[43,e.TYPES.INTEGER],dbWritesCount:[44,e.TYPES.INTEGER],disconnected:[45,e.TYPES.BOOLEAN],expectedOfflineCallCount:[23,e.TYPES.INTEGER],expectedOfflineMessageCount:[17,e.TYPES.INTEGER],expectedOfflineNotificationCount:[18,e.TYPES.INTEGER],expectedOfflineReceiptCount:[19,e.TYPES.INTEGER],isOfflineCompleteMissed:[2,e.TYPES.BOOLEAN],isResumeInForeground:[13,e.TYPES.BOOLEAN],isResumeStartedInForeground:[37,e.TYPES.BOOLEAN],isRunningFromServiceExtension:[22,e.TYPES.BOOLEAN],lastStanzaT:[3,e.TYPES.TIMER],logoutSessionId:[38,e.TYPES.INTEGER],mailboxAge:[14,e.TYPES.INTEGER],mainScreenLoadT:[4,e.TYPES.TIMER],nseMergeT:[54,e.TYPES.TIMER],offlineCallCount:[24,e.TYPES.INTEGER],offlineDecryptErrorCount:[5,e.TYPES.INTEGER],offlineMessageCount:[6,e.TYPES.INTEGER],offlineNotificationCount:[7,e.TYPES.INTEGER],offlinePreviewT:[8,e.TYPES.TIMER],offlineProcessingT:[20,e.TYPES.TIMER],offlineReceiptCount:[9,e.TYPES.INTEGER],offlineResumeResult:[21,o("WAWebWamEnumOfflineResumeResultType").OFFLINE_RESUME_RESULT_TYPE],offlineSessionT:[46,e.TYPES.TIMER],offlineSizeBytes:[10,e.TYPES.INTEGER],onTrickleMode:[15,e.TYPES.BOOLEAN],pageLoadT:[11,e.TYPES.TIMER],passiveModeT:[25,e.TYPES.TIMER],preackCallCount:[26,e.TYPES.INTEGER],preackMessageCount:[27,e.TYPES.INTEGER],preackNotificationCount:[28,e.TYPES.INTEGER],preackReceiptCount:[29,e.TYPES.INTEGER],preacksCount:[47,e.TYPES.INTEGER],processedCallCount:[30,e.TYPES.INTEGER],processedMessageCount:[31,e.TYPES.INTEGER],processedNotificationCount:[32,e.TYPES.INTEGER],processedReceiptCount:[33,e.TYPES.INTEGER],queuedMessageCount:[51,e.TYPES.INTEGER],queuedNotificationCount:[52,e.TYPES.INTEGER],queuedReceiptCount:[53,e.TYPES.INTEGER],runningTasks:[48,e.TYPES.STRING],socketConnectT:[12,e.TYPES.TIMER],transientOfflineSessionId:[34,e.TYPES.STRING]},[1,1,1],"regular"]},{OfflineResume:[]});l.OfflineResumeWamEvent=s}),98);
__d("WAWebWamOfflineResumeReporter",["$InternalEnum","WALogger","WAQplTypes","WARandomHex","WATimeUtils","WAWebAppTracker","WAWebDBTableUsage","WAWebGetAllModelStorageTableNames","WAWebOfflineResumeStageWamEvent","WAWebOfflineResumeWamEvent","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebUserPrefsGeneral","WAWebUserPrefsMultiDevice","WAWebWamEnumOfflineResumeModes","WAWebWamEnumOfflineResumeStages","WAWebWamEnumWebScenarioCode","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f=n("$InternalEnum").Mirrored(["ResumeFromRestart","ResumeFromOpentab"]),g=(function(){function e(e){this._mode=e}var t=e.prototype;return t.start=function(){this.drop(),this._qplEvent=o("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,{annotations:{string:{mode:f.getName(this._mode)}}})},t.end=function(){var e;(e=this._qplEvent)==null||e.end(o("WAQplTypes").QuickLogActionType.SUCCESS)},t.drop=function(){var e;(e=this._qplEvent)==null||e.drop(),this._qplEvent=void 0},t._addPoint=function(t,n){var e,r=n!=null?{data:n}:{};(e=this._qplEvent)==null||e.addPoint(t,r)},t.markOfflinePreviewReceived=function(){this._addPoint("offlinePreviewReceived")},t.markMainScreenLoad=function(){this._addPoint("mainScreenLoad")},t.setAnnotations=function(t){var e;(e=this._qplEvent)==null||e.annotate(t)},e})(),h=(function(){function e(e,t){this._sessionId=t,this._offlineStartT=self.performance.now(),this._resumeMode=e,window.document&&(this._isStartedInForeground=!document.hidden)}var t=e.prototype;return t._commitOfflineStage=function(t){var e={offlineSessionId:this._sessionId,offlineResumeMode:this._resumeMode===f.ResumeFromOpentab?o("WAWebWamEnumOfflineResumeModes").OFFLINE_RESUME_MODES.RESUME_FROM_OPEN_TAB:o("WAWebWamEnumOfflineResumeModes").OFFLINE_RESUME_MODES.RESUME_FROM_RESTART,offlineStageTimestampMs:Math.floor(self.performance.now()-this._offlineStartT),currentOfflineStage:t};window.document&&(e.isResumeInForeground=!document.hidden),this._isStartedInForeground!=null&&(e.isResumeStartedInForeground=this._isStartedInForeground);var n=new(o("WAWebOfflineResumeStageWamEvent")).OfflineResumeStageWamEvent(e);this._addOfflineMetadata(n),n.commit()},t.logOfflineStart=function(){this._offlineStartT=self.performance.now()},t.logSocketConnect=function(){this._commitOfflineStage(o("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.SOCKET_CONNECT)},t.logProcessComplete=function(){this._commitOfflineStage(o("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.PROCESS_COMPLETE)},t.logScreenLoad=function(){this._commitOfflineStage(o("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.SCREEN_LOAD)},t.logOfflinePreview=function(){this._commitOfflineStage(o("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.OFFLINE_PREVIEW)},t.logOfflineCount=function(t){var e,n,r,o;((e=this._offlineMessageCount)!=null?e:0)===0&&(this._offlineMessageCount=t.message),((n=this._offlineReceiptCount)!=null?n:0)===0&&(this._offlineReceiptCount=t.receipt),((r=this._offlineNotificationCount)!=null?r:0)===0&&(this._offlineNotificationCount=t.notification),((o=this._offlineCallCount)!=null?o:0)===0&&(this._offlineCallCount=t.call)},t.logOfflineDecryptionErrorCount=function(t){this._offlineDecryptErrorCount=t},t.logOfflineChatThreadCount=function(t){this._chatThreadCount=t},t.logOldestStanzaTime=function(t){(this._oldestStanzaTs==null||this._oldestStanzaTs>t)&&(this._oldestStanzaTs=t)},t.setLastPushCompleteTimestamp=function(){this._lastPushCompleteTimestampMs=o("WAWebUserPrefsGeneral").getLastPushCompleteTimestamp()},t._addOfflineMetadata=function(t){this._offlineMessageCount!=null&&(t.offlineMessageCount=this._offlineMessageCount),this._offlineReceiptCount!=null&&(t.offlineReceiptCount=this._offlineReceiptCount),this._offlineNotificationCount!=null&&(t.offlineNotificationCount=this._offlineNotificationCount),this._offlineCallCount!=null&&(t.offlineCallCount=this._offlineCallCount),this._oldestStanzaTs!=null&&(t.mailboxAge=v(this._oldestStanzaTs)),this._offlineDecryptErrorCount!=null&&(t.offlineDecryptErrorCount=this._offlineDecryptErrorCount),this._chatThreadCount!=null&&(t.chatThreadCount=b(this._chatThreadCount,10)),this._lastPushCompleteTimestampMs!=null&&t.currentOfflineStage===o("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.SOCKET_CONNECT&&(t.lastPushTimestampMs=this._lastPushCompleteTimestampMs,o("WAWebUserPrefsGeneral").clearLastPushCompleteTimestamp(),this._lastPushCompleteTimestampMs=null)},e})(),y=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.offlinePreviewCount=0,babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebOfflineResumeWamEvent").OfflineResumeWamEvent),C=(function(){function t(){this._initEvents(f.ResumeFromRestart)}var a=t.prototype;return a._initEvents=function(t){this.isInitialSync=!1,this.oldestStanzaTs=0,this.offlineResume=new y,this.offlineResume.offlineMessageCount=0,this.offlineResume.offlineReceiptCount=0,this.offlineResume.offlineNotificationCount=0,this.offlineResume.offlineCallCount=0,this.offlineResume.offlineDecryptErrorCount=0,this.offlineResume.offlineSizeBytes=0,this.offlineResume.chatThreadCount=0,this.offlineResume.preackMessageCount=0,this.offlineResume.preackReceiptCount=0,this.offlineResume.isOfflineCompleteMissed=!1,this.qpl=new g(t);var e=this._generateOfflineSessionId();this.offlineStage=new h(t,e),this.endTableUsageMetric=o("WAWebDBTableUsage").beginDBTableUsage({webScenario:o("WAWebWamEnumWebScenarioCode").WEB_SCENARIO_CODE.OFFLINE_RESUME,tablesToLog:new Set(o("WAWebGetAllModelStorageTableNames").allModelStorageTableNames),offlineSessionId:e})},a.logOldestStanzaTime=function(t){this.offlineStage.logOldestStanzaTime(t),this.offlineResume!=null&&(this.oldestStanzaTs===0||this.oldestStanzaTs>t)&&(this.oldestStanzaTs=t)},a.logOfflineCount=function(t){var e,n,r,o;this.offlineStage.logOfflineCount(t),this.offlineStage.logOfflinePreview(),this.offlineResume&&(this.offlineResume.offlinePreviewCount=t.count,((e=this.offlineResume.offlineMessageCount)!=null?e:0)===0&&(this.offlineResume.offlineMessageCount=t.message),((n=this.offlineResume.offlineReceiptCount)!=null?n:0)===0&&(this.offlineResume.offlineReceiptCount=t.receipt),((r=this.offlineResume.offlineNotificationCount)!=null?r:0)===0&&(this.offlineResume.offlineNotificationCount=t.notification),((o=this.offlineResume.offlineCallCount)!=null?o:0)===0&&(this.offlineResume.offlineCallCount=t.call))},a.logOfflineDecryptionErrorCount=function(t){this.offlineStage.logOfflineDecryptionErrorCount(t),this.offlineResume&&(this.offlineResume.offlineDecryptErrorCount=t)},a.logAddOfflineSizeBytes=function(t){this.offlineResume&&(this.offlineResume.offlineSizeBytes+=t)},a.logOfflineChatThreadCount=function(t){this.offlineStage.logOfflineChatThreadCount(t);var e=b(t,10);this.offlineResume&&(this.offlineResume.chatThreadCount=e)},a.logOfflinePreackCount=function(t,n){n===void 0&&(n=!1),this.offlineResume&&(n===!0?this.offlineResume.preackMessageCount+=t:this.offlineResume.preackReceiptCount+=t)},a.logOfflinePassiveT=function(){var e;((e=this.offlineResume)==null?void 0:e.passiveModeT)==null&&this._logPerformanceT("passiveModeT")},a._logPerformanceT=function(t){var e=Math.floor(self.performance.now());this.offlineResume!=null&&(this.offlineResume[t]=e)},a.logLastStanzaT=function(){var e;((e=this.offlineResume)==null?void 0:e.lastStanzaT)==null&&(this._logPerformanceT("lastStanzaT"),this.isInitialSync||this.offlineStage.logProcessComplete())},a.logMainScreenLoadT=function(){this._logPerformanceT("mainScreenLoadT"),this.qpl.markMainScreenLoad(),this.isInitialSync||this.offlineStage.logScreenLoad()},a.logOfflinePreviewT=function(){this._logPerformanceT("offlinePreviewT"),this.qpl.markOfflinePreviewReceived()},a.logOfflineStartT=function(){this._logPerformanceT("pageLoadT"),this.offlineStage.logOfflineStart(),window.document&&this.offlineResume&&(this.offlineResume.isResumeStartedInForeground=!document.hidden)},a.logSocketConnectT=function(){this.qpl.start(),this._logPerformanceT("socketConnectT"),this.isInitialSync||this.offlineStage.logSocketConnect()},a.logMissedOfflineComplete=function(){this.offlineResume&&(this.offlineResume.isOfflineCompleteMissed=!0)},a.setIsInitialSync=function(){this.isInitialSync=!0},a.setLastPushCompleteTimestamp=function(){return this.offlineStage.setLastPushCompleteTimestamp()},a.isBlockingOfflineResume=function(t){return t.lastStanzaT!=null&&t.mainScreenLoadT!=null?t.lastStanzaT<t.mainScreenLoadT:t.socketConnectT!=null&&t.lastStanzaT!=null&&t.mainScreenLoadT==null?!0:t.socketConnectT!=null&&t.lastStanzaT==null&&t.mainScreenLoadT!=null?!1:null},a.commit=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=this.offlineResume;if(t){t.offlineSizeBytes=b(t.offlineSizeBytes,1e3),t.mailboxAge=v(this.oldestStanzaTs),yield o("WAWebUserPrefsMultiDevice").setRecentMailboxAgeDays(t.mailboxAge);var n=this.isBlockingOfflineResume(t);t.lastStanzaT!=null&&t.socketConnectT!=null&&(t.offlineProcessingT=t.lastStanzaT-t.socketConnectT,o("WAWebAppTracker").attachWAMAppContext(t,t.offlineProcessingT)),window.document&&(t.isResumeInForeground=!document.hidden),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] done cnt="," msg="," rcpt="," notif="," call="," chat=",""])),t.offlinePreviewCount,t.offlineMessageCount,t.offlineReceiptCount,t.offlineNotificationCount,t.offlineCallCount,t.chatThreadCount),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] sz="," decErr="," preMsg="," preRcpt="," lastT="," pageT=",""])),t.offlineSizeBytes,t.offlineDecryptErrorCount,t.preackMessageCount,t.preackReceiptCount,t.lastStanzaT,t.pageLoadT),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] sockT="," passT="," prevT="," mainT="," procT="," fg=",""])),t.socketConnectT,t.passiveModeT,t.offlinePreviewT,t.mainScreenLoadT,t.offlineProcessingT,t.isResumeInForeground),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] done startFg="," blocking="," age=",""])),t.isResumeStartedInForeground,n,t.mailboxAge);var a=t.offlinePreviewCount===0;if(!this.isInitialSync&&!a){if(t.commit(),this.qpl.setAnnotations({int:{messageCount:t.offlineMessageCount,receiptCount:t.offlineReceiptCount,notificationCount:t.offlineNotificationCount,chatThreadCount:t.chatThreadCount,sizeBytes:t.offlineSizeBytes,decryptErrorCount:t.offlineDecryptErrorCount,preackMessageCount:t.preackMessageCount,preackReceiptCount:t.preackReceiptCount},bool:{isResumeInForeground:t.isResumeInForeground,isBlockingOfflineResume:n}}),this.qpl.end(),this.endTableUsageMetric(),!r("gkx")("26258")){var i=18e4,l=10,f=Math.max(t.mainScreenLoadT,t.lastStanzaT);f-t.socketConnectT>i&&o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] load time > limit: ",""])),t.mainScreenLoadT).sendLogs("slow-offline-resume"),t.offlineDecryptErrorCount>l&&o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] decrypt err > limit: ",""])),t.offlineDecryptErrorCount).sendLogs("slow-offline-resume")}}else this.isInitialSync?o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] skip: initial sync"]))):a&&o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] skip: no envelopes"]))),this.qpl.drop();this.offlineResume=null}});function a(){return t.apply(this,arguments)}return a})(),a.resetEvent=function(){this.offlineResume==null&&(this._initEvents(f.ResumeFromOpentab),this.logOfflineStartT())},a._generateOfflineSessionId=function(){return""+o("WARandomHex").randomHex(4)+o("WATimeUtils").unixTimeWithoutClockSkewCorrection().toString(10)},t})();function b(e,t){return r("gkx")("26258")?Math.round(e/t)*t:e}function v(e){if(e===0)return 0;var t=o("WATimeUtils").unixTime()-e;return Math.round(t/o("WATimeUtils").DAY_SECONDS)}var S=new C;l.roundUp=b,l.countDays=v,l.OfflineResumeReporter=S}),98);
__d("WAWebClearDanglingReceipts",["Promise","WAAbortError","WALogger","WATimeUtils","WAWebABProps","WAWebCommsSendPing","WAWebNetworkStatus","WAWebOfflineResumePreAckHandler","WAWebSchemaDanglingReceipt","WAWebSendReceiptJobCommon","WAWebWamOfflineResumeReporter","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g;function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: get "," danglingRecords"])),t.length),r.aborted)throw o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: aborting receipts to signal.aborted"]))),new(o("WAAbortError")).AbortError;var a=new Map,i=[],l=0;t.forEach(function(e){l+=e.receipts.length;var t=e.acks,n=e.receipts;n.forEach(function(e){var t=o("WAWebWidFactory").createWid(e.from),n=o("WAWebWidFactory").createWid(e.author),r=a.get(t);r||(r=new Map,a.set(t,r));var i=r.get(n);i||(i=[],r.set(n,i)),i.push(e.externalId)}),i=i.concat(t)});var p=String(o("WATimeUtils").unixTime()),_=Array.from(a.keys()).map(function(e){var t=a.get(e);if(t)return o("WAWebSendReceiptJobCommon").sendAggregateReceipts({to:e,type:o("WAWebSendReceiptJobCommon").RECEIPT_TYPE.DELIVERY,t:p,groupedReceipt:t})}),f=i.map(function(e){return o("WAWebOfflineResumePreAckHandler").sendOfflinePreAck(e)});o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: starting sending "," receipts,  "," preAcks"])),_.length,f.length),yield(g||(g=n("Promise"))).all(_),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: complete sending "," receipts"])),_.length),yield g.all(f),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: complete sending  "," preAcks"])),f.length),yield C(),o("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreackCount(l),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: complete"])))}),y.apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!r("WAWebNetworkStatus").online){o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] clearDanglingReceipts: skip due to offline"])));return}o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] clearDanglingReceipts: sending ping"])));var e=yield o("WAWebCommsSendPing").blockSendPing();(e||!o("WAWebABProps").getABPropConfigValue("web_offline_resume_wait_for_ping_response_enabled"))&&(o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] clearDanglingReceipts: clearing dangling receipts"]))),yield o("WAWebSchemaDanglingReceipt").getTable().clear())}),b.apply(this,arguments)}l.sendAndClearDanglingReceipts=h,l.clearDanglingReceipts=C}),98);
__d("WAWebLogoutReasonConstants",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({UserInitiated:"user_initiated",SyncdFailure:"syncd_failure",InvalidAdvStatus:"invalid_adv_status",CriticalSyncTimeout:"critical_sync_timeout",SyncdTimeout:"syncd_timeout",HistorySyncTimeout:"history_sync_timeout",AccountSyncTimeout:"account_sync_timeout",MDOptOut:"md_opt_out",UnknownCompanion:"unknown_companion",ClientVersionOutdated:"client_version_outdated",SyncdErrorDuringBootstrap:"syncd_error_during_bootstrap",AccountSyncError:"account_sync_error",StorageQuotaExceeded:"storage_quota_exceeded",PrimaryIdentityKeyChange:"primary_identity_key_change",MissingEncSalt:"missing_enc_salt",MissingScreenLockSalt:"missing_screen_lock_salt",AccountLocked:"account_locked",LidMigrationSplitThreadMismatch:"lid_migration_split_thread_mismatch",LidMigrationNoLidAvailiable:"lid_migration_no_lid_available",LidMigrationPrimaryMappingsObsolete:"lid_migration_primary_mappings_obsolete",LidMigrationPeerMappingsNotReceived:"lid_migration_peer_mapping_not_received",LidMigrationStateDiscrepancy:"lid_migration_state_discrepancy",LidMigrationPeerMappingsMalformed:"lid_migration_peer_mapping_malformed",LidMigrationFailedToParseMapping:"lid_migration_failed_to_parse_mapping",LidMigrationCompanionIncompatibleKillswitch:"lid_migration_companion_incompatible_killswitch",LidMigrationOneOnOneThreadMigrationInternalError:"lid_migration_one_on_one_thread_migration_internal_error",LidBlocklistPnWhenMigrated:"lid_blocklist_pn_when_migrated",LidBlocklistChatDbUnmigrated:"lid_blocklist_chat_db_unmigrated",WebFailAddChat:"web_fail_add_chat",WebFailOfflineResume:"web_fail_offline_resume",WebFailStorageInitialization:"web_fail_storage_initialization",WebFailEncSalt:"web_fail_enc_salt",CacheStorageOpenFailed:"cache_storage_open_failed"}),l={CLIENT_FATAL:"0",SYNC_FAIL:"1",INITIAL_HISTORY_SYNC_TIMEOUT:"2",ACCOUNT_LOCKED:"3"};i.LogoutReason=e,i.LOGOUT_REASON_CODE=l}),66);
__d("WAWebPushNotificationsGatingUtils",["WAWebABProps","WAWebEnvironment","WAWebNotificationConstants","WAWebUA"],(function(t,n,r,o,a,i,l){function e(){return u()&&o("WAWebABProps").getABPropConfigValue("web_push_notifications")&&!r("WAWebEnvironment").isWindows}function s(e,t){return e===o("WAWebNotificationConstants").PERMISSION_DEFAULT||e===o("WAWebNotificationConstants").PERMISSION_DENIED&&t&&(o("WAWebUA").UA.isChrome||o("WAWebUA").UA.browser===o("WAWebUA").BROWSER_TYPE.EDGE||o("WAWebUA").UA.isFirefox||o("WAWebUA").UA.browser==="opera")}function u(){try{var e=o("WAWebUA").UA.isSafari&&Number(o("WAWebUA").UA.browserVersion.split(".")[0])<16;return!e}catch(e){return!1}}function c(){try{var e=o("WAWebUA").UA.isSafari||o("WAWebUA").UA.browser===o("WAWebUA").BROWSER_TYPE.FIREFOX||o("WAWebUA").UA.isChrome&&Number(o("WAWebUA").UA.browserVersion.split(".")[0])<80;return!e}catch(e){return!1}}function d(){return!(o("WAWebUA").UA.isSafari||o("WAWebUA").UA.isFirefox)}l.canEnableOfflineNotifications=e,l.canShowNotificationsBanner=s,l.canSupportOfflineNotifications=u,l.canSupportPeriodicBackgroundSync=c,l.canSupportNotificationActions=d}),98);
__d("WAWebPushNotificationsOfflineBbApi",["WAWebPushNotificationsGatingUtils","WAWebUserPrefsNotifications"],(function(t,n,r,o,a,i,l){var e=1e4,s=!0,u=null;function c(){o("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()&&(s=!1,u=self.performance.now())}function d(){o("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()&&!s&&u!=null&&self.performance.now()-u>e&&o("WAWebUserPrefsNotifications").setOfflineNotificationsBBStatus({isLongResumeTime:!0})}l.setStartCommsT=c,l.setMainStreamModeReadyT=d}),98);
__d("WAWebSocketLogoutJob",["Promise","WALogger","WAWebBackendApi","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsGeneral","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(o("WAWebRuntimeEnvironmentUtils").isServiceWorker())try{yield(s||(s=n("Promise"))).all([o("WAWebUserPrefsGeneral").setOfflinePushDisabled(!0),o("WAWebUserPrefsGeneral").setLogoutReason({reason:t})])}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Socket logout failed, err: ",""])),t).sendLogs("sw-socket-logout-failed");return}o("WAWebBackendApi").frontendFireAndForget("socketLogout",{reason:t})}),c.apply(this,arguments)}l.socketLogout=u}),98);
__d("WAWebOfflineResumeUtils",["Promise","WABackoffUtils","WALogger","WAPromiseDelays","WAPromiseLoop","WAWebBackendEventBus","WAWebClearDanglingReceipts","WAWebGetMessageCache","WAWebLogoutReasonConstants","WAWebMessageReceiptBatcher","WAWebNetworkStatus","WAWebOffdStorageUpdateOfflinePeerReceipts","WAWebOfflineDeviceCache","WAWebPageLoadLogging","WAWebPruneExpiredMessagesWithAddOns","WAWebPushNotificationsOfflineBbApi","WAWebSocketLogoutJob","WAWebWamOfflineResumeReporter","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h={MIN_MESSAGE:20,LIMIT_WITH_MESSAGE:50,MAX_STANZA:200};function y(){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("WAWebGetMessageCache").getMessageCache().createSnapshot(),o("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.createSnapshot();var e=[o("WAWebGetMessageCache").getMessageCache().checkpointQueue.wait(),o("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.checkpointQueue.wait()];e.push(o("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches()),yield(g||(g=n("Promise"))).all(e)}),C.apply(this,arguments)}function b(){return r("WAWebNetworkStatus").online?o("WAPromiseLoop").promiseLoop((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=o("WAPromiseDelays").delayMs(o("WABackoffUtils").expBackoff(n,12e4,1e3,.1));try{return yield o("WAWebClearDanglingReceipts").clearDanglingReceipts(),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: done."]))),e()}catch(t){return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: failed with error ","."])),t),n>3?(o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: Gave up clean up receipts "," tries"])),n),e()):r}});return function(t,n,r){return e.apply(this,arguments)}})()):(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: skip due to offline."]))),(g||(g=n("Promise"))).resolve())}function v(){var e;o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[reload] refreshWindow"]))),(e=window.location)==null||e.reload()}function S(e,t){return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] restoreDataFromStorage failed for "," due to ",", stack: ",""])),e,t,t.stack).verbose().sendLogs("offline-resume-fatal-error-"+e,{sendLogsType:o("WALogger").SendLogsType.USER_FORCEFULLY_LOGGED_OUT_SAD}),o("WAWebSocketLogoutJob").socketLogout(o("WAWebLogoutReasonConstants").LogoutReason.WebFailOfflineResume),!0}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WAWebPageLoadLogging").startPageLoadQplMeasure("restoreDataFromStorage");var t=e.shouldRestoreChatsAndMsgs,r=t===void 0?!0:t,a=e.shouldUpdateReceipts,i=a===void 0?!1:a;o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] restoreDataFromStorage."])));var l=i?o("WAWebOffdStorageUpdateOfflinePeerReceipts").updatePeerReceipts():(g||(g=n("Promise"))).resolve(),s=l.then(function(){return r?o("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("restoreChatsAndMessages").catch(function(e){S("chats",e)}):(g||(g=n("Promise"))).resolve()}),u=o("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("restoreGroupsAndContacts").catch(function(e){S("groups-and-contacts",e)}),c=o("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("restoreProfilePictures").catch(function(e){S("profile-pictures",e)});yield(g||(g=n("Promise"))).all([s,u,c]),o("WAWebPageLoadLogging").endPageLoadQplMeasure("restoreDataFromStorage")}),L.apply(this,arguments)}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{yield o("WAWebPruneExpiredMessagesWithAddOns").pruneExpiredMessagesWithAddOns()}catch(e){throw o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] loadMainScreen: pruneExpiredMessages message failed with error: ",""])),e),e}yield R(e),I(),o("WAWebBackendEventBus").BackendEventBus.triggerOfflineProcessReady(),o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] loadMainScreen complete"])))}),k.apply(this,arguments)}function I(){o("WAWebBackendEventBus").BackendEventBus.triggerMainStreamModeReady(),o("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logMainScreenLoadT(),o("WAWebPushNotificationsOfflineBbApi").setMainStreamModeReadyT()}function T(e,t){return e+t>h.MAX_STANZA||e>h.MIN_MESSAGE&&e+t>h.LIMIT_WITH_MESSAGE}l.clearOfflineSnapShot=y,l.runReceiptCleanUpLoop=b,l.refreshWindow=v,l.loadMainScreen=E,l.exceedResumeWithOpenTabLimit=T}),98);
__d("WAWebPruneExpiredMessagesWithAddOns",["WALogger","WAWebBackendApi","WAWebDBEphemeralMessage","WAWebMsgKey","WAWebPageLoadLogging","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("WAWebPageLoadLogging").startPageLoadQplMeasure("pruneExpiredMessagesWithAddOns");var t=yield o("WAWebDBEphemeralMessage").pruneExpiredMessages(),n=t.length;if(n>0){var a=[],i=new Set;t.forEach(function(e){var t=e.id.toString();i.add(r("WAWebMsgKey").fromString(t).remote.toString()),a.push(t)});var l=Array.from(i.values()).join(",").toString();o("WAWebBackendApi").frontendFireAndForget("deleteModelsForLastAddOnPreview",{messagesIds:a}),yield o("WAWebPersistedJobManager").getJobManager().waitUntilPersisted(o("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(l,a)),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] pruneExpiredMessagesWithAddOns: pruneExpiredMessages pruned "," msg(s)"])),n)}o("WAWebPageLoadLogging").endPageLoadQplMeasure("pruneExpiredMessagesWithAddOns")}),u.apply(this,arguments)}l.pruneExpiredMessagesWithAddOns=s}),98);
__d("WAWebSendMsgCommonApi",["WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebABProps","WAWebAck","WAWebAddonRetryRequestUtils","WAWebDeviceListPk","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebReactionsBEUtils","WAWebSchemaMessage","WAWebSendMsgTypes","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebVerifyProtobufMsgObjectKeys","WAWebWidFactory","asyncToGeneratorRuntime","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){var e,s,u,c=5;function d(){return(o("WAWebABProps").getABPropConfigValue("web_e2e_backfill_expire_time")||c)*60}function m(e){var t=o("encodeProtobuf").encodeProtobuf(o("WAWebProtobufsE2E.pb").MessageSpec,e);return o("WAWebSignalCommonUtils").writeRandomPadMax16(t),t.readByteArrayView()}function p(e){return e.protocolMessage!=null&&e.protocolMessage.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REVOKE}function _(e){var t,n,r,a,i,l=(t=(n=e.protocolMessage)==null?void 0:n.type)!=null?t:(r=e.editedMessage)==null||(r=r.message)==null||(r=r.protocolMessage)==null?void 0:r.type;return l===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT||((a=e.secretEncryptedMessage)==null?void 0:a.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT||((i=e.secretEncryptedMessage)==null?void 0:i.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.MESSAGE_EDIT}function f(e){return e.keepInChatMessage!=null&&e.keepInChatMessage.key!=null&&e.keepInChatMessage.key.fromMe===!0&&e.keepInChatMessage.keepType===o("WAWebProtobufsE2E.pb").KeepType.UNDO_KEEP_FOR_ALL}function g(e,t){var n,r=o("WAWebVerifyProtobufMsgObjectKeys").getProtobufMessageTypesSet(e),a=(n=o("WAWebVerifyProtobufMsgObjectKeys").getUnwrappedProtobufMessage(e))!=null?n:e;if(r.has(o("WAWebMsgType").MSG_TYPE.PROTOCOL)){var i,l=(i=a.protocolMessage)==null?void 0:i.type;if(l===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REVOKE){var s=t==="admin_revoke"?o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE:o("WAWebAck").EDIT_ATTR.SENDER_REVOKE;return o("WAWap").CUSTOM_STRING(String(s))}else if(l===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)return o("WAWap").CUSTOM_STRING(String(o("WAWebAck").EDIT_ATTR.MESSAGE_EDIT))}else{if(r.has(o("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED)||r.has(o("WAWebMsgType").MSG_TYPE.MESSAGE_EDIT_ENCRYPTED))return o("WAWap").CUSTOM_STRING(String(o("WAWebAck").EDIT_ATTR.MESSAGE_EDIT));if(r.has(o("WAWebMsgType").MSG_TYPE.REACTION)){var u;if(((u=a.reactionMessage)==null?void 0:u.text)===o("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT)return o("WAWap").CUSTOM_STRING(String(o("WAWebAck").EDIT_ATTR.SENDER_REVOKE))}else if(r.has(o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT)){if(f(a))return o("WAWap").CUSTOM_STRING(String(o("WAWebAck").EDIT_ATTR.SENDER_REVOKE))}else if(r.has(o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE))return o("WAWap").CUSTOM_STRING(String(o("WAWebAck").EDIT_ATTR.PIN_IN_CHAT))}return o("WAWap").DROP_ATTR}function h(e,t){return g(e,t)}var y=new(r("WADeprecatedWapParser"))("sendMsgAckSyncParser",function(e){return e.assertTag("ack"),{t:e.attrTime("t"),sync:e.maybeAttrString("sync"),phash:e.maybeAttrString("phash"),refreshLid:e.hasAttr("refresh_lid")?e.attrString("refresh_lid")==="true":!1,addressingMode:e.maybeAttrString("addressing_mode"),count:e.maybeAttrInt("count"),error:e.maybeAttrInt("error")}});function C(e){return e.device==null||e.device===o("WAJids").DEFAULT_DEVICE_ID}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.data.id;if(e.type===o("WAWebSendMsgTypes").SendMessageRecordType.Addon){var r=yield o("WAWebAddonRetryRequestUtils").hasSentAddonMsg(n);if(r!=null)return o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().updateIdentityRangeAfterEncryption("sentAddonRowId",r.rowId,t.map(function(e){return o("WAWebSignalCommonUtils").createSignalAddress(e).toString()}))}else if(e.type===o("WAWebSendMsgTypes").SendMessageRecordType.Message){var a=yield o("WAWebSchemaMessage").getMessageTable().get(String(n),!1),i=a==null?void 0:a.rowId;if(i!=null)return o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().updateIdentityRangeAfterEncryption("rowId",i,t.map(function(e){return o("WAWebSignalCommonUtils").createSignalAddress(e).toString()}))}}),v.apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.data.id;if(t.type===o("WAWebSendMsgTypes").SendMessageRecordType.Addon){var r=yield o("WAWebAddonRetryRequestUtils").hasSentAddonMsg(n);return r||o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["filterDeviceWithChangedIdentity: addon not found: ",""])),n),r==null?void 0:r.rowId}else if(t.type===o("WAWebSendMsgTypes").SendMessageRecordType.Message){var a=yield o("WAWebSchemaMessage").getMessageTable().get(String(n),!1);return a||o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["filterDeviceWithChangedIdentity: message not found: ",""])),n),a==null?void 0:a.rowId}}),R.apply(this,arguments)}function L(e,t){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield S(e);if(n==null)throw o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["filterDeviceWithChangedIdentity: cannot determine rowId for message: ",", type: ",""])),e.data.id,e.data.type),r("err")("filterDeviceWithChangedIdentity: cannot determine message rowId");var a=new Map;t.forEach(function(e){a.set(o("WAWebDeviceListPk").createDeviceListPK(e),e)});var i=Array.from(a.values(),function(e){return o("WAWebWidFactory").createDeviceWidFromUserAndDevice(e.user,e.server,o("WAJids").DEFAULT_DEVICE_ID)}),l=yield o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkGetIdentityWithRowId(i.map(function(e){return o("WAWebSignalCommonUtils").createSignalAddress(e)})),s=new Set;return l.forEach(function(t,r){var a=e.type===o("WAWebSendMsgTypes").SendMessageRecordType.Addon?t==null?void 0:t.sentAddonRowId:t==null?void 0:t.rowId,l=i[r];(a==null||a>n)&&s.add(o("WAWebDeviceListPk").createDeviceListPK(l))}),t.filter(function(e){return!s.has(o("WAWebDeviceListPk").createDeviceListPK(e))})}),E.apply(this,arguments)}l.getResendTimeoutInSeconds=d,l.encodeAndPad=m,l.isRevokeMsg=p,l.isEditMsg=_,l.editAttribute=h,l.sendMsgAckSyncParser=y,l.isPrimaryDevice=C,l.updateIdentityRange=b,l.filterDeviceWithChangedIdentity=L}),98);
__d("WAWebSignal",["WAWebSignalCipherApi","WAWebSignalSessionApi"],(function(t,n,r,o,a,i,l){l.Cipher=o("WAWebSignalCipherApi"),l.Session=o("WAWebSignalSessionApi")}),98);
__d("WAWebSignalCipherApi",["Promise","WAWebCryptoLibrary","WAWebSignalCommonErrors","asyncToGeneratorRuntime","cr:4533","gkx"],(function(t,n,r,o,a,i,l){var e;function s(e,t,n,r){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l){if(l===void 0&&(l=!1),!r("gkx")("26258")){var s=n("cr:4533")==null?void 0:n("cr:4533").getDebugDecryptFail();if(s!=null&&s>0)return n("cr:4533")==null||n("cr:4533").setDebugDecryptFail(s-1),(e||(e=n("Promise"))).reject(new(o("WAWebSignalCommonErrors")).SignalDecryptionError)}return o("WAWebCryptoLibrary").decryptSignalProto(t,a,i,l)}),u.apply(this,arguments)}function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return o("WAWebCryptoLibrary").encryptSignalProto(e,t)}),d.apply(this,arguments)}function m(e,t,n){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i){if(!r("gkx")("26258")){var l=n("cr:4533")==null?void 0:n("cr:4533").getDebugDecryptFail();if(l!=null&&l>0)return n("cr:4533")==null||n("cr:4533").setDebugDecryptFail(l-1),(e||(e=n("Promise"))).reject(new(o("WAWebSignalCommonErrors")).SignalDecryptionError)}return o("WAWebCryptoLibrary").decryptGroupSignalProto(t,a,i)}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){return o("WAWebCryptoLibrary").encryptSenderKeyMsgSignalProto(e,t,n)}),f.apply(this,arguments)}l.decryptSignalProto=s,l.encryptSignalProto=c,l.decryptGroupSignalProto=m,l.encryptSenderKeyMsgSignalProto=_}),98);
__d("WAWebCryptoLibrarySignalGroupUtilsApi",[],(function(t,n,r,o,a,i){var e="v1";function l(e,t,n,r){return{signatureKey:e,chainKey:t,keyId:n,messageKeys:r==null?[]:r}}function s(t){return{sessions:t,version:e}}function u(e){return e}function c(e,t){return{counter:e,key:t}}function d(e,t){return t!=null?{pubKey:e,privKey:t}:e}i.makeLibsignalSenderKeyState=l,i.makeNewLibsignalSenderKeySession=s,i.makeLibsignalSenderKeyMsgKey=u,i.makeLibsignalSenderKeyChainKey=c,i.makeLibsignalSenderKeySignatureKey=d}),66);
__d("WAWebCryptoLibrarySenderkeySessionConversionApi",["invariant","WAByteArray","WAPromiseReduce","WASignalGroupSession","WASignalOther","WAWebCryptoLibrarySignalGroupUtilsApi","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l,s){function e(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.sessions,r=yield o("WAPromiseReduce").promiseReduce(t,(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield c(t);return e==null?o("WASignalGroupSession").makeNewSenderKeySession(r):o("WASignalGroupSession").updateSessionWithNewSenderKeyState(e,r)});return function(t,n,r){return e.apply(this,arguments)}})(),null);return r!=null||s(0,72944),r}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){for(var t=e.signatureKey.pubKey!==void 0?new Uint8Array(e.signatureKey.pubKey):new Uint8Array(e.signatureKey),n=e.signatureKey.privKey?o("WASignalOther").ensureSize(new Uint8Array(e.signatureKey.privKey),32):void 0,r=o("WASignalGroupSession").makeSenderKeyChainKey(e.chainKey.counter,o("WASignalOther").ensureSize(new Uint8Array(e.chainKey.key),32)),a=e.keyId,i=[],l=function*(n){if(e.messageKeys[n]){var t=e.messageKeys[n],r=yield o("WASignalOther").hkdf(new Uint8Array(t),null,"WhisperGroup",50).then(function(e){return o("WASignalGroupSession").makeSenderKeyMsgKey(n,e)});i.push(r)}},s=0;s<e.messageKeys.length;s++)yield*l(s);var u=i,c=o("WASignalGroupSession").makeSenderKeyState(t,n,r,a,u);return c}),d.apply(this,arguments)}function m(e){var t=[],n=o("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeyChainKey(e.senderKeyChainKey.nextMsgIndex,o("WAByteArray").uint8ArrayToBuffer(e.senderKeyChainKey.chainKey)),r=e.senderKeyId,a=e.senderSigningKeyPrivate,i=a!=null?o("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeySignatureKey(o("WAByteArray").uint8ArrayToBuffer(e.senderSigningKeyPublic),o("WAByteArray").uint8ArrayToBuffer(a)):o("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeySignatureKey(o("WAByteArray").uint8ArrayToBuffer(e.senderSigningKeyPublic)),l=o("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeyState(i,n,r,t);return l}function p(e){var t=e.senderKeyStates,n=t.map(function(e){return m(e)});return o("WAWebCryptoLibrarySignalGroupUtilsApi").makeNewLibsignalSenderKeySession(n)}l.toCryptoManagerSenderKeySession=e,l.toSignalSenderKeySession=p}),98);
__d("WAWebCryptoLibrarySessionConversionApi",["WAArrayBufferUtils","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=d(e),r=yield u(n,t),a=[];for(var i in e.sessions)if(e.sessions[i].indexInfo.closed!==-1){var l=yield u(e.sessions[i],t),s=o("WASignalSessions").detachSession(l);a.push(s)}return o("WASignalSessions").setPrevSessions(r,a)}),s.apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n=[];if(e.currentRatchet.lastRemoteEphemeralKey){var r=e[o("WAArrayBufferUtils").arrayBufferToString(e.currentRatchet.lastRemoteEphemeralKey)];if(r){for(var a=[],i=function*(t){var e=r.messageKeys[t],n=yield o("WASignalOther").hkdf(new Uint8Array(e),null,"WhisperMessageKeys",80).then(function(e){return o("WASignalSessions").splitMsgKey(t,e)});a.push(n)},l=0;l<r.messageKeys.length;l++)yield*i(l);var s=e.currentRatchet.lastRemoteEphemeralKey,u=r.chainKey.key;if(s!=null&&u!=null){var c=o("WASignalSessions").makeRecvChain(o("WASignalKeys").castToSerializedPubKey(new Uint8Array(s)),r.chainKey.counter+1,o("WASignalOther").toBytes(u,32),a);n.push(c)}}}var d=e[o("WAArrayBufferUtils").arrayBufferToString(e.currentRatchet.ephemeralKeyPair.pubKey)],m=o("WASignalKeys").castToSerializedPubKey(new Uint8Array(e.currentRatchet.ephemeralKeyPair.pubKey)),p=d.chainKey.key,_=o("WASignalOther").toBytes(e.currentRatchet.ephemeralKeyPair.privKey,32),f=o("WASignalKeys").makeSerializedKeyPairFrom(_,m),g=o("WASignalSessions").makeSendChain(f,d.chainKey.counter+1,o("WASignalOther").toBytes(p,32)),h=t&&{regId:t.registrationId,pubKey:o("WASignalKeys").serializeIdentity(new Uint8Array(t.identityKeyPair.pubKey))},y=t&&{regId:e.registrationId,pubKey:new Uint8Array(e.indexInfo.remoteIdentityKey)},C=e.indexInfo.baseKey&&o("WASignalKeys").castToSerializedPubKey(new Uint8Array(e.indexInfo.baseKey)),b=e.currentRatchet.previousCounter,v=o("WASignalOther").toBytes(e.currentRatchet.rootKey,32),S;e.pendingPreKey!=null&&(S=o("WASignalSessions").makeInitialExchangeInfo(e.pendingPreKey.preKeyId,e.pendingPreKey.signedKeyId,o("WASignalKeys").castToSerializedPubKey(new Uint8Array(e.pendingPreKey.baseKey))));var R=[],L=o("WASignalSessions").makeSession(h,y,v,n,g,S,Math.max(b,0),R,C);return L}catch(e){throw e}}),c.apply(this,arguments)}function d(e){var t=e.sessions;for(var n in t)if(t[n].indexInfo.closed===-1)return t[n];throw r("err")("getOpenSession: There are no open session")}l.toCryptoLibrarySessionPrevSessions=e,l.toCryptoManagerSession=u}),98);
__d("WAWebSignalConvertApi",["Promise","WALogger","WAWebCryptoCurve25519","WAWebCryptoLibrarySenderkeySessionConversionApi","WAWebCryptoLibrarySessionConversionApi","WAWebSignalProtocolStore","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u,c,d;function m(e){return(e==null?void 0:e.sessions)!=null}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{if(e==null||!m(e))return e;var t=yield(d||(d=n("Promise"))).all([o("WAWebSignalProtocolStore").getSignalProtocolStore().getIdentityKeyPair(),o("WAWebSignalProtocolStore").getSignalProtocolStore().getLocalRegistrationId()]),a=t[0],i=t[1];if(!a||i==null)throw r("err")("Attempted to loadSession without registration info");var l={identityKeyPair:o("WAWebCryptoCurve25519").toCurveKeyPair(a),registrationId:i};return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSession: converting to crypto library"]))).sendLogs("libsignal-to-cryptolib-session",{sampling:0}),o("WAWebCryptoLibrarySessionConversionApi").toCryptoLibrarySessionPrevSessions(e,l)}catch(e){throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSession: failed with error ",""])),e).sendLogs("session-convert-error"),e}}),_.apply(this,arguments)}function f(e){return e.sessions!=null}function g(t){try{return t==null||!f(t)?t:(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSenderKey: converting to crypto library"]))).sendLogs("libsignal-to-cryptolib-senderkey",{sampling:0}),o("WAWebCryptoLibrarySenderkeySessionConversionApi").toCryptoManagerSenderKeySession(t))}catch(e){throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSenderKey: failed with error ",""])),e).sendLogs("senderkey-convert-error"),e}}l.shouldConvertSession=m,l.maybeConvertSession=p,l.maybeConvertSenderKey=g}),98);
__d("WAWebSignalSessionApi",["Promise","WABinary","WAJids","WALogger","WAWebAdvSignatureApi","WAWebApiContact","WAWebCryptoCurve25519","WAWebCryptoLibrary","WAWebCryptoLibraryDbCallbacksApi","WAWebCryptoLibrarySessionApi","WAWebCryptoLibraryUtilsApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebSignalStoreApi","WAWebWidFactory","asyncToGeneratorRuntime","cr:4533","err","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h;function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.deviceIdentity,a=t.identity,i=t.wid;if(r("gkx")("26258")?o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Signal::createSignalSession"]))):o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Signal::createSignalSession with ",""])),i.toString({legacy:!0})),i.device!=null&&i.device!==o("WAJids").DEFAULT_DEVICE_ID){if(!n)throw r("err")("Signal::createSignalSession: expected device-identity in keyBundle for companion device");var l=yield o("WAWebAdvSignatureApi").validateADVwithIdentityKey(i,n,a);if(!l)throw r("err")("Signal::createSignalSession: invalid identityKey fetched")}var m,p,_;try{m=o("WAWebCryptoCurve25519").toSignalCurvePubKey(new(o("WABinary")).Binary(t.identity).readBuffer())}catch(e){throw o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]))).sendLogs("Signal::createSignalSession: invalid identityKey fetched"),e}try{p=o("WAWebCryptoCurve25519").toSignalCurvePubKey(new(o("WABinary")).Binary(t.skey.pubkey).readBuffer())}catch(e){throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]))).sendLogs("Signal::createSignalSession: invalid signedPreKey fetched"),e}if(t.key)try{_=o("WAWebCryptoCurve25519").toSignalCurvePubKey(new(o("WABinary")).Binary(t.key.pubkey).readBuffer())}catch(e){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]))).sendLogs("Signal::createSignalSession: invalid preKey fetched")}var f={registrationId:t.regId,identityKey:m,signedPreKey:{keyId:t.skey.id,publicKey:p,signature:new(o("WABinary")).Binary(t.skey.signature).readBuffer()}};return t.key&&_&&(f.preKey={keyId:t.key.id,publicKey:_}),o("WAWebCryptoLibrarySessionApi").createSignalSession(f,i)}),C.apply(this,arguments)}function b(e){return o("WAWebApiContact").checkPnToLidMapping(e,o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_HAS_SIGNAL_SESSIONS),o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().containSessions(e.map(function(e){return o("WAWebSignalCommonUtils").createSignalAddress(e).toString()}))}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebCryptoLibrarySessionApi").getRemoteRegId(e)}),S.apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_DELETE_REMOTE_INFO);var t=o("WAWebSignalCommonUtils").createSignalAddress(e).toString(),r=[o("WAWebSignalProtocolStore").getSignalProtocolStore().removeIdentity(t),o("WAWebSignalProtocolStore").getSignalProtocolStore().removeSession(t)];yield(h||(h=n("Promise"))).all(r)}),L.apply(this,arguments)}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_DELETE_REMOTE_SESSION);var t=o("WAWebSignalCommonUtils").createSignalAddress(e).toString();yield o("WAWebSignalProtocolStore").getSignalProtocolStore().removeSession(t)}),k.apply(this,arguments)}function I(e){var t=o("WAWebSignalCommonUtils").createSignalAddress(e).toString();return o("WAWebSignalProtocolStore").getPersistSignalProtocolStore().maybeCleanUpUnconvertedSession(t)}function T(e){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebCryptoLibraryDbCallbacksApi").getCryptoDbCallbacks(),n=o("WAJids").unsafeCoerceToDeviceJid(e.toJid()),a=yield r("WAWebCryptoLibraryUtilsApi").getSessionAliceBaseKey(n,t.loadSession);return a.success===!0?a.value:null}),D.apply(this,arguments)}function x(e,t){return $.apply(this,arguments)}function $(){return $=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_SAVE_SESSION_BASE_KEY);var n=o("WAWebSignalCommonUtils").createSignalAddress(e),r=yield T(e);r?yield o("WAWebSignalStoreApi").waSignalStore.saveBaseKey(n.toString(),t,r):o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["saveSessionBaseKey: for ",", no basekey provided"])),t)}),$.apply(this,arguments)}function P(e,t){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_HAS_SAME_BASE_KEY);var r=o("WAWebSignalCommonUtils").createSignalAddress(e),a=yield(h||(h=n("Promise"))).all([T(e),o("WAWebSignalStoreApi").waSignalStore.loadBaseKey(r.toString(),t)]),i=a[0],l=a[1];return l?i?o("WAWebSignalCommonUtils").bufferEqual(l,i)?(o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", savedBaseKey and sessionBaseKey is same"])),t),!0):(o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", savedBaseKey and sessionBaseKey is different "])),t),!1):(o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", no session has been saved locally "])),t),!1):(o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", no base key has been saved locally "])),t),!1)}),N.apply(this,arguments)}function M(e,t,n){return w.apply(this,arguments)}function w(){return w=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){return o("WAWebCryptoLibrarySessionApi").createGroupSenderSignalSession(o("WAWebWidFactory").createWid(t),e,n)}),w.apply(this,arguments)}function A(e,t){return F.apply(this,arguments)}function F(){return F=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return o("WAWebCryptoLibrary").getGroupSenderKeyInfo(e,t)}),F.apply(this,arguments)}function O(e,t){o("WAWebApiContact").checkPnToLidMapping([t],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_DELETE_GROUP_SENDER_KEY_INFO);var n=o("WAWebSignalCommonUtils").createSignalAddress(t),r=e.toString({legacy:!0})+"::"+n.toString();return o("WAWebSignalStoreApi").waSignalStore.removeSenderKey(r)}function B(e){o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_SIGNAL_SESSION_DELETE_DEVICE_SENDER_KEY);var t=String(o("WAWebSignalCommonUtils").createSignalAddress(e));return o("WAWebSignalStoreApi").waSignalStore.removeSenderKeyBySenderId(t)}l.createSignalSession=y,l.hasSignalSessions=b,l.getRemoteRegId=v,l.deleteRemoteInfo=R,l.deleteRemoteSession=E,l.maybeDeleteUnconvertedSession=I,l.saveSessionBaseKey=x,l.hasSameBaseKey=P,l.createGroupSignalSession=M,l.getGroupSenderKeyInfo=A,l.deleteGroupSenderKeyInfo=O,l.deleteDeviceSenderKey=B}),98);
__d("WAWebSignalUtilsApi",["WAWap","WAWebCryptoCurve25519","WAWebCryptoLibraryUtilsApi"],(function(t,n,r,o,a,i,l){function e(e){var t;return(t=o("WAWap")).wap("skey",null,t.wap("id",null,t.BIG_ENDIAN_CONTENT(e.keyId,3)),t.wap("value",null,e.keyPair.pubKey),t.wap("signature",null,e.signature))}function s(e){var t;return(t=o("WAWap")).wap("key",null,t.wap("id",null,t.BIG_ENDIAN_CONTENT(e.keyId,3)),t.wap("value",null,e.keyPair.pubKey))}function u(e){var t=r("WAWebCryptoLibraryUtilsApi").extractIdentityKey(e);return t.success===!0?o("WAWebCryptoCurve25519").toCurveKeyPubKey(t.value):null}l.xmppSignedPreKey=e,l.xmppPreKey=s,l.extractIdentityKey=u}),98);
__d("WAWebCryptoLibrary",["Promise","WAByteArray","WACryptoLibrary","WAJids","WALogger","WASignalKeys","WAWebBackendJobs.flow","WAWebCryptoLibraryDbCallbacksApi","WAWebCryptoLibraryUtilsApi","WAWebSignalCommonErrors","WAWebWidToJid","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L=o("WAWebCryptoLibraryDbCallbacksApi").getCryptoDbCallbacks();function E(){var e;return{establishOutgoingSession:(e=o("WACryptoLibrary")).establishOutgoingSession,decryptContent:e.decryptContent,encryptContent:e.encryptContent,encryptGroupContent:e.encryptGroupContent,decryptGroupContent:e.decryptGroupContent,saveSenderKeySession:e.saveSenderKeySession,rotateGroupSenderKey:e.rotateGroupSenderKey}}function k(e,t){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::createSignalSession"])));var n=yield L.getRegistrationInfo();if(!n)throw r("err")("No registration info found");return E().establishOutgoingSession({handleNewSession:L.handleNewSession},n,o("WAWebWidToJid").widToDeviceJid(e),t,void 0).then(function(e){if(!e.success)throw o("WALogger").WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::createSignalSession failed with error ",""])),e.error),r("err")(e.error)})}),I.apply(this,arguments)}function T(e,t,n,r){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){i===void 0&&(i=!1),o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptSignalProto"])));var l=t===o("WAWebBackendJobs.flow").CiphertextType.Pkmsg?"pkmsg":"msg",s,u=yield L.getRegistrationInfo();return u?E().decryptContent({handleNewSession:function(t,n,r,o,a){return L.handleNewSession(t,n,r,o,a,i)},loadOneTimePreKey:L.loadOneTimePreKey,loadSession:L.loadSession,loadSignedPreKey:L.loadSignedPreKey},u,o("WAWebWidToJid").widToDeviceJid(e),{ciphertext:a,type:l},function(e){return s=o("WAByteArray").uint8ArrayToBuffer(e),(R||(R=n("Promise"))).resolve()},{}).then(function(e){if(e.success){if(s==null)throw new(o("WAWebSignalCommonErrors")).SignalDecryptionError("Null result on successful decryption");return s}var t=e.error;throw o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptMessage failed with error ",""])),t),t==="errDuplicateMsg"?new(o("WAWebSignalCommonErrors")).SignalMessageCounterError(t):new(o("WAWebSignalCommonErrors")).SignalDecryptionError(t)}).catch(function(e){throw e instanceof o("WAWebSignalCommonErrors").SignalDecryptionError||e instanceof o("WAWebSignalCommonErrors").SignalMessageCounterError?e:(o("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptSignalProto failed to decrypt: ",""])),e.stack),new(o("WAWebSignalCommonErrors")).SignalDecryptionError("Unexpected decryption error"))}):(R||(R=n("Promise"))).reject(r("err")("No registration info found"))}),D.apply(this,arguments)}function x(t,n){return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptSignalProto"]))),E().encryptContent({handleNewSession:L.handleNewSession,loadSession:L.loadSession},o("WAWebWidToJid").widToDeviceJid(t),n,null).then(function(e){if(e.success){var t,n=e.value,a=n.ciphertext,i=n.type;return{type:(t=o("WAWebBackendJobs.flow").CiphertextType.cast(i))!=null?t:o("WAWebBackendJobs.flow").CiphertextType.Msg,ciphertext:o("WAByteArray").uint8ArrayToBuffer(a)}}throw o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptSignalProto:failed with error ",""])),e.error),r("err")(e.error)})}function $(e){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebWidToJid").widToDeviceJid(e),n=yield L.loadSession(t);return n==null?void 0:n.remote}),P.apply(this,arguments)}function N(e,t,n){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a,i,l=o("WAWebWidToJid").widToMulticastJid(e),s=(a=(i=o("WAJids").validateGroupJid(l))!=null?i:o("WAJids").validateStatusJid(l))!=null?a:o("WAJids").validateBroadcastJid(l);if(s==null)throw r("err")("Invalid multicast JID");var u=o("WAWebWidToJid").widToDeviceJid(t),c=yield E().encryptGroupContent({loadSenderKeySession:L.loadSenderKeySession,saveSenderKeySession:L.saveSenderKeySession},s,u,n);if(!c.success&&c.error==="errLoadSenderKeySession"){c.error,o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptGroupMessage no sender key, generating a new one"])));var d=yield o("WASignalKeys").makeKeyPair();yield E().rotateGroupSenderKey({saveSenderKeySession:L.saveSenderKeySession},s,u,d),c=yield E().encryptGroupContent({loadSenderKeySession:L.loadSenderKeySession,saveSenderKeySession:L.saveSenderKeySession},s,u,n)}if(c.success){var m=c.value.ciphertext.ciphertext,p=c.value.senderKeyDistributionProto;return{ciphertext:o("WAByteArray").uint8ArrayToBuffer(m),senderKeyBytes:o("WAByteArray").uint8ArrayToBuffer(p)}}throw o("WALogger").WARN(b||(b=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptGroupMessage failed with error ",""])),c.error),r("err")(c.error)}),M.apply(this,arguments)}function w(e,t,n){return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::processSenderKeyDistributionMsg"]))),E().saveSenderKeySession({loadSenderKeySession:L.loadSenderKeySession,saveSenderKeySession:L.saveSenderKeySession},e,o("WAWebWidToJid").widToDeviceJid(t),new Uint8Array(n)).then(function(e){if(!e.success)throw o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::processSenderKeyDistributionMsg failed with error ",""])),e.error),r("err")(e.error)})}function A(e,t,r){o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptGroupSignalProto"])));var a=null;return E().decryptGroupContent({loadSenderKeySession:L.loadSenderKeySession,saveSenderKeySession:L.saveSenderKeySession},o("WAWebWidToJid").widToMulticastJid(e),o("WAWebWidToJid").widToDeviceJid(t),r,function(e){return a=o("WAByteArray").uint8ArrayToBuffer(e),(R||(R=n("Promise"))).resolve()}).then(function(e){if(e.success){if(a==null)throw new(o("WAWebSignalCommonErrors")).SignalDecryptionError("Null result on successful decryption of group msg");return a}var t=e.error;throw o("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptGroupMessage failed ",""])),t),t==="errDuplicateMsg"?new(o("WAWebSignalCommonErrors")).SignalMessageCounterError(t):new(o("WAWebSignalCommonErrors")).SignalDecryptionError(t)}).catch(function(e){throw e instanceof o("WAWebSignalCommonErrors").SignalDecryptionError||e instanceof o("WAWebSignalCommonErrors").SignalMessageCounterError?e:(o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptGroupSignalProto failed to decrypt: ",""])),e),new(o("WAWebSignalCommonErrors")).SignalDecryptionError("Unexpected decryption error"))})}function F(e,t){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){o("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::getGroupSenderKeyInfo"])));var n=yield r("WAWebCryptoLibraryUtilsApi").createSenderKeyDistributionMsg(L.loadSenderKeySession,L.saveSenderKeySession,o("WAJids").toGroupJid(e.toString({legacy:!0})),o("WAWebWidToJid").widToDeviceJid(t));if(n.success)return o("WAByteArray").uint8ArrayToBuffer(n.value);throw o("WALogger").WARN(S||(S=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::getGroupSenderKeyInfo failed with error ",""])),n.error),r("err")(n.error)}),O.apply(this,arguments)}l.getCryptoLibModule=E,l.createSignalSession=k,l.decryptSignalProto=T,l.encryptSignalProto=x,l.getRemoteRegId=$,l.encryptSenderKeyMsgSignalProto=N,l.processSenderKeyDistributionMsg=w,l.decryptGroupSignalProto=A,l.getGroupSenderKeyInfo=F}),98);
__d("WAWebCryptoLibraryDbCallbacksApi",["Promise","WAByteArray","WAResultOrError","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WAWebApiContact","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(){var t=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebWidFactory").createDeviceWidOrThrow(e);o("WAWebApiContact").checkPnToLidMapping([t],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_CRYPTO_LIBRARY_DB_CALLBACK_API_LOAD_SESSION);var n=o("WAWebSignalCommonUtils").createSignalAddress(t),r=yield o("WAWebSignalProtocolStore").getSignalProtocolStore().loadSession(n);return r!=null?r:null});return function(n){return e.apply(this,arguments)}})(),r=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i,l,s){s===void 0&&(s=!1);var u=o("WAWebWidFactory").createDeviceWidOrThrow(t);o("WAWebApiContact").checkPnToLidMapping([u],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_CRYPTO_LIBRARY_DB_CALLBACK_API_HANDLE_NEW_SESSION);var c=o("WAWebSignalCommonUtils").createSignalAddress(u);return(e||(e=n("Promise"))).all([!s&&o("WAWebSignalProtocolStore").getSignalProtocolStore().storeSession(c,r),a&&o("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(c,o("WAByteArray").uint8ArrayToBuffer(a)),i!=null&&o("WAWebSignalProtocolStore").getSignalProtocolStore().removePreKey(i)]).then(function(){return o("WAResultOrError").makeResult()})});return function(n,r,o,a,i,l){return t.apply(this,arguments)}})(),a=function(t,n){var e=o("WAWebWidFactory").createDeviceWidOrThrow(n);o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_CRYPTO_LIBRARY_DB_CALLBACK_API_LOAD_SENDER_KEY_SESSION);var r=o("WAWebSignalCommonUtils").createSignalLikeSenderKeyName(t,e);return o("WAWebSignalProtocolStore").getSignalProtocolStore().loadSenderKey(r).then(function(e){if(e==null)return o("WAResultOrError").makeError("errLoadSenderKeySession");var t=e;return o("WAResultOrError").makeResult(t)})},i=function(t,n,r){var e=o("WAWebWidFactory").createDeviceWidOrThrow(n);o("WAWebApiContact").checkPnToLidMapping([e],o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_CRYPTO_LIBRARY_DB_CALLBACK_API_SAVE_SENDER_KEY_SESSION);var a=o("WAWebSignalCommonUtils").createSignalLikeSenderKeyName(t,e);return o("WAWebSignalProtocolStore").getSignalProtocolStore().storeSenderKey(a,r)};return{loadSession:t,handleNewSession:r,loadSenderKeySession:a,saveSenderKeySession:i,loadSignedPreKey:function(t){return o("WAWebSignalProtocolStore").getSignalProtocolStore().loadSignedPreKey(t).then(function(e){if(e==null)return null;var n=o("WASignalKeys").makeKeyPairFromArrayBuffers(e.pubKey,e.privKey),r=o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:t,publicKey:o("WASignalKeys").serializePubKey(n),privateKey:n.privateKey,signature:new Uint8Array(e.signature),timestamp:0});return o("WASignalOther").castToByteEncoded(r)})},loadOneTimePreKey:function(t){return o("WAWebSignalProtocolStore").getSignalProtocolStore().loadPreKey(t).then(function(e){if(e==null)return null;var n=o("WASignalKeys").makeKeyPairFromArrayBuffers(e.pubKey,e.privKey),r=o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:t,publicKey:o("WASignalKeys").serializePubKey(n),privateKey:n.privateKey});return o("WASignalOther").castToByteEncoded(r)})},getRegistrationInfo:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebSignalProtocolStore").getSignalProtocolStore().getLocalRegistrationId(),t=yield o("WAWebSignalProtocolStore").getSignalProtocolStore().getIdentityKeyPair();if(!(e==null||t==null)&&e&&t)return{regId:o("WASignalOther").castRegistrationId(e),staticKeyPair:o("WASignalKeys").makeKeyPairFromArrayBuffers(t.pubKey.slice(1),t.privKey)}});function t(){return e.apply(this,arguments)}return t})()}}l.getCryptoDbCallbacks=s}),98);
__d("WAWebCryptoLibrarySessionApi",["WAWebCryptoLibrary"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebCryptoLibrary").getRemoteRegId(e).then(function(e){return e==null?void 0:e.regId})}function s(e,t){var n,r,a,i={identity:new Uint8Array(e.identityKey),oneTimeKey:e.preKey&&{id:(n=e.preKey)==null?void 0:n.keyId,publicKey:((r=e.preKey)==null?void 0:r.publicKey)&&new Uint8Array((a=e.preKey)==null?void 0:a.publicKey)},regId:e.registrationId,signedKey:{id:e.signedPreKey.keyId,publicKey:new Uint8Array(e.signedPreKey.publicKey),signature:new Uint8Array(e.signedPreKey.signature)}};return o("WAWebCryptoLibrary").createSignalSession(t,i)}function u(e,t,n){return o("WAWebCryptoLibrary").processSenderKeyDistributionMsg(e,t,n)}l.getRemoteRegId=e,l.createSignalSession=s,l.createGroupSenderSignalSession=u}),98);
__d("WAWebCryptoLibraryUtilsApi",["WACryptoPrimitives","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WATimeUtils","WAWebCryptoLibrary","asyncToGeneratorRuntime","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s=(function(){function t(){}var r=t.prototype;return r.createSenderKeyDistributionMsg=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=yield e(n,r);if(!a.success&&a.error==="errLoadSenderKeySession"){var i=yield o("WASignalKeys").makeKeyPair();yield o("WAWebCryptoLibrary").getCryptoLibModule().rotateGroupSenderKey({saveSenderKeySession:t},n,r,i),a=yield e(n,r)}if(a.success){var l=a.value.senderKeyStates.slice(-1);if(l.length>0)return o("WAResultOrError").makeResult(o("WASignalGroupCipher").createSenderKeyDistributionProto(o("WASignalGroupSession").convertFromRawToSenderKeyState(l[0])))}return o("WAResultOrError").makeError("errGetSenderKeyProto")});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),r.getSessionAliceBaseKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield t(e);return n!=null&&n.aliceBaseKey?o("WAResultOrError").makeResult(o("WASignalOther").toBuffer(n.aliceBaseKey)):o("WAResultOrError").makeError("errSessionExists")});function t(t,n){return e.apply(this,arguments)}return t})(),r.extractIdentityKey=function(n){var t=o("WASignalCipher").readContent(n,o("WASignalSessions").FORMAT_VERSION,0);if(!t.success)return t;try{var r=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,t.value),a=r.baseKey,i=r.identityKey,l=r.message,s=r.registrationId,u=r.signedPreKeyId;return s==null||u==null||a==null||i==null||l==null?o("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat"):(o("WASignalOther").ensureSize(new Uint8Array(i),33),o("WAResultOrError").makeResult(i))}catch(t){return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["extractIdentityKey: parse proto failed"]))),o("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}},r.verifySignature=function(t,n,r){var e=o("WASignalSignatures").convertPublicKeyToSerializedPubKey(t),a=o("WASignalOther").ensureSize(r,64);return o("WASignalSignatures").verifyMsgSignalVariant(e,n,a)},r.signMsg=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=o("WASignalKeys").makeKeyPairFromArrayBuffers(e,t),a=yield o("WASignalSignatures").signMsg(r,new Uint8Array(n));return o("WASignalOther").toBuffer(a)});function t(t,n,r){return e.apply(this,arguments)}return t})(),r.makePreKey=function(t){var e=o("WASignalKeys").makePreKeys(t,1),n=e[0].plainObject,r=n.id,a=n.keyPair;return{preKeyId:r,privKey:o("WASignalOther").toBuffer(a.privateKey),pubKey:o("WASignalOther").toBuffer(a.publicKey)}},r.makeSignedPreKey=function(t,n){var e=o("WASignalKeys").makeKeyPairFromArrayBuffers(t.pubKey,t.privKey),r=o("WASignalSignatures").makeSignedPreKey(n,o("WATimeUtils").unixTimeMs(),e);return{preKeyId:r.id,signature:o("WASignalOther").toBuffer(r.signature),pubKey:o("WASignalOther").toBuffer(r.keyPair.publicKey),privKey:o("WASignalOther").toBuffer(r.keyPair.privateKey)}},r.makeKeyPair=function(){var e=o("WASignalKeys").makeKeyPair(),t=e.privateKey,n=e.publicKey;return{privKey:o("WASignalOther").toBuffer(t),pubKey:o("WASignalOther").toBuffer(n)}},t})();s.prototype.verify=o("WACryptoPrimitives").verify,s.prototype.makeRegistrationId=o("WASignalOther").makeRegistrationId,s.prototype.makeSenderKeyId=o("WASignalOther").makeSenderKeyId;var u=new s,c=u;l.default=c}),98);
__d("WAWebSignalProtocolStore",["WAWebSignalProtocolStoreUnifiedApi"],(function(t,n,r,o,a,i,l){function e(){return r("WAWebSignalProtocolStoreUnifiedApi")}function s(){return r("WAWebSignalProtocolStoreUnifiedApi")}function u(){r("WAWebSignalProtocolStoreUnifiedApi").switchToMemMode()}function c(){r("WAWebSignalProtocolStoreUnifiedApi").switchToPersistMode()}l.getSignalProtocolStore=e,l.getPersistSignalProtocolStore=s,l.enableMemSignalStore=u,l.enablePersistSignalStore=c}),98);
__d("WAWebProtocolStoreCommonApi",["WAWebSignalCommonUtils"],(function(t,n,r,o,a,i,l){function e(e){return e instanceof ArrayBuffer?o("WAWebSignalCommonUtils").bufferToStr(e):e}l.stringifyIdentityKey=e}),98);
__d("WAWebSignalProtocolStoreCacheApi",["WAPromiseDelays","WASemaphore","asyncToGeneratorRuntime","lodash"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){var e;this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.PrekeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.SenderKeyStore=new Map,this.Mutex={session:new(e=o("WASemaphore")).Semaphore,identity:new e.Semaphore,senderKey:new e.Semaphore,preKey:new e.Semaphore},this.Dirty={session:new Set,identity:new Set,senderKey:new Set,preKey:new Set}}var t=e.prototype;return t.$1=function(){var e=this,t=[],n=[];return this.Dirty.session.forEach(function(o){var a=e.SessionStore.get(o);a&&(a.deleted?n.push(o):t.push({address:o,session:r("lodash").cloneDeep(a.session)}))}),{update:t,remove:n}},t.$2=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=[],t=[],n=self.performance.now();for(var a of this.Dirty.session){self.performance.now()-n>u&&(yield o("WAPromiseDelays").releaseToMainThread(),n=self.performance.now());var i=this.SessionStore.get(a);i&&(i.deleted?t.push(a):e.push({address:a,session:r("lodash").cloneDeep(i.session)}))}return{update:e,remove:t}});function t(){return e.apply(this,arguments)}return t})(),t.$3=function(){var e=this,t=[];return this.Dirty.senderKey.forEach(function(n){var o=e.SenderKeyStore.get(n);if(o){var a=n.split("::");a.length===2&&t.push({senderKeyName:n,senderId:a[1],senderKey:r("lodash").cloneDeep(o)})}}),t},t.$4=function(){var e=this,t=[],n=[];return this.Dirty.identity.forEach(function(r){var o=e.IdentityStore.get(r);o&&(o.deleted?n.push(r):t.push({identifier:r,identityKey:o.identityKey,rowId:o.rowId,sentAddonRowId:o.sentAddonRowId}))}),{update:t,remove:n}},t.$5=function(){var e=this,t=[];return this.Dirty.preKey.forEach(function(n){var r=e.PrekeyStore.get(n);r!=null&&r.deleted&&t.push(parseInt(n,10))}),t},t.generateCacheUpdate=function(){var e=this.$4(),t=this.$1(),n={sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this.$3(),preKeyRemove:this.$5()};return n},t.generateCacheUpdateThrottled=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=this.$4(),t=yield this.$2(),n={sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this.$3(),preKeyRemove:this.$5()};return n});function t(){return e.apply(this,arguments)}return t})(),t.clearDirty=function(){this.Dirty={session:new Set,identity:new Set,senderKey:new Set,preKey:new Set}},t.clear=function(){this.RegistrationInfo=null,this.SignedPreKeyStore.clear(),this.PrekeyStore.clear(),this.SessionStore.clear(),this.IdentityStore.clear(),this.SenderKeyStore.clear(),this.clearDirty()},e})();function s(e){}var u=100;l.SignalStoreCache=e}),98);
__d("WAWebSignalProtocolStoreUnifiedApi",["$InternalEnum","Promise","WALogger","WAWebBackendApi","WAWebCryptoCurve25519","WAWebIdentityChangeApi","WAWebProtocolStoreCommonApi","WAWebSignalCommonUtils","WAWebSignalConvertApi","WAWebSignalProtocolStoreCacheApi","WAWebSignalStorageUtils","WAWebSignalStoreApi","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err","gkx"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y=n("$InternalEnum").Mirrored(["Persist","Memory"]),C=(function(){function t(){this.Direction={SENDING:1,RECEIVING:2},this.$1=new(o("WAWebSignalProtocolStoreCacheApi")).SignalStoreCache,this.$2=y.Persist}var a=t.prototype;return a.cache_TESTONLY=function(){return this.$1},a.getIdentityKeyPair=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return this.$1.RegistrationInfo||(this.$1.RegistrationInfo=yield o("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo()),(e=this.$1.RegistrationInfo)!=null&&e.identityKeyPair?o("WAWebCryptoCurve25519").toSignalCurveKeyPair(this.$1.RegistrationInfo.identityKeyPair):void 0});function t(){return e.apply(this,arguments)}return t})(),a.getLocalRegistrationId=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return this.$1.RegistrationInfo||(this.$1.RegistrationInfo=yield o("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo()),((e=this.$1.RegistrationInfo)==null?void 0:e.registrationId)||void 0});function t(){return e.apply(this,arguments)}return t})(),a.isTrustedIdentity=function(t,r){return(h||(h=n("Promise"))).resolve(!0)},a.$3=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t;if(e==null)throw r("err")("Tried to get identity key for undefined/null key");if(!this.$1.IdentityStore.has(e)){var n=yield o("WAWebSignalStoreApi").waSignalStore.getIdentityKeyWithRowId(e);this.$1.IdentityStore.set(e,n)}return((t=this.$1.IdentityStore.get(e))==null?void 0:t.identityKey)||void 0});function t(t){return e.apply(this,arguments)}return t})(),a.loadIdentityKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.identity.acquire();try{return yield this.$3(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$4=function(t,n){this.$1.IdentityStore.set(t,{identityKey:n}),this.$1.Dirty.identity.add(t)},a.putIdentity=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield this.$1.Mutex.identity.acquire();try{this.$4(e,t)}finally{n.release()}});function t(t,n){return e.apply(this,arguments)}return t})(),a.$5=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WAWebProtocolStoreCommonApi").stringifyIdentityKey(t),r=yield this.loadIdentityKey(e);if(!(r!=null&&r===n)){if(r!=null){if(e===o("WAWebSignalCommonUtils").createSignalAddress(o("WAWebUserPrefsMeUser").getMePnUserOrThrow()).toString()){o("WAWebBackendApi").frontendFireAndForget("handleSelfPrimaryIdentityChange",{});return}e!=null&&(yield o("WAWebIdentityChangeApi").handleNewIdentity(o("WAWebWidFactory").widFromSignalAddress(e),!1))}yield this.putIdentity(e,n)}});function t(t,n){return e.apply(this,arguments)}return t})(),a.saveIdentity=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e==null)throw r("err")("Tried to put identity key for undefined/null key");yield this.$5(e,t)});function t(t,n){return e.apply(this,arguments)}return t})(),a.getIdentityWithRowId=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e==null)throw r("err")("Tried to get identity key for undefined/null key");yield this.loadIdentityKey(e);var t=this.$1.IdentityStore.get(e);if(!(t==null||t.deleted!==void 0))return t});function t(t){return e.apply(this,arguments)}return t})(),a.bulkGetIdentityWithRowId=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;if(e==null)throw r("err")("Tried to get identity key for undefined/null key");return e.length===0?[]:(yield this.bulkLoadIdentityKey(e),e.map(function(e){var n=t.$1.IdentityStore.get(e);if(!(n==null||n.deleted!==void 0))return n}))});function t(t){return e.apply(this,arguments)}return t})(),a.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;if(e==null)throw r("err")("Tried to get identity key for undefined/null key");if(e.length===0)return[];var n=new Array(e.length),a=[];if(e.forEach(function(e,r){if(t.$1.IdentityStore.has(e)){var o;n[r]=(o=t.$1.IdentityStore.get(e))==null?void 0:o.identityKey}else a.push({id:e,pos:r})}),a.length>0){var i=yield o("WAWebSignalStoreApi").waSignalStore.bulkGetIdentityKeyWithRowId(a.map(function(e){return e.id}));i.forEach(function(e,r){var o=a[r];t.$1.IdentityStore.set(o.id,e),n[o.pos]=e==null?void 0:e.identityKey})}return n});function t(t){return e.apply(this,arguments)}return t})(),a.bulkLoadIdentityKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.identity.acquire();try{return yield this.$6(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$7=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=this;if(t==null)throw r("err")("Tried to bulk put identity key with undefined/null");o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[Signal]bulkCreateIdentity: store "," value(s): start"])),t.length).tags("unified-store"),yield o("WAWebSignalStorageUtils").getStorage().lock(["identity-store"],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=t.map(function(e){return e.identifier}),n=yield a.$6(e),r=t.filter(function(e,t){return!n[t]});r.length>0&&(yield o("WAWebSignalStoreApi").waSignalStore.bulkPutIdentity(r),r.forEach(function(e){var t=e.identifier,n=e.identityKey;a.$1.IdentityStore.set(t,{identityKey:n})})),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[Signal]bulkCreateIdentity: store "," value(s) (new: ","): end"])),t.length,r.length).tags("unified-store")}))});function a(e){return t.apply(this,arguments)}return a})(),a.bulkCreateIdentity=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.identity.acquire();try{yield this.$7(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$8=function(t){this.$1.IdentityStore.set(t,{deleted:!0}),this.$1.Dirty.identity.add(t)},a.removeIdentity=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e==null)return(h||(h=n("Promise"))).reject(r("err")("Tried to remove identity key for undefined/null key"));var t=yield this.$1.Mutex.identity.acquire();try{yield this.$8(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$9=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e!=null){if(!this.$1.PrekeyStore.has(e)){var t,n=(t=yield o("WAWebSignalStoreApi").waSignalStore.getPreKeyById(e))==null?void 0:t.keyPair;this.$1.PrekeyStore.set(e,{keyPair:n})}var r=this.$1.PrekeyStore.get(e);return(r==null?void 0:r.keyPair)||void 0}});function t(t){return e.apply(this,arguments)}return t})(),a.loadPreKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.preKey.acquire();try{return yield this.$9(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$10=function(t){return t==null?(h||(h=n("Promise"))).reject(r("err")("Tried to remove pre key without keyId")):(this.$1.PrekeyStore.set(t,{deleted:!0}),this.$1.Dirty.preKey.add(t),(h||(h=n("Promise"))).resolve())},a.removePreKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.preKey.acquire();try{yield this.$10(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.loadSignedPreKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e!=null){if(!this.$1.SignedPreKeyStore.has(e)){var t=yield o("WAWebSignalStoreApi").waSignalStore.getSignedPreKeyById(e),n=t?{pubKey:t.keyPair.pubKey,privKey:t.keyPair.privKey,signature:t.signature}:null;this.$1.SignedPreKeyStore.set(e,n)}return this.$1.SignedPreKeyStore.get(e)||void 0}});function t(t){return e.apply(this,arguments)}return t})(),a.$11=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t;if(e!=null){if(!this.$1.SessionStore.has(e)){var n=yield o("WAWebSignalStoreApi").waSignalStore.getSession(e);this.$1.SessionStore.set(e,n?{session:n}:void 0)}return(yield o("WAWebSignalConvertApi").maybeConvertSession((t=this.$1.SessionStore.get(e))==null?void 0:t.session))||void 0}});function t(t){return e.apply(this,arguments)}return t})(),a.loadSession=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.session.acquire();try{return yield this.$11(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$12=function(t,n){if(t==null)throw r("err")("Tried to put session without identifier");this.$1.SessionStore.set(t,{session:n}),this.$1.Dirty.session.add(t)},a.storeSession=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield this.$1.Mutex.session.acquire();try{this.$12(e,t)}finally{n.release()}});function t(t,n){return e.apply(this,arguments)}return t})(),a.$13=function(t){if(t==null)throw r("err")("Tried to remove session without identifier");this.$1.SessionStore.set(t,{deleted:!0}),this.$1.Dirty.session.add(t)},a.removeSession=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.session.acquire();try{this.$13(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$14=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,n=[];for(var r of e)this.$1.SessionStore.has(r)||n.push(r);if(n.length>0){var a=yield o("WAWebSignalStoreApi").waSignalStore.bulkGetSession(n);a.forEach(function(e,r){var o=n[r];t.$1.SessionStore.set(o,e?{session:e}:void 0)})}return e.map(function(e){var n=t.$1.SessionStore.get(e);return n!=null&&!(n!=null&&n.deleted)})});function t(t){return e.apply(this,arguments)}return t})(),a.containSessions=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.session.acquire();try{return yield this.$14(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.$15=function(t,o){if(t==null)return(h||(h=n("Promise"))).reject(r("err")("Tried to put session without identifier"));if(!r("gkx")("26258"))if(Array.isArray(o==null?void 0:o.sessions))var e=o.sessions[o.sessions.length-1];else var a,i=o==null||(a=o.senderKeyStates)==null?void 0:a[0];return this.$1.SenderKeyStore.set(t,o),this.$1.Dirty.senderKey.add(t),(h||(h=n("Promise"))).resolve()},a.storeSenderKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield this.$1.Mutex.senderKey.acquire();try{yield this.$15(e,t)}finally{n.release()}});function t(t,n){return e.apply(this,arguments)}return t})(),a.$16=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e!=null){if(!this.$1.SenderKeyStore.has(e)){var t=yield o("WAWebSignalStoreApi").waSignalStore.getSenderKey(e);this.$1.SenderKeyStore.set(e,t)}return o("WAWebSignalConvertApi").maybeConvertSenderKey(this.$1.SenderKeyStore.get(e))||void 0}});function t(t){return e.apply(this,arguments)}return t})(),a.loadSenderKey=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.senderKey.acquire();try{return yield this.$16(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),a.switchToMemMode=function(){this.$2=y.Memory},a.switchToPersistMode=function(){this.$2=y.Persist},a.generateSnapshot=function(){if(this.$2===y.Memory)return this.$1.generateCacheUpdate()},a.deleteAllCache=function(){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[Signal]deleteAllCache"]))).tags("unified-store"),this.$1.clear()},a.flushBufferToDiskIfNotMemOnlyMode=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(this.$2===y.Memory)return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: skip for memory mode"]))).tags("unified-store"),(h||(h=n("Promise"))).resolve();o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: start"]))).tags("unified-store");var e=[yield this.$1.Mutex.identity.acquire(),yield this.$1.Mutex.session.acquire(),yield this.$1.Mutex.senderKey.acquire(),yield this.$1.Mutex.preKey.acquire()];o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: lock complete"]))).tags("unified-store");var t=yield this.$1.generateCacheUpdateThrottled();try{yield o("WAWebSignalStorageUtils").getStorage().lock(["session-store","identity-store","prekey-store","senderkey-store"],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield(h||(h=n("Promise"))).all([o("WAWebSignalStoreApi").waSignalStore.bulkPutSession(t.sessionUpdate),o("WAWebSignalStoreApi").waSignalStore.bulkPutIdentityKeyWithRowId(t.identityUpdate),o("WAWebSignalStoreApi").waSignalStore.bulkPutSenderKey(t.senderKeyUpdate),o("WAWebSignalStoreApi").waSignalStore.bulkRemovePreKey(t.preKeyRemove),o("WAWebSignalStoreApi").waSignalStore.bulkRemoveSession(t.sessionRemove),o("WAWebSignalStoreApi").waSignalStore.bulkRemoveIdentity(t.identityRemove)])})),this.$1.clearDirty()}finally{e.forEach(function(e){return e.release()})}o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: done"]))).tags("unified-store")});function t(){return e.apply(this,arguments)}return t})(),a.$17=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=this;o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[Signal]updateIdentityRangeAfterEncryption: start"]))).tags("unified-store"),yield this.$6(n);var a=[];n.forEach(function(n){var o=r.$1.IdentityStore.get(n);if(o&&!o.deleted&&(o[e]==null||o[e]>t)){var i=babelHelpers.extends({},o);i[e]=t,r.$1.IdentityStore.set(n,i),r.$1.Dirty.identity.add(n),a.push(n)}}),o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[Signal]updateIdentityRangeAfterEncryption: "," updated"])),a.length).tags("unified-store")});function t(t,n,r){return e.apply(this,arguments)}return t})(),a.updateIdentityRangeAfterEncryption=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield this.$1.Mutex.identity.acquire();try{yield this.$17(e,t,n)}finally{r.release()}});function t(t,n,r){return e.apply(this,arguments)}return t})(),a.$18=function(t){if(t==null)return(h||(h=n("Promise"))).resolve();var e=this.$1.SessionStore.get(t);return e&&o("WAWebSignalConvertApi").shouldConvertSession(e.session)&&(o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["[Signal]maybeCleanUpUnconvertedSession: delete unconverted session"]))).tags("unified-store"),this.$13(t)),(h||(h=n("Promise"))).resolve()},a.maybeCleanUpUnconvertedSession=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.Mutex.session.acquire();try{return yield this.$18(e)}finally{t.release()}});function t(t){return e.apply(this,arguments)}return t})(),t})(),b=new C;l.default=b}),98);
__d("WAWebContactSyncUtils",["WALogger","WAWebApiContact","WAWebLidMigrationUtils","WAWebUsernameGatingUtils","WAWebUsync","WAWebUsyncUser","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e,s,u;function c(t){var n=new(o("WAWebUsync")).USyncQuery().withMode("delta").withContext("interactive").withContactProtocol(o("WAWebUsync").USYNC_ADDRESSING_MODE.LID).withUsernameProtocol();return t.forEach(function(t){if(t.type==="add"){n.withUser(new(o("WAWebUsyncUser")).USyncUser().withPhone(t.phoneNumber));return}t.type;var r=t.contact,a=new(o("WAWebUsyncUser")).USyncUser().withType("delete");if(r.isLid())a.withId(r);else if(r.isRegularUserPn()){var i=o("WAWebLidMigrationUtils").toUserLid(r);i!=null&&a.withId(i),a.withPnJid(r)}else a.withId(r),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["constructUsyncDeltaQueryLid: contact is neither LID nor PN: ",""])),r.toLogString()).sendLogs("unexpected_contact_type_in_delta_delete",{sampling:.1});n.withUser(a)}),n}function d(e){var t=new(o("WAWebUsync")).USyncQuery().withMode("delta").withContext("interactive").withContactProtocol(o("WAWebUsync").USYNC_ADDRESSING_MODE.PN).withLidProtocol().withUsernameProtocol();return e.forEach(function(e){if(e.type==="add"){t.withUser(new(o("WAWebUsyncUser")).USyncUser().withPhone(e.phoneNumber));return}e.type;var n=e.contact,r=new(o("WAWebUsyncUser")).USyncUser().withId(n).withType("delete"),a=n.isLid()?null:o("WAWebApiContact").getCurrentLid(n);a&&r.withLid(a),t.withUser(r)}),t}function m(e){return o("WAWebUsernameGatingUtils").usernameContactUsyncLidBased()?c(e):d(e)}function p(e,t){if(e.length===0)return t;var n=new Map;return t.forEach(function(e){n.set(e.wid.toString(),e)}),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["backfillMissingDeviceSyncEntries: Requested "," PN WIDs, got "," entries in response."])),e.length,t.length),e.forEach(function(e){var r=e.toString();if(!n.has(r)){var a=o("WAWebApiContact").getCurrentLid(o("WAWebWidFactory").asUserWidOrThrow(e));if(a!=null){var i=n.get(a.toString());i!=null&&(t.push({wid:e,devices:i.devices}),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["backfillMissingDeviceSyncEntries: Duplicating "," in response as ",""])),a.toLogString(),e.toLogString()))}}}),t}l.constructUsyncDeltaQuery=m,l.backfillMissingDeviceSyncEntries=p}),98);
__d("WAWebAdvSyncDeviceListApi",["Promise","WALogger","WAWebAdvHandlerApi","WAWebApiContact","WAWebApiDeviceList","WAWebContactSyncUtils","WAWebDeviceListPk","WAWebGetIdentityKeysJob","WAWebPhashUtils","WAWebUserPrefsMeUser","WAWebUsync","WAWebUsyncUser","WAWebWidFactory","asyncToGeneratorRuntime","err","lodash"],(function(t,n,r,o,a,i,l){var e,s,u,c,d=new Map;function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.context,a=e.phash,i=e.wids;if(a!=null){var l=yield o("WAWebApiDeviceList").getDeviceIds(i),s=l.map(function(e){return e==null?[]:e.devices.map(function(t){return o("WAWebWidFactory").createDeviceWidFromDeviceListPk(e.id,t.id,t.isHosted)})}),u=r("lodash").flatMap(s,function(e){return e}),m=yield o("WAWebPhashUtils").phashV2(u);if(a===m)return}var p=new Set,f=[];if(i.forEach(function(e){var t=d.get(o("WAWebDeviceListPk").createDeviceListPK(e));t?p.add(t):f.push(e)}),f.length===0){yield(c||(c=n("Promise"))).all(Array.from(p));return}var g=_(f,t);f.map(function(e){d.set(o("WAWebDeviceListPk").createDeviceListPK(e),g)}),yield(c||(c=n("Promise"))).all([g].concat(Array.from(p)))}),p.apply(this,arguments)}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){try{var a=yield o("WAWebApiDeviceList").getDeviceInfoForSync(t),i=a.map(function(e){return e==null?[]:e.devices.map(function(t){return o("WAWebWidFactory").createDeviceWidFromDeviceListPk(e.id,t.id,t.isHosted)})}),l=yield(c||(c=n("Promise"))).all(i.map(function(e){return e.length===0?"":o("WAWebPhashUtils").phashV2(e)})),s=t.map(function(e,t){var n,r;return{id:e,hash:l[t],ts:(n=a[t])==null?void 0:n.timestamp,expectedTs:(r=a[t])==null?void 0:r.expectedTs}});return b(s,r)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to sync device list with error: ",""])),t)}finally{t.map(function(e){d.delete(o("WAWebDeviceListPk").createDeviceListPK(e))})}}),f.apply(this,arguments)}function g(){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield m({wids:o("WAWebUserPrefsMeUser").getMePNandLIDWids(),context:null,phash:null})}),h.apply(this,arguments)}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield m({wids:e,context:null,phash:null}),o("WAWebApiDeviceList").getDeviceIds(e)}),C.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e.length!==0){var n=e.map(function(e){return e.id});o("WAWebApiContact").checkPnToLidMapping(n,o("WAWebApiContact").CheckPnToLidMappingCaller.WAWEB_ADV_SYNC_DEVICE_LIST_SEND_DEVICE_SYNC_REQUEST);var a=new(o("WAWebUsync")).USyncQuery().withContext(t||"interactive").withDeviceProtocol();e.forEach(function(e){e.id.user!=="0"&&a.withUser(new(o("WAWebUsyncUser")).USyncUser().withId(e.id).withDeviceHash(String(e.hash)).withTs(e.ts).withExpectedTs(e.expectedTs))});var i=yield a.execute();if(i.error.all)throw r("err")("syncDeviceList: error "+i.error.all.errorCode+": "+i.error.all.errorText);i.error.devices&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncDeviceList: error ",": ",""])),i.error.devices.errorCode,i.error.devices.errorText);var l=i.list.filter(function(e){return!("errorCode"in e.devices)});l=l.map(function(e){return{wid:e.id,devices:e.devices}});var c=n.filter(function(e){return e.isRegularUserPn()});l=o("WAWebContactSyncUtils").backfillMissingDeviceSyncEntries(c,l);var d=l.filter(function(e){var t;return(t=e.devices.keyIndex)==null?void 0:t.signedKeyIndexBytes}).map(function(e){return e.wid});return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["syncDeviceList: skipping "," out of "," records. Skipped records for users: ",""])),i.list.length-d.length,i.list.length,d.map(function(e){return e.toString()}).join(",")),yield o("WAWebGetIdentityKeysJob").getAndStoreIdentityKeys(d),o("WAWebAdvHandlerApi").handleADVDeviceSyncResult(l)}}),v.apply(this,arguments)}l.syncDeviceList=m,l.syncMyDeviceList=g,l.syncAndGetDeviceList=y}),98);
__d("WAWebMessageInsertDebugPlaceholder",["WALogger","WAWebBackendApi","WAWebBackendEventBus","WAWebMessageProcessorCache","WAWebMessagingGatingUtils","WAWebMsgProcessingApiUtils","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(e){o("WAWebMessagingGatingUtils").isMessageDropPlaceholderEnabled()&&c(e)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.additionalInfo,r=t.externalId,a=t.msgInfo,i=t.nackReason,l=t.offline;if(a==null){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["_insertDebugPlaceholder: msgId::",", could not parse message info"])),r).tags("messaging");return}var u=i.toString(),c=n!=null?u+" "+n:u,d=babelHelpers.extends({},o("WAWebMsgProcessingApiUtils").generateBaseMsg(a),{type:o("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER,kind:o("WAWebMsgType").MsgKind.DebugPlaceholder,body:c});try{yield o("WAWebMessageProcessorCache").messageProcessorCache.addMessages([{msg:d}],l!==!0),o("WAWebBackendEventBus").BackendEventBus.isMainStreamReadyMd&&(yield o("WAWebBackendApi").frontendSendAndReceive("updateMessageUI",{chatId:d.id.remote,msg:d}))}catch(e){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["_insertDebugPlaceholder: msgId::",", failed to insert with error: ",""])),r,e).tags("messaging")}}),d.apply(this,arguments)}l.maybeInsertDebugPlaceholder=u}),98);
__d("WAWebGetGroupAddressingMode",["WALogger","WAWebDBGroupsGroupMetadata","WAWebHandleMsgCommon","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.isGroup()){var t=yield o("WAWebDBGroupsGroupMetadata").getGroupMetadata(e);return t==null?null:t.isLidAddressingMode==null?o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn:t.isLidAddressingMode?o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.lid:o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn}}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=new Map,r=yield o("WAWebDBGroupsGroupMetadata").bulkGetGroupMetadata(t);return t.map(function(t,a){if(!t.isGroup()){n.set(t.toString(),null),o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["bulkGetGroupAddressingMode: called with non-group: ",""])),t).sendLogs("get-group-addressing-mode-called-for-non-group",{sampling:.001});return}var i=r[a];i!=null?n.set(i.id,i.isLidAddressingMode===!0?o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.lid:o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn):(n.set(t.toString(),null),o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["bulkGetGroupAddressingMode: missing group metadata record"]))).sendLogs("get-group-addressing-mode-missing-group-metadata",{sampling:.001}))}),n}),m.apply(this,arguments)}l.getGroupAddressingMode=u,l.bulkGetGroupAddressingMode=d}),98);
__d("WAWebDBParticipantTypes",[],(function(t,n,r,o,a,i,l){var e=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote",LINKED_GROUP_PROMOTE:"linked_group_promote",LINKED_GROUP_DEMOTE:"linked_group_demote"}),s=Object.freeze({DEVICE:"device",PARTICIPANT:"participant"}),u=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="GroupUnSyncedError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));l.PARTICIPANT_OPERATION=e,l.STALE_TYPES=s,l.GroupUnSyncedError=u}),98);
__d("WAWebGroupUtils",["WATypeUtils","WAWebUserPrefsMeUser","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){return e.some(function(e){return o("WAWebUserPrefsMeUser").isMeAccount(o("WATypeUtils").isString(e)?o("WAWebWidFactory").createWid(e):e)})}function s(t){var n=t.filter(function(e){var t=e.isAdmin;return t}).map(function(e){var t=e.id;return t});return e(n)}var u=new Set(["add","remove","demote","linked_group_demote"]);l.amIGroupAdmin=e,l.amIGroupAdminGivenParticipants=s,l.INVALID_CAG_NON_ADMIN_SYSTEM_MSG_SUBTYPES=u}),98);
__d("WAWebLeaveReasonType",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["Left","Removed"]);i.LeaveReason=e}),66);
__d("WAWebDBGroupParticipantHelpers",["WAWebApiContact","WAWebDBParticipantTypes","WAWebGroupType","WAWebGroupUtils","WAWebLeaveReasonType","WAWebLidMigrationUtils","WAWebPostSenderKeyExpiredMetric","WAWebUserPrefsMeUser","WAWebWamEnumExpiryReason","WAWebWidFactory","compactMap"],(function(t,n,r,o,a,i,l){function e(e,t,n){var r=new Map(e.senderKey);n.forEach(function(e){o("WAWebUserPrefsMeUser").isMeDevice(e)||e.isHosted()||r.set(e.toString(),!1)});var a=new Set(t.map(function(e){var t=e.id;return t.toString()})),i=u(e.pastParticipants,a),l=[].concat(e.participants,a.values().toArray().map(function(e){return e.toString()}));return{groupId:e.groupId,senderKey:r,participants:l,pastParticipants:i,admins:e.admins,superAdmins:e.superAdmins,rotateKey:e.rotateKey,staleType:e.staleType}}function s(e,t,n){var r=new Map(e.senderKey);n.forEach(function(e){o("WAWebUserPrefsMeUser").isMeDevice(e)||e.isHosted()||r.set(e.toString(),!1)});var a=new Set,i=new Set;t.forEach(function(e){var t=e.id,n=e.lid;i.add(t.toString()),n!=null&&!t.isLid()&&a.add(n.toString())});var l=u(e.pastParticipants,i),s=[].concat(e.participants.filter(function(e){return!a.has(e)&&!i.has(e)}),i.values().toArray().map(function(e){return e}));return{groupId:e.groupId,senderKey:r,participants:s,pastParticipants:l,admins:e.admins,superAdmins:e.superAdmins,rotateKey:e.rotateKey,staleType:e.staleType}}function u(e,t){var n;return(n=e==null?void 0:e.filter(function(e){var n=o("WAWebWidFactory").createUserWidOrThrow(e.jid),r=o("WAWebApiContact").getAlternateUserWid(n),a=t.has(e.jid),i=r?t.has(r.toString()):!1;return!a&&!i}))!=null?n:[]}function c(e,t){return{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,pastParticipants:t.map(function(e){var t=e.id,n=e.leaveReason,r=e.leaveTs;return{jid:t.toString(),leaveTs:r,leaveReason:n}}),admins:e.admins,superAdmins:e.superAdmins,rotateKey:e.rotateKey,staleType:e.staleType}}function d(e,t,n,r,a){var i,l=new Map(e.senderKey),s=e.rotateKey;l.forEach(function(e,n){var r=o("WAWebWidFactory").createWid(n),a=t.some(function(e){var t=o("WAWebLidMigrationUtils").toCommonAddressingMode(e.id,r),n=t[0],a=t[1];if(n!=null&&a!=null)return n.isSameAccountAndAddressingMode(a)});a&&(s=s||e,l.delete(n))}),s&&l.forEach(function(e,t){l.set(t,!1)});var u=p(t,e.pastParticipants,n,r);!e.rotateKey&&s&&o("WAWebPostSenderKeyExpiredMetric").postSenderKeyExpiredMetric({chatId:e.groupId,deviceCount:e.senderKey.size,expiryReason:o("WAWebWamEnumExpiryReason").EXPIRY_REASON.USER_LEAVE});var c=new Set(t.map(function(e){var t=e.id;return String(t)})),d=e.admins.filter(function(e){return!c.has(e)}),m=(i=e.superAdmins)==null?void 0:i.filter(function(e){return!c.has(e)}),_=e.participants.filter(function(e){return!c.has(e)});return{groupId:e.groupId,senderKey:l,participants:_,pastParticipants:u,admins:d,superAdmins:m,rotateKey:s,staleType:e.staleType}}function m(e,t,n,a,i){var l,s=new Map(e.senderKey),u=e.rotateKey,c=r("compactMap")(t,function(e){return e.id.isLid()?e.id:e.lid});s.forEach(function(e,n){var r=o("WAWebWidFactory").createWid(n);if(r.isLid()&&i!==o("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){var a=c.some(function(e){return e.isSameAccountAndAddressingMode(r)});a&&s.delete(n);return}if(!r.isLid()&&i===o("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){s.delete(n);return}var l=t.some(function(e){return e.id.user===r.user&&e.id.server===r.server});l&&(u=u||e,s.delete(n))}),u&&s.forEach(function(e,t){var n=o("WAWebWidFactory").createWid(t);n.isLid()||s.set(t,!1)});var d=p(t,e.pastParticipants,n,a);!e.rotateKey&&u&&o("WAWebPostSenderKeyExpiredMetric").postSenderKeyExpiredMetric({chatId:e.groupId,deviceCount:e.senderKey.size,expiryReason:o("WAWebWamEnumExpiryReason").EXPIRY_REASON.USER_LEAVE});var m=new Set(t.map(function(e){var t=e.id;return String(t)})),_=e.admins.filter(function(e){return!m.has(e)}),f=(l=e.superAdmins)==null?void 0:l.filter(function(e){return!m.has(e)}),g=e.participants;if(i===o("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){var h=t.reduce(function(e,t){var n=t.id,r=t.lid;return r==null||n.isLid()?e:e.set(n.toString(),r.toString())},new Map);g=g.map(function(e){var t;return(t=h.get(e))!=null?t:e})}else g=g.filter(function(e){return!m.has(e)});return{groupId:e.groupId,senderKey:s,participants:g,pastParticipants:d,admins:_,superAdmins:f,rotateKey:u,staleType:e.staleType}}function p(e,t,n,r){var a=new Set(e.map(function(e){var t=e.id;return String(t)})),i=e.map(function(e){return{jid:e.id.toString(),leaveTs:n,leaveReason:e.id.equals(r)?o("WAWebLeaveReasonType").LeaveReason.Left:o("WAWebLeaveReasonType").LeaveReason.Removed}});return t.forEach(function(e){var t=o("WAWebWidFactory").createUserWidOrThrow(e.jid),n=o("WAWebApiContact").getAlternateUserWid(t),r=a.has(e.jid),l=n?a.has(n==null?void 0:n.toString()):!1;!r&&!l&&i.push(e),r||a.add(e.jid),n&&!l&&a.add(n.toString())}),i}function _(e,t,n,r){var a=e.admins,i=t.map(function(e){var t=e.id;return String(t)});if(r===o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE)a=e.admins.filter(function(e){return!i.includes(e)});else if(r===o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE){var l=new Set(e.admins);i.forEach(function(e){return l.add(e)}),a=Array.from(l)}return{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,pastParticipants:e.pastParticipants,admins:a,superAdmins:e.superAdmins,rotateKey:e.rotateKey,staleType:e.staleType}}function f(e,t,n,r){var a=e.admins,i=t.map(function(e){var t=e.id;return String(t)}),l=new Map(e.senderKey);n!=null&&n.length>0&&n.forEach(function(e){if(!o("WAWebUserPrefsMeUser").isMeDevice(e)&&!e.isHosted()){var t=String(e);l.set(t,!1)}});var s=e.participants;if(r===o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE){a=e.admins.filter(function(e){return!i.includes(e)});var u=o("WAWebGroupUtils").amIGroupAdmin(a);if(!u){var c=t.reduce(function(e,t){var n=t.id,r=t.lid;return r==null||n.isLid()?e:e.set(n.toString(),r.toString())},new Map);s=s.map(function(e){var t;return(t=c.get(e))!=null?t:e})}}else if(r===o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE){var d=t.reduce(function(e,t){var n=t.id,r=t.lid;return r==null||n.isLid()?e:e.set(r.toString(),n.toString())},new Map);a=e.admins.concat(i),s=s.map(function(e){var t;return(t=d.get(e))!=null?t:e})}return{groupId:e.groupId,senderKey:l,participants:s,pastParticipants:e.pastParticipants,admins:a,superAdmins:e.superAdmins,rotateKey:e.rotateKey,staleType:e.staleType}}function g(e,t,n){var r=e.admins,a=e.participants,i=t.map(function(e){var t=e.id;return String(t)});if(n===o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE)r=e.admins.filter(function(e){return!i.includes(e)}),a=r;else if(n===o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE){var l=i.filter(function(t){return!e.admins.includes(t)});r=e.admins.concat(l),a=r}return{groupId:e.groupId,senderKey:e.senderKey,participants:a,pastParticipants:e.pastParticipants,admins:r,superAdmins:e.superAdmins,rotateKey:e.rotateKey,staleType:e.staleType}}function h(e,t){var n,r=t.participants,a=r===void 0?[]:r,i=t.pastParticipants,l=i===void 0?[]:i,s=t.admins,u=s===void 0?[]:s,c=t.deviceIds,d=c===void 0?[]:c,m=new Map;return d.forEach(function(e){if(!o("WAWebUserPrefsMeUser").isMeDevice(e)&&!e.isHosted()){var t=String(e);m.has(t)||m.set(t,!1)}}),{groupId:e,senderKey:m,participants:a.map(function(e){var t=e.id;return String(t)}),pastParticipants:l.map(function(e){var t=e.id,n=e.leaveReason,r=e.leaveTs;return{jid:t.toString(),leaveTs:r,leaveReason:n}}),admins:u.map(String),superAdmins:(n=t.superAdmins)==null?void 0:n.map(String),rotateKey:!1,staleType:a.length===0?o("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT:void 0}}function y(e,t){var n=t.admins,r=t.deviceIds,a=t.participants,i=t.superAdmins,l=e.rotateKey,s=e.senderKey,u=new Map;if(r.forEach(function(e){if(!o("WAWebUserPrefsMeUser").isMeDevice(e)&&!e.isHosted()){var t=String(e),n=s==null?void 0:s.get(t);n==null?u.set(t,!1):(u.set(t,n),s==null||s.delete(t))}}),s!=null)for(var c of s.values())l=l||c;return{groupId:e.groupId,senderKey:u,participants:a.map(function(e){var t=e.id;return String(t)}),pastParticipants:e.pastParticipants,admins:n.map(String),superAdmins:i==null?void 0:i.map(String),rotateKey:l}}function C(e,t){var n=t.admins,r=t.deviceIds,a=t.participants,i=t.superAdmins,l=e.rotateKey,s=e.senderKey,u=new Map;if(r.forEach(function(e){if(!o("WAWebUserPrefsMeUser").isMeDevice(e)&&!e.isHosted()){var t=String(e),n=s==null?void 0:s.get(t);n==null?u.set(t,!1):(u.set(t,n),s==null||s.delete(t))}}),s!=null)for(var c of s.entries()){var d=c[0],m=c[1];if(m&&!o("WAWebWidFactory").createWid(d).isLid()){l=!0;break}}return{groupId:e.groupId,senderKey:u,participants:a.map(function(e){var t=e.id;return String(t)}),pastParticipants:e.pastParticipants,admins:n.map(String),superAdmins:i==null?void 0:i.map(String),rotateKey:l}}function b(e,t,n){var r,a=String(t),i=String(n),l=new Map(e.senderKey),s=e.participants.filter(function(e){return e!==a}).concat(i);Array.from(l.keys()).forEach(function(e){var n=o("WAWebWidFactory").createWid(e).user;t.user===n?l.delete(e):l.set(e,!1)}),l.set(i,!1);var u=e.admins.map(function(e){return e===a?i:e}),c=(r=e.superAdmins)==null?void 0:r.map(function(e){return e===a?i:e});return babelHelpers.extends({},e,{participants:s,senderKey:l,admins:u,superAdmins:c,rotateKey:!0})}l.addParticipantInfo=e,l.addParticipantInfoCAG=s,l.addPastParticipantInfo=c,l.removeParticipantInfo=d,l.removeParticipantInfoCAG=m,l.changeParticipantAdminInfo=_,l.changeParticipantAdminInfoCAG=f,l.changeCommunityParticipantAdminInfo=g,l.createParticipantInfo=h,l.replaceParticipantInfo=y,l.replaceParticipantInfoCAG=C,l.modifyParticipantInfo=b}),98);
__d("WAWebPnhCagUtils",["WAWebLidMigrationUtils","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.participants.iAmAdmin(),n=e.participants.toArray(),r=[],a=[];if(t)for(var i of n)r.push(i.id),a.push(o("WAWebLidMigrationUtils").toLid(o("WAWebWidFactory").asUserWidOrThrow(i.id)));else for(var l of n)l.id.isLid()?r.push(l.id):a.push(o("WAWebLidMigrationUtils").toLid(o("WAWebWidFactory").asUserWidOrThrow(l.id)));return[].concat(r,a).filter(Boolean)}function s(e,t){var n=[];if(e){for(var r of t)n.push(r.id),r.lid&&n.push(r.lid);return n}for(var o of t)o.id.isLid()?n.push(o.id):o.lid&&n.push(o.lid);return n}l.augmentedCagGroupMetadataParticipantList=e,l.augmentedCagGroupParticipantList=s}),98);
__d("WAWebDBGroupParticipant",["$InternalEnum","Promise","WABatcher","WAJids","WALogger","WANullthrows","WAWebDBGroupParticipantHelpers","WAWebDBParticipantTypes","WAWebGroupUtils","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebPhashUtils","WAWebPnhCagUtils","WAWebSchemaParticipant","WAWebWamGroupMetricCache","WAWebWidFactory","asyncToGeneratorRuntime","err","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g=3e3;function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupInfos,n=yield o("WAWebSchemaParticipant").getParticipantTable().bulkGet(t.map(function(e){return e.id.toString()})),r=new Map;n.forEach(function(e){return e&&r.set(e.groupId,e.senderKey)});var a=t.map(function(e){var t,n,a,i=[],l=[],s=[],u=e.id.toString(),c=r.get(u)||new Map;(t=e.participants)==null||t.forEach(function(e){e.isAdmin&&l.push(e.id),e.isSuperAdmin&&s.push(e.id),i.push(e.id)});var d=(n=(a=e.pastParticipants)==null?void 0:a.map(function(e){var t=e.id,n=e.leaveReason,r=e.leaveTs;return{jid:t.toString(),leaveTs:r,leaveReason:n}}))!=null?n:[],m=!!e.defaultSubgroup;if(m){var p=o("WAWebGroupUtils").amIGroupAdmin(l),_=o("WAWebPnhCagUtils").augmentedCagGroupParticipantList(p,e.participants);_.forEach(function(e){var t=String(e);c.has(t)||c.set(t,!1)})}else{var f;(f=e.participants)==null||f.forEach(function(e){c.set(String(e.id),!1)})}return{groupId:u,participants:i.map(String),pastParticipants:d,admins:l.map(String),superAdmins:s.map(String),senderKey:c,rotateKey:!1,staleType:o("WAWebDBParticipantTypes").STALE_TYPES.DEVICE}});return o("WAWebSchemaParticipant").getParticipantTable().bulkCreateOrReplace(a)}),y.apply(this,arguments)}function C(e){var t=e.admins,r=e.deviceIds,a=e.group,i=e.groupInfo,l=e.participants,s=e.superAdmins,u=!1;i!=null&&(u=!!i.defaultSubgroup);var c=a.toString();return o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],a=yield n.get(c);if(!a)return n.create(o("WAWebDBGroupParticipantHelpers").createParticipantInfo(c,{participants:l,admins:t,superAdmins:s,deviceIds:r}));yield n.createOrReplace(u?o("WAWebDBGroupParticipantHelpers").replaceParticipantInfoCAG(a,{participants:l,admins:t,superAdmins:s,deviceIds:r}):o("WAWebDBGroupParticipantHelpers").replaceParticipantInfo(a,{participants:l,admins:t,superAdmins:s,deviceIds:r}))});return function(t){return e.apply(this,arguments)}})())}function b(e){return o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],r=yield n.bulkGet(e.map(function(e){return e.groupId})),a=e.map(function(e,t){var n=e.groupId,a=e.pastParticipants,i=r[t];return i?o("WAWebDBGroupParticipantHelpers").addPastParticipantInfo(i,a):o("WAWebDBGroupParticipantHelpers").createParticipantInfo(n,{pastParticipants:a})});return n.bulkCreateOrReplace(a)});return function(e){return t.apply(this,arguments)}})())}var v=(function(){return o("WABatcher").batch({delayMs:g},(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=Array.from(new Set(t.map(function(e){return e.id})));return yield o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var a=n[0],i=new Map((yield a.bulkGet(r)).filter(Boolean).map(function(e){return[e.groupId,e]}));return t.forEach(function(t){var n=t.data,r=t.groupMetadata,a=t.id,l=!!(r!=null&&r.defaultSubgroup),u=i.get(a);if(!u){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateParticipantsBatched: no local record found for group ",""])),a);return}var c=n.participants,d=null;switch(n.action){case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.ADD:d=l?o("WAWebDBGroupParticipantHelpers").addParticipantInfoCAG(u,c,n.deviceIds):o("WAWebDBGroupParticipantHelpers").addParticipantInfo(u,c,n.deviceIds);break;case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.REMOVE:d=l?o("WAWebDBGroupParticipantHelpers").removeParticipantInfoCAG(u,c,n.timestamp,n.author,n.reason):o("WAWebDBGroupParticipantHelpers").removeParticipantInfo(u,c,n.timestamp,n.author,n.reason);break;case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE:d=l?o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfoCAG(u,c,n.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE):o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfo(u,c,n.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE);break;case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE:d=l?o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfoCAG(u,c,n.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE):o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfo(u,c,n.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE);break;default:o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["updateParticipants: failed with unknown action ",""])),n.action)}d!=null&&i.set(d.groupId,d)}),a.bulkCreateOrReplace(Array.from(i.values()))});return function(e){return a.apply(this,arguments)}})()),t.map(function(e){})});return function(e){return t.apply(this,arguments)}})())})(),S=(function(){return o("WABatcher").batch({delayMs:g},(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=Array.from(new Set(e.map(function(e){return e.id})));return yield o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=n[0],a=new Map((yield r.bulkGet(t)).filter(Boolean).map(function(e){return[e.groupId,e]}));return e.forEach(function(e){var t=e.data,n=e.id,r=a.get(n);if(!r){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["updateCommunityParticipantsBatched: no local record found for group ",""])),n);return}var i=t.participants,l=null;switch(t.action){case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE:l=o("WAWebDBGroupParticipantHelpers").changeCommunityParticipantAdminInfo(r,i,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE);break;case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE:l=o("WAWebDBGroupParticipantHelpers").changeCommunityParticipantAdminInfo(r,i,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE);break;default:o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["updateCommunityParticipantsBatched: failed with unknown action ",""])),t.action)}l!=null&&a.set(l.groupId,l)}),r.bulkCreateOrReplace(Array.from(a.values()))});return function(e){return r.apply(this,arguments)}})()),e.map(function(e){})});return function(t){return e.apply(this,arguments)}})())})();function R(e,t,a){if(a===void 0&&(a=!1),a)return S({id:String(e),data:t});var i=t.participants,l=e.toString();return o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],a=yield n.get(l);if(!a)throw new(o("WAWebDBParticipantTypes")).GroupUnSyncedError("updateCommunityParticipants: group participant info missing for action "+t.action);switch(t.action){case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE:return n.createOrReplace(o("WAWebDBGroupParticipantHelpers").changeCommunityParticipantAdminInfo(a,i,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE));case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE:return n.createOrReplace(o("WAWebDBGroupParticipantHelpers").changeCommunityParticipantAdminInfo(a,i,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE));default:throw r("err")("updateCommunityParticipants: failed with unknown action "+t.action)}});return function(t){return e.apply(this,arguments)}})())}function L(e,t){return o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=n[0],a=yield r.get(e.toString());if(!a)throw new(o("WAWebDBParticipantTypes")).GroupUnSyncedError("updateParticipants: group participant info missing when trying to update super admin");return r.createOrReplace(babelHelpers.extends({},a,{superAdmins:[t.toString()]}))});return function(e){return r.apply(this,arguments)}})())}function E(e,t,a,i){i===void 0&&(i=!1);var l=!!(a!=null&&a.defaultSubgroup);if(i)return v({id:String(e),data:t,groupMetadata:a});var s=t.participants,u=e.toString();return o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],a=yield n.get(u);if(!a)throw new(o("WAWebDBParticipantTypes")).GroupUnSyncedError("updateParticipants: group participant info missing for action "+t.action);switch(t.action){case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.ADD:return n.createOrReplace(l?o("WAWebDBGroupParticipantHelpers").addParticipantInfoCAG(a,s,t.deviceIds):o("WAWebDBGroupParticipantHelpers").addParticipantInfo(a,s,t.deviceIds));case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.REMOVE:return n.createOrReplace(l?o("WAWebDBGroupParticipantHelpers").removeParticipantInfoCAG(a,s,t.timestamp,t.author,t.reason):o("WAWebDBGroupParticipantHelpers").removeParticipantInfo(a,s,t.timestamp,t.author,t.reason));case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE:return n.createOrReplace(l?o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfoCAG(a,s,t.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE):o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfo(a,s,t.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE));case o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE:return n.createOrReplace(l?o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfoCAG(a,s,t.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE):o("WAWebDBGroupParticipantHelpers").changeParticipantAdminInfo(a,s,t.deviceIds,o("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE));default:throw r("err")("updateParticipants: failed with unknown action "+t.action)}});return function(t){return e.apply(this,arguments)}})())}var k=n("$InternalEnum").Mirrored(["Success","Error"]);function I(e,t){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=k.Error;return yield o("WAWebModelStorageUtils").getStorage().lock(["participant","group-metadata"],(function(){var i=n("asyncToGeneratorRuntime").asyncToGenerator(function*(i){var l=i[0],s=i[1],u=o("WAWebLidMigrationUtils").toAddressingModeFactory(t);try{var c=r("WANullthrows")(yield l.get(e.toString()),"missing participant record to migrate"),m=Array.from(c.senderKey.entries()),p=o("WAWebGroupUtils").amIGroupAdmin(c.admins),_={admins:c.admins.map(function(e){return r("WANullthrows")(u(o("WAWebWidFactory").createWid(e)),"admin missing a LID-PN mapping").toString()}),participants:c.participants.map(function(e){if(!p&&!t){var n=o("WAWebWidFactory").createUserWidOrThrow(e);return r("WANullthrows")(o("WAWebLidMigrationUtils").toLid(n),"participant missing a LID mapping").toString()}return r("WANullthrows")(u(o("WAWebWidFactory").createWid(e)),"participant missing a LID-PN mapping").toString()}),senderKey:new Map(m.map(function(e){var t=e[0],n=e[1];return[D(t,u).toString(),!1]}))},g={isLidAddressingMode:t};yield(f||(f=n("Promise"))).all([l.merge(e.toString(),_),s.merge(e.toString(),g)]),a=k.Success}catch(t){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["addressing mode migration failed for ",": ",""])),e,r("getErrorSafe")(t).message)}});return function(e){return i.apply(this,arguments)}})()),a}),T.apply(this,arguments)}function D(e,t){var n,a=o("WAWebWidFactory").createDeviceWidOrThrow(e),i=r("WANullthrows")(t(o("WAWebWidFactory").asUserWidOrThrow(a)),"senderkey device missing a LID-PN mapping");return o("WAWebWidFactory").createDeviceWidFromUserAndDevice(i.user,i.server,(n=a.device)!=null?n:o("WAJids").DEFAULT_DEVICE_ID).toString()}function x(e){var t=e.group;return o("WAWebModelStorageUtils").getStorage().lock(["participant"],function(e){var n=e[0];return n.merge(String(t),{staleType:o("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT})})}function $(e){var t=e.groupIds;return o("WAWebModelStorageUtils").getStorage().lock(["participant"],function(e){var n=e[0];return n.bulkCreateOrMerge(t.map(function(e){return{groupId:String(e),staleType:o("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT}}))})}function P(e){var t=e.group,r=e.newId,a=e.oldId,i=String(t);return o("WAWebModelStorageUtils").getStorage().lock(["participant"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0],n=yield t.get(i);if(!n)throw new(o("WAWebDBParticipantTypes")).GroupUnSyncedError("modifyGroupParticipant: group participant info missing");return t.createOrReplace(o("WAWebDBGroupParticipantHelpers").modifyParticipantInfo(n,a,r))});return function(t){return e.apply(this,arguments)}})())}function N(e){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,r,a,i,l=e.groupWid,s=yield o("WAWebSchemaParticipant").getParticipantTable().get(String(l));if(!s)return null;if(s.senderKey==null){var u,c,d,p,_=(u=s.admins)==null?void 0:u.length,f=(c=s.superAdmins)==null?void 0:c.length,g=(d=s.participants)==null?void 0:d.length,h=(p=s.pastParticipants)==null?void 0:p.length;return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getGroupParticipant: group participant info missing sender key in ",": admins ",", superAdmins ",", participants ",", pastParticipants ",", rotateKey ",", version ",", staleType ",""])),l.toString(),_,f,g,h,s.rotateKey,s.version,s.staleType).sendLogs("get-group-participant-missing-sender-key"),null}var y=new Set(s.admins),C=new Set(s.superAdmins),b=(t=(n=s.participants)==null?void 0:n.map(function(e){return{id:o("WAWebWidFactory").createWid(e),isAdmin:y.has(e),isSuperAdmin:C.has(e)}}))!=null?t:[],v=(r=(a=s.pastParticipants)==null?void 0:a.map(function(e){var t=e.jid,n=e.leaveReason,r=e.leaveTs;return{id:o("WAWebWidFactory").createWid(t),leaveTs:r,leaveReason:n}}))!=null?r:[];o("WAWebWamGroupMetricCache").cacheGroupMetrics(s);var S=s.deviceSyncComplete!=null&&!s.deviceSyncComplete?o("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT:void 0;return{participants:b,pastParticipants:v,staleType:(i=s.staleType)!=null?i:S,deviceCount:s.senderKey.size}}),M.apply(this,arguments)}function w(e){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{var t=yield o("WAWebSchemaParticipant").getParticipantTable().get(String(e));if(!(t!=null&&t.participants))return null;var n=t.participants.map(function(e){return o("WAWebWidFactory").createWid(e)});return o("WAWebPhashUtils").phashV2(n)}catch(e){return o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["computeGroupParticipantsHash: ",""])),e).sendLogs("compute-group-participants-hash-error"),null}}),A.apply(this,arguments)}l.addParticipantInfo=(_=o("WAWebDBGroupParticipantHelpers")).addParticipantInfo,l.addParticipantInfoCAG=_.addParticipantInfoCAG,l.createParticipantInfo=_.createParticipantInfo,l.removeParticipantInfo=_.removeParticipantInfo,l.removeParticipantInfoCAG=_.removeParticipantInfoCAG,l.replaceParticipantInfo=_.replaceParticipantInfo,l.replaceParticipantInfoCAG=_.replaceParticipantInfoCAG,l.updateGroupParticipantTableWithoutDeviceSync=h,l.replaceParticipants=C,l.addPastParticipants=b,l.updateCommunityParticipants=R,l.setDBGroupSuperAdmin=L,l.updateDBParticipants=E,l.AddressingModeMigrationResult=k,l.migrateParticipantInfoAddressingMode=I,l.markGroupParticipantStale=x,l.bulkMarkGroupParticipantStale=$,l.modifyGroupParticipant=P,l.getGroupParticipant=N,l.computeGroupParticipantsHash=w}),98);
__d("WAWebGroupDatabaseJob",["WAJobOrchestratorTypes","WAWebDBGroupParticipant","WAWebDBGroupsGroupMetadata","WAWebOrchestratorNonPersistedJob"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateGroupMetadataTable",function(e){return o("WAWebDBGroupsGroupMetadata").updateGroupMetadataTable(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})}function s(e){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateGroupParticipantTableWithoutDeviceSync",function(e){return o("WAWebDBGroupParticipant").updateGroupParticipantTableWithoutDeviceSync(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})}function u(e){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markGroupParticipantStale",function(e){return o("WAWebDBGroupParticipant").markGroupParticipantStale(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e})}function c(e){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("bulkMarkGroupParticipantStale",function(e){return o("WAWebDBGroupParticipant").bulkMarkGroupParticipantStale(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupIds:e})}function d(e,t,n){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("modifyGroupParticipant",function(e){return o("WAWebDBGroupParticipant").modifyGroupParticipant(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,oldId:t,newId:n})}function m(e){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getGroupMetadata",function(e){return o("WAWebDBGroupsGroupMetadata").getGroupMetadataUNSAFE(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupWid:e})}function p(e){return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getGroupParticipant",function(e){return o("WAWebDBGroupParticipant").getGroupParticipant(e)},{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupWid:e})}l.updateGroupMetadataTableJob=e,l.updateGroupParticipantTableWithoutDeviceSyncJob=s,l.markGroupParticipantStaleJob=u,l.bulkMarkGroupParticipantStaleJob=c,l.modifyGroupParticipantJob=d,l.getGroupMetadataJob=m,l.getGroupParticipantJob=p}),98);
__d("WAWebWamEnumMismatchOriginType",[],(function(t,n,r,o,a,i){var e=Object.freeze({INCOMING_GROUP_MESSAGE:1,ACK_OUTGOING_MESSAGE:2,GROUP_NOTIFICATION:3,GROUP_PROFILE_PICTURE_NOTIFICATION:4,IQ_RESPONSES:5});i.MISMATCH_ORIGIN_TYPE=e}),66);
__d("WAWebMessageProcessorCache",["Promise","WALogger","WANullthrows","WAShiftTimer","WAWebABProps","WAWebDBCreateLidPnMappings","WAWebDBReportingTokenUtils","WAWebGetGroupAddressingMode","WAWebGroupDatabaseJob","WAWebHandleMessageTypes.flow","WAWebHandleMsgCommon","WAWebPromiseQueue","WAWebSendOfflineDeliveryReceiptJob","WAWebSignalProtocolStore","WAWebSignalStorageUtils","WAWebSignalStoreApi","WAWebStoreMsgs","WAWebWamEnumMismatchOriginType","WAWebWidFactory","asyncToGeneratorRuntime","cr:13546"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C=(e=n("cr:13546"))!=null?e:{},b=C.handleAddressingModeMismatch;function v(){return o("WAWebABProps").getABPropConfigValue("web_message_processing_cache_size")}function S(){return R()>0}function R(){return o("WAWebABProps").getABPropConfigValue("web_offline_message_processor_timeout_seconds")}var L=(function(){function e(){var e=this;this.cache=[],this.additionalInfoCache=[],this.checkpointQueue=new(o("WAWebPromiseQueue")).PromiseQueue,this.nextCheckpointIndex=0,this.checkpointPromises=new Map,this.flushImmediately=!1,this.snapshotTimer=new(o("WAShiftTimer")).ShiftTimer(function(){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] flushing cache due to timeout"]))),e.createSnapshot()})}var t=e.prototype;return t.size=function(){return this.cache.length},t.addMessages=function(t,n){var e;n===void 0&&(n=!1),(e=this.cache).push.apply(e,t);var r=this.$1();return n?(this.flushImmediately=!0,this.createSnapshot(),r):(this.flushImmediately=!1,o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] adding to cache (current length: ",", next checkpoint index: ","): ",""])),this.cache.length,this.nextCheckpointIndex,t.map(function(e){var t,n,r,o;return e.msg!=null?"msg "+((t=(n=e.msg)==null||(n=n.id)==null?void 0:n.id)!=null?t:""):"receipt "+(((r=e.receiptInfo)==null?void 0:r.externalId)||((o=e.duplicateMsgReceiptInfo)==null?void 0:o.externalId)||"")})),this.cache.length>=v()?(this.createSnapshot(),r):(S()&&!this.snapshotTimer.isScheduled()&&this.snapshotTimer.onOrBefore(R()*1e3),r))},t.addAdditionalInfo=function(t,n){if(n===void 0&&(n=!1),this.additionalInfoCache.push(t),n){var e=this.additionalInfoCache;this.additionalInfoCache=[],this.$2(e)}},t.handleChangedAddressingMode=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map;e.forEach(function(e){var n=e.msg;if(n!=null&&n.id.remote.isGroup()){var r;(n==null?void 0:n.groupAddressingMode)==="pn"?r=o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn:(n==null?void 0:n.groupAddressingMode)==="lid"&&(r=o("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.lid),r!=null&&t.set(n.id.remote.toString(),r)}});var a=Array.from(t.keys(),o("WAWebWidFactory").createWid),i=yield o("WAWebGetGroupAddressingMode").bulkGetGroupAddressingMode(a),l=[];for(var s of t.entries()){var u=s[0],c=s[1];i.get(u)!==c&&l.push(o("WAWebWidFactory").createWid(u))}this.flushImmediately||(yield o("WAWebGroupDatabaseJob").bulkMarkGroupParticipantStaleJob(l)),yield(y||(y=n("Promise"))).all(l.map(function(e){return b==null?void 0:b(e,{localAddressingMode:r("WANullthrows")(i.get(e.toString()),"missing local addressing mode for group"),serverAddressingMode:r("WANullthrows")(t.get(e.toString()),"missing server addressing mode for group"),mismatchOrigin:o("WAWebWamEnumMismatchOriginType").MISMATCH_ORIGIN_TYPE.INCOMING_GROUP_MESSAGE})}))});function t(t){return e.apply(this,arguments)}return t})(),t.$1=function(){var e=this,t=this.nextCheckpointIndex;if(!this.checkpointPromises.has(t)){var o,a=function(t){};this.checkpointPromises.set(t,{promise:new(y||(y=n("Promise")))(function(e,t){o=e,a=t}),markCheckpointDone:function(r){if(e.checkpointPromises.delete(t),r!=null){a(r);return}o()}})}return r("WANullthrows")(this.checkpointPromises.get(t)).promise},t.$3=function(t){var e=[];return t.forEach(function(t){var n=t.msg;n!=null&&e.push(n)}),o("WAWebStoreMsgs").storeMsgs(e)},t.$2=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.filter(function(e){return e.type===o("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingInfo}).map(function(e){return e.data});o("WAWebDBReportingTokenUtils").handleAddReportingInfos(t)});function t(t){return e.apply(this,arguments)}return t})(),t.createSnapshot=function(){var e,t,r=this,a=this.cache,i=this.additionalInfoCache;this.cache=[],this.additionalInfoCache=[],this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();var l=this.nextCheckpointIndex,s=l+a.length;if(this.nextCheckpointIndex=s,o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] createSnapshot ","-",": "," messages/receipts"])),l,s,a.length),a.length!==0){var u=(e=(t=this.checkpointPromises.get(l))==null?void 0:t.markCheckpointDone)!=null?e:function(e){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["MessageProcessorCache: missing doneFn"]))).sendLogs("message-cache-missing-doneFn")},C=o("WAWebSignalProtocolStore").getSignalProtocolStore().generateSnapshot();this.checkpointQueue.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield(y||(y=n("Promise"))).all([r.$3(a),o("WAWebDBCreateLidPnMappings").flushLidPnMappingsToDb()]),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] createSnapshot ","-",": messages added to table"])),l,s),C!=null&&(yield o("WAWebSignalStorageUtils").getStorage().lock(["session-store","identity-store","prekey-store","senderkey-store"],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield(y||(y=n("Promise"))).all([o("WAWebSignalStoreApi").waSignalStore.bulkPutSession(C.sessionUpdate),o("WAWebSignalStoreApi").waSignalStore.bulkPutIdentityKeyWithRowId(C.identityUpdate),o("WAWebSignalStoreApi").waSignalStore.bulkPutSenderKey(C.senderKeyUpdate),o("WAWebSignalStoreApi").waSignalStore.bulkRemovePreKey(C.preKeyRemove),o("WAWebSignalStoreApi").waSignalStore.bulkRemoveSession(C.sessionRemove),o("WAWebSignalStoreApi").waSignalStore.bulkRemoveIdentity(C.identityRemove)])})),o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] createSnapshot ","-",": signal stores updated"])),l,s)),yield o("WAWebSendOfflineDeliveryReceiptJob").sendAggregateOfflineReceipts(a),o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] createSnapshot ","-",": aggregated receipts sent"])),l,s),yield r.$2(i),o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] createSnapshot ","-",": additional info processed"])),l,s)}catch(e){o("WALogger").WARN(g||(g=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] createSnapshot ","-",": failed: ",""])),l,s,e),u(e);return}o("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[message-cache] before markCheckpointDone"]))),u()})),this.handleChangedAddressingMode(a)}},e})(),E=new L;l.messageProcessorCache=E}),98);
__d("WAWebApiMessageInfoStore",["WAJids","WALogger","WAWebAck","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebSchemaMessage","WAWebSchemaMessageInfo","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m=[o("WAWebAck").ACK_STRING.PLAYED,o("WAWebAck").ACK_STRING.READ,o("WAWebAck").ACK_STRING.DELIVERY],p=Object.freeze({ELIGIBLE:"ELGIBLE",INELIGIBLE_RECORD_MISSING:"INELIGIBLE_RECORD_MISSING",INELIGIBLE_ALREADY_DELIVERED:"INELIGIBLE_ALREADY_DELIVERED",INELIGIBLE_NOT_MD:"INELIGIBLE_NOT_MD",INELIGIBLE_CHANGED_IDENTITY:"INELIGIBLE_CHANGED_IDENTITY"});function _(e){var t=new Map;return e.forEach(function(e){var n,r=e.msgKey,a=e.receiverId,i=o("WAWebWidFactory").asUserWidOrThrow(a).toString(),l=r.toString(),s=l+","+i,u=(n=a.device)!=null?n:o("WAJids").DEFAULT_DEVICE_ID,c=t.get(s);c?c.deviceNotDelivered.push(u):t.set(s,{msgKey:l,receiverUserJid:i,deviceDelivered:[],deviceNotDelivered:[u]})}),o("WAWebModelStorageUtils").getStorage().lock(["message-info"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=Array.from(t.values()).map(function(e){return[e.msgKey,e.receiverUserJid]}),a=yield n.anyOf(["msgKey","receiverUserJid"],r);return a.forEach(function(e){var n=e.msgKey+","+e.receiverUserJid,r=t.get(n);r&&t.set(n,babelHelpers.extends({},e,{deviceNotDelivered:[].concat(e.deviceNotDelivered,r.deviceNotDelivered)}))}),o("WAWebSchemaMessageInfo").getMessageInfoTable().bulkCreateOrReplace(Array.from(t.values()))});return function(t){return e.apply(this,arguments)}})())}function f(e,t,n,r){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=o("WAWebWidFactory").asUserWidOrThrow(t).toString(),i=t.device||0,l=yield o("WAWebSchemaMessageInfo").getMessageInfoTable().get([e.toString(),a]);if(!l){var m=o("WAWebLidMigrationUtils").getAlternateMsgKey(e);m!=null&&(l=yield o("WAWebSchemaMessageInfo").getMessageInfoTable().get([m.toString(),a]))}if(l){if(l.deviceNotDelivered.includes(i))return n!=null&&r>=n?p.ELIGIBLE:t.device!=null&&t.device!==o("WAJids").DEFAULT_DEVICE_ID?(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: ",", ",":",": companion identity changed"])),e.toString(),a,i),p.INELIGIBLE_CHANGED_IDENTITY):l.delivery!=null?(o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: ",", ",":",": primary identity change after message has been delivered"])),e.toString(),a,i),p.INELIGIBLE_CHANGED_IDENTITY):p.ELIGIBLE}else return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: missing record for ",", ",""])),e.toString(),a),p.INELIGIBLE_RECORD_MISSING;return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: ",", ",":"," has been delivered"])),e.toString(),a,i),p.INELIGIBLE_ALREADY_DELIVERED}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield C([e]),n=t.get(e.toString());if(!n)throw r("err")("No message info found for "+e.toString());return n}),y.apply(this,arguments)}function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){for(var t=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(e.map(function(e){return e.toString()})),n=new Map,a=new Map,i=0;i<e.length;i++){var l,s,u=e[i].toString(),c=(l=(s=t[i])==null?void 0:s.latestEditMsgKey)!=null?l:u;a.set(c,u);var d={messageInfoRecords:[],ackReceiver:t[i]?t[i].count:null};if(n.set(c,d),e[i].remote.isUser()||e[i].remote.isStatus()){var m,p=(m=o("WAWebLidMigrationUtils").getAlternateMsgKey(r("WAWebMsgKey").from(c)))==null?void 0:m.toString();p!=null&&(a.set(p,u),n.set(p,d))}}var _=yield o("WAWebSchemaMessageInfo").getMessageInfoTable().anyOf(["msgKey"],Array.from(n.keys()));_.forEach(function(e){var t;(t=n.get(e.msgKey))==null||t.messageInfoRecords.push(e)});var f=v(n),g=new Map;for(var h of f){var y=h[0],C=h[1];{var b=a.get(y);b!=null&&g.set(b,C)}}return g}),b.apply(this,arguments)}function v(t){var n=new Map,a=function(){var t=i[0],a=i[1],l=a.ackReceiver,s=a.messageInfoRecords,u=0,c={delivery:[],deliveryRemaining:0,played:[],playedRemaining:0,read:[],readRemaining:0},d=!1;s.forEach(function(e){var n=o("WAWebWidFactory").createWid(e.receiverUserJid);if(!o("WAWebUserPrefsMeUser").isMeAccount(n)){S(e);for(var a=0;a<m.length;a++){var i=m[a],l=e[i];if(l!=null){c[i].push({id:n,t:l});var s=r("WAWebWid").isGroup(r("WAWebMsgKey").fromString(t).remote);if(s&&i==="read"&&n!=null&&n.isBot()&&(d=!0),s)break}}e.delivery!=null&&e.deliveryPrivacyMode!=null&&(c.deliveryPrivacyMode=e.deliveryPrivacyMode),u+=1}});var p=l!=null&&l!==0?l:u;d&&p++,o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["queryMsgInfo: targetedMsgInfoKey: ",", ack count: ",", receiver: ",",\n        played: ",", read: ",", delivery: ",""])),t,l,p,c.played.length,c.read.length,c.delivery.length),c.playedRemaining=p-c.played.length,c.readRemaining=c.playedRemaining-c.read.length,c.deliveryRemaining=c.readRemaining-c.delivery.length,n.set(t,c)};for(var i of t.entries())a();return n}function S(e){var t=e.read;t!=null&&(e.delivery==null||e.delivery>t)&&(e.delivery=t)}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,n=yield C(e);for(var r of e){var a=n.get(r.toString());if(a!=null){var i=void 0;a.playedRemaining===0&&a.played.length>0?i=o("WAWebAck").ACK.PLAYED:a.readRemaining===0&&a.read.length>0?i=o("WAWebAck").ACK.READ:a.deliveryRemaining===0&&a.delivery.length>0&&(i=o("WAWebAck").ACK.RECEIVED),i!=null&&t.set(r.toString(),i)}}return t}),L.apply(this,arguments)}l.RetryEligibilityResult=p,l.createOrMergeReceiptRecords=_,l.isRetryEligible=f,l.queryMsgInfo=h,l.queryMsgInfos=C,l.getHighestMsgAcks=R}),98);
__d("WAWebSchemaPeerReadReceipt",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addAutoIncrementingPrimaryKey,u=e.addColumn;function c(){o("WAWebOffdStorageUtils").getStorage().add("peer-read-receipt").version(o("WAWebOffdStorageUtils").getStorage().versions.version(2),[s("id"),u("msgKeys"),u("ts"),u("ack")]).view(function(e){return e})}function d(){return o("WAWebOffdStorageUtils").getStorage().table("peer-read-receipt")}l.addTable=c,l.getTable=d}),98);
__d("WAWebMessageReceiptBatcher",["Promise","WABatcher","WAJids","WALogger","WAPromiseMap","WAWebAck","WAWebApiMessageInfoStore","WAWebBackendApi","WAWebDBBulkGetRootMsgs","WAWebHandleMsgReceiptCommon","WAWebHandlePrivacyModeUpdateMsgAction","WAWebLidStatusMigrationKeyUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebNoop","WAWebSchemaMessage","WAWebSchemaMessageInfo","WAWebSchemaPeerReadReceipt","WAWebUserPrefsMeUser","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","compactMap","lodash"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h=Object.freeze((e={},e[(g=o("WAWebAck")).ACK.SENT]=g.ACK_STRING.DELIVERY,e[g.ACK.RECEIVED]=g.ACK_STRING.DELIVERY,e[g.ACK.READ]=g.ACK_STRING.READ,e[g.ACK.PLAYED]=g.ACK_STRING.PLAYED,e[g.ACK.INACTIVE]=g.ACK_STRING.INACTIVE,e)),y={delayMs:1e3},C=(function(){function e(){var e=this;this.$1=o("WABatcher").createSimpleBatcher(y,function(t){return e.$2(t).then(function(){return[]})}),this.$3=o("WABatcher").createSimpleBatcher(y,function(t){return e.$4(t).then(function(){return[]})})}var t=e.prototype;return t.acceptPeerReceipt=function(t){return this.$1.accept(t)},t.acceptOtherReceipt=function(t){return this.$3.accept(t)},t.runActiveBatches=function(){return(f||(f=n("Promise"))).all([this.$1.runActiveBatch(),this.$3.runActiveBatch()]).then(r("WAWebNoop"))},t.$5=function(t){var e=[];for(var n of t){var a=n.ack,i=n.msgKeys,l=n.privacyMode,s=n.receiverId;a===o("WAWebAck").ACK.RECEIVED&&l!=null&&e.push({remote:s,deliveryPrivacyMode:l,msgKeys:i.map(function(e){return r("WAWebMsgKey").from(e)})})}return e},t.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["processPrivacyModeUpdates"]))),yield o("WAPromiseMap").promiseMap(e,(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebHandlePrivacyModeUpdateMsgAction").handlePrivacyModeTransition(e.remote,e.deliveryPrivacyMode),yield o("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("updateBizPrivacyStatus",{msgIds:e.msgKeys,privacyMode:e.deliveryPrivacyMode})});return function(t){return e.apply(this,arguments)}})())});function t(t){return e.apply(this,arguments)}return t})(),t.$7=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=this.$8(e),a=t.map(function(e){return r("WAWebMsgKey").from(e)}).filter(function(e){return e.remote.isGroup()||e.remote.isStatus()||e.remote.isBot()}),i=yield o("WAWebApiMessageInfoStore").getHighestMsgAcks(a);for(var l of i.entries()){var s=l[0],u=l[1];n.set(s,u)}return n});function t(t,n){return e.apply(this,arguments)}return t})(),t.$8=function(t){var e=new Map;for(var n of t){var o=n.ack,a=n.isBotInvoke,i=n.isSender,l=n.msgKeys;for(var s of l)if(r("WAWebMsgKey").from(s).remote.isUser()&&a!==!0&&i!==!0){var u;e.set(s,Math.max(o,(u=e.get(s))!=null?u:Number.NEGATIVE_INFINITY))}}return e},t.$9=function(t){var e=new Map;return t.forEach(function(t){var n,r=t.ack,a=t.msgKeys,i=t.receiverId,l=t.ts,s=i.isNewsletter()?i.toJid():o("WAWebWidFactory").asUserWidOrThrow(i).toString(),c=(n=i.device)!=null?n:o("WAJids").DEFAULT_DEVICE_ID;a.forEach(function(t){var n=h[r];if(n==null){o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher]: receipt has unsupported ack type ",""])),r);return}var a=t+","+s,i=e.get(a);if(i)n!==h[o("WAWebAck").ACK.INACTIVE]&&(i[n]=S(i[n],l)),i.deviceDelivered.add(c);else{var d;e.set(a,(d={},d[n]=l,d.deviceDelivered=new Set([c]),d))}})}),Array.from(e,function(e){var t=e[0],n=e[1],r=t.split(","),o=r[0],a=r[1];return[[o,a],n]})},t.$4=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["processOtherReceipts"])));var a=this.$9(e),i=Array.from(new Set(r("lodash").flatMap(e,function(e){return e.msgKeys}))),l=yield o("WAWebModelStorageUtils").getStorage().lock(["message-info","message","chat"],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var l=yield(f||(f=n("Promise"))).all([o("WAWebSchemaMessageInfo").getMessageInfoTable().bulkGet(a.map(function(e){var t=e[0],n=e[1];return t})),o("WAWebDBBulkGetRootMsgs").bulkGetRootMsgs(i,!1)]),s=l[0],u=l[1],c=new Map(i.map(function(e,t){return[e,u[t]]})),d=r("compactMap")(s,function(e,t){var n=a[t],r=n[0],o=r[0],i=r[1],l=n[1];if(!l)return null;if(!e)return{delivery:l.delivery,read:l.read,played:l.played,msgKey:o,receiverUserJid:i,deviceDelivered:Array.from(l.deviceDelivered),deviceNotDelivered:[]};var s=l.deviceDelivered;return e.deviceDelivered.forEach(function(e){return s.add(e)}),{delivery:S(e.delivery,l.delivery),read:S(e.read,l.read),played:S(e.played,l.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(s),deviceNotDelivered:e.deviceNotDelivered.filter(function(e){return!s.has(e)})}});yield o("WAWebSchemaMessageInfo").getMessageInfoTable().bulkCreateOrReplace(d);var m=yield t.$7(e,i),p=Array.from(m.entries()),_=r("compactMap")(p,function(e){var t=e[0],n=e[1],o=r("WAWebMsgKey").fromString(t),a=o.remote;if(a.isUser()||a.isGroup()||a.isStatus()){var i,l=c.get(t);if(l==null)return;if(n>((i=l.ack)!=null?i:Number.NEGATIVE_INFINITY))return{id:l.id.toString(),ack:n}}});return{ackUpdates:_,receiptMsgKeyToMsg:c}}));yield o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(l.ackUpdates).catch(function(e){throw o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["_processOtherReceipts: failed to update db msg acks with error: ",""])),e).sendLogs("process-other-receipts-failed-to-update-db-msg-acks"),e}),o("WAWebBackendApi").frontendFireAndForget("updateMsgModelAcks",{updates:l.ackUpdates.map(function(e){var t=e.ack,n=e.id;return{id:r("WAWebMsgKey").from(n),ack:t}})}),o("WAWebBackendApi").frontendFireAndForget("updateMsgInfo",{updates:r("lodash").flatMap(e,function(e){var t=e.ack,n=e.msgKeys,a=e.receiverId,i=e.ts;return n.map(function(e){var n=l.receiptMsgKeyToMsg.get(e);if(n!=null){var s=r("WAWebMsgKey").from(n.id);if(s.fromMe&&(s.remote.isUser()||s.remote.isGroup()||s.remote.isStatus())){var u=o("WAWebWidFactory").asUserWidOrThrow(a);if(!o("WAWebUserPrefsMeUser").isMeAccount(u))return{msgKey:s,ts:i,participant:u,ack:t}}}})}).filter(Boolean)}),this.$6(this.$5(e)).catch(function(){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["_processOtherReceipts: failed to process privacy mode updates"])))})});function t(t){return e.apply(this,arguments)}return t})(),t.$2=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["processPeerReceipts"])));var t=e.some(function(e){return!e.isOffline});if(t){yield o("WAPromiseMap").promiseMap(e,b);return}var n=e.map(function(e){var t=e.ack,n=e.msgKeys,r=e.ts;return{ts:r,msgKeys:n,ack:t}});yield o("WAWebSchemaPeerReadReceipt").getTable().bulkCreate(n)});function t(t){return e.apply(this,arguments)}return t})(),e})();function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["handleOnlinePeerReceipt"])));var t=e.msgKeys.map(function(e){return r("WAWebMsgKey").from(e)});if(e.remote.isStatus()){var n=t.map(o("WAWebLidStatusMigrationKeyUtils").matKeyConvert);return o("WAWebBackendApi").frontendFireAndForget("handleReadStatus",{msgKeys:n}),o("WAWebBackendApi").frontendSendAndReceive("updateMsgPeerAcks",{msgKeys:n,ack:o("WAWebAck").ACK.READ,t:e.ts})}if((e.remote.isUser()||e.remote.isGroup()||e.remote.isNewsletter()||e.remote.isBot())&&e.ack>=o("WAWebAck").ACK.RECEIVED){if(e.ack===o("WAWebAck").ACK.READ)return o("WAWebHandleMsgReceiptCommon").updateChatPeerRead(e.remote,t);if(e.ack===o("WAWebAck").ACK.PLAYED)return o("WAWebBackendApi").frontendSendAndReceive("updateMsgPeerAcks",{msgKeys:t,ack:e.ack,t:e.ts})}}),v.apply(this,arguments)}function S(e,t){if(e!=null&&t!=null)return Math.min(e,t);var n=e!=null?e:t;return n!=null?n:void 0}var R=new C;l.receiptBatcher=R}),98);
__d("WAWebAddonPluginProcessor",["WANullthrows","WAWebAddonCrossWindowUtils","WAWebMessagePluginProcessAsAddonRegistry"],(function(t,n,r,o,a,i,l){function e(){var e=new Map;for(var t of r("WAWebMessagePluginProcessAsAddonRegistry")){var n=t.processor,o=t.type;n!=null&&e.set(o,n)}return e}var s=e();function u(){return s}function c(e){var t;return typeof e=="string"?t=e:t=o("WAWebAddonCrossWindowUtils").getAddonProcessorType(e),r("WANullthrows")(s.get(t))}function d(e){return!!s.get(e)}l.getAddonProcessorsMap=u,l.getAddonProcessor=c,l.hasAddonProcessor=d}),98);
__d("WAWebPluginCreateRegistryLookup",[],(function(t,n,r,o,a,i){function e(e){var t=new Map;for(var n of e){var r,o=n.type,a=(r=n.subtype)!=null?r:null,i=t.get(o);i==null&&(i=new Map,t.set(o,i)),i.set(a,n)}return function(e,n){var r;return(r=t.get(e))==null?void 0:r.get(n!=null?n:null)}}i.createMsgTypeRegistryLookup=e}),66);
__d("WAWebMessagePluginGenerateReportingTokenContent",["WAWebMessagePluginGenerateReportingTokenContentRegistry","WAWebMessagingGatingUtils","WAWebMsgType","WAWebPluginCreateRegistryLookup"],(function(t,n,r,o,a,i,l){var e=o("WAWebPluginCreateRegistryLookup").createMsgTypeRegistryLookup(r("WAWebMessagePluginGenerateReportingTokenContentRegistry"));function s(t){var n;return(n=e(t.type,t.subtype))==null||n.generateReportingTokenContent==null?void 0:n.generateReportingTokenContent(t)}function u(t,n){var r;return o("WAWebMessagingGatingUtils").isReportingTokenFromInclusionListEnabled()?!!((r=e(t,n))!=null&&r.generateReportingTokenContent):t!==o("WAWebMsgType").MSG_TYPE.REACTION&&t!==o("WAWebMsgType").MSG_TYPE.REACTION_ENC&&t!==o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE&&t!==o("WAWebMsgType").MSG_TYPE.POLL_UPDATE}l.generateReportingTokenContent=s,l.isMsgTypeReportingTokenCompatible=u}),98);
__d("WAWebMessagePluginParseProtobuf",["WALogger","WAWebMessagePluginParseProtobufRegistry","WAWebMultipleMessageParserPluginParseProtobuf","WAWebProtobufsE2E.pb","WAWebProtocolRevokeMessageUtils","WAWebWamEnumE2eFailureReason","WAWebWamEnumEditType","gkx","isStringNullOrEmpty","justknobx"],(function(t,n,r,o,a,i,l){var e,s;function u(t){var n,a,i=o("WAWebMultipleMessageParserPluginParseProtobuf").parseProtobufWithMultipleMessageParserPlugin(t),l=i.result;if((!r("gkx")("26258")||r("justknobx")._("2517"))&&t.msgContext==="relay"&&(t==null||(n=t.messageProtobuf)==null||(n=n.protocolMessage)==null?void 0:n.type)===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT){var u,c;if(t.editAttr!==o("WAWebWamEnumEditType").EDIT_TYPE.EDITED&&r("isStringNullOrEmpty")((u=t==null||(c=t.msgBotInfo)==null?void 0:c.botEditType)!=null?u:""))return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] edit protocol msg with incorrect attribute"]))).sendLogs("message-edit-incorrect-edit-attribute"),null}var d=i.pluginsMatched;for(var m of r("WAWebMessagePluginParseProtobufRegistry")){var p=m(t);if(p!=null){var _;d.push(p.msgData.type+":"+((_=p.msgData.subtype)!=null?_:"null")),l==null&&(l=p)}}if(d.length===0&&l===void 0&&(t==null?void 0:t.msgContext)==="relay"&&(t==null||(a=t.messageProtobuf)==null||(a=a.protocolMessage)==null?void 0:a.type)===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REVOKE)throw new(o("WAWebProtocolRevokeMessageUtils")).ProtocolRevokeMessageValidationError("protocol_revoke_missing_edit_attr",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);return d.length>1?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseProtoPlugins: Matched more than 1 plugin types ",""])),d.join(",")).sendLogs("parse-protobuf-unexpected-plugin-match"),null):l}l.parseProtobuf=u}),98);
__d("WAWebGenerateChatReportingTokenContent",[],(function(t,n,r,o,a,i){function e(e){var t,n=new TextEncoder().encode((t=e.body)!=null?t:"");return self.crypto.getRandomValues(new Uint8Array(n.length))}i.default=e}),66);
__d("WAWebMessagePluginGenerateReportingTokenContentRegistry",["WAWebGenerateAudioOrPttReportingTokenContent","WAWebGenerateChatReportingTokenContent","WAWebGenerateDocumentReportingTokenContent","WAWebGenerateImageReportingTokenContent","WAWebGenerateInteractiveResponseReportingTokenContent","WAWebGeneratePtvReportingTokenContent","WAWebGenerateStickerReportingTokenContent","WAWebGenerateVideoReportingTokenContent"],(function(t,n,r,o,a,i,l){var e=[{type:"album",subtype:void 0,generateReportingTokenContent:null},{type:"audio",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateAudioOrPttReportingTokenContent")},{type:"biz_content_placeholder",subtype:void 0,generateReportingTokenContent:null},{type:"buttons_response",subtype:void 0,generateReportingTokenContent:null},{type:"chat",subtype:"url",generateReportingTokenContent:r("WAWebGenerateChatReportingTokenContent")},{type:"chat",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateChatReportingTokenContent")},{type:"ciphertext",subtype:"bot_unavailable_fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:"fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:"hosted_unavailable_fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:"view_once_unavailable_fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:void 0,generateReportingTokenContent:null},{type:"comment",subtype:void 0,generateReportingTokenContent:null},{type:"debug_placeholder",subtype:void 0,generateReportingTokenContent:null},{type:"document",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateDocumentReportingTokenContent")},{type:"event_creation",subtype:void 0,generateReportingTokenContent:null},{type:"event_edit_encrypted",subtype:void 0,generateReportingTokenContent:null},{type:"event_response",subtype:void 0,generateReportingTokenContent:null},{type:"group-history",subtype:"message_history_bundle",generateReportingTokenContent:null},{type:"groups_v4_invite",subtype:void 0,generateReportingTokenContent:null},{type:"hsm",subtype:void 0,generateReportingTokenContent:null},{type:"image",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateImageReportingTokenContent")},{type:"interactive",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateInteractiveResponseReportingTokenContent")},{type:"interactive_response",subtype:void 0,generateReportingTokenContent:null},{type:"keep_in_chat",subtype:void 0,generateReportingTokenContent:null},{type:"list",subtype:void 0,generateReportingTokenContent:null},{type:"list_response",subtype:void 0,generateReportingTokenContent:null},{type:"loading_media",subtype:"loading_image",generateReportingTokenContent:null},{type:"loading_media",subtype:"loading_video",generateReportingTokenContent:null},{type:"location",subtype:void 0,generateReportingTokenContent:null},{type:"message_edit_encrypted",subtype:"message_edit",generateReportingTokenContent:null},{type:"message_history_notice",subtype:"message_history_notice",generateReportingTokenContent:null},{type:"multi_vcard",subtype:void 0,generateReportingTokenContent:null},{type:"native_flow",subtype:void 0,generateReportingTokenContent:null},{type:"newsletter_admin_invite",subtype:void 0,generateReportingTokenContent:null},{type:"newsletter_follower_invite",subtype:void 0,generateReportingTokenContent:null},{type:"newsletter_question_response",subtype:void 0,generateReportingTokenContent:null},{type:"notification_template",subtype:"contact_info_card",generateReportingTokenContent:null},{type:"order",subtype:void 0,generateReportingTokenContent:null},{type:"payment",subtype:"ciphertext",generateReportingTokenContent:null},{type:"payment",subtype:"futureproof",generateReportingTokenContent:null},{type:"payment",subtype:"invite",generateReportingTokenContent:null},{type:"payment",subtype:"request",generateReportingTokenContent:null},{type:"payment",subtype:"send",generateReportingTokenContent:null},{type:"pin_message",subtype:void 0,generateReportingTokenContent:null},{type:"pinned_message",subtype:void 0,generateReportingTokenContent:null},{type:"poll_creation",subtype:void 0,generateReportingTokenContent:null},{type:"poll_result_snapshot",subtype:void 0,generateReportingTokenContent:null},{type:"poll_update",subtype:"poll_vote",generateReportingTokenContent:null},{type:"product",subtype:void 0,generateReportingTokenContent:null},{type:"protocol",subtype:"admin_revoke",generateReportingTokenContent:null},{type:"protocol",subtype:"bot_feedback",generateReportingTokenContent:null},{type:"protocol",subtype:"bot_memu_onboarding",generateReportingTokenContent:null},{type:"protocol",subtype:"bot_request_welcome",generateReportingTokenContent:null},{type:"protocol",subtype:"ephemeral_setting",generateReportingTokenContent:null},{type:"protocol",subtype:"ephemeral_sync_response",generateReportingTokenContent:null},{type:"protocol",subtype:"event_edit_decrypted",generateReportingTokenContent:null},{type:"protocol",subtype:"history_sync_notification",generateReportingTokenContent:null},{type:"protocol",subtype:"limit_sharing_system_message",generateReportingTokenContent:null},{type:"protocol",subtype:"member_label",generateReportingTokenContent:null},{type:"protocol",subtype:"message_edit",generateReportingTokenContent:null},{type:"protocol",subtype:"message_edit_decrypted",generateReportingTokenContent:null},{type:"protocol",subtype:"sender_revoke",generateReportingTokenContent:null},{type:"protocol",subtype:"share_phone_number",generateReportingTokenContent:null},{type:"protocol",subtype:"status_group_mention_message",generateReportingTokenContent:null},{type:"protocol",subtype:"status_mention_message",generateReportingTokenContent:null},{type:"ptt",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateAudioOrPttReportingTokenContent")},{type:"ptv",subtype:void 0,generateReportingTokenContent:r("WAWebGeneratePtvReportingTokenContent")},{type:"reaction",subtype:void 0,generateReportingTokenContent:null},{type:"reaction_enc",subtype:void 0,generateReportingTokenContent:null},{type:"request_phone_number",subtype:void 0,generateReportingTokenContent:null},{type:"revoked",subtype:"admin",generateReportingTokenContent:null},{type:"revoked",subtype:"sender",generateReportingTokenContent:null},{type:"rich_response",subtype:void 0,generateReportingTokenContent:null},{type:"status_notification",subtype:"status_notification_message",generateReportingTokenContent:null},{type:"sticker",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateStickerReportingTokenContent")},{type:"sticker-pack",subtype:void 0,generateReportingTokenContent:null},{type:"template_button_reply",subtype:void 0,generateReportingTokenContent:null},{type:"unknown",subtype:"payment_action_request_declined",generateReportingTokenContent:null},{type:"unknown",subtype:"payment_transaction_request_cancelled",generateReportingTokenContent:null},{type:"unknown",subtype:"phone",generateReportingTokenContent:null},{type:"unknown",subtype:"phone_only_feature",generateReportingTokenContent:null},{type:"unknown",subtype:void 0,generateReportingTokenContent:null},{type:"vcard",subtype:void 0,generateReportingTokenContent:null},{type:"video",subtype:void 0,generateReportingTokenContent:r("WAWebGenerateVideoReportingTokenContent")}];l.default=e}),98);
__d("WAWebAlbumsParseAlbumMessageProto",["WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.albumMessage;if(r==null)return null;var a=r.contextInfo;return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.ALBUM,kind:o("WAWebMsgType").MsgKind.Album}),contextInfo:a}}l.default=e}),98);
__d("WAWebEventsGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("event_name_length_limit")}function s(){return o("WAWebABProps").getABPropConfigValue("event_description_length_limit")}function u(){return o("WAWebABProps").getABPropConfigValue("events_m3_cover_image_send")}function c(){return o("WAWebABProps").getABPropConfigValue("events_m3_cover_image_receive")}function d(){return o("WAWebABProps").getABPropConfigValue("events_m3_pin_customization_send")}function m(){return o("WAWebABProps").getABPropConfigValue("events_m3_pin_customization_receive")}l.getEventsNameLengthLimit=e,l.getEventsDescriptionLengthLimit=s}),98);
__d("WAWebEventsValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_MESSAGE_SECRET:"missing_message_secret",INVALID_MESSAGE_SECRET:"invalid_message_secret",EVENT_CREATION_INVALID_NAME:"event_creation_invalid_name",EVENT_CREATION_INVALID_DESCRIPTION:"event_creation_invalid_description",EVENT_CREATION_INVALID_CANCELED_STATUS:"event_creation_invalid_canceled_status",EVENT_CREATION_MISSING_DATE:"event_creation_missing_date",EVENT_CREATION_INVALID_LOCATION:"event_creation_invalid_location",EVENT_CREATION_INVALID_LOCATION_NAME:"event_creation_invalid_location_name",EVENT_CREATION_INVALID_LOCATION_ADDRESS:"event_creation_invalid_location_address",EVENT_CREATION_MISSING_MESSAGE_SENDER:"event_creation_missing_message_sender",EVENT_CREATION_INVALID_END_TIME:"event_creation_invalid_end_time",EVENT_CREATION_INVALID_JOIN_LINK:"event_creation_invalid_join_link"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="EventCreationValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),u=n("$InternalEnum")({EVENT_RESPONSE_MISSING_MESSAGE_KEY:"event_response_missing_message_key",EVENT_RESPONSE_MISSING_ENC_IV:"event_response_missing_enc_iv",EVENT_RESPONSE_INVALID_SIZE_ENC_IV:"event_response_invalid_size_enc_iv",EVENT_RESPONSE_MISSING_ENC_PAYLOAD:"event_response_missing_enc_payload",EVENT_RESPONSE_MISSING_MESSAGE_SENDER:"event_response_missing_message_sender"}),c=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="EncryptedEventResponseValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),d=n("$InternalEnum")({EVENT_EDIT_MISSING_TARGET_MESSAGE_KEY:"event_edit_missing_target_message_key",EVENT_EDIT_MISSING_ENC_IV:"event_edit_missing_enc_iv",EVENT_EDIT_INVALID_SIZE_ENC_IV:"event_edit_invalid_size_enc_iv",EVENT_EDIT_MISSING_ENC_PAYLOAD:"event_edit_missing_enc_payload",EVENT_EDIT_MISSING_MESSAGE_SENDER:"event_edit_missing_message_sender",EVENT_EDIT_MISSING_EDITED_MESSAGE:"event_edit_missing_edited_message",EVENT_EDIT_MISSING_SENDER_TIMESTAMP:"event_edit_missing_sender_timestamp",EVENT_EDIT_PARENT_SENDER_MISMATCH:"event_edit_parent_sender_mismatch",EVENT_EDIT_INVALID_PROTOCOL_MESSAGE_TYPE:"event_edit_invalid_protocol_message_type",EVENT_EDIT_MISSING_MESSAGE_SECRET:"event_edit_missing_message_secret"}),m=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="EncryptedEventEditValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.EventCreationValidationErrorCode=e,l.EventCreationValidationError=s,l.EncryptedEventResponseValidationErrorCode=u,l.EncryptedEventResponseValidationError=c,l.EncryptedEventEditValidationErrorCode=d,l.EncryptedEventEditValidationError=m}),98);
__d("WAWebEventsParseEventCreationMessageProto",["WALongInt","WAWebApiParse","WAWebEventsGatingUtils","WAWebEventsValidationError","WAWebMsgType","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,r=e.messageProtobuf,a=e.msgContext,i=r.eventMessage;if(i==null)return null;var l=i.contextInfo,s=i.description,u=i.endTime,c=i.extraGuestsAllowed,d=i.isCanceled,m=i.isScheduleCall,p=i.joinLink,_=i.location,f=i.name,g=i.startTime,h=o("WALongInt").maybeNumberOrThrowIfTooLarge(g),y=o("WALongInt").maybeNumberOrThrowIfTooLarge(u);if(p!=null&&o("WAWebApiParse").isValidCallLink(p)===!1)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_JOIN_LINK,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(f==null||f===""||f.length>o("WAWebEventsGatingUtils").getEventsNameLengthLimit())throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(h==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_DATE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(s!=null&&s.length>o("WAWebEventsGatingUtils").getEventsDescriptionLengthLimit())throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_DESCRIPTION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(d==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_CANCELED_STATUS,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(_!=null){var C=_.address,b=_.degreesLatitude,v=_.degreesLongitude,S=_.name;if(S!=null&&S.length>o("WAWebEventsGatingUtils").getEventsDescriptionLengthLimit())throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_LOCATION_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(C!=null&&C.length>o("WAWebEventsGatingUtils").getEventsDescriptionLengthLimit())throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_LOCATION_ADDRESS,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b==null&&v!=null||b!=null&&v==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_LOCATION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}if(y!=null&&y<h)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_END_TIME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var R=babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.EVENT_CREATION,kind:o("WAWebMsgType").MsgKind.EventCreation,eventName:f,eventDescription:s,eventJoinLink:p,eventStartTime:h,isEventCanceled:!!d,eventLocation:_,eventEndTime:y!=null?y:void 0,eventIsScheduledCall:m!=null?m:void 0,eventExtraGuestsAllowed:c!=null?c:void 0});if(a==="quoted"||a==="history_quoted"||a==="history")return{msgData:R,contextInfo:l};var L=(t=r.messageContextInfo)==null?void 0:t.messageSecret;if(L==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.MISSING_MESSAGE_SECRET,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET);if(L.byteLength!==32)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.INVALID_MESSAGE_SECRET,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);return{msgData:R,contextInfo:l}}l.default=e}),98);
__d("WAWebBizContentPlaceholderMsgData.flow",["$InternalEnum"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MASK_LINKED_DEVICES:0});l.BizContentPlaceholderType=e}),98);
__d("WAWebParseBizContentPlaceholderProto",["WAWebBizContentPlaceholderMsgData.flow","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.placeholderMessage;if(!(r==null||r.type==null)){var a=s(r.type);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.BIZ_CONTENT_PLACEHOLDER,kind:o("WAWebMsgType").MsgKind.BizContentPlaceholder,bizContentPlaceholderType:a}),contextInfo:void 0}}}function s(e){switch(e){case o("WAWebProtobufsE2E.pb").Message$PlaceholderMessage$PlaceholderType.MASK_LINKED_DEVICES:return o("WAWebBizContentPlaceholderMsgData.flow").BizContentPlaceholderType.MASK_LINKED_DEVICES}}l.default=e}),98);
__d("WAWebParseBotMemuOnboardingMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,r=e.messageProtobuf;if(((t=r.protocolMessage)==null?void 0:t.type)===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.BOT_MEMU_ONBOARDING_MESSAGE)return{msgData:babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"bot_memu_onboarding"}),contextInfo:null}}l.default=e}),98);
__d("WAWebParseBotRequestWelcomeMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,r=e.messageProtobuf;if(((t=r.protocolMessage)==null?void 0:t.type)===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REQUEST_WELCOME_MESSAGE)return{msgData:babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"bot_request_welcome"}),contextInfo:null}}l.default=e}),98);
__d("WAWebParseGroupInviteMessageProto",["WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.groupInviteMessage;if(r!=null){var a=r.caption,i=r.contextInfo,l=r.groupJid,s=r.groupName,u=r.inviteCode,c=r.inviteExpiration,d=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE,kind:o("WAWebMsgType").MsgKind.GroupsV4Invite,comment:a,inviteCode:u,inviteCodeExp:c==null?void 0:c.toString(),inviteGrp:l,inviteGrpName:s});return{msgData:d,contextInfo:i}}}l.default=e}),98);
__d("WAWebParseListMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.listMessage;if(r!=null){var a,i=r.listType;if(i===o("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.SINGLE_SELECT||i===o("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.PRODUCT_LIST){var l=t.businessOwnerJid,s=t.productListItemCount;if(r.listType===o("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.PRODUCT_LIST){var u,c;l=(u=r.productListInfo)==null?void 0:u.businessOwnerJid,s=(c=r.productListInfo)==null?void 0:c.productSections.reduce(function(e,t){return e+t.products.length},0)}a=babelHelpers.extends({},t,{businessOwnerJid:l,productListItemCount:s,type:o("WAWebMsgType").MSG_TYPE.LIST,kind:o("WAWebMsgType").MsgKind.List,list:r,footer:r.footerText})}else a=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown});return{msgData:a,contextInfo:r.contextInfo}}}l.default=e}),98);
__d("WAWebGroupHistoryGating",["WAWebABProps"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("WAWebABProps").getABPropConfigValue("group_history_receive")}function s(){return o("WAWebABProps").getABPropConfigValue("group_history_notice_receive")}function u(){return o("WAWebABProps").getABPropConfigValue("group_history_send")}function c(){return o("WAWebABProps").getABPropConfigValue("group_history_settings")}function d(){return o("WAWebABProps").getABPropConfigValue("group_history_settings_toggle_ui")}l.isGroupHistoryReceiverEnabled=e,l.isGroupHistoryNoticeReceiverEnabled=s,l.isGroupHistorySenderEnabled=u,l.isGroupHistorySettingsEnabled=c,l.isGroupHistorySettingsToggleUIEnabled=d}),98);
__d("WAWebGroupHistoryMsgData.flow",["$InternalEnum"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({NONE:0,DOWNLOADING:1,DOWNLOADED:2,PROCESSING:3,INJECTED:4,FAILED:5,INJECTED_PARTIAL:6});l.MessageHistoryBundleProcessState=e}),98);
__d("WAWebMessageHistoryValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_MESSAGE_HISTORY_BUNDLE:"message_history_missing_bundle",MISSING_MIMETYPE:"message_history_missing_mimetype",INVALID_MIMETYPE:"message_history_invalid_mimetype",MISSING_FILE_SHA256:"message_history_missing_file_sha256",INVALID_FILE_SHA256_LENGTH:"message_history_invalid_file_sha256_length",MISSING_MEDIA_KEY:"message_history_missing_media_key",INVALID_MEDIA_KEY_LENGTH:"message_history_invalid_media_key_length",MISSING_FILE_ENC_SHA256:"message_history_missing_file_enc_sha256",INVALID_FILE_ENC_SHA256_LENGTH:"message_history_invalid_file_enc_sha256_length",MISSING_DIRECT_PATH:"message_history_missing_direct_path",MISSING_MESSAGE_HISTORY_METADATA:"message_history_missing_metadata",INVALID_HISTORY_RECEIVERS_LENGTH:"message_history_invalid_receivers_length",MISSING_OLDEST_MESSAGE_TIMESTAMP:"message_history_missing_oldest_timestamp",INVALID_MESSAGE_COUNT:"message_history_invalid_message_count"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="MessageHistoryValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.MessageHistoryValidationErrorCode=e,l.MessageHistoryValidationError=s}),98);
__d("WAWebMessageHistoryValidation",["WAWebMessageHistoryValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){if(e.historyReceivers==null||e.historyReceivers.length===0)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.INVALID_HISTORY_RECEIVERS_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e.oldestMessageTimestamp==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_OLDEST_MESSAGE_TIMESTAMP,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e.messageCount==null||Number(e.messageCount)<=0)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.INVALID_MESSAGE_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}function s(t){if(t.mimetype==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_MIMETYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.mimetype!=="application/protobuf")throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.INVALID_MIMETYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.fileSha256==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_FILE_SHA256,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.fileSha256.byteLength!==32)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.INVALID_FILE_SHA256_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.mediaKey==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_MEDIA_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.mediaKey.byteLength!==32)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.INVALID_MEDIA_KEY_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.fileEncSha256==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_FILE_ENC_SHA256,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.fileEncSha256.byteLength!==32)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.INVALID_FILE_ENC_SHA256_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.messageHistoryMetadata==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_MESSAGE_HISTORY_METADATA,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);e(t.messageHistoryMetadata)}function u(t){if(t.messageHistoryMetadata==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_MESSAGE_HISTORY_METADATA,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);e(t.messageHistoryMetadata)}l.validateMessageHistoryBundle=s,l.validateMessageHistoryNotice=u}),98);
__d("WAWebWamEnumDownloadOriginType",[],(function(t,n,r,o,a,i){var e=Object.freeze({CHAT_PERSONAL:1,CHAT_GROUP:2,STATUS_USER:3,STATUS_ADS:4,PRODUCT_CATALOG:5,GDPR:6,STICKER_PICKER:7,PROFILE_PICTURE:8,BLOKS:9,P2B:10,MESSAGE_HISTORY_SYNC:11,COMMUNITY:12,CHANNEL:13,BROADCAST:14,INTEROP:15,WAMO_STATUS:16,WAMO_BIZ_PROFILE:17,WAMO_PREFERENCES:18,RICH_ORDER_STATUS:19});i.DOWNLOAD_ORIGIN_TYPE=e}),66);
__d("WAWebParseMessageHistoryBundleProto",["WALogger","WAWebE2EProtoParserApi","WAWebGroupHistoryGating","WAWebGroupHistoryMsgData.flow","WAWebMessageHistoryValidation","WAWebMessageHistoryValidationError","WAWebMmsMediaTypes","WAWebMsgType","WAWebProtobufsWeb.pb","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWamEnumDownloadOriginType","WAWebWamEnumE2eFailureReason","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e;function s(e){var t,n,r=e.baseMessage,a=e.messageProtobuf,i=a.messageHistoryBundle;if(i==null)return null;o("WAWebMessageHistoryValidation").validateMessageHistoryBundle(i);var l=(t=i.messageHistoryMetadata)==null?void 0:t.historyReceivers.some(function(e){return o("WAWebUserPrefsMeUser").isMeAccount(o("WAWebWidFactory").createWid(e))}),s=l===!0||r.id.fromMe===!0?o("WAWebViewMode.flow").ViewModeType.VISIBLE:o("WAWebViewMode.flow").ViewModeType.HIDDEN;if(!o("WAWebGroupHistoryGating").isGroupHistoryReceiverEnabled()){var d;return{msgData:babelHelpers.extends({},r,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,viewMode:s,futureproofType:o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_BUNDLE,futureproofSubtype:"message_history_bundle"}),contextInfo:(d=i.contextInfo)!=null?d:null}}var m=u(i),p=babelHelpers.extends({},r,{type:o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_BUNDLE,kind:"messageHistoryBundle",subtype:"message_history_bundle",viewMode:s,groupHistoryBundleMetadata:i.messageHistoryMetadata?babelHelpers.extends({},i.messageHistoryMetadata,{historyReceivers:i.messageHistoryMetadata.historyReceivers.map(o("WAWebWidFactory").createWid),processState:c(r.groupHistoryBundleInfo)}):null,directPath:m==null?void 0:m.directPath,encFilehash:m==null?void 0:m.encFilehash,filehash:m==null?void 0:m.filehash,mediaKey:m==null?void 0:m.mediaKey});return{msgData:p,contextInfo:(n=i.contextInfo)!=null?n:null}}function u(t){var n=t.directPath,r=t.fileEncSha256,a=t.fileSha256,i=t.mediaKey;try{var l=o("WAWebE2EProtoParserApi").decodeBytes(a);if(l==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_FILE_SHA256,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(n==null)throw new(o("WAWebMessageHistoryValidationError")).MessageHistoryValidationError(o("WAWebMessageHistoryValidationError").MessageHistoryValidationErrorCode.MISSING_DIRECT_PATH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{directPath:n,encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(r),filehash:l,mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(i),type:o("WAWebMmsMediaTypes").MEDIA_TYPES.GROUP_HISTORY,signal:new AbortController().signal,userDownloadAttemptCount:0,downloadOrigin:o("WAWebWamEnumDownloadOriginType").DOWNLOAD_ORIGIN_TYPE.MESSAGE_HISTORY_SYNC}}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[GroupHistory] Failed to download message history bundle"]))).sendLogs("group-history-failed-to-download-bundle")}}function c(e){return(function(e){return e===o("WAWebProtobufsWeb.pb").GroupHistoryBundleInfo$ProcessState.NOT_INJECTED?o("WAWebGroupHistoryMsgData.flow").MessageHistoryBundleProcessState.NONE:e===o("WAWebProtobufsWeb.pb").GroupHistoryBundleInfo$ProcessState.INJECTED?o("WAWebGroupHistoryMsgData.flow").MessageHistoryBundleProcessState.INJECTED:e===o("WAWebProtobufsWeb.pb").GroupHistoryBundleInfo$ProcessState.INJECTED_PARTIAL?o("WAWebGroupHistoryMsgData.flow").MessageHistoryBundleProcessState.INJECTED_PARTIAL:e===o("WAWebProtobufsWeb.pb").GroupHistoryBundleInfo$ProcessState.INJECTION_FAILED?o("WAWebGroupHistoryMsgData.flow").MessageHistoryBundleProcessState.FAILED:o("WAWebGroupHistoryMsgData.flow").MessageHistoryBundleProcessState.NONE})(e==null?void 0:e.processState)}l.default=s}),98);
__d("WAWebParseMessageHistoryNoticeProto",["WALogger","WAWebCommonMsgSubtypeTypes","WAWebGroupHistoryGating","WAWebGroupHistoryMsgData.flow","WAWebMessageHistoryValidation","WAWebMsgType","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e;function s(t){var n,r,a=t.baseMessage,i=t.messageProtobuf,l=i.messageHistoryNotice;if(l==null)return null;o("WAWebMessageHistoryValidation").validateMessageHistoryNotice(l);var s=(n=l.messageHistoryMetadata)==null?void 0:n.historyReceivers.some(function(e){return o("WAWebUserPrefsMeUser").isMeAccount(o("WAWebWidFactory").createWid(e))});if(!o("WAWebGroupHistoryGating").isGroupHistoryNoticeReceiverEnabled()){var u;return{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,viewMode:s===!1&&a.id.fromMe===!1?o("WAWebViewMode.flow").ViewModeType.VISIBLE:o("WAWebViewMode.flow").ViewModeType.HIDDEN,futureproofType:o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_NOTICE,futureproofSubtype:"message_history_notice"}),contextInfo:(u=l.contextInfo)!=null?u:null}}if(s===!1&&a.id.fromMe===!1){var c,d,m=(c=l.messageHistoryMetadata)==null?void 0:c.oldestMessageTimestamp;return m==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[GroupHistory] oldestMessageTimestamp is null"]))),null):{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_NOTICE,kind:o("WAWebMsgType").MsgKind.MessageHistoryNotice,subtype:"message_history_notice",viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,groupHistoryBundleMetadata:l.messageHistoryMetadata?babelHelpers.extends({},l.messageHistoryMetadata,{historyReceivers:l.messageHistoryMetadata.historyReceivers.map(o("WAWebWidFactory").createWid),processState:o("WAWebGroupHistoryMsgData.flow").MessageHistoryBundleProcessState.NONE}):null}),contextInfo:(d=l.contextInfo)!=null?d:null}}return{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.MESSAGE_HISTORY_NOTICE,kind:o("WAWebMsgType").MsgKind.MessageHistoryNotice,subtype:o("WAWebCommonMsgSubtypeTypes").MsgSubtype.MessageHistoryNotice,viewMode:o("WAWebViewMode.flow").ViewModeType.HIDDEN}),contextInfo:(r=l.contextInfo)!=null?r:null}}l.default=s}),98);
__d("WAWebMultiVcardMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({EMPTY_LIST:"contacts_array_empty_list",INVALID_LIST_SIZE:"contacts_array_invalid_list_size"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="MultiVcardMessageValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.MultiVcardValidationErrorCode=e,l.MultiVcardMessageValidationError=s}),98);
__d("WAWebParseMultiVcardMessageProto",["WAWebMsgType","WAWebMultiVcardMessageValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.contactsArrayMessage;if(a!=null){var i=a.contacts,l=a.contextInfo,s=a.displayName;if((r==="relay"||r==="outgoing")&&(i==null||i.length===0))throw new(o("WAWebMultiVcardMessageValidationError")).MultiVcardMessageValidationError(o("WAWebMultiVcardMessageValidationError").MultiVcardValidationErrorCode.EMPTY_LIST,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);var u=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.MULTI_VCARD,kind:o("WAWebMsgType").MsgKind.MultiVcard,vcardFormattedName:s,vcardList:Array.isArray(i)?i.map(function(e){return{displayName:e.displayName,vcard:e.vcard,isMultiVcard:!1}}):[]});return{msgData:u,contextInfo:l}}}l.default=e}),98);
__d("WAWebParseOrderMessageProto",["WALongInt","WAWebE2EProtoParserApi","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.orderMessage;if(r!=null){var a=r.catalogType,i=r.contextInfo,l=r.itemCount,s=r.message,u=r.orderId,c=r.orderTitle,d=r.sellerJid,m=r.status,p=r.surface,_=r.thumbnail,f=r.token,g=r.totalAmount1000,h=r.totalCurrencyCode,y=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.ORDER,kind:o("WAWebMsgType").MsgKind.Order,thumbnail:o("WAWebE2EProtoParserApi").decodeBytes(_),message:s||"",orderId:u,itemCount:l||0,status:m,surface:p,sellerJid:d,orderTitle:c||"",token:f||"",totalAmount1000:o("WALongInt").numberOrThrowIfTooLarge(g!=null?g:0),totalCurrencyCode:h,catalogType:a,body:""});return{msgData:y,contextInfo:i}}}l.default=e}),98);
__d("WAWebParsePaymentInviteMessageProto",["WALogger","WALongInt","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){var e,s;function u(t){var n=t.baseMessage,r=t.messageProtobuf,a=r.paymentInviteMessage;if(a!=null)return a.serviceType===o("WAWebProtobufsE2E.pb").Message$PaymentInviteMessage$ServiceType.NOVI?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions"]))),{msgData:babelHelpers.extends({},n,{kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:null}):(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[payment-invite] render payment invite of type ",""])),a.serviceType),{msgData:babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.PAYMENT,kind:o("WAWebMsgType").MsgKind.Payment,subtype:"invite",paymentExpiryTimestamp:o("WALongInt").maybeNumberOrThrowIfTooLarge(a.expiryTimestamp),paymentInviteServiceType:a.serviceType}),contextInfo:null})}l.default=u}),98);
__d("WAWebPollsValidationError",["$InternalEnum","WACustomError","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e,s=(e=n("$InternalEnum"))({INVALID_MESSAGE_SECRET:"poll_creation_invalid_message_secret",INVALID_NAME:"poll_creation_invalid_name",INVALID_OPTIONS_COUNT:"poll_creation_invalid_options_count",INVALID_OPTION:"poll_creation_invalid_option",INVALID_SELECTABLE_OPTIONS_COUNT:"poll_creation_invalid_selectable_options_count",MISSING_MESSAGE_SECRET:"poll_creation_missing_message_secret",MISSING_NAME:"poll_creation_missing_name",MISSING_OPTIONS:"poll_creation_missing_options",MISSING_SELECTABLE_OPTIONS_COUNT:"poll_creation_missing_selectable_options_count",DUPLICATE_OPTIONS:"poll_creation_duplicate_options"}),u=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="PollCreationValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),c=e({INVALID_VOTE_ENC_IV:"poll_update_invalid_vote_enc_iv",MISSING_POLL_MESSAGE_KEY:"poll_update_missing_poll_message_key",MISSING_SENDER_TIMESTAMP:"poll_update_missing_sender_timestamp",MISSING_UPDATE:"poll_update_missing_update",MISSING_VOTE_ENC_IV:"poll_update_missing_vote_enc_iv",MISSING_VOTE_ENC_PAYLOAD:"poll_update_missing_vote_enc_payload",MESSAGE_STANZA_INVALID:"poll_update_message_stanza_invalid"}),d=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="PollUpdateValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),m=e({INVALID_MESSAGE_SECRET:"poll_vote_invalid_message_secret",INVALID_OPTION:"poll_vote_invalid_option",INVALID_OPTIONS_COUNT:"poll_vote_invalid_options_count",OPTION_NOT_FOUND:"poll_vote_option_not_found"}),p=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.name="PollVoteValidationError",n.code=t,n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError),_=e({INVALID_NAME:"poll_result_snapshot_invalid_name",INVALID_POLL_VOTES_SNAPSHOTS_COUNT:"poll_result_snapshot_invalid_poll_votes_snapshots_count",INVALID_OPTIONS_COUNT:"poll_result_snapshot_invalid_options_count",INVALID_OPTION:"poll_result_snapshot_invalid_option",INVALID_OPTION_VOTE_COUNT:"poll_result_snapshot_invalid_option_vote_count",MISSING_NAME:"poll_result_snapshot_missing_name",MISSING_POLL_VOTES:"poll_result_snapshot_missing_poll_votes",MISSING_OPTION:"poll_result_snapshot_missing_option",MISSING_OPTIONS:"poll_result_snapshot_missing_options",MISSING_OPTION_VOTE_COUNT:"poll_result_snapshot_missing_option_vote_count",DUPLICATE_OPTIONS:"poll_result_snapshot_duplicate_options"}),f=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="PollResultSnapshotValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.PollCreationValidationErrorCode=s,l.PollCreationValidationError=u,l.PollUpdateValidationErrorCode=c,l.PollUpdateValidationError=d,l.PollVoteValidationErrorCode=m,l.PollVoteValidationError=p,l.PollResultSnapshotValidationErrorCode=_,l.PollResultSnapshotValidationError=f}),98);
__d("WAWebParsePollResultSnapshotMessageProto",["WALongInt","WAWebMsgType","WAWebNewsletterGatingUtils","WAWebPollCreationUtils","WAWebPollsGatingUtils","WAWebPollsValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.pollResultSnapshotMessage,i=n.pollResultSnapshotMessageV3,l=a!=null?a:i;if(l){if(!o("WAWebPollsGatingUtils").isPollResultSnapshotReceivingEnabled()||i&&!o("WAWebNewsletterGatingUtils").isNewsletterQuizReceiverEnabled())return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.POLL_RESULT_SNAPSHOT}),contextInfo:l.contextInfo};var s=l.contextInfo,u=l.name,c=l.pollVotes;if(u==null)throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.MISSING_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(u.length===0||u.length>o("WAWebPollsGatingUtils").getMaxPollNameLengthForIncomingMessages())throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.INVALID_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d=o("WAWebPollCreationUtils").getPollTypeFromE2EValue(l.pollType);if(r==="quoted"||r==="history_quoted"){var m=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.POLL_RESULT_SNAPSHOT,kind:o("WAWebMsgType").MsgKind.PollResultSnapshot,pollName:u,pollVotesSnapshot:null,pollType:d});return{msgData:m,contextInfo:s}}if(c==null||c.length===0)throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.MISSING_POLL_VOTES,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var p=new Set,_=c.map(function(e){var t=e.optionName,n=e.optionVoteCount;if(t==null)throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.MISSING_OPTION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(t.length===0||t.length>o("WAWebPollsGatingUtils").getMaxPollOptionLengthForIncomingMessages())throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.INVALID_OPTION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(n==null)throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.MISSING_OPTION_VOTE_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var r=o("WALongInt").maybeNumber(n);if(r==null)throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.INVALID_OPTION_VOTE_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(p.has(t))throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.DUPLICATE_OPTIONS,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var a=p.size;return p.add(t),{option:{localId:a,name:t},optionVoteCount:r}});if(_.length<2||_.length>o("WAWebPollsGatingUtils").getMaxPollOptionCount())throw new(o("WAWebPollsValidationError")).PollResultSnapshotValidationError(o("WAWebPollsValidationError").PollResultSnapshotValidationErrorCode.INVALID_POLL_VOTES_SNAPSHOTS_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var f=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.POLL_RESULT_SNAPSHOT,kind:o("WAWebMsgType").MsgKind.PollResultSnapshot,pollName:u,pollVotesSnapshot:{pollVotes:_},pollType:d});return{msgData:f,contextInfo:s}}}l.default=e}),98);
__d("WAWebParseProtocolHistorySyncNotificationMessageProto",["WAWebE2EProtoParserApi","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumDownloadOriginType"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,r=e.messageProtobuf,a=e.msgContext,i=r.protocolMessage;if(i!=null&&a==="relay"&&i.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.HISTORY_SYNC_NOTIFICATION){var l=i.historySyncNotification;if(l!=null){var s={directPath:l.directPath,encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(l.fileEncSha256),filehash:o("WAWebE2EProtoParserApi").decodeBytes(l.fileSha256),mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(l.mediaKey),type:"md-msg-hist",downloadOrigin:o("WAWebWamEnumDownloadOriginType").DOWNLOAD_ORIGIN_TYPE.MESSAGE_HISTORY_SYNC},u=babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"history_sync_notification",historySyncMetaData:{historySyncNotification:l,downloadOptions:s,progress:(i==null||(t=i.historySyncNotification)==null?void 0:t.progress)||0}});return{msgData:u,contextInfo:void 0}}}}l.default=e}),98);
__d("WAWebMemberLabel.flow",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.castToMemberLabeString=e}),66);
__d("WAWebMemberLabelCommonUtils",[],(function(t,n,r,o,a,i){"use strict";var e=2,l=30,s=/^(?:[ -~\xA0-\xAC\xAE-\u02FF\u0370-\u0377\u037A-\u037F\u0384-\u038A\u038C\u038E-\u03A1\u03A3-\u0482\u048A-\u052F\u0531-\u0556\u0559-\u058A\u058D-\u058F\u05BE\u05C0\u05C3\u05C6\u05D0-\u05EA\u05EF-\u05F4\u0606-\u060F\u061B\u061D-\u064A\u0660-\u066F\u0671-\u06D5\u06DE\u06E5\u06E6\u06E9\u06EE-\u070D\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07C0-\u07EA\u07F4-\u07FA\u07FE-\u0815\u081A\u0824\u0828\u0830-\u083E\u0840-\u0858\u085E\u0860-\u086A\u0870-\u088F\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0964-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09FD\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A76\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AF1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0BE6-\u0BFA\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5C\u0C5D\u0C60\u0C61\u0C66-\u0C6F\u0C77-\u0C80\u0C84-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDC-\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D4F\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DE6-\u0DEF\u0DF4\u0E01-\u0E30\u0E32\u0E33\u0E3F-\u0E46\u0E4F-\u0E5B\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00-\u0F17\u0F1A-\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F40-\u0F47\u0F49-\u0F6C\u0F85\u0F88-\u0F8C\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE-\u0FDA\u1000-\u102A\u103F-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u109E-\u10C5\u10C7\u10CD\u10D0-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1360-\u137C\u1380-\u1399\u13A0-\u13F5\u13F8-\u13FD\u1400-\u169C\u16A0-\u16F8\u1700-\u1711\u171F-\u1731\u1735\u1736\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D4-\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1800-\u180A\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1940\u1944-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u19DE-\u1A16\u1A1E-\u1A54\u1A80-\u1A89\u1A90-\u1A99\u1AA0-\u1AAD\u1B05-\u1B33\u1B45-\u1B4C\u1B4E-\u1B6A\u1B74-\u1B7F\u1B83-\u1BA0\u1BAE-\u1BE5\u1BFC-\u1C23\u1C3B-\u1C49\u1C4D-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CC7\u1CD3\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2000-\u200A\u2010-\u2029\u202F-\u205F\u2070\u2071\u2074-\u208E\u2090-\u209C\u20A0-\u20C1\u2100-\u218B\u2190-\u2429\u2440-\u244A\u2460-\u2B73\u2B76-\u2CEE\u2CF2\u2CF3\u2CF9-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D70\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E00-\u2E5D\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3029\u3030-\u303F\u3041-\u3096\u309B-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\u31E5\u31EF-\u321E\u3220-\uA48C\uA490-\uA4C6\uA4D0-\uA62B\uA640-\uA66E\uA673\uA67E-\uA69D\uA6A0-\uA6EF\uA6F2-\uA6F7\uA700-\uA7DC\uA7F1-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA828-\uA82B\uA830-\uA839\uA840-\uA877\uA882-\uA8B3\uA8CE-\uA8D9\uA8F2-\uA8FE\uA900-\uA925\uA92E-\uA946\uA95F-\uA97C\uA984-\uA9B2\uA9C1-\uA9CD\uA9CF-\uA9D9\uA9DE-\uA9E4\uA9E6-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA5C-\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAAEA\uAAF0-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEB\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFDCF\uFDF0-\uFDFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFE70-\uFE74\uFE76-\uFEFC\uFF01-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD00-\uDD02\uDD07-\uDD33\uDD37-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDF9F-\uDFC3\uDFC8-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD6F-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC57-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD1F-\uDD39\uDD3F-\uDD59\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE50-\uDE58\uDE60-\uDE9F\uDEC0-\uDEE4\uDEEB-\uDEF6\uDF00-\uDF35\uDF39-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDF99-\uDF9C\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD23\uDD30-\uDD39\uDD40-\uDD65\uDD6E-\uDD85\uDD8E\uDD8F\uDE60-\uDE7E\uDE80-\uDEA9\uDEAD\uDEB0\uDEB1\uDEC2-\uDEC7\uDED0-\uDED8\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF59\uDF70-\uDF81\uDF86-\uDF89\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC47-\uDC4D\uDC52-\uDC6F\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCBB\uDCBC\uDCBE-\uDCC1\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD36-\uDD44\uDD47\uDD50-\uDD72\uDD74-\uDD76\uDD83-\uDDB2\uDDC1-\uDDC8\uDDCD\uDDD0-\uDDDF\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE38-\uDE3D\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA9\uDEB0-\uDEDE\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3-\uDFD5\uDFD7\uDFD8]|\uD805[\uDC00-\uDC34\uDC47-\uDC5B\uDC5D\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4-\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDC1-\uDDDB\uDE00-\uDE2F\uDE41-\uDE44\uDE50-\uDE59\uDE60-\uDE6C\uDE80-\uDEAA\uDEB8\uDEB9\uDEC0-\uDEC9\uDED0-\uDEE3\uDF00-\uDF1A\uDF30-\uDF46]|\uD806[\uDC00-\uDC2B\uDC3B\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDD44-\uDD46\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1-\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE3F-\uDE46\uDE50\uDE5C-\uDE89\uDE9A-\uDEA2\uDEB0-\uDEF8\uDF00-\uDF09\uDFC0-\uDFE1\uDFF0-\uDFF9]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40-\uDC45\uDC50-\uDC6C\uDC70-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDA0-\uDDA9\uDDB0-\uDDDB\uDDE0-\uDDE9\uDEE0-\uDEF2\uDEF7\uDEF8\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDF43-\uDF59\uDFB0\uDFC0-\uDFF1\uDFFF]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC70-\uDC74\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF2]|[\uD80C\uD80E\uD80F\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D\uDD30-\uDD39]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE6E-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDEF5\uDF00-\uDF2F\uDF37-\uDF45\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD79\uDE40-\uDE9A\uDEA0-\uDEB8\uDEBB-\uDED3\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0-\uDFE3\uDFF2-\uDFF6]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9C\uDC9F]|\uD833[\uDC00-\uDCFC\uDD00-\uDEB3\uDEBA-\uDED0\uDEE0-\uDEF0\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDEC0-\uDED3\uDEE0-\uDEF3\uDF00-\uDF56\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE8B]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDD4F\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9\uDEFF]|\uD839[\uDCD0-\uDCEB\uDCF0-\uDCF9\uDDD0-\uDDED\uDDF0-\uDDFA\uDDFF\uDEC0-\uDEDE\uDEE0-\uDEE2\uDEE4\uDEE5\uDEE7-\uDEED\uDEF0-\uDEF4\uDEFE\uDEFF\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD4B\uDD50-\uDD59\uDD5E\uDD5F]|\uD83B[\uDC71-\uDCB4\uDD01-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD00-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED8\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0-\uDCBB\uDCC0\uDCC1\uDCD0-\uDCD8\uDD00-\uDE57\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE8A\uDE8E-\uDEC6\uDEC8\uDECD-\uDEDC\uDEDF-\uDEEA\uDEEF-\uDEF8\uDF00-\uDF92\uDF94-\uDFFA]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79])+$/,u=/[@#$%/~\\]/,c=/(?:[\0-\x1F\^`\x7F-\x9F\xA6\xA8\xA9\xAD-\xB0\xB4\xB8\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0378\u0379\u0380-\u0385\u038B\u038D\u03A2\u0482\u0530\u0557\u0558\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EE\u05F5-\u0605\u060E\u060F\u061C\u06DD\u06DE\u06E9\u06FD\u06FE\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07F6\u07FB\u07FC\u082E\u082F\u083F\u085C\u085D\u085F\u086B-\u086F\u0888\u0890-\u0896\u08E2\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FA\u09FF\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A77-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0AF8\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B54\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B70\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BF3-\u0BF8\u0BFA-\u0BFF\u0C0D\u0C11\u0C29\u0C3A\u0C3B\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5B\u0C5E\u0C5F\u0C64\u0C65\u0C70-\u0C76\u0C7F\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDB\u0CDF\u0CE4\u0CE5\u0CF0\u0CF4-\u0CFF\u0D0D\u0D11\u0D45\u0D49\u0D4F-\u0D53\u0D64\u0D65\u0D79\u0D80\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DE5\u0DF0\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E8B\u0EA4\u0EA6\u0EBE\u0EBF\u0EC5\u0EC7\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0F48\u0F6D-\u0F70\u0F98\u0FBD-\u0FC5\u0FC7-\u0FCF\u0FD5-\u0FD8\u0FDB-\u0FFF\u109E\u109F\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u1390-\u139F\u13F6\u13F7\u13FE\u13FF\u166D\u169D-\u169F\u16F9-\u16FF\u1716-\u171E\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180E\u181A-\u181F\u1879-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191F\u192C-\u192F\u193C-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19FF\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE\u1AAF\u1ADE\u1ADF\u1AEC-\u1AFF\u1B4D\u1B61-\u1B6A\u1B74-\u1B7C\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C8B-\u1C8F\u1CBB\u1CBC\u1CC8-\u1CCF\u1CFB-\u1CFF\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FBD\u1FBF-\u1FC1\u1FC5\u1FCD-\u1FCF\u1FD4\u1FD5\u1FDC-\u1FDF\u1FED-\u1FF1\u1FF5\u1FFD-\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20C2-\u20CF\u20F1-\u2101\u2103-\u2106\u2108\u2109\u2114\u2116\u2117\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u214A\u214C\u214D\u214F\u218A-\u218F\u2195-\u2199\u219C-\u219F\u21A1\u21A2\u21A4\u21A5\u21A7-\u21AD\u21AF-\u21CD\u21D0\u21D1\u21D3\u21D5-\u21F3\u2300-\u2307\u230C-\u231F\u2322-\u2328\u232B-\u237B\u237D-\u239A\u23B4-\u23DB\u23E2-\u245F\u249C-\u24E9\u2500-\u25B6\u25B8-\u25C0\u25C2-\u25F7\u2600-\u266E\u2670-\u2767\u2794-\u27BF\u2800-\u28FF\u2B00-\u2B2F\u2B45\u2B46\u2B4D-\u2BFF\u2CE5-\u2CEA\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E50\u2E51\u2E5E-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E-\u3040\u3097\u3098\u309B\u309C\u3100-\u3104\u3130\u318F-\u3191\u3196-\u319F\u31C0-\u31EF\u3200-\u321F\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA48D-\uA4CF\uA62C-\uA63F\uA6F8-\uA716\uA720\uA721\uA789\uA78A\uA7DD-\uA7F0\uA828-\uA82B\uA82D-\uA82F\uA836\uA837\uA839-\uA83F\uA878-\uA87F\uA8C6-\uA8CD\uA8DA-\uA8DF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA77-\uAA79\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F\uAB5B\uAB6A-\uAB6F\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBB2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFD-\uFDFF\uFE1A-\uFE1F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFF3E\uFF40\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE3\uFFE4\uFFE7\uFFE8\uFFED-\uFFFF]|\uD800[\uDC0C\uDC27\uDC3B\uDC3E\uDC4E\uDC4F\uDC5E-\uDC7F\uDCFB-\uDCFF\uDD03-\uDD06\uDD34-\uDD3F\uDD79-\uDD89\uDD8C-\uDDFC\uDDFE-\uDE7F\uDE9D-\uDE9F\uDED1-\uDEDF\uDEFC-\uDEFF\uDF24-\uDF2C\uDF4B-\uDF4F\uDF7B-\uDF7F\uDF9E\uDFC4-\uDFC7\uDFD6-\uDFFF]|\uD801[\uDC9E\uDC9F\uDCAA-\uDCAF\uDCD4-\uDCD7\uDCFC-\uDCFF\uDD28-\uDD2F\uDD64-\uDD6E\uDD7B\uDD8B\uDD93\uDD96\uDDA2\uDDB2\uDDBA\uDDBD-\uDDBF\uDDF4-\uDDFF\uDF37-\uDF3F\uDF56-\uDF5F\uDF68-\uDF7F\uDF86\uDFB1\uDFBB-\uDFFF]|\uD802[\uDC06\uDC07\uDC09\uDC36\uDC39-\uDC3B\uDC3D\uDC3E\uDC56\uDC77\uDC78\uDC9F-\uDCA6\uDCB0-\uDCDF\uDCF3\uDCF6-\uDCFA\uDD1C-\uDD1E\uDD3A-\uDD3E\uDD5A-\uDD7F\uDDB8-\uDDBB\uDDD0\uDDD1\uDE04\uDE07-\uDE0B\uDE14\uDE18\uDE36\uDE37\uDE3B-\uDE3E\uDE49-\uDE4F\uDE59-\uDE5F\uDEA0-\uDEBF\uDEC8\uDEE7-\uDEEA\uDEF7-\uDEFF\uDF36-\uDF38\uDF56\uDF57\uDF73-\uDF77\uDF92-\uDF98\uDF9D-\uDFA8\uDFB0-\uDFFF]|\uD803[\uDC49-\uDC7F\uDCB3-\uDCBF\uDCF3-\uDCF9\uDD28-\uDD2F\uDD3A-\uDD3F\uDD66-\uDD68\uDD86-\uDD8D\uDD90-\uDE5F\uDE7F\uDEAA\uDEAE\uDEAF\uDEB2-\uDEC1\uDEC8-\uDECF\uDED1-\uDEF9\uDF28-\uDF2F\uDF5A-\uDF6F\uDF8A-\uDFAF\uDFCC-\uDFDF\uDFF7-\uDFFF]|\uD804[\uDC4E-\uDC51\uDC76-\uDC7E\uDCBD\uDCC3-\uDCCF\uDCE9-\uDCEF\uDCFA-\uDCFF\uDD35\uDD48-\uDD4F\uDD77-\uDD7F\uDDE0\uDDF5-\uDDFF\uDE12\uDE42-\uDE7F\uDE87\uDE89\uDE8E\uDE9E\uDEAA-\uDEAF\uDEEB-\uDEEF\uDEFA-\uDEFF\uDF04\uDF0D\uDF0E\uDF11\uDF12\uDF29\uDF31\uDF34\uDF3A\uDF45\uDF46\uDF49\uDF4A\uDF4E\uDF4F\uDF51-\uDF56\uDF58-\uDF5C\uDF64\uDF65\uDF6D-\uDF6F\uDF75-\uDF7F\uDF8A\uDF8C\uDF8D\uDF8F\uDFB6\uDFC1\uDFC3\uDFC4\uDFC6\uDFCB\uDFD6\uDFD9-\uDFE0\uDFE3-\uDFFF]|\uD805[\uDC5C\uDC62-\uDC7F\uDCC8-\uDCCF\uDCDA-\uDD7F\uDDB6\uDDB7\uDDDE-\uDDFF\uDE45-\uDE4F\uDE5A-\uDE5F\uDE6D-\uDE7F\uDEBA-\uDEBF\uDECA-\uDECF\uDEE4-\uDEFF\uDF1B\uDF1C\uDF2C-\uDF2F\uDF3F\uDF47-\uDFFF]|\uD806[\uDC3C-\uDC9F\uDCF3-\uDCFE\uDD07\uDD08\uDD0A\uDD0B\uDD14\uDD17\uDD36\uDD39\uDD3A\uDD47-\uDD4F\uDD5A-\uDD9F\uDDA8\uDDA9\uDDD8\uDDD9\uDDE5-\uDDFF\uDE48-\uDE4F\uDEA3-\uDEAF\uDEF9-\uDEFF\uDF0A-\uDF5F\uDF68-\uDFBF\uDFE2-\uDFEF\uDFFA-\uDFFF]|\uD807[\uDC09\uDC37\uDC46-\uDC4F\uDC6D-\uDC6F\uDC90\uDC91\uDCA8\uDCB7-\uDCFF\uDD07\uDD0A\uDD37-\uDD39\uDD3B\uDD3E\uDD48-\uDD4F\uDD5A-\uDD5F\uDD66\uDD69\uDD8F\uDD92\uDD99-\uDD9F\uDDAA-\uDDAF\uDDDC-\uDDDF\uDDEA-\uDEDF\uDEF9-\uDEFF\uDF11\uDF3B-\uDF3D\uDF5B-\uDFAF\uDFB1-\uDFBF\uDFD5-\uDFDC\uDFE1-\uDFFE]|\uD808[\uDF9A-\uDFFF]|\uD809[\uDC6F\uDC75-\uDC7F\uDD44-\uDFFF]|[\uD80A\uD812-\uD817\uD819\uD824-\uD82A\uD82D\uD82E\uD830-\uD832\uD83D\uD83F\uD87C\uD87D\uD87F\uD88E-\uDB3F\uDB41-\uDBFF][\uDC00-\uDFFF]|\uD80B[\uDC00-\uDF8F\uDFF3-\uDFFF]|\uD80D[\uDC30-\uDC3F\uDC56-\uDC5F]|\uD810[\uDFFB-\uDFFF]|\uD811[\uDE47-\uDFFF]|\uD818[\uDC00-\uDCFF\uDD3A-\uDFFF]|\uD81A[\uDE39-\uDE3F\uDE5F\uDE6A-\uDE6D\uDEBF\uDECA-\uDECF\uDEEE\uDEEF\uDEF6-\uDEFF\uDF3C-\uDF3F\uDF45-\uDF4F\uDF5A\uDF62\uDF78-\uDF7C\uDF90-\uDFFF]|\uD81B[\uDC00-\uDD3F\uDD7A-\uDE3F\uDE9B-\uDE9F\uDEB9\uDEBA\uDED4-\uDEFF\uDF4B-\uDF4E\uDF88-\uDF8E\uDFA0-\uDFDF\uDFE5-\uDFEF\uDFF7-\uDFFF]|\uD823[\uDCD6-\uDCFE\uDD1F-\uDD7F\uDDF3-\uDFFF]|\uD82B[\uDC00-\uDFEF\uDFF4\uDFFC\uDFFF]|\uD82C[\uDD23-\uDD31\uDD33-\uDD4F\uDD53\uDD54\uDD56-\uDD63\uDD68-\uDD6F\uDEFC-\uDFFF]|\uD82F[\uDC6B-\uDC6F\uDC7D-\uDC7F\uDC89-\uDC8F\uDC9A-\uDC9C\uDCA0-\uDFFF]|\uD833[\uDC00-\uDCEF\uDCFA-\uDEEF\uDEF1-\uDEFF\uDF2E\uDF2F\uDF47-\uDFFF]|\uD834[\uDC00-\uDD64\uDD6A-\uDD6C\uDD73-\uDD7A\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDE41\uDE45-\uDEBF\uDED4-\uDEDF\uDEF4-\uDF5F\uDF79-\uDFFF]|\uD835[\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86\uDE8C-\uDE9A\uDEA0\uDEB0-\uDFFF]|\uD837[\uDC00-\uDEFF\uDF1F-\uDF24\uDF2B-\uDFFF]|\uD838[\uDC07\uDC19\uDC1A\uDC22\uDC25\uDC2B-\uDC2F\uDC6E-\uDC8E\uDC90-\uDCFF\uDD2D-\uDD2F\uDD3E\uDD3F\uDD4A-\uDD4D\uDD4F-\uDE8F\uDEAF-\uDEBF\uDEFA-\uDEFE\uDF00-\uDFFF]|\uD839[\uDC00-\uDCCF\uDCFA-\uDDCF\uDDFB-\uDDFE\uDE00-\uDEBF\uDEDF\uDEF6-\uDEFD\uDF00-\uDFDF\uDFE7\uDFEC\uDFEF\uDFFF]|\uD83A[\uDCC5\uDCC6\uDCD7-\uDCFF\uDD4C-\uDD4F\uDD5A-\uDD5D\uDD60-\uDFFF]|\uD83B[\uDC00-\uDC70\uDCAC\uDCB5-\uDD00\uDD2E\uDD3E-\uDDFF\uDE04\uDE20\uDE23\uDE25\uDE26\uDE28\uDE33\uDE38\uDE3A\uDE3C-\uDE41\uDE43-\uDE46\uDE48\uDE4A\uDE4C\uDE50\uDE53\uDE55\uDE56\uDE58\uDE5A\uDE5C\uDE5E\uDE60\uDE63\uDE65\uDE66\uDE6B\uDE73\uDE78\uDE7D\uDE7F\uDE8A\uDE9C-\uDEA0\uDEA4\uDEAA\uDEBC-\uDEEF\uDEF2-\uDFFF]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDFFF]|\uD83E[\uDC00-\uDCCF\uDCD9-\uDFEF\uDFFA-\uDFFF]|\uD869[\uDEE0-\uDEFF]|\uD86E[\uDC1E\uDC1F]|\uD873[\uDEAE\uDEAF]|\uD87A[\uDFE1-\uDFEF]|\uD87B[\uDE5E-\uDFFF]|\uD87E[\uDE1E-\uDFFF]|\uD884[\uDF4B-\uDF4F]|\uD88D[\uDC7A-\uDFFF]|\uDB40[\uDC00-\uDCFF\uDDF0-\uDFFF])/;function d(t){return t==null?!1:t===""?!0:!(t.trim()===""||t.length<e||t.length>l||!s.test(t)||u.test(t)||c.test(t))}i.isMemberLabelStrValid=d}),66);
__d("WAWebMemberLabelJob",["WAJobOrchestratorTypes","WAWebModelStorageUtils","WAWebOrchestratorNonPersistedJob","WAWebSchemaMemberLabel","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return e!=null&&e.lastEditTimestamp>t.lastEditTimestamp}function s(e){var t=e.chatId,r=e.member;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getMemberLabel",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebSchemaMemberLabel").getMemberLabelTable().get(t);if(e!=null)return e.memberLabelMap.get(r)}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function u(e){var t=e.chatId,r=e.member;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("deleteMemberLabel",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebModelStorageUtils").getStorage().lock(["member-label"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],o=yield n.get(t);if(o==null)return!1;if(o.memberLabelMap.delete(r),o.memberLabelMap.size===0)return yield n.remove(t),!0;var a={memberLabelMap:o.memberLabelMap};return yield n.merge(t,a),!0});return function(t){return e.apply(this,arguments)}})())}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function c(t){var r=t.chatId,a=t.member,i=t.memberLabel;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("createOrUpdateMemberLabel",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebModelStorageUtils").getStorage().lock(["member-label"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],o=yield n.get(r);if(o==null){var l={chatId:r,memberLabelMap:new Map([[a,i]])};return yield n.create(l),!0}var s=o.memberLabelMap.get(a);if(e(s,i))return!1;var u={memberLabelMap:o.memberLabelMap.set(a,i)};return yield n.merge(r,u),!0});return function(e){return t.apply(this,arguments)}})())}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function d(e){var t=e.chatId;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getMemberLabelsForGroups",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAWebSchemaMemberLabel").getMemberLabelTable().get(t);if(e!=null)return e.memberLabelMap}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function m(e){var t=e.chatId;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("deleteAllLabelsForGroup",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebModelStorageUtils").getStorage().lock(["member-label"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=yield n.get(t);if(!r)return[];var o=Array.from(r.memberLabelMap.keys());return yield n.remove(t),o});return function(t){return e.apply(this,arguments)}})())}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function p(e){var t=e.chatId,r=e.members;return o("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("deleteMemberLabels",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return o("WAWebModelStorageUtils").getStorage().lock(["member-label"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],o=yield n.get(t);if(o==null)return[];var a=r.filter(function(e){return o.memberLabelMap.delete(e)});return o.memberLabelMap.size===0?yield n.remove(t):yield n.merge(t,{memberLabelMap:o.memberLabelMap}),a});return function(t){return e.apply(this,arguments)}})())}),{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}l.getMemberLabel=s,l.deleteMemberLabel=u,l.createOrUpdateMemberLabel=c,l.getMemberLabelsForGroups=d,l.deleteAllMemberLabelsForGroup=m,l.deleteMemberLabelsForGroup=p}),98);
__d("WAWebHandleMemberLabelChange",["WALogger","WATimeUtils","WAWebBackendApi","WAWebLidMigrationUtils","WAWebMemberLabel.flow","WAWebMemberLabelCommonUtils","WAWebMemberLabelJob","WAWebWidToJid","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,r=t.baseMessage,a=t.memberLabel,i=r.id.remote,l=r.id.participant;if(!i.isGroup()){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[handleMemberLabelChange]: chat is not a group"]))).sendLogs("Failed to handle member label change");return}if(l==null){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[handleMemberLabelChange]: member is null"]))).sendLogs("Failed to handle member label change");return}var p=o("WAWebLidMigrationUtils").toUserLid(l);if(!p){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[handleMemberLabelChange]: member id\u2192lid failed"]))).sendLogs("Failed to handle member label change");return}var _=a.labelTimestamp;if(_==null){o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[handleMemberLabelChange]: timestamp is null"]))).sendLogs("Failed to handle member label change");return}var f=(n=a.label)!=null?n:"";if(!o("WAWebMemberLabelCommonUtils").isMemberLabelStrValid(f)){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[handleMemberLabelChange]: member label is invalid"]))).sendLogs("Failed to handle member label change");return}var g={chatId:o("WAWebWidToJid").widToGroupJid(i),member:o("WAWebWidToJid").userLidtoLidUserJid(p),memberLabel:{label:o("WAWebMemberLabel.flow").castToMemberLabeString(String(f)),lastEditTimestamp:o("WATimeUtils").castToUnixTime(Number(_))}},h=yield o("WAWebMemberLabelJob").createOrUpdateMemberLabel(g);h&&(o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[handleMemberLabelChange]: member label updated successfully"]))),yield o("WAWebBackendApi").frontendSendAndReceive("updateMemberLabelCollection",{updates:[{type:"UPSERT",data:g}]}))}),_.apply(this,arguments)}l.handleMemberLabelChange=p}),98);
__d("WAWebMemberLabelDeviceCapabilityCommon",["WAWebProtobufsDeviceCapabilities.pb","WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(t,n,r,o,a,i,l){function e(e){var t={};e.memberNameTagPrimarySupport!=null&&(t.memberNameTagPrimarySupport=e.memberNameTagPrimarySupport),r("WAWebUserPrefsStore").setUser(o("WAWebUserPrefsKeys").UserPrefs.MemberLabelPrimaryCapability,t,{shouldWriteToIdb:!1})}function s(){var e=r("WAWebUserPrefsStore").getUser(o("WAWebUserPrefsKeys").UserPrefs.MemberLabelPrimaryCapability),t=o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$MemberNameTagPrimarySupport.DISABLED;if(typeof e=="object"&&e!=null&&typeof e.memberNameTagPrimarySupport=="number"){var n;t=(n=o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$MemberNameTagPrimarySupport.cast(e.memberNameTagPrimarySupport))!=null?n:o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$MemberNameTagPrimarySupport.DISABLED}return{memberNameTagPrimarySupport:t}}function u(){return s().memberNameTagPrimarySupport}function c(){var e=u();return e===o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$MemberNameTagPrimarySupport.RECEIVER_ENABLED||e===o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$MemberNameTagPrimarySupport.SENDER_ENABLED}function d(){var e=u();return e===o("WAWebProtobufsDeviceCapabilities.pb").DeviceCapabilities$MemberNameTagPrimarySupport.SENDER_ENABLED}l.saveMemberLabelCapabilityToStorage=e,l.canPrimaryReceiveMemberNameTags=c,l.canPrimarySendMemberNameTags=d}),98);
__d("WAWebMemberLabelGating",["WAWebABProps","WAWebMemberLabelDeviceCapabilityCommon"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("WAWebABProps").getABPropConfigValue("member_name_tag_db_enabled")}function s(){return o("WAWebMemberLabelDeviceCapabilityCommon").canPrimaryReceiveMemberNameTags()&&o("WAWebABProps").getABPropConfigValue("member_name_tag_web_receiver_enabled")}function u(){return o("WAWebMemberLabelDeviceCapabilityCommon").canPrimarySendMemberNameTags()&&o("WAWebABProps").getABPropConfigValue("member_name_tag_web_sender_enabled")}l.isMemberLabelInfraEnabled=e,l.isMemberLabelReceiverEnabled=s,l.isMemberLabelSenderEnabled=u}),98);
__d("WAWebParseProtocolMemberLabelMessageProto",["WAWebHandleMemberLabelChange","WAWebMemberLabelGating","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.protocolMessage;if(r==null)return null;var a=r.memberLabel,i=r.type;return i!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.GROUP_MEMBER_LABEL_CHANGE||a==null?null:o("WAWebMemberLabelGating").isMemberLabelInfraEnabled()?(o("WAWebHandleMemberLabelChange").handleMemberLabelChange({memberLabel:a,baseMessage:t}),{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"member_label"}),contextInfo:null}):{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.PROTOCOL,futureproofSubtype:"member_label"}),contextInfo:null}}l.default=e}),98);
__d("WAWebParseProtocolSharePhoneNumberMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.protocolMessage;if(r!=null&&r.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.SHARE_PHONE_NUMBER){var a=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"share_phone_number"});return{msgData:a,contextInfo:void 0}}}l.default=e}),98);
__d("WAWebStatusGatingUtils",["WAWebABProps","gkx"],(function(t,n,r,o,a,i,l){var e=["\uD83D\uDE0D","\uD83D\uDE02","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE4F","\uD83D\uDC4F","\uD83C\uDF89","\uD83D\uDCAF"],s=new Set(["\uD83D\uDE0D","\uD83D\uDE02","\uD83D\uDE2E","\uD83D\uDE22","\uD83D\uDE4F","\uD83D\uDC4F","\uD83C\uDF89","\uD83D\uDCAF","\uD83D\uDC4D","\u2764","\uD83D\uDE0A","\uD83E\uDD70","\uD83E\uDD29","\uD83D\uDC9A","\uD83E\uDD23","\uD83D\uDE06","\uD83D\uDD25","\uD83D\uDE4C","\uD83E\uDD73","\uD83D\uDE2D","\uD83D\uDE14","\uD83E\uDD7A","\uD83D\uDE32","\uD83E\uDD2F","\uD83D\uDE21","\uD83D\uDE24"]);function u(){try{var t=JSON.parse(o("WAWebABProps").getABPropConfigValue("status_reaction_emojis")),n=t.map(function(e){return String.fromCodePoint(e)}).filter(function(e){return s.has(e)});return n.length===0?e:n}catch(t){return e}}function c(){return o("WAWebABProps").getABPropConfigValue("web_status_likes_receive_enabled")}function d(){return o("WAWebABProps").getABPropConfigValue("status_mentions_receiver")}function m(){return o("WAWebABProps").getABPropConfigValue("status_mentions_group_mention_receiver")}function p(){return o("WAWebABProps").getABPropConfigValue("status_ranking_poster_side_gating_enabled")}function _(){return o("WAWebABProps").getABPropConfigValue("status_future_proofing")}function f(){return o("WAWebABProps").getABPropConfigValue("status_save_to_camera_roll_enabled")}function g(){return o("WAWebABProps").getABPropConfigValue("whatsapp_vpv_logging_enabled")}function h(){return o("WAWebABProps").getABPropConfigValue("status_pog_id_rotation_window_days")}function y(){return r("gkx")("26256")?r("gkx")("10809"):o("WAWebABProps").getABPropConfigValue("web_navigation_bar_updates_tab")}function C(){return!1}l.statusQuickReplyEmojis=u,l.isStatusLikesReceiveEnabled=c,l.isStatusPrivateMentionsReceiveEnabled=d,l.isStatusPrivateGroupMentionsReceivingEnabled=m,l.canCheckStatusRankingPosterGating=p,l.isStatusEmbeddedContentFutureproofingEnabled=_,l.isStatusSaveToDiskEnabled=f,l.isStatusVPVLoggingEnabled=g,l.statusPogIdRotationWindowDays=h,l.isUpdatesTabInNavigationBarEnabled=y,l.isStatusCometVideoPlayerEnabled=C}),98);
__d("WAWebParseProtocolStatusGroupMentionMessageProto",["WAWebMsgType","WAWebStatusGatingUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext;if(!(!o("WAWebStatusGatingUtils").isStatusPrivateMentionsReceiveEnabled()&&!o("WAWebStatusGatingUtils").isStatusPrivateGroupMentionsReceivingEnabled())){var a=n.groupStatusMentionMessage;if(!(a==null||(a==null?void 0:a.message)==null))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.PROTOCOL,futureproofSubtype:"status_group_mention_message"}),contextInfo:null}}}l.default=e}),98);
__d("WAWebParseProtocolStatusMentionMessageProto",["WAWebMsgType","WAWebStatusGatingUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext;if(o("WAWebStatusGatingUtils").isStatusPrivateMentionsReceiveEnabled()){var a=n.statusMentionMessage;if(!(a==null||(a==null?void 0:a.message)==null))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.PROTOCOL,futureproofSubtype:"status_mention_message"}),contextInfo:null}}}l.default=e}),98);
__d("WAWebParseProtocolStatusNotificationMessageProto",["WAWebMsgType","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.associatedChildMessage,i=n.statusNotificationMessage;if(!((a==null||(a==null?void 0:a.message)==null)&&i==null)){var l=i;if(a!=null&&a.message!=null&&i==null){var s;l=(s=a.message)==null?void 0:s.statusNotificationMessage}if(l!=null)return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.STATUS_NOTIFICATION,kind:o("WAWebMsgType").MsgKind.Unknown,viewMode:o("WAWebViewMode.flow").ViewModeType.HIDDEN,futureproofSubtype:"status_notification_message"}),contextInfo:null}}}l.default=e}),98);
__d("WAWebParseRequestPhoneNumberMessageProto",["WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.requestPhoneNumberMessage;if(r!=null){var a=r.contextInfo,i=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.REQUEST_PHONE_NUMBER,kind:o("WAWebMsgType").MsgKind.RequestPhoneNumber});return{msgData:i,contextInfo:a}}}l.default=e}),98);
__d("WAWebUnifiedResponseUtils",["WAWebBotUnifiedResponseGating","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule"],(function(t,n,r,o,a,i,l){var e=(function(){function e(){this.$1=o("WAWebBotUnifiedResponseGating").isUnifiedResponseQPLLoggingEnabled()}var t=e.prototype;return t.markerStart=function(t){this.$1&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.WA_WEB_UNIFIED_RESPONSE_PARSER,{annotations:{int:{data_size_bytes:t}}})},t.markerEnd=function(t){this.$1&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.WA_WEB_UNIFIED_RESPONSE_PARSER,t)},t.markerPoint=function(t){this.$1&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.WA_WEB_UNIFIED_RESPONSE_PARSER,t)},e})();function s(e){return e.primitive?[e.primitive]:e.primitives?e.primitives:[]}function u(e){if(e==null)return!1;var t=!1;for(var n of e.sections){var r=s(n.view_model);for(var o of r)if(o.__typename==="GenAIImaginePrimitive")t=!0;else if(o.__typename==="GenAIMarkdownTextUXPrimitive"){if(o.inline_entities&&o.inline_entities.length>0)return!1}else return!1}return t}l.UnifiedResponseQPLLogger=e,l.isImagineResponse=u}),98);
__d("WAWebRichResponseParseUtils",["WALogger","WAQplTypes","WAWebProtobufsAICommon.pb","WAWebRichResponse.flow","WAWebUnifiedResponseUtils","compactMap","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e){return{type:o("WAWebRichResponse.flow").RichResponseFragmentType.Unknown,fragment:e}}function d(e,t){return{parseState:o("WAWebRichResponse.flow").RichResponseParseState.Unparsed,type:e,fragments:t.map(c)}}function m(e){try{var t=e.fragments,n=e.type,r=p(n),o=t.map(f);return E(r,o)}catch(t){return e}}function p(e){return typeof e=="string"?e:_(e)}function _(e){switch(e){case o("WAWebProtobufsAICommon.pb").AIRichResponseMessageType.AI_RICH_RESPONSE_TYPE_STANDARD:return o("WAWebRichResponse.flow").ParsedRichResponseType.Standard;case o("WAWebProtobufsAICommon.pb").AIRichResponseMessageType.AI_RICH_RESPONSE_TYPE_UNKNOWN:throw r("err")("parseRichResponseType: Unknown rich response type")}}function f(e){if(e.type!==o("WAWebRichResponse.flow").RichResponseFragmentType.Unknown)return e;try{return g(e.fragment)}catch(t){return e}}function g(t){if(t.messageType==null)throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Empty rich response submessage type"]))).tags("wa-web-ai-logging").sendLogs("empty-rich-response-submessage-type",{sampling:.001}),r("err")("getRichResponseFragmentFromSubmessage: Missing message type");switch(t.messageType){case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_TEXT:return b(t);case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_CODE:case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_DYNAMIC:case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_GRID_IMAGE:case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_INLINE_IMAGE:break;case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_TABLE:return v(t);case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_CONTENT_ITEMS:return R(t);case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_UNKNOWN:case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_LATEX:case o("WAWebProtobufsAICommon.pb").AIRichResponseSubMessageType.AI_RICH_RESPONSE_MAP:break}throw r("err")("Unsupported rich response fragment type")}function h(e){return e.type!==o("WAWebRichResponse.flow").RichResponseFragmentType.Unknown}function y(e){return e.type===o("WAWebRichResponse.flow").RichResponseFragmentType.Unknown}function C(e,t){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unknown rich response submessage was of type ",""])),t).tags("wa-web-ai-logging").sendLogs("missing-rich-submessage-"+t+"-type-"+t,{sampling:.001})}function b(e){var t=e.messageText;if(t==null)throw C(e,"text"),r("err")("parseRichResponseTextSubmessage: Missing message text");return{type:o("WAWebRichResponse.flow").RichResponseFragmentType.Text,text:t}}function v(e){var t=e.tableMetadata;if(t==null)throw r("err")("Missing table");var n=t.rows.map(function(e){var t;return{isHeading:(t=e.isHeading)!=null?t:!1,items:e.items}});return{type:o("WAWebRichResponse.flow").RichResponseFragmentType.Table,table:n}}function S(e,t){var n=t.profileIconUrl,o=t.thumbnailUrl,a=t.title,i=t.videoUrl;if(a==null||n==null||o==null||i==null)throw C(e,"Inline Reels - Missing fields"),r("err")("Missing reel item fields");return{title:a,profileIconUrl:n,thumbnailUrl:o,videoUrl:i}}function R(e){var t=e.contentItemsMetadata;if(t==null)throw r("err")("Missing content items");var n=r("compactMap")(t.itemsMetadata,function(t){var n=t.reelItem;if(n!=null)return S(e,n)});if(n==null||n.length===0)throw r("err")("Unsupported ContentItems Type");return{type:o("WAWebRichResponse.flow").RichResponseFragmentType.ContentItems,contentItem:{type:o("WAWebRichResponse.flow").RichResponseContentItemsType.Carousel,items:n}}}function L(e){return e.reduce(function(e,t){return h(t)&&e.push(t),e},[])}function E(e,t){if(t.every(y))throw r("err")("No fragments parsed");return t.every(h)?{parseState:o("WAWebRichResponse.flow").RichResponseParseState.Parsed,type:e,fragments:L(t)}:{parseState:o("WAWebRichResponse.flow").RichResponseParseState.Partial,type:e,fragments:t}}function k(e){if(e==null||e.data==null)return null;var t=e.data.byteLength,n=new(o("WAWebUnifiedResponseUtils")).UnifiedResponseQPLLogger;n.markerStart(t);try{n.markerPoint("decode_start");var a=new TextDecoder("utf-8"),i=a.decode(e.data);n.markerPoint("decode_end"),n.markerPoint("json_parse_start");var l=JSON.parse(i);return n.markerPoint("json_parse_end"),n.markerEnd(o("WAQplTypes").QuickLogActionType.SUCCESS),l}catch(e){throw n.markerEnd(o("WAQplTypes").QuickLogActionType.FAIL),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Error parsing unified response: ",""])),e).tags("wa-web-ai-logging").sendLogs("unified-response-parsing-error"),r("err")("parseUnifiedResponse: Error parsing unified response: "+e)}}l.generateFutureproofRichResponse=d,l.parseRichResponse=m,l.parseUnifiedResponse=k}),98);
__d("WAWebRichResponseValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({INVALID_MESSAGE_TYPE:"rich_response_invalid_name",MISSING_MESSAGE_TYPE:"rich_response_missing_message_type",INVALID_SENDER:"rich_response_invalid_sender"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="RichResponseValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.RichResponseValidationErrorCode=e,l.RichResponseValidationError=s}),98);
__d("WAWebParseRichResponseMessageProto",["WAWebBotGating","WAWebBotUnifiedResponseGating","WAWebMsgType","WAWebRichResponseParseUtils","WAWebRichResponseValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.richResponseMessage;if(r!=null){if(!s(t,r))throw new(o("WAWebRichResponseValidationError")).RichResponseValidationError(o("WAWebRichResponseValidationError").RichResponseValidationErrorCode.INVALID_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var a=r.messageType,i=r.submessages;if(a==null)throw new(o("WAWebRichResponseValidationError")).RichResponseValidationError(o("WAWebRichResponseValidationError").RichResponseValidationErrorCode.MISSING_MESSAGE_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var l=o("WAWebRichResponseParseUtils").generateFutureproofRichResponse(a,i),c=o("WAWebBotGating").isRichStructuredResponseReceiverEnabled()?o("WAWebRichResponseParseUtils").parseRichResponse(l):l,d=u(r,n.messageContextInfo)?o("WAWebRichResponseParseUtils").parseUnifiedResponse(r.unifiedResponse):null;return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.RICH_RESPONSE,kind:o("WAWebMsgType").MsgKind.RichResponse,richResponse:c,unifiedResponse:d}),contextInfo:o("WAWebBotGating").isRichResponseForwardReceivingEnabled()?r.contextInfo:void 0}}}function s(e,t){var n;if(e.from.isBot()||((n=e.id.participant)==null?void 0:n.isBot())===!0)return!0;var r=t.contextInfo;return(r==null?void 0:r.isForwarded)===!0&&o("WAWebBotGating").isRichResponseForwardReceivingEnabled()}function u(e,t){var n;return e.unifiedResponse==null?!1:(t==null||(n=t.botMetadata)==null||(n=n.imagineMetadata)==null?void 0:n.imagineType)!=null&&o("WAWebBotUnifiedResponseGating").isUnifiedResponseImagineReceiverEnabled()||o("WAWebBotUnifiedResponseGating").isUnifiedResponseReceiverEnabled()}l.default=e}),98);
__d("WAWebStickerMimeUtils",[],(function(t,n,r,o,a,i){var e="application/was",l="image/webp";function s(){return new Set([l,e])}i.WhatsAppLottieStickerMimeType=e,i.getValidStickerMimeTypes=s}),66);
__d("WAWebMediaMessageGetValidatedProperties",["$InternalEnum","WALogger","WALongInt","WAWebHandleMsgError","WAWebMsgType","WAWebNewsletterIsNewsletterMsg","WAWebStickerMimeUtils","WAWebURLUtils","WAWebWamEnumE2eFailureReason","WAWebWid","justknobx"],(function(t,n,r,o,a,i,l){var e,s,u=n("$InternalEnum")({MISSING_MEDIA_KEY:"missing_media_key",INVALID_SHA256:"invalid_sha256",INVALID_ENC_SHA256:"invalid_enc_sha256",INVALID_URL:"invalid_url",INVALID_MIME_TYPE:"invalid_mime_type",INVALID_MEDIA_KEY:"invalid_media_key",INVALID_FILE_LENGTH:"invalid_file_length"}),c=(function(e){function t(t,n,r,o){var a,i=String(n)+" for "+t+" message";return a=e.call(this,i,r,o)||this,a.name="MediaMessageValidationError",a}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),d="audio/ogg; codecs=opus",m="audio/mp4",p="audio/mpeg",_="audio/aac",f="audio/amr",g="image/jpeg",h="image/png",y="image/webp",C="video/mp4",b="video/3gpp",v="video/",S="image/";function R(e){return L(e)||e.startsWith(S)}function L(e){return e.startsWith(v)}function E(e){var t,n,r=(t={},t[(n=o("WAWebMsgType")).MSG_TYPE.IMAGE]=new Set([g,h,y]),t[n.MSG_TYPE.STICKER]=o("WAWebStickerMimeUtils").getValidStickerMimeTypes(),t[n.MSG_TYPE.VIDEO]=new Set([C,b]),t[n.MSG_TYPE.AUDIO]=new Set([d,m,p,_,f]),t[n.MSG_TYPE.PTT]=new Set([d,m,p,_,f]),t[n.MSG_TYPE.PTV]=new Set([C,b]),t);return r[e]}function k(e){var t=r("WAWebURLUtils").hostname(e);return t.endsWith(".whatsapp.net")||t==="whatsapp.net"}var I=function(t){return t.id==null};function T(t,n,a,i){var l=t.fileEncSha256,d=t.fileLength,m=t.fileSha256,p=t.mediaKey,_=t.mimetype,f=t.url,g=a==="relay"||a==="outgoing"||r("justknobx")._("585")&&n.from instanceof r("WAWebWid")&&n.from.isNewsletter()&&a==="history";if(!g)return{mediaKey:p,fileSha256:m,fileEncSha256:l,fileLength:o("WALongInt").numberOrThrowIfTooLarge(d!=null?d:0),url:f,mimetype:_};if(I(n))return{mediaKey:p,fileSha256:m,fileEncSha256:l,fileLength:o("WALongInt").numberOrThrowIfTooLarge(d!=null?d:0),url:f,mimetype:_};if(!r("WAWebNewsletterIsNewsletterMsg")({from:n.from,to:n.to})){if(p==null)throw new c(i,u.MISSING_MEDIA_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MEDIA_KEY);if(p.byteLength!==32)throw new c(i,u.INVALID_MEDIA_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MEDIA_KEY);if(l!=null&&l.byteLength!==32)throw new c(i,u.INVALID_ENC_SHA256,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_FILE_SHA256)}if((m==null?void 0:m.byteLength)!==32)throw new c(i,u.INVALID_SHA256,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_FILE_SHA256);if(f!=null&&(!r("WAWebURLUtils").isHttps(f)||!k(f)))throw new c(i,u.INVALID_URL,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MEDIA_URL);if(i===o("WAWebMsgType").MSG_TYPE.STICKER_PACK&&_!=null)throw new c(i,u.INVALID_MIME_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MIME_TYPE);if(_==null&&i!==o("WAWebMsgType").MSG_TYPE.STICKER_PACK)throw new c(i,u.INVALID_MIME_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MIME_TYPE);var h=E(i);if(_!=null&&h!=null&&!h.has(_))throw o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unexpected "," for "," message"])),_,i),new c(i,u.INVALID_MIME_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MIME_TYPE);var y,C=!1;if(i===o("WAWebMsgType").MSG_TYPE.STICKER?d!=null?(y=o("WALongInt").numberOrThrowIfTooLarge(d),C=y>=0):C=!0:i===o("WAWebMsgType").MSG_TYPE.DOCUMENT?d==null?C=!1:(y=o("WALongInt").numberOrThrowIfTooLarge(d),C=y>=0):d==null?C=!1:(y=o("WALongInt").numberOrThrowIfTooLarge(d),C=y>0),!C)throw o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Invalid file length "," with a type "," for "," message"])),d,typeof d,i),new c(i,u.INVALID_FILE_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_FILE_LENGTH,{sendLogs:i===o("WAWebMsgType").MSG_TYPE.IMAGE?.01:!0});return{mediaKey:p,fileSha256:m,fileEncSha256:l,fileLength:y,url:f,mimetype:_}}l.MediaMessageValidationError=c,l.isMediaMimeType=R,l.isVideoMimeType=L,l.getValidMimeTypes=E,l.isWhatsAppSubdomain=k,l.getValidatedMediaMessageProperties=T}),98);
__d("WAWebParseStickerPackMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r,a=e.baseMessage,i=e.messageProtobuf,l=e.msgContext,s=i.stickerPackMessage;if(s==null)return null;var u=s.caption,c=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(s,a,l,o("WAWebMsgType").MSG_TYPE.STICKER_PACK),d=c.fileEncSha256,m=c.fileSha256,p=c.mediaKey,_=c.url,f=[];(t=s.stickers)==null||t.forEach(function(e){f.push({fileName:e.fileName,emojis:e.emojis,isLottie:e.isLottie,mimetype:e.mimetype,isAnimated:e.isAnimated,accessibilityLabel:e.accessibilityLabel})});var g=babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.STICKER_PACK,kind:o("WAWebMsgType").MsgKind.StickerPack,caption:u,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(_),description:s.packDescription,isCaptionByUser:u!=null,filename:s.name,filehash:o("WAWebE2EProtoParserApi").decodeBytes(m),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(d),mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(p),directPath:s.directPath,stickerPackId:s.stickerPackId,thumbnailDirectPath:s.thumbnailDirectPath,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(s.thumbnailSha256),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(s.thumbnailEncSha256),mediaKeyTimestamp:s.mediaKeyTimestamp!=null?o("WALongInt").numberOrThrowIfTooLarge(s.mediaKeyTimestamp):o("WATimeUtils").unixTime(),stickers:f,stickerPackPublisher:s.publisher,stickerPackSize:o("WALongInt").numberOrThrowIfTooLarge((n=s.stickerPackSize)!=null?n:0),trayIconFileName:s.trayIconFileName,size:o("WALongInt").numberOrThrowIfTooLarge((r=s.fileLength)!=null?r:0)});return{msgData:g,contextInfo:null}}l.default=e}),98);
__d("WAWebParseVcardMessageProto",["WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.contactMessage;if(r!=null){var a=r.contextInfo,i=r.displayName,l=r.vcard,s=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.VCARD,kind:o("WAWebMsgType").MsgKind.Vcard,body:l,vcardFormattedName:i});return{msgData:s,contextInfo:a}}}l.default=e}),98);
__d("WAWebPollsParsePollCreationMessageProto",["WANullthrows","WAWebMessageSecretErrorsWamEvent","WAWebMsgType","WAWebNewsletterIsNewsletterMsg","WAWebPollCreationUtils","WAWebPollOptionHashUtils","WAWebPollsGatingUtils","WAWebPollsValidationError","WAWebWamEnumE2eFailureReason","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType","compactMap","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){function e(e){var t,n,a,i=e.baseMessage,l=e.messageProtobuf,s=e.msgContext,u=l.pollCreationMessage,c=l.pollCreationMessageV2,d=l.pollCreationMessageV3,m=l.pollCreationMessageV5,p=(t=(n=u!=null?u:c)!=null?n:d)!=null?t:m,_=r("WAWebNewsletterIsNewsletterMsg")({from:i.from,to:i.to}),f=!_;if(p==null||p===c&&!o("WAWebPollsGatingUtils").isPollsReceivingEnabledInCags()||p===d&&!o("WAWebPollsGatingUtils").isSingleOptionPollsReceivingEnabled())return null;var g=p.contextInfo,h=p.correctAnswer,y=p.name,C=p.options,b=p.selectableOptionsCount,v=o("WAWebPollCreationUtils").getPollContentTypeFromE2EValue(p.pollContentType),S=o("WAWebPollCreationUtils").getPollTypeFromE2EValue(p.pollType),R=v===o("WAWebPollCreationUtils").PollContentType.IMAGE;if(R&&!o("WAWebPollsGatingUtils").isPhotoPollReceiverEnabled(i))return{msgData:babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.POLL_CREATION}),contextInfo:g};if(y==null)throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(y.length===0||y.length>o("WAWebPollsGatingUtils").getMaxPollNameLengthForIncomingMessages())throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(s==="quoted"||s==="history_quoted"){var L=babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.POLL_CREATION,kind:o("WAWebMsgType").MsgKind.PollCreation,pollName:y,pollOptions:null,pollSelectableOptionsCount:null,pollContentType:v,pollType:S});return{msgData:L,contextInfo:g}}var E=(a=l.messageContextInfo)==null?void 0:a.messageSecret;if(f&&E==null)throw new(o("WAWebMessageSecretErrorsWamEvent")).MessageSecretErrorsWamEvent({messageSecretAllowedList:o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.MISSING_MESSAGE_SECRET}).commit(),new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_MESSAGE_SECRET,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET);if(f&&(E==null?void 0:E.byteLength)!==32)throw new(o("WAWebMessageSecretErrorsWamEvent")).MessageSecretErrorsWamEvent({messageSecretAllowedList:o("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:o("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.WRONG_LENGTH}).commit(),new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_MESSAGE_SECRET,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);if(C.length===0)throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_OPTIONS,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b==null)throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_SELECTABLE_OPTIONS_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var k=new Set,I=new Set,T,D=r("compactMap")(C,function(e){var t=e.optionHash,n=e.optionName;if(n==null||n.length===0||n.length>o("WAWebPollsGatingUtils").getMaxPollOptionLengthForIncomingMessages())throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_OPTION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(k.has(n))throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.DUPLICATE_OPTIONS,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(R){if(r("isStringNullOrEmpty")(t))throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_OPTION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(I.has(t))throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.DUPLICATE_OPTIONS,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);I.add(t)}var a=k.size;return k.add(n),(h==null?void 0:h.optionName)===n&&(T=a),R?{name:n,hash:o("WAWebPollOptionHashUtils").createOptionHashHexFromString(r("WANullthrows")(t)),localId:a}:{name:n,localId:a}});if(D.length<2||D.length>o("WAWebPollsGatingUtils").getMaxPollOptionCount())throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_OPTIONS_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b<0||b>D.length)throw new(o("WAWebPollsValidationError")).PollCreationValidationError(o("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_SELECTABLE_OPTIONS_COUNT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var x=babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.POLL_CREATION,kind:o("WAWebMsgType").MsgKind.PollCreation,pollName:y,pollOptions:D,pollSelectableOptionsCount:b,pollContentType:v,pollType:S,correctOptionIndex:T});return{msgData:x,contextInfo:g}}l.default=e}),98);
__d("WAWebAudioMessageProtoUtils",["WALogger","WAWebE2EProtoParserApi"],(function(t,n,r,o,a,i,l){var e,s,u;function c(t,n){if(o("WAWebE2EProtoParserApi").shouldLogE2eProtoValidation(t,n)){var r=t.type;n.seconds==null?o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["seconds is missing from msg type ",""])),r).sendLogs(r+"-message-missing-seconds"):n.seconds===0&&o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["seconds is 0 in msg type ",""])),r).sendLogs(r+"-message-incorrect-seconds"),n.fileLength==null&&o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["fileLength is missing from msg type ",""])),r).sendLogs(r+"-message-missing-fileLength")}}function d(e){return e.byteLength>=64&&e.byteLength<=192}l.validateRequiredAudioProperties=c,l.validateWaveform=d}),98);
__d("WAWebPttParseAudioMessageProto",["WALongInt","WATimeUtils","WAWebAudioMessageProtoUtils","WAWebE2EProtoParserApi","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.audioMessage;if(a!=null){var i=a.ptt;if(i!==!0){var l=a.contextInfo,s=a.backgroundArgb,u=a.directPath,c=a.mediaKeyTimestamp,d=a.mimetype,m=a.seconds,p=a.streamingSidecar,_=a.viewOnce,f=a.waveform,g=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(a,t,r,o("WAWebMsgType").MSG_TYPE.AUDIO),h=g.fileEncSha256,y=g.fileLength,C=g.fileSha256,b=g.mediaKey,v=g.url,S=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.AUDIO,kind:o("WAWebMsgType").MsgKind.Audio,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(v),directPath:u,mimetype:d,filehash:o("WAWebE2EProtoParserApi").decodeBytes(C),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(h),size:y,duration:""+(m||0),mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(b),mediaKeyTimestamp:c!=null?o("WALongInt").numberOrThrowIfTooLarge(c):o("WATimeUtils").unixTime(),streamingSidecar:p,waveform:f&&o("WAWebAudioMessageProtoUtils").validateWaveform(f)?new Uint8Array(f):void 0,backgroundColor:s,isViewOnce:_===!0});return o("WAWebE2EProtoParserApi").validateRequiredMediaProperties(S,a),o("WAWebAudioMessageProtoUtils").validateRequiredAudioProperties(S,a),{msgData:S,contextInfo:l}}}}l.default=e}),98);
__d("WAWebPttParsePttMessageProto",["WALongInt","WATimeUtils","WAWebAudioMessageProtoUtils","WAWebE2EProtoParserApi","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.audioMessage;if(a!=null){var i=a.ptt;if(i===!0){var l=a.contextInfo,s=a.backgroundArgb,u=a.directPath,c=a.mediaKeyTimestamp,d=a.mimetype,m=a.seconds,p=a.streamingSidecar,_=a.viewOnce,f=a.waveform,g=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(a,t,r,o("WAWebMsgType").MSG_TYPE.PTT),h=g.fileEncSha256,y=g.fileLength,C=g.fileSha256,b=g.mediaKey,v=g.url,S=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.PTT,kind:o("WAWebMsgType").MsgKind.Ptt,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(v),directPath:u,mimetype:d,filehash:o("WAWebE2EProtoParserApi").decodeBytes(C),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(h),size:y,duration:""+(m||0),mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(b),mediaKeyTimestamp:c!=null?o("WALongInt").numberOrThrowIfTooLarge(c):o("WATimeUtils").unixTime(),streamingSidecar:p,waveform:f&&o("WAWebAudioMessageProtoUtils").validateWaveform(f)?new Uint8Array(f):void 0,backgroundColor:s,isViewOnce:_===!0});return o("WAWebE2EProtoParserApi").validateRequiredMediaProperties(S,a),o("WAWebAudioMessageProtoUtils").validateRequiredAudioProperties(S,a),{msgData:S,contextInfo:l}}}}l.default=e}),98);
__d("WABase64Sanitize",["WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){if(t==null)return null;var n=t.replace(/\s+$/,"");return t!==n&&Math.random()<1e-5&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["base64 sanitized due to extra whitespace"]))).sendLogs("media-key-sanitize"),n}l.default=s}),98);
__d("WAWebStickersParseStickerMessageProto",["WABase64Sanitize","WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,a=e.messageProtobuf,i=e.msgContext,l=a==null?void 0:a.lottieStickerMessage,s=l==null||(t=l.message)==null?void 0:t.stickerMessage,u=a==null?void 0:a.stickerMessage;if(s!=null&&(u=s),u!=null){var c=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(u,n,i,o("WAWebMsgType").MSG_TYPE.STICKER),d=c.fileEncSha256,m=c.fileLength,p=c.fileSha256,_=c.mediaKey,f=c.url,g=babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.STICKER,kind:o("WAWebMsgType").MsgKind.Sticker,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(f),directPath:u.directPath||"",mimetype:u.mimetype||"",filehash:o("WAWebE2EProtoParserApi").decodeBytes(p),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(d),mediaKey:r("WABase64Sanitize")(o("WAWebE2EProtoParserApi").decodeBytes(_)),mediaKeyTimestamp:u.mediaKeyTimestamp!=null?o("WALongInt").numberOrThrowIfTooLarge(u.mediaKeyTimestamp):o("WATimeUtils").unixTime(),size:m,height:u.height||0,width:u.width||0,firstFrameLength:u.firstFrameLength,firstFrameSidecar:u.firstFrameSidecar,isAnimated:u.isAnimated,isLottie:u.isLottie,stickerSentTs:o("WALongInt").maybeNumberOrThrowIfTooLarge(u.stickerSentTs),isAvatar:u.isAvatar});return o("WAWebE2EProtoParserApi").validateRequiredMediaProperties(g,u),{msgData:g,contextInfo:u.contextInfo}}}l.default=e}),98);
__d("WAWebMessagePluginParseProtobufRegistry",["WAWebAlbumsParseAlbumMessageProto","WAWebEventsParseEventCreationMessageProto","WAWebEventsParseEventEditEncryptedMessageProto","WAWebEventsParseEventResponseMessageProto","WAWebParseBizContentPlaceholderProto","WAWebParseBotFeedbackProtocolMessageProto","WAWebParseBotMemuOnboardingMessageProto","WAWebParseBotRequestWelcomeMessageProto","WAWebParseButtonsResponseMessageProto","WAWebParseCancelPaymentMessageProto","WAWebParseChatMessageProto","WAWebParseDeclinePaymentMessageProto","WAWebParseDocumentMessageProto","WAWebParseEncCommentMessageProto","WAWebParseEphemeralSyncResponseMessageProto","WAWebParseExtendedTextUrlChatMessageProto","WAWebParseGroupInviteMessageProto","WAWebParseHsmMessageProto","WAWebParseImageMessageProto","WAWebParseInteractiveMessageProto","WAWebParseInteractiveResponseMessageProto","WAWebParseKeepInChatMessageProto","WAWebParseListMessageProto","WAWebParseListResponseMessageProto","WAWebParseLocationMessageProto","WAWebParseMessageEditEncryptedMessageProto","WAWebParseMessageHistoryBundleProto","WAWebParseMessageHistoryNoticeProto","WAWebParseMultiVcardMessageProto","WAWebParseNativeFlowButtonsMessageProto","WAWebParseNewsletterAdminInviteMessageProto","WAWebParseNewsletterFollowerInviteMessageProto","WAWebParseOrderMessageProto","WAWebParsePaymentInviteMessageProto","WAWebParsePinMessageProto","WAWebParsePollResultSnapshotMessageProto","WAWebParseProductMessageProto","WAWebParseProtocolAdminRevokeMessageProto","WAWebParseProtocolEphemeralSettingMessageProto","WAWebParseProtocolHistorySyncNotificationMessageProto","WAWebParseProtocolLimitSharingMessageProto","WAWebParseProtocolMemberLabelMessageProto","WAWebParseProtocolMessageEditProto","WAWebParseProtocolSenderRevokeMessageProto","WAWebParseProtocolSharePhoneNumberMessageProto","WAWebParseProtocolStatusGroupMentionMessageProto","WAWebParseProtocolStatusMentionMessageProto","WAWebParseProtocolStatusNotificationMessageProto","WAWebParseRequestPaymentMessageProto","WAWebParseRequestPhoneNumberMessageProto","WAWebParseRichResponseMessageProto","WAWebParseSendPaymentMessageProto","WAWebParseStickerPackMessageProto","WAWebParseTemplateButtonReplyMessageProto","WAWebParseVcardMessageProto","WAWebParseVideoMessageProto","WAWebPollsParsePollCreationMessageProto","WAWebPollsParsePollVoteMessageProto","WAWebPttParseAudioMessageProto","WAWebPttParsePttMessageProto","WAWebPtvParsePtvMessageProto","WAWebReactionsParseReactionEncMessageProto","WAWebReactionsParseReactionMessageProto","WAWebStickersParseStickerMessageProto"],(function(t,n,r,o,a,i,l){var e=[r("WAWebAlbumsParseAlbumMessageProto"),r("WAWebEventsParseEventCreationMessageProto"),r("WAWebEventsParseEventEditEncryptedMessageProto"),r("WAWebEventsParseEventResponseMessageProto"),r("WAWebParseBizContentPlaceholderProto"),r("WAWebParseBotFeedbackProtocolMessageProto"),r("WAWebParseBotMemuOnboardingMessageProto"),r("WAWebParseBotRequestWelcomeMessageProto"),r("WAWebParseButtonsResponseMessageProto"),r("WAWebParseCancelPaymentMessageProto"),r("WAWebParseChatMessageProto"),r("WAWebParseDeclinePaymentMessageProto"),r("WAWebParseDocumentMessageProto"),r("WAWebParseEncCommentMessageProto"),r("WAWebParseEphemeralSyncResponseMessageProto"),r("WAWebParseExtendedTextUrlChatMessageProto"),r("WAWebParseGroupInviteMessageProto"),r("WAWebParseHsmMessageProto"),r("WAWebParseImageMessageProto"),r("WAWebParseInteractiveMessageProto"),r("WAWebParseInteractiveResponseMessageProto"),r("WAWebParseKeepInChatMessageProto"),r("WAWebParseListMessageProto"),r("WAWebParseListResponseMessageProto"),r("WAWebParseLocationMessageProto"),r("WAWebParseMessageEditEncryptedMessageProto"),r("WAWebParseMessageHistoryBundleProto"),r("WAWebParseMessageHistoryNoticeProto"),r("WAWebParseMultiVcardMessageProto"),r("WAWebParseNativeFlowButtonsMessageProto"),r("WAWebParseNewsletterAdminInviteMessageProto"),r("WAWebParseNewsletterFollowerInviteMessageProto"),r("WAWebParseOrderMessageProto"),r("WAWebParsePaymentInviteMessageProto"),r("WAWebParsePinMessageProto"),r("WAWebParsePollResultSnapshotMessageProto"),r("WAWebParseProductMessageProto"),r("WAWebParseProtocolAdminRevokeMessageProto"),r("WAWebParseProtocolEphemeralSettingMessageProto"),r("WAWebParseProtocolHistorySyncNotificationMessageProto"),r("WAWebParseProtocolLimitSharingMessageProto"),r("WAWebParseProtocolMemberLabelMessageProto"),r("WAWebParseProtocolMessageEditProto"),r("WAWebParseProtocolSenderRevokeMessageProto"),r("WAWebParseProtocolSharePhoneNumberMessageProto"),r("WAWebParseProtocolStatusGroupMentionMessageProto"),r("WAWebParseProtocolStatusMentionMessageProto"),r("WAWebParseProtocolStatusNotificationMessageProto"),r("WAWebParseRequestPaymentMessageProto"),r("WAWebParseRequestPhoneNumberMessageProto"),r("WAWebParseRichResponseMessageProto"),r("WAWebParseSendPaymentMessageProto"),r("WAWebParseStickerPackMessageProto"),r("WAWebParseTemplateButtonReplyMessageProto"),r("WAWebParseVcardMessageProto"),r("WAWebParseVideoMessageProto"),r("WAWebPollsParsePollCreationMessageProto"),r("WAWebPollsParsePollVoteMessageProto"),r("WAWebPttParseAudioMessageProto"),r("WAWebPttParsePttMessageProto"),r("WAWebPtvParsePtvMessageProto"),r("WAWebReactionsParseReactionEncMessageProto"),r("WAWebReactionsParseReactionMessageProto"),r("WAWebStickersParseStickerMessageProto")];l.default=e}),98);
__d("WAWebMessagePluginProcessAsAddonRegistry",["WAWebAddonCommentMsgProcessor","WAWebEventEditAddonMessageProcessor","WAWebEventResponseAddonMessageProcessor","WAWebMessageEditAddonMessageProcessor","WAWebPinAddonMessageProcessor","WAWebPollVoteAddonMessageProcessor","WAWebReactionAddonMessageProcessor"],(function(t,n,r,o,a,i,l){var e=[{type:"album",processor:null},{type:"audio",processor:null},{type:"biz_content_placeholder",processor:null},{type:"buttons_response",processor:null},{type:"chat",processor:null},{type:"chat",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"comment",processor:r("WAWebAddonCommentMsgProcessor")},{type:"debug_placeholder",processor:null},{type:"document",processor:null},{type:"event_creation",processor:null},{type:"event_edit_encrypted",processor:r("WAWebEventEditAddonMessageProcessor")},{type:"event_response",processor:r("WAWebEventResponseAddonMessageProcessor")},{type:"group-history",processor:null},{type:"groups_v4_invite",processor:null},{type:"hsm",processor:null},{type:"image",processor:null},{type:"interactive",processor:null},{type:"interactive_response",processor:null},{type:"keep_in_chat",processor:null},{type:"list",processor:null},{type:"list_response",processor:null},{type:"loading_media",processor:null},{type:"loading_media",processor:null},{type:"location",processor:null},{type:"message_edit_encrypted",processor:r("WAWebMessageEditAddonMessageProcessor")},{type:"message_history_notice",processor:null},{type:"multi_vcard",processor:null},{type:"native_flow",processor:null},{type:"newsletter_admin_invite",processor:null},{type:"newsletter_follower_invite",processor:null},{type:"newsletter_question_response",processor:null},{type:"notification_template",processor:null},{type:"order",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"pin_message",processor:r("WAWebPinAddonMessageProcessor")},{type:"pinned_message",processor:null},{type:"poll_creation",processor:null},{type:"poll_result_snapshot",processor:null},{type:"poll_update",processor:r("WAWebPollVoteAddonMessageProcessor")},{type:"product",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"ptt",processor:null},{type:"ptv",processor:null},{type:"reaction",processor:r("WAWebReactionAddonMessageProcessor")},{type:"reaction_enc",processor:r("WAWebReactionAddonMessageProcessor")},{type:"request_phone_number",processor:null},{type:"revoked",processor:null},{type:"revoked",processor:null},{type:"rich_response",processor:null},{type:"status_notification",processor:null},{type:"sticker",processor:null},{type:"sticker-pack",processor:null},{type:"template_button_reply",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"vcard",processor:null},{type:"video",processor:null}];l.default=e}),98);
__d("WAWebMultipleMessageParserPluginParseProtobuf",["WAWebMultipleMessageParserPluginParseProtobufRegistry"],(function(t,n,r,o,a,i,l){function e(e){var t=[],n;for(var o of r("WAWebMultipleMessageParserPluginParseProtobufRegistry")){var a=o(e);if(a!=null){var i;t.push(a.msgData.type+":"+((i=a.msgData.subtype)!=null?i:"null")),n==null&&(n=a)}}return{result:n,pluginsMatched:t}}l.parseProtobufWithMultipleMessageParserPlugin=e}),98);
__d("WAWebMultipleMessageParserPluginParseProtobufRegistry",["WAWebParseHistorySyncProtocolMessageEditProto","WAWebParseNonNFMButtonsMessageProto","WAWebParseTemplateMessageProto"],(function(t,n,r,o,a,i,l){var e=[r("WAWebParseHistorySyncProtocolMessageEditProto"),r("WAWebParseNonNFMButtonsMessageProto"),r("WAWebParseTemplateMessageProto")];l.default=e}),98);
__d("WAWebButtonsMessageProtoUtils",["WAWebE2EProtoUtils","WAWebMsgType","WAWebParseDocumentMessageProto","WAWebParseImageMessageProto","WAWebParseLocationMessageProto","WAWebParseVideoMessageProto","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.buttonsMessage,a=e.msgContext,i=n.contentText,l=n.documentMessage,s=n.footerText,u=n.headerType,c=n.imageMessage,d=n.locationMessage,m=n.text,p=n.videoMessage,_=function(){var e=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.CHAT,kind:o("WAWebMsgType").MsgKind.Chat,title:m==null?t.title:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(m),body:i==null?t.body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(i)});if(c){var n,s;return(n=(s=r("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:c},baseMessage:t,msgContext:a}))==null?void 0:s.msgData)!=null?n:e}if(l){var u,_;return(u=(_=r("WAWebParseDocumentMessageProto")({messageProtobuf:{documentMessage:l},baseMessage:t,msgContext:a}))==null?void 0:_.msgData)!=null?u:e}if(d){var f,g;return(f=(g=r("WAWebParseLocationMessageProto")({messageProtobuf:{locationMessage:babelHelpers.extends({},d,{name:void 0,address:void 0})},baseMessage:t,msgContext:a}))==null?void 0:g.msgData)!=null?f:e}if(p){var h,y;return(h=(y=r("WAWebParseVideoMessageProto")({messageProtobuf:{videoMessage:p},baseMessage:t,msgContext:a}))==null?void 0:y.msgData)!=null?h:e}return e},f=_();return babelHelpers.extends({},f,{headerType:u,caption:i!=null?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(i):f.caption,footer:s!=null?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(s):f.footer})}function s(e,t,n){var r=e.documentMessage,a=e.imageMessage,i=e.locationMessage,l=e.videoMessage;if(t.isForwarded&&(r||a||i||l))return e;var s={buttons:t.isForwarded===!0?void 0:t.dynamicReplyButtons,footerText:t.footer,contextInfo:n};return r?(s.documentMessage=r,s.headerType=o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.DOCUMENT,s.contentText=t.caption):a?(s.imageMessage=a,s.headerType=o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.IMAGE,s.contentText=t.caption):i?(s.locationMessage=i,s.headerType=o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.LOCATION,s.contentText=t.caption):l?(s.videoMessage=l,s.headerType=o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.VIDEO,s.contentText=t.caption):t.title?(s.text=t.title,s.headerType=o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.TEXT,s.contentText=t.body):(s.contentText=t.body,s.headerType=o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.EMPTY),{buttonsMessage:s}}l.parseButtonsMessageProto=e,l.createDynamicReplyButtonsMessage=s}),98);
__d("WAWebBotModeSelectionTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({Default:0,ThinkHard:1});i.BotUserSelectionMode=e}),66);
__d("WAWebGlobalBotModeSelection",["WALogger","WAWebBotGating","WAWebBotModeSelectionTypes","WAWebUserPrefsStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h="WAWebGlobalBotModeSelection",y=[o("WAWebBotModeSelectionTypes").BotUserSelectionMode.Default],C=y,b=null;function v(t){return t===o("WAWebBotModeSelectionTypes").BotUserSelectionMode.Default?o("WAWebBotModeSelectionTypes").BotUserSelectionMode.Default:t===o("WAWebBotModeSelectionTypes").BotUserSelectionMode.ThinkHard?o("WAWebBotModeSelectionTypes").BotUserSelectionMode.ThinkHard:(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getGlobalBotModeSelection: Skipping unknown mode value ",""])),t),null)}var S=new Set;function R(){S.forEach(function(e){return e()})}function L(e){return S.add(e),function(){S.delete(e)}}function E(e){try{var t=e.map(function(e){return e}),n=JSON.stringify(t);r("WAWebUserPrefsStore").setUser(h,n),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["setGlobalBotModeSelection: Saved global bot mode selection: ",""])),e.join(", "));var a=e.filter(Boolean);b=n,C=a.length>0?a:y,R()}catch(e){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["setGlobalBotModeSelection: Failed to set global bot mode selection: ",""])),e)}}function k(){if(!o("WAWebBotGating").isAiModeSelectorMessagingEnabled())return y;try{var e=r("WAWebUserPrefsStore").getUser(h);if(e===b)return C;if(e==null||e==="")return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["getGlobalBotModeSelection: No saved mode found, using default"]))),b=e,C=y,y;if(typeof e!="string")return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["getGlobalBotModeSelection: Invalid saved mode type, using default"]))),b=null,C=y,y;var t=JSON.parse(e);if(!Array.isArray(t)||t.length===0)return o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getGlobalBotModeSelection: Invalid saved mode format, using default"]))),b=e,C=y,y;var n=t.map(v).filter(Boolean);return n.length===0?(o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["getGlobalBotModeSelection: No valid modes found, using default"]))),b=e,C=y,y):(b=e,C=n,n)}catch(e){return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["getGlobalBotModeSelection: Failed to get global bot mode selection: ",""])),e),y}}function I(){try{r("WAWebUserPrefsStore").setUser(h,null),o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["resetGlobalBotModeSelection: Reset global bot mode selection"]))),b=null,C=y,R()}catch(e){o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["resetGlobalBotModeSelection: Failed to reset global bot mode selection: ",""])),e)}}l.subscribeToGlobalBotModeChanges=L,l.setGlobalBotModeSelection=E,l.getGlobalBotModeSelection=k,l.resetGlobalBotModeSelection=I}),98);
__d("WAWebBotModeSelectionProtoUtils",["WALogger","WAWebBotGating","WAWebBotModeSelectionTypes","WAWebBotUtils","WAWebGlobalBotModeSelection","WAWebProtobufsAICommon.pb"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e){return e===o("WAWebProtobufsAICommon.pb").BotModeSelectionMetadata$BotUserSelectionMode.DEFAULT_MODE?o("WAWebBotModeSelectionTypes").BotUserSelectionMode.Default:e===o("WAWebProtobufsAICommon.pb").BotModeSelectionMetadata$BotUserSelectionMode.THINK_HARD_MODE?o("WAWebBotModeSelectionTypes").BotUserSelectionMode.ThinkHard:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function m(e){return e===o("WAWebBotModeSelectionTypes").BotUserSelectionMode.Default?o("WAWebProtobufsAICommon.pb").BotModeSelectionMetadata$BotUserSelectionMode.DEFAULT_MODE:e===o("WAWebBotModeSelectionTypes").BotUserSelectionMode.ThinkHard?o("WAWebProtobufsAICommon.pb").BotModeSelectionMetadata$BotUserSelectionMode.THINK_HARD_MODE:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function p(e){var t=[];for(var n of e){var r=d(n);t.push(r)}return t}function _(t,n){var r,a,i=(r=t.id)==null?void 0:r.remote;if(!(i==null||!o("WAWebBotUtils").isMetaAiBot(i))){var l=n==null||(a=n.botMetadata)==null?void 0:a.botModeSelectionMetadata;if(l==null){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseBotModeSelectionMetadataProto: No botModeSelectionMetadata found, retaining local mode"])));return}var m=l.mode;if(m==null||m.length===0){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseBotModeSelectionMetadataProto: Empty mode array, retaining local mode"])));return}if(!o("WAWebBotGating").isAiModeSelectorMessagingEnabled()){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["parseBotModeSelectionMetadataProto: AI mode selector messaging disabled, skipping bot mode selection parsing"])));return}var p=m.map(d);t.botModeSelection=p,o("WAWebGlobalBotModeSelection").setGlobalBotModeSelection(p),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["parseBotModeSelectionMetadataProto: Parsed bot mode selection: ",""])),p.join(", "))}}l.getBotSelectionModeFromProto=d,l.getProtoModeFromBotSelectionMode=m,l.convertProtoModeArrayToInternal=p,l.parseBotModeSelectionMetadataProto=_}),98);
__d("WAWebE2EProtoParserForCtwaContext",["WAWebABProps","WAWebBizGatingUtils","WAWebCtwaAGMUtils","WAWebE2EProtoParserApi","WAWebLinkify","isEmptyObject"],(function(t,n,r,o,a,i,l){function e(e,t){if(!(t.externalAdReply==null&&!o("WAWebABProps").getABPropConfigValue("wa_web_parse_always_show_ad_attribution"))){var n={},a=t.alwaysShowAdAttribution,i=t.conversionData,l=t.conversionSource,s=t.ctwaPayload,u=t.ctwaSignals;a!=null&&(n.alwaysShowAdAttribution=a),l!=null&&(n.conversionSource=l),u!=null&&s!=null&&o("WAWebBizGatingUtils").isSignalDecouplingEnabled()?n.conversionData=s:i!=null&&(n.conversionData=i),u!=null&&o("WAWebBizGatingUtils").isSignalDecouplingEnabled()&&(n.ctwaSignals=u);var c=t.externalAdReply;if(c!=null){n.sourceUrl=c.sourceUrl,n.description=c.body,n.title=c.title,c.thumbnail!=null&&(n.thumbnail=o("WAWebE2EProtoParserApi").decodeBytes(c.thumbnail)),n.thumbnailUrl=c.thumbnailUrl,n.mediaType=c.mediaType,n.mediaUrl=c.mediaUrl;var d=o("WAWebLinkify").findLink(c.sourceUrl||"",!1,e.from);d!=null&&d.suspiciousCharacters!=null&&d.suspiciousCharacters.size!=null&&(n.isSuspiciousLink=d.suspiciousCharacters.size>0),c.adContextPreviewDismissed!=null&&o("WAWebBizGatingUtils").isHideAdContextIfSoftDismissed()&&(n.adContextPreviewDismissed=c.adContextPreviewDismissed),c.sourceApp!=null&&(n.sourceApp=c.sourceApp);var m=o("WAWebCtwaAGMUtils").isWamoAGMIntegrationEnabled(c.sourceApp);m&&(c.greetingMessageBody!=null&&(n.greetingMessageBody=c.greetingMessageBody),c.automatedGreetingMessageShown!=null&&(n.automatedGreetingMessageShown=c.automatedGreetingMessageShown),c.ctaPayload!=null&&(n.ctaPayload=c.ctaPayload),c.sourceId!=null&&(n.sourceId=c.sourceId),c.originalImageUrl!=null&&(n.originalImageUrl=c.originalImageUrl))}r("isEmptyObject")(n)||(e.ctwaContext=n)}}l.parseCtwaContextProto=e}),98);
__d("WAWebViewOnceGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("view_once_sp_receiver")}function s(){return o("WAWebABProps").getABPropConfigValue("enable_soox_message_receiving")}function u(){return o("WAWebABProps").getABPropConfigValue("enable_soox_message_sending")}l.isViewOnceSunsetEnabled=e,l.isReceivingViewOnceV2Enabled=s,l.isSendingViewOnceV2Enabled=u}),98);
__d("WAWebFutureproofProtoUtils",["WAWebBotGating","WAWebMessageAssociationGatingUtils","WAWebViewOnceGatingUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.associatedChildMessage,n=e.botForwardedMessage,r=e.botInvokeMessage,a=e.documentWithCaptionMessage,i=e.editedMessage,l=e.ephemeralMessage,s=e.groupMentionedMessage,u=e.pollCreationMessageV4,c=e.pollCreationOptionImageMessage,d=e.questionMessage,m=e.questionReplyMessage,p=e.viewOnceMessage,_=e.viewOnceMessageV2,f=e.viewOnceMessageV2Extension;if(s)return s;if(a)return a;if(p)return p;if(o("WAWebViewOnceGatingUtils").isViewOnceSunsetEnabled()){if(_)return _;if(f&&o("WAWebViewOnceGatingUtils").isReceivingViewOnceV2Enabled())return f}return l||i||r||u||c||(t&&o("WAWebMessageAssociationGatingUtils").isFutureproofAssociatedChildEnabled()?t:d||m||(n&&o("WAWebBotGating").isRichResponseForwardReceivingEnabled()?n:null))}l.maybeGetFutureproofMessage=e}),98);
__d("WAWebMessageAssociationValidation",["$InternalEnum","WACustomError","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_PARENT_MESSAGE_KEY:"missing_parent_message_key",INVALID_PARENT_MESSAGE_KEY:"invalid_parent_message_key",MISSING_ASSOCIATION_TYPE:"missing_association_type",MISMATCH_SENDER:"mismatch_sender",UNSUPPORTED_ASSOCIATION_TYPE:"unsupported_association_type",INVALID_CHILD_MESSAGE:"invalid_child_message"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="MessageAssociationValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),u=n("$InternalEnum")({MESSAGE_ASSOCIATIONS_MISMATCH:"message_associations_mismatch"}),c=(function(e){function t(t,n){var r,o="errorCode: "+String(t);return n!=null&&(o+=" comment: "+n),r=e.call(this,o)||this,r.name="MessageAssociationInfraError",r}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError);l.MessageAssociationValidationErrorCode=e,l.MessageAssociationValidationError=s,l.MessageAssociationInfraErrorCode=u,l.MessageAssociationInfraError=c}),98);
__d("WAWebE2EProtoParser",["WALogger","WANullthrows","WAWebABProps","WAWebABPropsSaga","WAWebAssociationProtoUtils","WAWebBotGating","WAWebBotGroupGatingUtils","WAWebBotMetadataProtoUtils","WAWebBotModeSelectionProtoUtils","WAWebCommonMsgSubtypeTypes","WAWebCrashlog","WAWebE2EProtoParserForCtwaContext","WAWebE2EProtoUtils","WAWebFutureproofProtoUtils","WAWebLimitSharingProtoUtils","WAWebMediaGatingUtils","WAWebMessageAssociation.flow","WAWebMessageAssociationGatingUtils","WAWebMessageAssociationValidation","WAWebMessagePluginParseProtobuf","WAWebMmSignalSharingExpirationWindowUtils","WAWebMsgType","WAWebParseForwardedAiBotMessageInfo","WAWebParseForwardedNewsletterMessageInfo","WAWebProtobufsE2E.pb","WAWebQuestionsProtoUtils","WAWebQuotedMessageProtoUtils","WAWebThreadsGating","WAWebThreadsMetadataProtoUtils","WAWebWamEnumE2eFailureReason","WAWebWid","isArrayNullOrEmpty"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f;function g(t){var n=t.bizInfo,r=t.bizSource,a=t.editAttr,i=t.finalLocation,l=t.message,s=t.messageProtobuf,u=t.msgBotInfo,c=t.msgContext,d=t.msgMeta,m=t.paymentInfo,p=t.quotedPaymentInfo,_=t.rcat;s||o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["drop: not Message"]))).sendLogs("null-message");var f=s.messageContextInfo,g=h({messageProtobuf:s,message:l,msgContext:c,paymentInfo:m,finalLocation:i,quotedPaymentInfo:p,bizInfo:n,editAttr:a,rcat:_,bizSource:r,msgMeta:d,msgBotInfo:u}),y=g.contextInfo,b=g.msgData;return C(b,y,c,p),E(b,f,c),b}function h(e){var t=e.bizInfo,n=e.bizSource,r=e.editAttr,a=e.finalLocation,i=e.message,l=e.messageProtobuf,s=e.msgBotInfo,u=e.msgContext,c=e.msgMeta,d=e.paymentInfo,m=e.quotedPaymentInfo,p=e.rcat,_=l.callLogMesssage,f=o("WAWebAssociationProtoUtils").validateMessageAssociationInMessageContextInfo(i,l.messageContextInfo,u);if(f!=null&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var g=o("WAWebAssociationProtoUtils").getValidatedAssociationFieldsFromProto(f,i,u);if(g.associationType===o("WAWebMessageAssociation.flow").MessageAssociationType.UNKNOWN){var h=i,C=babelHelpers.extends({},h,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:"associatedUnknown",associationType:g.associationType,parentMsgKey:g.associationParentMsgKey,viewMode:g.viewMode});return{contextInfo:null,msgData:C}}}var b=o("WAWebMessagePluginParseProtobuf").parseProtobuf({messageProtobuf:l,baseMessage:i,msgContext:u,paymentInfo:d,quotedPaymentInfo:m,editAttr:r,bizInfo:t,finalLocation:a,rcat:p,bizSource:n,msgMeta:c,messageAssociation:f,msgBotInfo:s});if(b){var E=(b==null?void 0:b.msgData.type)===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&(b==null?void 0:b.msgData.futureproofType)!=null;if(!E&&o("WAWebQuestionsProtoUtils").shouldFutureProofQuestionMessage(b)){var k=i,I=babelHelpers.extends({},k,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:"unknown",subtype:void 0});return{contextInfo:null,msgData:I}}if(f!=null){var T,D=o("WAWebAssociationProtoUtils").convertAssociationTypeFromProtoToClientSupportedAssociationType(f.associationType);if(!E&&D!==o("WAWebMessageAssociation.flow").MessageAssociationType.BOT_PLUGIN&&(b==null?void 0:b.msgData.associationType)!==D&&(l==null||(T=l.protocolMessage)==null?void 0:T.type)!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)throw new(o("WAWebMessageAssociationValidation")).MessageAssociationValidationError(o("WAWebMessageAssociationValidation").MessageAssociationValidationErrorCode.INVALID_CHILD_MESSAGE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}return o("WAWebLimitSharingProtoUtils").parseLimitSharingFromMessage(i,l),y(b.msgData),b}var x=l.deviceSentMessage;x&&v(i,x,u),_&&R(i,_);var $=l.groupStatusMessageV2;$!=null&&o("WAWebABProps").getABPropConfigValue("group_status_receiver_enabled")&&L(i,$,u);var P=o("WAWebFutureproofProtoUtils").maybeGetFutureproofMessage(l);return P!=null&&S({message:i,futureproofMessage:P,msgContext:u,topLevelMessageContextInfo:l.messageContextInfo,editAttr:r}),{contextInfo:null,msgData:i}}function y(e){e.isViewOnce===!0&&(["body","caption","deprecatedMms3Url","directPath","encFilehash","filehash","mediaKey","mediaKeyTimestamp","scanLengths","scansSidecar","size","staticUrl","thumbnailDirectPath","thumbnailEncSha256","thumbnailSha256","url","height","width"].forEach(function(t){e[t]=void 0}),"metadataUrl"in e&&e.metadataUrl!=null&&o("WAWebMediaGatingUtils").isChannelVideoServerTranscodeUploadEnabled()&&(e.metadataUrl=void 0))}function C(e,t,n,r){t&&(b(e,t,n,r),o("WAWebE2EProtoParserForCtwaContext").parseCtwaContextProto(e,t))}function b(e,t,n,r){var a=t.quotedMessage,i=t.mentionedJid,l=t.groupMentions;if(a!=null&&o("WAWebE2EProtoUtils").isQuotedSupported(a)){var d=e.selectedCarouselCardIndex!=null;e.quotedMsg=o("WAWebQuotedMessageProtoUtils").parseQuotedMessage({quotedMsg:a,msgContext:n,isCarouselCardReply:d,contextInfo:t,targetMessageKey:e.id})}o("WAWebQuestionsProtoUtils").maybeAddQuestionReplyQuotedMessage(e,t.questionReplyQuotedMessage),e.quotedMsg&&e.quotedMsg.type==="payment"&&r&&o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseContextInfoProto: payment not supported"]))),e.quotedStanzaID=t.stanzaId,e.quotedParticipant=o("WAWebE2EProtoUtils").decodeJid(t.participant),e.quotedRemoteJid=o("WAWebE2EProtoUtils").decodeJid(t.remoteJid),e.quotedGroupSubject=o("WAWebE2EProtoUtils").decodeJid(t.groupSubject),e.quotedParentGroupJid=o("WAWebE2EProtoUtils").decodeJid(t.parentGroupJid),e.quotedType=t.quotedType,e.mentionedJidList=Array.isArray(i)?i.map(o("WAWebE2EProtoUtils").decodeJid):i,e.groupMentions=Array.isArray(l)?l.map(function(e){return{groupSubject:e.groupSubject,groupJid:o("WAWebE2EProtoUtils").decodeJid(e.groupJid)}}):l,e.isForwarded=t.isForwarded,e.isQuestion=t.isQuestion,e.forwardingScore=t.forwardingScore,e.nonJidMentions=t.nonJidMentions!=null&&o("WAWebABProps").getABPropConfigValue("enable_mention_everyone_receiver")?t.nonJidMentions:void 0,t.expiration!=null&&(e.ephemeralDuration=t.expiration),t.ephemeralSettingTimestamp!=null&&(e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp),t.ephemeralSharedSecret!=null&&(e.ephemeralSharedSecret=t.ephemeralSharedSecret);var m=t.disappearingMode;if(m!=null){var p=o("WAWebE2EProtoUtils").protoToDisappearingModeInitiator(e,m);p!=null&&(e.disappearingModeInitiator=p);var _=o("WAWebE2EProtoUtils").protoToDisappearingMode(e,m);_!=null&&(e.disappearingModeTrigger=_.disappearingModeTrigger,e.disappearingModeInitiatedByMe=_.initiatedByMe)}if(t.actionLink!=null&&(e.actionLink=t.actionLink),t.smbClientCampaignId!=null&&(e.smbClientCampaignId=t.smbClientCampaignId),t.forwardedNewsletterMessageInfo!=null)try{e.forwardedNewsletterMessageInfo=o("WAWebParseForwardedNewsletterMessageInfo").parseForwardedNewsletterMessageInfo(t.forwardedNewsletterMessageInfo)}catch(e){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["parseContextInfoProto: failed to parse forwarded newsletter info"]))).sendLogs("Failed to parse Forwarded Newsletter Message Info.")}var f=t.forwardedAiBotMessageInfo;if(f!=null&&o("WAWebBotGating").isAiForwardAttributionEnabled())try{e.forwardedAiBotMessageInfo=o("WAWebParseForwardedAiBotMessageInfo").parseForwardedAiBotMessageInfo(f)}catch(e){o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["parseContextInfoProto: failed to parse forwarded AI bot message info"]))).sendLogs("Failed to parse Forwarded AI Bot Message Info.")}o("WAWebMmSignalSharingExpirationWindowUtils").updateMmSignalSharingExpirationWindow(e,t)}function v(e,t,n){var r=o("WAWebE2EProtoUtils").decodeJid(t.destinationJid);e.id.remote=r,e.to=r,Object.assign(e,g({messageProtobuf:t.message,message:e,msgContext:n}))}function S(e){var t=e.editAttr,n=e.futureproofMessage,o=e.message,a=e.msgContext,i=e.topLevelMessageContextInfo,l=r("WANullthrows")(n.message),s=[],u=i==null?babelHelpers.extends({},l.messageContextInfo,{threadId:s}):babelHelpers.extends({},l.messageContextInfo,i,{threadId:s});Object.assign(o,g({messageProtobuf:babelHelpers.extends({},l,{messageContextInfo:u}),message:o,msgContext:a,editAttr:t}))}function R(e,t){e.type=o("WAWebMsgType").MSG_TYPE.CALL_LOG;var n=!!t.isVideo;t.participants.length>1?e.subtype=n?o("WAWebCommonMsgSubtypeTypes").MsgSubtype.MissGroupVideo:o("WAWebCommonMsgSubtypeTypes").MsgSubtype.MissGroup:e.subtype=n?o("WAWebCommonMsgSubtypeTypes").MsgSubtype.MissVideo:o("WAWebCommonMsgSubtypeTypes").MsgSubtype.Miss}function L(e,t,n){(t==null?void 0:t.message)!=null?(e.isGroupStatus=!0,Object.assign(e,g({messageProtobuf:t.message,message:e,msgContext:n}))):o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[parseGroupStatusMessageV2] Unable to parse possible group status message"]))).sendLogs("parse-group-status-message-skipped")}function E(e,t,n){var a,i,l,s,u,c;if(t){t.messageSecret!=null&&(e.messageSecret=new Uint8Array(t.messageSecret));var d=o("WAWebBotGroupGatingUtils").isOpenGroupBotParticipantAddEnabled()&&!((a=e.id)!=null&&(a=a.participant)!=null&&a.isBot()||(i=e.id)!=null&&(i=i.remote)!=null&&i.isBot())&&(t==null||(l=t.botMetadata)==null?void 0:l.botGroupMetadata)!=null;if(((s=e.id)!=null&&(s=s.participant)!=null&&s.isBot()||(u=e.id)!=null&&(u=u.remote)!=null&&u.isBot()||d)&&o("WAWebBotMetadataProtoUtils").parseBotMetadataProto(e,t,d),r("WAWebWid").isCAPISupportAccount(e==null||(c=e.id)==null?void 0:c.remote)&&(t==null?void 0:t.supportPayload)!=null){var g=JSON.parse(t.supportPayload);if(g.should_show_system_message!=null&&o("WAWebABPropsSaga").getIsSagaProtobufSystemMessageEnabled()&&(e.shouldShowSupportAISystemMessage=g.should_show_system_message),g.is_ai_message!=null&&o("WAWebABPropsSaga").getIsSagaProtobufAIStardustEnabled()&&(e.isSupportAIMessage=g.is_ai_message),Array.isArray(g.citation_items)&&g.citation_items.length>0&&(e.supportCitations=g.citation_items.map(function(e){return{title:e.title,subtitle:e.subtitle,cmsId:e.cms_id,imageUrl:e.image_url}})),g.should_upload_client_logs===!0&&o("WAWebABPropsSaga").getIsSagaV1ReengagementEnabled())if(g.ticket_id!=null&&g.ticket_id!=="no_ticket_created"){var h=864e5;o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["InAppSupport: Uploading logs for ticketId=",""])),g.ticket_id);var y={reason:o("WAWebCrashlog").SERVER_REQUESTED,immediate:!0,isHighPri:!0,logType:o("WAWebCrashlog").LogType.SUPPORT,ticketId:g.ticket_id,fromTimestamp:Date.now()-h};o("WAWebCrashlog").upload(y).then(function(e){e==null?o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["InAppSupport: Logs upload failed for ticketId=",""])),g.ticket_id):o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["InAppSupport: Logs upload complete for ticketId=",", logsId=",""])),g.ticket_id,e)})}else o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["InAppSupport: Could not upload logs. No ticketId was provided."])))}!r("isArrayNullOrEmpty")(t.threadId)&&o("WAWebThreadsGating").isThreadsInfraEnabled()&&o("WAWebThreadsMetadataProtoUtils").parseThreadsMetadataProto(e,t),o("WAWebBotModeSelectionProtoUtils").parseBotModeSelectionMetadataProto(e,t),o("WAWebThreadsMetadataProtoUtils").maybeAddHistoricalThreadIdForMetaAi(e,n),o("WAWebThreadsMetadataProtoUtils").maybeAddAiThreadInfoForMetaAi(e,n)}}l.parseMsgProto=g,l.parseContextInfo=C,l.parseContextInfoProto=b,l.parseMessageContextInfoProto=E}),98);
__d("WAWebAddonProcessingError",["$InternalEnum","WAWebHandleMsgError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({MISSING_THREAD_MESSAGE_ID:"missing_thread_message_id",MISSING_THREAD_MESSAGE_SENDER_JID:"missing_thread_message_sender_jid"}),s=(function(e){function t(t,n){var r,a="type: "+t+", errorCode: "+String(n);return r=e.call(this,a,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)||this,r.name="PlaceholderValidationError",r}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError),u=function(n,r){var t=n.threadMsgId,o=n.threadMsgSenderJid;if(t==null)throw new s(r,e.MISSING_THREAD_MESSAGE_ID);if(o==null)throw new s(r,e.MISSING_THREAD_MESSAGE_SENDER_JID);return{threadMsgId:t,threadMsgSenderJid:o}};l.validateMsgMeta=u}),98);
__d("WAWebBizTemplateAndInteractiveMessagesUtils",["WAWebABProps","WAWebBizGatingUtils","WAWebInteractiveMessagesNativeFlowName","WAWebMsgGetters"],(function(t,n,r,o,a,i,l){var e,s=3,u=[(e=r("WAWebInteractiveMessagesNativeFlowName")).QUICK_REPLY,e.CTA_CALL,e.CTA_URL,e.CTA_CATALOG,e.CATALOG_MESSAGE,e.CTA_COPY_CODE,e.CTA_FLOW,e.ORDER_STATUS,e.PAYMENT_REMINDER,e.BOOKING_CONFIRMATION];function c(e){return e==="review_and_pay"?r("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS:e==="payment_info"?r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_INFO:e==="review_order"?r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS:e==="order_status"?o("WAWebABProps").getABPropConfigValue("rich_order_status_wa_web")?r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS:null:e==="payment_status"?r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS:e==="payment_method"?r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD:e==="open_webview"?r("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK:e==="message_with_link_status"?r("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK_STATUS:e==="cta_url"?r("WAWebInteractiveMessagesNativeFlowName").CTA_URL:e==="cta_call"?r("WAWebInteractiveMessagesNativeFlowName").CTA_CALL:e==="quick_reply"?r("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY:e==="catalog_message"?r("WAWebInteractiveMessagesNativeFlowName").CATALOG_MESSAGE:e==="cta_catalog"?r("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG:e==="cta_copy"?r("WAWebInteractiveMessagesNativeFlowName").CTA_COPY_CODE:e==="galaxy_message"?r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW:e==="payment_reminder"?r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_REMINDER:e==="booking_confirmation"?r("WAWebInteractiveMessagesNativeFlowName").BOOKING_CONFIRMATION:e==="call_permission_request"?r("WAWebInteractiveMessagesNativeFlowName").CALL_PERMISSION_REQUEST:void 0}function d(e,t,n){return o("WAWebMsgGetters").isBizSourceFromMarketingMessage(n)?o("WAWebABProps").getABPropConfigValue("web_premium_messages_interactivity_rendering_enabled"):n==="quoted_carousel_card"&&e===r("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY?o("WAWebBizGatingUtils").carouselsEnabled():_(e)?!0:t===!0?o("WAWebABProps").getABPropConfigValue("web_premium_messages_interactivity_rendering_enabled"):!1}var m=function(t){return t.hydratedTemplateButton!=null?t.hydratedTemplateButton.quickReplyButton!=null:t.nativeFlowButton!=null?t.nativeFlowButton.name===String(r("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY):!1};function p(e){if(e.length>s)return!0;if(e.length>0){var t=m(e[0]);if(!e.slice(1).every(function(e){var n,r=m(e),o=(n=e.nativeFlowButton)==null?void 0:n.name,a=c(o),i=a!=null?u.includes(a):!0;return i&&t===r}))return!0}return!1}function _(e){return u.includes(e)}l.supportedNativeFlowButtonNamesForInteractiveMsg=u,l.getNativeFlowNameByButtonName=c,l.isInteractiveCtaMessageEnabled=d,l.buttonsViolateButtonImprovementsConstraints=p}),98);
__d("WAWebSpecialEmojisWithSkinTones",[],(function(t,n,r,o,a,i){var e={"\uD83E\uDD1D\uD83C\uDFFB":"\uD83E\uDD1D","\uD83E\uDD1D\uD83C\uDFFC":"\uD83E\uDD1D","\uD83E\uDD1D\uD83C\uDFFD":"\uD83E\uDD1D","\uD83E\uDD1D\uD83C\uDFFE":"\uD83E\uDD1D","\uD83E\uDD1D\uD83C\uDFFF":"\uD83E\uDD1D","\uD83D\uDC6F\uD83C\uDFFB":"\uD83D\uDC6F","\uD83D\uDC6F\uD83C\uDFFC":"\uD83D\uDC6F","\uD83D\uDC6F\uD83C\uDFFD":"\uD83D\uDC6F","\uD83D\uDC6F\uD83C\uDFFE":"\uD83D\uDC6F","\uD83D\uDC6F\uD83C\uDFFF":"\uD83D\uDC6F","\uD83D\uDC6F\uD83C\uDFFB\u200D\u2642":"\uD83D\uDC6F\u200D\u2642","\uD83D\uDC6F\uD83C\uDFFC\u200D\u2642":"\uD83D\uDC6F\u200D\u2642","\uD83D\uDC6F\uD83C\uDFFD\u200D\u2642":"\uD83D\uDC6F\u200D\u2642","\uD83D\uDC6F\uD83C\uDFFE\u200D\u2642":"\uD83D\uDC6F\u200D\u2642","\uD83D\uDC6F\uD83C\uDFFF\u200D\u2642":"\uD83D\uDC6F\u200D\u2642"};i.default=e}),66);
__d("WAWebConvertToTextWithoutSpecialEmojis",["WAWebEmojiCompile","WAWebSpecialEmojisWithSkinTones"],(function(t,n,r,o,a,i,l){var e=null;function s(t){if(!e){var n=r("WAWebEmojiCompile")(Object.keys(r("WAWebSpecialEmojisWithSkinTones")));e=new RegExp("("+n+")","g")}return e.lastIndex=0,t.replace(e,function(e){return r("WAWebSpecialEmojisWithSkinTones")[e]})}l.convertToTextWithoutSpecialEmojis=s}),98);
__d("WAWebInteractiveResponseMessageType",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({NATIVE_FLOW:"native_flow"}),l=e;i.default=l}),66);
__d("WAWebE2EProtoUtils",["invariant","WABase64","WAJids","WALogger","WALongInt","WANullthrows","WATypeUtils","WAWebAddonCrossWindowUtils","WAWebAddonProcessMsgsUtils","WAWebAddonProcessingError","WAWebApiContact","WAWebBackendApi","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebBizGatingUtils","WAWebBizTemplateAndInteractiveMessagesUtils","WAWebConvertToTextWithoutSpecialEmojis","WAWebDBGroupsGroupMetadata","WAWebEphemeralityTypes","WAWebHandleMsgCommon","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebInteractiveResponseMessageType","WAWebIsCagGroupCache","WAWebLidMigrationUtils","WAWebMobilePlatforms","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebNonEmptyString","WAWebPollsGatingUtils","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebVerifyProtobufMsgObjectKeys","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","cr:13547","err"],(function(t,n,r,o,a,i,l,s){var e,u,c,d,m,p,_=(e=n("cr:13547"))!=null?e:{},f=_.syncDisappearingModeTriggerToDB;function g(e){var t,n,r,a,i=(t=o("WAWebVerifyProtobufMsgObjectKeys").getUnwrappedProtobufMessage(e))!=null?t:e;if(i.ephemeralMessage){var l=i.ephemeralMessage.message;return l?g(l):o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(i.groupMentionedMessage){var s=i.groupMentionedMessage.message;return s?g(s):o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(i.botInvokeMessage){var u=i.botInvokeMessage.message;return u?g(u):o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(i.deviceSentMessage){var c=i.deviceSentMessage.message;return c?g(c):o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}return i.reactionMessage||i.encReactionMessage?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction:i.eventMessage||i.encEventResponseMessage||((n=i.secretEncryptedMessage)==null?void 0:n.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event:((r=i.secretEncryptedMessage)==null?void 0:r.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.MESSAGE_EDIT?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text:i.pollCreationMessage||i.pollCreationMessageV2||i.pollCreationMessageV3||i.pollCreationMessageV5||i.pollUpdateMessage?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll:((a=i.extendedTextMessage)==null?void 0:a.matchedText)!=null&&i.extendedTextMessage.matchedText.trim()!==""?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.media:i.conversation||i.extendedTextMessage||i.templateButtonReplyMessage||i.protocolMessage||i.interactiveMessage||i.keepInChatMessage||i.requestPhoneNumberMessage||i.editedMessage||i.pinInChatMessage||i.encCommentMessage||i.newsletterAdminInviteMessage||i.newsletterFollowerInviteMessageV2||i.messageHistoryNotice?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text:i.pollResultSnapshotMessage||i.pollResultSnapshotMessageV3?o("WAWebPollsGatingUtils").isPollResultSnapshotPollTypeEnvelopeEnabled()?o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll:o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text:o("WAWebHandleMsgCommon").STANZA_MSG_TYPES.media}function h(e){if(o("WAWebAddonCrossWindowUtils").getAddonProcessorType(e)===o("WAWebMsgType").MSG_TYPE.COMMENT){var t=o("WAWebAddonProcessMsgsUtils").getParentMsgKey(e),n=o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(t.participant,"undefined participant")),a=o("WAWebLidMigrationUtils").toUserLidOrThrow(n);return{threadMsgId:t.id,threadMsgSenderLid:r("WANullthrows")(a,"undefined lid")}}}function y(e){var t,n,r,a,i=(t=o("WAWebVerifyProtobufMsgObjectKeys").getUnwrappedProtobufMessage(e))!=null?t:e;if(i.reactionMessage||i.encReactionMessage||(n=i.pollUpdateMessage)!=null&&n.vote||i.keepInChatMessage||i.editedMessage||i.pinInChatMessage||((r=i.botInvokeMessage)==null||(r=r.message)==null||(r=r.protocolMessage)==null?void 0:r.type)===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REQUEST_WELCOME_MESSAGE||i.encEventResponseMessage||((a=i.secretEncryptedMessage)==null?void 0:a.secretEncType)===o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT||i.messageHistoryNotice)return o("WAWebBackendJobs.flow").DecryptFailType.Hide;var l=i.protocolMessage;return l&&(l.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SYNC_RESPONSE||l.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REQUEST_WELCOME_MESSAGE||l.editedMessage||l.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.GROUP_MEMBER_LABEL_CHANGE)?o("WAWebBackendJobs.flow").DecryptFailType.Hide:o("WAWebBackendJobs.flow").DecryptFailType.Show}function C(e,t){var n=e.fromMe,a=e.id,i=e.participant,l=e.remoteJid,u=i!=null?i:t==null?void 0:t.toString();n!=null&&l!=null&&a!=null||s(0,56276);var c=u!=null&&o("WAWebWidFactory").isWidlike(u)?o("WAWebWidFactory").createWid(u):void 0,d=o("WAWebWidFactory").createWid(l);return(d.isGroup()||d.isBroadcast())&&n&&(c=o("WAWebUserPrefsMeUser").getMaybeMePnUser()),new(r("WAWebMsgKey"))({fromMe:n,id:a,participant:c,remote:o("WAWebWidFactory").createWid(l)})}function b(e){var t;return{fromMe:e.fromMe,id:e.id,participant:e.fromMe||(t=e.participant)==null?void 0:t.toString({legacy:!0}),remoteJid:e.remote.toString({legacy:!0})}}function v(e){return{paymentStatus:e.status,paymentTxnStatus:e.txnStatus,paymentCurrency:e.currency||"",paymentAmount1000:r("WANullthrows")(o("WALongInt").maybeNumberOrThrowIfTooLarge(e.amount1000)),paymentMessageReceiverJid:o("WAWebWidFactory").createWid(r("WANullthrows")(e.receiverJid)),paymentExpiryTimestamp:o("WALongInt").maybeNumberOrThrowIfTooLarge(e.expiryTimestamp),paymentTransactionTimestamp:r("WANullthrows")(o("WALongInt").maybeNumberOrThrowIfTooLarge(e.transactionTimestamp))}}function S(e){var t,n=["XUS","XDX","USDP"],r=o("WAWebNonEmptyString").asMaybeNonEmptyString(e==null||(t=e.primaryAmount)==null?void 0:t.currencyCode)||(e==null?void 0:e.currency);return r!=null&&n.includes(r.toUpperCase())}function R(e,t){var n;return!(e.remote.isGroup()&&!((n=e.participant)!=null&&n.equals(o("WAWebUserPrefsMeUser").getMePnUserOrThrow()))&&!t.equals(o("WAWebUserPrefsMeUser").getMePnUserOrThrow()))}function L(e){var t=e.bizInfo,n=e.msgContext,r=e.name;return r!=null||(t==null?void 0:t.nativeFlowName)!=null?o("WAWebBizGatingUtils").nativeFlowMessagesEnabled()?E({name:r,bizInfo:t,msgContext:n}):!1:!0}function E(e){var t=e.bizInfo,n=e.msgContext,o=e.name;return n!=="relay"&&o!=null?!0:(t==null?void 0:t.nativeFlowName)==null||o==null?!1:r("WAWebInteractiveMessagesNativeFlowName").cast(t.nativeFlowName)===r("WAWebInteractiveMessagesNativeFlowName").MIXED?!0:o!=null&&r("WAWebInteractiveMessagesNativeFlowName").cast(t.nativeFlowName)===o}function k(e){return e===r("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS||e===r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS||e===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS||e===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD||e===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_INFO}function I(e){var t,n,a,i,l,s,u,c,d,m=e.interactiveMessage,p=m==null||(t=m.nativeFlowMessage)==null?void 0:t.buttons;if(p!=null&&p.length>0&&!o("WAWebBizTemplateAndInteractiveMessagesUtils").buttonsViolateButtonImprovementsConstraints(p.map(function(e){return{nativeFlowButton:e}})))return String(o("WAWebBizTemplateAndInteractiveMessagesUtils").getNativeFlowNameByButtonName(p[0].name));if(((n=e.buttonsMessage)==null||(n=n.buttons)==null?void 0:n.length)===1){var _;return String(o("WAWebBizTemplateAndInteractiveMessagesUtils").getNativeFlowNameByButtonName((_=e.buttonsMessage.buttons[0].nativeFlowInfo)==null?void 0:_.name))}var f=!(p!=null&&p.length)&&(((a=m==null||(i=m.body)==null||(i=i.text)==null?void 0:i.length)!=null?a:0)>0||((l=m==null||(s=m.header)==null||(s=s.title)==null?void 0:s.length)!=null?l:0)>0||((u=m==null||(c=m.footer)==null||(c=c.text)==null?void 0:c.length)!=null?u:0)>0||(m==null||(d=m.header)==null?void 0:d.imageMessage)!=null)&&!(m!=null&&m.shopStorefrontMessage);if(f)return String(r("WAWebInteractiveMessagesNativeFlowName").MIXED)}var T=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail","wa_payment_transaction_details","wa_payment_learn_more","wa_payment_fbpin_reset"];function D(e){return e.some(function(e){return e.nativeFlowInfo&&e.nativeFlowInfo.name!=null&&T.includes(e.nativeFlowInfo.name)||e.buttonId!=null&&T.includes(e.buttonId)})}function x(e){return e===r("WAWebInteractiveMessageType").NATIVE_FLOW?o("WAWebBizGatingUtils").interactiveNativeFlowMessagesEnabled():e===r("WAWebInteractiveMessageType").SHOPS_STOREFRONT?o("WAWebBizGatingUtils").shopsInteractiveMessageEnabled():e===r("WAWebInteractiveMessageType").CAROUSEL?o("WAWebBizGatingUtils").carouselsEnabled():(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function $(e){switch(e){case r("WAWebInteractiveMessageType").NATIVE_FLOW:return"nativeFlowMessage";case r("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return"shopStorefrontMessage";case r("WAWebInteractiveMessageType").CAROUSEL:return"carouselMessage"}}function P(e){for(var t of r("WAWebInteractiveMessageType").members())if($(t)in e)return t;return null}function N(e,t){var n=t==null?void 0:t.messageVersion;if(n==null||e==null)return!1;switch(e){case r("WAWebInteractiveMessageType").NATIVE_FLOW:return n<=1;case r("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return n<=1;case r("WAWebInteractiveMessageType").CAROUSEL:return n<=1}}function M(e){switch(e){case r("WAWebInteractiveResponseMessageType").NATIVE_FLOW:return"nativeFlowResponseMessage"}}function w(e){for(var t of r("WAWebInteractiveResponseMessageType").members())if(M(t)in e)return t;return null}function A(e){switch(e){case r("WAWebInteractiveResponseMessageType").NATIVE_FLOW:return o("WAWebBizGatingUtils").interactiveNativeFlowResponseMessagesEnabled()}}function F(e){var t=e.bizInfo,n=e.message,o=e.msgContext,a=e.type;switch(a){case r("WAWebInteractiveResponseMessageType").NATIVE_FLOW:{var i=r("WANullthrows")(n.nativeFlowResponseMessage),l=r("WANullthrows")(r("WAWebInteractiveMessagesNativeFlowName").cast(i.name)),s=r("WANullthrows")(i.version);if(s>1||!E({name:l,bizInfo:t,msgContext:o}))throw r("err")("Invalid message");return{name:l,version:s,type:a,paramsJson:r("WANullthrows")(i.paramsJson)}}}}function O(e){return e.reactionMessage==null}function B(e){return e!=null&&r("WAWebWid").isWid(e)?o("WAWebWidFactory").createWid(e):e}function W(e,t){var n=B(e);return typeof n=="string"&&o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose([""," got decoded to a string: ",""])),t,n),n}function q(e){if(e!=null)return r("WAWebWid").isWid(e)||s(0,64887),o("WAWebWidFactory").createWid(e)}function U(e,t){if(e!=null){var n=e.id;if(n!=null)return G(n,e,t,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon)}}function V(e,t){if(e!=null){var n=e.id;if(n!=null)return G(n,e,t,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Message)}}function H(e,t,n){var a=o("WAWebAddonProcessingError").validateMsgMeta(e,n),i=a.threadMsgId,l=a.threadMsgSenderJid;return new(r("WAWebMsgKey"))({id:i,fromMe:o("WAWebUserPrefsMeUser").isMeAccount(l),remote:t.chat,participant:l})}function G(e,t,n,a){var i,l,s,u;if(n!=null&&(i=n.id)!=null&&i.fromMe)if(l=!!t.fromMe,u=B(t.remoteJid),t.fromMe===!0){if(u instanceof r("WAWebWid")&&!(u.isUser()||u.isNewsletter())){var _,f=r("WAWebIsCagGroupCache").isCag(u),g=f&&a!==o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon,h=g||!((_=n.author)!=null&&_.isLid())?o("WAWebUserPrefsMeUser").getMePnUserOrThrow():o("WAWebUserPrefsMeUser").getMeLidUserOrThrow();s=h}}else s=B(t.participant);else{u=n.id.remote;var c=r("WAWebIsCagGroupCache").isCag(u);if(t.fromMe===!0){var d;if(l=!1,s=n.author,c&&(d=s)!=null&&d.isLid()&&a!==o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon){var m=o("WAWebApiContact").getPhoneNumber(n.author);m!=null&&(s=m)}}else{var p=B(t.participant);p instanceof r("WAWebWid")?(l=o("WAWebUserPrefsMeUser").isMeAccount(p),(!u.isUser()||p.isBot())&&(l?s=p.isLid()?o("WAWebUserPrefsMeUser").getMeLidUserOrThrow():o("WAWebUserPrefsMeUser").getMePnUserOrThrow():s=p)):l=!0}}return n.type===o("WAWebMsgType").MSG_TYPE.REACTION&&u!=null&&(u instanceof r("WAWebWid")&&u.isBroadcast()&&!u.isStatus()||o("WAJids").interpretAndValidateJid(u.toString()).jidType==="broadcast")&&(u=B(t.participant),s=void 0),new(r("WAWebMsgKey"))({id:e,fromMe:l,remote:u,participant:s})}function z(e){return e==null||e===""||o("WAWebMobilePlatforms").getMobilePlatform()===o("WAWebMobilePlatforms").PLATFORMS.ANDROID?e:o("WAWebConvertToTextWithoutSpecialEmojis").convertToTextWithoutSpecialEmojis(e)}function j(e){var t={fromMe:e.fromMe,id:e.id},n=K(e.remote),r=K(e.participant);return o("WATypeUtils").isString(n)&&(t.remoteJid=n),o("WATypeUtils").isString(r)&&(t.participant=r),t}function K(e){if(e instanceof r("WAWebWid"))return e.toString({legacy:!0});if(o("WATypeUtils").isString(e))return e.replace(/@c.us$/,"@s.whatsapp.net")}function Q(e){return e!=null&&e!==""?o("WABase64").decodeB64(e):void 0}function X(e){var t=K(e.to),n={fromMe:!0,id:e.id.id};return o("WATypeUtils").isString(t)&&(n.remoteJid=t),n}function Y(e,t,n){t.viewOnce||(t.directPath==null&&t.staticUrl==null&&o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["directPath missing from msg type ",""])),e).sendLogs("outgoing-"+e+"-message-missing-direct-path"),t.fileSha256==null&&o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["fileSha256 missing from msg type ",""])),e).sendLogs("outgoing-"+e+"-message-missing-file-sha"),!n&&t.fileEncSha256==null&&o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["fileEncSha256 missing from msg type ",""])),e).sendLogs("outgoing-"+e+"-message-missing-file-enc-sha"),t.url==null&&t.staticUrl==null&&!n&&o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["url(deprecatedMms3Url) missing from msg type ",""])),e).sendLogs("outgoing-"+e+"-message-missing-mms3-url"))}function J(e,t,n){var r,a,i;switch(e){case o("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat:r=o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.CHANGED_IN_CHAT;break;case o("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe:r=o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_ME;break;case o("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther:r=o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER;break;case o("WAWebEphemeralityTypes").DisappearingModeInitiator.BizUpgradeFbHosting:r=o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER;break}if(t)switch(t){case o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings:a=o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.CHAT_SETTING;break;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings:a=o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.ACCOUNT_SETTING;break;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange:a=o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BULK_CHANGE;break;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown:a=o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN;break;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.UnknownGroups:a=o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN_GROUPS;break;case o("WAWebEphemeralityTypes").DisappearingModeTrigger.BizSupportFbHosting:a=o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN;break}return n!=null&&(i=n),{initiator:r,trigger:a,initiatedByMe:i}}function Z(e,t){if(e.from!=null){var n=o("WAWebUserPrefsMeUser").isMeAccount(e.from);if(t.initiator!=null)switch(t.initiator){case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.CHANGED_IN_CHAT:return o("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat;case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_ME:return n?o("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe:o("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther;case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER:case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.BIZ_UPGRADE_FB_HOSTING:return n?o("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther:o("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe}}}function ee(e,t){var n=o("WAWebUserPrefsMeUser").isMeAccount(e.from),r=t.initiatedByMe,a=t.initiator,i=t.trigger;if(i!=null&&o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&i===o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BIZ_SUPPORTS_FB_HOSTING)return{disappearingModeTrigger:re(i),initiatedByMe:n?r:!r};if(i!=null&&r!=null)return{disappearingModeTrigger:re(i),initiatedByMe:n?r:!r};if(t.initiator!=null&&a!=null)switch(a){case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.CHANGED_IN_CHAT:return{disappearingModeTrigger:o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings};case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_ME:return{disappearingModeTrigger:o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:n};case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.BIZ_UPGRADE_FB_HOSTING:case o("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER:return{disappearingModeTrigger:o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:!n}}}function te(e,t){return ne.apply(this,arguments)}function ne(){return ne=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebDBGroupsGroupMetadata").getGroupMetadata(t),r=n==null?void 0:n.disappearingModeInitiatedByMe;if(n!=null&&e!=null&&n.disappearingModeTrigger===o("WAWebEphemeralityTypes").DisappearingModeTrigger.UnknownGroups&&e!==o("WAWebEphemeralityTypes").DisappearingModeTrigger.UnknownGroups&&(f==null||f(t,e),o("WAWebBackendApi").frontendFireAndForget("syncEphemeralTriggerCollectionForGroup",{chatId:t,trigger:e})),r!=null)return{disappearingModeTrigger:e,disappearingModeInitiatedByMe:r}}),ne.apply(this,arguments)}function re(e){switch(e){case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.CHAT_SETTING:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.ACCOUNT_SETTING:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BULK_CHANGE:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BIZ_SUPPORTS_FB_HOSTING:return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()?o("WAWebEphemeralityTypes").DisappearingModeTrigger.BizSupportFbHosting:o("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN_GROUPS:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.UnknownGroups;case o("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN:return o("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown}}var oe=function(t){return t};l.typeAttributeFromProtobuf=g,l.extractCommentTargetIdAndSenderLid=h,l.decryptFailAttributeFromProtobuf=y,l.protobufToMsgKey=C,l.msgKeyToProtobuf=b,l.parseMsgPaymentInfo=v,l.hasUnsupportedCurrency=S,l.isEitherSenderOrReceiverOfPaymentMessage=R,l.shouldParseNFM=L,l.isValidNativeFlowName=E,l.isOrderNativeFlow=k,l.getBizNativeFlowName=I,l.hasUnsupportedButtons=D,l.isInteractiveMessageTypeEnabled=x,l.getInteractiveMessageFieldNameForType=$,l.getInteractiveMessageTypeForProto=P,l.isSupportedInteractiveMessageVersion=N,l.getInteractiveResponseMessageFieldNameForType=M,l.getInteractiveResponseMessageTypeForProto=w,l.isInteractiveResponseMessageTypeEnabled=A,l.getInteractiveResponsePayload=F,l.isQuotedSupported=O,l.decodeJid=B,l.decodeJidAndValidate=W,l.strictDecodeJid=q,l.translateAddonMessageKeyToLocalReference=U,l.translateRegularMessageKeyToLocalReference=V,l.createMsgKeyFromThreadInfo=H,l.translateKeyToLocalReference=G,l.convertToTextWithoutSpecialEmojis=z,l.encodeKey=j,l.encodeJid=K,l.encodeBytes=Q,l.createMessageKey=X,l.validateOutgoingRequiredMediaProperties=Y,l.disappearingModeInitiatorToProto=J,l.protoToDisappearingModeInitiator=Z,l.protoToDisappearingMode=ee,l.updateDisappearingModeForGroups=te,l.getMutableMessageProtobuf=oe}),98);
__d("WAWebBookingConfirmation",["WAWebABProps","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType"],(function(t,n,r,o,a,i,l){var e=function(){return o("WAWebABProps").getABPropConfigValue("booking_confirmation_enabled_wa_web")};function s(e){try{var t,n,r,o,a,i=JSON.parse(e);if(i.start_datetime==null||i.location==null&&i.booking_url==null&&i.phone_number==null)return null;var l=Date.parse(i.start_datetime);if(isNaN(l))return null;var s=null;return i.end_datetime!=null&&(s=Date.parse(i.end_datetime),isNaN(s)&&(s=null)),{startDatetimeMs:l,endDatetimeMs:s,location:(t=i.location)!=null?t:null,bookingUrl:(n=i.booking_url)!=null?n:null,phoneNumber:(r=i.phone_number)!=null?r:null,bookingManagementUrl:(o=i.booking_management_url)!=null?o:null,description:(a=i.description)!=null?a:null}}catch(e){return null}}var u=function(t){var e,n;if(t.nativeFlowName!==r("WAWebInteractiveMessagesNativeFlowName").BOOKING_CONFIRMATION||t.type!==o("WAWebMsgType").MSG_TYPE.INTERACTIVE||t.interactiveType!==r("WAWebInteractiveMessageType").NATIVE_FLOW||!((e=t.interactivePayload)!=null&&e.buttons))return null;var a=(n=t.interactivePayload.buttons[0])==null?void 0:n.buttonParamsJson;return a==null?null:s(a)},c=function(t){if((t==null?void 0:t.name)!==r("WAWebInteractiveMessagesNativeFlowName").BOOKING_CONFIRMATION)return null;var e=t.buttonParamsJson;return e==null?null:s(e)};l.isBookingConfirmationEnabled=e,l.getBookingConfirmationInfo=u,l.parseBookingConfirmationButton=c}),98);
__d("WAWebGalaxyFlowFeatureSupport",["WALogger","WAWebABProps","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebLidMigrationUtils","WAWebMsgGetters","WAWebMsgType","WAWebPrimaryFeaturesModel","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e,s=3;function u(e,t){return(t==null?void 0:t.type)===o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE||e.wa_flow_response_params!=null||e.flow_message_version!=null&&+e.flow_message_version>=s}function c(t){if(t==null)return null;try{return JSON.parse(t)}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse button params JSON: ",""])),t),null}}function d(e){if(e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE){var t,n=e==null||(t=e.interactivePayload)==null?void 0:t.buttons;if(n!=null&&n.length>0){var a;return(a=n.find(function(e){return e.name===r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW}))==null?void 0:a.buttonParamsJson}}if(e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE){var i;return e==null||(i=e.interactivePayload)==null?void 0:i.buttonParamsJson}return null}function m(e,t){var n,r=o("WAWebABProps").getABPropConfigValue("enable_futureproof_galaxy_flow_message_for_business_numbers").split(",");if(r.length===0)return!1;if(e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE){var a=t==null?o("WAWebMsgGetters").getSender(e):t.from;if(a){var i=o("WAWebLidMigrationUtils").toPn(a);i&&(n=o("WAWebWidFactory").asUserWidOrThrow(i).user)}if(n!=null)return r.includes(n)}if(e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE){var l=e==null?void 0:e.to;if(l){var s=o("WAWebLidMigrationUtils").toPn(l);s&&(n=o("WAWebWidFactory").asUserWidOrThrow(s).user)}if(n!=null)return r.includes(n)}return!1}function p(e,t,n){if(!o("WAWebABProps").getABPropConfigValue("flows_wa_web")||m(e,n))return!1;var r=n!=null?n.galaxyFlowDisabled!==void 0:!1;if(!r&&!o("WAWebPrimaryFeaturesModel").PrimaryFeatures.isGalaxyFlowCompanionSyncSupported)return!1;if(e.type===o("WAWebMsgType").MSG_TYPE.AUTOMATED_GREETING_MESSAGE&&t!=null)return u({flow_message_version:t},e);if(!_(e))return!1;var a=d(e),i=c(a);return i==null?!1:u(i,e)}function _(e){return(e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE||e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE)&&e.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW}l.isFlowSupported=p}),98);
__d("WAWebBizOrderDetailsParams",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({PIX_STATIC_CODE:"pix_static_code",PIX_DYNAMIC_CODE:"pix_dynamic_code",CARDS:"cards",PAYMENT_GATEWAY:"payment_gateway",PAYMENT_LINK:"payment_link",BOLETO:"boleto",OFFSITE_CARD_PAY:"offsite_card_pay"}),l=n("$InternalEnum")({QUICK_REPLY:"quick_reply",CHAT_ATTACHMENT:"chat_attachment"});function s(e){return JSON.parse(e)}function u(e){return JSON.stringify(e)}function c(e){return JSON.stringify(e)}i.PaymentSettingType=e,i.OrderReferral=l,i.parse=s,i.stringify=u,i.stringifyPaymentStatus=c}),66);
__d("WAWebOrderDetails",["WAWebBizOrderDetailsParams","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","filterNulls"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e==null?void 0:e.value;if(n!=null){var r=(t=e==null?void 0:e.offset)!=null?t:1;return parseFloat(n!=null?n:0)/parseInt(r,10)}}function s(e){return e==null?null:r("filterNulls")(e.map(function(e){return(e==null?void 0:e.type)!=null?babelHelpers.extends({type:e.type},e.payment_instruction!=null?{paymentInstruction:e.payment_instruction}:{}):null}))}var u=function(){return"custom-item"},c=function(n,r){var t,a;if(n!=="review_and_pay"&&n!=="payment_info"||r==null)return null;var i=o("WAWebBizOrderDetailsParams").parse(r),l=i.currency,c=i.external_payment_configurations,d=i.order,m=i.payment_configuration,p=i.payment_settings,_=i.reference_id,f=e(i.total_amount),g=(t=d==null?void 0:d.items)!=null?t:[],h=g.map(function(t){var n,r,o,a,i,l,s,c;return{id:(n=(r=t==null?void 0:t.product_id)!=null?r:t==null?void 0:t.retailer_id)!=null?n:"",name:(o=t==null?void 0:t.name)!=null?o:"",amount:e(t==null?void 0:t.amount),quantity:parseInt((a=t==null?void 0:t.quantity)!=null?a:0,10),isCustomItem:(i=t==null?void 0:t.isCustomItem)!=null?i:(t==null||(l=t.retailer_id)==null?void 0:l.indexOf(u()))===0,isQuantitySet:(s=t==null?void 0:t.isQuantitySet)!=null?s:!0,properties:t==null||(c=t.variant_info_list)==null?void 0:c.map(function(e){var t=e.name,n=e.value;return[t,n]})}}),y=h.reduce(function(e,t){return e+t.quantity},0),C=(a=g[0])==null?void 0:a.name;if(n==="payment_info"&&(p==null?void 0:p.length)===1&&p[0].type===o("WAWebBizOrderDetailsParams").PaymentSettingType.PIX_STATIC_CODE){var b=p[0][o("WAWebBizOrderDetailsParams").PaymentSettingType.PIX_STATIC_CODE];C=b.merchant_name}if(_==null||l==null||f==null)return null;var v=e(d==null?void 0:d.shipping),S=e(d==null?void 0:d.tax),R=e(d==null?void 0:d.discount),L=e(d==null?void 0:d.subtotal),E=s(c);return babelHelpers.extends({title:C,referenceId:_,currency:l,quantity:y,shipping:v,tax:S,discount:R,subtotal:L,totalAmount:f,items:h,payment_configuration:m,type:i.type},E!=null?{externalPaymentConfigurations:E}:{},{paymentSettings:p,buttonName:n})},d=function(t){var e;if(t.nativeFlowName!==r("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS&&t.nativeFlowName!==r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_INFO)return null;if(t.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&t.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&(e=t.interactivePayload)!=null&&e.buttons){var n=t.interactivePayload.buttons[0],a=n.buttonParamsJson,i=n.name;return c(i,a)}else if(t.type===o("WAWebMsgType").MSG_TYPE.NATIVE_FLOW){var l,s=((l=t.nativeFlowButtons)!=null?l:[])[0].nativeFlowInfo;return c(s==null?void 0:s.name,s==null?void 0:s.paramsJson)}};l.getCustomItemIdPrefix=u,l.paramsJsonToOrderInfo=c,l.getOrderInfo=d}),98);
__d("WAWebPaymentReminder",["WAWebABProps","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType"],(function(t,n,r,o,a,i,l){var e=function(){return o("WAWebABProps").getABPropConfigValue("utility_payment_reminder_m1_enabled")};function s(e){try{var t,n,r,o=JSON.parse(e);if(o.cta_action_url==null||o.due_date==null||o.amount_due==null||o.amount_due_currency==null)return null;var a=parseInt(o.due_date,10)*1e3;return{url:o.cta_action_url,dueDateMs:a,amountDue:{value:o.amount_due.value,offset:o.amount_due.offset},amountDueCurrency:o.amount_due_currency,isOverdue:o.is_overdue===!0,daysOverdue:(t=o.days_overdue)!=null?t:null,accountName:(n=o.account_name)!=null?n:null,cardNumber:(r=o.card_number_last_4_digits)!=null?r:null}}catch(e){return null}}var u=function(t){var e,n;if(t.nativeFlowName!==r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_REMINDER||t.type!==o("WAWebMsgType").MSG_TYPE.INTERACTIVE||t.interactiveType!==r("WAWebInteractiveMessageType").NATIVE_FLOW||!((e=t.interactivePayload)!=null&&e.buttons))return null;var a=(n=t.interactivePayload.buttons[0])==null?void 0:n.buttonParamsJson;return a==null?null:s(a)},c=function(t){if((t==null?void 0:t.name)!==r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_REMINDER)return null;var e=t.buttonParamsJson;return e==null?null:s(e)};l.isPaymentReminderEnabled=e,l.getPaymentReminderInfo=u,l.parsePaymentReminderButton=c}),98);
__d("WAWebNativeFlowValidation",["WAWebBizGatingUtils","WAWebBizTemplateAndInteractiveMessagesUtils","WAWebBookingConfirmation","WAWebGalaxyFlowFeatureSupport","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebOrderDetails","WAWebOrderPaymentStatus","WAWebOrderStatus","WAWebPaymentReminder","WAWebVoipGatingUtils"],(function(t,n,r,o,a,i,l){function e(e,t,n,a){return e.nativeFlowName==null?!1:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_INFO||e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS?o("WAWebOrderDetails").getOrderInfo(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS?o("WAWebOrderStatus").getOrderStatusInfo(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS||e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD?o("WAWebOrderPaymentStatus").getOrderPaymentStatusInfoFromNativeFlow(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_REMINDER?o("WAWebPaymentReminder").isPaymentReminderEnabled()&&o("WAWebPaymentReminder").getPaymentReminderInfo(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").BOOKING_CONFIRMATION?o("WAWebBookingConfirmation").isBookingConfirmationEnabled()&&o("WAWebBookingConfirmation").getBookingConfirmationInfo(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK?s(e)!==!1:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK_STATUS?o("WAWebBizGatingUtils").isMessageWithLinkNfmEnabled():e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_CALL?o("WAWebBizTemplateAndInteractiveMessagesUtils").isInteractiveCtaMessageEnabled(r("WAWebInteractiveMessagesNativeFlowName").CTA_CALL,n,t)&&u(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_URL?o("WAWebBizTemplateAndInteractiveMessagesUtils").isInteractiveCtaMessageEnabled(r("WAWebInteractiveMessagesNativeFlowName").CTA_URL,n,t)&&u(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY?o("WAWebBizTemplateAndInteractiveMessagesUtils").isInteractiveCtaMessageEnabled(r("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY,n,t)&&u(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG?o("WAWebBizTemplateAndInteractiveMessagesUtils").isInteractiveCtaMessageEnabled(r("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG,n,t)&&u(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CATALOG_MESSAGE?o("WAWebBizTemplateAndInteractiveMessagesUtils").isInteractiveCtaMessageEnabled(r("WAWebInteractiveMessagesNativeFlowName").CATALOG_MESSAGE,n,t)&&u(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_COPY_CODE?o("WAWebBizTemplateAndInteractiveMessagesUtils").isInteractiveCtaMessageEnabled(r("WAWebInteractiveMessagesNativeFlowName").CTA_COPY_CODE,n,t)&&u(e)!=null:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").MIXED?!0:e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW?o("WAWebGalaxyFlowFeatureSupport").isFlowSupported(e,null,a):e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CALL_PERMISSION_REQUEST?o("WAWebVoipGatingUtils").isCoexCallingPermissionsEnabled():(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e.nativeFlowName)})()}function s(e){if(o("WAWebBizGatingUtils").isMessageWithLinkNfmEnabled()){if(e.nativeFlowName!==r("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK||e.type!==o("WAWebMsgType").MSG_TYPE.INTERACTIVE||e.interactiveType!==r("WAWebInteractiveMessageType").NATIVE_FLOW||e.interactivePayload==null)return!1;var t=e.interactivePayload;if(t!=null&&t.buttons&&t.buttons.length>0){var n=t.buttons[0],a=n.buttonParamsJson,i=n.name;if(i==="open_webview"&&a!=null)return!0}}return!1}function u(e){var t;return e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&e.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&e.nativeFlowName!=null&&o("WAWebBizTemplateAndInteractiveMessagesUtils").supportedNativeFlowButtonNamesForInteractiveMsg.includes(e.nativeFlowName)&&((t=e.interactivePayload)==null?void 0:t.buttons)!=null&&e.interactivePayload.buttons.forEach(function(e){var t=c(e);if(t)return!0}),!1}function c(e){var t=o("WAWebBizTemplateAndInteractiveMessagesUtils").getNativeFlowNameByButtonName(e.name);return t!=null&&o("WAWebBizTemplateAndInteractiveMessagesUtils").supportedNativeFlowButtonNamesForInteractiveMsg.includes(t)}l.isValidNativeFlowMessage=e}),98);
__d("WAWebParseNonNFMButtonsMessageProto",["WAWebButtonsMessageProtoUtils","WAWebE2EProtoUtils","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.bizInfo,a=e.messageProtobuf,i=e.msgContext,l=a.buttonsMessage;if(l!=null){var s=l.buttons,u=s===void 0?[]:s,c=l.headerType,d=r("WAWebInteractiveMessagesNativeFlowName").cast(o("WAWebE2EProtoUtils").getBizNativeFlowName({buttonsMessage:l}));if(!(d!=null||(n==null?void 0:n.nativeFlowName)!=null)){if(o("WAWebE2EProtoUtils").hasUnsupportedButtons(u))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:l.contextInfo};if(c===o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.UNKNOWN||!new Set(o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.members()).has(c))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown}),contextInfo:l.contextInfo};var m=o("WAWebButtonsMessageProtoUtils").parseButtonsMessageProto({buttonsMessage:l,baseMessage:t,msgContext:i});return u.length?{msgData:babelHelpers.extends({},m,{isDynamicReplyButtonsMsg:!0,dynamicReplyButtons:u}),contextInfo:l.contextInfo}:{msgData:m,contextInfo:l.contextInfo}}}}l.default=e}),98);
__d("WAWebMmSignalSharingContextInfo",["WAWebMmSignalSharingGatingUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return e==null||(t=e.dataSharingContext)==null?void 0:t.dataSharingFlags}function s(t){return e(t)!=null}function u(e){var t;return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()?e==null||(t=e.urlTrackingMap)==null?void 0:t.urlTrackingMapElements:null}function c(e){return u(e)!=null}l.getMmSignalSharingContextInfoDisclosureFlag=e,l.existsMmSignalSharingContextInfoDisclosureFlag=s,l.getMmSignalSharingURLTrackingMapElements=u,l.existsMmSignalSharingURlTrackingMapElements=c}),98);
__d("WAWebParseTemplateMessageProto",["WANullthrows","WAWebBizTemplateAndInteractiveMessagesUtils","WAWebE2EProtoUtils","WAWebMmSignalSharingContextInfo","WAWebMmSignalSharingGatingUtils","WAWebMsgType","WAWebParseDocumentMessageProto","WAWebParseImageMessageProto","WAWebParseInteractiveMessageProto","WAWebParseLocationMessageProto","WAWebParseVideoMessageProto"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,a=e.bizInfo,i=e.messageProtobuf,l=e.msgContext,u=i.templateMessage;if(u!=null&&!(l==="relay"&&(a==null?void 0:a.verifiedHsmEnvelope)!==!0)){var c=u.interactiveMessageTemplate;if(c)return s(n,l,u,a);var d=(t=u.hydratedTemplate)!=null?t:r("WANullthrows")(u.hydratedFourRowTemplate),m=d.documentMessage,p=d.hydratedButtons,_=d.hydratedContentText,f=d.hydratedFooterText,g=d.hydratedTitleText,h=d.imageMessage,y=d.locationMessage,C=d.templateId,b=d.videoMessage,v=function(){var e=babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.CHAT,kind:o("WAWebMsgType").MsgKind.Chat},!!_&&{body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(_)});if(h){var t,a;return(t=(a=r("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:h},baseMessage:n,msgContext:l}))==null?void 0:a.msgData)!=null?t:e}if(m){var i,s;return(i=(s=r("WAWebParseDocumentMessageProto")({messageProtobuf:{documentMessage:m},baseMessage:n,msgContext:l}))==null?void 0:s.msgData)!=null?i:e}if(y){var u,c;return(u=(c=r("WAWebParseLocationMessageProto")({messageProtobuf:{locationMessage:y},baseMessage:n,msgContext:l}))==null?void 0:c.msgData)!=null?u:e}if(b){var d,p;return(d=(p=r("WAWebParseVideoMessageProto")({messageProtobuf:{videoMessage:b},baseMessage:n,msgContext:l}))==null?void 0:p.msgData)!=null?d:e}return e};if(o("WAWebBizTemplateAndInteractiveMessagesUtils").buttonsViolateButtonImprovementsConstraints(p.map(function(e){return{hydratedTemplateButton:e}})))return{msgData:babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:void 0};var S=v();return{msgData:babelHelpers.extends({},S,{templateId:C,isFromTemplate:!0,caption:_?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(_):S.caption,footer:f?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(f):S.footer,title:g?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(g):S.title},p.length>0&&{hydratedButtons:p}),contextInfo:void 0}}}function s(e,t,n,a){var i,l,s,u,c=n.contextInfo,d=n.interactiveMessageTemplate,m=n.templateId,p=babelHelpers.extends({},e,{type:o("WAWebMsgType").MSG_TYPE.CHAT,kind:o("WAWebMsgType").MsgKind.Chat},!!(!(d==null||(i=d.body)==null)&&i.text)&&{body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(d==null||(l=d.body)==null?void 0:l.text)}),_=(s=(u=r("WAWebParseInteractiveMessageProto")({messageProtobuf:{interactiveMessage:d},baseMessage:e,msgContext:t,bizSource:e.bizSource||"",bizInfo:a}))==null?void 0:u.msgData)!=null?s:p;return{msgData:babelHelpers.extends({},_,{templateId:m,isFromTemplate:!0,caption:_.caption,footer:_.footer,title:_.title}),contextInfo:o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()&&(o("WAWebMmSignalSharingContextInfo").existsMmSignalSharingContextInfoDisclosureFlag()||o("WAWebMmSignalSharingContextInfo").existsMmSignalSharingURlTrackingMapElements()!=null)?c:void 0}}l.default=e}),98);
__d("WAWebQuotedMessageProtoUtils",["WALogger","WAWebE2EProtoParser","WAWebMsgType"],(function(t,n,r,o,a,i,l){var e;function s(e){var t=e.isCarouselCardReply,n=e.msgContext,r=e.quotedMsg;return o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:r,message:{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN},msgContext:n==="history"?"history_quoted":"quoted",bizSource:t?"quoted_carousel_card":null})}function u(t){try{return s(t)}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["failed parsing quoted message: ",""])),t).sendLogs("parse-quoted-msg-error"),null}}l.parseQuotedMessage=u}),98);
__d("WAWebApiActiveMessageRanges",["invariant","Promise","WALogger","WANullthrows","WAWebDBMsgUtils","WAWebProtobufSyncAction.pb","WAWebSchemaActiveMessageRanges","asyncToGeneratorRuntime","decodeProtobuf","err"],(function(t,n,r,o,a,i,l,s){var e,u,c=new Map,d={reset:function(){c=new Map},removeRange:function(t,n){var e;return(e=c.get(t))==null||e.delete(n),o("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().remove([t,n])},createOrReplaceRange:function(t){var e=c.get(t.chatId);return e==null&&(e=new Map,c.set(t.chatId,e)),e.set(t.action,t),o("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().createOrReplace(t)},bulkCreateOrReplaceRanges:function(t,r){return r===void 0&&(r=!0),t.forEach(function(e){var t=c.get(e.chatId);t==null&&(t=new Map,c.set(e.chatId,t)),t.set(e.action,e)}),r?o("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().bulkCreateOrReplace(t):(u||(u=n("Promise"))).resolve()},getRangesForChat:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=c.get(t);try{if(n==null){var r=yield o("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().anyOf(["chatId"],[t]);n=new Map(r.map(function(e){return[e.action,e]})),c.set(t,n)}}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getRangesForChat failed with error: ",""])),t)}return n?Array.from(n.values()):[]});function r(e){return t.apply(this,arguments)}return r})()};function m(e,t){return e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive,actionValue:r("WANullthrows")(t.archiveChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead,actionValue:r("WANullthrows")(t.markChatAsReadAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia,actionValue:r("WANullthrows")(t.clearChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia,actionValue:r("WANullthrows")(t.clearChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia,actionValue:r("WANullthrows")(t.clearChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia,actionValue:r("WANullthrows")(t.clearChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia,actionValue:r("WANullthrows")(t.deleteChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia?{action:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia,actionValue:r("WANullthrows")(t.deleteChatAction)}:e===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Unknown?s(!1,"unsupported action for message ranges: %s",e):(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function p(e,t,n){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r,a=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufSyncAction.pb").SyncActionValueSpec,n),i=m(t,a),l=i.actionValue,s=((r=l.messageRange)==null?void 0:r.messages)||[],u=yield o("WAWebDBMsgUtils").filterReceivedMessagesInRange(e,s),c=Math.max(0,s.length-u.length);return d.createOrReplaceRange(babelHelpers.extends({chatId:e},m(t,a),{remainingMessages:c}))}),_.apply(this,arguments)}function f(e,t){return d.removeRange(e,t)}function g(e,t){return t===void 0&&(t=!0),d.bulkCreateOrReplaceRanges(e,t)}function h(e){return d.getRangesForChat(e)}function y(e,t){var n=!!(t!=null&&t.deleteStarred),a=!!(t!=null&&t.deleteMedia);switch(e){case"archive":return o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive;case"markChatAsRead":return o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead;case"clearChat":return n&&a?o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:n&&!a?o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia:a&&!n?o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia;case"deleteChat":return a?o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia:o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia;default:throw r("err")("unsupported active message range action")}}l._cache=d,l.addActiveMessageRange=p,l.removeActiveMessageRange=f,l.bulkUpdateActiveMessageRanges=g,l.getActiveMessageRanges=h,l.getActiveRangeAction=y}),98);
__d("WAWebProtobufsMdStorageChatRowOpaqueData.pb",["$InternalEnum","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum")({NONE:0,IMAGE:1,VIDEO:2}),u={},c={},d={},m={};u.name="ChatRowOpaqueData",u.internalSpec={draftMessage:[1,(e=o("WAProtoConst")).TYPES.MESSAGE,c]},c.name="ChatRowOpaqueData$DraftMessage",c.internalSpec={text:[1,e.TYPES.STRING],omittedUrl:[2,e.TYPES.STRING],ctwaContextLinkData:[3,e.TYPES.MESSAGE,m],ctwaContext:[4,e.TYPES.MESSAGE,d],timestamp:[5,e.TYPES.INT64]},d.name="ChatRowOpaqueData$DraftMessage$CtwaContextData",d.internalSpec={conversionSource:[1,e.TYPES.STRING],conversionData:[2,e.TYPES.BYTES],sourceUrl:[3,e.TYPES.STRING],sourceId:[4,e.TYPES.STRING],sourceType:[5,e.TYPES.STRING],title:[6,e.TYPES.STRING],description:[7,e.TYPES.STRING],thumbnail:[8,e.TYPES.STRING],thumbnailUrl:[9,e.TYPES.STRING],mediaType:[10,e.TYPES.ENUM,s],mediaUrl:[11,e.TYPES.STRING],isSuspiciousLink:[12,e.TYPES.BOOL]},m.name="ChatRowOpaqueData$DraftMessage$CtwaContextLinkData",m.internalSpec={context:[1,e.TYPES.STRING],sourceUrl:[2,e.TYPES.STRING],icebreaker:[3,e.TYPES.STRING],phone:[4,e.TYPES.STRING]},l.ChatRowOpaqueData$DraftMessage$CtwaContextData$ContextInfoExternalAdReplyInfoMediaType=s,l.ChatRowOpaqueDataSpec=u,l.ChatRowOpaqueData$DraftMessageSpec=c,l.ChatRowOpaqueData$DraftMessage$CtwaContextDataSpec=d,l.ChatRowOpaqueData$DraftMessage$CtwaContextLinkDataSpec=m}),98);
__d("WAWebDBChatSerialization",["WAWebProtobufsMdStorageChatRowOpaqueData.pb","decodeProtobuf","encodeProtobuf"],(function(t,n,r,o,a,i,l){var e=["draftMessage"];function s(e){var t=babelHelpers.extends({},e);return u(t),t}function u(t){var n=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsMdStorageChatRowOpaqueData.pb").ChatRowOpaqueDataSpec,t.chatRowOpaqueData);e.forEach(function(e){(n==null?void 0:n[e])!=null&&(t[e]=n==null?void 0:n[e])})}function c(e){var t=babelHelpers.extends({},e);return d(t),t}function d(t){var n={};e.forEach(function(e){n[e]=t[e],delete t[e]});var r=o("encodeProtobuf").encodeProtobuf(o("WAWebProtobufsMdStorageChatRowOpaqueData.pb").ChatRowOpaqueDataSpec,n);t.chatRowOpaqueData=r.readBuffer()}l.deserializeChat=s,l.serializeChat=c}),98);
__d("WAWebApiChat",["Promise","WALogger","WATimeUtils","WAWeb-dexie","WAWebAck","WAWebBackendApi","WAWebBotUtils","WAWebBusinessHSMTypes","WAWebChatThreadLogging","WAWebCompactSet","WAWebDBChatSerialization","WAWebDBChatValidation","WAWebDBMessageUtils","WAWebDBMsgUtils","WAWebEphemeralityUtils","WAWebLidMigrationUtils","WAWebMiscErrors","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgType","WAWebSchemaChat","WAWebSchemaMessage","WAWebThreadId","WAWebThreadMetadataBulkJob","WAWebTrustedContactsUtils","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="CreateChatDuplicateError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));function w(e,t){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){o("WALogger").LOG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord ",""])),e.toLogString()),o("WAWebDBChatValidation").validateAccountLidInChatRow(t,"createChatRecord");try{yield o("WAWebSchemaChat").getChatTable().create(babelHelpers.extends({id:e.toString()},t))}catch(n){throw n instanceof o("WAWebMiscErrors").DbOnLogoutAbort?n:(o("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: create chat table failed"]))).verbose(),n instanceof r("WAWeb-dexie").ConstraintError?(yield re(e,t),new M):r("err")("create chat table failed"))}}),A.apply(this,arguments)}function F(e){return O.apply(this,arguments)}function O(){return O=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaChat").getChatTable().get(e.toString(),!1);return t?{unreadCount:t.unreadCount,timestamp:t.t}:(o("WALogger").ERROR(I||(I=babelHelpers.taggedTemplateLiteralLoose(["chat with id "," is not found"])),e.toString()),(N||(N=n("Promise"))).reject(r("err")("Failed to find row in chat table")))}),O.apply(this,arguments)}function B(t){return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateChatForMarkAsReadSync"]))),o("WAWebModelStorageUtils").getStorage().lock(["chat"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=yield n.get(t);if(r==null){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["updateMarkChatAsReadSync: could not find chat with id ",""])),t);return}if(r.unreadCount===-1)return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["updateMarkChatAsReadSync: createOrMerge"]))),n.createOrMerge(t,{id:t,unreadCount:0,unreadMentionsOfMe:[],unreadMentionCount:0})});return function(t){return e.apply(this,arguments)}})())}function W(e){return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["latestChatBulkUpdates: bulkCreateOrMerge"]))).tags("missing-lid"),o("WAWebDBChatValidation").validateAccountLidInChatRows(e,"latestChatBulkUpdates"),o("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(e)}function q(e){o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateChatLastAddOnPreview: bulkCreateOrMerge"]))).tags("missing-lid");var t=Array.from(e).map(function(e){var t=e[0],n=e[1];return{id:t,chatlistPreview:n,lastReactionPreview:void 0}});return o("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(t)}function U(e,t){return V.apply(this,arguments)}function V(){return V=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebSchemaMessage").getMessageTable().equals(["from","pendingReadReceipt"],[e,o("WAWebDBMsgUtils").PendingReadReceiptType.Message],{shouldDecrypt:!1});return n.filter(function(e){return e.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN?!1:t==null?!0:o("WAWebDBMessageUtils").messageHasThreadId(e,t)})}),V.apply(this,arguments)}function H(e){var t=e.chatId,a=e.keepChatUnread,i=e.lastReadRowId,l=e.threadId;o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["markMessageAndChatAsRead: "])));var s=o("WAWebWidFactory").createWid(t),u=o("WAWebBotUtils").isMetaAiBot(s),c=u?["message","chat","thread-metadata"]:["message","chat"];return o("WAWebModelStorageUtils").getStorage().lock(c,(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var s=e[0],c=e[1],d=e[2],m=yield U(t,u?l:void 0),_=[],f=0,g=[],h=new Set;m.forEach(function(e){e.hsmTag===o("WAWebBusinessHSMTypes").HSM_TAG_TYPE.AUTHENTICATION&&o("WAWebBackendApi").frontendFireAndForget("logOTPMessageReadActions",{msgRow:e});var t=i==null||e.rowId!=null&&e.rowId>i;if(t){if(f++,o("WAWebMsgGetters").getIsImportantMessage(e)){var n={id:e.id,timestamp:e.t};g.push(n)}return}if(_.push({id:e.id,ack:Math.max(e.ack,o("WAWebAck").ACK.READ),pendingReadReceipt:null}),u)for(var r of o("WAWebDBMessageUtils").getThreadIdsFromMessage(e))(l==null||r.equals(l))&&h.add(r.toString())});var y=[],C=u&&l!=null;if(C){if(_.length>0){var b=yield c.get(t);if(b!=null){var v,S,R,L=b.unreadCount,E=Math.max(L-_.length,0),k=(v=b.unreadDividerOffset)!=null?v:0,I=k+_.length,T=r("WAWebCompactSet")(_,function(e){return e.id}),D=(S=b.unreadMentionsOfMe)!=null?S:[],x=D.filter(function(e){return!T.has(e.id)}),$=D.length-x.length,P=(R=b.unreadMentionCount)!=null?R:0,M=Math.max(P-$,0);y.push(c.merge(t,{id:t,unreadCount:E,unreadDividerOffset:I,unreadMentionsOfMe:x,unreadMentionCount:M}))}}}else{var w=f===0&&a?-1:f;y.push(c.merge(t,{id:t,unreadCount:w,unreadDividerOffset:0,unreadMentionsOfMe:g,unreadMentionCount:0}))}if(_.length>0&&(o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["markMessageAndChatAsRead: bulkCreateOrMerge"]))).tags("missing-lid"),y.push(o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(_).then(function(){return o("WAWebChatThreadLogging").handleActivitiesForChatThreadLogging([{activityType:"msgRead",ts:o("WATimeUtils").unixTime(),chatId:o("WAWebWidFactory").createWid(t),readCount:_.length}])}))),yield(N||(N=n("Promise"))).all(y),h.size===0)return{fullyReadThreadIds:[]};var A=Array.from(h).map(function(e){return r("WAWebThreadId").from(e)});return yield o("WAWebThreadMetadataBulkJob").bulkUpdateThreadUnreadCountWithTable(d,A.map(function(e){return{threadId:e,unreadCount:0}})),{fullyReadThreadIds:A}});return function(t){return e.apply(this,arguments)}})())}function G(e,t){return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["addUnreadMentionChat"]))),o("WAWebModelStorageUtils").getStorage().lock(["chat"],(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=n[0],a=Array.from(e.keys());if(a.length!==0){var i=yield o("WAWebSchemaChat").getChatTable().bulkGet(a);if(!i||i.length===0){o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["addUnreadMentionChat: could not find chats"])));return}var l=[];return i.forEach(function(n){if(n){var r,o=n.id.toString(),a=(r=n.unreadMentionsOfMe)!=null?r:[],i=e.get(o);i&&(a=a.concat(i));var s={id:o,unreadMentionsOfMe:a};if(t){var u,c=(u=t.get(o))!=null?u:0;s={id:o,unreadMentionsOfMe:a,unreadMentionCount:c}}l.push(s)}}),o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["addUnreadMentionChat: bulkCreateOrMerge"]))).tags("missing-lid"),o("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(l)}});return function(e){return r.apply(this,arguments)}})())}function z(e){return o("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["removeUnreadMentionChat"]))),o("WAWebModelStorageUtils").getStorage().lock(["chat"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],r=Array.from(e.keys());if(r.length!==0){var a=yield o("WAWebSchemaChat").getChatTable().bulkGet(r);if(!a||a.length===0){o("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["removeUnreadMentionChat: could not find chats"])));return}var i=[];return a.forEach(function(t){if(t){var n,r=(n=t.unreadMentionsOfMe)!=null?n:[],o=e.get(t.id.toString());o&&(r=r.filter(function(e){return!o.includes(e.id)})),i.push({id:t.id.toString(),unreadMentionsOfMe:r})}}),o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["removeUnreadMentionChat: bulkCreateOrMerge"]))).tags("missing-lid"),o("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(i)}});return function(e){return t.apply(this,arguments)}})())}function j(e){return o("WALogger").LOG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["updateChatArchiveDrawer"]))),o("WAWebModelStorageUtils").getStorage().lock(["chat"],function(t){var r=t[0],a=Array.from(e.keys());if(a.length===0)return(N||(N=n("Promise"))).resolve();var i=a.map(function(t){var n,r=(n=e.get(t))!=null?n:!1;return{id:t,archiveAtMentionViewedInDrawer:r}});return o("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["updateChatArchiveDrawer: bulkCreateOrMerge"]))).tags("missing-lid"),r.bulkCreateOrMerge(i)})}function K(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=!0),o("WAWebModelStorageUtils").getStorage().lock(["chat"],(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var a,i=n[0],l=yield i.get(e);if(l==null){o("WALogger").ERROR(S||(S=babelHelpers.taggedTemplateLiteralLoose(["reduceChatUnreadCount: could not find chat with id ",""])),e);return}var s=Math.max(l.unreadCount-t,0),u=(a=l.unreadDividerOffset)!=null?a:0;return r&&(u+=t),i.merge(e,{unreadCount:s,unreadDividerOffset:u})});return function(e){return a.apply(this,arguments)}})())}function Q(){o("WALogger").LOG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredTcTokens"])));var e=o("WAWebTrustedContactsUtils").tokenExpirationCutoff(o("WAWebTrustedContactsUtils").TcTokenMode.Receiver);return o("WAWebModelStorageUtils").getStorage().lock(["chat"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],r=yield n.lessThan(["tcTokenTimestamp"],e);if(!(!r||r.length===0)){var a=r.map(function(e){return{id:e.id,tcToken:null,tcTokenTimestamp:null}});return o("WALogger").LOG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredTcTokens: bulkCreateOrMerge"]))).tags("missing-lid"),n.bulkCreateOrMerge(a)}});return function(e){return t.apply(this,arguments)}})())}function X(){var e=o("WAWebTrustedContactsUtils").tokenExpirationCutoff(o("WAWebTrustedContactsUtils").TcTokenMode.Receiver),t=[];return o("WAWebModelStorageUtils").getStorage().lock(["orphan-tc-token"],(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=n[0],o=yield r.all();return o.forEach(function(n){var r=n.tcTokenTimestamp;r!=null&&r<e&&t.push(n.chatId)}),r.bulkRemove(t)});return function(e){return r.apply(this,arguments)}})())}function Y(e){return o("WAWebSchemaChat").getChatTable().get(e.toString(),!1)}function J(e){return o("WAWebSchemaChat").getChatTable().anyOf(["accountLid"],[e.toString()])}function Z(e){return o("WAWebSchemaChat").getChatTable().bulkGet(e.map(function(e){return e.toString()}))}function ee(){return o("WAWebSchemaChat").getChatTable().all().then(function(e){return e.map(function(e){return o("WAWebDBChatSerialization").deserializeChat(e)})})}function te(e){return ne.apply(this,arguments)}function ne(){return ne=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){return e.id.toString()}),n=yield o("WAWebSchemaChat").getChatTable().bulkGet(t),r=e.map(function(e,t){var r=e;if(n[t]!=null){var a=n[t],i=a.disappearingModeInitiatedByMe,l=a.disappearingModeTrigger;i!=null&&(r=babelHelpers.extends({},r,{disappearingModeInitiatedByMe:i})),l!=null&&(r=babelHelpers.extends({},r,{disappearingModeTrigger:o("WAWebEphemeralityUtils").getDisappearingModeTriggerFromString(l)}))}return r});return r}),ne.apply(this,arguments)}function re(e,t){return oe.apply(this,arguments)}function oe(){return oe=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{if(o("WAWebLidMigrationUtils").shouldHaveAccountLid(e)){if(o("WALogger").LOG(T||(T=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: tried to create chat ",""])),e.toLogString()).tags("missing-lid"),t.accountLid!=null){var n=o("WAWebWidFactory").createUserLidOrThrow(t.accountLid),r=yield J(n);r.length===0?o("WALogger").LOG(D||(D=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: no chat with the same accountLid ",""])),n.toLogString()).tags("missing-lid"):o("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: found chat with the same accountLid ",". chat id: ",""])),n.toLogString(),o("WAWebWidFactory").createWid(r[0].id).toLogString()).tags("missing-lid")}}else o("WALogger").LOG($||($=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: no account lid provided"]))).tags("missing-lid")}catch(e){o("WALogger").LOG(P||(P=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: failed debugging duplicate record"]))).tags("missing-lid")}}),oe.apply(this,arguments)}l.CreateChatDuplicateError=M,l.createChatRecord=w,l.getChatMeta=F,l.updateChatForMarkAsReadSync=B,l.latestChatBulkUpdates=W,l.bulkUpdateChatLastAddOnPreview=q,l.queryPendingReadReceiptMsgRows=U,l.markMessageAndChatAsRead=H,l.addUnreadMentionChat=G,l.removeUnreadMentionChat=z,l.updateChatArchiveDrawer=j,l.reduceChatUnreadCount=K,l.pruneExpiredTcTokens=Q,l.pruneExpiredOrphanTcTokens=X,l.getChatRecord=Y,l.getChatRecordByAccountLid=J,l.bulkGetChats=Z,l.getAllChatsDeserialized=ee,l.injectAdditionalEphemeralInfoFromDB=te}),98);
__d("WAWebMessageReceiptUtils",["WAWebLidMigrationUtils","WAWebSchemaMessage","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=r("compactMap")(e,function(e){return o("WAWebLidMigrationUtils").getAlternateMsgKey(e)}),n=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(t.map(function(e){return e.toString()})),a=new Set(n.map(function(e){return e==null?void 0:e.id}));return r("compactMap")(e,function(e){var t=o("WAWebLidMigrationUtils").getAlternateMsgKey(e);return t&&a.has(t.toString())?t:e})}),s.apply(this,arguments)}l.fixStatusReceiptKeys=e}),98);
__d("WAWebOffdStorageUpdateOfflinePeerReceipts",["Promise","WAJids","WALogger","WAWebAck","WAWebBackendApi","WAWebDBBulkGetRootMsgs","WAWebDBChatValidation","WAWebDBMsgUtils","WAWebLid1X1MigrationGating","WAWebLidMigrationUtils","WAWebLidStatusMigrationKeyUtils","WAWebMarkAddOnsAsReadJob","WAWebMessageReceiptUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebSchemaChat","WAWebSchemaMessage","WAWebSchemaPeerReadReceipt","WAWebUsernameTypes","WAWebWidFactory","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s,u,c,d,m,p;function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(!o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated()||t.length===0)return t;for(var n=[],r=[],a=new Map,i=0;i<t.length;i++){var l=t[i];if(l.id!=null){var u=o("WAWebWidFactory").createWid(l.id);if(u!=null){if(!u.isRegularUser()){n.push(l);continue}var c=l.id;if(c!=null){r.push(c);var d=o("WAWebLidMigrationUtils").toLid(u);a.set(c,{chatUpdate:l,lid:d,chatWid:u})}}}}if(r.length>0)for(var m=yield o("WAWebSchemaChat").getChatTable().bulkGet(r),p=0;p<r.length;p++){var _=r[p],f=m[p],g=a.get(_);if(g!=null){var h=g.chatUpdate,y=g.chatWid,C=g.lid;if(f!=null)n.push(h);else if(C!=null){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["addAccountLidToUpdates: will add account_lid to ",", ",""])),y.toLogString(),C.toLogString());var b=babelHelpers.extends({},h,{accountLid:C.toString()});y.isLid()&&(b.lidOriginType=o("WAWebUsernameTypes").LidOriginType.GENERAL),n.push(b)}else o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["addAccountLidToUpdates: did not find Lid for missing chat ",""])),y.toLogString())}}return n}),f.apply(this,arguments)}function g(){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,"UpdatePeerReceipts_start"),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: start updatePeerReceipts"])));var e=yield o("WAWebSchemaPeerReadReceipt").getTable().all();if(o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated())yield(p||(p=n("Promise"))).all(e.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.msgKeys=yield o("WAWebDBBulkGetRootMsgs").fixMsgKeysWithChatId(e.msgKeys)});return function(t){return e.apply(this,arguments)}})()));else{var t=[],a=[];for(var i of e)for(var l of i.msgKeys){var s=r("WAWebMsgKey").fromString(l);s.remote.isLid()&&(i.ack===o("WAWebAck").ACK.READ?t.push(s):i.ack===o("WAWebAck").ACK.PLAYED&&a.push(s))}t.length>0&&e.push({ack:o("WAWebAck").ACK.READ,msgKeys:o("WAWebDBBulkGetRootMsgs").fixMsgKeysWithPnMapping(t).map(String)}),a.length>0&&e.push({ack:o("WAWebAck").ACK.PLAYED,msgKeys:Array.from(a,String)})}var m=[],f=[];e.forEach(function(e){e.ack===o("WAWebAck").ACK.READ?m.push(e):e.ack===o("WAWebAck").ACK.PLAYED?f.push(e):o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["updatePeerReceipts: unknown ack type: ",""])),e.ack)});var g=yield y(m),h=g.chatAckUpdates,C=g.chatUpdates,b=g.statusAckUpdates,v=h.concat(b),S=new Map(b.map(function(e){return[e.id,e]})),E=new Map(v.map(function(e){return[e.id,e]})),k=L(f);k.forEach(function(e){var t=E.get(e.id);t==null?E.set(e.id,e):E.set(e.id,babelHelpers.extends({},t,{ack:e.ack}))});var I=Array.from(E.values());o("WAWebBackendApi").frontendFireAndForget("updateOfflinePeerReceipt",{chatUpdates:C.map(function(e){var t;return{chatId:e.id,unreadCount:e.unreadCount,unreadMentionsOfMe:(t=e.unreadMentionsOfMe)!=null?t:[]}}),ackUpdates:I.map(function(e){var t=e.id;return S.has(e.id)&&(t=o("WAWebLidStatusMigrationKeyUtils").matKeyConvert(r("WAWebMsgKey").fromString(t)).toString()),{msgKey:t,ack:e.ack}})});var T=yield _(C);return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["updatePeerReceipts: bulkCreateOrMerge ",""])),T.slice(-15).map(function(e){return e.id}).join(",")).tags("missing-lid"),o("WAWebDBChatValidation").validateAccountLidInChatRows(T,"updatePeerReceipts"),yield(p||(p=n("Promise"))).all([o("WAWebModelStorageUtils").getStorage().lock(["message","chat"],function(e){var t=e[0],r=e[1];return(p||(p=n("Promise"))).all([t.bulkCreateOrMerge(I),r.bulkCreateOrMerge(T)])}).then(function(){}),o("WAWebMarkAddOnsAsReadJob").markUnclassifiedAddOnsAsReadJob(Array.from(R(m),function(e){return r("WAWebMsgKey").from(e)})).then(function(){})]),o("WAWebSchemaPeerReadReceipt").getTable().clear().then(function(){o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(o("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,"UpdatePeerReceipts_end")})}),h.apply(this,arguments)}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getUpdatesForPeerReadReceipts"])));var t=R(e),a=yield p(e),i=Array.from(a.keys()),l=i.reduce(function(e,t){return e.push([t,o("WAWebDBMsgUtils").PendingReadReceiptType.Message]),e.push([t,o("WAWebDBMsgUtils").PendingReadReceiptType.MessageEdit]),e},[]),s=yield o("WAWebSchemaMessage").getMessageTable().anyOf(["from","pendingReadReceipt"],l,{shouldDecrypt:!1});s.forEach(function(e){return f(a.get(e.from),e)}),s.forEach(function(e){return g(a.get(e.from),e)});var u=h(),c=yield v(t),d=r("compactMap")(i,function(e){var t=a.get(e);return t!=null&&t.lastUnreadMsgRowId!=null?{id:e,unreadCount:t.unreadCount,unreadMentionsOfMe:t.unreadMentionsOfMe}:null});return{chatUpdates:d,chatAckUpdates:u,statusAckUpdates:c};function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return new Map(e.flatMap(function(e){return e.msgKeys}).map(b).filter(function(e){return e!==o("WAJids").STATUS_JID}).map(function(e){return[e,{unreadCount:0,lastUnreadMsgRowId:void 0,unreadMentionsOfMe:[],unreadMentionCount:0}]}))}),_.apply(this,arguments)}function f(e,n){var r=n.id,o=n.rowId;e==null||o==null||t.has(r)&&(e.lastUnreadMsgRowId==null||o>e.lastUnreadMsgRowId)&&(e.lastUnreadMsgRowId=o)}function g(e,t){var n=t.rowId;if(!(e==null||n==null||e.lastUnreadMsgRowId==null)&&n>e.lastUnreadMsgRowId&&(e.unreadCount+=1,o("WAWebMsgGetters").getIsImportantMessage(t))){var r={id:t.id,timestamp:t.t};e.unreadMentionsOfMe.push(r)}}function h(){return r("compactMap")(s,function(e){var t=e.rowId,n=a.get(e.from);return n==null||t==null||n.lastUnreadMsgRowId==null?null:t<=n.lastUnreadMsgRowId?e.pendingReadReceipt===o("WAWebDBMsgUtils").PendingReadReceiptType.MessageEdit?null:{id:e.id,ack:o("WAWebAck").ACK.READ,pendingReadReceipt:null}:null})}}),C.apply(this,arguments)}function b(e){return r("WAWebMsgKey").fromString(e).remote.toString()}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=Array.from(e).filter(function(e){return b(e)===o("WAJids").STATUS_JID}).map(function(e){return r("WAWebMsgKey").fromString(e)}),n=yield o("WAWebMessageReceiptUtils").fixStatusReceiptKeys(t);return n.map(function(e){return{id:e.toString(),ack:o("WAWebAck").ACK.READ}})}),S.apply(this,arguments)}function R(e){return new Set(e.flatMap(function(e){return e.msgKeys}))}function L(e){var t=new Set;return e.forEach(function(e){e.ack===o("WAWebAck").ACK.PLAYED&&e.msgKeys.forEach(function(e){return t.add(e)})}),Array.from(t,function(e){return{id:e,ack:o("WAWebAck").ACK.PLAYED,pendingReadReceipt:null}})}l.addAccountLidToUpdates=_,l.updatePeerReceipts=g,l.getStatusMsgAckUpdates=v}),98);
__d("WAWebSchemaPendingDeviceSync",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(t,n,r,o,a,i,l){var e=o("WAWebStorageMutationBuilder").columnBuilder(),s=e.addUserDefinedPrimaryKey;function u(){o("WAWebOffdStorageUtils").getStorage().add("pending-device-sync").version(o("WAWebOffdStorageUtils").getStorage().versions.version(4),[s("id")]).view(function(e){return e})}function c(){return o("WAWebOffdStorageUtils").getStorage().table("pending-device-sync")}l.addTable=u,l.getTable=c}),98);
__d("WAWebApiPendingDeviceSync",["WALogger","WAWebSchemaPendingDeviceSync","WAWebSyncDeviceAdvDeviceListJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var t=yield o("WAWebSchemaPendingDeviceSync").getTable().all();yield o("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob(t.map(function(e){return o("WAWebWidFactory").createWid(e.id)}),null,null),yield o("WAWebSchemaPendingDeviceSync").getTable().bulkRemove(t.map(function(e){return e.id}))}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["doPendingDeviceSync failed during RESUME_WITH_OPEN_TAB"]))).verbose()}}),u.apply(this,arguments)}function c(e){return o("WAWebSchemaPendingDeviceSync").getTable().bulkCreateOrMerge(e.map(function(e){return{id:e}}))}l.doPendingDeviceSync=s,l.addUserToPendingDeviceSync=c}),98);
__d("WAWebTimestampConversionUtils",["WALogger","WALongInt","WATimeUtils"],(function(t,n,r,o,a,i,l){var e,s,u;function c(t){var n=t;try{o("WALongInt").numberOrThrowIfTooLarge(t)/o("WATimeUtils").unixTime()>10?(n=o("WALongInt").numberOrThrowIfTooLarge(t)/1e3,o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["syncd: maybeMillisecondsToSeconds: adjusting future timestamp"])))):o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncd: maybeMillisecondsToSeconds: no need to adjust timestamp"])))}catch(e){o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["syncd: maybeMillisecondsToSeconds: messageTimestamp: "," too large to cast"])),t)}return n}l.maybeMillisecondsToSeconds=c}),98);
__d("WAWebActiveMessageRanges",["WALogger","WALongInt","WAWebApiActiveMessageRanges","WAWebHandleForMessageRangeEnums","WAWebSchemaActiveMessageRanges","WAWebTimestampConversionUtils"],(function(t,n,r,o,a,i,l){var e,s;function u(t,n){if(t==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing message range from row."]))),o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN;var r=t.lastMessageTimestamp,a=t.messages,i=o("WAWebTimestampConversionUtils").maybeMillisecondsToSeconds(r!=null?r:0);if(i!==(r!=null?r:0)&&o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncd: last message timestamp was converted to seconds from ",""])),r).sendLogs("syncd: last message timestamp was converted to seconds",{sampling:.01}),n.t!=null&&n.t<o("WALongInt").numberOrThrowIfTooLarge(i))return o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_TIMESTAMP;var l=n.id;for(var u of a){var c=u.key;if(c!=null&&l!=null&&c.id===l.id)return o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL}return o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN}function c(e,t){o("WAWebApiActiveMessageRanges").getActiveMessageRanges(e.remote.toString()).then(function(n){n.forEach(function(n){if([o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive,o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead].includes(n.action)&&u(n.actionValue.messageRange,{id:e,t:t})===o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN)return o("WAWebApiActiveMessageRanges").removeActiveMessageRange(e.remote.toString(),n.action)})})}l.rangeContainsMessage=u,l.checkAndRemoveActiveMessageRanges=c}),98);
__d("WASyncdConst",["$InternalEnum","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=1e3,u=1e3*60*60,c=2,d=o("WATimeUtils").DAY_MILLISECONDS*2,m=100,p=2e3,_=10,f=100,g=0,h=3,y=7,C=0,b=(e=n("$InternalEnum"))({Star:"star",Contact:"contact",Mute:"mute",PinDEPRECATED:"pin",Pin:"pin_v1",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel",UnarchiveChatsSetting:"setting_unarchiveChats",DeleteChat:"deleteChat",AndroidUnsupportedActions:"android_unsupported_actions",PrimaryFeature:"primary_feature",Subscription:"subscription",Nux:"nux",Agent:"deviceAgent",TimeFormat:"time_format",UserStatusMute:"userStatusMute",PrimaryVersion:"primary_version",RemoveRecentSticker:"removeRecentSticker",ChatAssignment:"agentChatAssignment",ChatAssignmentOpenedStatus:"agentChatAssignmentOpenedStatus",FavoriteSticker:"favoriteSticker",PnForLidChat:"pnForLidChat",ShareOwnPn:"shareOwnPn",ExternalWebBeta:"external_web_beta",MarketingMessage:"marketingMessage",MarketingMessageBroadcast:"marketingMessageBroadcast",StatusPrivacy:"status_privacy",BotWelcomeRequest:"bot_welcome_request",LabelReordering:"label_reordering",PaymentInfo:"payment_info",CustomPaymentMethods:"custom_payment_methods",LockChat:"lock",ChatLockSettings:"setting_chatLock",DeviceCapabilities:"device_capabilities",DisableLinkPreviews:"setting_disableLinkPreviews",NoteEdit:"note_edit",Favorites:"favorites",MerchantPaymentPartner:"merchant_payment_partner",AvatarUpdated:"avatar_updated_action",AiThreadRename:"ai_thread_rename",AiThreadDelete:"ai_thread_delete",VoipRelayAllCalls:"setting_relayAllCalls",CallLog:"call_log",WaffleAccountLinkState:"waffle_account_link_state",PaymentTos:"payment_tos",Broadcast:"broadcast",BroadcastJid:"broadcast_jid",BusinessBroadcastList:"business_broadcast_list",DetectedOutcomeStatus:"detected_outcomes_status_action",InteractiveMessageAction:"interactive_message_action",LidContact:"lid_contact",AdsCtwaPerCustomerDataSharing:"ctwaPerCustomerDataSharing",SettingsSync:"settings_sync"}),v=e({Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"}),S=e.Mirrored(["Success","SuccessHasMore","Conflict","ConflictHasMore","ErrorRetry","ErrorFatal","Blocked"]),R=e.Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]),L=e.Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]),E=e.Mirrored(["Msg","Chat","Agent","ChatAssignment","UserStatusMute","Account","FavoriteSticker","Thread"]),k=e.Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]),I=e.Mirrored(["Patch","Snapshot","Local"]);l.BACKOFF_MIN_TIMEOUT=s,l.BACKOFF_MAX_TIMEOUT=u,l.BACKOFF_BASE=c,l.FINITE_FAILURE_EXPIRY_DURATION=d,l.MIN_INLINE_MUTATIONS=m,l.MAX_INLINE_MUTATIONS=p,l.MIN_PATCH_SIZE=_,l.MAX_PATCH_SIZE=f,l.DEFAULT_COLLECTION_VERSION=g,l.LABEL_ASSOCIATION_SYNC_VERSION=h,l.CHAT_ASSIGNMENT_SYNC_VERSION=y,l.MUTATION_NAME_INDEX=C,l.Actions=b,l.CollectionName=v,l.CollectionState=S,l.CollectionSyncState=R,l.SyncActionState=L,l.SyncModelType=E,l.ConflictResolutionState=k,l.SyncDataType=I}),98);
__d("WAWebWamEnumCollection",[],(function(t,n,r,o,a,i){var e=Object.freeze({REGULAR:1,REGULAR_LOW:2,REGULAR_HIGH:3,CRITICAL_BLOCK:4,CRITICAL_UNBLOCK_LOW:5});i.COLLECTION=e}),66);
__d("WAWebWamEnumMdSyncdCriticalEventCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({MESSAGE_RANGE_UNSET:1,MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET:2,MESSAGE_RANGE_MESSAGES_UNSET:3,MESSAGE_RANGE_MESSAGES_EMPTY:4,MESSAGE_RANGE_MESSAGES_CROSS_LIMIT:5,MESSAGE_RANGE_MESSAGE_KEY_UNSET:6,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET:7,MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET:8,MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET:9,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID:10,MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET:11,MALFORMED_PENDING_MUTATION:12,ACTION_INVALID_INDEX_DATA:13,MISSING_MUTATION_TO_REMOVE:14,LTHASH_INCONSISTENCY_ON_DAILY_CHECK:15,LTHASH_INCONSISTENCY_ON_SNAPSHOT_MAC_MISMATCH:16,NO_CONFIRMED_SET_MUTATION_FOR_A_PENDING_REMOVE:17,NO_KEY_DATA_FOR_A_PENDING_REMOVE_MUTATION:18});i.MD_SYNCD_CRITICAL_EVENT_CODE=e}),66);
__d("WAWebMdCriticalEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCollection","WAWebWamEnumMdSyncdCriticalEventCode"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({MdCriticalEvent:[2746,{collection:[2,o("WAWebWamEnumCollection").COLLECTION],mdCriticalEventCode:[1,o("WAWebWamEnumMdSyncdCriticalEventCode").MD_SYNCD_CRITICAL_EVENT_CODE],mutationActionName:[3,o("WAWebWamCodegenUtils").TYPES.STRING]},[1,1,1],"regular"]},{MdCriticalEvent:[]});l.MdCriticalEventWamEvent=e}),98);
__d("WAWebSyncdActionUtils",["WAWebProtobufSyncAction.pb","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return JSON.stringify([e].concat(t))}function s(t){var n=t.action,r=t.collection,a=t.indexArgs,i=t.operation,l=t.timestamp,s=t.value,u=t.version;return{collection:r,index:e(n,a),binarySyncAction:o("encodeProtobuf").encodeProtobuf(o("WAWebProtobufSyncAction.pb").SyncActionValueSpec,babelHelpers.extends({},s,{timestamp:l})).readBuffer(),version:u,operation:i,timestamp:l,action:n}}function u(e){var t=e.fromMe,n=e.id,r=e.participant,o=e.remoteJid;return[o,n,t?"1":"0",r!=null&&!t?r:"0"]}l.buildIndex=e,l.buildPendingMutation=s,l.buildMessageKey=u}),98);
__d("WAWebSyncdUtils",["WASyncdConst","WAWebMdCriticalEventWamEvent","WAWebSyncdActionUtils","WAWebWamEnumCollection"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebSyncdActionUtils").buildIndex(o("WASyncdConst").Actions.Star,u(e))}function s(e){return u(e.id)}function u(e){var t=c(e);return[e.remote.toString({legacy:!0}),e.id,e.fromMe?"1":"0",t]}function c(e){var t="0";return e.participant&&!e.remote.isUser()&&!e.fromMe&&(t=e.participant.toString({legacy:!0})),t}function d(e){return e===o("WASyncdConst").CollectionName.CriticalBlock?o("WAWebWamEnumCollection").COLLECTION.CRITICAL_BLOCK:e===o("WASyncdConst").CollectionName.CriticalUnblockLow?o("WAWebWamEnumCollection").COLLECTION.CRITICAL_UNBLOCK_LOW:e===o("WASyncdConst").CollectionName.Regular?o("WAWebWamEnumCollection").COLLECTION.REGULAR:e===o("WASyncdConst").CollectionName.RegularHigh?o("WAWebWamEnumCollection").COLLECTION.REGULAR_HIGH:e===o("WASyncdConst").CollectionName.RegularLow?o("WAWebWamEnumCollection").COLLECTION.REGULAR_LOW:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function m(e,t){var n=new(o("WAWebMdCriticalEventWamEvent")).MdCriticalEventWamEvent({mdCriticalEventCode:e});t!=null&&(n.collection=d(t)),n.commit()}function p(e){return JSON.parse(e)[o("WASyncdConst").MUTATION_NAME_INDEX]}l.constructStarMsgKeyFromMsgKey=e,l.constructMsgKeySegments=s,l.constructMsgKeySegmentsFromMsgKey=u,l.extractParticipantForSync=c,l.collectionNameToMetric=d,l.uploadCriticalEventMetric=m,l.getMutationNameFromIndex=p}),98);
__d("WAWebHandleForMessageRange",["Promise","WAWebActiveMessageRanges","WAWebAddonGatingUtils","WAWebApiActiveMessageRanges","WAWebHandleForMessageRangeEnums","WAWebMsgRangeContainmentHandlers","WAWebMsgType","WAWebProtobufSyncAction.pb","WAWebSchemaActiveMessageRanges","WAWebSyncdDb","WAWebSyncdUtils","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s=new Set,u=function(t){return t.reduce(function(e,t){return new Set([].concat(Array.from(e),Array.from(t)))},new Set)};function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){e:{if(e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive){return e.actionValue.archived===!0?yield o("WAWebMsgRangeContainmentHandlers").handleForArchive(e,n):yield o("WAWebMsgRangeContainmentHandlers").handleForUnarchive(e,n),s;break e}if(e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead){return yield o("WAWebMsgRangeContainmentHandlers").handleForMarkAsReadUnread(e,n,!!e.actionValue.read),s;break e}if(e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia||e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia){var r=o("WAWebMsgRangeContainmentHandlers").handleForClearChat(e,n);return r?new Set([r]):s}if(e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia||e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia){if(!(yield m(t.id))){var a=o("WAWebMsgRangeContainmentHandlers").handleForClearChat(e,n);return a?new Set([a]):s}return s}if(e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia||e.action===o("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia){var i=o("WAWebMsgRangeContainmentHandlers").handleForDeleteChat(e,n);return i?new Set([i]):s}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e.action)}}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebSyncdUtils").constructStarMsgKeyFromMsgKey(e),n=yield o("WAWebSyncdDb").getSyncAction(t);if(n){var r,a=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufSyncAction.pb").SyncActionDataSpec,n.binarySyncData).value;return(a==null||(r=a.starAction)==null?void 0:r.starred)||!1}return!1}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){if(a===void 0&&(a=!0),o("WAWebMsgType").SYSTEM_MESSAGE_TYPES.includes(r.type))return s;var i=yield o("WAWebApiActiveMessageRanges").getActiveMessageRanges(t.toString()),l=i.map(function(e){return[e,o("WAWebActiveMessageRanges").rangeContainsMessage(e.actionValue.messageRange,r)]}),d=l.filter(function(e){var t=e[1];return t===o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL}).map(function(e){var t=e[0];return t});d.forEach(function(e){e.remainingMessages--}),yield o("WAWebApiActiveMessageRanges").bulkUpdateActiveMessageRanges(d,a);var m=l.map(function(e){var t=e[0],n=e[1];return c(t,r,n)}),p=yield(e||(e=n("Promise"))).all(m);return u(p)}),f.apply(this,arguments)}function g(e){return!!(o("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(e.type)||e.type==="reaction"||e.type==="poll_update")}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=new Map;t.forEach(function(e){if(!(o("WAWebMsgType").SYSTEM_MESSAGE_TYPES.includes(e.type)||g(e))){var t=r.get(e.id.remote.toString());(t==null||t.t<e.t)&&r.set(e.id.remote.toString(),e)}}),yield(e||(e=n("Promise"))).all(Array.from(r.entries(),function(e){var t=e[0],n=e[1];return _(o("WAWebWidFactory").createWid(t),n)}))}),y.apply(this,arguments)}l.handleForActiveMessageRange=_,l.handleOfflineForMessageRange=h}),98);
__d("WAWebChatDbUpdatesApi",["WALogger","WAWebBackendApi","WAWebSchemaChat","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["setArchive: bulk update chat"])));try{var n=yield o("WAWebSchemaChat").getChatTable().bulkGet(t.map(function(e){return e.id})),r=t[n.indexOf(null)];r&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["setArchive: some chats to archive do not exist. first: ",""])),o("WAWebWidFactory").createWid(r.id).toLogString()).tags("missing-lid")}catch(e){o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["setArchive: failed to log missing chats"])))}yield o("WAWebSchemaChat").getChatTable().bulkMergeOnly(t);var a=t.map(function(e){return{id:o("WAWebWidFactory").createWid(e.id),archive:e.archive}});o("WAWebBackendApi").frontendFireAndForget("chatCollectionUpdate",{updates:a})}),d.apply(this,arguments)}l.setArchive=c}),98);
__d("WAWebMsgRangeContainmentHandlers",["WAWebApiActiveMessageRanges","WAWebBackendApi","WAWebChatDbUpdatesApi","WAWebHandleForMessageRangeEnums","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t===o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN){var n=yield o("WAWebUserPrefsMultiDevice").getArchiveV2EnabledSetting(),r=yield o("WAWebUserPrefsMultiDevice").getUnarchiveChatsSetting();(!n||r)&&o("WAWebChatDbUpdatesApi").setArchive([{id:e.chatId,archive:!1}]),yield o("WAWebApiActiveMessageRanges").removeActiveMessageRange(e.chatId,e.action)}}),s.apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){(t===o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN||e.remainingMessages===0)&&(yield o("WAWebApiActiveMessageRanges").removeActiveMessageRange(e.chatId,e.action))}),c.apply(this,arguments)}function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){t===o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN?yield o("WAWebApiActiveMessageRanges").removeActiveMessageRange(e.chatId,e.action):e.remainingMessages===0&&(o("WAWebBackendApi").frontendFireAndForget("updateChatReadStatus",{id:o("WAWebWidFactory").createWid(e.chatId),read:n}),yield o("WAWebApiActiveMessageRanges").removeActiveMessageRange(e.chatId,e.action))}),m.apply(this,arguments)}function p(e,t){return t===o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_TIMESTAMP||t===o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL?o("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.DropMessage:t===o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN?void 0:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})()}function _(e,t){switch(t){case o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_TIMESTAMP:case o("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL:return o("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.DropMessage;case o("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN:return}}l.handleForArchive=e,l.handleForUnarchive=u,l.handleForMarkAsReadUnread=d,l.handleForClearChat=p,l.handleForDeleteChat=_}),98);
__d("WAWebMessagingGatingUtils",["WAWebABProps","WAWebDBReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("web_send_invisible_msg_to_new_groups")}function s(){return o("WAWebABProps").getABPropConfigValue("web_send_invisible_msg_min_group_size")}function u(){return o("WAWebABProps").getABPropConfigValue("web_send_invisible_msg_max_group_size")}function c(){var e;return(e=o("WAWebABProps").getABPropConfigValue("group_size_bypassing_sampling"))!=null?e:1e5}function d(){return g()>0}function m(){return o("WAWebABProps").getABPropConfigValue("rt_receive_reporting_tag")}function p(){return o("WAWebABProps").getABPropConfigValue("rt_sync_reporting_tag")}function _(){var e;return(e=o("WAWebABProps").getABPropConfigValue("rt_clean_reporting_tag"))!=null?e:o("WAWebDBReportingTokenUtils").DEFAULT_RT_CLEANUP_OLDER_THAN_DAYS}function f(){return o("WAWebABProps").getABPropConfigValue("rt_clean_reporting_token")}function g(){return o("WAWebABProps").getABPropConfigValue("rt_sender_reporting_token_version")}function h(){return o("WAWebABProps").getABPropConfigValue("rt_sender_dual_encrypted_msg_enabled")}function y(){return o("WAWebABProps").getABPropConfigValue("rt_receiver_dual_encrypted_msg_enabled")}function C(){return o("WAWebABProps").getABPropConfigValue("rt_edit_receive")}function b(){return o("WAWebABProps").getABPropConfigValue("rt_web_delay_processing")}function v(){return o("WAWebABProps").getABPropConfigValue("rt_report_token_from_inclusion_list")}function S(){return o("WAWebABProps").getABPropConfigValue("ft_validation_failure_drop_placeholder")}function R(){return o("WAWebABProps").getABPropConfigValue("visible_message_drop_placeholder_enabled_internal_only")}function L(){return o("WAWebABProps").getABPropConfigValue("rt_swapped_fallback_validation")}function E(){return o("WAWebABProps").getABPropConfigValue("top_level_message_secret_check")}l.sendKeyDistributionMsgToNewGroups=e,l.sendKeyDistributionMsgMinGroupSize=s,l.sendKeyDistributionMsgMaxGroupSize=u,l.getGroupSizeBypassingSampling=c,l.isReportingTokenSendingEnabled=d,l.isReportingTokenReceivingEnabled=m,l.isReportingTagSyncingEnabled=p,l.getReportingTagCleanupDays=_,l.getReportingTokenCleanupDays=f,l.getSenderReportingTokenVersion=g,l.isDualEncryptedReportingTokenSendingEnabled=h,l.isDualEncryptedReportingTokenReceiveEnabled=y,l.isReportingTokenEditReceiveEnabled=C,l.isWebReportingTokenDelayProcessingEnabled=b,l.isReportingTokenFromInclusionListEnabled=v,l.isReportingTokenValidationFailureDebugPlaceholderEnabled=S,l.isMessageDropPlaceholderEnabled=R,l.isReportingTokenSwappedFallbackValidationEnabled=L,l.isTopLevelMessageSecretCheckEnabled=E}),98);
__d("WAWebOrderPaymentStatus",["$InternalEnum","WAWebE2EProtoUtils","WAWebInteractiveMessageType","WAWebMsgType","WAWebOrderStatus"],(function(t,n,r,o,a,i,l){var e,s=-1e3,u=(e=n("$InternalEnum"))({Pending:"pending",Captured:"captured",Failed:"failed"}),c=e({Confirm:"confirm",PaymentInstruction:"payment_instruction"}),d=e({CPI:"cpi",PIX:"pix",NATIVE:"native",PAYMENT_LINK:"payment_link",BOLETO:"boleto"}),m=e({P2M_LITE:"p2m_lite",P2M_PRO:"p2m_pro",P2M_BASIC:"p2m_basic"}),p=function(t){var e={};try{e=JSON.parse(t)}catch(e){return null}if(e==null)return null;var n=e,r=n.payment_method,o=n.payment_status,a=n.reference_id;return a==null||o==null&&r==null?null:{refId:a,paymentMethod:r,paymentStatus:o}},_=function(t){if(t==null)return null;try{var e=JSON.parse(t),n=e.order,r=e.reference_id,a=o("WAWebOrderStatus").OrderStatus.cast(n==null?void 0:n.status);return r==null||a==null?null:a}catch(e){return null}},f=function(t){var e;if(t.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&t.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&o("WAWebE2EProtoUtils").isOrderNativeFlow(t.nativeFlowName)&&(e=t.interactivePayload)!=null&&e.buttons){var n=t.interactivePayload,a=n.buttons[0].buttonParamsJson;if(a!=null)return p(a)}return null},g=function(t){var e;return t.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&t.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&o("WAWebE2EProtoUtils").isOrderNativeFlow(t.nativeFlowName)&&(e=t.interactivePayload)!=null&&e.buttons?t.interactivePayload.buttons[0]:null},h=function(t){var e=g(t);if(e==null)return null;var n=e.buttonParamsJson,r=e.name;return r!=null&&n!=null?p(n):null},y=function(t,n){var e=t.msgs.getModelsArray().slice(s),a=null,i=e.findLast(function(e){if(e.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN&&e.subtype==="phone_only_feature"&&e.quotedMsg!=null){var t;if(a=f(e.quotedMsg),((t=a)==null?void 0:t.refId)===n)return!0}else if(e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&e.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&o("WAWebE2EProtoUtils").isOrderNativeFlow(e.nativeFlowName)){var i;if(a=h(e),((i=a)==null?void 0:i.refId)===n)return!0}return!1});return i!=null&&a!=null?a:null};l.OrderPaymentStatus=u,l.OrderPaymentMethod=c,l.OrderAcceptedPaymentMethods=d,l.OrderP2MType=m,l.paramsJsonToOrderPaymentInfo=p,l.paramsJsonToOrderStatus=_,l.getOrderPaymentStatusInfo=f,l.getOrderPaymentStatusInfoFromNativeFlow=h,l.findLastOrderPaymentStatusInfo=y}),98);
__d("WAWebOrderStatus",["$InternalEnum","WAWebBizGatingUtils","WAWebE2EProtoUtils","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebOrderDetails","WAWebOrderPaymentStatus","WAWebOrderStatusButton"],(function(t,n,r,o,a,i,l){var e=-1e3,s=[r("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS,r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_INFO],u=n("$InternalEnum")({Pending:"pending",Processing:"processing",PartiallyShipped:"partially_shipped",Shipped:"shipped",Complete:"completed",Canceled:"canceled",PaymentRequested:"payment_requested",PreparingToShip:"preparing_to_ship",Delivered:"delivered",Confirmed:"confirmed",Delayed:"delayed",OutForDelivery:"out_for_delivery",Failed:"failed",Refunded:"refunded"}),c=function(t){if(t==null)return null;try{var e=JSON.parse(t),n=e.order,r=e.payment,a=e.reference_id,i=u.cast(n==null?void 0:n.status),l=null;return l=o("WAWebOrderPaymentStatus").OrderPaymentStatus.cast(r==null?void 0:r.status),a==null||i==null&&l==null?null:{refId:a,status:i,paymentStatus:l}}catch(e){return null}},d=function(t){var e;if(!o("WAWebE2EProtoUtils").isOrderNativeFlow(t.nativeFlowName))return null;if(t.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&t.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&(e=t.interactivePayload)!=null&&e.buttons){var n=t.interactivePayload.buttons[0].buttonParamsJson;return c(n)}else if(t.type===o("WAWebMsgType").MSG_TYPE.NATIVE_FLOW){var a,i=((a=t.nativeFlowButtons)!=null?a:[])[0].nativeFlowInfo;return c(i==null?void 0:i.paramsJson)}},m=function(t){return o("WAWebOrderStatusButton").getOrderStatusButton(t)!=null},p=function(t){var e=t.order,n=e.status,r=e.tracking;return r!=null&&n!==u.Canceled&&n!==u.Refunded&&n!==u.Failed},_=function(n,r){var t,a=n.msgs.getModelsArray().slice(e),i=(t=a.findLast(function(e){var t;return e.nativeFlowName!=null&&s.includes(e.nativeFlowName)&&((t=o("WAWebOrderDetails").getOrderInfo(e))==null?void 0:t.referenceId)===r}))==null?void 0:t.safe();return i},f=function(n,o){var t,a=n.msgs.getModelsArray().slice(e),i=(t=a.findLast(function(e){var t;return(e==null?void 0:e.nativeFlowName)===r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS&&((t=d(e))==null?void 0:t.refId)===o}))==null?void 0:t.safe();return i},g=function(n,a){var t,i=n.msgs.getModelsArray().slice(e),l=(t=i.findLast(function(e){var t,n;return(e==null?void 0:e.nativeFlowName)===r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS&&((t=d(e))==null?void 0:t.refId)===a||(e==null?void 0:e.nativeFlowName)===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS&&((n=o("WAWebOrderPaymentStatus").getOrderPaymentStatusInfoFromNativeFlow(e))==null?void 0:n.refId)===a}))==null?void 0:t.safe();return l},h=function(t){return t==null?null:t===u.Complete?o("WAWebOrderPaymentStatus").OrderPaymentStatus.Captured:t===u.Canceled||t===u.Failed?o("WAWebOrderPaymentStatus").OrderPaymentStatus.Failed:t===u.Pending||t===u.Processing||t===u.PartiallyShipped||t===u.Shipped||t===u.PaymentRequested||t===u.PreparingToShip||t===u.Delivered||t===u.Confirmed||t===u.Delayed||t===u.OutForDelivery||t===u.Refunded?o("WAWebOrderPaymentStatus").OrderPaymentStatus.Pending:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})()},y=function(t){return t==null?!1:t.items.length===0},C=function(t,n){return!t.contact.isEnterprise&&y(n)},b=function(t,n){return!t.contact.isEnterprise&&!y(n)},v=function(){return o("WAWebBizGatingUtils").isOrderStatusM1Enabled()?u.PaymentRequested:u.Pending},S=function(t,n){var e,r=f(t,n),o=r!=null?d(r):null;return(e=o==null?void 0:o.status)!=null?e:u.Pending},R=function(t,n){var e=g(t,n),a=null;if(e&&(e==null?void 0:e.nativeFlowName)===r("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS){var i=e!=null?d(e):null;a=i==null?void 0:i.paymentStatus,a==null&&(a=h(i==null?void 0:i.status))}else if(e&&(e==null?void 0:e.nativeFlowName)===r("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS){var l;a=(l=o("WAWebOrderPaymentStatus").getOrderPaymentStatusInfoFromNativeFlow(e))==null?void 0:l.paymentStatus}return a},L=function(t,n){var e=t.msgs.reduce(function(e,t){var r,a=o("WAWebOrderStatusButton").getOrderStatusButton(t),i=t.safe();return a==null||i.type!==o("WAWebMsgType").MSG_TYPE.INTERACTIVE||a.reference_id!==n.reference_id?e:{first:(r=e.first)!=null?r:i,last:i}},{first:null,last:null}),r=e.first,a=e.last,i=r&&o("WAWebOrderStatusButton").getOrderStatusButton(r),l=a&&o("WAWebOrderStatusButton").getOrderStatusButton(a),s=(i!=null?i:n).order.items;return{drawerButton:babelHelpers.extends({},l!=null?l:n,{order:babelHelpers.extends({},(l!=null?l:n).order,{items:s})}),messageBubbleButton:babelHelpers.extends({},n,{order:babelHelpers.extends({},n.order,{items:s})}),firstMessage:r,lastMessage:a}};l.OrderStatus=u,l.paramsJsonToOrderStatusInfo=c,l.getOrderStatusInfo=d,l.hasOrderStatusButton=m,l.shouldShowTrackingInfo=p,l.findOrderDetailsMessage=_,l.isSimplifiedOrder=y,l.isPaymentRequest=C,l.isCharge=b,l.getDefaultOrderStatus=v,l.findOrderStatus=S,l.findOrderPaymentStatus=R,l.getMergedOrderStatus=L}),98);
__d("WAWebWamEnumCoexStatusReplyPrivacyDisclaimerUserAction",[],(function(t,n,r,o,a,i){var e=Object.freeze({DISPLAYED:1,TAPPED:2});i.COEX_STATUS_REPLY_PRIVACY_DISCLAIMER_USER_ACTION=e}),66);
__d("WAWebWamEnumCoexSysMsgInsertionChannel",[],(function(t,n,r,o,a,i){var e=Object.freeze({CHAT_OPEN:0,MESSAGE_RECEIVE:1,HISTORY_SYNC:2});i.COEX_SYS_MSG_INSERTION_CHANNEL=e}),66);
__d("WAWebWamEnumCoexSysMsgStateTransitionAttempt",[],(function(t,n,r,o,a,i){var e=Object.freeze({E2EE_TO_HOSTED:0,HOSTED_TO_E2EE:1,HOSTED_TO_HOSTED:2});i.COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT=e}),66);
__d("WAWebCoexPrivacySysMsgWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCoexStatusReplyPrivacyDisclaimerUserAction","WAWebWamEnumCoexSysMsgInsertionChannel","WAWebWamEnumCoexSysMsgStateTransitionAttempt"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({CoexPrivacySysMsg:[5204,{coexStatusReplyPrivacyDisclaimerUserAction:[8,o("WAWebWamEnumCoexStatusReplyPrivacyDisclaimerUserAction").COEX_STATUS_REPLY_PRIVACY_DISCLAIMER_USER_ACTION],coexSysMsgBusinessId:[1,e.TYPES.STRING],coexSysMsgInsertionChannel:[9,o("WAWebWamEnumCoexSysMsgInsertionChannel").COEX_SYS_MSG_INSERTION_CHANNEL],coexSysMsgInsertionErrorCode:[2,e.TYPES.INTEGER],coexSysMsgInsertionErrorMsg:[3,e.TYPES.STRING],coexSysMsgInsertionSuccess:[4,e.TYPES.BOOLEAN],coexSysMsgIsSelf:[5,e.TYPES.BOOLEAN],coexSysMsgMultiDeviceId:[6,e.TYPES.INTEGER],coexSysMsgStateTransitionAttempt:[7,o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT]},[1,1,1],"private",113760892]},{CoexPrivacySysMsg:[]});l.CoexPrivacySysMsgWamEvent=s}),98);
__d("WAWebBizCoexUtils",["WALogger","WATimeUtils","WAWebBizCoexGatingUtils","WAWebCoexPrivacySysMsgWamEvent","WAWebMsgKey","WAWebOfflineDeviceCache","WAWebOfflineHandler","WAWebSchemaChat","WAWebSyncDeviceAdvDeviceListJob","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","WAWebWamEnumCoexSysMsgInsertionChannel","WAWebWamEnumCoexSysMsgStateTransitionAttempt","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s=99,u=["biz_account_type_is_hosted","biz_account_type_changed_to_hosted","biz_me_account_type_is_hosted","biz_me_account_type_is_hosted_transition"],c=new Set,d=new Set;function m(e){return e.some(function(e){return e.isHosted()})}function p(e,t){var n;!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()||e==null||((n=e[0])==null?void 0:n.id)===s&&_(t)}function _(e){o("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()?o("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob([e],null,null):o("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(e.toString(),null)}function f(e){return!o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()||e==null?!1:u.includes(e)}function g(e){return o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()?!!(o("WAWebUserPrefsMultiDevice").getIsHostedMeAccountFromLocalStorage()||e.isHosted===!0):!1}function h(e){o("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&C(e.map(function(e){var t=e[0],n=e[1];return t==null?null:{id:t.id,subtype:t.subtype}}))}function y(e){var t;C([{id:e==null||(t=e.id)==null?void 0:t.toString(),subtype:e==null?void 0:e.subtype,channel:o("WAWebWamEnumCoexSysMsgInsertionChannel").COEX_SYS_MSG_INSERTION_CHANNEL.HISTORY_SYNC}])}function C(t){try{var n,a=o("WAWebUserPrefsMeUser").getMaybeMeDevicePn(),i=(n=a==null?void 0:a.device)!=null?n:0;t.forEach(function(e){if((e==null?void 0:e.id)!=null){var t=r("WAWebMsgKey").fromString(e.id),n={coexSysMsgInsertionSuccess:!0,coexSysMsgMultiDeviceId:i,coexSysMsgStateTransitionAttempt:o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT.E2EE_TO_HOSTED,coexSysMsgIsSelf:!1},l=new(o("WAWebCoexPrivacySysMsgWamEvent")).CoexPrivacySysMsgWamEvent(n);switch(e.channel!=null&&(l.coexSysMsgInsertionChannel=e.channel),e.subtype){case"biz_account_type_is_hosted":{l.coexSysMsgStateTransitionAttempt=o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT.HOSTED_TO_HOSTED,l.coexSysMsgBusinessId=t.remote.user;break}case"biz_account_type_changed_to_hosted":{l.coexSysMsgStateTransitionAttempt=o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT.E2EE_TO_HOSTED,l.coexSysMsgBusinessId=t.remote.user;break}case"biz_me_account_type_is_hosted":{var s;l.coexSysMsgIsSelf=!0,l.coexSysMsgStateTransitionAttempt=o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT.HOSTED_TO_HOSTED,l.coexSysMsgBusinessId=(s=a==null?void 0:a.user)!=null?s:"";break}case"biz_me_account_type_is_hosted_transition":{var u;l.coexSysMsgIsSelf=!0,l.coexSysMsgStateTransitionAttempt=o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT.E2EE_TO_HOSTED,l.coexSysMsgBusinessId=(u=a==null?void 0:a.user)!=null?u:"";break}case"encrypt":{var c;l.coexSysMsgStateTransitionAttempt=o("WAWebWamEnumCoexSysMsgStateTransitionAttempt").COEX_SYS_MSG_STATE_TRANSITION_ATTEMPT.HOSTED_TO_E2EE,l.coexSysMsgBusinessId=t==null||(c=t.remote)==null?void 0:c.user;break}default:return}l.commit()}})}catch(t){var l=r("getErrorSafe")(t);o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[coex] wam event commit failed: "," ",""])),l.name,l.message).verbose().sendLogs("coex wam event commit failed")}}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(c.has(e))return!1;var t=yield o("WAWebSchemaChat").getChatTable().get(e,!1);return c.add(e),!t}),v.apply(this,arguments)}function S(e){c.delete(e.toString())}function R(e){var t=e.toString()+"_"+o("WATimeUtils").unixTime().toString();return d.has(t)?!0:(d.add(t),!1)}function L(){d.clear()}l.HOSTED_DEVICE_ID=s,l.fanoutListContainsHostedDevice=m,l.triggerUsyncForCoexDeviceAdd=p,l.triggerUsyncForCoexUpdate=_,l.isCoexSystemMsgType=f,l.isMeOrCurrentContactHosted=g,l.sendWamCoexPrivacySysMsgInsertSuccess=h,l.sendWamCoexPrivacySysMsgHistorySyncInsert=y,l.shouldCreateFallbackHostedAdvSystemMsgOnPlaceholder=b,l.deleteChatFromFallbackHostedAdvSystemMsgOnPlaceholderCache=S,l.shouldDedupInitialHostedSystemMsg=R,l.clearDedupInitialHostedSystemMsgCache=L}),98);
__d("WAWebBotSystemMsg",["WATimeUtils","WAWebBotGating","WAWebContactSystemMsg","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebContactSystemMsg").genNotificationMsg(e,{type:"notification_template",kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"bot_init",templateParams:[]})}function s(e,t){var n;if(o("WAWebBotGating").isBotEnabled()&&!t.id.isBot()&&e.botMessageSecret!=null&&t.hasCreatedBotInvokeSystemMsg!==!0&&(n=e.invokedBotWid)!=null&&n.isBot()){var r=u(t.id);return r}return null}function u(e,t){return o("WAWebContactSystemMsg").genNotificationMsg(e,{type:o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"bot_invoke_disclaimer",templateParams:[],t:t!=null?t:o("WATimeUtils").unixTime()})}function c(e){return o("WAWebContactSystemMsg").genNotificationMsg(e,{type:o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"biz_bot_1p_disclosure",templateParams:[]})}function d(e){return o("WAWebContactSystemMsg").genNotificationMsg(e,{type:o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"biz_bot_3p_disclosure",templateParams:[]})}function m(e,t){return o("WAWebContactSystemMsg").genNotificationMsg(e,{type:o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,kind:o("WAWebMsgType").MsgKind.NotificationTemplate,subtype:"bot_session_transparency_notice",botSessionTransparencyType:t,templateParams:[]})}l.genBotInitSystemMsg=e,l.getMaybeSysMsgForBotInvoke=s,l.createBotInvokeSystemMsg=u,l.genBizBot1pDisclosureMessage=c,l.genBizBot3pDisclosureMessage=d,l.genBotSessionTransparencyNoticeSystemMsg=m}),98);
__d("WAWebAddBotTransparencyNotice",["WAWebBotSystemMsg","WAWebHandleSingleMsg","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WAWebBotSystemMsg").genBotSessionTransparencyNoticeSystemMsg(e,t);yield o("WAWebHandleSingleMsg").handleSingleMsg({chatId:e,newMsg:n,handleSingleMsgOrigin:"limitSharing"})}),s.apply(this,arguments)}l.addBotSessionTransparencyNotice=e}),98);
__d("WAWebBotSessionTransparencyNotice",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({AiSafetyDisclaimer:1});i.BotSessionTransparencyType=e}),66);
__d("WAWebParseBotSessionTransparencyNotice",["WAWebBotGating","WAWebBotSessionTransparencyNotice","WAWebProtobufsAICommon.pb"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,r=t==null||(n=t.botMetadata)==null||(n=n.sessionTransparencyMetadata)==null?void 0:n.sessionTransparencyType;if(r!=null)e:{if(r===o("WAWebProtobufsAICommon.pb").SessionTransparencyType.UNKNOWN_TYPE)return;if(r===o("WAWebProtobufsAICommon.pb").SessionTransparencyType.NY_AI_SAFETY_DISCLAIMER)return o("WAWebBotGating").isAiContinuousSessionTransparencyNoticeEnabled(e)?o("WAWebBotSessionTransparencyNotice").BotSessionTransparencyType.AiSafetyDisclaimer:void 0;throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+r)}}l.parseBotSessionTransparencyNotice=e}),98);
__d("WAWebBotMetadataProtoUtils",["WALogger","WAWebAddBotTransparencyNotice","WAWebBotGroupGatingUtils","WAWebParseBotSessionTransparencyNotice","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e;function s(t,n,r){var a,i,l,s,c,d,m,p;if(r===void 0&&(r=!1),o("WAWebBotGroupGatingUtils").isOpenGroupBotParticipantAddEnabled()&&(n==null||(a=n.botMetadata)==null?void 0:a.botGroupMetadata)!=null)try{var _,f=n==null||(_=n.botMetadata)==null||(_=_.botGroupMetadata)==null||(_=_.participantsMetadata)==null||(_=_[0])==null?void 0:_.botFbid;if(f!=null&&(t.botGroupParticipant=o("WAWebWidFactory").createWid(f+"@bot")),r===!0)return}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[bot group] botGroupMetadata failed with error: ",""])),t).sendLogs("failed-to-process-bot-group-meta")}(n==null||(i=n.botMetadata)==null||(i=i.pluginMetadata)==null?void 0:i.pluginType)!=null?t.botPluginType=n.botMetadata.pluginMetadata.pluginType:(n==null||(l=n.botMetadata)==null?void 0:l.pluginMetadata)!=null&&(t.botPluginMaybeParent=!0),(n==null||(s=n.botMetadata)==null||(s=s.pluginMetadata)==null?void 0:s.referenceIndex)!=null&&(t.botPluginReferenceIndex=n.botMetadata.pluginMetadata.referenceIndex),(n==null||(c=n.botMetadata)==null||(c=c.pluginMetadata)==null?void 0:c.provider)!=null&&(t.botPluginSearchProvider=n.botMetadata.pluginMetadata.provider),(n==null||(d=n.botMetadata)==null||(d=d.pluginMetadata)==null?void 0:d.searchProviderUrl)!=null&&(t.botPluginSearchUrl=n.botMetadata.pluginMetadata.searchProviderUrl),(n==null||(m=n.botMetadata)==null||(m=m.pluginMetadata)==null?void 0:m.thumbnailCdnUrl)!=null&&(t.botReelPluginThumbnailCdnUrl=n.botMetadata.pluginMetadata.thumbnailCdnUrl),(n==null||(p=n.botMetadata)==null||(p=p.pluginMetadata)==null?void 0:p.searchQuery)!=null&&(t.botPluginSearchQuery=n.botMetadata.pluginMetadata.searchQuery),u(t,n)}function u(e,t){var n,r=e.id.remote,a=o("WAWebParseBotSessionTransparencyNotice").parseBotSessionTransparencyNotice(r,t);if(a!=null){o("WAWebAddBotTransparencyNotice").addBotSessionTransparencyNotice(r,a);return}if((t==null||(n=t.botMetadata)==null?void 0:n.messageDisclaimerText)!=null){var i;e.botMessageDisclaimerText=t==null||(i=t.botMetadata)==null?void 0:i.messageDisclaimerText}}l.parseBotMetadataProto=s}),98);
__d("WAWebParseBotFeedbackProtocolMessageProto",["WAWebBotTypes","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsAICommon.pb","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.protocolMessage;if(r!=null){var a=r.botFeedbackMessage,i=r.type;if(i===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.BOT_FEEDBACK_MESSAGE&&a!=null){var l=a.kind,s=a.messageKey,u=a.text;if(s!=null&&l!=null){var c;switch(l){case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_POSITIVE:c=o("WAWebBotTypes").BotFeedbackKind.POSITIVE;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_GENERIC:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_GENERIC;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_HELPFUL:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_HELPFUL;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_INTERESTING:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_INTERESTING;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_ACCURATE:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_ACCURATE;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_SAFE:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_SAFE;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_OTHER:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_OTHER;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_REFUSED:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_REFUSED;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_NOT_VISUALLY_APPEALING:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_VISUALLY_APPEALING;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_NOT_RELEVANT_TO_TEXT:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_RELEVANT_TO_TEXT;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_CLARITY:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_ENTERTAINING;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_DOESNT_LOOK_LIKE_THE_PERSON:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_CUSTOMIZABLE;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_PERSONALIZED:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_INTERESTING;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_HALLUCINATION_INTERNAL_ONLY:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_GENERIC;break;case o("WAWebProtobufsAICommon.pb").BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE:c=o("WAWebBotTypes").BotFeedbackKind.NEGATIVE_GENERIC;break}if(c!=null)return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"bot_feedback",protocolMessageKey:o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(s,t),botFeedbackKind:c,botFeedbackText:u}),contextInfo:null}}}}}l.default=e}),98);
__d("WAWebParseForwardedAiBotMessageInfo",["WANullthrows","WAWebE2EProtoUtils","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botJid,n=e.botName,a=e.creatorName,i=o("WAWebE2EProtoUtils").strictDecodeJid(t);return{botId:o("WAWebWidFactory").asBotWidOrThrow(r("WANullthrows")(i)),botName:n,creatorName:a}}l.parseForwardedAiBotMessageInfo=e}),98);
__d("WAWebParseChatMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebParseExtendedTextMessageProtoUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.conversation,i=n.extendedTextMessage;if(!(a==null&&i==null)){if(a!=null)return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.CHAT,kind:o("WAWebMsgType").MsgKind.Chat,body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a)}),contextInfo:void 0};if(!o("WAWebParseExtendedTextMessageProtoUtils").isUrlExtendedTextMessage(i))return o("WAWebParseExtendedTextMessageProtoUtils").parseExtendedTextMessageProto({messageProtobuf:n,baseMessage:t,msgContext:r})}}l.default=e}),98);
__d("WAWebParseExtendedTextUrlChatMessageProto",["WAWebMsgType","WAWebParseExtendedTextMessageProtoUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=e.rcat,i=n.extendedTextMessage;if(i!=null&&o("WAWebParseExtendedTextMessageProtoUtils").isUrlExtendedTextMessage(i)){var l=o("WAWebParseExtendedTextMessageProtoUtils").parseExtendedTextMessageProto({messageProtobuf:n,baseMessage:t,msgContext:r}),s=babelHelpers.extends({},t,l==null?void 0:l.msgData,{type:o("WAWebMsgType").MSG_TYPE.CHAT,kind:o("WAWebMsgType").MsgKind.Chat,subtype:"url",rcat:a});return{msgData:s,contextInfo:i==null?void 0:i.contextInfo}}}l.default=e}),98);
__d("WAWebParseExtendedTextMessageProtoUtils",["WALongInt","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){return!!(e!=null&&e.matchedText)||!!(e!=null&&e.description)||!!(e!=null&&e.title)}function s(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.extendedTextMessage;if(r!=null){var a=o("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$FontType,i;if((r==null?void 0:r.font)!=null)switch(r.font){case a.SYSTEM:case a.SYSTEM_TEXT:case a.FB_SCRIPT:case a.SYSTEM_BOLD:case a.MORNINGBREEZE_REGULAR:case a.CALISTOGA_REGULAR:case a.EXO2_EXTRABOLD:case a.COURIERPRIME_BOLD:i=r.font;break}var l=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.CHAT,kind:o("WAWebMsgType").MsgKind.Chat,body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis((r==null?void 0:r.text)||""),matchedText:r==null?void 0:r.matchedText,description:r==null?void 0:r.description,title:r==null?void 0:r.title,thumbnail:o("WAWebE2EProtoParserApi").decodeBytes(r==null?void 0:r.jpegThumbnail)||"",richPreviewType:r==null?void 0:r.previewType,doNotPlayInline:r==null?void 0:r.doNotPlayInline,textColor:r==null?void 0:r.textArgb,backgroundColor:r==null?void 0:r.backgroundArgb,mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(r==null?void 0:r.mediaKey),mediaKeyTimestamp:(r==null?void 0:r.mediaKeyTimestamp)!=null?o("WALongInt").numberOrThrowIfTooLarge(r.mediaKeyTimestamp):t.mediaKeyTimestamp,thumbnailDirectPath:r==null?void 0:r.thumbnailDirectPath,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(r==null?void 0:r.thumbnailSha256),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(r==null?void 0:r.thumbnailEncSha256),thumbnailHeight:r==null?void 0:r.thumbnailHeight,thumbnailWidth:r==null?void 0:r.thumbnailWidth,inviteGrpType:(r==null?void 0:r.inviteLinkGroupTypeV2)!=null?o("WAWebE2EProtoParserApi").parseInviteGrpType(r==null?void 0:r.inviteLinkGroupTypeV2):t.inviteGrpType,font:i!=null?i:t.font,paymentLinkMetadata:r==null?void 0:r.paymentLinkMetadata,faviconMMSMetadata:u(r==null?void 0:r.faviconMMSMetadata,t.mediaKeyTimestamp)});return{msgData:l,contextInfo:r==null?void 0:r.contextInfo}}}function u(e,t){return e==null?null:{mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(e.mediaKey),mediaKeyTimestamp:e.mediaKeyTimestamp!=null?o("WALongInt").numberOrThrowIfTooLarge(e.mediaKeyTimestamp):t,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(e.thumbnailSha256),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(e.thumbnailEncSha256),thumbnail:null}}l.isUrlExtendedTextMessage=e,l.parseExtendedTextMessageProto=s,l.parseFaviconMMSMetadata=u}),98);
__d("WAWebAddonCreateMsgProcessor",["WAWebAddonConstants"],(function(t,n,r,o,a,i,l){function e(e){return babelHelpers.extends({},e,{type:o("WAWebAddonConstants").AddonProcessorType.Regular})}function s(e){return babelHelpers.extends({},e,{type:o("WAWebAddonConstants").AddonProcessorType.DualEncrypted})}function u(e){return babelHelpers.extends({},e,{type:o("WAWebAddonConstants").AddonProcessorType.DualEncryptedWithMessageTraits})}l.createAddonMsgProcessor=e,l.createAddonMsgProcessorDualEncrypted=s,l.createAddonMessageProcessorDualEncryptedWithMessageTraits=u}),98);
__d("WAWebAddonCommentMsgProcessor",["Promise","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebApiChat","WAWebBackendApi","WAWebBoolFunc","WAWebCommentParseWebMsgInfoComment","WAWebCommentUtils","WAWebDBCommentMessageSerialization","WAWebLastAddOnDBSerialization","WAWebMsgType","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=o("WAWebAddonCreateMsgProcessor").createAddonMessageProcessorDualEncryptedWithMessageTraits({isEnabled:o("WAWebBoolFunc").returnTrue,convert:{fromHistorySyncMsg:function(r){var t=o("WAWebCommentParseWebMsgInfoComment").parseWebMsgInfoComment(r);return(e||(e=n("Promise"))).resolve(t)},toDualEncryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.CommentEncrypted?e:o("WAWebCommentUtils").commentMsgDataToEncCommentMsgData(e,t)});function t(t,n){return e.apply(this,arguments)}return t})(),toDualDecryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.CommentDecrypted?e:o("WAWebCommentUtils").encCommentMsgDataToCommentMsgData(e,t)});function t(t,n){return e.apply(this,arguments)}return t})()},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebBackendApi").frontendSendAndReceive("upsertCommentModelCollection",{comments:e.add,commentsToRemove:e.remove})});function t(t){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.parents,r=[];for(var a of e)if(a.kind===o("WAWebMsgType").MsgKind.CommentEncrypted){var i=yield s.convert.toDualDecryptedMsgData(a,n.getForAddon(a));r.push(i)}else r.push(a);return r});function t(t,n){return e.apply(this,arguments)}return t})(),afterUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.existingPlaceholderKeys,r=t.parents,a=t.processMode;if(a!==o("WAWebAddonConstants").AddonProcessMode.SendRetry&&(yield o("WAWebShouldUpdateLastAddOnPreview").filterAndUpdateChatPreviews(e.map(function(e){return o("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromCommentRowType(o("WAWebDBCommentMessageSerialization").dbRowFromCommentMessage(e))})),a!==o("WAWebAddonConstants").AddonProcessMode.HistorySync)){var i=n.size>0?e.filter(function(e){return!n.has(e.id.toString())}):e;yield o("WAWebCommentUtils").updateReplyCount(i,r,[]);var l=yield o("WAWebCommentUtils").genChatIdToLastTimestamp(e);yield o("WAWebApiChat").latestChatBulkUpdates(l),o("WAWebBackendApi").frontendFireAndForget("updateChatToLatest",{chatIdToLatestUpdates:l})}});function t(t,n){return e.apply(this,arguments)}return t})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){o("WAWebBackendApi").frontendFireAndForget("handleCommentNotification",{comments:e.add,revokes:e.remove})});function t(t){return e.apply(this,arguments)}return t})()}),u=s;l.default=u}),98);
__d("WAWebApiUpdateReplyCount",["WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=[];for(var r of e){var a,i=r[0],l=r[1],s=t.getByParentMsgKey(i);if(s!=null){var u=(a=s.replyCount)!=null?a:0;n.push({id:i,replyCount:u+l})}}yield o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(n)}),s.apply(this,arguments)}l.updateReplyCountInParentMsgs=e}),98);
__d("WAWebCommentGroupBy",[],(function(t,n,r,o,a,i){function e(e,t){var n=new Map;for(var r of e){var o,a=r.parentMsgKey.toString(),i=(o=n.get(a))!=null?o:0;n.set(a,i+1)}for(var l of t){var s,u=l.parentMsgKey.toString(),c=(s=n.get(u))!=null?s:0;n.set(u,c-1)}return n}i.commentCountByParents=e}),66);
__d("WAWebCommentMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_COMMENT_ENC_IV:"comment_missing_enc_iv",MISSING_COMMENT_ENC_PAYLOAD:"comment_missing_enc_payload",MISSING_COMMENT_MESSAGE_KEY:"comment_missing_target_message_key",INVALID_COMMENT_ENC_IV:"comment_invalid_enc_iv",MISSING_COMMENT_SENDER:"comment_missing_sender",MISSING_MESSAGE_SECRET:"comment_parent_missing_message_secret",MISSING_ORIGINAL_MESSAGE_SENDER:"comment_missing_original_message_sender",MISSING_COMMENT_CONTENT:"comment_missing_comment_content"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="CommentMessageValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.CommentMessageValidationErrorCode=e,l.CommentMessageValidationError=s}),98);
__d("WAWebCommentMsgDataConversion",["WANullthrows","WAWebCommentMessageValidationError","WAWebMsgType","WAWebViewMode.flow","WAWebWamEnumE2eFailureReason","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t,n;return(t=e.conversation)!=null?t:(n=e.extendedTextMessage)==null?void 0:n.text}function s(t,n){var a=e(t);if(a==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_CONTENT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{ack:n.ack,body:a,from:n.from,to:n.to,id:n.id,parentMsgKey:n.targetMessageKey,author:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(n.author)),t:n.t,type:o("WAWebMsgType").MSG_TYPE.COMMENT,kind:o("WAWebMsgType").MsgKind.CommentDecrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,read:!1}}l.extractCommentTextFromMessage=e,l.convertMessageToCommentMsgData=s}),98);
__d("WAWebReferentialMsgKey",["WAWebMsgKey","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){if(e.broadcastId&&o("WAWebWidFactory").isWidlike(e.broadcastId)){var t=e.id;return new(r("WAWebMsgKey"))({fromMe:t.fromMe,remote:o("WAWebWidFactory").createWidFromWidLike(e.broadcastId),id:t.id,participant:t.remote})}return e.id}l.getReferentialMsgKey=e}),98);
__d("WAWebCommentUtils",["WANullthrows","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebApiUpdateReplyCount","WAWebBackendApi","WAWebCommentGroupBy","WAWebCommentMsgDataConversion","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebProcessCommentMsg","WAWebReferentialMsgKey","WAWebSchemaChat","WAWebViewMode.flow","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map;for(var n of e){var r,a=n.id.remote.toString(),i=n.t;if(i!=null){var l=t.get(a);t.set(a,{id:a.toString(),t:Math.max(i,(r=l==null?void 0:l.t)!=null?r:0),unreadCount:(l==null?void 0:l.unreadCount)!=null?l.unreadCount+1:1})}}for(var s of t.entries()){var u=s[0],c=s[1],d=yield o("WAWebSchemaChat").getChatTable().get(u);d!=null&&c.unreadCount!=null&&(c.unreadCount+=d.unreadCount)}var m=Array.from(t.values());return m}),s.apply(this,arguments)}function u(e,t,n){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=self.crypto.getRandomValues(new Uint8Array(12)),i={type:o("WAWebMsgType").MsgKind.CommentDecrypted,encode:n},l=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.CommentDecrypted,e),s=yield o("WAWebAddonEncryption").encryptAddOn(i,{messageSecret:l,iv:a,originalMessageSender:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e))),addOnSender:o("WAWebWidFactory").asUserWidOrThrow(t),stanzaId:e.id.id}),u=s.encPayload,c=s.reportingTokenContent;return babelHelpers.extends({encIv:a.buffer,encPayload:u,targetMessageKey:o("WAWebReferentialMsgKey").getReferentialMsgKey(e)},c!=null&&{reportingTokenContent:c})}),c.apply(this,arguments)}function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=o("WAWebCommentGroupBy").commentCountByParents(e,n);yield o("WAWebApiUpdateReplyCount").updateReplyCountInParentMsgs(r,t),o("WAWebBackendApi").frontendFireAndForget("updateReplyCount",{replyCountMap:r})}),m.apply(this,arguments)}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebProcessCommentMsg").processEncCommentMsg(e,t);return o("WAWebCommentMsgDataConversion").convertMessageToCommentMsgData(n,e)}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n={conversation:e.body};e.messageSecret!=null&&(n.messageContextInfo={messageSecret:e.messageSecret.buffer,threadId:[]});var a=o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e)));return babelHelpers.extends({id:e.id},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(e.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),yield u(t,a,n),{type:o("WAWebMsgType").MSG_TYPE.COMMENT,kind:o("WAWebMsgType").MsgKind.CommentEncrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,t:e.t,addonEncrypted:!0,ack:e.ack,messageSecret:e.messageSecret})}),g.apply(this,arguments)}l.genChatIdToLastTimestamp=e,l.getEncCommentsFields=u,l.updateReplyCount=d,l.encCommentMsgDataToCommentMsgData=p,l.commentMsgDataToEncCommentMsgData=f}),98);
__d("WAWebProcessCommentMsg",["WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebCommentMessageValidationError","WAWebHandleMsgValidate","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r,a=e.encIv,i=e.encPayload,l=e.targetMessageKey;if(a==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(i==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var s=e.author?e.author:e.id.participant,u=o("WAWebMsgGetters").getOriginalSender(t);if(s==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(u==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_ORIGINAL_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var c={type:o("WAWebMsgType").MsgKind.CommentEncrypted,encryptedAddOn:i},d=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.CommentEncrypted,t),m=yield o("WAWebAddonEncryption").decryptAddOn(c,{messageSecret:d,iv:a,stanzaId:t.id.id,originalMessageSender:u,addOnSender:o("WAWebWidFactory").asUserWidOrThrow(s)}),p=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsE2E.pb").MessageSpec,m),_=(n=(r=p.messageContextInfo)==null?void 0:r.messageSecret)!=null?n:e.messageSecret,f=babelHelpers.extends({},e,{plainProtobufBytes:new Uint8Array(m)});return _!=null&&(f.messageSecret=new Uint8Array(_)),yield o("WAWebHandleMsgValidate").validateAndProcessReportingTokenInfo({renderableMsgs:[f],forceDualEncryptedValidation:!0}),p}),s.apply(this,arguments)}l.processEncCommentMsg=e}),98);
__d("WAWebCommentParseWebMsgInfoComment",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebCommentMsgDataConversion","WAWebMsgKeyUtils","WAWebMsgType","WAWebParseWebMessageInfoApi","WAWebViewMode.flow"],(function(t,n,r,o,a,i,l){var e,s;function u(t){var n,a=t.isFromCag,i=t.webMsgInfo,l=i==null||(n=i.message)==null?void 0:n.commentMessage,c=i==null?void 0:i.commentMetadata,d=[];if(i==null||(c==null?void 0:c.commentParentKey)==null)return d;var m=r("WANullthrows")(o("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(i.key,a,i.participant)),p=m.msgKey,_=r("WANullthrows")(i.messageTimestamp),f;if((l==null?void 0:l.message)!=null&&(f=o("WAWebCommentMsgDataConversion").extractCommentTextFromMessage(l.message)),f==null){var g=r("WANullthrows")(o("WAWebParseWebMessageInfoApi").buildMsgKey(i,r("WANullthrows")(c==null?void 0:c.commentParentKey))),h=g.msgKey;try{var y=o("WAWebParseWebMessageInfoApi").parseMsgStubProto(i,u),C=babelHelpers.extends({id:p,parentMsgKey:h},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(p,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{revokeAddonType:o("WAWebMsgType").MSG_TYPE.COMMENT,protocolMessageKey:y.protocolMessageKey,subtype:y.subtype,kind:o("WAWebMsgType").MsgKind.RevokedAddon,revokeTimestamp:o("WALongInt").numberOrThrowIfTooLarge(r("WANullthrows")(i.revokeMessageTimestamp)),type:o("WAWebMsgType").MSG_TYPE.REVOKED,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,t:o("WALongInt").numberOrThrowIfTooLarge(_)});d.push(C)}catch(t){var b;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[parseWebMsgInfoComment] has revoke stub ",", parameters ",""])),!!i.messageStubType,(b=i.messageStubParameters)==null?void 0:b.length),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[parseWebMsgInfoComment] revoke parse failed "," err=",""])),i.key.id,t).sendLogs("parse-comment-revoke",{sampling:.01})}}else if(l!=null){var v=r("WANullthrows")(l.targetMessageKey),S=r("WANullthrows")(o("WAWebParseWebMessageInfoApi").buildMsgKey(i,v)),R=S.msgKey;d.push(babelHelpers.extends({id:p,parentMsgKey:R},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(p,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{body:f,type:o("WAWebMsgType").MSG_TYPE.COMMENT,read:!0,kind:o("WAWebMsgType").MsgKind.CommentDecrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,t:o("WALongInt").numberOrThrowIfTooLarge(_)}))}return d}l.parseWebMsgInfoComment=u}),98);
__d("WAWebParseEncCommentMessageProto",["WAWebCommentMessageValidationError","WAWebE2EProtoUtils","WAWebMsgType","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.encCommentMessage;if(r!=null){var a=r.encIv,i=r.encPayload,l=r.targetMessageKey;if(a==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(i==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var s=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(l,t);if(s==null)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a.byteLength!==12)throw new(o("WAWebCommentMessageValidationError")).CommentMessageValidationError(o("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.INVALID_COMMENT_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.COMMENT,kind:o("WAWebMsgType").MsgKind.CommentEncrypted,addonEncrypted:!0,encIv:a,encPayload:i,targetMessageKey:s}),contextInfo:null}}}l.default=e}),98);
__d("WAWebGenerateDocumentReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebMediaCleanFileName",["WALogger"],(function(t,n,r,o,a,i,l){var e;function s(e){if(!e)return e;var t=e.replace(/[\u202a-\u202e\u2066-\u2069\u200E\u200F\u061C]/g,"\uFFFD"),n=t.split(".");if(n.length===1)return t;for(var r=n.length-1;r>0;r--){var o=n[r].trim();if(o.length)return n.slice(0,r).join(".")+"."+o}return t}function u(t){if(t==null)return t;var n=s(t);if(t!==n&&n){var r=["bat","exe","cmd","com","lnk","pif","scr","vb","vbe","vbs","wsh","js","ps1","hta","sh","csh","msi","app","scpt","applescript","reg","vbe","wsf","sct"],a=n.split("."),i=a.length>=2?a.pop():"";i!=null&&r.includes(i)&&o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["cleanIncomingFilename:extension: ",""])),i).verbose()}return n}l.cleanFilename=s,l.cleanIncomingFilename=u}),98);
__d("WAWebParseDocumentMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaCleanFileName","WAWebMediaMessageGetValidatedProperties","WAWebMsgType","WAWebServerPropConstants"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.documentMessage;if(a!=null){var i=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(a,t,r,o("WAWebMsgType").MSG_TYPE.DOCUMENT),l=i.fileEncSha256,s=i.fileLength,u=s===void 0?0:s,c=i.fileSha256,d=i.mediaKey,m=i.url,p=o("WAWebMediaCleanFileName").cleanIncomingFilename(a.fileName||a.title),_=a.caption!=null&&a.caption!=="",f=_?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a.caption):p,g=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.DOCUMENT,kind:o("WAWebMsgType").MsgKind.Document,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(m),directPath:a.directPath,mimetype:a.mimetype,filehash:o("WAWebE2EProtoParserApi").decodeBytes(c),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(l),size:u,pageCount:a.pageCount||0,mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(d),mediaKeyTimestamp:a.mediaKeyTimestamp!=null?o("WALongInt").numberOrThrowIfTooLarge(a.mediaKeyTimestamp):o("WATimeUtils").unixTime(),filename:p,isCaptionByUser:_,caption:f,body:o("WAWebE2EProtoParserApi").decodeBytes(a.jpegThumbnail)||"",isVcardOverMmsDocument:!!a.contactVcard&&u<=o("WAWebServerPropConstants").VCARD_MAX_SIZE_KB*1024,thumbnailDirectPath:a.thumbnailDirectPath,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(a.thumbnailSha256),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(a.thumbnailEncSha256),thumbnailHeight:a.thumbnailHeight,thumbnailWidth:a.thumbnailWidth});return{msgData:g,contextInfo:a.contextInfo}}}l.default=e}),98);
__d("WAWebParseKeepInChatMessageProto",["WALongInt","WAWebE2EProtoUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.keepInChatMessage;if(r!=null){var a=r.keepType,i=r.key,l=r.timestampMs,s=babelHelpers.extends({},t,{keptMessageKey:o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(i,t),type:o("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT,kind:o("WAWebMsgType").MsgKind.KeepInChat,keepType:a,senderTimestampMs:o("WALongInt").maybeNumberOrThrowIfTooLarge(l)});return{msgData:s,contextInfo:null}}}l.default=e}),98);
__d("WAWebParseEphemeralSyncResponseMessageProto",["WALogger","WALongInt","WANullthrows","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){var e;function s(t){var n,a,i=t.baseMessage,l=t.messageProtobuf,s=t.msgContext,u=l.protocolMessage;if(!(u==null||s!=="relay"||u.type!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SYNC_RESPONSE)){var c=u.disappearingMode,d=u.ephemeralExpiration,m=u.ephemeralSettingTimestamp;if(d==null||m==null||c==null){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EPHEMERAL_SYNC_RESPONSE msg does not contain all fields"])));return}var p;return u.disappearingMode!=null&&(p=o("WAWebE2EProtoUtils").protoToDisappearingMode(u,u.disappearingMode)),{msgData:babelHelpers.extends({},i,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"ephemeral_sync_response",ephemeralDuration:d,ephemeralSettingTimestamp:o("WALongInt").numberOrThrowIfTooLarge(m),disappearingModeInitiator:r("WANullthrows")(o("WAWebE2EProtoUtils").protoToDisappearingModeInitiator(i,c)),disappearingModeTrigger:(n=p)==null?void 0:n.disappearingModeTrigger,disappearingModeInitiatedByMe:(a=p)==null?void 0:a.initiatedByMe}),contextInfo:null}}}l.default=s}),98);
__d("WAWebEventEditAddonMessageProcessor",["Promise","WAArrayGroupBy","WAWebAddonCreateMsgProcessor","WAWebBoolFunc","WAWebDBProcessEditProtocolMsgs","WAWebGenerateEventEditSystemMessages","WAWebProcessEncryptedEventEditMsgs","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=o("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:o("WAWebBoolFunc").returnTrue,convert:{fromHistorySyncMsg:function(){return(e||(e=n("Promise"))).resolve([])}},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.parents,r=yield o("WAWebProcessEncryptedEventEditMsgs").processEncryptedEventEditMsgs(e,n),a=r.filter(function(e){return e.isLatest});yield o("WAWebDBProcessEditProtocolMsgs").updateMessageEditsLocally(r,a);var i=o("WAArrayGroupBy").groupBy(a,function(e){return e.protocolMsg.id.remote.toString()});return yield o("WAWebGenerateEventEditSystemMessages").generateEventEditSystemMessages(i),[]});function t(t,n){return e.apply(this,arguments)}return t})(),afterUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})()}),u=s;l.default=u}),98);
__d("WAWebEventResponseMsgDataConversion",["WANullthrows","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebViewMode.flow","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t,n;return babelHelpers.extends({id:e.id},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(e.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{type:o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,kind:o("WAWebMsgType").MsgKind.EventResponseDecrypted,parentMsgKey:e.parentMsgKey,eventResponse:r("WANullthrows")(e.responseProtobuf.response,"eventResponse"),senderTimestampMs:e.senderTimestampMs,t:(t=e.t)!=null?t:void 0,read:e.read,ack:(n=e.ack)!=null?n:void 0})}function s(e){var t,n;return babelHelpers.extends({id:e.id},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(e.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{type:o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:o("WAWebMsgType").MsgKind.EventResponseDecrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,parentMsgKey:e.parentMsgKey,eventResponse:e.eventResponse,senderTimestampMs:e.senderTimestampMs,t:(t=e.t)!=null?t:void 0,read:e.read,ack:(n=e.ack)!=null?n:void 0})}function u(e){return{type:"event_response",msgKey:e.id.toString(),parentMsgKey:e.parentMsgKey.toString(),timestamp:e.senderTimestampMs,sender:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e))).toString(),eventResponse:e.eventResponse}}l.protobufToEventResponseMsgData=e,l.eventResponseToEventResponseMsgData=s,l.eventResponseMsgDataToResponseData=u}),98);
__d("WAWebEventResponseAddonMessageProcessor",["WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebBackendApi","WAWebBoolFunc","WAWebCreateEncryptedEventResponseMsgData","WAWebDBMarkFutureproofMessagesReparsed","WAWebEventResponseMsgDataConversion","WAWebEventsParseWebMsgInfoEventResponse","WAWebMsgType","WAWebPrepareEventResponsesToUpsert","WAWebProcessEncryptedEventResponseMsgs","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e=o("WAWebAddonCreateMsgProcessor").createAddonMsgProcessorDualEncrypted({isEnabled:o("WAWebBoolFunc").returnTrue,convert:{fromHistorySyncMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebEventsParseWebMsgInfoEventResponse").parseWebMsgInfoEventResponses(e)});function t(t){return e.apply(this,arguments)}return t})(),toDualEncryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.EventResponseEncrypted?e:o("WAWebCreateEncryptedEventResponseMsgData").createEncryptedEventResponseMsgData(e,t)});function t(t,n){return e.apply(this,arguments)}return t})(),toDualDecryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.EventResponseDecrypted?e:o("WAWebProcessEncryptedEventResponseMsgs").decryptEncryptedEventResponseMsg(e,t)});function t(t,n){return e.apply(this,arguments)}return t})()},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebBackendApi").frontendSendAndReceive("upsertEventResponsesModelCollection",{eventResponses:e.add,eventResponsesToRemove:e.remove})});function t(t){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.parents,r=yield o("WAWebProcessEncryptedEventResponseMsgs").processEncryptedEventResponseMsgs(e,n),a=yield o("WAWebPrepareEventResponsesToUpsert").prepareEventResponsesToUpsert(r);return a});function t(t,n){return e.apply(this,arguments)}return t})(),afterUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.processMode,r=e.map(o("WAWebEventResponseMsgDataConversion").eventResponseMsgDataToResponseData);yield o("WAWebShouldUpdateLastAddOnPreview").filterAndUpdateChatPreviews(r),n!==o("WAWebAddonConstants").AddonProcessMode.HistorySync&&n===o("WAWebAddonConstants").AddonProcessMode.OnlineReceive&&(yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(e.map(function(e){return e.id.toString()})))});function t(t,n){return e.apply(this,arguments)}return t})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})()}),s=e;l.default=s}),98);
__d("WAWebCreateEncryptedEventResponseMsgData",["WANullthrows","WAWebAck","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebEventsValidationError","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebViewMode.flow","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a=self.crypto.getRandomValues(new Uint8Array(12)),i={type:o("WAWebMsgType").MsgKind.EventResponseDecrypted,encode:{response:e.eventResponse,timestampMs:e.senderTimestampMs}},l=o("WAWebMsgGetters").getOriginalSender(t),s=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.EventResponseDecrypted,t);if(l==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var u=yield o("WAWebAddonEncryption").encryptAddOn(i,{messageSecret:s,iv:a,stanzaId:t.id.id,originalMessageSender:l,addOnSender:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e))),parentWid:t.from}),c=u.encPayload;return babelHelpers.extends({id:e.id},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(e.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{type:o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:o("WAWebMsgType").MsgKind.EventResponseEncrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,addonEncrypted:!0,t:Math.floor(e.senderTimestampMs/1e3),ack:(n=e.ack)!=null?n:o("WAWebAck").ACK.CLOCK,targetMessageKey:t.id,encPayload:c,encIv:a.buffer})}),s.apply(this,arguments)}l.createEncryptedEventResponseMsgData=e}),98);
__d("WAWebEventEditDecryptedMsgDataConversion",["WALongInt","WANullthrows","WAWebE2EProtoUtils","WAWebEventsParseEventCreationMessageProto","WAWebEventsValidationError","WAWebMsgKeyUtils","WAWebMsgType","WAWebProcessBaseMsgInfo","WAWebProtobufsE2E.pb","WAWebViewMode.flow","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e,t,n){var a,i,l,s,u,c,d,m,p=r("WANullthrows")(e.protocolMessage,"[Event][Edit] Missing protocol message");if(p.type!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_INVALID_PROTOCOL_MESSAGE_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.EDIT_TYPE_AND_PROTOCOL_MISMATCH);var _=o("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(t),f=r("WANullthrows")(o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(p.key,_)),g=p.editedMessage;if(g==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_EDITED_MESSAGE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var h=o("WALongInt").maybeNumberOrThrowIfTooLarge(p.timestampMs);if(h==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_SENDER_TIMESTAMP,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var y=r("WANullthrows")(r("WAWebEventsParseEventCreationMessageProto")({messageProtobuf:babelHelpers.extends({},g,{messageContextInfo:{messageSecret:r("WANullthrows")((a=t.messageSecret)!=null?a:n).buffer,threadId:[]}}),baseMessage:_,msgContext:"relay"}),"[Event][Edit] Failed to parse edited event fields"),C=y.msgData;return babelHelpers.extends({},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(t.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Message),{id:t.id,t:Math.floor(r("WANullthrows")(h)/1e3),type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,subtype:"event_edit_decrypted",viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,kind:o("WAWebMsgType").MsgKind.ProtocolEventEdit,latestEditSenderTimestampMs:h,latestEditMsgKey:t.id,protocolMessageKey:f,editMsgType:o("WAWebMsgType").MSG_TYPE.EVENT_CREATION,eventName:r("WANullthrows")(C==null?void 0:C.eventName),eventStartTime:r("WANullthrows")(C==null?void 0:C.eventStartTime),isEventCanceled:(i=C==null?void 0:C.isEventCanceled)!=null?i:!1,eventLocation:(l=C==null?void 0:C.eventLocation)!=null?l:void 0,eventDescription:(s=C==null?void 0:C.eventDescription)!=null?s:void 0,eventJoinLink:(u=C==null?void 0:C.eventJoinLink)!=null?u:void 0,eventEndTime:(c=C==null?void 0:C.eventEndTime)!=null?c:void 0,eventIsScheduledCall:(d=C==null?void 0:C.eventIsScheduledCall)!=null?d:void 0,eventExtraGuestsAllowed:(m=C==null?void 0:C.eventExtraGuestsAllowed)!=null?m:void 0,reportingTokenInfo:t.reportingTokenInfo})}l.protobufToEventEditDecryptedMsgData=e}),98);
__d("WAWebGenerateEventEditSystemMessages",["Promise","WANullthrows","WAWebBackendApi","WAWebDBProcessMessage","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","WAWebViewMode.flow","WAWebWidFactory","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield(e||(e=n("Promise"))).all(t.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t[0],i=t[1],l=o("WAWebWidFactory").createWid(a),s=yield(e||(e=n("Promise"))).all(r("compactMap")(i,function(e){var t=e.protocolMsg.latestEditSenderTimestampMs;if(!(t==null||o("WAWebMsgGetters").getIsFailed(e.protocolMsg)))return c(l,t,e)})),u=yield o("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:l,msgObjs:s,meta:{add:"after",isHistory:!1},processMessagesOrigin:"eventEditMessage"});u&&(yield o("WAWebDBProcessMessage").storeMessages(s,l))});return function(e){return t.apply(this,arguments)}})()))}),u.apply(this,arguments)}function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a,i,l,s,u=n.editedMsgData,c=n.protocolMsg,d=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),m=r("WANullthrows")(o("WAWebMsgGetters").getSender(c)),p={eventName:r("WANullthrows")(u==null?void 0:u.eventName),eventStartTime:r("WANullthrows")(u==null?void 0:u.eventStartTime),eventEndTime:u==null?void 0:u.eventEndTime,isEventCanceled:(a=u==null?void 0:u.isEventCanceled)!=null?a:!1,eventLocation:(i=u==null?void 0:u.eventLocation)!=null?i:void 0,eventDescription:(l=u==null?void 0:u.eventDescription)!=null?l:void 0,eventJoinLink:(s=u==null?void 0:u.eventJoinLink)!=null?s:void 0};return babelHelpers.extends({id:new(r("WAWebMsgKey"))({id:yield r("WAWebMsgKey").newId(),fromMe:o("WAWebUserPrefsMeUser").isMeAccount(m),remote:e,participant:m}),author:m,from:e,to:d,t:c.t,type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,subtype:"event_edit_decrypted",viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,kind:o("WAWebMsgType").MsgKind.ProtocolEventEdit,editMsgType:o("WAWebMsgType").MSG_TYPE.EVENT_CREATION,latestEditMsgKey:c.latestEditMsgKey,latestEditSenderTimestampMs:t,protocolMessageKey:n.parentMsg.id},p)}),d.apply(this,arguments)}l.generateEventEditSystemMessages=s}),98);
__d("WAWebPrepareEventResponsesToUpsert",["WANullthrows","WAWebAddonDBTable","WAWebLidMigrationUtils","WAWebMaxPerGroup","WAWebMsgGetters","WAWebMsgType","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WAWebWidFactory").createWidFromWidLike(r("WANullthrows")(o("WAWebMsgGetters").getSender(e)));return String(e.parentMsgKey)+"|"+String(o("WAWebLidMigrationUtils").toLid(t))+"|"+String(o("WAWebLidMigrationUtils").toPn(t))}function s(t){return o("WAWebMaxPerGroup").maxPerGroup(t,function(e){return e.senderTimestampMs},e)}function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.map(function(e){return[e.parentMsgKey,r("WANullthrows")(o("WAWebMsgGetters").getSender(e))]}),a=s(t),i=yield o("WAWebAddonDBTable").addonDBTable.bulkGetByParentAndSender(o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,n),l=new Map;i.forEach(function(t){t.kind===o("WAWebMsgType").MsgKind.EventResponseDecrypted&&l.set(e(t),t)});var u=[];return a.forEach(function(t){var n,r=l.get(e(t));if(!(r!=null&&r.senderTimestampMs>t.senderTimestampMs)){var o=r!=null&&r.eventResponse===t.eventResponse,a=(n=r==null?void 0:r.read)!=null?n:!1,i=o&&a&&t.read!==a?babelHelpers.extends({},t,{read:!0}):t;u.push(i)}}),u}),c.apply(this,arguments)}l.getNewestEventResponses=s,l.prepareEventResponsesToUpsert=u}),98);
__d("WAWebProcessEncryptedEventEditMsgs",["Promise","WALogger","WAWebABProps","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebAddonInfraError","WAWebApiContact","WAWebDBProcessEditProtocolMsgs","WAWebEventEditDecryptedMsgDataConversion","WAWebEventsValidationError","WAWebHandleMsgValidate","WAWebLidMigrationUtils","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebVerifyProtobufMsgObjectKeys","WAWebWamEnumE2eFailureReason","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","compactMap","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=new Map;if(t.forEach(function(e){if(e.kind!==o("WAWebMsgType").MsgKind.EventEditEncrypted)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType);var t=a.getForAddon(e);i.set(e,t)}),i.size===0)return[];var l=yield(u||(u=n("Promise"))).allSettled(Array.from(i.entries(),function(e){var t=e[0],n=e[1];return m(t,n)}));return r("compactMap")(l,function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":{var n=t.reason;if(n instanceof o("WAWebEventsValidationError").EventCreationValidationError||n instanceof o("WAWebEventsValidationError").EncryptedEventEditValidationError||n instanceof o("WAWebAddonEncryptionError").DualEncryptionValidationError){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event edit failed: ",""])),n.code).sendLogs(n.code);return}o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event edit failed: ","\n",""],["Processing encrypted event edit failed: ","\\n",""])),n.message,n.stack).sendLogs("event_edit_unknown_error")}}})}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a,i,l=e.encIv,s=e.encPayload,u=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.EventEditEncrypted,t),c=o("WAWebMsgGetters").getOriginalSender(t),d=o("WAWebMsgGetters").getSender(e);if(d==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(c==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(s==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(!r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(d,c)))throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_PARENT_SENDER_MISMATCH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var m={type:o("WAWebMsgType").MsgKind.EventEditEncrypted,encryptedAddOn:s},p=o("WAWebWidFactory").asUserWidOrThrow(d),_=c,f=p;if(o("WAWebABProps").getABPropConfigValue("lid_one_to_one_migration_event_response_force_pn_jid")&&t.from.isRegularUser()){if(c.isLid()){var g;_=(g=o("WAWebApiContact").getPhoneNumber(c))!=null?g:c}if(p.isLid()){var h;f=(h=o("WAWebApiContact").getPhoneNumber(p))!=null?h:p}}var y;try{y=yield o("WAWebAddonEncryption").decryptAddOn(m,{messageSecret:u,iv:l,stanzaId:t.id.id,originalMessageSender:_,addOnSender:f})}catch(e){if(e instanceof o("WAWebAddonEncryptionError").DualEncryptionValidationError&&(c!==_||p!==f))y=yield o("WAWebAddonEncryption").decryptAddOn(m,{messageSecret:u,iv:l,stanzaId:t.id.id,originalMessageSender:c,addOnSender:p});else throw e}var C=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsE2E.pb").MessageSpec,y),b=o("WAWebEventEditDecryptedMsgDataConversion").protobufToEventEditDecryptedMsgData((n=o("WAWebVerifyProtobufMsgObjectKeys").getUnwrappedProtobufMessage(C))!=null?n:C,e,u),v=(a=(i=C.messageContextInfo)==null?void 0:i.messageSecret)!=null?a:e.messageSecret,S=babelHelpers.extends({},b,{plainProtobufBytes:new Uint8Array(y)});return v!=null&&(S.messageSecret=new Uint8Array(v)),yield o("WAWebHandleMsgValidate").validateAndProcessReportingTokenInfo({renderableMsgs:[S],forceDualEncryptedValidation:!0}),o("WAWebDBProcessEditProtocolMsgs").generateMessageEdit(t,b)}),p.apply(this,arguments)}l.processEncryptedEventEditMsgs=c}),98);
__d("WAWebProcessEncryptedEventResponseMsgs",["Promise","WALogger","WALongInt","WANullthrows","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebApiContact","WAWebEventResponseMsgDataConversion","WAWebEventsValidationError","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","compactMap","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=[],l=new Map;if(t.forEach(function(e){if(e.addonEncrypted){var t=a.getForAddon(e);l.set(e,t)}else i.push(e)}),l.size===0)return i;var c=yield(u||(u=n("Promise"))).allSettled(Array.from(l.entries(),function(e){var t=e[0],n=e[1];return m(t,n)}));return i.concat(r("compactMap")(c,function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":{var n=t.reason;if(n instanceof o("WAWebEventsValidationError").EventCreationValidationError||n instanceof o("WAWebEventsValidationError").EncryptedEventResponseValidationError){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event response failed: ",""])),n.code).sendLogs(n.code);return}o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event response failed: ","\n",""],["Processing encrypted event response failed: ","\\n",""])),n.message,n.stack).sendLogs("unknown-error")}}}))}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a=e.encIv,i=e.encPayload,l=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.EventResponseEncrypted,t),s=o("WAWebMsgGetters").getOriginalSender(t),u=o("WAWebMsgGetters").getSender(e);if(u==null)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(s==null)throw new(o("WAWebEventsValidationError")).EventCreationValidationError(o("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==null)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(i==null)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var c={type:o("WAWebMsgType").MsgKind.EventResponseEncrypted,encryptedAddOn:i},d=o("WAWebWidFactory").asUserWidOrThrow(u),m=null;try{m=yield o("WAWebAddonEncryption").decryptAddOn(c,{messageSecret:l,iv:a,stanzaId:t.id.id,originalMessageSender:s,addOnSender:d})}catch(e){if(!s.isLid()||!d.isLid())throw e;var p=o("WAWebApiContact").getPhoneNumber(s),_=o("WAWebApiContact").getPhoneNumber(d);if(p==null||_==null)throw e;s=p!=null?p:s,d=_!=null?_:d,m=yield o("WAWebAddonEncryption").decryptAddOn(c,{messageSecret:l,iv:a,stanzaId:t.id.id,originalMessageSender:s,addOnSender:d})}var f=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsE2E.pb").Message$EventResponseMessageSpec,m);return o("WAWebEventResponseMsgDataConversion").protobufToEventResponseMsgData({responseProtobuf:f,parentMsgKey:e.targetMessageKey,id:e.id,senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(r("WANullthrows")(f.timestampMs)),t:o("WAWebMsgGetters").getT(e),ack:(n=e.ack)!=null?n:null,read:o("WAWebUserPrefsMeUser").isMeAccount(d)})}),p.apply(this,arguments)}l.processEncryptedEventResponseMsgs=c,l.decryptEncryptedEventResponseMsg=m}),98);
__d("WAWebEventsParseEventEditEncryptedMessageProto",["WAWebE2EProtoUtils","WAWebEventsValidationError","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.secretEncryptedMessage;if(!(a==null||a.secretEncType!==o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT)){var i=a.encIv,l=a.encPayload,s=a.targetMessageKey,u=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(s,t);if(u==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_TARGET_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(i==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(i.byteLength!==12)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_INVALID_SIZE_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l==null)throw new(o("WAWebEventsValidationError")).EncryptedEventEditValidationError(o("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED,kind:o("WAWebMsgType").MsgKind.EventEditEncrypted,encIv:i,encPayload:l,targetMessageKey:u}),contextInfo:null}}}l.default=e}),98);
__d("WAWebEventsParseEventResponseMessageProto",["WAWebE2EProtoUtils","WAWebEventsValidationError","WAWebMsgType","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.encEventResponseMessage;if(r==null)return null;var a=r.encIv,i=r.encPayload,l=r.eventCreationMessageKey,s=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(l,t);if(s==null)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==null)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a.byteLength!==12)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_INVALID_SIZE_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(i==null)throw new(o("WAWebEventsValidationError")).EncryptedEventResponseValidationError(o("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:o("WAWebMsgType").MsgKind.EventResponseEncrypted,addonEncrypted:!0,encIv:a,encPayload:i,targetMessageKey:s}),contextInfo:null}}l.default=e}),98);
__d("WAWebEventsParseWebMsgInfoEventResponse",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebEventResponseMsgDataConversion","WAWebMsgType","WAWebProtobufsWeb.pb","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return e.length===0?null:e.filter(function(e){return e.messageAddOnType===o("WAWebProtobufsWeb.pb").MessageAddOn$MessageAddOnType.EVENT_RESPONSE}).map(function(e){var t;return{timestampMs:e.serverTimestampMs,eventResponseMessageKey:e.messageAddOnKey,eventResponseMessage:(t=e.legacyMessage)==null?void 0:t.eventResponseMessage,unread:e.status!==o("WAWebProtobufsWeb.pb").WebMessageInfo$Status.READ}})}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.isFromCag,a=t.parsedWebMsgInfo,i=t.webMsgInfo;try{var l;if(!(i!=null&&i.eventResponses)||!a||a.type!==o("WAWebMsgType").MSG_TYPE.EVENT_CREATION)return[];var c=a,d=(l=u(i.messageAddOns))!=null?l:i.eventResponses;return r("compactMap")(d,function(t){try{var a,i=(a=r("WANullthrows"))(t.eventResponseMessageKey,"eventResponseMessageKey"),l=a(t.eventResponseMessage,"eventResponseMessage"),s=a(o("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(i,n)),u=s.msgKey;return o("WAWebEventResponseMsgDataConversion").protobufToEventResponseMsgData({responseProtobuf:l,id:u,parentMsgKey:c.id,senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(a(l.timestampMs,"senderTimestampMs")),t:o("WAWebAddOnParseWebMsgInfo").getAddonServerTimestamp(t.timestampMs),ack:null,read:t.unread!==!0})}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Failed to parse eventResponse with error ",""])),t.message).sendLogs("parseWebMsgInfoEventResponses-responses-parse-error"),null}})}catch(e){return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoEventResponses err="," code="," stack=",""])),e==null?void 0:e.name,e==null?void 0:e.code,e==null?void 0:e.stack).sendLogs("parseWebMsgInfoEventResponses-error"),[]}}),d.apply(this,arguments)}l.parseWebMsgInfoEventResponses=c}),98);
__d("WAWebGenerateInteractiveResponseReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebParseButtonsResponseMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.buttonsResponseMessage;if(r!=null){if(r.type===o("WAWebProtobufsE2E.pb").Message$ButtonsResponseMessage$Type.DISPLAY_TEXT){var a=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.BUTTONS_RESPONSE,kind:o("WAWebMsgType").MsgKind.ButtonsResponse,selectedButtonId:r.selectedButtonId,body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(r.selectedDisplayText)});return{msgData:a,contextInfo:r.contextInfo}}return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown}),contextInfo:r.contextInfo}}}l.default=e}),98);
__d("WAWebParseHsmMessageProto",["WAWebE2EProtoUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,r=e.messageProtobuf,a=r.highlyStructuredMessage;if(a!=null){var i=(t=a.hydratedHsm)==null?void 0:t.hydratedTemplate;return{msgData:babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.HSM,kind:o("WAWebMsgType").MsgKind.Hsm,body:i?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(i.hydratedContentText):n.body}),contextInfo:void 0}}}l.default=e}),98);
__d("WAWebParseInteractiveMessageProto",["WAWebABProps","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebHandleMsgError","WAWebInteractiveMessageHeaderMediaType","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgKey","WAWebMsgType","WAWebNativeFlowValidation","WAWebParseDocumentMessageProto","WAWebParseImageMessageProto","WAWebParseProductMessageProto","WAWebParseVideoMessageProto","WAWebWamEnumE2eFailureReason","filterNulls"],(function(t,n,r,o,a,i,l){var e=o("WAWebABProps").getABPropConfigValue("enable_product_carousel_message");function s(e){var t,n,a=e.baseMessage,i=e.bizInfo,l=e.bizSource,s=e.messageProtobuf,d=e.msgContext,p=s.interactiveMessage;if(p!=null){var _=o("WAWebE2EProtoUtils").getInteractiveMessageTypeForProto(p);if(!_||!o("WAWebE2EProtoUtils").isInteractiveMessageTypeEnabled(_))return m(a,p);var f=p.body,g=p.footer,h=o("WAWebE2EProtoUtils").getInteractiveMessageFieldNameForType(_),y={type:o("WAWebMsgType").MSG_TYPE.INTERACTIVE,kind:o("WAWebMsgType").MsgKind.Interactive,caption:(t=o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(f==null?void 0:f.text))!=null?t:"",interactiveType:_,interactivePayload:p[h],pmCampaignId:i==null?void 0:i.campaignId,bizSource:l};if(!o("WAWebE2EProtoUtils").isSupportedInteractiveMessageVersion(_,p[h]))return m(a,p);var C=null,b=p.carouselMessage;if(b!=null&&(C=c(a,b,d,i,l),C==null))return m(a,p);if(_===r("WAWebInteractiveMessageType").NATIVE_FLOW){var v=r("WAWebInteractiveMessagesNativeFlowName").cast(o("WAWebE2EProtoUtils").getBizNativeFlowName({interactiveMessage:p}));if(y=babelHelpers.extends({},y,{nativeFlowName:v}),d==="relay"||d==="history"){var S;if(!o("WAWebE2EProtoUtils").isValidNativeFlowName({name:v,bizInfo:i,msgContext:d})||!o("WAWebNativeFlowValidation").isValidNativeFlowMessage(y,l,a==null||(S=a.id)==null?void 0:S.fromMe,a))return m(a,p)}}var R=p.header!=null?u(p.header,a,d):void 0;return{msgData:babelHelpers.extends({},a,(n=R==null?void 0:R.headerMessage)!=null?n:{},y,{interactiveHeader:R==null?void 0:R.interactiveHeader,footer:g?o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(g.text):a.footer,carouselCardsParsed:C!=null?C:void 0}),contextInfo:p.contextInfo}}}function u(t,n,a){var i=function(){if(t.imageMessage){var i,l=(i=r("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:t.imageMessage},baseMessage:n,msgContext:a}))==null?void 0:i.msgData;if(l&&l.kind!==o("WAWebMsgType").MsgKind.Image)throw new(o("WAWebHandleMsgError")).MessageValidationError("parseInteractiveHeaderMessageProto: header imageMessage is not an ImageMsgData",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{headerMessage:l,mediaType:o("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.IMAGE}}if(t.documentMessage){var s;return{headerMessage:(s=r("WAWebParseDocumentMessageProto")({messageProtobuf:{documentMessage:t.documentMessage},baseMessage:n,msgContext:a}))==null?void 0:s.msgData,mediaType:o("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.DOCUMENT}}if(t.videoMessage){var u,c=(u=r("WAWebParseVideoMessageProto")({messageProtobuf:{videoMessage:t.videoMessage},baseMessage:n,msgContext:a}))==null?void 0:u.msgData;if(c&&c.kind!==o("WAWebMsgType").MsgKind.Video)throw new(o("WAWebHandleMsgError")).MessageValidationError("parseInteractiveHeaderMessageProto: header videoMessage is not an VideoMsgData",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{headerMessage:c,mediaType:o("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.VIDEO}}if(e&&t.productMessage){var d,m=(d=r("WAWebParseProductMessageProto")({messageProtobuf:{productMessage:t.productMessage},baseMessage:n,msgContext:a}))==null?void 0:d.msgData;return{headerMessage:m,mediaType:o("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.PRODUCT}}},l=t.hasMediaAttachment===!0?i():void 0;return{headerMessage:l==null?void 0:l.headerMessage,interactiveHeader:{title:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(t.title),subtitle:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(t.subtitle),thumbnail:o("WAWebE2EProtoParserApi").decodeBytes(t.jpegThumbnail),hasMediaAttachment:!!t.hasMediaAttachment,mediaType:l==null?void 0:l.mediaType}}}function c(e,t,n,o,a){var i=t.cards.map(function(t){return d(t,e,n,o,a)}),l=r("filterNulls")(i);return l.length===0?null:l}function d(t,n,a,i,l){var s,c=t.body,d=t.header,m=o("WAWebE2EProtoUtils").getInteractiveMessageTypeForProto(t);if(!m||!o("WAWebE2EProtoUtils").isInteractiveMessageTypeEnabled(m))return null;var p=babelHelpers.extends({},d,{type:o("WAWebMsgType").MSG_TYPE.INTERACTIVE,kind:o("WAWebMsgType").MsgKind.Interactive,caption:(s=o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(c==null?void 0:c.text))!=null?s:"",interactiveType:m,interactivePayload:t.nativeFlowMessage,pmCampaignId:i==null?void 0:i.campaignId,bizSource:l}),_=d!=null?u(d,n,a):void 0,f=_==null?void 0:_.headerMessage;if(_==null||f==null)return null;var g=babelHelpers.extends({},_.interactiveHeader,{title:null,subtitle:null}),h=new(r("WAWebMsgKey"))({fromMe:f.id.fromMe,remote:f.id.remote,participant:f.id.participant,id:r("WAWebMsgKey").newId_DEPRECATED()});if(f.type===o("WAWebMsgType").MSG_TYPE.VIDEO)return babelHelpers.extends({},f,p,{id:h,interactiveHeader:g,footer:null,isCarouselCard:!0,parentMsgId:n.id.clone()});if(f.type===o("WAWebMsgType").MSG_TYPE.IMAGE)return babelHelpers.extends({},f,p,{id:h,interactiveHeader:g,footer:null,isCarouselCard:!0,parentMsgId:n.id.clone()});if(e&&f.type===o("WAWebMsgType").MSG_TYPE.PRODUCT)return babelHelpers.extends({},f,p,{id:h,interactiveHeader:g,footer:null,isCarouselCard:!0,parentMsgId:n.id.clone()})}function m(e,t){return{msgData:babelHelpers.extends({},e,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:t.contextInfo}}l.default=s}),98);
__d("WAWebGalaxyFlowMessageInteractiveResponseMessageParser",["WAWebBackendApi","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgKey","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e,t){var n;if((t==null||(n=t.nativeFlowResponseMessage)==null?void 0:n.paramsJson)!=null){var a,i,l,s=JSON.parse(t==null||(a=t.nativeFlowResponseMessage)==null?void 0:a.paramsJson),u=t.contextInfo,c={msgData:babelHelpers.extends({},e,{interactiveType:r("WAWebInteractiveMessageType").NATIVE_FLOW,kind:o("WAWebMsgType").MsgKind.InteractiveResponse,type:o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE,nativeFlowName:r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW}),contextInfo:u};if(u){var d=u.participant,m=u.stanzaId;if(m!=null&&d!=null){var p=new(r("WAWebMsgKey"))({id:m,fromMe:!1,remote:e.id.remote});o("WAWebBackendApi").frontendFireAndForget("addGalaxyDisableCTAMessageId",{messageId:p.toString()})}}return s.wa_flow_response_params==null?c:babelHelpers.extends({},c,{msgData:babelHelpers.extends({},c.msgData,{interactivePayload:{name:r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW,buttonParamsJson:JSON.stringify(babelHelpers.extends({},s,{flow_message_version:(i=(l=t.nativeFlowResponseMessage)==null?void 0:l.version)!=null?i:1,flow_token:s.flow_token}))}})})}}l.getGalaxyMessageInteractiveResponse=e}),98);
__d("WAWebGalaxyFlowQPLLoggerUtils",["$InternalEnum","WAQplTypes","WAWebABProps","WAWebGalaxyFlowWamLoggerUtils","WAWebGalaxyFlowsUtils","WAWebQplQuickPerformanceLoggerModule","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e=n("$InternalEnum"))({SCREEN_NAVIGATION_START:"screen_navigation_start",SCREEN_NAVIGATION_END:"screen_navigation_end",METADATA_NETWORK_START:"metadata_network_start",METADATA_NETWORK_END:"metadata_network_end",FETCHING_FLOW_DATA_START:"fetching_flow_data_start",FETCHING_FLOW_DATA_END:"fetching_flow_data_end",FETCHING_FLOW_JSON_START:"fetching_flow_json_start",FETCHING_FLOW_JSON_END:"fetching_flow_json_end",HTML_START:"html_start",HTML_END:"html_end"}),u=e({EXTENSION_METADATA_RESPONSE_ERROR:"extensions-metadata-response-error",NO_NETWORK_ERROR:"no-network-error",EXTENSION_WEBVIEW_LOADING_ERROR:"extensions-webview-loading-error",EXTENSIONS_METADATA_GRAPHQL_RESPONSE_ERROR:"extensions-metadata-graphql-response-error"}),c=e({MESSAGE_CTA:"message_cta"});function d(){return o("WAWebABProps").getABPropConfigValue("wa_web_wae_qpl_enabled")}function m(){d()&&(N(200750681,f),o("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(200750681))}function p(e){d()&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(200750681,e)}function _(e){d()&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerAnnotate(200750681,e)}function f(e,t){d()&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(200750681,e,t)}function g(){o("WAWebQplQuickPerformanceLoggerModule").QPL.markerDrop(200750681)}function h(e,t){var n;return d()?{string:{extension_id:t.flowId,flow_entry_point:c.MESSAGE_CTA,perf_origin:c.MESSAGE_CTA,session_id:t.flowQPLSessionId,biz_jid:o("WAWebGalaxyFlowWamLoggerUtils").getFlowBusinessPhoneNumber(e),extension_message_id:e.galaxyFlowQPLMessageId},bool:{is_debug_build:!r("gkx")("26258"),is_response_flow:!!t.isResponseFlow,data_channel_navigation:!o("WAWebGalaxyFlowsUtils").isFlowInitWithoutDataChannel((n=t==null?void 0:t.flowAction)!=null?n:"")}}:{}}var y=e({FETCH_START:"fetch_start",METADATA_NETWORK_START:"metadata_network_start",METADATA_NETWORK_END:"metadata_network_end",FETCH_END:"fetch_end"}),C=e({EXTENSIONS_METADATA_EMPTY_RESPONSE:"extensions-metadata-empty-response",EXTENSIONS_METADATA_RESPONSE_ERROR:"extensions-metadata-response-error",EXTENSIONS_INVALID_EXTENSIONS_ID:"extensions-invalid-extensions-id",EXTENSIONS_INVALID_PUBLIC_KEY:"extensions-invalid-public-key",EXTENSIONS_PUBLIC_KEY_SINGATURE_VERIFICATION_EXCEPTION:"extensions-public-key-signature-verification-exception",EXTENSIONS_PUBLIC_KEY_MISSING_IDENTITY_KEY_ERROR:"extensions-public-key-missing-identity-key-error",EXTENSIONS_METADATA_GRAPHQL_RESPONSE_ERROR:"extensions-metadata-graphql-response-error"}),b=e({EXTENSION_METADATA_PERF_TRACKER:"extensionMetadataPerfTracker"}),v=e({USER_INTERACTION:"user_interaction",SCREEN_TRANSITION_INTEGRITY_CHECK:"screen_transition_integrity_check"}),S=e({OPTIONAL:"optional",REQUIRED:"required"});function R(){d()&&(N(200743350,k),o("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(200743350))}function L(e){d()&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(200743350,e)}function E(e){d()&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerAnnotate(200743350,e)}function k(e){d()&&o("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(200743350,e)}function I(){o("WAWebQplQuickPerformanceLoggerModule").QPL.markerDrop(200743350)}function T(e){var t=JSON.stringify(e),n=new TextEncoder().encode(t!=null?t:"").length;E({int:{metadata_response_size:n}})}function D(e){var t={};for(var n in e){var r=e[n];if(typeof r=="string"){var o;t.string=babelHelpers.extends({},t.string,(o={},o[n]=r,o))}else if(typeof r=="number"){var a;t.int=babelHelpers.extends({},t.int,(a={},a[n]=r,a))}else if(typeof r=="boolean"){var i;t.bool=babelHelpers.extends({},t.bool,(i={},i[n]=r,i))}}return t}function x(e,t,n){return n===void 0&&(n=S.OPTIONAL),d()?{string:{biz_jid:o("WAWebGalaxyFlowWamLoggerUtils").getFlowBusinessPhoneNumber(e),fetch_context:v.USER_INTERACTION,extension_id:t.flowId,perf_origin:b.EXTENSION_METADATA_PERF_TRACKER,endpoint_public_key_fetch_mode:n},bool:{is_debug_build:!r("gkx")("26258"),is_graphql_prod:r("gkx")("26258")}}:{}}function $(){return o("WAWebABProps").getABPropConfigValue("extensions_geoblocking_enabled")&&o("WAWebABProps").getABPropConfigValue("commerce_sanctioned")}function P(){d()&&(N(200750681,f),N(200743350,k))}function N(e,t){if(d()){var n=o("WAWebQplQuickPerformanceLoggerModule").QPL.getMarkerInstances(e);n!=null&&(n==null?void 0:n.size)>0&&n.forEach(function(e,n){t(o("WAQplTypes").QuickLogActionType.CANCEL,{instanceKey:Number(n)})})}}l.WaeScreenNavigationQPLPoints=s,l.WaeScreenNavigationQPLErrorTypes=u,l.qplWaeScreenNavigationStart=m,l.qplWaeScreenNavigationPoint=p,l.qplWaeScreenNavigationAnnotate=_,l.qplWaeScreenNavigationEnd=f,l.qplWaeScreenNavigationDrop=g,l.getWaeScreenNavigationAnnotations=h,l.WaeMetadataQPLPoints=y,l.WaeMetadataQPLErrorTypes=C,l.qplWaeMetadataStart=R,l.qplWaeMetadataPoint=L,l.qplWaeMetadataAnnotate=E,l.qplWaeMetadataEnd=k,l.qplWaeMetadataDrop=I,l.qplAnnotateMetadataSize=T,l.qplBuildAnnotations=D,l.getWaeMetadataAnnotations=x,l.isGalaxyFlowSanctioned=$,l.clearAllActiveWaeQPLMarkerInstances=P}),98);
__d("WAWebWamEnumBizPlatform",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:1,SMB:2,ENT:3,CLOUDAPI:4});i.BIZ_PLATFORM=e}),66);
__d("WAWebWamEnumFlowEntryPoint",[],(function(t,n,r,o,a,i){var e=Object.freeze({MESSAGE_CTA:0,BIZ_CARD_CTA:1,CART_FAB:2,MESSAGE_BODY:3,MESSAGE_IMAGE:4,GREETING_MESSAGE:5});i.FLOW_ENTRY_POINT=e}),66);
__d("WAWebExtensionScreenProgressWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBizPlatform","WAWebWamEnumEntryPointConversationInitiated","WAWebWamEnumFlowEntryPoint"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ExtensionScreenProgress:[4112,{adContext:[22,e.TYPES.STRING],bizPlatform:[1,o("WAWebWamEnumBizPlatform").BIZ_PLATFORM],businessOwnerJid:[2,e.TYPES.STRING],clickSequenceNumber:[24,e.TYPES.INTEGER],embeddedError:[3,e.TYPES.STRING],embeddedFlow:[4,e.TYPES.STRING],embeddedFlowType:[5,e.TYPES.STRING],entryPointConversationInitiated:[19,o("WAWebWamEnumEntryPointConversationInitiated").ENTRY_POINT_CONVERSATION_INITIATED],entryPointConversionApp:[20,e.TYPES.STRING],entryPointConversionSource:[21,e.TYPES.STRING],extensionCategory:[6,e.TYPES.STRING],extensionRestoredFromCache:[17,e.TYPES.BOOLEAN],extensionScreenLength:[7,e.TYPES.INTEGER],extensionStatus:[18,e.TYPES.STRING],extensionsFlowId:[8,e.TYPES.STRING],extensionsMessageId:[9,e.TYPES.STRING],extensionsSessionId:[10,e.TYPES.STRING],flowEntryPoint:[23,o("WAWebWamEnumFlowEntryPoint").FLOW_ENTRY_POINT],flowStatusExit:[11,e.TYPES.STRING],hsmCategory:[12,e.TYPES.STRING],hsmTag:[16,e.TYPES.STRING],isSuccessScreen:[25,e.TYPES.BOOLEAN],isTemplate:[13,e.TYPES.BOOLEAN],layoutType:[26,e.TYPES.STRING],screenProgress:[14,e.TYPES.STRING],sequenceNumber:[15,e.TYPES.INTEGER],shoppingCartItemsCount:[27,e.TYPES.INTEGER]},[1,1,1],"private",0]},{ExtensionScreenProgress:[]});l.ExtensionScreenProgressWamEvent=s}),98);
__d("WAWebWamEnumInteractionType",[],(function(t,n,r,o,a,i){var e=Object.freeze({USER_START:0,USER_CANCEL:1,FLOW_SUCCESS:2,FLOW_ERROR:3,USER_VIEW:4,USER_PAY_NOW:5,USER_VIEW_BASKET:6,CLICK_PAYMENT_DETAILS:7,CLICK_MESSAGE_BUSINESS:8,MODIFY_PAYMENT_METHOD:9,CONFIRM_PAYMENT_METHOD:10,USER_VIEW_SUMMARY:11,USER_PAY_NOW_QUICK_BUY:12,USER_SEND_PAYMENT:13,USER_SEND_PAYMENT_QUICK_BUY:14,CLICK_HELP:15,CLICK_ORDER_SUMMARY:16,USER_CONFIRM:17,CLICK_REPORT_THIS_TRANSACTION:18,USER_COMPLETED_PAYMENT_INTENT:19,USER_SHARE_MENU_OPEN:20,USER_OPEN_BROWSER:21,USER_COPY_LINK:22,USER_SHARE_LINK:23,USER_SHARE_MENU_CANCEL:24,USER_REFRESH:25,USER_FORWARD:26,USER_BACK:27,VIEW_EVENT_SHARING_TOS_ALERT:28,DISMISS_EVENT_SHARING_TOS_ALERT:29,CLICK_EVENT_SHARING_TOS:30,ACCEPT_EVENT_SHARING_TOS:31,REJECT_EVENT_SHARING_TOS:32,CLICK_TO_VIEW_EVENT_SHARING_TOS_ALERT:33,START_CHAT_FROM_CTWA:34,CLICK_CONFIRM_PENDING_PAYMENT:35,COPY_PIX_CODE:36,COPY_PIX_KEY:37,USER_VIEW_PAYMENT_COMPLETE:38,USER_VIEW_ATTACHMENT:39,USER_DOWNLOAD_ATTACHMENT:40,COPY_BOLETO_CODE:41,WEBVIEW_ERROR:42,USER_GRANT_CAMERA_PERMISSION:43,USER_DENY_CAMERA_PERMISSION:44,CAMERA_PERMISSION_REQUEST_DIALOG_POP_UP:45,USER_APP_REDIRECT_ACCEPT:46,USER_APP_REDIRECT_DENY:47,USER_RESTORE:48,CLICK_PAY_WITH_PIX:49,PIX_CHANGE_BANK:50,PIX_SELECT_BANK_VIEW:51,PIX_SELECT_BANK:52,PAY_WITH_PIX:53,PAY_WITH_PIX_STATUS:54,PIX_ENTER_AMOUNT:55,PAY_WITH_PIX_VIEW:56,PIX_ADD_CPF_VIEW:57,PIX_ADD_CPF:58,PAY_WITH_PIX_DI:59,COPY_PIX_CODE_DI:60,PAY_WITH_PIX_ERROR:61,PAY_WITH_PIX_DEEP_LINK:62,CLICK_PIX_MORE_WAYS_TO_PAY:63,PAY_WITH_PIX_IMPRESSION:64,CLICK_MORE_BANK_APPS:65,CLICK_PIX_WHY_DO_WE_NEED_THIS:66,CLICK_PIX_TERMS_OF_SERVICE:67,CLICK_PIX_PRIVACY_POLICY:68,CLICK_PIX_SHARE_RECEIPT:69,CLICK_COPY_PAYMENT_KEY:70,WATCH_AND_BROWSE_EXPANSION:71,WATCH_AND_BROWSE_FULL_EXPANSION:72,WATCH_AND_BROWSE_BROWSER_CLOSE:73,PIX_BANK_SELECTED_FROM_GRID:74,PIX_BANK_SELECTED_FROM_LIST:75});i.INTERACTION_TYPE=e}),66);
__d("WAWebWamEnumStructuredMessageClass",[],(function(t,n,r,o,a,i){var e=Object.freeze({HSM:0,BUTTON:1,LIST:2,PRODUCT_LIST:3,BUTTON_NFM:4,PRODUCT_ITEM:5,SHOP_STOREFRONT:6});i.STRUCTURED_MESSAGE_CLASS=e}),66);
__d("WAWebExtensionsStructuredMessageInteractionWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBizPlatform","WAWebWamEnumEntryPointConversationInitiated","WAWebWamEnumFlowEntryPoint","WAWebWamEnumInteractionType","WAWebWamEnumMediaType","WAWebWamEnumStructuredMessageClass"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({ExtensionsStructuredMessageInteraction:[4114,{adContext:[10,e.TYPES.STRING],bizPlatform:[1,o("WAWebWamEnumBizPlatform").BIZ_PLATFORM],businessOwnerJid:[2,e.TYPES.STRING],entryPointConversationInitiated:[7,o("WAWebWamEnumEntryPointConversationInitiated").ENTRY_POINT_CONVERSATION_INITIATED],entryPointConversionApp:[8,e.TYPES.STRING],entryPointConversionSource:[9,e.TYPES.STRING],flowEntryPoint:[11,o("WAWebWamEnumFlowEntryPoint").FLOW_ENTRY_POINT],messageClass:[3,o("WAWebWamEnumStructuredMessageClass").STRUCTURED_MESSAGE_CLASS],messageClassAttributes:[4,e.TYPES.STRING],messageInteraction:[5,o("WAWebWamEnumInteractionType").INTERACTION_TYPE],messageMediaType:[6,o("WAWebWamEnumMediaType").MEDIA_TYPE],threadIdHmac:[12,e.TYPES.STRING]},[1,1,1],"private",0]},{ExtensionsStructuredMessageInteraction:[]});l.ExtensionsStructuredMessageInteractionWamEvent=s}),98);
__d("WAWebGetGalaxyFlowCtaButton",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return{label:e.flow_cta,expireTime:e.expire_time,mode:e.mode,flowId:e.flow_id,flowActionPayload:e.flow_action_payload,flowDataEndpoint:e.flow_data_endpoint,flowMessageVersion:e.flow_message_version,flowMetadata:e.flow_metadata,flowToken:e.flow_token,flowVersionId:e.flow_version_id,flowJSON:e.flow_json,flowJSONFreshFetched:e.flow_json_fresh_fetched,flowAction:e.flow_action,flowName:e.flow_name,flowQPLMessageId:e.flow_qpl_message_id,flowWAMMessageId:e.flow_wam_message_id,messageTimestamp:t,isResponseFlow:!1,creationSource:e.creation_source}}function l(t,n,r){var o=JSON.parse(t);return{name:"galaxy_message",index:n,data:e(o,r)}}function s(t,n,r){var o=JSON.parse(t);if(o.wa_flow_response_params!=null){var a=o.wa_flow_response_params,i=a.flow_id,l=a.flow_name,s=a.response_message;return{name:"galaxy_message",index:n,data:babelHelpers.extends({},e(o,r),{flowId:i,flowName:l,flowResponseMessage:s,isResponseFlow:s!=null})}}}i.getGalaxyFlowCtaButton=l,i.getGalaxyFlowResponseCtaButton=s}),66);
__d("WAWebWamEnumLastMessageDirection",[],(function(t,n,r,o,a,i){var e=Object.freeze({OPPOSITE_PARTY_INITIATED:0,SELF_INITIATED:1});i.LAST_MESSAGE_DIRECTION=e}),66);
__d("WAWebStructuredMessageReceiveWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBizPlatform","WAWebWamEnumEntryPointConversationInitiated","WAWebWamEnumLastMessageDirection","WAWebWamEnumMediaType","WAWebWamEnumStructuredMessageClass"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({StructuredMessageReceive:[3222,{bizPlatform:[1,o("WAWebWamEnumBizPlatform").BIZ_PLATFORM],businessOwnerJid:[2,e.TYPES.STRING],entryPointConversationInitiated:[7,o("WAWebWamEnumEntryPointConversationInitiated").ENTRY_POINT_CONVERSATION_INITIATED],entryPointConversionApp:[8,e.TYPES.STRING],entryPointConversionSource:[9,e.TYPES.STRING],lastMessageDirection:[10,o("WAWebWamEnumLastMessageDirection").LAST_MESSAGE_DIRECTION],messageClass:[3,o("WAWebWamEnumStructuredMessageClass").STRUCTURED_MESSAGE_CLASS],messageClassAttributes:[4,e.TYPES.STRING],messageDepth:[11,e.TYPES.INTEGER],messageMediaType:[5,o("WAWebWamEnumMediaType").MEDIA_TYPE],templateId:[6,e.TYPES.STRING],threadIdHmac:[12,e.TYPES.STRING]},[1,1,1],"private",0]},{StructuredMessageReceive:[]});l.StructuredMessageReceiveWamEvent=s}),98);
__d("WAWebGalaxyFlowWamLoggerUtils",["Promise","WALogger","WAWebABProps","WAWebApiContact","WAWebExtensionScreenProgressWamEvent","WAWebExtensionsStructuredMessageInteractionWamEvent","WAWebGalaxyFlowsUtils","WAWebGetGalaxyFlowCtaButton","WAWebHandleMsgTypes.flow","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgGetters","WAWebMsgType","WAWebStructuredMessageReceiveWamEvent","WAWebWamEnumBizPlatform","WAWebWamEnumFlowEntryPoint","WAWebWamEnumStructuredMessageClass","WAWebWamMsgUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return o("WAWebABProps").getABPropConfigValue("flows_wa_web")&&e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&e.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW}function c(e){var t;return(t=o("WAWebMsgGetters").getSender(e))==null?void 0:t.user}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new(o("WAWebStructuredMessageReceiveWamEvent")).StructuredMessageReceiveWamEvent({messageClass:o("WAWebWamEnumStructuredMessageClass").STRUCTURED_MESSAGE_CLASS.BUTTON_NFM,messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(e),bizPlatform:o("WAWebWamEnumBizPlatform").BIZ_PLATFORM.CLOUDAPI,messageClassAttributes:_(e),businessOwnerJid:c(e)});t.commit()}),m.apply(this,arguments)}function p(e){var t,n=[];return e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&e.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW&&((t=e.interactivePayload)==null?void 0:t.buttons)!=null&&e.interactivePayload.buttons.forEach(function(t,r){var a,i=o("WAWebGetGalaxyFlowCtaButton").getGalaxyFlowCtaButton((a=t.buttonParamsJson)!=null?a:"",r,e.t);i!=null&&n.push(i)}),n.length===0?null:n[0]}function _(e){var t,n,a,i,l=p(e);return JSON.stringify({cta:r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW,flow_id:l==null||(t=l.data)==null?void 0:t.flowId,extensions_message_id:e.galaxyFlowWAMMessageId,is_flow_message_with_payload:o("WAWebGalaxyFlowsUtils").isFlowInitWithoutDataChannel((n=l==null||(a=l.data)==null?void 0:a.flowAction)!=null?n:""),is_template:e.templateId!=null?1:0,extension_status:l==null||(i=l.data)==null?void 0:i.mode})}function f(e){try{var t,n,r;if((t=e.from)!=null&&t.isLid()){var a,i;return(a=(i=o("WAWebApiContact").getPhoneNumber(o("WAWebWidFactory").asUserLidOrThrow(e.from)))==null?void 0:i.user)!=null?a:""}return(n=(r=e.from)==null?void 0:r.user)!=null?n:""}catch(t){var l,s;return(l=(s=e.from)==null?void 0:s.user)!=null?l:""}}function g(e){var t;if(e.contact.id==null)return o("WAWebWamEnumBizPlatform").BIZ_PLATFORM.UNKNOWN;var n=e.contact;return n==null||!n.isBusiness?o("WAWebWamEnumBizPlatform").BIZ_PLATFORM.UNKNOWN:((t=e.contact)==null||(t=t.privacyMode)==null?void 0:t.hostStorage)===o("WAWebHandleMsgTypes.flow").HostStorageEnumType.Facebook?o("WAWebWamEnumBizPlatform").BIZ_PLATFORM.CLOUDAPI:n.isEnterprise?o("WAWebWamEnumBizPlatform").BIZ_PLATFORM.ENT:o("WAWebWamEnumBizPlatform").BIZ_PLATFORM.SMB}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield(s||(s=n("Promise"))).all(t.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){u(t)&&(yield d(t).catch(function(t){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[WAM:GALAXY_FLOW] structured msg receive log err: ",""])),t)}))});return function(e){return t.apply(this,arguments)}})()))}),y.apply(this,arguments)}function C(e,t,n,a,i){var l;new(o("WAWebExtensionsStructuredMessageInteractionWamEvent")).ExtensionsStructuredMessageInteractionWamEvent({bizPlatform:g(t),businessOwnerJid:f(n),flowEntryPoint:o("WAWebWamEnumFlowEntryPoint").FLOW_ENTRY_POINT.MESSAGE_CTA,messageClass:o("WAWebWamEnumStructuredMessageClass").STRUCTURED_MESSAGE_CLASS.BUTTON_NFM,messageInteraction:a,messageMediaType:o("WAWebWamMsgUtils").getWamMediaType(n),messageClassAttributes:JSON.stringify(babelHelpers.extends({cta:r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW,flow_id:e==null?void 0:e.flowId,extensions_message_id:n.galaxyFlowWAMMessageId,session_id:e==null?void 0:e.flowWAMSessionId,is_template:n.templateId!=null?1:0,extension_status:e==null?void 0:e.mode,categories:JSON.stringify(e==null?void 0:e.categories),data_channel_navigation:!o("WAWebGalaxyFlowsUtils").isFlowInitWithoutDataChannel((l=e==null?void 0:e.flowAction)!=null?l:"")},i!=null?{error_type:i}:{}))}).commit()}function b(e,t,n){var r;new(o("WAWebExtensionScreenProgressWamEvent")).ExtensionScreenProgressWamEvent({bizPlatform:g(t),businessOwnerJid:(r=f(n))!=null?r:"",extensionCategory:JSON.stringify(e==null?void 0:e.categories),extensionRestoredFromCache:e==null?void 0:e.isRestoredFromCache,extensionScreenLength:e==null?void 0:e.screenLength,extensionStatus:e==null?void 0:e.mode,extensionsFlowId:e==null?void 0:e.flowId,extensionsMessageId:n.galaxyFlowWAMMessageId!=null?n.galaxyFlowWAMMessageId:"",extensionsSessionId:e==null?void 0:e.flowWAMSessionId,flowEntryPoint:o("WAWebWamEnumFlowEntryPoint").FLOW_ENTRY_POINT.MESSAGE_CTA,flowStatusExit:"user_interrupted",hsmTag:n.hsmTag!=null?n.hsmTag:"",isTemplate:n.templateId!=null,screenProgress:e.screenProgress,sequenceNumber:e.sequenceNumber,layoutType:e.layoutType,isSuccessScreen:e.isSuccess===!0}).commit()}l.getFlowBusinessPhoneNumber=f,l.getFlowsMaybeBizPlatform=g,l.logStructuredMessageReceivedWAMEvent=h,l.logStructuredMessageInteractionWAMEvent=C,l.logExtensionScreenProgressWAMEvent=b}),98);
__d("WAFlowsExpiredCacheCleaner",["Promise"],(function(t,n,r,o,a,i){"use strict";var e;function l(){return new(e||(e=n("Promise")))(function(e,t){try{var n=document.createElement("iframe");n.style.display="none",n.src="https://flows.whatsapp.net/flows/cache_management/",n.onload=function(){document.body.removeChild(n),e(0)},n.onerror=function(e){n.parentNode&&document.body.removeChild(n),t(e)},document.body.appendChild(n)}catch(e){t(e)}})}i.clearExpiredCachedStates=l}),66);
__d("WAWebGalaxyFlowsUtils",["Promise","WABase64","WAFlowsExpiredCacheCleaner","WAWebABProps","WAWebCommonMsgSubtypeTypes","WAWebGalaxyFlowQPLLoggerUtils","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebStateUtils","asyncToGeneratorRuntime","tryParseJSONMixed"],(function(t,n,r,o,a,i,l){var e,s="navigate";function u(){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(o("WAWebABProps").getABPropConfigValue("flows_wa_web"))try{yield o("WAFlowsExpiredCacheCleaner").clearExpiredCachedStates()}catch(e){}}),c.apply(this,arguments)}function d(e){return e===s}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t!=null&&t.aborted)throw new Error("Request aborted");o("WAWebGalaxyFlowQPLLoggerUtils").qplWaeScreenNavigationPoint(o("WAWebGalaxyFlowQPLLoggerUtils").WaeScreenNavigationQPLPoints.FETCHING_FLOW_JSON_START);var n=yield window.fetch("/flows/json/"+e,{signal:t}),r=yield n.json();return t!=null&&t.aborted||o("WAWebGalaxyFlowQPLLoggerUtils").qplWaeScreenNavigationPoint(o("WAWebGalaxyFlowQPLLoggerUtils").WaeScreenNavigationQPLPoints.FETCHING_FLOW_JSON_END),r}),p.apply(this,arguments)}function _(e){var t=o("WAWebStateUtils").unproxy(e);return t.type=o("WAWebMsgType").MSG_TYPE.UNKNOWN,t.subtype=o("WAWebCommonMsgSubtypeTypes").MsgSubtype.PhoneOnlyFeature,t}function f(e){var t;return((t=e.nativeFlowResponseMessage)==null?void 0:t.name)===String(r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW)&&o("WAWebABProps").getABPropConfigValue("flows_wa_web")}function g(e){if(e.nativeFlowResponseMessage!=null&&e.nativeFlowResponseMessage.paramsJson!=null){var t=r("tryParseJSONMixed")(e.nativeFlowResponseMessage.paramsJson);if(t!=null&&typeof t=="object"&&t.wa_flow_response_params!=null&&t.wa_flow_response_params.flow_creation_source!=null){var n=t.wa_flow_response_params.flow_creation_source==="FLEXIBLE_CHECKOUT";return n}}return!1}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=v();return C(e.id,t).then(function(e){var t=e.flowQPLMessageId,n=e.flowWAMMessageId;return{flowQPLMessageId:t,flowWAMMessageId:n}})}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=new TextEncoder,i=a.encode(t+r+"_qpl"),l=a.encode(t+r+"_wam"),s=yield(e||(e=n("Promise"))).all([crypto.subtle.digest({name:"SHA-256"},i),crypto.subtle.digest({name:"SHA-256"},l)]),u=s[0],c=s[1],d=o("WABase64").encodeB64(u),m=o("WABase64").encodeB64(c);return{flowQPLMessageId:d,flowWAMMessageId:m}}),b.apply(this,arguments)}function v(){var e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,function(e){return String.fromCharCode(e)}).join("")}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(!o("WAWebABProps").getABPropConfigValue("flows_wa_web"))return t;var a=t.filter(function(e){return e.type===o("WAWebMsgType").MSG_TYPE.INTERACTIVE&&e.interactiveType===r("WAWebInteractiveMessageType").NATIVE_FLOW&&e.nativeFlowName===r("WAWebInteractiveMessagesNativeFlowName").CTA_FLOW});if(a.length===0)return t;var i=new Map;return yield(e||(e=n("Promise"))).all(a.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{var t=yield h(e.id),n=t.flowQPLMessageId,r=t.flowWAMMessageId;i.set(e.id.id,{flowWAMMessageId:r,flowQPLMessageId:n})}catch(e){}});return function(t){return e.apply(this,arguments)}})())),t.map(function(e){var t=i.get(e.id.id);return t!=null?babelHelpers.extends({},e,{galaxyFlowWAMMessageId:t.flowWAMMessageId,galaxyFlowQPLMessageId:t.flowQPLMessageId}):e})}),R.apply(this,arguments)}function L(e,t){var n,r,o,a=t==null||(n=t.xwa_extensions_get_flow_data)==null?void 0:n.extensions_flow_data;if(a==null||a.length===0)return null;var i=a.find(function(t){return t.flow_id===e});return(r=i==null||(o=i.extensions)==null?void 0:o.metadata)!=null?r:null}l.clearGalaxyFlowsCache=u,l.isFlowInitWithoutDataChannel=d,l.fetchFlowJSON=m,l.getInvalidatedFlowMessageFromHistorySync=_,l.isResponseFlowSupported=f,l.isFlexibleCheckoutForm=g,l.computeMessageIds=h,l.maybeAddGalaxyFlowMessageIds=S,l.getFlowDataFromFetchedData=L}),98);
__d("WAWebParseInteractiveResponseMessageProto",["WAWebBizGatingUtils","WAWebE2EProtoUtils","WAWebGalaxyFlowMessageInteractiveResponseMessageParser","WAWebGalaxyFlowsUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.bizInfo,r=e.messageProtobuf,a=e.msgContext,i=r.interactiveResponseMessage;if(i!=null){var l=o("WAWebE2EProtoUtils").getInteractiveResponseMessageTypeForProto(i);if(!o("WAWebBizGatingUtils").interactiveNativeFlowResponseMessagesEnabled()||!l||!o("WAWebE2EProtoUtils").isInteractiveResponseMessageTypeEnabled(l))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:i.contextInfo};if(o("WAWebGalaxyFlowsUtils").isResponseFlowSupported(i))return o("WAWebGalaxyFlowsUtils").isFlexibleCheckoutForm(i)?{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:i.contextInfo}:o("WAWebGalaxyFlowMessageInteractiveResponseMessageParser").getGalaxyMessageInteractiveResponse(t,i);try{var s,u;return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE,kind:o("WAWebMsgType").MsgKind.InteractiveResponse,body:(s=o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis((u=i.body)==null?void 0:u.text))!=null?s:"",interactivePayload:o("WAWebE2EProtoUtils").getInteractiveResponsePayload({type:l,message:i,bizInfo:n,msgContext:a})}),contextInfo:i.contextInfo}}catch(e){return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:i.contextInfo}}}}l.default=e}),98);
__d("WAWebParseListResponseMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.listResponseMessage;if(r!=null&&r.listType===o("WAWebProtobufsE2E.pb").Message$ListResponseMessage$ListType.SINGLE_SELECT){var a=babelHelpers.extends({},r,{contextInfo:void 0}),i=r.title||"";r.description!=null&&r.description!==""&&(i+="\n"+r.description);var l=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.LIST_RESPONSE,kind:o("WAWebMsgType").MsgKind.ListResponse,listResponse:a,body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(i)});return{msgData:l,contextInfo:r.contextInfo}}}l.default=e}),98);
__d("WAWebParseNativeFlowButtonsMessageProto",["WAWebButtonsMessageProtoUtils","WAWebE2EProtoUtils","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebNativeFlowValidation","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.bizInfo,a=e.bizSource,i=e.messageProtobuf,l=e.msgContext,s=i.buttonsMessage;if(s!=null){var u=s.buttons,c=u===void 0?[]:u,d=s.headerType,m=r("WAWebInteractiveMessagesNativeFlowName").cast(o("WAWebE2EProtoUtils").getBizNativeFlowName({buttonsMessage:s}));if(!(l==="relay"&&(m==null||m!==r("WAWebInteractiveMessagesNativeFlowName").cast(n==null?void 0:n.nativeFlowName)))){if(!o("WAWebE2EProtoUtils").shouldParseNFM({name:m,bizInfo:n,msgContext:l})||o("WAWebE2EProtoUtils").hasUnsupportedButtons(c))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:s.contextInfo};if(d===o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.UNKNOWN||!new Set(o("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.members()).has(d))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:void 0}),contextInfo:s.contextInfo};var p=o("WAWebButtonsMessageProtoUtils").parseButtonsMessageProto({buttonsMessage:s,baseMessage:t,msgContext:l});if(m!=null){var _=babelHelpers.extends({},p,{type:o("WAWebMsgType").MSG_TYPE.NATIVE_FLOW,kind:o("WAWebMsgType").MsgKind.NativeFlow,nativeFlowName:r("WAWebInteractiveMessagesNativeFlowName").cast(m),nativeFlowButtons:c});return!_.nativeFlowName||!o("WAWebNativeFlowValidation").isValidNativeFlowMessage(_,a)?{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:s.contextInfo}:{msgData:_,contextInfo:s.contextInfo}}}}}l.default=e}),98);
__d("WAWebParseTemplateButtonReplyMessageProto",["WAWebE2EProtoUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.templateButtonReplyMessage;if(r!=null){var a=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.TEMPLATE_BUTTON_REPLY,kind:o("WAWebMsgType").MsgKind.TemplateButtonReply,body:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(r.selectedDisplayText),selectedIndex:r.selectedIndex,selectedId:r.selectedId,selectedCarouselCardIndex:r.selectedCarouselCardIndex});return{msgData:a,contextInfo:r.contextInfo}}}l.default=e}),98);
__d("WAWebLidMigrationDbUtils",["WALogger","WAWebApiChat","WAWebApiContact","WAWebLid1X1MigrationGating","WAWebSchemaChat","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=new Map,r=t.filter(function(e){var t=o("WAWebWidFactory").createWid(e);return t.isRegularUser()&&!t.isLid()});if(r.length===0)return n;var a=yield o("WAWebSchemaChat").getChatTable().bulkGet(r);return a.forEach(function(e,t){var a=e==null?void 0:e.accountLid;if(a==null){var i,l=o("WAWebWidFactory").createUserWidOrThrow(r[t]);a=(i=o("WAWebApiContact").getCurrentLid(l))==null?void 0:i.toString()}a!=null&&n.set(r[t],a)}),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["findAccountLidsForPnChatIds: "," lids for "," pn chats"])),n.size,t.length),n}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,n=e.filter(function(e){var t=o("WAWebWidFactory").createWid(e);return t.isLid()});if(n.length===0)return t;var r=yield o("WAWebSchemaChat").getChatTable().anyOf(["accountLid"],n);return r.forEach(function(e){var n=e.accountLid;n!=null&&t.set(n,e.id)}),n.forEach(function(e){if(!t.has(e)){var n,r=o("WAWebWidFactory").createUserLidOrThrow(e),a=(n=o("WAWebApiContact").getPhoneNumber(r))==null?void 0:n.toString();a!=null&&t.set(e,a)}}),t}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebLid1X1MigrationGating").Lid1X1MigrationUtils.isLidMigrated();if(t){var n=yield o("WAWebApiChat").getChatRecordByAccountLid(e),r=n[0],a=r==null?void 0:r.id;return a?o("WAWebWidFactory").createUserWidOrThrow(a):void 0}return o("WAWebApiContact").getPhoneNumber(e)}),p.apply(this,arguments)}l.findAccountLidsForPnChatIds=s,l.findChatIdsForAccountLids=c,l.getChatWidFromUserLid=m}),98);
__d("WAWebDBUpdateChatTable",["WALogger","WAWebDBChatValidation","WAWebMiscErrors","WAWebSchemaChat","err"],(function(t,n,r,o,a,i,l){var e;function s(t,n){return o("WAWebDBChatValidation").validateAccountLidInChatRow(n,"updateChatTable"),o("WAWebSchemaChat").getChatTable().merge(t.toString(),n).catch(function(t){throw t instanceof o("WAWebMiscErrors").DbOnLogoutAbort?t:(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateChatTable: failed to update in storage"]))).verbose().sendLogs("updateChatTable failed"),r("err")("updateChatTable failed"))})}l.updateChatTable=s}),98);
__d("WAWebLimitSharingModelUtils",["WAWebBackendApi","WAWebContactSystemMsg","WAWebDBUpdateChatTable","WAWebHandleSingleMsg","WAWebProtobufsProtocol.pb","WAWebSchemaChat","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebSchemaChat").getChatTable().get(e)}),s.apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){yield o("WAWebDBUpdateChatTable").updateChatTable(e,{limitSharing:t}),o("WAWebBackendApi").frontendFireAndForget("updateChatLimitSharing",{id:e,limitSharing:t})}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,r=yield e(t.toString());if((r==null||(n=r.limitSharing)==null?void 0:n.sharingLimited)===!0){var a={sharingLimited:r.limitSharing.sharingLimited,trigger:r.limitSharing.trigger},i=o("WAWebWidFactory").createWid(r.id);yield f(i,a)}}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.chatWID,r=t.sharingLimited;if(r===!0){var a,i=yield e(n.toString());if((i==null||(a=i.limitSharing)==null?void 0:a.sharingLimited)!==r){var l={sharingLimited:r,trigger:o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.UNKNOWN};return yield u(n,l),f(n,l)}}}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WAWebContactSystemMsg").genLimitSharingUpdateSystemMsg(e,t);return yield o("WAWebHandleSingleMsg").handleSingleMsg({chatId:e,newMsg:n,handleSingleMsgOrigin:"limitSharing"}),n}),g.apply(this,arguments)}l.getChat=e,l.updateChat=u,l.createLimitSharingMsgOnChatClear=d,l.genLimitSharingSystemMessageOnPersistedChat=p,l.genLimitSharingSystemMessage=f}),98);
__d("WAWebLimitSharingPropMappingUtils",["WAWebProtobufsProtocol.pb"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"1":return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.CHAT_SETTING;case"2":return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.BIZ_SUPPORTS_FB_HOSTING;case"3":return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.UNKNOWN_GROUP;default:return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.UNKNOWN}}function s(e){switch(e){case"CHAT_SETTING":return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.CHAT_SETTING;case"BIZ_SUPPORTS_FB_HOSTING":return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.BIZ_SUPPORTS_FB_HOSTING;default:return o("WAWebProtobufsProtocol.pb").LimitSharing$Trigger.UNKNOWN}}l.getLimitSharingTriggerFromHistorySyncStubParameter=e,l.getLimitSharingTriggerFromGroupSettingsChange=s}),98);
__d("WAWebLimitSharingProtoUtils",["WAWebCommonMsgSubtypeTypes","WAWebLimitSharingModelUtils","WAWebLimitSharingPropMappingUtils","WAWebMsgType","WAWebProtobufsWeb.pb","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e.messageStubType===o("WAWebProtobufsWeb.pb").WebMessageInfo$StubType.CHANGE_LIMIT_SHARING){var n=e.messageStubParameters,r=n[0],a=n[1],i=n[2],l={sharingLimited:r==="true",limitSharingSettingTimestamp:Number(e.messageTimestamp)*1e3,trigger:o("WAWebLimitSharingPropMappingUtils").getLimitSharingTriggerFromHistorySyncStubParameter(a)},s=h(l,i?o("WAWebWidFactory").createWid(i):void 0);yield S(t,s)}}),s.apply(this,arguments)}function u(e){return{sharingLimited:e.limitSharing,trigger:o("WAWebLimitSharingPropMappingUtils").getLimitSharingTriggerFromHistorySyncStubParameter(String(e.limitSharingTrigger)),initiatedByMe:e.limitSharingInitiatedByMe,limitSharingSettingTimestamp:e.limitSharingSettingTimestamp}}function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r;if(!(t==null||(e==null?void 0:e.from)==null||(e==null||(n=e.id)==null?void 0:n.remote)==null)){var o=v(t);if(o)yield m(e,o);else if((r=t.messageContextInfo)!=null&&r.limitSharingV2){var a;yield _(e,(a=t.messageContextInfo)==null?void 0:a.limitSharingV2)}}}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=h(t,o("WAWebWidFactory").createWid(e.from.toString()));yield S(e,n),yield y(e,n)}),p.apply(this,arguments)}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=h(t);yield y(e,n,!0)}),f.apply(this,arguments)}function g(e){var t,n,r=e.limitSharingMessage,o=e.protocolMessage;return r!=null&&(t=r.message)!=null&&(t=t.protocolMessage)!=null&&t.limitSharing?r==null||(n=r.message)==null?void 0:n.protocolMessage:o}function h(e,t){return{sharingLimited:e==null?void 0:e.sharingLimited,trigger:e==null?void 0:e.trigger,limitSharingSettingTimestamp:e==null?void 0:e.limitSharingSettingTimestamp,initiatedBy:t}}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){n===void 0&&(n=!1);var r=yield o("WAWebLimitSharingModelUtils").getChat(e.id.remote.toString());if(r&&b(t,r)){var a=o("WAWebWidFactory").createWid(r.id);yield o("WAWebLimitSharingModelUtils").updateChat(a,t),n&&(yield o("WAWebLimitSharingModelUtils").genLimitSharingSystemMessage(a,t))}}),C.apply(this,arguments)}function b(e,t){var n,r,o,a=(n=e==null?void 0:e.limitSharingSettingTimestamp)!=null?n:0,i=(r=t==null||(o=t.limitSharing)==null?void 0:o.limitSharingSettingTimestamp)!=null?r:0;return Number(a)>Number(i)}function v(e){var t;return(t=g(e))==null?void 0:t.limitSharing}function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){e.type=o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,e.subtype=o("WAWebCommonMsgSubtypeTypes").MsgSubtype.LimitSharingSystemMessage,e.limitSharing=t}),R.apply(this,arguments)}l.parseLimitSharingFromProtocolHistorySyncMessage=e,l.getLimitSharingFromProtocolHistorySyncConversation=u,l.parseLimitSharingFromMessage=c,l.getLimitSharingEnvelopeFromProtobuf=g,l.getLimitSharingFromEnvelope=h}),98);
__d("WAWebUserPrefsLabelAssociationsLidMigration",["WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(t,n,r,o,a,i,l){function e(){r("WAWebUserPrefsStore").set(o("WAWebUserPrefsKeys").UserPrefs.LabelAssociationsLidTableMigrationComplete,!0)}function s(){return r("WAWebUserPrefsStore").get(o("WAWebUserPrefsKeys").UserPrefs.LabelAssociationsLidTableMigrationComplete)===!0}l.setLabelAssociationsMigrationAsComplete=e,l.isLabelAssociationsMigrationComplete=s}),98);
__d("WAWebDBLabelAssociationDatabaseApi",["WAWebLidMigrationDbUtils","WAWebSchemaLabelAssociation","WAWebUserPrefsLabelAssociationsLidMigration","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebUserPrefsLabelAssociationsLidMigration").isLabelAssociationsMigrationComplete()?[].concat(yield f(e),e):e;yield o("WAWebSchemaLabelAssociation").getLabelAssociationTable().bulkRemove(t)}),s.apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebUserPrefsLabelAssociationsLidMigration").isLabelAssociationsMigrationComplete()?yield h(e):e;yield o("WAWebSchemaLabelAssociation").getLabelAssociationTable().bulkCreateOrReplace(t)}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaLabelAssociation").getLabelAssociationTable().anyOf(["labelId"],e);return o("WAWebUserPrefsLabelAssociationsLidMigration").isLabelAssociationsMigrationComplete()?v(t):t}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebUserPrefsLabelAssociationsLidMigration").isLabelAssociationsMigrationComplete()?yield C(e):e,n=yield o("WAWebSchemaLabelAssociation").getLabelAssociationTable().anyOf(["associationId","type"],t.map(function(e){var t=e.associationId,n=e.type;return[t,n]}));return o("WAWebUserPrefsLabelAssociationsLidMigration").isLabelAssociationsMigrationComplete()?v(n):n}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Set(e.filter(function(e){return o("WAWebSchemaLabelAssociation").getAssociationTypeFromPrimaryKey(e)===o("WAWebSchemaLabelAssociation").LabelAssociationType.Jid}).map(o("WAWebSchemaLabelAssociation").getAssociationIdFromPrimaryKey)),n=yield o("WAWebLidMigrationDbUtils").findAccountLidsForPnChatIds(Array.from(t));return e.map(function(e){var t=n.get(o("WAWebSchemaLabelAssociation").getAssociationIdFromPrimaryKey(e));return t==null?e:o("WAWebSchemaLabelAssociation").replaceAssociationIdInPrimaryKey(e,t)})}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(o("WAWebSchemaLabelAssociation").createLabelAssociationPrimaryKey),n=yield f(t);return n.map(o("WAWebSchemaLabelAssociation").createLabelAssociationRowFromPrimaryKey)}),y.apply(this,arguments)}function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.map(function(e){return o("WAWebSchemaLabelAssociation").createLabelAssociationPrimaryKey({associationId:e.associationId,type:e.type,labelId:"1"})}),n=yield f(t);return n.map(function(e){return{associationId:o("WAWebSchemaLabelAssociation").getAssociationIdFromPrimaryKey(e),type:o("WAWebSchemaLabelAssociation").getAssociationTypeFromPrimaryKey(e)}})}),b.apply(this,arguments)}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Set(e.filter(function(e){return e.type===o("WAWebSchemaLabelAssociation").LabelAssociationType.Jid}).map(function(e){return e.associationId})),n=yield o("WAWebLidMigrationDbUtils").findChatIdsForAccountLids(Array.from(t));return e.map(function(e){var t;return babelHelpers.extends({},e,{associationId:(t=n.get(e.associationId))!=null?t:e.associationId})})}),S.apply(this,arguments)}l.removeLabelAssociations=e,l.addOrEditLabelAssociations=u,l.queryLabelAssociationsForLabelIds=d,l.queryLocalLabelAssociations=p}),98);
__d("WAWebDBQueryAndRemoveLocalLabelAssociation",["WAWebDBLabelAssociationDatabaseApi","WAWebSchemaLabelAssociation","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebDBLabelAssociationDatabaseApi").queryLocalLabelAssociations(e);yield o("WAWebDBLabelAssociationDatabaseApi").removeLabelAssociations(t.map(o("WAWebSchemaLabelAssociation").createLabelAssociationPrimaryKey))}),s.apply(this,arguments)}l.queryAndRemoveLocalLabelAssociation=e}),98);
__d("WAWebParseLocationMessageProto",["WALongInt","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e,t){var n,r,a=((n=e.name)!=null?n:"")||((r=e.address)!=null?r:"");e.name!=null&&e.name!==""&&e.address!=null&&e.address!==""&&(a=e.name+"\n"+e.address);var i=e.degreesLatitude!==void 0?e.degreesLatitude:void 0,l=e.degreesLongitude!==void 0?e.degreesLongitude:void 0,s=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.LOCATION,kind:o("WAWebMsgType").MsgKind.Location,loc:a,lat:i,lng:l,body:o("WAWebE2EProtoParserApi").decodeBytes(e.jpegThumbnail)||"",clientUrl:e.url});return{msgData:s,contextInfo:e.contextInfo}}function s(e,t,n){var r;n&&(r={finalLat:n.degreesLatitude,finalLng:n.degreesLongitude,finalThumbnail:o("WAWebE2EProtoParserApi").decodeBytes(n.jpegThumbnail)||"",finalAccuracy:n.accuracyInMeters,finalSpeed:n.speedInMps,finalDegrees:n.degreesClockwiseFromMagneticNorth,finalTimeOffset:n.timeOffset});var a=babelHelpers.extends({},t,r,{type:o("WAWebMsgType").MSG_TYPE.LOCATION,kind:o("WAWebMsgType").MsgKind.LocationLive,isLive:!0,lat:e.degreesLatitude,lng:e.degreesLongitude,body:o("WAWebE2EProtoParserApi").decodeBytes(e.jpegThumbnail)||"",accuracy:e.accuracyInMeters,speed:e.speedInMps,degrees:e.degreesClockwiseFromMagneticNorth,comment:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(e.caption),sequence:o("WALongInt").maybeNumberOrThrowIfTooLarge(e.sequenceNumber)});return{msgData:a,contextInfo:e.contextInfo}}function u(t){var n=t.baseMessage,r=t.finalLocation,o=t.messageProtobuf,a=o.liveLocationMessage,i=o.locationMessage,l=null;return i!=null&&(l=e(i,n)),a!=null&&(l=s(a,n,r)),l}l.default=u}),98);
__d("WAWebMmSignalSharingExpirationWindowUtils",["$InternalEnum","WATimeUtils","WAWebBackendApi","WAWebE2EProtoUtils","WAWebMmSignalSharingContextInfo","WAWebMmSignalSharingGatingUtils","WAWebMmSignalSharingLoggingEvents","WAWebMmSignalSharingTos"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({DISCLOSED_TOKEN:"data_sharing_encrypted_token_disclosed",UNDISCLOSED_TOKEN:"data_sharing_encrypted_token_undisclosed"});function s(e,t){if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()&&t){var n=d(t),r=o("WAWebMmSignalSharingContextInfo").getMmSignalSharingContextInfoDisclosureFlag(t),a=o("WAWebMmSignalSharingContextInfo").existsMmSignalSharingURlTrackingMapElements(t);(n.disclosedToken!=null||n.undisclosedToken!=null||r!=null||a)&&(e.mmSignalSharing=babelHelpers.extends({dataSharingFlags:r,existsDisclosedToken:!!n.disclosedToken,existsUndisclosedToken:!!n.undisclosedToken},a?{urlTrackingMapElements:o("WAWebMmSignalSharingContextInfo").getMmSignalSharingURLTrackingMapElements(t)}:{}),o("WAWebBackendApi").frontendFireAndForget("updateMmSignalSharingExpirationWindow",{id:e.id.remote,msg:e,contextInfo:t}),o("WAWebMmSignalSharingLoggingEvents").logMmSignalSharingUpdateExpirationWindowEvent({msg:e,contextInfo:t}))}}function u(e){return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()?o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted()&&p(e):!1}function c(e,t,n,r,a){if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return null;var i=babelHelpers.extends({unixTime:{client:r,server:n},messageId:t},d(a));return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingOptimizedDeliveryMultipleCollectionWindowsEnabled()?g(e,i):[i]}function d(e){var t,n={disclosedToken:void 0,undisclosedToken:void 0};if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return n;var r=e==null||(t=e.dataSharingContext)==null?void 0:t.parameters;return r!=null?y(r,n):n}function m(e,t){var n;if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return null;var r=e==null||(n=e.message)==null||(n=n.interactiveMessage)==null?void 0:n.contextInfo;return e!=null&&e.key&&o("WAWebMmSignalSharingContextInfo").existsMmSignalSharingContextInfoDisclosureFlag(r)?c(t,o("WAWebE2EProtoUtils").protobufToMsgKey(e.key),Number(e.messageTimestamp),Number(e.messageTimestamp),r):t}function p(e){if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return!1;var t=e==null?void 0:e[e.length-1];return t!=null&&!_(t)}function _(e){return e.unixTime.server+o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingCollectionWindow()<o("WATimeUtils").unixTime()}function f(e,t){return e.unixTime.server+t*3600<o("WATimeUtils").unixTime()}function g(e,t){var n=e!=null?e:[];for(var r of n!=null?n:[])h(r);return n.filter(function(e){var t=e.disclosedToken,n=e.undisclosedToken;return t!=null||n!=null}).concat(t)}function h(e){var t=o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingOptimizedDeliverySignalCollectionConfig(),n=t.consented_collection_window_in_hours,r=t.non_consented_collection_window_in_hours;f(e,n)&&(e.disclosedToken=void 0),f(e,r)&&(e.undisclosedToken=void 0)}function y(t,n){var r=o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingOptimizedDeliveryTokensStorageConfig(),a=r.store_consented_token_enabled,i=r.store_non_consented_token_enabled;return t.reduce(function(t,n){return{disclosedToken:a&&n.key===e.DISCLOSED_TOKEN?n.stringData:t.disclosedToken,undisclosedToken:i&&n.key===e.UNDISCLOSED_TOKEN?n.stringData:t.undisclosedToken}},n)}l.updateMmSignalSharingExpirationWindow=s,l.isMmSignalSharingUserDisclosedInCollectionWindow=u,l.getMmSignalSharingExpirationWindow=c,l.getMmSignalSharingExpirationTokens=d,l.getUpdatedMmSignalSharingExpirationWindowFromHistorySync=m,l.isMmSignalSharingExpirationWindowActive=p,l.hasMmSignalSharingWindowExpired=_,l.hasMmSignalSharingTokenExpired=f}),98);
__d("WAWebBlockContants",[],(function(t,n,r,o,a,i){var e=Object.freeze({OneToOneOldSpamBannerBlock:"1_1_old_spam_banner_block",OneToOneSpamBannerBlock:"1_1_spam_banner_block",AccountInfo:"account_info",AccountInfoReport:"account_info_report",BizOldSpamBannerBlock:"biz_old_spam_banner_block",BizSpamBannerBlock:"biz_spam_banner_block",BlockHeaderChat:"block_header_chat",CallLog:"call_log",Chat:"chat",ChatListBlock:"chat_list_block",ChatListContextMenuBlock:"chat_list_context_menu_block",ChatListNoInsubBlock:"chat_list_noinsub_block",NotificationBlock:"notification_block",OverflowMenuBlock:"overflow_menu_block",OverflowMenuReport:"overflow_menu_report",Profile:"profile",TriggeredBlock:"triggered_block",BlockList:"block_list",MediaViewer:"media_viewer",MessageMenu:"message_menu",OneToOneChatSpamBannerReport:"1_1_spam_banner_report",StatusPostReport:"status_post_report",ChatFmxCardBlock:"chat_fmx_card_block",ChatFmxCardBlockSuspicious:"chat_fmx_card_block_suspicious",ChatFmxCardSafetyToolsBlock:"chat_fmx_card_safety_tools_block",ChatFmxCardSafetyToolsBlockSuspicious:"chat_fmx_card_safety_tools_block_suspicious",ChatFmxCardSafetyToolsReport:"chat_fmx_card_safety_tools_report",ChatFmxCardSafetyToolsReportSuspicious:"chat_fmx_card_safety_tools_report_suspicious",OneToOneBlockedChatComposer:"one_to_one_blocked_chat_composer"}),l=Object.freeze({NoLongerNeeded:"no_longer_needed",NoSignUp:"no_sign_up",OffensiveMessages:"offensive_messages",Spam:"spam",Other:"other"}),s=Object.freeze({False:"false",True:"true",None:"none"}),u=Object.freeze({CatalogLink:"catalog_link",ClickToChatLink:"click_to_chat_link",Ctwa:"ctwa",MessageShortLink:"message_short_link",ProductLink:"product_link",QrCode:"qr_code"});i.BlockEntryPoint=e,i.BizOptOutReason=l,i.BizOptOutFirstMessage=s}),66);
__d("WAWebWamEnumDisclosureEventType",[],(function(t,n,r,o,a,i){var e=Object.freeze({CTA_URL_CLICK:0,BODY_URL_CLICK:1,BODY_URL_LONG_PRESS:2,DISCLOSURE_INFO_CLICK:3,OPEN_CHAT_WITH_UNREAD_MM:4,CTA_APP_CLICK:5});i.DISCLOSURE_EVENT_TYPE=e}),66);
__d("WAWebWamEnumDisclosureInteraction",[],(function(t,n,r,o,a,i){var e=Object.freeze({CONTINUE:0,CANCEL:1,DISMISSED:2,LEARN_MORE:3});i.DISCLOSURE_INTERACTION=e}),66);
__d("WAWebWamEnumDisclosureSource",[],(function(t,n,r,o,a,i){var e=Object.freeze({BLOCKING:0,NON_BLOCKING:1,INFO:2});i.DISCLOSURE_SOURCE=e}),66);
__d("WAWebWamEnumDisclosureSuppressionReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({COOLDOWN_FROM_CTWA:0,COOLDOWN_FROM_MM:1,DISCLOSED:2,OPT_OUT_TOS2016:3,NO_SHOW_MM_DISCLOSURE_FLAG:4,NOT_FROM_CAPI:5,NOT_MARKETING_MESSAGE:6,ABPROP_DISABLED:7,OPT_OUT_TOS2021:8,BODY_LINK_DISCLOSURE_AB_PROP_DISABLED:9,ANOTHER_DIALOG_DISPLAYED:10,EVENT_TYPE_AB_PROP_DISABLED:11});i.DISCLOSURE_SUPPRESSION_REASON=e}),66);
__d("WAWebWamEnumDisclosureSurface",[],(function(t,n,r,o,a,i){var e=Object.freeze({BIZ_PROFILE_SCREEN:0,CHAT_THREAD:1});i.DISCLOSURE_SURFACE=e}),66);
__d("WAWebWamEnumSignalCanceledReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({COMPANION_DEVICE:0,DISCLOSURE_DISMISSED:1,INVALID_ORIGINAL_URL:2});i.SIGNAL_CANCELED_REASON=e}),66);
__d("WAWebWamEnumSignalOrigin",[],(function(t,n,r,o,a,i){var e=Object.freeze({CTA_URL_CLICK:0,BODY_URL_CLICK:1,BODY_URL_LONG_PRESS:2,CTA_APP_CLICK:3});i.SIGNAL_ORIGIN=e}),66);
__d("WAWebWamEnumSignalSharingStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({ONE_PD:0,SP:1,NOT_SHARED:2});i.SIGNAL_SHARING_STATUS=e}),66);
__d("WAWebWamEnumSignalSurface",[],(function(t,n,r,o,a,i){var e=Object.freeze({BIZ_PROFILE_SCREEN:0,CHAT_THREAD:1,CHAT_LIST:2,OTHER:3});i.SIGNAL_SURFACE=e}),66);
__d("WAWebWamEnumSignalType",[],(function(t,n,r,o,a,i){var e=Object.freeze({MM_CLICK:0,USER_BLOCK:1,USER_REPORT:2,FIRST_CUSTOMER_MESSAGE:3,FIRST_CUSTOMER_MESSAGE_CONTINUATION:4,FIRST_BIZ_REPLY:5,FIRST_BIZ_REPLY_CONTINUATION:6,SECOND_CUSTOMER_MESSAGE:7,SECOND_CUSTOMER_MESSAGE_CONTINUATION:8,SECOND_BIZ_REPLY:9,SECOND_BIZ_REPLY_CONTINUATION:10,THIRD_CUSTOMER_MESSAGE:11,THIRD_CUSTOMER_MESSAGE_CONTINUATION:12,THIRD_BIZ_REPLY:13,USER_INTERESTED:14,USER_NOT_INTERESTED:15,USER_STOP_OFFERS:16,USER_BLOCK_REASON_NO_LONGER_NEEDED:17,USER_BLOCK_REASON_NO_SIGN_UP:18,USER_BLOCK_REASON_SPAM:19,USER_BLOCK_REASON_OFFENSIVE_MESSAGES:20,USER_BLOCK_REASON_OTP_DID_NOT_REQUEST:21,USER_BLOCK_REASON_OTHER:22,USER_MUTE:23,USER_BLOCK_REASON_SCAM_OR_FRAUD:24});i.SIGNAL_TYPE=e}),66);
__d("WAWebMmSignalSharingLoggingEvents",["WAWebBlockContants","WAWebHandleMsgTypes.flow","WAWebMmSignalSharingExpirationWindowUtils","WAWebMmSignalSharingGatingUtils","WAWebMmSignalSharingLoggingUtils","WAWebMmSignalSharingModelUtils","WAWebMmSignalSharingTos","WAWebSchemaChat","WAWebWamEnumBlockEntryPoint","WAWebWamEnumDisclosureEventType","WAWebWamEnumDisclosureInteraction","WAWebWamEnumDisclosureSource","WAWebWamEnumDisclosureSuppressionReason","WAWebWamEnumDisclosureSurface","WAWebWamEnumMmSignalType","WAWebWamEnumSignalCanceledReason","WAWebWamEnumSignalOrigin","WAWebWamEnumSignalSharingStatus","WAWebWamEnumSignalSurface","WAWebWamEnumSignalType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e={type:o("WAWebWamEnumSignalType").SIGNAL_TYPE.MM_CLICK,surface:o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.CHAT_THREAD},s={1:{fromUser:function(t){return[t.FIRST_CUSTOMER_MESSAGE,t.FIRST_CUSTOMER_MESSAGE_CONTINUATION]},fromBusiness:function(t){return[t.FIRST_BIZ_REPLY,t.FIRST_BIZ_REPLY_CONTINUATION]}},2:{fromUser:function(t){return[t.SECOND_CUSTOMER_MESSAGE,t.SECOND_CUSTOMER_MESSAGE_CONTINUATION]},fromBusiness:function(t){return[t.SECOND_BIZ_REPLY,t.SECOND_BIZ_REPLY_CONTINUATION]}},3:{fromUser:function(t){return[t.THIRD_CUSTOMER_MESSAGE,t.THIRD_CUSTOMER_MESSAGE_CONTINUATION]},fromBusiness:function(t){return[t.THIRD_BIZ_REPLY]}}};function u(t){var n=t.chat,r=t.eventType,a=t.hasShownDisclosure,i=a===void 0?!1:a,l=t.linkTypeIndex,s=t.msg;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(n.id.toString())){var u=o("WAWebMmSignalSharingModelUtils").getMMSignalSharingUrls(r,s.unsafe(),l),c=r===o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE.BODY_URL_CLICK?o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN.BODY_URL_CLICK:o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN.CTA_URL_CLICK,d=o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted();if((u==null?void 0:u.consentedUrl)!=null||(u==null?void 0:u.unconsentedUrl)!=null||(u==null?void 0:u.originalUrl)!=null){var m;(u==null?void 0:u.consentedUrl)!=null?m=o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.ONE_PD:(u==null?void 0:u.unconsentedUrl)!=null?m=o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.SP:m=o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.NOT_SHARED,o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingVerificationEvent({chat:n,msg:s,linkOptions:u,signal:babelHelpers.extends({},e,{sharingStatus:m,origin:c})}),o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingDisclosureStateEvent({chat:n,msg:s,signal:{disclosureEventType:r,disclosureSurface:o("WAWebWamEnumDisclosureSurface").DISCLOSURE_SURFACE.CHAT_THREAD,disclosureInteraction:d&&i?o("WAWebWamEnumDisclosureInteraction").DISCLOSURE_INTERACTION.CONTINUE:void 0,disclosureSource:d&&i?o("WAWebWamEnumDisclosureSource").DISCLOSURE_SOURCE.NON_BLOCKING:void 0,disclosureSuppressionReason:E({eventType:r,msg:s,isDisclosureTosAccepted:d,hasShownDisclosure:i}),mmHasDisclosedUrl:o("WAWebMmSignalSharingModelUtils").existsMmSignalSharingConsentedUrl(s),mmHasShowDisclosureFlag:o("WAWebMmSignalSharingModelUtils").isDisclosureEnabledForMsg(s),userBecameDisclosed:d&&i}})}}}function c(t){var n=t.chat,r=t.eventType,a=t.isExplicitCancel,i=t.msg;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(n.id.toString())){var l=o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted();o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingVerificationEvent({chat:n,msg:i,signal:babelHelpers.extends({},e,{canceledReason:o("WAWebWamEnumSignalCanceledReason").SIGNAL_CANCELED_REASON.DISCLOSURE_DISMISSED,origin:r===o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE.BODY_URL_CLICK?o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN.BODY_URL_CLICK:o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN.CTA_URL_CLICK,sharingStatus:o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.NOT_SHARED})}),o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingDisclosureStateEvent({chat:n,msg:i,signal:{disclosureEventType:r,disclosureInteraction:a?o("WAWebWamEnumDisclosureInteraction").DISCLOSURE_INTERACTION.CANCEL:o("WAWebWamEnumDisclosureInteraction").DISCLOSURE_INTERACTION.DISMISSED,disclosureSource:o("WAWebWamEnumDisclosureSource").DISCLOSURE_SOURCE.NON_BLOCKING,disclosureSurface:o("WAWebWamEnumDisclosureSurface").DISCLOSURE_SURFACE.CHAT_THREAD,mmHasDisclosedUrl:o("WAWebMmSignalSharingModelUtils").existsMmSignalSharingConsentedUrl(i),mmHasShowDisclosureFlag:o("WAWebMmSignalSharingModelUtils").isDisclosureEnabledForMsg(i),userBecameDisclosed:l}})}}function d(e){var t=e.chat,n=e.eventType;o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(t.id.toString())&&o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingDisclosureStateEvent({chat:t,signal:{disclosureEventType:n,disclosureInteraction:o("WAWebWamEnumDisclosureInteraction").DISCLOSURE_INTERACTION.LEARN_MORE,disclosureSource:o("WAWebWamEnumDisclosureSource").DISCLOSURE_SOURCE.INFO,disclosureSurface:o("WAWebWamEnumDisclosureSurface").DISCLOSURE_SURFACE.BIZ_PROFILE_SCREEN}})}function m(e){var t=e.chat,n=e.spamFlow;f({chat:t,type:o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_REPORT,surface:n==="account_info_report"?o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.BIZ_PROFILE_SCREEN:o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.CHAT_THREAD})}function p(e){var t=e.blockEntryPointMetric,n=e.chat,r=e.reason;f({chat:n,type:C(r),surface:t===o("WAWebWamEnumBlockEntryPoint").BLOCK_ENTRY_POINT.PROFILE?o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.BIZ_PROFILE_SCREEN:o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.CHAT_THREAD})}function _(e){var t=e.chat;f({chat:t,type:o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_STOP_OFFERS,surface:o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.BIZ_PROFILE_SCREEN})}function f(e){var t,n,r=e.chat,a=e.msg,i=e.type,l=e.surface,s=l===void 0?o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.BIZ_PROFILE_SCREEN:l;o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(r==null||(t=r.id)==null?void 0:t.toString())&&r&&((n=r.contact)==null||(n=n.privacyMode)==null?void 0:n.hostStorage)===o("WAWebHandleMsgTypes.flow").HostStorageEnumType.Facebook&&o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted()&&o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingVerificationEvent({chat:r,msg:a,signal:{type:i,surface:s,sharingStatus:o("WAWebMmSignalSharingExpirationWindowUtils").isMmSignalSharingUserDisclosedInCollectionWindow(r.mmSignalSharingExpirationWindow)?o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.ONE_PD:o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.SP}})}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.contextInfo,n=e.msg;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled()){var r=yield o("WAWebSchemaChat").getChatTable().get(n.id.remote.toString());if(r!=null){var a,i=o("WAWebMmSignalSharingExpirationWindowUtils").getMmSignalSharingExpirationTokens(t);o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingCollectionWindowStateEvent({chatWID:r.id,msg:n,signal:{mmDisclosureFlags:(a=n.mmSignalSharing)==null?void 0:a.dataSharingFlags,mmHasDisclosedUrl:o("WAWebMmSignalSharingModelUtils").existsMmSignalSharingConsentedUrl(n),mmHasShowDisclosureFlag:o("WAWebMmSignalSharingModelUtils").isDisclosureEnabledForMsg(n),mmHasDisclosedToken:!!(i!=null&&i.disclosedToken)}})}}}),h.apply(this,arguments)}function y(e){var t,n=e.blockEntryPointMetric,r=e.chat,a=e.reason;!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(r==null||(t=r.id)==null?void 0:t.toString())||!o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingBlockAndReportEntryPointsAllowlist().includes(n)||T({chat:r,mmSignalType:b(a)})}function C(e){var t;if(e==null)return o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK;var n=(t={},t[o("WAWebBlockContants").BizOptOutReason.NoLongerNeeded]=o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK_REASON_NO_LONGER_NEEDED,t[o("WAWebBlockContants").BizOptOutReason.NoSignUp]=o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK_REASON_NO_SIGN_UP,t[o("WAWebBlockContants").BizOptOutReason.OffensiveMessages]=o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK_REASON_OFFENSIVE_MESSAGES,t[o("WAWebBlockContants").BizOptOutReason.Spam]=o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK_REASON_SPAM,t[o("WAWebBlockContants").BizOptOutReason.Other]=o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK_REASON_OTHER,t);return n[e]}function b(e){var t;if(e==null)return o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_BLOCK;var n=(t={},t[o("WAWebBlockContants").BizOptOutReason.NoLongerNeeded]=o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_BLOCK_REASON_NO_LONGER_NEEDED,t[o("WAWebBlockContants").BizOptOutReason.NoSignUp]=o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_BLOCK_REASON_NO_SIGN_UP,t[o("WAWebBlockContants").BizOptOutReason.OffensiveMessages]=o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_BLOCK_REASON_OFFENSIVE_MESSAGES,t[o("WAWebBlockContants").BizOptOutReason.Spam]=o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_BLOCK_REASON_SPAM,t[o("WAWebBlockContants").BizOptOutReason.Other]=o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_BLOCK_REASON_OTHER,t);return n[e]}function v(e){var t,n=e.blockEntryPointMetric,r=e.chat;!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(r==null||(t=r.id)==null?void 0:t.toString())||!o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingBlockAndReportEntryPointsAllowlist().includes(n)||T({chat:r,mmSignalType:o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_REPORT})}function S(e){var t=e.chat,n=e.msg;T({chat:t,mmSignalType:o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_INTERESTED}),f({chat:t,msg:n,type:o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_INTERESTED})}function R(e){var t=e.chat,n=e.msg;T({chat:t,mmSignalType:o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE.USER_NOT_INTERESTED}),f({chat:t,msg:n,type:o("WAWebWamEnumSignalType").SIGNAL_TYPE.USER_NOT_INTERESTED})}function L(e){var t,n=e.chat,r=e.newMsg;if(!(((t=n.contact)==null||(t=t.privacyMode)==null?void 0:t.hostStorage)!==o("WAWebHandleMsgTypes.flow").HostStorageEnumType.Facebook||!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(n.id.toString()))){var a=r.id.fromMe,i=o("WAWebMmSignalSharingModelUtils").getMmSignalSharingNewMessageParams({chat:n,fromMe:a});if(i){var l=i.isContinuation,s=i.messageOriginGroups,u=k(s,l,a,o("WAWebWamEnumSignalType").SIGNAL_TYPE),c=k(s,l,a,o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE);if(c!=null&&T({chat:n,mmSignalType:c}),u!=null){var d=o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted();o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingVerificationEvent({chat:n,msg:r,signal:babelHelpers.extends({type:u,surface:o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE.CHAT_THREAD},d?{sharingStatus:o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.ONE_PD}:{sharingStatus:o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.NOT_SHARED})})}}}}function E(e){var t=e.eventType,n=e.hasShownDisclosure,r=e.isDisclosureTosAccepted,a=e.msg;if(!a||!o("WAWebMmSignalSharingModelUtils").isDisclosureEnabledForMsg(a))return o("WAWebWamEnumDisclosureSuppressionReason").DISCLOSURE_SUPPRESSION_REASON.NO_SHOW_MM_DISCLOSURE_FLAG;if(t===o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE.BODY_URL_CLICK&&!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureForMarketingMessageBodyLinksEnabled())return o("WAWebWamEnumDisclosureSuppressionReason").DISCLOSURE_SUPPRESSION_REASON.BODY_LINK_DISCLOSURE_AB_PROP_DISABLED;if(r&&n!==!0)return o("WAWebWamEnumDisclosureSuppressionReason").DISCLOSURE_SUPPRESSION_REASON.DISCLOSED}function k(e,t,n,r){var o=s[String(e)];return o?I(o,t,n,r):null}function I(e,t,n,r){var o,a,i=n?e.fromUser:e.fromBusiness;return t?(o=i(r))==null?void 0:o[1]:(a=i(r))==null?void 0:a[0]}function T(e){var t,n=e.chat,r=e.deepConversationParams,a=e.mmSignalType;if(!(!n||!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(n==null||(t=n.id)==null?void 0:t.toString()))){var i=o("WAWebMmSignalSharingModelUtils").getMMSignalSharingData({chat:n,mmSignalType:a,deepConversationParams:r});n&&i!=null&&o("WAWebMmSignalSharingExpirationWindowUtils").isMmSignalSharingUserDisclosedInCollectionWindow(n.mmSignalSharingExpirationWindow)&&o("WAWebMmSignalSharingLoggingUtils").logMmSignalSharingEvent({chat:n,signal:{mmSignalType:a,mmSignalData:i}})}}l.logMmSignalSharingLinkClickEvent=u,l.logMmSignalSharingDisclosureCancelEvent=c,l.logMmSignalSharingDisclosureLearnMoreEvent=d,l.logMmSignalSharingReportVerificationEvent=m,l.logMmSignalSharingBlockVerificationEvent=p,l.logMmSignalSharingUserStopOffersVerificationEvent=_,l.logMmSignalSharingUpdateExpirationWindowEvent=g,l.logMmSignalSharingUserBlockWithReasonEvent=y,l.logMmSignalSharingUserReportEvent=v,l.logMmSignalSharingUserInterestedEvent=S,l.logMmSignalSharingUserNotInterestedEvent=R,l.logMmSignalSharingNewMessageEvent=L}),98);
__d("WAWebMmCollectionWindowStateEventWamEvent",["WAWebWamCodegenUtils"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({MmCollectionWindowStateEvent:[6744,{businessLidOrJid:[1,e.TYPES.STRING],entSourceSubplatform:[7,e.TYPES.STRING],isUserDisclosed:[8,e.TYPES.BOOLEAN],mmDisclosureFlags:[6,e.TYPES.INTEGER],mmHasDisclosedToken:[2,e.TYPES.BOOLEAN],mmHasDisclosedUrl:[3,e.TYPES.BOOLEAN],mmHasShowDisclosureFlag:[4,e.TYPES.BOOLEAN],mmHasUndisclosedToken:[9,e.TYPES.BOOLEAN],templateId:[5,e.TYPES.STRING]},[1,1,1],"private",113760892]},{MmCollectionWindowStateEvent:[]});l.MmCollectionWindowStateEventWamEvent=s}),98);
__d("WAWebMmDisclosureStateEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDisclosureEventType","WAWebWamEnumDisclosureInteraction","WAWebWamEnumDisclosureSource","WAWebWamEnumDisclosureSuppressionReason","WAWebWamEnumDisclosureSurface"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({MmDisclosureStateEvent:[6552,{businessLidOrJid:[1,e.TYPES.STRING],deltaTimeReceived:[15,e.TYPES.INTEGER],disclosureEventType:[3,o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE],disclosureInteraction:[4,o("WAWebWamEnumDisclosureInteraction").DISCLOSURE_INTERACTION],disclosureSource:[5,o("WAWebWamEnumDisclosureSource").DISCLOSURE_SOURCE],disclosureSuppressionReason:[6,o("WAWebWamEnumDisclosureSuppressionReason").DISCLOSURE_SUPPRESSION_REASON],disclosureSurface:[7,o("WAWebWamEnumDisclosureSurface").DISCLOSURE_SURFACE],entSourceSubplatform:[16,e.TYPES.STRING],isCompanionDevice:[14,e.TYPES.BOOLEAN],isNetworkAvailable:[18,e.TYPES.BOOLEAN],isUserDisclosed:[8,e.TYPES.BOOLEAN],mmDisclosureFlags:[19,e.TYPES.INTEGER],mmHasDisclosedUrl:[9,e.TYPES.BOOLEAN],mmHasShowDisclosureFlag:[10,e.TYPES.BOOLEAN],templateId:[11,e.TYPES.STRING],userBecameDisclosed:[13,e.TYPES.BOOLEAN]},[1,1,1],"private",113760892]},{MmDisclosureStateEvent:[]});l.MmDisclosureStateEventWamEvent=s}),98);
__d("WAWebMmDisclosureStateFsEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDisclosureEventType","WAWebWamEnumDisclosureInteraction","WAWebWamEnumDisclosureSource","WAWebWamEnumDisclosureSuppressionReason","WAWebWamEnumDisclosureSurface"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({MmDisclosureStateFsEvent:[6796,{disclosureEventType:[1,o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE],disclosureInteraction:[2,o("WAWebWamEnumDisclosureInteraction").DISCLOSURE_INTERACTION],disclosureSource:[3,o("WAWebWamEnumDisclosureSource").DISCLOSURE_SOURCE],disclosureSuppressionReason:[4,o("WAWebWamEnumDisclosureSuppressionReason").DISCLOSURE_SUPPRESSION_REASON],disclosureSurface:[5,o("WAWebWamEnumDisclosureSurface").DISCLOSURE_SURFACE],isCompanionDevice:[6,e.TYPES.BOOLEAN],isUserDisclosed:[7,e.TYPES.BOOLEAN],mmDisclosureFlags:[12,e.TYPES.INTEGER],mmHasDisclosedUrl:[8,e.TYPES.BOOLEAN],mmHasShowDisclosureFlag:[9,e.TYPES.BOOLEAN],threadIdHmac:[10,e.TYPES.STRING],userBecameDisclosed:[11,e.TYPES.BOOLEAN]},[1,1,1],"regular"]},{MmDisclosureStateFsEvent:[]});l.MmDisclosureStateFsEventWamEvent=s}),98);
__d("WAWebWamEnumOnePdSignalNotSharedReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({VALUE_NOT_AVAILABLE:0,WINDOW_EXPIRED:1,TOKEN_EXPIRED:2,SIGNAL_NOT_ALLOWLISTED:3,INVALID_URL:4,DISCLOSURE_ABPROP_DISABLED:5,USER_UNDISCLOSED_OR_NOT_ELIGIBLE_FOR_DISCLOSURE:6});i.ONE_PD_SIGNAL_NOT_SHARED_REASON=e}),66);
__d("WAWebWamEnumSignalMessageState",[],(function(t,n,r,o,a,i){var e=Object.freeze({TRUNCATED:0,EXPANDED:1,ORIGINAL:2});i.SIGNAL_MESSAGE_STATE=e}),66);
__d("WAWebWamEnumSignalMessageType",[],(function(t,n,r,o,a,i){var e=Object.freeze({NFM:0,HSM:1});i.SIGNAL_MESSAGE_TYPE=e}),66);
__d("WAWebWamEnumSpSignalNotSharedReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({VALUE_NOT_AVAILABLE:0,WINDOW_EXPIRED:1,TOKEN_EXPIRED:2,SIGNAL_NOT_ALLOWLISTED:3,INVALID_URL:4});i.SP_SIGNAL_NOT_SHARED_REASON=e}),66);
__d("WAWebMmSignalSharingVerificationEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOnePdSignalNotSharedReason","WAWebWamEnumSignalCanceledReason","WAWebWamEnumSignalMessageState","WAWebWamEnumSignalMessageType","WAWebWamEnumSignalOrigin","WAWebWamEnumSignalSharingStatus","WAWebWamEnumSignalSurface","WAWebWamEnumSignalType","WAWebWamEnumSpSignalNotSharedReason"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({MmSignalSharingVerificationEvent:[6554,{businessLidOrJid:[1,e.TYPES.STRING],collectionWindowId:[3,e.TYPES.STRING],deltaTimeReceived:[18,e.TYPES.INTEGER],entSourceSubplatform:[17,e.TYPES.STRING],isCompanionDevice:[16,e.TYPES.BOOLEAN],isNetworkAvailable:[20,e.TYPES.BOOLEAN],isShimmingSignal:[21,e.TYPES.BOOLEAN],isUserDisclosed:[4,e.TYPES.BOOLEAN],onePdSignalNotSharedReason:[5,o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON],signalCanceledReason:[6,o("WAWebWamEnumSignalCanceledReason").SIGNAL_CANCELED_REASON],signalMessageState:[7,o("WAWebWamEnumSignalMessageState").SIGNAL_MESSAGE_STATE],signalMessageType:[8,o("WAWebWamEnumSignalMessageType").SIGNAL_MESSAGE_TYPE],signalOrigin:[9,o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN],signalSharingStatus:[10,o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS],signalSurface:[11,o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE],signalType:[12,o("WAWebWamEnumSignalType").SIGNAL_TYPE],spSignalNotSharedReason:[13,o("WAWebWamEnumSpSignalNotSharedReason").SP_SIGNAL_NOT_SHARED_REASON],templateId:[14,e.TYPES.STRING]},[1,1,1],"private",113760892]},{MmSignalSharingVerificationEvent:[]});l.MmSignalSharingVerificationEventWamEvent=s}),98);
__d("WAWebMmSignalSharingVerificationFsEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOnePdSignalNotSharedReason","WAWebWamEnumSignalCanceledReason","WAWebWamEnumSignalMessageState","WAWebWamEnumSignalMessageType","WAWebWamEnumSignalOrigin","WAWebWamEnumSignalSharingStatus","WAWebWamEnumSignalSurface","WAWebWamEnumSignalType","WAWebWamEnumSpSignalNotSharedReason"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({MmSignalSharingVerificationFsEvent:[6798,{isCompanionDevice:[1,e.TYPES.BOOLEAN],isShimmingSignal:[13,e.TYPES.BOOLEAN],isUserDisclosed:[2,e.TYPES.BOOLEAN],onePdSignalNotSharedReason:[3,o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON],signalCanceledReason:[4,o("WAWebWamEnumSignalCanceledReason").SIGNAL_CANCELED_REASON],signalMessageState:[5,o("WAWebWamEnumSignalMessageState").SIGNAL_MESSAGE_STATE],signalMessageType:[6,o("WAWebWamEnumSignalMessageType").SIGNAL_MESSAGE_TYPE],signalOrigin:[7,o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN],signalSharingStatus:[8,o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS],signalSurface:[9,o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE],signalType:[10,o("WAWebWamEnumSignalType").SIGNAL_TYPE],spSignalNotSharedReason:[11,o("WAWebWamEnumSpSignalNotSharedReason").SP_SIGNAL_NOT_SHARED_REASON],threadIdHmac:[12,e.TYPES.STRING]},[1,1,1],"regular"]},{MmSignalSharingVerificationFsEvent:[]});l.MmSignalSharingVerificationFsEventWamEvent=s}),98);
__d("WAWebMmSignalSharingVerificationWithSignalDataEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOnePdSignalNotSharedReason","WAWebWamEnumSignalCanceledReason","WAWebWamEnumSignalMessageState","WAWebWamEnumSignalMessageType","WAWebWamEnumSignalOrigin","WAWebWamEnumSignalSharingStatus","WAWebWamEnumSignalSurface","WAWebWamEnumSignalType","WAWebWamEnumSpSignalNotSharedReason"],(function(t,n,r,o,a,i,l){var e,s=(e=o("WAWebWamCodegenUtils")).defineEvents({MmSignalSharingVerificationWithSignalDataEvent:[6856,{entSourceSubplatform:[1,e.TYPES.STRING],isCompanionDevice:[2,e.TYPES.BOOLEAN],isNetworkAvailable:[16,e.TYPES.BOOLEAN],isShimmingSignal:[17,e.TYPES.BOOLEAN],isUserDisclosed:[3,e.TYPES.BOOLEAN],isUserMatched:[4,e.TYPES.BOOLEAN],mmSignalData:[5,e.TYPES.STRING],onePdSignalNotSharedReason:[6,o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON],signalCanceledReason:[7,o("WAWebWamEnumSignalCanceledReason").SIGNAL_CANCELED_REASON],signalMessageState:[8,o("WAWebWamEnumSignalMessageState").SIGNAL_MESSAGE_STATE],signalMessageType:[9,o("WAWebWamEnumSignalMessageType").SIGNAL_MESSAGE_TYPE],signalOrigin:[10,o("WAWebWamEnumSignalOrigin").SIGNAL_ORIGIN],signalSharingStatus:[11,o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS],signalSurface:[12,o("WAWebWamEnumSignalSurface").SIGNAL_SURFACE],signalType:[13,o("WAWebWamEnumSignalType").SIGNAL_TYPE],spSignalNotSharedReason:[14,o("WAWebWamEnumSpSignalNotSharedReason").SP_SIGNAL_NOT_SHARED_REASON]},[1,1,1],"private",0]},{MmSignalSharingVerificationWithSignalDataEvent:[]});l.MmSignalSharingVerificationWithSignalDataEventWamEvent=s}),98);
__d("WAWebMmSignalWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMmSignalType"],(function(t,n,r,o,a,i,l){var e=o("WAWebWamCodegenUtils").defineEvents({MmSignal:[5572,{disclosed:[4,o("WAWebWamCodegenUtils").TYPES.BOOLEAN],mmSignalData:[1,o("WAWebWamCodegenUtils").TYPES.STRING],mmSignalType:[2,o("WAWebWamEnumMmSignalType").MM_SIGNAL_TYPE]},[1,1,1],"private",0]},{MmSignal:[]});l.MmSignalWamEvent=e}),98);
__d("WAWebMmSignalSharingLoggingUtils",["WALogger","WAWebChatThreadLogging","WAWebLidMigrationUtils","WAWebMmCollectionWindowStateEventWamEvent","WAWebMmDisclosureStateEventWamEvent","WAWebMmDisclosureStateFsEventWamEvent","WAWebMmSignalSharingExpirationWindowUtils","WAWebMmSignalSharingGatingUtils","WAWebMmSignalSharingModelUtils","WAWebMmSignalSharingTos","WAWebMmSignalSharingVerificationEventWamEvent","WAWebMmSignalSharingVerificationFsEventWamEvent","WAWebMmSignalSharingVerificationWithSignalDataEventWamEvent","WAWebMmSignalWamEvent","WAWebMsgType","WAWebNetworkStatus","WAWebWamEnumOnePdSignalNotSharedReason","WAWebWamEnumSignalMessageType","WAWebWamEnumSignalSharingStatus","WAWebWamEnumSpSignalNotSharedReason","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.chat,n=e.linkOptions,a=e.msg,i=e.signal;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(t.id.toString())){var l=o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingOptimizedDeliverySignalCollectionConfig(),s=l.consented_types_allowlist,u=l.non_consented_types_allowlist,c=o("WAWebMmSignalSharingModelUtils").getMmSignalSharingExpirationWindowItem({chat:t});if(!(!c&&!n&&i.canceledReason==null)){var d=o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted(),m=s.includes(i.type)||u.includes(i.type),p=i.canceledReason!=null?void 0:f(t,c,n,d,m),C=p==null||i.canceledReason!=null?void 0:g(c,n,m),b=h(i.sharingStatus,m,p,C),v=babelHelpers.extends({isCompanionDevice:!0,isUserDisclosed:d,onePdSignalNotSharedReason:p,signalCanceledReason:i.canceledReason,signalMessageState:i.messageState,signalOrigin:i.origin,signalSharingStatus:b,signalSurface:i.surface,signalType:i.type,spSignalNotSharedReason:C},a&&{signalMessageType:(a==null?void 0:a.type)===o("WAWebMsgType").MSG_TYPE.HSM?o("WAWebWamEnumSignalMessageType").SIGNAL_MESSAGE_TYPE.HSM:o("WAWebWamEnumSignalMessageType").SIGNAL_MESSAGE_TYPE.NFM}),S=new(o("WAWebMmSignalSharingVerificationEventWamEvent")).MmSignalSharingVerificationEventWamEvent(babelHelpers.extends({},v,{businessLidOrJid:_(t.id.toString()),collectionWindowId:y(t,n,c),isNetworkAvailable:r("WAWebNetworkStatus").online},(a==null?void 0:a.templateId)!=null?{templateId:a.templateId}:{})),R=new(o("WAWebMmSignalSharingVerificationFsEventWamEvent")).MmSignalSharingVerificationFsEventWamEvent(babelHelpers.extends({},v,{threadIdHmac:(yield o("WAWebChatThreadLogging").getChatThreadIDHMAC(t.id.toString()))||"",isShimmingSignal:!1})),L=new(o("WAWebMmSignalSharingVerificationWithSignalDataEventWamEvent")).MmSignalSharingVerificationWithSignalDataEventWamEvent(babelHelpers.extends({},v,{isNetworkAvailable:r("WAWebNetworkStatus").online,mmSignalData:o("WAWebMmSignalSharingModelUtils").getMMSignalSharingData({chat:t,mmSignalType:i.type,deepConversationParams:{isNewMessagefromMe:a==null?void 0:a.id.fromMe}}),isUserMatched:(c==null?void 0:c.disclosedToken)!=null||(n==null?void 0:n.consentedUrl)!=null}));S.commit(),R.commit(),L.commit()}}}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.chat,n=e.msg,r=e.signal;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(t.id.toString())){var a={disclosureEventType:r.disclosureEventType,disclosureInteraction:r.disclosureInteraction,disclosureSource:r.disclosureSource,disclosureSuppressionReason:r.disclosureSuppressionReason,disclosureSurface:r.disclosureSurface,isCompanionDevice:!0,isUserDisclosed:o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted(),mmHasDisclosedUrl:r.mmHasDisclosedUrl,mmHasShowDisclosureFlag:r.mmHasShowDisclosureFlag,userBecameDisclosed:r.userBecameDisclosed},i=new(o("WAWebMmDisclosureStateEventWamEvent")).MmDisclosureStateEventWamEvent(babelHelpers.extends({},a,{businessLidOrJid:_(t.id.toString())},(n==null?void 0:n.templateId)!=null?{templateId:n.templateId}:{})),l=new(o("WAWebMmDisclosureStateFsEventWamEvent")).MmDisclosureStateFsEventWamEvent(babelHelpers.extends({},a,{threadIdHmac:(yield o("WAWebChatThreadLogging").getChatThreadIDHMAC(t.id.toString()))||""}));i.commit(),l.commit()}}),d.apply(this,arguments)}function m(e){var t=e.chatWID,n=e.msg,r=e.signal;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(t)){var a=new(o("WAWebMmCollectionWindowStateEventWamEvent")).MmCollectionWindowStateEventWamEvent(babelHelpers.extends({businessLidOrJid:_(t),isUserDisclosed:o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted(),mmDisclosureFlags:r.mmDisclosureFlags,mmHasDisclosedToken:r.mmHasDisclosedToken,mmHasDisclosedUrl:r.mmHasDisclosedUrl,mmHasShowDisclosureFlag:r.mmHasShowDisclosureFlag},(n==null?void 0:n.templateId)!=null?{templateId:n.templateId}:{}));a.commit()}}function p(e){var t=e.chat,n=e.signal;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingCollectionEnabled(t.id.toString())){var r=new(o("WAWebMmSignalWamEvent")).MmSignalWamEvent({mmSignalData:n.mmSignalData,mmSignalType:n.mmSignalType,disclosed:o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted()});r.commit()}}function _(t){if(!r("WAWebWid").isRegularUserNoImply(t))return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[mmSignalSharing] chat ID type unknown: ",""])),t).sendLogs("wa-mm-signal-sharing-failed-to-determine-chat-id-type"),"";var n=o("WAWebWidFactory").createUserWidOrThrow(t),a=o("WAWebLidMigrationUtils").toPn(n),i=o("WAWebLidMigrationUtils").toLid(n);return o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingVerificationSystemLidEnabled()&&i?i.toString():a?a.toJid():n.toString()}function f(e,t,n,r,a){if(!r)return o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON.USER_UNDISCLOSED_OR_NOT_ELIGIBLE_FOR_DISCLOSURE;if(!o("WAWebMmSignalSharingExpirationWindowUtils").isMmSignalSharingUserDisclosedInCollectionWindow(e.mmSignalSharingExpirationWindow))return o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON.WINDOW_EXPIRED;if(n&&(n==null?void 0:n.consentedUrl)==null)return o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON.VALUE_NOT_AVAILABLE;if(!a)return o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON.SIGNAL_NOT_ALLOWLISTED;var i=o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingOptimizedDeliverySignalCollectionConfig(),l=i.consented_collection_window_in_hours;if(t&&o("WAWebMmSignalSharingExpirationWindowUtils").hasMmSignalSharingTokenExpired(t,l))return o("WAWebWamEnumOnePdSignalNotSharedReason").ONE_PD_SIGNAL_NOT_SHARED_REASON.TOKEN_EXPIRED}function g(e,t,n){if(t&&(t==null?void 0:t.unconsentedUrl)==null)return o("WAWebWamEnumSpSignalNotSharedReason").SP_SIGNAL_NOT_SHARED_REASON.VALUE_NOT_AVAILABLE;if(!n)return o("WAWebWamEnumSpSignalNotSharedReason").SP_SIGNAL_NOT_SHARED_REASON.SIGNAL_NOT_ALLOWLISTED;var r=o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingOptimizedDeliverySignalCollectionConfig(),a=r.consented_collection_window_in_hours;if(e&&o("WAWebMmSignalSharingExpirationWindowUtils").hasMmSignalSharingTokenExpired(e,a))return o("WAWebWamEnumSpSignalNotSharedReason").SP_SIGNAL_NOT_SHARED_REASON.TOKEN_EXPIRED}function h(e,t,n,r){if(!t)return o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.NOT_SHARED;var a=e;return a===o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.ONE_PD&&n!=null&&(a=o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.SP),a===o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.SP&&r!=null&&(a=o("WAWebWamEnumSignalSharingStatus").SIGNAL_SHARING_STATUS.NOT_SHARED),a}function y(e,t,n){if(!(e.mmSignalSharingExpirationWindow==null||(n==null?void 0:n.unixTime)==null)){var r=t?n.unixTime.server:n.unixTime.client;return btoa(String(r*1e3))}}l.logMmSignalSharingVerificationEvent=s,l.logMmSignalSharingDisclosureStateEvent=c,l.logMmSignalSharingCollectionWindowStateEvent=m,l.logMmSignalSharingEvent=p}),98);
__d("WAWebMmSignalSharingModelUtils",["Promise","WAWebHandleMsgTypes.flow","WAWebMmSignalSharingExpirationWindowUtils","WAWebMmSignalSharingGatingUtils","WAWebMmSignalSharingTos","WAWebMsgGetters","WAWebMsgType","WAWebWamEnumDisclosureEventType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s={DISCLOSURE_ON_CLICK:1,DISCLOSURE_ON_READ:2,DISCLOSURE_ON_CLICK_AND_READ:3};function u(e,t){var n;return o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()?((n=e.contact)==null||(n=n.privacyMode)==null?void 0:n.hostStorage)===o("WAWebHandleMsgTypes.flow").HostStorageEnumType.Facebook&&o("WAWebMsgGetters").getIsMarketingTemplateTag(t)||c(t)===!0&&o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabledFromCompanionHistorySync():!1}function c(e){var t;return Object.values(s).includes((t=e.mmSignalSharing)==null?void 0:t.dataSharingFlags)}function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){return!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()||!u(t,r)||!c(r)||a===o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE.BODY_URL_CLICK&&!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureForMarketingMessageBodyLinksEnabled()||o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted()?(e||(e=n("Promise"))).resolve(!1):o("WAWebMmSignalSharingTos").isMmSignalSharingDisclosureTosAccepted()===!1}),m.apply(this,arguments)}function p(e){var t=e.btnIndex,n=e.chat,r=e.defaultUrl,a=e.isMmSignalSharingDisclosureTosAccepted,i=e.msg;if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return r;if(u(n,i)&&a){var l,s=(l=E(i,t))!=null?l:{},c=s.consentedUrl,d=s.originalUrl,m=s.unconsentedUrl;return R(n,c,m,d,r)}return r}function _(e){var t=e.chat,n=e.defaultUrl,r=e.isMmSignalSharingDisclosureTosAccepted,a=e.msg;if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return{link:n,index:0};if(u(t,a)&&r){var i=0;for(var l of(s=(c=a.mmSignalSharing)==null?void 0:c.urlTrackingMapElements)!=null?s:[]){var s,c,d=l.consentedUsersUrl,m=l.originalUrl,p=l.unconsentedUsersUrl;if(L(m)===L(n))return{link:R(t,d,p,m,n),index:i};i++}}return{link:n,index:void 0}}function f(e,t,n){if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())switch(e){case o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE.CTA_URL_CLICK:return E(t,n);case o("WAWebWamEnumDisclosureEventType").DISCLOSURE_EVENT_TYPE.BODY_URL_CLICK:return k(t,n);default:return null}}function g(e){if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return!1;for(var t=0;t<((n=(r=e.interactivePayload)==null||(r=r.buttons)==null?void 0:r.length)!=null?n:0);t++){var n,r,a,i=(a=E(e,t))!=null?a:{},l=i.consentedUrl;if(l!=null)return!0}for(var s=0;s<((u=(c=e.mmSignalSharing)==null||(c=c.urlTrackingMapElements)==null?void 0:c.length)!=null?u:0);s++){var u,c,d,m=(d=k(e,s))!=null?d:{},p=m.consentedUrl;if(p!=null)return!0}return!1}function h(e){var t,n,r=e.chat,a=e.fromMe;if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return null;var i=new Map((t=r.mmSignalSharingExpirationWindow)==null?void 0:t.map(function(e){return[e.messageId.id,e]})),l=r.msgs.getModelsArray().filter(function(e){return[o("WAWebMsgType").MSG_TYPE.CHAT,o("WAWebMsgType").MSG_TYPE.INTERACTIVE].includes(e.type)}),s,u=!1,c=0,d;for(d=l.length-1;d>=0;d--){var m,p;if(S(l[d])&&l[d].id.fromMe===a&&!v(l,d)&&c++,u||(u=l[d].id.fromMe),s=i.get(l[d].id.id),((m=s)==null?void 0:m.disclosedToken)!=null||((p=s)==null?void 0:p.undisclosedToken)!=null)break}return a===!1&&((n=l[d+1])==null?void 0:n.id.fromMe)===!1&&c--,{mmSignalSharingExpirationWindowItem:s,messageOriginGroups:c,isContinuation:v(l,l.length-1)}}function y(e){var t=e.chat,n=e.deepConversationParams,r=e.mmSignalType;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()){var a=C({chat:t,deepConversationParams:n}),i=o("WAWebMmSignalSharingGatingUtils").getMmSignalSharingOptimizedDeliverySignalCollectionConfig(),l=i.consented_collection_window_in_hours,s=i.consented_types_allowlist,u=i.non_consented_collection_window_in_hours,c=i.non_consented_types_allowlist;if(a){var d;return(d=b(a,a.disclosedToken,r,s,l))!=null?d:b(a,a.undisclosedToken,r,c,u)}}}function C(e){var t,n=e.chat,r=e.deepConversationParams;if(o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled()){if(r){var a=h({chat:n,fromMe:r.isNewMessagefromMe}),i=a!=null?a:{},l=i.mmSignalSharingExpirationWindowItem;return l}return(t=n.mmSignalSharingExpirationWindow)==null?void 0:t.findLast(function(e){return e.disclosedToken!=null||e.undisclosedToken!=null})}}function b(e,t,n,r,a){return n!=null&&r.includes(n)&&!o("WAWebMmSignalSharingExpirationWindowUtils").hasMmSignalSharingWindowExpired(e)&&!o("WAWebMmSignalSharingExpirationWindowUtils").hasMmSignalSharingTokenExpired(e,a)?t:void 0}function v(e,t){return e.length>1&&t>=1&&S(e[t])&&S(e[t-1])&&e[t].id.fromMe===e[t-1].id.fromMe}function S(e){var t,n;return((t=e.mmSignalSharing)==null?void 0:t.existsDisclosedToken)!==!0&&((n=e.mmSignalSharing)==null?void 0:n.existsUndisclosedToken)!==!0}function R(e,t,n,r,a){var i;if(!o("WAWebMmSignalSharingGatingUtils").isMmSignalSharingDisclosureEnabled())return null;if(o("WAWebMmSignalSharingExpirationWindowUtils").isMmSignalSharingUserDisclosedInCollectionWindow(e.mmSignalSharingExpirationWindow)){var l,s;return(l=(s=t!=null?t:n)!=null?s:r)!=null?l:a}return(i=n!=null?n:r)!=null?i:a}function L(e){return e==null?"":e.replace(/\/$/,"")}function E(e,t){if(t!=null){var n,r,o=(n=(r=e.interactivePayload)==null||(r=r.buttons)==null?void 0:r[t])!=null?n:{},a=o.buttonParamsJson;if(a!=null){var i=JSON.parse(a),l=i.consented_users_url,s=i.unconsented_users_url,u=i.url;return{originalUrl:u,consentedUrl:l,unconsentedUrl:s}}}}function k(e,t){if(t!=null){var n,r,o=(n=(r=e.mmSignalSharing)==null||(r=r.urlTrackingMapElements)==null?void 0:r[t])!=null?n:{},a=o.consentedUsersUrl,i=o.originalUrl,l=o.unconsentedUsersUrl;return{consentedUrl:a,unconsentedUrl:l,originalUrl:i}}}l.isDisclosureEnabledForMm=u,l.isDisclosureEnabledForMsg=c,l.showDisclosureModalForMm=d,l.getCTALinkForMmSignalSharing=p,l.getBodyLinkForMmSignalSharing=_,l.getMMSignalSharingUrls=f,l.existsMmSignalSharingConsentedUrl=g,l.getMmSignalSharingNewMessageParams=h,l.getMMSignalSharingData=y,l.getMmSignalSharingExpirationWindowItem=C}),98);
__d("WAWebAssociationProtoUtils",["WALogger","WANullthrows","WAWebAssociationProcessor","WAWebE2EProtoUtils","WAWebLidMigrationUtils","WAWebMessageAssociation.flow","WAWebMessageAssociationGatingUtils","WAWebMessageAssociationValidation","WAWebNewsletterIsNewsletterMsg","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason","WAWebWid","err","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=[o("WAWebMessageAssociation.flow").MessageAssociationType.HD_IMAGE_DUAL_UPLOAD,o("WAWebMessageAssociation.flow").MessageAssociationType.HD_VIDEO_DUAL_UPLOAD,o("WAWebMessageAssociation.flow").MessageAssociationType.HEVC_VIDEO_DUAL_UPLOAD],u=new Set([o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.STICKER_ANNOTATION]);function c(e){var t=o("WAWebMessageAssociation.flow").MessageAssociationType.cast(o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.getName(e)),n=r("justknobx")._("4912");return t!=null&&s.includes(t)&&!n?o("WAWebMessageAssociation.flow").MessageAssociationType.UNKNOWN:t!=null?t:o("WAWebMessageAssociation.flow").MessageAssociationType.UNKNOWN}function d(e){switch(e){case o("WAWebMessageAssociation.flow").MessageAssociationType.UNKNOWN:case o("WAWebMessageAssociation.flow").MessageAssociationType.HD_IMAGE_DUAL_UPLOAD:case o("WAWebMessageAssociation.flow").MessageAssociationType.HD_VIDEO_DUAL_UPLOAD:case o("WAWebMessageAssociation.flow").MessageAssociationType.HEVC_VIDEO_DUAL_UPLOAD:throw r("err")("Invalid outgoing association type");case o("WAWebMessageAssociation.flow").MessageAssociationType.MEDIA_ALBUM:return o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.MEDIA_ALBUM;case o("WAWebMessageAssociation.flow").MessageAssociationType.BOT_PLUGIN:return o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.BOT_PLUGIN;case o("WAWebMessageAssociation.flow").MessageAssociationType.MEDIA_POLL:return o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.MEDIA_POLL}}function m(e,t){if(!(e==null||t==null))return{messageAssociation:{associationType:d(e),parentMessageKey:o("WAWebE2EProtoUtils").msgKeyToProtobuf(t)}}}function p(e,t,n){var a=r("WAWebNewsletterIsNewsletterMsg")({from:t.from,to:t.to});return n==="history"&&!a?o("WAWebE2EProtoUtils").protobufToMsgKey(e):o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(e,t)}function _(e,t,n){var a=p(e.parentMessageKey,t,n),i=c(e.associationType),l=o("WAWebAssociationProcessor").getAssociationProcessorByAssociationType(i);if(l==null)throw new(o("WAWebMessageAssociationValidation")).MessageAssociationValidationError(o("WAWebMessageAssociationValidation").MessageAssociationValidationErrorCode.UNSUPPORTED_ASSOCIATION_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{associationParentMsgKey:r("WANullthrows")(a),associationType:i,viewMode:l.viewMode}}function f(t,n,a){var i=n==null?void 0:n.messageAssociation;if(i!=null&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){if(a==="history_quoted"||a==="quoted")return null;var l=i.parentMessageKey,s=i.associationType;if(s===o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.STATUS_NOTIFICATION)return null;if(l==null)throw new(o("WAWebMessageAssociationValidation")).MessageAssociationValidationError(o("WAWebMessageAssociationValidation").MessageAssociationValidationErrorCode.MISSING_PARENT_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(s==null)throw new(o("WAWebMessageAssociationValidation")).MessageAssociationValidationError(o("WAWebMessageAssociationValidation").MessageAssociationValidationErrorCode.MISSING_ASSOCIATION_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==="history")return{associationType:s,parentMessageKey:l};var c=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(l,t);if(c==null)throw new(o("WAWebMessageAssociationValidation")).MessageAssociationValidationError(o("WAWebMessageAssociationValidation").MessageAssociationValidationErrorCode.INVALID_PARENT_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d=c.fromMe===t.id.fromMe&&r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(c.remote,t.id.remote))&&r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(c.participant,t.id.participant));if(!d&&!u.has(s)){var m,p,_,f,g,h,y;throw o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["MessageAssociationValidation: Sender mismatch - associationType: ",", associationParentMsgKey.remote: ",", baseMessage.id.remote: ",", associationParentMsgKey.participant: ",", baseMessage.id.participant: ",", parentMessageKey.participant: ",", baseMessage.type: ",", baseMessage.subtype: ",", msgContext: ",""])),o("WAWebProtobufsE2E.pb").MessageAssociation$AssociationType.getName(s),c.remote.toLogString(),t.id.remote.toLogString(),(m=(p=c.participant)==null?void 0:p.toLogString())!=null?m:"null",(_=(f=t.id.participant)==null?void 0:f.toLogString())!=null?_:"null",(g=l.participant)!=null?g:"null",(h=t.type)!=null?h:"null",(y=t.subtype)!=null?y:"null",a),new(o("WAWebMessageAssociationValidation")).MessageAssociationValidationError(o("WAWebMessageAssociationValidation").MessageAssociationValidationErrorCode.MISMATCH_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.ERROR_PARENT_CHILD_SENDER_JID_MISMATCH)}return{associationType:s,parentMessageKey:l}}return null}l.convertAssociationTypeFromProtoToClientSupportedAssociationType=c,l.convertAssociationTypeFromClientToProtoSupportedAssociationType=d,l.getValidatedOutgoingMessageAssociationContextInfo=m,l.getValidatedAssociationFieldsFromProto=_,l.validateMessageAssociationInMessageContextInfo=f}),98);
__d("WAWebProcessMessageAssociationMessages",["WALogger","WAWebAddonProcessMsgsUtils","WAWebAddonSortUtils","WAWebAssociationProcessor","WAWebAssociationProcessorConstants","WAWebMessageAssociationGatingUtils","WAWebMessageAssociationValidation","WAWebViewMode.flow","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){if(o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var n=e,r=d(n,t),a=r.nonOrphansFromCache,i=r.orphans;return p(i,a)}}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(!(e.length===0||!o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled())){var n=yield o("WAWebAddonProcessMsgsUtils").queryParentMsgs(e),r=n[0],a=n[1],i=o("WAWebAddonSortUtils").collectValidAndOrphans(a,r),l=i.nonOrphans,s=i.orphans,u=l.length+s.length===e.length;if(!u)throw new(o("WAWebMessageAssociationValidation")).MessageAssociationInfraError(o("WAWebMessageAssociationValidation").MessageAssociationInfraErrorCode.MESSAGE_ASSOCIATIONS_MISMATCH);var c=m(s,t),d=c.nonOrphansFromCache,_=c.orphans;return p(_,[].concat(l,d))}}),c.apply(this,arguments)}function d(e,t){var n=[],r=[];return e.forEach(function(e){t.has(e.parentMsgKey.toString())?n.push(e):r.push(e)}),{orphans:n,nonOrphansFromCache:r}}function m(e,t){var n=[],r=[];return e.forEach(function(e){t.has(e.parentMsgKey.toString())?r.push(e):n.push(e)}),{orphans:n,nonOrphansFromCache:r}}function p(t,n){var r=[],a=[];t.forEach(function(t){var n=o("WAWebAssociationProcessor").getAssociationProcessor(t);n||o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["classifyAssociatedMsgs: processor not found for ",""])),t.id.toString()),(n==null?void 0:n.processorType)===o("WAWebAssociationProcessorConstants").AssociationProcessorType.WithDetachedMessages?a.push(t):r.push(t)});var i=a.map(function(e){return babelHelpers.extends({},e,{viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE})}),l=[].concat(n,i),s=new Map;return l.forEach(function(e){s.set(e.id.toString(),e)}),{orphanAssociatedMsgs:r,validAssociatedMsgs:s,detachedAssociatedMsgs:i}}l.classifyAssociatedMsgsFromHistorySyncUsingMissingParentsCache=s,l.classifyAssociatedMsgsUsingExistingParentsCache=u,l.collectOrphansFromMissingParentsCache=d,l.collectOrphansFromExistingParentsMessagesCache=m,l.classifyAssociatedOrphansNonOrphans=p}),98);
__d("WAWebMessageEditValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_PROTOCOL_KEY:"missing_protocol_key",MISSING_EDITED_MESSAGE:"missing_edited_message",MISSING_TARGET_MESSAGE_KEY:"missing_target_message_key",MISSING_ENC_PAYLOAD:"missing_enc_payload",MISSING_ENC_IV:"missing_enc_iv",INVALID_IV_LENGTH:"invalid_iv_length",MISSING_MESSAGE_SENDER:"missing_message_sender",MISSING_PARENT_MESSAGE_SENDER:"missing_parent_message_sender",INVALID_PROTOCOL_MESSAGE_TYPE:"invalid_protocol_message_type",MISSING_MESSAGE_SECRET:"missing_message_secret",MISSING_ORIGINAL_SENDER:"missing_original_sender",MISSING_SENDER_TIMESTAMP:"missing_sender_timestamp"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="MessageEditValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.MessageEditValidationErrorCode=e,l.MessageEditValidationError=s}),98);
__d("WAWebParseHistorySyncProtocolMessageEditProto",["WALogger","WALongInt","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMessageEditValidationError","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason","getErrorSafe"],(function(t,n,r,o,a,i,l){var e;function s(t){var n=t.baseMessage,a=t.messageProtobuf,i=t.msgContext,l=a.protocolMessage;if(!(l==null||(l==null?void 0:l.type)!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)&&!(i!=="history"&&i!=="history_quoted"))try{var s=babelHelpers.extends({},n,{latestEditSenderTimestampMs:o("WALongInt").maybeNumberOrThrowIfTooLarge(l.timestampMs),latestEditMsgKey:n.id}),u=l.editedMessage;if(u==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_EDITED_MESSAGE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var c=l.key;if(c==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_PROTOCOL_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return Object.assign(s,o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:u,message:s,msgContext:i})),s.id=o("WAWebE2EProtoUtils").protobufToMsgKey(c,s.author),{msgData:s,contextInfo:null}}catch(t){var d=r("getErrorSafe")(t);throw o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseHistorySyncEditedMessageProto: error:",", stack: ",""])),d.name,d.stack).tags("messaging").sendLogs("parseHistorySyncEditedMessageProto: EditParseError"),d}}l.default=s}),98);
__d("WAWebParseProtocolMessageEditProto",["WALogger","WALongInt","WANullthrows","WAWebBotGating","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){var e;function s(t){var n=t.baseMessage,r=t.messageProtobuf,a=t.msgContext,i=r.protocolMessage;if(!(i==null||(i==null?void 0:i.type)!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)&&!(a!=="relay"&&a!=="outgoing"))try{var l,s,p,_=(l=(s=(p=u(n,i,a))!=null?p:m(n,i,a))!=null?s:c(n,i))!=null?l:d(n,i,a,r.messageContextInfo);return _||null}catch(t){throw o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseProtocolMessageEditProto: error:",", stack: ",""])),t==null?void 0:t.name,t==null?void 0:t.stack).tags("messaging").sendLogs("parseProtocolMessageEditProto: EditParseError"),t}}function u(e,t,n){var a,i,l=(a=(i=t.editedMessage)==null||(i=i.groupMentionedMessage)==null?void 0:i.message)!=null?a:t.editedMessage,s=!!(l!=null&&l.conversation)||!!(l!=null&&l.extendedTextMessage);if(!s)return null;var u=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(t.key,e),c=babelHelpers.extends({},o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:r("WANullthrows")(l),message:e,msgContext:n}),{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",editMsgType:o("WAWebMsgType").MSG_TYPE.CHAT,latestEditSenderTimestampMs:o("WALongInt").maybeNumberOrThrowIfTooLarge(t.timestampMs),latestEditMsgKey:e.id,protocolMessageKey:u});return{msgData:c,contextInfo:null}}function c(e,t){var n,r,a=(n=(r=t.editedMessage)==null||(r=r.groupMentionedMessage)==null?void 0:r.message)!=null?n:t.editedMessage,i,l,s;if(a!=null&&a.imageMessage)i=o("WAWebMsgType").MSG_TYPE.IMAGE,l=a.imageMessage.caption,s=a.imageMessage.contextInfo;else if(a!=null&&a.videoMessage)i=o("WAWebMsgType").MSG_TYPE.VIDEO,l=a.videoMessage.caption,s=a.videoMessage.contextInfo;else if(a!=null&&a.documentMessage)i=o("WAWebMsgType").MSG_TYPE.DOCUMENT,l=a.documentMessage.caption,s=a.documentMessage.contextInfo;else if(a!=null&&a.documentWithCaptionMessage){var u,c;i=o("WAWebMsgType").MSG_TYPE.DOCUMENT,l=(u=a.documentWithCaptionMessage)==null||(u=u.message)==null||(u=u.documentMessage)==null?void 0:u.caption,s=(c=a.documentWithCaptionMessage)==null||(c=c.message)==null||(c=c.documentMessage)==null?void 0:c.contextInfo}if(!i||l===""||l==null)return null;var d=babelHelpers.extends({},e,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",editMsgType:i,caption:l,latestEditSenderTimestampMs:o("WALongInt").maybeNumberOrThrowIfTooLarge(t.timestampMs),latestEditMsgKey:e.id,protocolMessageKey:o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(t.key,e)});return{msgData:d,contextInfo:s}}function d(e,t,n,r){var a,i=(a=t.editedMessage)==null?void 0:a.richResponseMessage;return i?p(e,t,n,o("WAWebMsgType").MSG_TYPE.RICH_RESPONSE,r):null}function m(e,t,n){var r,a=t.editedMessage,i=(r=a==null?void 0:a.imageMessage)!=null?r:a==null?void 0:a.videoMessage;return!i||!o("WAWebBotGating").isLoadingMediaMessagesEnabled(e)?null:p(e,t,n,o("WAWebMsgType").MSG_TYPE.LOADING_MEDIA)}function p(e,t,n,a,i){var l=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(t.key,e),s=babelHelpers.extends({},o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:babelHelpers.extends({},r("WANullthrows")(t.editedMessage),i?{messageContextInfo:i}:{}),message:e,msgContext:n}),{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",editMsgType:a,latestEditSenderTimestampMs:o("WALongInt").maybeNumberOrThrowIfTooLarge(t.timestampMs),latestEditMsgKey:e.id,protocolMessageKey:l});return{msgData:s,contextInfo:null}}l.default=s}),98);
__d("WAWebMessageEditGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("message_edit_to_message_secret_receiver_enabled")}function s(){return o("WAWebABProps").getABPropConfigValue("message_edit_to_message_secret_sender_enabled")}l.isMessageEditToMessageSecretReceiverEnabled=e,l.isMessageEditToMessageSecretSenderEnabled=s}),98);
__d("WAWebMessageEditAddonMessageProcessor",["Promise","WAWebAddonCreateMsgProcessor","WAWebDBProcessEditProtocolMsgs","WAWebMessageEditGatingUtils","WAWebProcessEncryptedMessageEditMsgs","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s=o("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:function(){return o("WAWebMessageEditGatingUtils").isMessageEditToMessageSecretReceiverEnabled()},convert:{fromHistorySyncMsg:function(){return(e||(e=n("Promise"))).resolve([])}},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.parents,r=yield o("WAWebProcessEncryptedMessageEditMsgs").processEncryptedMessageEditMsgs(e,n),a=r.filter(function(e){return e.isLatest});return yield o("WAWebDBProcessEditProtocolMsgs").updateMessageEditsLocally(r,a),[]});function t(t,n){return e.apply(this,arguments)}return t})(),afterUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})()}),u=s;l.default=u}),98);
__d("WAWebMessageEditDecryptedMsgDataConversion",["WALongInt","WANullthrows","WAWebE2EProtoUtils","WAWebMessageEditValidationError","WAWebMsgKeyUtils","WAWebMsgType","WAWebParseProtocolMessageEditProto","WAWebProcessBaseMsgInfo","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e,t,n){var a,i=r("WANullthrows")(e.protocolMessage,"[MessageEdit] Missing protocol message");if(i.type!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.INVALID_PROTOCOL_MESSAGE_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);var l=o("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(t),s=r("WANullthrows")(o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(i.key,l)),u=i.editedMessage;if(u==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_EDITED_MESSAGE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);var c=o("WALongInt").maybeNumberOrThrowIfTooLarge(i.timestampMs),d=r("WANullthrows")(r("WAWebParseProtocolMessageEditProto")({messageProtobuf:{protocolMessage:{editedMessage:u,key:i.key,type:i.type,timestampMs:i.timestampMs},messageContextInfo:{messageSecret:r("WANullthrows")((a=t.messageSecret)!=null?a:n).buffer,threadId:[]}},baseMessage:l,msgContext:"relay"})),m=d.msgData;return babelHelpers.extends({},m,o("WAWebMsgKeyUtils").msgKeyToTargetInfo(t.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Message),{id:t.id,t:Math.floor(r("WANullthrows")(c)/1e3),type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,subtype:"message_edit_decrypted",kind:o("WAWebMsgType").MsgKind.MessageEditDecrypted,viewMode:m.viewMode,latestEditSenderTimestampMs:c,latestEditMsgKey:t.id,protocolMessageKey:s,editedMessage:u,editMsgType:m.editMsgType})}l.protobufToMessageEditDecryptedMsgData=e}),98);
__d("WAWebParseMessageEditEncryptedMessageProto",["WAWebE2EProtoUtils","WAWebMessageEditGatingUtils","WAWebMessageEditValidationError","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.secretEncryptedMessage;if(!(r==null||r.secretEncType!==o("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.MESSAGE_EDIT)&&o("WAWebMessageEditGatingUtils").isMessageEditToMessageSecretReceiverEnabled()){var a=r.encIv,i=r.encPayload,l=r.targetMessageKey,s=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(l,t);if(!s)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_TARGET_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);if(!i)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);if(!a)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);var u=new Uint8Array(a);if(u.length!==12)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.INVALID_IV_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.MESSAGE_EDIT_ENCRYPTED,subtype:"message_edit",kind:o("WAWebMsgType").MsgKind.MessageEditEncrypted,encIv:a,encPayload:i,targetMessageKey:s}),contextInfo:null}}}l.default=e}),98);
__d("WAWebProcessEncryptedMessageEditMsgs",["Promise","WALogger","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebAddonInfraError","WAWebDBProcessEditProtocolMsgs","WAWebMessageEditDecryptedMsgDataConversion","WAWebMessageEditValidationError","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebVerifyProtobufMsgObjectKeys","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","compactMap","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=new Map;if(t.forEach(function(e){if(e.kind!==o("WAWebMsgType").MsgKind.MessageEditEncrypted)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType);var t=a.getForAddon(e);i.set(e,t)}),i.size===0)return[];var l=yield(u||(u=n("Promise"))).allSettled(Array.from(i.entries()).map(function(e){var t=e[0],n=e[1];return m(t,n)}));return r("compactMap")(l,function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":{var n=t.reason;if(n instanceof o("WAWebMessageEditValidationError").MessageEditValidationError||n instanceof o("WAWebAddonEncryptionError").DualEncryptionValidationError){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted message edit failed: ",""])),n.code).sendLogs(n.code);return}o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted message edit failed: ","\n",""],["Processing encrypted message edit failed: ","\\n",""])),n.message,n.stack).sendLogs("message_edit_unknown_error")}}})}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,r=e.encIv,a=e.encPayload,i=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.MessageEditEncrypted,t),l=o("WAWebMsgGetters").getOriginalSender(t),s=o("WAWebMsgGetters").getSender(e);if(s==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_PARENT_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(r==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==null)throw new(o("WAWebMessageEditValidationError")).MessageEditValidationError(o("WAWebMessageEditValidationError").MessageEditValidationErrorCode.MISSING_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var u={type:o("WAWebMsgType").MsgKind.MessageEditEncrypted,encryptedAddOn:a},c=o("WAWebWidFactory").asUserWidOrThrow(s),d=yield o("WAWebAddonEncryption").decryptAddOn(u,{messageSecret:i,iv:r,stanzaId:t.id.id,originalMessageSender:l,addOnSender:c}),m=o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsE2E.pb").MessageSpec,d),p=o("WAWebMessageEditDecryptedMsgDataConversion").protobufToMessageEditDecryptedMsgData((n=o("WAWebVerifyProtobufMsgObjectKeys").getUnwrappedProtobufMessage(m))!=null?n:m,e,i);return o("WAWebDBProcessEditProtocolMsgs").generateMessageEdit(t,p)}),p.apply(this,arguments)}l.processEncryptedMessageEditMsgs=c}),98);
__d("WAWebGroupHistoryProtoUtils",["WALogger","WAWebE2EProtoUtils","WAWebWid"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t){var n;if(t==null)return null;if(t.bundleMessageKey==null)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["bundleMessageKey missing in GroupHistoryIndividualMsgInfo"]))),null;var a=o("WAWebE2EProtoUtils").protobufToMsgKey(t.bundleMessageKey),i=o("WAWebE2EProtoUtils").decodeJidAndValidate((n=t.bundleMessageKey)==null?void 0:n.participant,"groupHistoryIndividualMessageInfo");return i instanceof r("WAWebWid")?t.editedAfterReceivedAsHistory==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["editedAfterReceivedAsHistory missing in GroupHistoryMsgInfo"]))),null):{isEditedAfterReceivedAsHistory:t.editedAfterReceivedAsHistory,bundleMessageKey:a,bundleSender:i}:(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["bundleSender missing/invalid (GroupHistoryIndividualMsgInfo)"]))),null)}l.getGroupHistoryIndividualMessageInfoMetadataFromProto=c}),98);
__d("WAWebDBStoreNewsletterEncryptedMsgs",["WALogger","WAPromiseMap","WAWebDBStoreMessage","WAWebDBStoreMessageAssociations","WAWebDBStoreMsgsUtils","WAWebMessageAssociationGatingUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebNewsletterDBUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s;function u(t){return o("WAWebModelStorageUtils").getStorage().lock(["message","chat","message-association"],(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var i=a[0],l=a[1],u=a[2],c=yield o("WAWebDBStoreMsgsUtils").getLastRowId(i),d=(yield o("WAPromiseMap").promiseMap(t,(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a,i=t[0],l=t[1],s=(a=i.serverId)!=null?a:yield o("WAWebNewsletterDBUtils").getTemporaryServerId(i.to);if(s==null)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][storage] serverId is missing from message"]))).tags("newsletter").sendLogs("newsletter-missing-serverId"),null;var u=r("WAWebMsgKey").fromString(i.id),d=o("WAWebDBStoreMessage").isPendingUnreadReceipt(u,i),m=o("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:i,chatId:u.remote.toString(),hasLink:l,inChatMsgId:s,rowId:c+n+1,pendingReadReceipt:d});return delete m.serverId,m});return function(e,n){return t.apply(this,arguments)}})())).filter(Boolean);try{o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()&&(yield o("WAWebDBStoreMessageAssociations").bulkStoreMessageAssociations(d)),yield i.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(d)}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[newsletter-store] Failed to store messages"]))).tags("newsletter")}});return function(e){return a.apply(this,arguments)}})())}l.storeEncryptedNewsletterMessages=u}),98);
__d("WAWebNewsletterDBConstants",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({Subscriber:0,Admin:1,Guest:2,Owner:3});i.NewsletterDBMembership=e}),66);
__d("WAWebNewsletterDBUtils",["WATimeUtils","WAWebApiChat","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebDBMsgUtils","WAWebJidToWid","WAWebMsgKey","WAWebMsgType","WAWebNewsletterDBConstants","WAWebSchemaMessage","WAWebSchemaNewsletterMetadata","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return(yield o("WAWebApiChat").getChatRecord(o("WAWebJidToWid").newsletterJidToWid(e)))!=null}),s.apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaNewsletterMetadata").getNewsletterMetadataTable().get(e);return t==null||t.membershipType===o("WAWebNewsletterDBConstants").NewsletterDBMembership.Guest}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield u(e);return!t}),m.apply(this,arguments)}var p=Number.MAX_SAFE_INTEGER-1e4;function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WAWebDBMessageUtils").craftInternalId(t,e),r=yield o("WAWebSchemaMessage").getMessageTable().anyOf(["internalId"],[n]),a=r[0];return a==null?null:o("WAWebDBMessageSerialization").messageFromDbRow(a)}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=new Map,r=new Map(e.map(function(e){return[o("WAWebDBMessageUtils").craftInternalId(t,e),e]})),a=yield o("WAWebSchemaMessage").getMessageTable().anyOf(["internalId"],Array.from(r.keys()));return a.forEach(function(e){if(e.internalId!=null){var t=r.get(e.internalId);t!=null&&n.set(t,o("WAWebDBMessageSerialization").messageFromDbRow(e))}}),n}),h.apply(this,arguments)}function y(e,t){var n=t instanceof r("WAWebWid")?t:o("WAWebWidFactory").createWid(t);return new(r("WAWebMsgKey"))({remote:n,fromMe:!0,id:e.toString(10)})}function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebDBMessageUtils").craftInternalId(e.toJid(),p),n=o("WAWebDBMessageUtils").endOfChat(e),r=yield o("WAWebSchemaMessage").getMessageTable().between(["internalId"],t,n,{lowerInclusive:!0,upperInclusive:!1,limit:1,reverse:!0});if(r.length===0||r[0].internalId==null)return p;var a=o("WAWebDBMessageUtils").getInChatMsgId(r[0].internalId);return Math.min(a+1,Number.MAX_SAFE_INTEGER)}),b.apply(this,arguments)}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebSchemaMessage").getMessageTable().bulkGet(e.map(String)),n=t.filter(Boolean).map(function(e){return{id:e.id,viewed:!0}});yield o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(n)}),S.apply(this,arguments)}function R(e,t){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebDBMsgUtils").getMsgsByChatId(t),r=o("WATimeUtils").unixTime(),a=n.filter(function(e){return e.type===o("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE}).map(function(e){return o("WAWebDBMessageSerialization").messageFromDbRow(e)});return a.filter(function(t){var n,o=(n=t.newsletterAdminInviteInfo)!=null?n:{},a=o.inviteExpiration,i=o.newsletterId;return i==null||a==null?!1:r<a&&e.equals(i)})}),L.apply(this,arguments)}l.doesNewsletterExistInStorage=e,l.isPreviewNewsletter=u,l.isSubscribedNewsletter=d,l.TEMPORARY_SERVER_ID_LOWER_BOUND=p,l.getMessageByServerId=_,l.bulkGetMessagesByServerIds=g,l.craftNewsletterMsgKeyFromServerId=y,l.getTemporaryServerId=C,l.updateMsgViewReceipt=v,l.getUnexpiredNewsletterAdminInviteMessageRecordsFromChat=R}),98);
__d("WAWebNewsletterAdminInviteMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_NEWSLETTER_JID:"newsletter_admin_invite_missing_newsletter_jid",MISSING_NEWSLETTER_NAME:"newsletter_admin_invite_missing_newsletter_name",MISSING_INVITE_EXPIRATION:"newsletter_admin_invite_missing_invite_expiration",INVALID_NEWSLETTER_JID:"newsletter_admin_invite_invalid_newsletter_jid"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="NewsletterAdminInviteMessageValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.NewsletterAdminInviteMessageValidationErrorCode=e,l.NewsletterAdminInviteMessageValidationError=s}),98);
__d("WAWebParseNewsletterAdminInviteMessageProto",["WATimeUtils","WAWebE2EProtoUtils","WAWebMsgType","WAWebNewsletterAdminInviteMessageValidationError","WAWebNewsletterGatingUtils","WAWebWamEnumE2eFailureReason","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.newsletterAdminInviteMessage;if(r!=null){if(!o("WAWebNewsletterGatingUtils").isNewsletterCreationEnabled())return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE}),contextInfo:r.contextInfo};var a=r.caption,i=r.contextInfo,l=r.inviteExpiration,s=r.newsletterJid,u=r.newsletterName;if(s==null)throw new(o("WAWebNewsletterAdminInviteMessageValidationError")).NewsletterAdminInviteMessageValidationError(o("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.MISSING_NEWSLETTER_JID,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(u==null)throw new(o("WAWebNewsletterAdminInviteMessageValidationError")).NewsletterAdminInviteMessageValidationError(o("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.MISSING_NEWSLETTER_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l==null)throw new(o("WAWebNewsletterAdminInviteMessageValidationError")).NewsletterAdminInviteMessageValidationError(o("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.MISSING_NEWSLETTER_JID,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var c=o("WAWebE2EProtoUtils").strictDecodeJid(s);if(c==null)throw new(o("WAWebNewsletterAdminInviteMessageValidationError")).NewsletterAdminInviteMessageValidationError(o("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.INVALID_NEWSLETTER_JID,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE,kind:o("WAWebMsgType").MsgKind.NewsletterAdminInvite,newsletterAdminInviteInfo:{newsletterId:o("WAWebWidFactory").asNewsletterWidOrThrow(c),newsletterName:u,inviteExpiration:o("WATimeUtils").castLongIntToUnixTime(l),inviteMessage:a!=null?a:"",pictureThumbnail:null}}),contextInfo:i}}}l.default=e}),98);
__d("WAWebNewsletterFollowerInviteMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_NEWSLETTER_JID:"newsletter_follower_invite_missing_newsletter_jid",MISSING_NEWSLETTER_NAME:"newsletter_follower_invite_missing_newsletter_name",INVALID_NEWSLETTER_JID:"newsletter_follower_invite_invalid_newsletter_jid"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="NewsletterFollowerInviteMessageValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.NewsletterFollowerInviteMessageValidationErrorCode=e,l.NewsletterFollowerInviteMessageValidationError=s}),98);
__d("WAWebParseNewsletterFollowerInviteMessageProto",["WAArrayBufferUtils","WAWebE2EProtoUtils","WAWebMsgType","WAWebNewsletterFollowerInviteMessageValidationError","WAWebNewsletterGatingUtils","WAWebWamEnumE2eFailureReason","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.newsletterFollowerInviteMessageV2,a=r;if(a!=null){if(!o("WAWebNewsletterGatingUtils").isChannelInviteContactsToFollowConsumerEnabled())return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.NEWSLETTER_FOLLOWER_INVITE}),contextInfo:a.contextInfo};var i=a.caption,l=a.contextInfo,s=a.jpegThumbnail,u=a.newsletterJid,c=a.newsletterName;if(u==null)throw new(o("WAWebNewsletterFollowerInviteMessageValidationError")).NewsletterFollowerInviteMessageValidationError(o("WAWebNewsletterFollowerInviteMessageValidationError").NewsletterFollowerInviteMessageValidationErrorCode.MISSING_NEWSLETTER_JID,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(c==null)throw new(o("WAWebNewsletterFollowerInviteMessageValidationError")).NewsletterFollowerInviteMessageValidationError(o("WAWebNewsletterFollowerInviteMessageValidationError").NewsletterFollowerInviteMessageValidationErrorCode.MISSING_NEWSLETTER_NAME,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d=o("WAWebE2EProtoUtils").strictDecodeJid(u);if(d==null)throw new(o("WAWebNewsletterFollowerInviteMessageValidationError")).NewsletterFollowerInviteMessageValidationError(o("WAWebNewsletterFollowerInviteMessageValidationError").NewsletterFollowerInviteMessageValidationErrorCode.INVALID_NEWSLETTER_JID,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.NEWSLETTER_FOLLOWER_INVITE,kind:o("WAWebMsgType").MsgKind.NewsletterFollowerInvite,newsletterFollowerInviteInfo:{newsletterId:o("WAWebWidFactory").asNewsletterWidOrThrow(d),newsletterName:c,inviteMessage:i!=null?i:"",pictureThumbnail:s?o("WAArrayBufferUtils").arrayBufferToString(s):null}}),contextInfo:l}}}l.default=e}),98);
__d("WAWebParseForwardedNewsletterMessageInfo",["WALogger","WAWebChatEntryPoint","WAWebE2EProtoUtils","WAWebProtobufsE2E.pb","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e;function s(e){var t=e.newsletterJid,n=e.newsletterName,r=e.serverMessageId,a=o("WAWebE2EProtoUtils").strictDecodeJid(t);return{newsletterId:a!=null?o("WAWebWidFactory").asNewsletterWidOrThrow(a):void 0,newsletterName:n,serverMessageId:r}}function u(t){var n,r=t==null||(n=t.newsletter)==null?void 0:n.contentType;if(r==null){var a;return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Did not receive content type from newsletter annotation"]))).tags("newsletter-logging").sendLogs("Missing content type in newsletter annotation"),(t==null||(a=t.newsletter)==null?void 0:a.serverMessageId)==null?o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCard:o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterPostLinkCard}return r===o("WAWebProtobufsE2E.pb").ContextInfo$ForwardedNewsletterMessageInfo$ContentType.LINK_CARD?t.shouldSkipConfirmation===!0?o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCardButton:o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCard:o("WAWebChatEntryPoint").ChatEntryPoint.NewsletterPostLinkCard}l.parseForwardedNewsletterMessageInfo=s,l.getChatEntryPointFromNewsletterLinkAnnotation=u}),98);
__d("WAWebDBProcessPaymentMessages",["WAWebDBMsgUtils","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebMsgType","WAWebProtobufsWeb.pb","WAWebSchemaMessage","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[],r=[],a=u(e),i=c(e.filter(function(e){return e.subtype==="payment_action_request_declined"||e.subtype==="payment_transaction_request_cancelled"}));return o("WAWebModelStorageUtils").getStorage().lock(["message"],(function(){var l=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var l=n[0],s=yield o("WAWebDBMsgUtils").getMsgsByMsgKey(a.concat(i)),u=new Map;return s.forEach(function(e){e!=null&&u.set(e.id.toString(),e)}),e.forEach(function(e){var n,a=(n=e.paymentRequestMessageKey)==null?void 0:n.toString(),i=u.get(a||"");if(i==null&&e.paymentRequestMessageKey!=null){var l=o("WAWebLidMigrationUtils").getAlternateMsgKey(e.paymentRequestMessageKey);if(l!=null){var s,c;a=l.toString(),i=u.get((s=(c=o("WAWebLidMigrationUtils").getAlternateMsgKey(l))==null?void 0:c.toString())!=null?s:"")}}if(i&&a!=null)if(e.subtype==="send"&&e.paymentTxnStatus!=null)t.push({id:a,paymentTxnStatus:e.paymentTxnStatus});else{var d=i.from.isGroup()?i.author:i.from,m=o("WAWebUserPrefsMeUser").isMeAccount(i.paymentMessageReceiverJid),p=m?d:i.paymentMessageReceiverJid;e.subtype==="payment_action_request_declined"?t.push({id:a,paymentStatus:o("WAWebProtobufsWeb.pb").PaymentInfo$Status.REJECTED,paymentTxnStatus:o("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_REJECTED}):e.subtype==="payment_transaction_request_cancelled"&&t.push({id:a,paymentStatus:o("WAWebProtobufsWeb.pb").PaymentInfo$Status.CANCELLED,paymentTxnStatus:o("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_CANCELED}),t.push({id:e.id.toString(),type:o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[p||"",i.paymentCurrency||"",String(i.paymentAmount1000)]})}else u.get(e.id.toString())&&!e.isMdHistoryMsg&&r.push(e.id.toString())}),yield o("WAWebSchemaMessage").getMessageTable().bulkRemove(r),yield o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(t),t});return function(e){return l.apply(this,arguments)}})())}),s.apply(this,arguments)}function u(e){return e.flatMap(function(e){var t,n;return[e.paymentRequestMessageKey?e.paymentRequestMessageKey.toString():null,e.paymentRequestMessageKey&&(t=(n=o("WAWebLidMigrationUtils").getAlternateMsgKey(e.paymentRequestMessageKey))==null?void 0:n.toString())!=null?t:null]}).filter(Boolean)}function c(e){return e.flatMap(function(e){var t,n;return[e.id.toString(),(t=(n=o("WAWebLidMigrationUtils").getAlternateMsgKey(e.id))==null?void 0:n.toString())!=null?t:null]}).filter(Boolean)}l.processPaymentMessages=e,l.mapOriginalAndAltPaymentRequestMessageKey=u,l.mapOriginalAndAltMsgId=c}),98);
__d("WAWebParseCancelPaymentMessageProto",["WAWebE2EProtoUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","err"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.cancelPaymentRequestMessage;if(r!=null){var a=r.key;if(a!=null){var i=s(a,t);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"payment_transaction_request_cancelled",paymentRequestMessageKey:i}),contextInfo:null}}}}function s(e,t){if(!e)throw r("err")("parseProtocolMessageProto: no message key is defined for cancel payment request message");var n=e.id;if(!n)throw r("err")("parseProtocolMessageProto: no message id is defined for cancel payment request message");var a=void 0;if(t.id.remote.isGroup()){var i;if(a=t.id.participant,t.id.fromMe)a=o("WAWebE2EProtoUtils").decodeJid(t.from);else if(!((i=o("WAWebE2EProtoUtils").decodeJid(e.participant))!=null&&i.equals(o("WAWebUserPrefsMeUser").getMePnUserOrThrow())))return null}var l=new(r("WAWebMsgKey"))({id:n,fromMe:t.id.fromMe,remote:t.id.remote,participant:a});return l}l.default=e}),98);
__d("WAWebParseDeclinePaymentMessageProto",["WAWebE2EProtoUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","err"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.declinePaymentRequestMessage;if(r!=null){var a=s(r.key,t);return{msgData:babelHelpers.extends({},t,{type:"unknown",kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"payment_action_request_declined",paymentRequestMessageKey:a}),contextInfo:null}}}function s(e,t){if(!e)throw r("err")("parseProtocolMessageProto: no message key is defined for decline payment request message");var n=e.id;if(!n)throw r("err")("parseProtocolMessageProto: no message id is defined for decline payment request message");var a;if(t.id.remote.isGroup()){var i;if(t.id.fromMe||(i=o("WAWebE2EProtoUtils").decodeJid(e.participant))!=null&&i.equals(o("WAWebUserPrefsMeUser").getMePnUserOrThrow())||t.subtype==="send")a=o("WAWebE2EProtoUtils").decodeJid(e.participant);else return null}var l=new(r("WAWebMsgKey"))({fromMe:!t.id.fromMe,remote:t.id.remote,id:n,participant:a});return l}l.default=e}),98);
__d("WAWebParseRequestPaymentMessageProto",["WALogger","WALongInt","WANullthrows","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsWeb.pb","WAWebWid","WAWebWidFactory"],(function(t,n,r,o,a,i,l){var e;function s(t){var n,a=t.baseMessage,i=t.messageProtobuf,l=t.msgContext,s=t.paymentInfo,u=i.requestPaymentMessage;if(u!=null){var c=(n=u.noteMessage)==null||(n=n.extendedTextMessage)==null?void 0:n.contextInfo;if(s!=null&&s.futureproofed||o("WAWebE2EProtoUtils").hasUnsupportedCurrency(s))return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseRequestPaymentMessageProto: does not support novi transactions"]))),{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.PAYMENT,kind:o("WAWebMsgType").MsgKind.Payment,subtype:"phone_only_feature"}),contextInfo:c};var d=u.noteMessage,m=(d==null?void 0:d.extendedTextMessage)!=null||(d==null?void 0:d.conversation)!=null||(d==null?void 0:d.stickerMessage)!=null,p=d&&m?o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:d,message:{},msgContext:l}):void 0,_=s!=null?o("WAWebE2EProtoUtils").parseMsgPaymentInfo(s):{};if(u.amount==null)u.currencyCodeIso4217!=null&&_.paymentCurrency==null&&(_.paymentCurrency=u.currencyCodeIso4217),u.amount1000!=null&&_.paymentAmount1000==null&&(_.paymentAmount1000=o("WALongInt").numberOrThrowIfTooLarge(u.amount1000));else if(u.amount.currencyCode!=null&&_.paymentCurrency==null&&(_.paymentCurrency=u.amount.currencyCode),u.amount.value!=null&&_.paymentAmount1000==null){var f=u.amount,g=f.offset==null||f.offset===0?1e3:f.offset;_.paymentAmount1000=parseFloat(f.value)*1e3/g}if(u.requestFrom!=null&&(_==null?void 0:_.paymentMessageReceiverJid)==null){var h=o("WAWebE2EProtoUtils").decodeJid(u.requestFrom);h!=null&&(typeof h!="string"?_.paymentMessageReceiverJid=h:r("WAWebWid").isWid(h)&&(_.paymentMessageReceiverJid=o("WAWebWidFactory").createWid(h)))}return((_==null?void 0:_.paymentStatus)==null||(_==null?void 0:_.paymentTxnStatus)==null)&&o("WAWebE2EProtoUtils").isEitherSenderOrReceiverOfPaymentMessage(a.id,r("WANullthrows")(_.paymentMessageReceiverJid))&&(_.paymentStatus=o("WAWebProtobufsWeb.pb").PaymentInfo$Status.WAITING,_.paymentTxnStatus=o("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_INIT),u.expiryTimestamp!=null&&(_==null?void 0:_.paymentExpiryTimestamp)==null&&(_.paymentExpiryTimestamp=o("WALongInt").numberOrThrowIfTooLarge(u.expiryTimestamp)),m?{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.PAYMENT,kind:o("WAWebMsgType").MsgKind.Payment,subtype:"request"},_,{paymentNoteMsg:p}),contextInfo:c}:{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.PAYMENT,kind:o("WAWebMsgType").MsgKind.Payment,subtype:"futureproof"},_),contextInfo:c}}}l.default=s}),98);
__d("WAWebParseSendPaymentMessageProto",["WALogger","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","err"],(function(t,n,r,o,a,i,l){var e,s;function u(t){var n,r=t.baseMessage,a=t.messageProtobuf,i=t.msgContext,l=t.paymentInfo,s=a.sendPaymentMessage;if(s!=null){var u=(n=s.noteMessage)==null||(n=n.extendedTextMessage)==null?void 0:n.contextInfo;if((l==null?void 0:l.futureproofed)===!0||o("WAWebE2EProtoUtils").hasUnsupportedCurrency(l))return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseSendPaymentMessageProto: does not support novi transactions"]))),{msgData:babelHelpers.extends({},r,{type:"unknown",kind:o("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:u};var d=s.noteMessage,m=s.requestMessageKey,p=(d==null?void 0:d.extendedTextMessage)!=null||(d==null?void 0:d.conversation)!=null||(d==null?void 0:d.stickerMessage)!=null,_=p?"send":"futureproof",f=d&&p?o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:d,message:{},msgContext:i}):void 0,g=l!=null?o("WAWebE2EProtoUtils").parseMsgPaymentInfo(l):null,h=m?c(m,r.id,_):null;return p?{msgData:babelHelpers.extends({},r,{type:o("WAWebMsgType").MSG_TYPE.PAYMENT,kind:o("WAWebMsgType").MsgKind.Payment,subtype:"send"},g,{paymentRequestMessageKey:h,paymentNoteMsg:f}),contextInfo:u}:{msgData:babelHelpers.extends({},r,{type:o("WAWebMsgType").MSG_TYPE.PAYMENT,kind:o("WAWebMsgType").MsgKind.Payment,subtype:"futureproof"},g,{paymentRequestMessageKey:h}),contextInfo:u}}}function c(e,t,n){if(!e)throw r("err")("getPaymentRequestMessageKey: no message key is defined");var a=e.id;if(!a)throw r("err")("getPaymentRequestMessageKey: no key id is defined");if(!t)return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getPaymentRequestMessageKey: no message id is defined"]))),null;var i;if(t.remote.isGroup()){var l;if(t.fromMe||(l=o("WAWebE2EProtoUtils").decodeJid(e.participant))!=null&&l.equals(o("WAWebUserPrefsMeUser").getMePnUserOrThrow())||n==="send")i=o("WAWebE2EProtoUtils").decodeJid(e.participant);else return null}var u=new(r("WAWebMsgKey"))({fromMe:!t.fromMe,remote:t.remote,id:a,participant:i});return u}l.default=u}),98);
__d("WAWebPinAddonMessageProcessor",["Promise","WAArrayGroupBy","WANullthrows","WATimeUtils","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBProcessMessage","WAWebMsgGetters","WAWebMsgType","WAWebPinMessageProcessor","WAWebPinMsgGatingUtils","WAWebPinMsgParseWebMsgInfoPinInChat","WAWebPinsDbSerialization","WAWebProtobufsE2E.pb","WAWebWidFactory","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s=60*o("WATimeUtils").DAY_SECONDS,u=o("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:function(){return o("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled()},convert:{fromHistorySyncMsg:function(r){var t=o("WAWebPinMsgParseWebMsgInfoPinInChat").parseWebMsgInfoPinInChat(r.webMsgInfo,r.parsedWebMsgInfo),a=t.map(function(e){return o("WAWebPinsDbSerialization").deserializePinInChatMsgData(o("WAWebPinsDbSerialization").serializePinInChat(e))});return(e||(e=n("Promise"))).resolve(a)}},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.add;yield o("WAWebBackendApi").frontendSendAndReceive("updatePinCollection",{msgs:t,removeMsgs:e.remove})});function t(t){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.parents,r=t.processMode;return e.filter(function(e){var t,a=(t=e.pinExpiryDuration)!=null?t:0;if(r!==o("WAWebAddonConstants").AddonProcessMode.HistorySync){var i=n.getForAddon(e);if(i.type===o("WAWebMsgType").MSG_TYPE.EVENT_CREATION)return!0}return a<=s})});function t(t,n){return e.apply(this,arguments)}return t})(),afterUpsert:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=a.processMode;if(!(i===o("WAWebAddonConstants").AddonProcessMode.HistorySync||i===o("WAWebAddonConstants").AddonProcessMode.ProcessGroupHistoryBundle)){var l=o("WAArrayGroupBy").groupBy(t,function(e){return e.id.remote.toString()}),s=[o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(t.map(function(e){return e.id.toString()}))].concat(l.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t[0],i=t[1],l=o("WAWebWidFactory").createWid(a),s=yield(e||(e=n("Promise"))).all(r("compactMap")(i,function(e){var t=o("WAWebMsgGetters").getT(e);if(!(e.pinMessageType!==o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.PIN_FOR_ALL||t==null||o("WAWebMsgGetters").getIsFailed(e)))return o("WAWebPinMessageProcessor").genSystemMessage(l,t,r("WANullthrows")(o("WAWebMsgGetters").getSender(e)))})),u=yield o("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:l,msgObjs:s,meta:{add:"after",isHistory:!1},processMessagesOrigin:"pinMessage"});u&&(yield o("WAWebDBProcessMessage").storeMessages(s,l))});return function(e){return t.apply(this,arguments)}})()));yield(e||(e=n("Promise"))).all(s)}});function a(e,n){return t.apply(this,arguments)}return a})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})()}),c=u;l.default=c}),98);
__d("WAWebPinMsgConstants",["$InternalEnum","WATimeUtils","err"],(function(t,n,r,o,a,i,l){var e={INVALID:0,PIN:1,UNPIN:2},s=n("$InternalEnum").Mirrored(["FiveSeconds","FifteenSeconds","OneMinute","OneDay","SevenDays","ThirtyDays"]),u=s.SevenDays;function c(e){switch(e){case s.FiveSeconds:return 5;case s.FifteenSeconds:return 15;case s.OneMinute:return o("WATimeUtils").MINUTE_SECONDS;case s.OneDay:return o("WATimeUtils").DAY_SECONDS;case s.SevenDays:return 7*o("WATimeUtils").DAY_SECONDS;case s.ThirtyDays:return 30*o("WATimeUtils").DAY_SECONDS}}function d(e){switch(e){case 5:return s.FiveSeconds;case 15:return s.FifteenSeconds;case o("WATimeUtils").MINUTE_SECONDS:return s.OneMinute;case o("WATimeUtils").DAY_SECONDS:return s.OneDay;case 7*o("WATimeUtils").DAY_SECONDS:return s.SevenDays;case 30*o("WATimeUtils").DAY_SECONDS:return s.ThirtyDays;default:throw r("err")("Unexpeded pin expiry duration")}}l.PIN_STATE=e,l.PinExpiryDurationOption=s,l.DEFAULT_PIN_EXPIRY_DURATION_OPTION=u,l.getPinExpiryDuration=c,l.getPinExpiryOption=d}),98);
__d("WAWebDBCRUDOperationsPinInChat",["WAWebModelStorageUtils","WAWebPinInChatSchema","WAWebPinMsgConstants","WAWebPinMsgGatingUtils","WAWebPinsDbSerialization","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){var r=new Map;return t.forEach(function(e){var t=e.parentMsgKey,n=t,o=r.get(n);(!o||(o==null?void 0:o.senderTimestampMs)<=e.senderTimestampMs)&&r.set(n,e)}),o("WAWebModelStorageUtils").getStorage().lock(["pinned-messages"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],a=yield n.anyOf(["chatId"],[e.toString()]);a.forEach(function(e){var t=e.parentMsgKey,n=r.get(t);n&&n.senderTimestampMs<=e.senderTimestampMs&&r.delete(t)});var i=new Map(a.map(function(e){return[e.parentMsgKey,e]}));r.forEach(function(e,t){i.set(t,e)});var l=Array.from(i.values()),s=l.filter(function(e){return e.pinType===o("WAWebPinMsgConstants").PIN_STATE.PIN}).sort(function(e,t){return t.senderTimestampMs-e.senderTimestampMs}).slice(o("WAWebPinMsgGatingUtils").getMaxPins());s.forEach(function(e){r.set(e.parentMsgKey,babelHelpers.extends({},e,{pinType:o("WAWebPinMsgConstants").PIN_STATE.UNPIN}))});var u=Array.from(r.values());return yield n.bulkCreateOrReplace(u),u});return function(e){return t.apply(this,arguments)}})())}function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebPinInChatSchema").getTable().get(e.toString());return t==null?null:o("WAWebPinsDbSerialization").deserializePinInChat(t)}),u.apply(this,arguments)}l.createOrUpdatePinInChat=e,l.getPinInChatByParentKey=s}),98);
__d("WAWebPinMessageProcessor",["Promise","WANullthrows","WAWebBackendApi","WAWebDBCRUDOperationsPinInChat","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBMsgUtils","WAWebDBProcessMessage","WAWebDBStoreMessageOrphans","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebPinsDbSerialization","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebViewMode.flow","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=r("compactMap")(e,function(e){return e.pinParentKey}),n=t.map(function(e){return e.toString()}),a=yield o("WAWebDBMsgUtils").getMsgsByMsgKey(n),i=new Map(a.map(function(e){return[e.id.toString(),e]}));return i}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAWebDBStoreMessageOrphans").storeMessageOrphans(e,function(e){return r("WANullthrows")(e.pinParentKey)})}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=yield s(a),l=[],u=[];for(var d of a){var m=i.get(r("WANullthrows")(d.pinParentKey).toString());m?u.push(d):l.push(d)}yield(e||(e=n("Promise"))).all([n("asyncToGeneratorRuntime").asyncToGenerator(function*(){l.length!==0&&(yield c(l),yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(l.map(function(e){return e.id.toString()})))})(),n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(u.length!==0){var a=yield o("WAWebBackendApi").frontendSendAndReceive("updatePinCollection",{msgs:u,removeMsgs:[]});a&&(yield o("WAWebDBCRUDOperationsPinInChat").createOrUpdatePinInChat(t,a.map(function(e){return o("WAWebPinsDbSerialization").serializePinInChat(e)})),yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(a.map(function(e){return e.msgKey.toString()})));var i=yield(e||(e=n("Promise"))).all(r("compactMap")(u,function(e){return e.pinMessageType===o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.PIN_FOR_ALL?_(t,r("WANullthrows")(e.t),r("WANullthrows")(o("WAWebMsgGetters").getSender(e))):null})),l=yield o("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:t,msgObjs:i,meta:{add:"after",isHistory:!1},processMessagesOrigin:"pinMessage"});l&&(yield o("WAWebDBProcessMessage").storeMessages(i,t))}})()])}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=o("WAWebUserPrefsMeUser").getMePnUserOrThrow(),i=o("WAWebUserPrefsMeUser").isMeAccount(n);return{id:new(r("WAWebMsgKey"))({id:yield r("WAWebMsgKey").newId(),fromMe:i,remote:e,participant:n}),author:n,from:e,to:a,recipients:[],t:t,type:o("WAWebMsgType").MSG_TYPE.PINNED_MESSAGE,kind:o("WAWebMsgType").MsgKind.PinnedMessage,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,templateParams:[n]}}),f.apply(this,arguments)}l.processPinMessages=m,l.genSystemMessage=_}),98);
__d("WAWebPinsDbSerialization",["WANullthrows","WAWebAddonConstants","WAWebAddonProcessMsgsUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebViewMode.flow","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){return babelHelpers.extends({},e,{msgKey:e.msgKey.toString(),parentMsgKey:e.parentMsgKey.toString(),chatId:e.chatId.toString(),sender:e.sender.toString()})}function s(e){return babelHelpers.extends({},e,{msgKey:r("WAWebMsgKey").fromString(e.msgKey),parentMsgKey:r("WAWebMsgKey").fromString(e.parentMsgKey),chatId:o("WAWebWidFactory").asChatWid(o("WAWebWidFactory").createWid(e.chatId)),sender:o("WAWebWidFactory").createUserWidOrThrow(e.sender)})}function u(e){var t=o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e))).toString();return{msgKey:e.id.toString(),ack:e.ack,t:e.t,read:e.read,parentMsgKey:e.pinParentKey.toString(),senderTimestampMs:e.pinSenderTimestampMs,chatId:e.id.remote.toString(),sender:t,pinType:e.pinMessageType,pinExpiryDuration:e.pinExpiryDuration}}function c(e){var t=e.ack,n=e.id,r=e.read,a=e.t;return{base:{msgKey:n.toString(),ack:t,t:a,read:r,targetMsgKey:o("WAWebAddonProcessMsgsUtils").getParentMsgKey(e).toString()},addonProps:{pinSenderTimestampMs:e.pinSenderTimestampMs,pinMessageType:e.pinMessageType,pinExpiryDuration:e.pinExpiryDuration}}}function d(e){var t=c(e),n=t.addonProps,r=t.base;return babelHelpers.extends({},r,{rowType:o("WAWebAddonConstants").AddonMinimizedType.PinInChat,arbitraryIndex:e.id.remote.toString(),addonProps:n})}function m(e){var t,n=r("WAWebMsgKey").fromString(e.msgKey),a=e.addonProps;return babelHelpers.extends({id:n},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(n,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{type:o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE,kind:o("WAWebMsgType").MsgKind.PinInChat,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,ack:e.ack,t:e.t,read:e.read,pinParentKey:r("WAWebMsgKey").fromString(e.targetMsgKey),pinSenderTimestampMs:a.pinSenderTimestampMs,pinMessageType:(t=o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.cast(a.pinMessageType))!=null?t:o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.UNKNOWN_TYPE,pinExpiryDuration:a.pinExpiryDuration})}function p(e){var t,n=r("WAWebMsgKey").fromString(e.msgKey),a=o("WAWebMsgKeyUtils").msgKeyToTargetInfo(n,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),i=a.author,l=a.from,s=a.to;return{id:r("WAWebMsgKey").fromString(e.msgKey),from:l,to:s,author:i,type:o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE,kind:o("WAWebMsgType").MsgKind.PinInChat,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,ack:e.ack,t:e.t,read:e.read,pinSenderTimestampMs:e.senderTimestampMs,pinParentKey:r("WAWebMsgKey").fromString(e.parentMsgKey),pinMessageType:(t=o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.cast(e.pinType))!=null?t:o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.UNKNOWN_TYPE,pinExpiryDuration:e.pinExpiryDuration}}l.serializePinInChat=e,l.deserializePinInChat=s,l.serializePinInChatMsgData=u,l.pinInChatMsgDatIntoUnifiedAddonRow=d,l.unifiedAddonRowIntoPinInChatMsgData=m,l.deserializePinInChatMsgData=p}),98);
__d("WAWebPinMsgParseWebMsgInfoPinInChat",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebProtobufsE2E.pb","WAWebProtobufsWeb.pb","WAWebWidFactory","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return e===o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.PIN_FOR_ALL?o("WAWebProtobufsWeb.pb").PinInChat$Type.PIN_FOR_ALL:e===o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.UNPIN_FOR_ALL?o("WAWebProtobufsWeb.pb").PinInChat$Type.UNPIN_FOR_ALL:e===o("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.UNKNOWN_TYPE?o("WAWebProtobufsWeb.pb").PinInChat$Type.UNKNOWN_TYPE:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function c(t,n){var a=[];try{var i;if(t==null||n==null)return a;var l=[];if(t.pinInChat!=null&&n.pinInChat!=null)l.push(n.pinInChat);else if(((i=t.messageAddOns)==null?void 0:i.length)>0){for(var c of t.messageAddOns)if(c.messageAddOnType===o("WAWebProtobufsWeb.pb").MessageAddOn$MessageAddOnType.PIN_IN_CHAT){var d,m=(d=c.messageAddOn)==null?void 0:d.pinInChatMessage;m!=null&&l.push({key:m.key,type:u(r("WANullthrows")(m.type)),senderTimestampMs:c.senderTimestampMs,serverTimestampMs:c.serverTimestampMs,messageAddOnContextInfo:c.addOnContextInfo})}}for(var p of l){var _=p.key,f=p.messageAddOnContextInfo,g=p.senderTimestampMs,h=p.serverTimestampMs,y=p.type,C=r("WANullthrows")(o("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(r("WANullthrows")(_))),b=C.msgKey,v=C.sender;if(v==null)o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseWebMsgInfoPinInChat: pinInChat sender should be a wid."])));else{var S;a.push({msgKey:b,parentMsgKey:n.id,chatId:o("WAWebWidFactory").asChatWid(b.remote),senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(r("WANullthrows")(g)),t:(S=o("WAWebAddOnParseWebMsgInfo").getAddonServerTimestamp(h))!=null?S:void 0,pinType:r("WANullthrows")(y),sender:v,pinExpiryDuration:f==null?void 0:f.messageAddOnDurationInSecs})}}}catch(e){var R=r("getErrorSafe")(e);o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoPinInChat failed with error "," and stack ",""])),R==null?void 0:R.name,R==null?void 0:R.stack)}return a}l.parseWebMsgInfoPinInChat=c}),98);
__d("WAWebPinInChatValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({INVALID_PIN_IN_CHAT_EXPIRY_DURATION:"pin_in_chat_invalid_expiry_duration",INVALID_PIN_IN_CHAT_MSG_REMOTE:"pin_in_chat_invalid_msg_remote",MISSING_PARENT_MSG_KEY:"pin_in_chat_missing_parent_msg_key",MISSING_TYPE:"pin_in_chat_missing_type",MISSING_SENDER_TIMESTAMP:"pin_in_chat_missing_timestamp",INVALID_EDIT_ATTR:"invalid_edit_attr"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="PinInChatValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.PinInChatValidationErrorCode=e,l.PinInChatValidationError=s}),98);
__d("WAWebParsePinMessageProto",["WALongInt","WAWebAck","WAWebE2EProtoUtils","WAWebLidMigrationUtils","WAWebMsgType","WAWebPinInChatValidationError","WAWebPinMsgGatingUtils","WAWebWamEnumE2eFailureReason","WAWebWid"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.baseMessage,a=e.editAttr,i=e.messageProtobuf,l=e.msgContext,s=i.pinInChatMessage;if(s!=null){if(!o("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled())return{msgData:babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE}),contextInfo:null};if(l==="relay"&&a!==o("WAWebAck").EDIT_ATTR.PIN_IN_CHAT)throw new(o("WAWebPinInChatValidationError")).PinInChatValidationError(o("WAWebPinInChatValidationError").PinInChatValidationErrorCode.INVALID_EDIT_ATTR,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var u=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(s.key,n);if(u==null)throw new(o("WAWebPinInChatValidationError")).PinInChatValidationError(o("WAWebPinInChatValidationError").PinInChatValidationErrorCode.MISSING_PARENT_MSG_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(!r("WAWebWid").equals.apply(r("WAWebWid"),o("WAWebLidMigrationUtils").toCommonAddressingMode(u.remote,n.id.remote))&&!u.remote.isBroadcast())throw new(o("WAWebPinInChatValidationError")).PinInChatValidationError(o("WAWebPinInChatValidationError").PinInChatValidationErrorCode.INVALID_PIN_IN_CHAT_MSG_REMOTE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var c=(t=i.messageContextInfo)==null?void 0:t.messageAddOnDurationInSecs;if(c!=null&&c<0)throw new(o("WAWebPinInChatValidationError")).PinInChatValidationError(o("WAWebPinInChatValidationError").PinInChatValidationErrorCode.INVALID_PIN_IN_CHAT_EXPIRY_DURATION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d=s.type;if(d==null)throw new(o("WAWebPinInChatValidationError")).PinInChatValidationError(o("WAWebPinInChatValidationError").PinInChatValidationErrorCode.MISSING_TYPE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var m=o("WALongInt").maybeNumberOrThrowIfTooLarge(s.senderTimestampMs);if(m==null)throw new(o("WAWebPinInChatValidationError")).PinInChatValidationError(o("WAWebPinInChatValidationError").PinInChatValidationErrorCode.MISSING_SENDER_TIMESTAMP,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var p=babelHelpers.extends({},n,{type:o("WAWebMsgType").MSG_TYPE.PIN_MESSAGE,kind:o("WAWebMsgType").MsgKind.PinInChat,pinParentKey:u,pinMessageType:d,pinSenderTimestampMs:m,pinExpiryDuration:c});return{msgData:p,contextInfo:null}}}l.default=e}),98);
__d("WAWebPollVoteAddonMessageProcessor",["Promise","WALogger","WAWebABProps","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebAddonInfraError","WAWebAddonLogUtils","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebLastAddOnDBSerialization","WAWebMsgType","WAWebPollVoteEncryptMsgData","WAWebPollsExtractVotes","WAWebPollsParseWebMsgInfoPollUpdates","WAWebPollsVoteDataUtils","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c,d=o("WAWebAddonCreateMsgProcessor").createAddonMsgProcessorDualEncrypted({isEnabled:function(){return o("WAWebABProps").getABPropConfigValue("unified_poll_vote_addon_infra_enabled")},convert:{fromHistorySyncMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebPollsParseWebMsgInfoPollUpdates").parseWebMsgInfoPollUpdates(e).then(function(e){return e.map(o("WAWebPollsVoteDataUtils").voteDataToPollVoteMsgData)})});function t(t){return e.apply(this,arguments)}return t})(),toDualEncryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.PollVoteEncrypted?e:o("WAWebPollVoteEncryptMsgData").encryptPollVoteMsgData(e,t)});function t(t,n){return e.apply(this,arguments)}return t})(),toDualDecryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.PollVoteDecrypted?e:o("WAWebPollsExtractVotes").extractVote(e,t).then(o("WAWebPollsVoteDataUtils").voteDataToPollVoteMsgData)});function t(t,n){return e.apply(this,arguments)}return t})()},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return o("WAWebBackendApi").frontendSendAndReceive("upsertVotesModelCollection",{votes:e.add.map(o("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData),votesToRemove:e.remove,restoredFromDb:t===o("WAWebAddonConstants").AddonProcessMode.Hydration||t===o("WAWebAddonConstants").AddonProcessMode.HistorySync})});function t(t,n){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=r.parents,i=[],l=[];for(var m of t)if(m.addonEncrypted){var p=a.getForAddon(m);if(p==null)throw new(o("WAWebAddonInfraError")).AddonInfraError(o("WAWebAddonInfraError").AddonInfraErrorCode.MissingParentMsg);l.push(d.convert.toDualDecryptedMsgData(m,p)),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[pollVoteMsgProcessor] Decrypting poll vote message"]))).sendLogs("unexpected encrypted poll vote",{sampling:.01})}else i.push(m);if(l.length!==0){var _=yield(c||(c=n("Promise"))).allSettled(l);for(var f of _)f.status==="fulfilled"&&f.value.kind===o("WAWebMsgType").MsgKind.PollVoteDecrypted?i.push(f.value):o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Cannot decrypt poll vote message: ",""])),f.reason);o("WAWebAddonLogUtils").hasSettledWithError(_)&&o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[pollVoteMsgProcessor] Failed to decrypt poll vote message"]))).tags("messagings","addons").sendLogs("poll-vote-decryption-error",{sampling:.01})}return i});function r(e,n){return t.apply(this,arguments)}return r})(),afterUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.processMode;yield o("WAWebShouldUpdateLastAddOnPreview").filterAndUpdateChatPreviews(e.map(function(e){return o("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromVoteData(o("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData(e),!1)})),n!==o("WAWebAddonConstants").AddonProcessMode.HistorySync&&n===o("WAWebAddonConstants").AddonProcessMode.OnlineReceive&&(yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(e.map(function(e){return e.id.toString()})))});function t(t,n){return e.apply(this,arguments)}return t})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function t(){return e.apply(this,arguments)}return t})()}),m=d;l.default=m}),98);
__d("WAWebPollsCreateOptionLocalIdMap",["Promise","WAHex","WANullthrows","WAWebPollOptionHashUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield(e||(e=n("Promise"))).all(t.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield c(e),n=o("WAHex").toHex(new Uint8Array(t));return{hash:t,hexHash:n,localId:e.localId}});return function(t){return e.apply(this,arguments)}})())),i=new Map,l=new Map;for(var s of a){var u=s.hash,d=s.hexHash,m=s.localId;i.set(d,m),l.set(m,u)}return{getLocalIdForHexHash:function(t){return r("WANullthrows")(i.get(t))},getLocalIdForHash:function(t){return r("WANullthrows")(i.get(o("WAHex").toHex(new Uint8Array(t))))},getHashForLocalId:function(t){return r("WANullthrows")(l.get(t))},includesHashes:function(t){return t.every(function(e){return i.has(o("WAHex").toHex(new Uint8Array(e)))})}}}),u.apply(this,arguments)}function c(e){return o("WAWebPollOptionHashUtils").getHashBufferForString(e.name)}l.createOptionLocalIdMap=s}),98);
__d("WAWebPollsProtobufConversion",["WALongInt","WANullthrows","WAWebPollsCreateOptionLocalIdMap","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(t),r=e.selectedOptionLocalIds.map(n.getHashForLocalId);return{selectedOptions:r.length===0?null:r}}),s.apply(this,arguments)}function u(e){var t=e.ack,n=e.optionLocalIdMap,a=e.parentMsgKey,i=e.pollVoteMsgKey,l=e.read,s=e.sender,u=e.senderTimestampMs,c=e.t,d=e.voteProtobuf;return{msgKey:i,parentMsgKey:r("WANullthrows")(a),selectedOptionLocalIds:d.selectedOptions.map(n.getLocalIdForHash),senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(u),t:o("WALongInt").maybeNumberOrThrowIfTooLarge(c),sender:s,ack:t,read:l}}l.protobufFromVote=e,l.voteFromProtobuf=u}),98);
__d("WAWebPollVoteEncryptMsgData",["WANullthrows","WAWebAck","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebPollsProtobufConversion","WAWebPollsVoteEncryption","WAWebViewMode.flow","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a,i,l=(i=r("WANullthrows"))((a=o("WAWebMsgGetters")).getPollOptions(t)),s=i(a.getMessageSecret(t),"Poll creation missing message secret"),u=i(a.getOriginalSender(t)),c=self.crypto.getRandomValues(new Uint8Array(12)),d=yield o("WAWebPollsVoteEncryption").encryptVote({encodedProtobuf:yield o("WAWebPollsProtobufConversion").protobufFromVote(e,l),iv:c,messageSecret:s,pollCreationOriginalSender:u,stanzaId:t.id.id,voteSender:o("WAWebWidFactory").asUserWidOrThrow(i(a.getSender(e))),isOneOnOne:a.getRemote(t).isUser()}),m=d.encPayload;return babelHelpers.extends({id:e.id,type:o("WAWebMsgType").MSG_TYPE.POLL_UPDATE,kind:o("WAWebMsgType").MsgKind.PollVoteEncrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,subtype:"poll_vote",addonEncrypted:!0,t:Math.floor(e.senderTimestampMs/1e3)},o("WAWebMsgKeyUtils").msgKeyToTargetInfo(e.id,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),{isNewMsg:!0,local:!0,ack:(n=e.ack)!=null?n:o("WAWebAck").ACK.CLOCK,pollUpdateParentKey:t.id,encPollVote:{encPayload:m,encIv:c.buffer},senderTimestampMs:e.senderTimestampMs})}),s.apply(this,arguments)}l.encryptPollVoteMsgData=e}),98);
__d("WAWebDBPollsGetParentMessages",["WANullthrows","WAWebAddonProcessMsgsUtils","WAWebMsgType","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs(e,null),n=t[0],r=t[1],a=new Map,i=[];for(var l of r){var s=n.get(u(l));s==null||s.type===o("WAWebMsgType").MSG_TYPE.UNKNOWN?i.push(l):a.set(l,s)}return{pollUpdateMsgsToParentMsgs:a,orphans:i}}),s.apply(this,arguments)}function u(e){return r("WANullthrows")(e.pollUpdateParentKey).toString()}l.getParentMessages=e}),98);
__d("WAWebPollsParseWebMsgInfoPollUpdates",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebMsgType","WAWebPollsCreateOptionLocalIdMap","WAWebPollsProtobufConversion","WAWebProtobufsWeb.pb","asyncToGeneratorRuntime","compactMap","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s;function u(e){return e.length===0?null:e.filter(function(e){return e.messageAddOnType===o("WAWebProtobufsWeb.pb").MessageAddOn$MessageAddOnType.POLL_UPDATE}).map(function(e){var t;return{senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(r("WANullthrows")(e.senderTimestampMs)),serverTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(r("WANullthrows")(e.serverTimestampMs)),pollUpdateMessageKey:e.messageAddOnKey,vote:(t=e.legacyMessage)==null?void 0:t.pollVote}})}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.isFromCag,a=t.parsedWebMsgInfo,i=t.webMsgInfo;try{var l;if(i==null||i.pollUpdates==null)return[];if(a==null||a.type!==o("WAWebMsgType").MSG_TYPE.POLL_CREATION)return[];var c=a,d=yield o("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(c.pollOptions),m=(l=u(i.messageAddOns))!=null?l:i.pollUpdates;return r("compactMap")(m,function(t){try{var a,i=(a=r("WANullthrows"))(t.pollUpdateMessageKey),l=a(t.vote),s=a(o("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(i,n)),u=s.msgKey,m=s.sender;return o("WAWebPollsProtobufConversion").voteFromProtobuf({voteProtobuf:l,pollVoteMsgKey:u,parentMsgKey:c.id,sender:m,senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(a(t.senderTimestampMs)),t:o("WAWebAddOnParseWebMsgInfo").getAddonServerTimestamp(t.serverTimestampMs),optionLocalIdMap:d,ack:null,read:t.unread!==!0})}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Failed to parse pollUpdate with error ",""])),t).sendLogs("parseWebMsgInfoPollUpdates-vote-parse-error"),null}})}catch(e){var p=r("getErrorSafe")(e);return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoPollUpdates failed with error "," and stack ",""])),p==null?void 0:p.name,p==null?void 0:p.stack).sendLogs("parseWebMsgInfoPollUpdates-error"),[]}}),d.apply(this,arguments)}l.parseWebMsgInfoPollUpdates=c}),98);
__d("WAWebPollsExtractVotes",["Promise","WALogger","WANullthrows","WAWebAddonEncryptionError","WAWebMsgGetters","WAWebMsgType","WAWebPollsCreateOptionLocalIdMap","WAWebPollsProtobufConversion","WAWebPollsValidationError","WAWebPollsVoteEncryption","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","compactMap"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield(u||(u=n("Promise"))).allSettled(Array.from(t.entries(),function(e){var t=e[0],n=e[1];return m(t,n)}));return r("compactMap")(a,function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":{var n=t.reason;if(n instanceof o("WAWebPollsValidationError").PollVoteValidationError){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Poll vote extraction failed: ",""])),n.code).sendLogs(n.code);return}o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Poll vote extraction failed: ","\n",""],["Poll vote extraction failed: ","\\n",""])),n.message,n.stack).sendLogs("poll-vote-extraction-unknown-error")}}})}),d.apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.PollVoteEncrypted,t),a=r("WANullthrows")(t.pollSelectableOptionsCount),i=r("WANullthrows")(t.pollOptions),l=r("WANullthrows")(e.encPollVote),s=o("WAWebWidFactory").asUserWidOrThrow(o("WAWebMsgGetters").getSender(e)),u=yield o("WAWebPollsVoteEncryption").decryptVote({encryptedVote:l.encPayload,iv:l.encIv,messageSecret:n,stanzaId:t.id.id,pollCreationOriginalSender:o("WAWebMsgGetters").getOriginalSender(t),voteSender:s,isOneOnOne:o("WAWebMsgGetters").getRemote(t).isUser()}),c=u.selectedOptions.length;if(c>i.length||a!==0&&c>a)throw new(o("WAWebPollsValidationError")).PollVoteValidationError(o("WAWebPollsValidationError").PollVoteValidationErrorCode.INVALID_OPTIONS_COUNT);if(u.selectedOptions.some(function(e){return e.byteLength!==32}))throw new(o("WAWebPollsValidationError")).PollVoteValidationError(o("WAWebPollsValidationError").PollVoteValidationErrorCode.INVALID_OPTION);var d=yield o("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(i);if(!d.includesHashes(u.selectedOptions))throw new(o("WAWebPollsValidationError")).PollVoteValidationError(o("WAWebPollsValidationError").PollVoteValidationErrorCode.OPTION_NOT_FOUND);return o("WAWebPollsProtobufConversion").voteFromProtobuf({voteProtobuf:u,pollVoteMsgKey:e.id,parentMsgKey:e.pollUpdateParentKey,sender:s,senderTimestampMs:e.senderTimestampMs,t:r("WANullthrows")(e.t),optionLocalIdMap:d,ack:e.ack,read:o("WAWebUserPrefsMeUser").isMeAccount(s)})}),p.apply(this,arguments)}l.extractVotes=c,l.extractVote=m}),98);
__d("WAWebPollsParsePollVoteMessageProto",["WALongInt","WAWebE2EProtoUtils","WAWebMsgType","WAWebPollsValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.pollUpdateMessage;if(!r)return null;var a=r.$$unknownFieldCount,i=a===void 0?0:a,l=r.pollCreationMessageKey,s=r.senderTimestampMs,u=r.vote;if(i>0)return null;if(l==null)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_POLL_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var c=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(l,t);if(c==null)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_POLL_MESSAGE_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(s==null)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_SENDER_TIMESTAMP,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(u==null)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_UPDATE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d=u.encIv,m=u.encPayload;if(m==null)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_VOTE_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(d==null)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_VOTE_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(d.byteLength!==12)throw new(o("WAWebPollsValidationError")).PollUpdateValidationError(o("WAWebPollsValidationError").PollUpdateValidationErrorCode.INVALID_VOTE_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.POLL_UPDATE,kind:o("WAWebMsgType").MsgKind.PollVoteEncrypted,subtype:"poll_vote",addonEncrypted:!0,pollUpdateParentKey:c,encPollVote:{encPayload:m,encIv:d},senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(s)}),contextInfo:null}}l.default=e}),98);
__d("WAWebPollsVoteEncryption",["WAWebAddonEncryption","WAWebApiContact","WAWebLidMigrationUtils","WAWebMsgType","WAWebPollsVoteEncryptionInternal","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebPollsVoteEncryptionInternal").decryptVoteInternal(e).catch(function(t){if(e.isOneOnOne){var n=u(e.pollCreationOriginalSender,e.voteSender),r=n.alignedPollCreator,a=n.alignedVoteSender;if(r!=null&&a!=null)return o("WAWebPollsVoteEncryptionInternal").decryptVoteInternal(babelHelpers.extends({},e,{pollCreationOriginalSender:r,voteSender:a})).catch(function(t){var n=o("WAWebApiContact").getAlternateUserWid(r),i=o("WAWebApiContact").getAlternateUserWid(a);if(n!=null&&i!=null)return o("WAWebPollsVoteEncryptionInternal").decryptVoteInternal(babelHelpers.extends({},e,{pollCreationOriginalSender:n,voteSender:i}));throw t})}throw t})}function s(e){var t={type:o("WAWebMsgType").MsgKind.PollVoteDecrypted,encode:e.encodedProtobuf};if(e.isOneOnOne){var n=u(e.pollCreationOriginalSender,e.voteSender),r=n.alignedPollCreator,a=n.alignedVoteSender;r!=null&&a!=null&&(e.pollCreationOriginalSender=r,e.voteSender=a)}return o("WAWebAddonEncryption").encryptAddOn(t,{messageSecret:e.messageSecret,iv:e.iv,stanzaId:e.stanzaId,originalMessageSender:e.pollCreationOriginalSender,addOnSender:e.voteSender})}function u(e,t){var n=o("WAWebLidMigrationUtils").toCommonAddressingMode(e,t),r=n[0],a=n[1];return{alignedVoteSender:a!=null?o("WAWebWidFactory").asUserWidOrThrow(a):null,alignedPollCreator:r!=null?o("WAWebWidFactory").asUserWidOrThrow(r):null}}l.decryptVote=e,l.encryptVote=s}),98);
__d("WAWebPollsVoteEncryptionInternal",["WAWebAddonEncryption","WAWebMsgType","WAWebProtobufsE2E.pb","asyncToGeneratorRuntime","decodeProtobuf"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t={type:o("WAWebMsgType").MsgKind.PollVoteEncrypted,encryptedAddOn:e.encryptedVote},n=yield o("WAWebAddonEncryption").decryptAddOn(t,{messageSecret:e.messageSecret,iv:e.iv,stanzaId:e.stanzaId,originalMessageSender:e.pollCreationOriginalSender,addOnSender:e.voteSender});return o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsE2E.pb").Message$PollVoteMessageSpec,n)}),s.apply(this,arguments)}l.decryptVoteInternal=e}),98);
__d("WAWebParseProductMessageProto",["WALongInt","WAWebMsgType","WAWebParseImageMessageProto"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,a=e.msgContext,i=n.productMessage;if(i!=null){var l=i.body,s=i.businessOwnerJid,u=i.contextInfo,c=i.footer,d=i.product;if(d!=null){var m=d.currencyCode,p=d.description,_=d.priceAmount1000,f=d.productId,g=d.productImage,h=d.productImageCount,y=d.retailerId,C=d.salePriceAmount1000,b=d.title,v=d.url,S;if(g!=null){var R=r("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:g},baseMessage:t,msgContext:a});if(R!=null){var L=R.msgData;S={deprecatedMms3Url:L.deprecatedMms3Url,directPath:L.directPath,staticUrl:L.staticUrl,mimetype:L.mimetype,filehash:L.filehash,encFilehash:L.encFilehash,size:L.size,height:L.height,width:L.width,mediaKey:L.mediaKey,mediaKeyTimestamp:L.mediaKeyTimestamp,body:L.body,interactiveAnnotations:L.interactiveAnnotations,scanLengths:L.scanLengths,scansSidecar:L.scansSidecar,isViewOnce:L.isViewOnce,thumbnailDirectPath:L.thumbnailDirectPath,thumbnailSha256:L.thumbnailSha256,thumbnailEncSha256:L.thumbnailEncSha256}}}var E=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.PRODUCT,kind:o("WAWebMsgType").MsgKind.Product,businessOwnerJid:s,productId:f,currencyCode:m,priceAmount1000:o("WALongInt").numberOrThrowIfTooLarge(_!=null?_:0)||void 0,salePriceAmount1000:o("WALongInt").numberOrThrowIfTooLarge(C!=null?C:0)||void 0,retailerId:y,url:v,productImageCount:h,title:b,description:p,caption:l,footer:c},S);return{msgData:E,contextInfo:u}}}}l.default=e}),98);
__d("WAWebParseProtocolEphemeralSettingMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.baseMessage,a=e.messageProtobuf,i=a.protocolMessage;if(i!=null&&i.type===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SETTING){var l;i.disappearingMode!=null&&(l=o("WAWebE2EProtoUtils").protoToDisappearingMode(r,i.disappearingMode));var s=babelHelpers.extends({},r,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.Protocol,subtype:"ephemeral_setting",ephemeralDuration:i.ephemeralExpiration,disappearingModeTrigger:(t=l)==null?void 0:t.disappearingModeTrigger,disappearingModeInitiatedByMe:(n=l)==null?void 0:n.initiatedByMe});return{msgData:s,contextInfo:void 0}}}l.default=e}),98);
__d("WAWebParseProtocolLimitSharingMessageProto",["WAWebLimitSharingProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=o("WAWebLimitSharingProtoUtils").getLimitSharingEnvelopeFromProtobuf(n);if(!((r==null?void 0:r.type)!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.LIMIT_SHARING||!(r!=null&&r.limitSharing))){var a=o("WAWebLimitSharingProtoUtils").getLimitSharingFromEnvelope(r.limitSharing,o("WAWebWidFactory").createWid(t.from.toString()));return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,subtype:"limit_sharing_system_message",kind:"protocol",limitSharing:a}),contextInfo:void 0}}}l.default=e}),98);
__d("WAWebGenerateAudioOrPttReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebGeneratePtvReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebPtvParsePtvMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaMessageGetValidatedProperties","WAWebMsgType","WAWebPtvGatingUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=e.msgContext,a=n.ptvMessage;if(a!=null){if(!o("WAWebPtvGatingUtils").isPtvReceivingEnabled())return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.PTV}),contextInfo:a==null?void 0:a.contextInfo};var i=a.accessibilityLabel,l=a.annotations,s=a.caption,u=a.contextInfo,c=a.directPath,d=a.gifAttribution,m=a.gifPlayback,p=a.height,_=a.jpegThumbnail,f=a.mediaKeyTimestamp,g=a.mimetype,h=a.seconds,y=a.staticUrl,C=a.streamingSidecar,b=a.thumbnailDirectPath,v=a.thumbnailEncSha256,S=a.thumbnailSha256,R=a.viewOnce,L=a.width,E=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(a,t,r,o("WAWebMsgType").MSG_TYPE.PTV),k=E.fileEncSha256,I=E.fileLength,T=E.fileSha256,D=E.mediaKey,x=E.url,$=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.PTV,kind:o("WAWebMsgType").MsgKind.Ptv,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(x),directPath:c,staticUrl:y||"",mimetype:g,caption:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(s),filehash:o("WAWebE2EProtoParserApi").decodeBytes(T),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(k),size:o("WALongInt").numberOrThrowIfTooLarge(I||0),height:p,width:L,mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(D),mediaKeyTimestamp:f!=null?o("WALongInt").numberOrThrowIfTooLarge(f):o("WATimeUtils").unixTime(),duration:""+(h||0),body:o("WAWebE2EProtoParserApi").decodeBytes(_)||"",interactiveAnnotations:l,isViewOnce:R===!0,thumbnailDirectPath:b,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(S),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(v),isGif:m,gifAttribution:d,accessibilityLabel:i,streamingSidecar:C});return o("WAWebE2EProtoParserApi").validateRequiredMediaProperties($,a),{msgData:$,contextInfo:u}}}l.default=e}),98);
__d("WAWebQuestionValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({MISSING_QUOTED_QUESTION:"missing_quoted_question",MISSING_QUOTED_RESPONSE:"missing_quoted_response",EMPTY_RESPONSE_TEXT:"empty_response_text",MISSING_QUESTION_SERVER_ID:"missing_question_server_id"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="QuestionReplyValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.QuestionReplyValidationErrorCode=e,l.QuestionReplyValidationError=s}),98);
__d("WAWebQuestionsProtoUtils",["WALogger","WAWebE2EProtoParser","WAWebMsgKey","WAWebMsgType","WAWebQuestionValidationError","WAWebQuestionsGatingUtils","WAWebViewMode.flow","WAWebWamEnumE2eFailureReason","WAWebWidFactory","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t,n,a=e.message,i=e.questionReplyQuotedMessage;if(((t=i.quotedQuestion)==null||(t=t.questionMessage)==null?void 0:t.message)==null)throw new(o("WAWebQuestionValidationError")).QuestionReplyValidationError(o("WAWebQuestionValidationError").QuestionReplyValidationErrorCode.MISSING_QUOTED_QUESTION,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var l=o("WAWebE2EProtoParser").parseMsgProto({messageProtobuf:i.quotedQuestion.questionMessage.message,msgContext:"quoted",message:a}),s=(n=i.quotedResponse)==null?void 0:n.questionResponseMessage,c=u(s==null?void 0:s.key);if(!s||!c)throw new(o("WAWebQuestionValidationError")).QuestionReplyValidationError(o("WAWebQuestionValidationError").QuestionReplyValidationErrorCode.MISSING_QUOTED_RESPONSE,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(r("isStringNullOrEmpty")(s.text))throw new(o("WAWebQuestionValidationError")).QuestionReplyValidationError(o("WAWebQuestionValidationError").QuestionReplyValidationErrorCode.EMPTY_RESPONSE_TEXT,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d=i.serverQuestionId;if(d==null)throw new(o("WAWebQuestionValidationError")).QuestionReplyValidationError(o("WAWebQuestionValidationError").QuestionReplyValidationErrorCode.MISSING_QUESTION_SERVER_ID,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{quotedQuestion:l,questionServerId:d,quotedResponse:{id:c,type:o("WAWebMsgType").MSG_TYPE.NEWSLETTER_QUESTION_RESPONSE,kind:o("WAWebMsgType").MsgKind.NewsletterQuestionResponse,body:s.text,from:l.from,to:l.to,parentMsgKey:l.id,parentServerId:d,questionResponseInfo:{},viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE}}}function u(e){var t;if(!((e==null?void 0:e.id)==null||e.remoteJid==null))return new(r("WAWebMsgKey"))({id:e.id,fromMe:(t=e.fromMe)!=null?t:!1,remote:o("WAWebWidFactory").createWid(e.remoteJid)})}function c(t,n){if(n)try{t.questionReplyQuotedMessage=s({questionReplyQuotedMessage:n,message:{from:t.from,to:t.to,id:babelHelpers.extends({},t.id,{id:t.id.id+"_quoted_question"}),type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,count:null}})}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[questions][replies] Invalid question reply quoted message"]))).tags("questions","replies").sendLogs("questions-invalid-question-reply-quoted-msg")}}function d(e){var t,n,r=((t=e.contextInfo)==null?void 0:t.isQuestion)===!0&&!o("WAWebQuestionsGatingUtils").isQuestionReceiverEnabledForMsg(e.msgData),a=((n=e.contextInfo)==null?void 0:n.questionReplyQuotedMessage)!=null&&!o("WAWebQuestionsGatingUtils").isQuestionReplyReceiverEnabledForMsg(e.msgData);return r||a}l.getValidatedQuestionReplyQuotedMessage=s,l.maybeAddQuestionReplyQuotedMessage=c,l.shouldFutureProofQuestionMessage=d}),98);
__d("WAWebReactAddonMessageProcessorUtils",["WANullthrows","WAWebAddonDBTable","WAWebApiContact","WAWebCastToReactionMsg","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebSchemaReactions","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return[e.reactionParentKey,r("WANullthrows")(o("WAWebMsgGetters").getSender(e))]}function s(t){return e(t).map(function(e){return e.toString()}).join("-")}function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=new Map,r=t.map(e),a=yield o("WAWebAddonDBTable").addonDBTable.bulkGetByParentAndSender(o("WAWebMsgType").MSG_TYPE.REACTION,r);for(var i of a){var l=o("WAWebCastToReactionMsg").assertReactionMsgData(i),u=s(l);n.set(u,l.reactionTimestamp)}return function(e){var t=s(e);return n.get(t)}}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.map(e),a=[];for(var i of n){var l=i[0],s=i[1],u=s.isUser()?o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").asUserWidOrThrow(s)):void 0;u&&a.push([l.toString(),u.toString()])}var c=function(t,n){return t.toString()+"_"+n.toString()},d=yield o("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","senderUserJid"],a),m=new Set;return d.filter(Boolean).forEach(function(e){var t=[e.parentMsgKey,e.senderUserJid],n=t[0],a=t[1];m.add(c(r("WAWebMsgKey").from(n),o("WAWebWidFactory").createUserWidOrThrow(a)))}),t.map(function(t){var n=e(t),r=n[0],a=n[1],i=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").asUserWidOrThrow(a));if(i==null||!m.has(c(r,i)))return t;var l=t.author,s=t.from;if(l!=null&&l.isRegularUser()){var u=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").asUserWidOrThrow(l));u!=null&&(l=u)}if(t.from.isRegularUser()){var d=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").asUserWidOrThrow(t.from));d&&(s=d)}return babelHelpers.extends({},t,{from:s,author:l})})}),m.apply(this,arguments)}l.createGetReactionTimestamp=u,l.overrideExistingReactions=d}),98);
__d("WAWebReactionGatingUtils",["WAWebABProps"],(function(t,n,r,o,a,i,l){function e(){return o("WAWebABProps").getABPropConfigValue("web_reaction_notification_via_add_on_api")}l.isReactionNotificationAddOnApiEnabled=e}),98);
__d("WAWebReactionAddonMessageProcessor",["Promise","WALogger","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebBackendApi","WAWebBoolFunc","WAWebDBMarkFutureproofMessagesReparsed","WAWebLastAddOnDBSerialization","WAWebLidStatusMigrationKeyUtils","WAWebMsgType","WAWebReactAddonMessageProcessorUtils","WAWebReactionDataUtils","WAWebReactionEncryptMsgData","WAWebReactionGatingUtils","WAWebReactionsEncryption","WAWebReactionsParseWebMsgInfoReaction","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c;function d(e){return!new Set([o("WAWebAddonConstants").AddonProcessMode.HistorySync,o("WAWebAddonConstants").AddonProcessMode.Hydration]).has(e)}var m=function(t){return babelHelpers.extends({},t,{reactionParentKey:o("WAWebLidStatusMigrationKeyUtils").matKeyConvert(t.reactionParentKey)})},p=o("WAWebAddonCreateMsgProcessor").createAddonMsgProcessorDualEncrypted({isEnabled:o("WAWebBoolFunc").returnTrue,convert:{fromHistorySyncMsg:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebReactionsParseWebMsgInfoReaction").parseWebMsgInfoReaction(e.webMsgInfo,e.parsedWebMsgInfo).map(function(e){return o("WAWebReactionDataUtils").reactionRowToReactionMsgData(o("WAWebReactionDataUtils").webMsgInfoReactionTypeToReactionsRow(e))})});function t(t){return e.apply(this,arguments)}return t})(),toDualEncryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.ReactionEncrypted?e:o("WAWebReactionEncryptMsgData").encryptReactionMsgData(e,t)});function t(t,n){return e.apply(this,arguments)}return t})(),toDualDecryptedMsgData:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return e.kind===o("WAWebMsgType").MsgKind.ReactionDecrypted?e:o("WAWebReactionsEncryption").decryptReactionMsgData(e,t)});function t(t,n){return e.apply(this,arguments)}return t})()},updateCollection:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){yield o("WAWebBackendApi").frontendSendAndReceive("updateReactionCollection",{msgs:e.add.map(m),removeReactions:e.remove.map(o("WAWebLidStatusMigrationKeyUtils").matKeyConvert),allowNotifications:d(t)})});function t(t,n){return e.apply(this,arguments)}return t})(),beforeUpsert:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=r.parents,i=[],l=[];for(var d of t)d.kind===o("WAWebMsgType").MsgKind.ReactionEncrypted?l.push(d):d.kind===o("WAWebMsgType").MsgKind.ReactionDecrypted&&i.push(d);yield(c||(c=n("Promise"))).allSettled(l.map(function(e){return o("WAWebReactionsEncryption").decryptReactionMsgData(e,a.getForAddon(e))})).then(function(t){var n=0,r=[];for(var a of t)a.status==="fulfilled"&&a.value!=null?i.push(a.value):(n++,r.length<3&&a.status==="rejected"&&r.push(a.reason));n>0&&o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Cannot decrypt "," reactions: ",""])),n,r),t.some(function(e){return e.status==="rejected"})&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed decrypted enc reactions"]))).tags("messaging","addons").sendLogs("decrypt-enc-reaction-failed",{sampling:.01})});var m=i;try{m=yield o("WAWebReactAddonMessageProcessorUtils").overrideExistingReactions(i)}catch(e){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to override existing reactions: ",""])),e).sendLogs("override-existing-reactions-failed")}var p=yield o("WAWebReactAddonMessageProcessorUtils").createGetReactionTimestamp(m),_=m.filter(function(e){var t=p(e);return t==null||t<e.reactionTimestamp});return _});function r(e,n){return t.apply(this,arguments)}return r})(),afterUpsert:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.processMode;yield o("WAWebShouldUpdateLastAddOnPreview").filterAndUpdateChatPreviews(e.map(function(e){return o("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromReactionRowType(o("WAWebReactionDataUtils").reactionMsgDataToReactionRow(e))})),n===o("WAWebAddonConstants").AddonProcessMode.OnlineReceive&&(yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(e.map(function(e){return e.id.toString()})))});function t(t,n){return e.apply(this,arguments)}return t})(),manageNotifications:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.processMode;!d(n)||!o("WAWebReactionGatingUtils").isReactionNotificationAddOnApiEnabled()||o("WAWebBackendApi").frontendFireAndForget("handleReactionNotification",{reactions:e.add.map(m)})});function t(t,n){return e.apply(this,arguments)}return t})()}),_=p;l.default=_}),98);
__d("WAWebReactionEncryptMsgData",["WANullthrows","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebBackendApi","WAWebMsgGetters","WAWebMsgType","WAWebProcessBaseMsgInfo","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAWebBackendApi").frontendSendAndReceive("getGroupMetadata",{groupWid:e.id.remote});if(n!=null&&n.isCag){var a,i=self.crypto.getRandomValues(new Uint8Array(12)),l={type:(a=o("WAWebMsgType")).MsgKind.ReactionDecrypted,encode:{text:e.reactionText,senderTimestampMs:e.reactionTimestamp}},s=o("WAWebAddonEncryptionError").getValidatedMessageSecret(a.MsgKind.ReactionDecrypted,t),u=yield o("WAWebAddonEncryption").encryptAddOn(l,{messageSecret:s,iv:i,stanzaId:t.id.id,originalMessageSender:r("WANullthrows")(o("WAWebMsgGetters").getOriginalSender(t)),addOnSender:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(e)))}),c=u.encPayload;return babelHelpers.extends({},o("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(e),{type:a.MSG_TYPE.REACTION_ENC,kind:a.MsgKind.ReactionEncrypted,targetMessageKey:t.id,encPayload:c,encIv:i.buffer})}return e}),s.apply(this,arguments)}l.encryptReactionMsgData=e}),98);
__d("WAWebReactionEncMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({INVALID_ENC_IV:"enc_reaction_invalid_iv",INVALID_ENC_PAYLOAD:"enc_reaction_invalid_payload",MISSING_TARGET_MSG_KEY:"enc_reaction_missing_target_msg_key",MISSING_MESSAGE_SECRET:"enc_reaction_missing_message_secret",MISSING_SENDER:"enc_reaction_missing_sender",MISSING_PARENT_MESSAGE:"enc_reaction_missing_parent_message",MISSING_PARENT_MESSAGE_SENDER:"enc_reaction_missing_parent_message_sender",DECRYPTION_FAILED:"enc_reaction_decryption_failed"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="ReactionEncMessageValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.ReactionEncValidationErrorCode=e,l.ReactionEncMessageValidationError=s}),98);
__d("WAWebReactionsValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(t,n,r,o,a,i,l){var e=n("$InternalEnum")({INVALID_REACTION_TEXT_LENGTH:"reaction_invalid_text_length",MISSING_PARENT_MSG_KEY:"reaction_missing_parent_msg_key",MISSING_TIMESTAMP:"reaction_missing_timestamp"}),s=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="ReactionValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);l.ReactionValidationErrorCode=e,l.ReactionValidationError=s}),98);
__d("WAWebReactionsEncryption",["WALongInt","WANullthrows","WAWebAddonEncryption","WAWebAddonEncryptionError","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebReactionEncMessageValidationError","WAWebReactionsBEUtils","WAWebReactionsValidationError","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t={type:o("WAWebMsgType").MsgKind.ReactionEncrypted,encryptedAddOn:e.encryptedReaction},n=yield o("WAWebAddonEncryption").decryptAddOn(t,{messageSecret:e.messageSecret,iv:e.iv,stanzaId:e.stanzaId,originalMessageSender:e.originalMessageSender,addOnSender:e.reactionSender});return o("decodeProtobuf").decodeProtobuf(o("WAWebProtobufsE2E.pb").Message$ReactionMessageSpec,n)}),s.apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a,i=t.encIv,l=t.encPayload,s=t.targetMessageKey,u=o("WAWebAddonEncryptionError").getValidatedMessageSecret(o("WAWebMsgType").MsgKind.ReactionEncrypted,n),c=o("WAWebMsgGetters").getOriginalSender(n);if(c==null)throw new(o("WAWebReactionEncMessageValidationError")).ReactionEncMessageValidationError(o("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.MISSING_PARENT_MESSAGE_SENDER,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var d={encryptedReaction:l,messageSecret:u,iv:i,stanzaId:n.id.id,originalMessageSender:c,reactionSender:o("WAWebWidFactory").asUserWidOrThrow(r("WANullthrows")(o("WAWebMsgGetters").getSender(t)))},m;try{m=yield e(d)}catch(e){throw new(o("WAWebReactionEncMessageValidationError")).ReactionEncMessageValidationError(o("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.DECRYPTION_FAILED,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}var p=(a=o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(m.text))!=null?a:o("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT,_=m.senderTimestampMs;if(_==null)throw new(o("WAWebReactionsValidationError")).ReactionValidationError(o("WAWebReactionsValidationError").ReactionValidationErrorCode.MISSING_TIMESTAMP,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.REACTION,kind:o("WAWebMsgType").MsgKind.ReactionDecrypted,reactionParentKey:s,reactionText:p,reactionTimestamp:o("WALongInt").numberOrThrowIfTooLarge(_),encPayload:void 0,encIv:void 0,read:!1})}),c.apply(this,arguments)}l.parseEncReaction=e,l.decryptReactionMsgData=u}),98);
__d("WAWebDBCreateOrUpdateReactions",["WAWebApiContact","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){var t=new Map;return e.forEach(function(e){o("WAWebUserPrefsMeUser").isSerializedWidMe(e.senderUserJid)&&(e.read=!0);var n=s(e),r=t.get(n);r?r.timestamp<=e.timestamp&&t.set(n,e):t.set(n,e)}),o("WAWebModelStorageUtils").getStorage().lock(["reactions"],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=[],a=[];Array.from(t.values()).forEach(function(e){a.push([e.parentMsgKey,e.senderUserJid]);var t=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").createUserWidOrThrow(e.senderUserJid));t!=null&&a.push([e.parentMsgKey,t.toString()])});var i=yield n.anyOf(["parentMsgKey","senderUserJid"],a);return i.forEach(function(e){var n=s(e),o=t.get(n);o&&(o.timestamp<=e.timestamp?t.delete(n):o.senderUserJid!==e.senderUserJid&&r.push([e.parentMsgKey,e.senderUserJid]))}),r.length>0&&(yield n.bulkRemove(r)),yield n.bulkCreateOrReplace(Array.from(t.values())),Array.from(t.values())});return function(t){return e.apply(this,arguments)}})())}function s(e){var t=o("WAWebWidFactory").createUserWidOrThrow(e.senderUserJid),n=String(o("WAWebLidMigrationUtils").toPn(t)),r=String(o("WAWebLidMigrationUtils").toLid(t));return e.parentMsgKey+","+n+","+r}l.createOrUpdateReactions=e}),98);
__d("WAWebDBProcessReactionsMsgs",["WAWebApiChat","WAWebBackendApi","WAWebDBCreateOrUpdateReactions","WAWebDBMarkFutureproofMessagesReparsed","WAWebLastAddOnDBSerialization","WAWebReactionsBEUtils","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.length>0){var t=yield o("WAWebReactionsBEUtils").createReactionsRowFromMsg(e),n=yield o("WAWebDBCreateOrUpdateReactions").createOrUpdateReactions(t);o("WAWebReactionsBEUtils").updateHasReactionFromParent(n);var r=e.map(function(e){return e.id.toString()});yield o("WAWebDBMarkFutureproofMessagesReparsed").markFutureproofMessagesReparsed(r);var a=yield o("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(n.map(function(e){return o("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromReactionRowType(e)}));yield o("WAWebApiChat").bulkUpdateChatLastAddOnPreview(a),o("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:a})}}),s.apply(this,arguments)}l.processReactionMsgs=e}),98);
__d("WAWebReactionsParseWebMsgInfoReaction",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebE2EProtoUtils","WAWebProtobufsWeb.pb","WAWebWid","WAWebWidFactory","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u;function c(t,n){var a=[];try{var i;if(t==null||n==null)return a;var l=[];if(((i=t.messageAddOns)==null?void 0:i.length)>0){for(var c of t.messageAddOns)if(c.messageAddOnType===o("WAWebProtobufsWeb.pb").MessageAddOn$MessageAddOnType.REACTION){var d,m=(d=c.messageAddOn)==null?void 0:d.reactionMessage;m!=null&&l.push({key:r("WANullthrows")(c.messageAddOnKey),senderTimestampMs:o("WALongInt").numberOrThrowIfTooLarge(r("WANullthrows")(m.senderTimestampMs)),text:m.text,unread:c.status!==o("WAWebProtobufsWeb.pb").WebMessageInfo$Status.READ})}}else t.reactions!=null&&n.reactions!=null&&l.push.apply(l,n.reactions);var p=0,_=0;l.forEach(function(e){var t=e.key,i=e.senderTimestampMs,l=e.text,s=e.unread,u=o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(l!=null?l:""),c=r("WANullthrows")(o("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(t)),d=c.msgKey,m=c.sender;m==null||!(m instanceof r("WAWebWid"))?p++:u==null?_++:a.push({id:d,reactionTimestamp:i,reactionText:u,reactionParentKey:n.id,sender:o("WAWebWidFactory").createWid(m.toString()),unread:d.fromMe?!1:s===!0})}),p>0&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseWebMsgInfoReaction: "," reactions had sender that is not a wid."])),p),_>0&&o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseWebMsgInfoReaction: "," reactions had null text from convertToTextWithoutSpecialEmojis."])),_)}catch(e){var f=r("getErrorSafe")(e);o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoReaction failed with error "," and stack ",""])),f==null?void 0:f.name,f==null?void 0:f.stack)}return a}l.parseWebMsgInfoReaction=c}),98);
__d("WAWebDBChangeOrphanStateReactions",["WAWebModelStorageUtils","WAWebSchemaReactions","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebModelStorageUtils").getStorage().lock(["reactions"],(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],r=e.map(function(e){return[e,1]}),a=yield o("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","orphan"],r);return a.forEach(function(e){e.orphan=0,e.orphanReason=void 0}),yield n.bulkCreateOrReplace(a),a});return function(e){return t.apply(this,arguments)}})())}l.changeOrphanStateReactions=e}),98);
__d("WAWebCheckUpdateOrphanReactions",["WALogger","WAWebAddonProcessMsgs","WAWebDBChangeOrphanStateReactions","WAWebReactionDataUtils","WAWebStoreOrphans","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{var n=yield o("WAWebDBChangeOrphanStateReactions").changeOrphanStateReactions(t),r=yield o("WAWebAddonProcessMsgs").processMsgsAndGetOrphans(n.map(function(e){return o("WAWebReactionDataUtils").reactionRowToReactionMsgData(e)})),a=r.orphans;yield o("WAWebStoreOrphans").storeOrphans(a)}catch(t){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["checkUpdateForOrphanReactions: error ",""])),t)}}),u.apply(this,arguments)}l.checkUpdateForOrphanReactions=s}),98);
__d("WAWebReactionsParseReactionEncMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebReactionEncMessageValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.encReactionMessage;if(r!=null){var a=r.encIv,i=r.encPayload,l=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(r.targetMessageKey,t);if(l==null)throw new(o("WAWebReactionEncMessageValidationError")).ReactionEncMessageValidationError(o("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.MISSING_TARGET_MSG_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);if(a==null)throw new(o("WAWebReactionEncMessageValidationError")).ReactionEncMessageValidationError(o("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.INVALID_ENC_IV,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);if(i==null)throw new(o("WAWebReactionEncMessageValidationError")).ReactionEncMessageValidationError(o("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.INVALID_ENC_PAYLOAD,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.REACTION_ENC,kind:o("WAWebMsgType").MsgKind.ReactionEncrypted,encIv:a,encPayload:i,targetMessageKey:l}),contextInfo:null}}}l.default=e}),98);
__d("WAWebReactionsParseReactionMessageProto",["WALongInt","WAWebConstantsDeprecated","WAWebE2EProtoUtils","WAWebMsgType","WAWebReactionsBEUtils","WAWebReactionsValidationError","WAWebWamEnumE2eFailureReason"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageProtobuf,r=n.reactionMessage;if(r!=null){var a=s(r),i=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(r.key,t),l=o("WALongInt").maybeNumberOrThrowIfTooLarge(r.senderTimestampMs);if(i==null)throw new(o("WAWebReactionsValidationError")).ReactionValidationError(o("WAWebReactionsValidationError").ReactionValidationErrorCode.MISSING_PARENT_MSG_KEY,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l==null)throw new(o("WAWebReactionsValidationError")).ReactionValidationError(o("WAWebReactionsValidationError").ReactionValidationErrorCode.MISSING_TIMESTAMP,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.REACTION,kind:o("WAWebMsgType").MsgKind.ReactionDecrypted,reactionParentKey:i,reactionText:a,reactionTimestamp:l,read:!1}),contextInfo:null}}}function s(e){var t,n=e.text;if(n!=null&&n.length>r("WAWebConstantsDeprecated").REACTION_CONTENT_MAX_LENGTH)throw new(o("WAWebReactionsValidationError")).ReactionValidationError(o("WAWebReactionsValidationError").ReactionValidationErrorCode.INVALID_REACTION_TEXT_LENGTH,o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_REACTION_TEXT);return(t=o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(n))!=null?t:o("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT}l.default=e}),98);
__d("WAWebReactionDataUtils",["WANullthrows","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebReactionsBEUtils","WAWebViewMode.flow","WAWebWidFactory"],(function(t,n,r,o,a,i,l){function e(e){var t,n,a,i=r("WAWebMsgKey").fromString(e.msgKey),l=o("WAWebMsgKeyUtils").msgKeyToTargetInfo(i,o("WAWebMsgKeyUtils").TranslateMsgKeyType.Addon),s=l.author,u=l.from,c=l.to;return{id:i,to:c,from:u,author:s,type:o("WAWebMsgType").MSG_TYPE.REACTION,kind:o("WAWebMsgType").MsgKind.ReactionDecrypted,viewMode:o("WAWebViewMode.flow").ViewModeType.VISIBLE,reactionParentKey:r("WAWebMsgKey").fromString(e.parentMsgKey),reactionText:e.reactionText,reactionTimestamp:e.timestamp,t:(t=e.t)!=null?t:void 0,ack:(n=e.ack)!=null?n:void 0,read:(a=e.read)!=null?a:!1}}function s(e){var t;return{msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:r("WANullthrows")(o("WAWebMsgGetters").getSender(e)).toString(),reactionText:e.reactionText,timestamp:e.reactionTimestamp,t:o("WAWebMsgGetters").getT(e),ack:(t=o("WAWebMsgGetters").getAck(e))!=null?t:void 0,orphan:0,read:e.read}}function u(e){var t=e.id,n=e.reactionParentKey,r=e.reactionText,a=e.reactionTimestamp,i=e.sender,l=e.unread,s=o("WAWebWidFactory").asUserWidOrThrow(i),u=0;return{msgKey:t.toString(),parentMsgKey:n.toString(),senderUserJid:s.toString(),reactionText:r!=null?r:o("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT,timestamp:a,orphan:u,read:!l}}l.reactionRowToReactionMsgData=e,l.reactionMsgDataToReactionRow=s,l.webMsgInfoReactionTypeToReactionsRow=u}),98);
__d("WAWebDBGetReactions",["WAWebApiContact","WAWebEmoji","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebParseMsgKeyString","WAWebSchemaReactions","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e="";function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WAWebSchemaReactions").getReactionsTable().equals(["parentMsgKey"],t),a={reactions:[],reactionByMe:null},i=new Map;n.forEach(function(t){var n=t.orphan,l=t.reactionText;if(l!==e&&n!==1){var s,u=o("WAWebEmoji").EmojiUtil.getEmojiAggregate(l),c=(s=i.get(u))!=null?s:[];i.set(u,[].concat(c,[t]));var d=r("WAWebParseMsgKeyString")(t.msgKey);d.fromMe&&(a.reactionByMe=t)}});var l=a.reactionByMe?o("WAWebEmoji").EmojiUtil.getEmojiAggregate(a.reactionByMe.reactionText):"";return i.forEach(function(e,t){var n=!1;t===l&&(n=!0),a.reactions.push({aggregateEmoji:t,senders:e,hasReactionByMe:n})}),a}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=new Map;return yield o("WAWebModelStorageUtils").getStorage().lock(["reactions"],(function(){var o=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var o=n[0],a=yield o.anyOf(["parentMsgKey"],t);a.forEach(function(t){var n=t.orphan,o=t.reactionText;if(o!==e&&n!==1){var a,i=(a=r.get(t.parentMsgKey))!=null?a:[];i.push(t),r.set(t.parentMsgKey,i)}})});return function(e){return o.apply(this,arguments)}})()),r}),d.apply(this,arguments)}function m(e){return o("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(t){var n=t[0];return n.anyOf(["parentMsgKey"],e)})}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,a=e.parentMsgKey,i=e.senderUserJid,l=[],s=(t=o("WAWebLidMigrationUtils").getAlternateMsgKey(r("WAWebMsgKey").from(a)))==null?void 0:t.toString(),u=(n=o("WAWebApiContact").getAlternateUserWid(o("WAWebWidFactory").createUserWidOrThrow(i)))==null?void 0:n.toString(),c=[a,s].filter(Boolean),d=[i,u].filter(Boolean);for(var m of c)for(var p of d)l.push([m,p]);var _=yield o("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","senderUserJid"],l,{limit:1});return _[0]}),_.apply(this,arguments)}l.REVOKED_REACTION_TEXT=e,l.getReactions=s,l.getFilteredReactionsFromParentMsgs=c,l.getAllReactionsFromParentMsgs=m,l.existsReactionAddressingModeInsensitive=p}),98);
__d("WAWebReactionsBEUtils",["WALogger","WALongInt","WANullthrows","WAWebAddonQueryUtils","WAWebBotGenTypingIndicatorMsg","WAWebDBGetReactions","WAWebMessageAssociation.flow","WAWebMessageAssociationConstants","WAWebMsgType","WAWebSchemaMessage","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c=new Set([(u=o("WAWebMsgType")).MSG_TYPE.CIPHERTEXT,u.MSG_TYPE.REVOKED,u.MSG_TYPE.DEBUG,u.MSG_TYPE.DEBUG_PLACEHOLDER,u.MSG_TYPE.GP2,u.MSG_TYPE.NOTIFICATION,u.MSG_TYPE.NEWSLETTER_NOTIFICATION,u.MSG_TYPE.NOTIFICATION_TEMPLATE,u.MSG_TYPE.E2E_NOTIFICATION]),d=new Set([o("WAWebMessageAssociation.flow").MessageAssociationType.MEDIA_POLL]);function m(e){var t=e.associationType,n=e.futureproofType,r=e.subtype,a=e.type;return a===o("WAWebMsgType").MSG_TYPE.UNKNOWN?n!=null&&o("WAWebMessageAssociationConstants").orphanIneligibleFutureproofTypes.has(n):!(c.has(a)||t!=null&&d.has(t)||a===o("WAWebMsgType").MSG_TYPE.CHAT&&r===o("WAWebBotGenTypingIndicatorMsg").BOT_TYPING_PLACEHOLDER_MSG_SUBTYPE)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=[],a=[];t.forEach(function(e){e&&a.push(e.reactionParentKey)});var i=yield o("WAWebAddonQueryUtils").getParentMsgsByMsgKey(a),l=0,u=0;return t.forEach(function(e){var t,a,s,c=(t=e.author)!=null?t:e.from;if(!c||!e){l++;return}var d=i.get(e.reactionParentKey.toString());if(d&&!m(d)){u++;return}var p=o("WAWebWidFactory").asUserWidOrThrow(c),_={msgKey:e.id.toString(),parentMsgKey:(a=d==null?void 0:d.id.toString())!=null?a:e.reactionParentKey.toString(),senderUserJid:p.toString(),reactionText:(s=e.reactionText)!=null?s:o("WAWebDBGetReactions").REVOKED_REACTION_TEXT,timestamp:e.reactionTimestamp,orphan:0,orphanReason:void 0,read:!1,t:r("WANullthrows")(o("WALongInt").maybeNumberOrThrowIfTooLarge(e.t))};n.push(_)}),l>0&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["createReactionsRowFromMsg: sender or reactionMsg are null for "," messages"])),l),u>0&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["createReactionsRowFromMsg: reactions not allowed for "," messages"])),u),n}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=[],n=[];e.forEach(function(e){var r=e.orphan,a=e.parentMsgKey,i=e.reactionText;if(r!==1)if(i!==o("WAWebDBGetReactions").REVOKED_REACTION_TEXT){var l={id:a,hasReaction:!0};n.push(l)}else t.push(a)});var r=yield o("WAWebDBGetReactions").getFilteredReactionsFromParentMsgs(t);return t.forEach(function(e){var t=r.get(e),o=t&&t.length>0||!1,a={id:e,hasReaction:o};n.push(a)}),o("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(n)}),g.apply(this,arguments)}l.REVOKED_REACTION_TEXT=o("WAWebDBGetReactions").REVOKED_REACTION_TEXT,l.canHaveReactions=m,l.createReactionsRowFromMsg=p,l.updateHasReactionFromParent=f}),98);
__d("WAWebParseProtocolAdminRevokeMessageProto",["WAWebAck","WAWebProtocolRevokeMessageUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.editAttr,r=e.messageProtobuf,a=e.msgContext,i=e.msgMeta;if(n===o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE)return o("WAWebProtocolRevokeMessageUtils").parseProtocolRevokeMessageProto({messageProtobuf:r,baseMessage:t,editAttr:n,msgContext:a,msgMeta:i})}l.default=e}),98);
__d("WAWebParseProtocolSenderRevokeMessageProto",["WAWebAck","WAWebProtocolRevokeMessageUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.editAttr,r=e.messageProtobuf,a=e.msgContext,i=e.msgMeta;if(n===o("WAWebAck").EDIT_ATTR.SENDER_REVOKE)return o("WAWebProtocolRevokeMessageUtils").parseProtocolRevokeMessageProto({messageProtobuf:r,baseMessage:t,editAttr:n,msgContext:a,msgMeta:i})}l.default=e}),98);
__d("WAWebProtocolRevokeMessageUtils",["WALogger","WAWebAck","WAWebE2EProtoUtils","WAWebHandleMsgError","WAWebHandleMsgMetaUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason","getErrorSafe"],(function(t,n,r,o,a,i,l){var e,s,u,c=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="ProtocolRevokeMessageValidationError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(o("WAWebHandleMsgError").MessageValidationError);function d(t){var n,a=t.baseMessage,i=t.editAttr,l=t.messageProtobuf,d=t.msgContext,m=t.msgMeta,p=l.protocolMessage;if(p!=null){var _=p.key,f=p.type;if(!(d!=="relay"&&f!==o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SETTING)&&f===o("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REVOKE){var g;if((n=a.author)!=null&&n.isLid()&&o("WAWebHandleMsgMetaUtils").isCommentMsgMeta(m)?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["found comment revoke"]))),g=o("WAWebE2EProtoUtils").translateAddonMessageKeyToLocalReference(_,a)):g=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(_,a),g==null)throw o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["missing a revoke message key "," (",") for "," from "," for ",""])),_==null?void 0:_.id,!!_,a.id,a.author,f),new c("protocol_revoke_missing_key",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);var h;if(i===o("WAWebAck").EDIT_ATTR.ADMIN_REVOKE)h="admin_revoke";else if(i===o("WAWebAck").EDIT_ATTR.SENDER_REVOKE)h="sender_revoke";else throw new c("protocol_revoke_missing_edit_attr",o("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);try{return{msgData:babelHelpers.extends({},a,{type:o("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:o("WAWebMsgType").MsgKind.ProtocolRevoke,subtype:h,protocolMessageKey:g}),contextInfo:null}}catch(e){var y=r("getErrorSafe")(e);throw o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["parseProtocolRevokeMessageProto: error:",", stack: ",""])),y.name,y.stack).tags("messaging").sendLogs("ProtocolRevokeParseError"),y}}}}l.ProtocolRevokeMessageValidationError=c,l.parseProtocolRevokeMessageProto=d}),98);
__d("WAWebGenerateImageReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebGenerateVideoReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebMediaProtoUtils",["isEmptyObject"],(function(t,n,r,o,a,i,l){"use strict";var e=["$$unknownFieldCount","annotations","imageSourceType","interactiveAnnotations","scanLengths"],s=["$$unknownFieldCount","annotations","interactiveAnnotations","processedVideos"];function u(t){var n=t.$$unknownFieldCount,o=t.annotations,a=t.imageSourceType,i=t.interactiveAnnotations,l=t.scanLengths,s=babelHelpers.objectWithoutPropertiesLoose(t,e);return r("isEmptyObject")(s)}function c(e){var t=e.$$unknownFieldCount,n=e.annotations,o=e.interactiveAnnotations,a=e.processedVideos,i=babelHelpers.objectWithoutPropertiesLoose(e,s);return r("isEmptyObject")(i)}l.isEmptyImageMessage=u,l.isEmptyVideoMessage=c}),98);
__d("WAWebParseImageMessageProto",["WALongInt","WATimeUtils","WAWebAssociationProtoUtils","WAWebBotGating","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaMessageGetValidatedProperties","WAWebMediaProtoUtils","WAWebMessageAssociation.flow","WAWebMessageAssociationGatingUtils","WAWebMsgType","WAWebPollsGatingUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageAssociation,r=e.messageProtobuf,a=e.msgContext,i=e.msgMeta,l=r.imageMessage;if(l!=null){if(o("WAWebMediaProtoUtils").isEmptyImageMessage(l)&&o("WAWebBotGating").isLoadingMediaMessagesEnabled(t))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.LOADING_MEDIA,kind:o("WAWebMsgType").MsgKind.LoadingMedia,subtype:"loading_image"}),contextInfo:l.contextInfo};var s=l.annotations,u=l.caption,c=l.contextInfo,d=l.directPath,m=l.height,p=l.jpegThumbnail,_=l.mediaKeyTimestamp,f=l.mimetype,g=l.scanLengths,h=l.scansSidecar,y=l.staticUrl,C=l.thumbnailDirectPath,b=l.thumbnailEncSha256,v=l.thumbnailSha256,S=l.viewOnce,R=l.width,L=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(l,t,a,o("WAWebMsgType").MSG_TYPE.IMAGE),E=L.fileEncSha256,k=L.fileLength,I=L.fileSha256,T=L.mediaKey,D=L.url,x=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.IMAGE,kind:o("WAWebMsgType").MsgKind.Image,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(D),directPath:d||"",staticUrl:y||"",mimetype:f||"",caption:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(u),filehash:o("WAWebE2EProtoParserApi").decodeBytes(I),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(E),size:k,height:m||0,width:R||0,mediaKey:o("WAWebE2EProtoParserApi").decodeBytes(T),mediaKeyTimestamp:_!=null?o("WALongInt").numberOrThrowIfTooLarge(_):o("WATimeUtils").unixTime(),body:o("WAWebE2EProtoParserApi").decodeBytes(p)||"",interactiveAnnotations:s,scanLengths:g,scansSidecar:h,isViewOnce:S===!0,thumbnailDirectPath:C,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(v),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(b),statusMentioned:i==null?void 0:i.statusMentioned});if(o("WAWebE2EProtoParserApi").validateRequiredMediaProperties(x,l),n&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var $=o("WAWebAssociationProtoUtils").getValidatedAssociationFieldsFromProto(n,t,a),P=$.associationParentMsgKey,N=$.associationType,M=$.viewMode;if(N===o("WAWebMessageAssociation.flow").MessageAssociationType.MEDIA_POLL&&!o("WAWebPollsGatingUtils").isPhotoPollReceiverEnabled(t))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:o("WAWebMsgType").MsgKind.Unknown,futureproofType:o("WAWebMsgType").MSG_TYPE.IMAGE}),contextInfo:c};var w=babelHelpers.extends({},x,{kind:"associatedImage",parentMsgKey:P,associationType:N,viewMode:M});return{msgData:w,contextInfo:c}}return{msgData:x,contextInfo:c}}}l.default=e}),98);
__d("WAWebParseVideoMessageProto",["WALongInt","WATimeUtils","WAWebAssociationProtoUtils","WAWebBotGating","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaMessageGetValidatedProperties","WAWebMediaProtoUtils","WAWebMessageAssociationGatingUtils","WAWebMsgType"],(function(t,n,r,o,a,i,l){function e(e){var t=e.baseMessage,n=e.messageAssociation,r=e.messageProtobuf,a=e.msgContext,i=e.msgMeta,l=r.videoMessage;if(l!=null){if(o("WAWebMediaProtoUtils").isEmptyVideoMessage(l)&&o("WAWebBotGating").isLoadingMediaMessagesEnabled(t))return{msgData:babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.LOADING_MEDIA,kind:o("WAWebMsgType").MsgKind.LoadingMedia,subtype:"loading_video"}),contextInfo:l.contextInfo};var s=l.accessibilityLabel,u=l.annotations,c=l.caption,d=l.contextInfo,m=l.directPath,p=l.gifAttribution,_=l.gifPlayback,f=l.height,g=l.jpegThumbnail,h=l.mediaKeyTimestamp,y=l.mimetype,C=l.seconds,b=l.staticUrl,v=l.streamingSidecar,S=l.thumbnailDirectPath,R=l.thumbnailEncSha256,L=l.thumbnailSha256,E=l.viewOnce,k=l.width,I=o("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(l,t,a,o("WAWebMsgType").MSG_TYPE.VIDEO),T=I.fileEncSha256,D=I.fileLength,x=I.fileSha256,$=I.mediaKey,P=I.url,N=babelHelpers.extends({},t,{type:o("WAWebMsgType").MSG_TYPE.VIDEO,kind:o("WAWebMsgType").MsgKind.Video,deprecatedMms3Url:o("WAWebE2EProtoParserApi").decodeUrl(P),directPath:m,staticUrl:b||"",mimetype:y,caption:o("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(c),filehash:o("WAWebE2EProtoParserApi").decodeBytes(x),encFilehash:o("WAWebE2EProtoParserApi").decodeBytes(T),size:D,height:f,width:k,mediaKey:o("WAWebE2EProtoParserApi").decodeBytes($),mediaKeyTimestamp:h!=null?o("WALongInt").numberOrThrowIfTooLarge(h):o("WATimeUtils").unixTime(),duration:""+(C||0),body:o("WAWebE2EProtoParserApi").decodeBytes(g)||"",interactiveAnnotations:u,isViewOnce:E===!0,thumbnailDirectPath:S,thumbnailSha256:o("WAWebE2EProtoParserApi").decodeBytes(L),thumbnailEncSha256:o("WAWebE2EProtoParserApi").decodeBytes(R),isGif:_,gifAttribution:p,accessibilityLabel:s,streamingSidecar:v,statusMentioned:i==null?void 0:i.statusMentioned});if(o("WAWebE2EProtoParserApi").validateRequiredMediaProperties(N,l),n&&o("WAWebMessageAssociationGatingUtils").isMessageAssociationInfraEnabled()){var M=o("WAWebAssociationProtoUtils").getValidatedAssociationFieldsFromProto(n,t,a),w=M.associationParentMsgKey,A=M.associationType,F=M.viewMode,O=babelHelpers.extends({},N,{kind:"associatedVideo",parentMsgKey:w,associationType:A,viewMode:F});return{msgData:O,contextInfo:d}}return{msgData:N,contextInfo:d}}}l.default=e}),98);
__d("WAWebGenerateStickerReportingTokenContent",["WAWebReportingTokenUtils"],(function(t,n,r,o,a,i,l){function e(e){return o("WAWebReportingTokenUtils").getMediaReportingTokenContent(e)}l.default=e}),98);
__d("WAWebAiThreadCreationUtils",["WAWebBotUtils","WAWebMsgKey","WAWebPonyfillsCryptoRandomUUID","WAWebThreadId","WAWebThreadUtils"],(function(t,n,r,o,a,i,l){"use strict";var e="38e75a8e-6bc8-cf82-ab85-73799b39acd9";function s(){return new(r("WAWebThreadId"))({key:new(r("WAWebMsgKey"))({fromMe:!0,id:e,remote:o("WAWebBotUtils").META_BOT_PN_WID}),type:o("WAWebThreadUtils").ThreadType.AiThread})}function u(e){var t=r("WAWebPonyfillsCryptoRandomUUID")(),n=new(r("WAWebMsgKey"))({fromMe:!0,remote:e,id:t});return new(r("WAWebThreadId"))({key:n,type:o("WAWebThreadUtils").ThreadType.AiThread})}function c(e,t){var n=new(r("WAWebMsgKey"))({fromMe:!0,remote:e,id:t});return new(r("WAWebThreadId"))({key:n,type:o("WAWebThreadUtils").ThreadType.AiThread})}l.getHistoricalMetaAiThreadId=s,l.createAiThreadId=u,l.createAiThreadFromMutationIndex=c}),98);
__d("WAWebThreadsMetadataProtoUtils",["WALogger","WAWebAiThreadCreationUtils","WAWebAiThreadTypeUtils","WAWebBotGating","WAWebBotUtils","WAWebE2EProtoUtils","WAWebProtobufsE2E.pb","WAWebThreadMsgUtils","WAWebThreadUtils","WAWebThreadsGating","err"],(function(t,n,r,o,a,i,l){var e,s,u;function c(e,t){if(e.threadKey==null||!o("WAWebBotGating").isAiChatThreadsInfraEnabled())return null;var n={id:e.threadKey.id,remoteJid:t.remote.toString(),fromMe:!0},r=o("WAWebE2EProtoUtils").protobufToMsgKey(n);return o("WAWebThreadUtils").getThreadIDfromType(r,o("WAWebThreadUtils").ThreadType.AiThread)}function d(e,t){var n=e.serverInfo,r=n==null?void 0:n.title,a=t.remote;if(o("WAWebBotUtils").isMetaAiBot(a))return{title:r,aiThreadType:o("WAWebAiThreadTypeUtils").AiThreadType.Default};var i=e==null?void 0:e.clientInfo;if(i==null||i.type==null)return null;var l=o("WAWebAiThreadTypeUtils").getAiThreadTypeFromProto(i.type);return o("WAWebAiThreadTypeUtils").getAiThreadInfoFromType(r,l)}function m(t,n){if(t.threadKey==null||!o("WAWebThreadsGating").isViewRepliesInfraEnabled())return null;var r=o("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(t.threadKey,n);return r==null?(o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseViewAllRepliesThreadId : null msgKey for view replies thread"]))),null):o("WAWebThreadUtils").getThreadIDfromType(r,o("WAWebThreadUtils").ThreadType.ViewAllReplies)}function p(e,t){var n;if((t==null?void 0:t.threadId)!=null){var a=[],i=new Set;for(var l of t.threadId){var p=l.threadType;if(p!=null){if(i.has(p))throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseThreadsMetadataProto: Duplicate threadType detected. threadType: ",""])),p).sendLogs("parse-threads-metadata-duplicate-thread-type"),r("err")("Duplicate ThreadType");var _=null;e:{if(p===o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.VIEW_REPLIES){_=m(l,e);break e}if(p===o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.AI_THREAD){_=c(l,e.id);break e}if(p===o("WAWebProtobufsE2E.pb").ThreadID$ThreadType.UNKNOWN){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["parseThreadsMetadataProto: Unknown threadType detected. threadType: ",""])),p);continue}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+p)}_!=null&&(a.push(_),i.add(p))}}a.length>0&&(e.threadIds=a)}var f=(n=t==null?void 0:t.botMetadata)!=null?n:{},g=f.botThreadInfo;if(g!=null&&o("WAWebBotGating").isAiChatThreadsInfraEnabled()){var h=d(g,e.id);h!=null&&(e.aiThreadInfo=h)}}function _(e,t){var n;if(t==="history"){var r=e.id.remote,a=(n=e.threadIds)!=null?n:[];o("WAWebThreadMsgUtils").threadsContainAiThread(a)||o("WAWebBotUtils").isMetaAiBot(r)&&o("WAWebBotGating").isAiChatThreadsInfraEnabled()&&(e.threadIds=[].concat(a,[o("WAWebAiThreadCreationUtils").getHistoricalMetaAiThreadId()]))}}function f(e,t){var n;if(t==="history"){var r=e.id.remote;if(o("WAWebBotUtils").isMetaAiBot(r)&&o("WAWebBotGating").isAiChatThreadsInfraEnabled()){var a=(n=e.threadIds)!=null?n:[];o("WAWebThreadMsgUtils").threadsContainAiThread(a)&&e.aiThreadInfo==null&&(e.aiThreadInfo={aiThreadType:o("WAWebAiThreadTypeUtils").AiThreadType.Default,title:void 0})}}}l.parseThreadsMetadataProto=p,l.maybeAddHistoricalThreadIdForMetaAi=_,l.maybeAddAiThreadInfoForMetaAi=f}),98);
__d("WAWebApiVerifiedBusinessName",["invariant","$InternalEnum","Promise","WAWebBizGatingUtils","WAWebHandleMsgTypes.flow","WAWebLidMigrationUtils","WAWebSchemaVerifiedBusinessName","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l,s){var e;function u(){return o("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().all()}var c=n("$InternalEnum").Mirrored(["Replace","Merge"]);function d(e){return o("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().get(R(e))}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.isLid()||s(0,86986);var t=yield d(e);if(t==null){var n=o("WAWebLidMigrationUtils").toPn(e);if(n!=null){var r=yield d(n);if(r!=null)return babelHelpers.extends({},r,{id:R(e)})}}return t}),p.apply(this,arguments)}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebLidMigrationUtils").toLid(e);if(t!=null){var n=yield d(t);if(n!=null)return babelHelpers.extends({},n,{id:R(e)})}return d(e)}),f.apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return o("WAWebBizGatingUtils").isLidMigrationForVnameEnabled()?e.isUser()?e.isLid()?m(e):_(e):null:d(e)}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){n===void 0&&(n=c.Replace);var r=o("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable(),a=R(e),i=babelHelpers.extends({},t,{id:a});n===c.Replace?yield r.createOrReplace(i):yield r.createOrMerge(a,i)}),C.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield d(e);return(t==null?void 0:t.privacyMode)==null?null:S(t.privacyMode)}),v.apply(this,arguments)}function S(e){var t=o("WAWebHandleMsgTypes.flow").ActualActorsEnumType.cast(e.actualActors),n=o("WAWebHandleMsgTypes.flow").HostStorageEnumType.cast(e.hostStorage);return t==null||n==null?null:{actualActors:t,hostStorage:n,privacyModeTs:e.privacyModeTs}}function R(e){return e.isLid()?e.toString():e.user}function L(e,t,n){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){a===void 0&&(a=c.Replace);var i=o("WAWebBizGatingUtils").isLidMigrationForVnameEnabled()?o("WAWebLidMigrationUtils").getPnAndLidToUpdate(t):[t];return(e||(e=n("Promise"))).all(i.map(function(e){return y(e,r,a)}))}),E.apply(this,arguments)}l.getAllVerifiedNames=u,l.VerifiedBusinessNameUpdateType=c,l.getVerifiedBusinessNameRecord=d,l.getVerifiedBusinessNameRecordLidAware=g,l.createOrUpdateVerifiedBusinessName=y,l.getPrivacyMode=b,l.convertPrivacyModeFromStorageType=S,l.widToId=R,l.createOrUpdateVerifiedBusinessNameLidAware=L}),98);
__d("WAWebHandlePrivacyModeUpdateMsgAction",["Promise","WAWebApiChat","WAWebApiVerifiedBusinessName","WAWebBackendApi","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){var i;if(a===void 0&&(a={}),!(!t.isUserNotPSA()||t.isCAPISupportAccount())){var l=yield c(t,a.chat);if(l!=null&&l.isBusiness!==!1&&!(l.privacyMode==null&&r==null)&&!(l.privacyMode!=null&&r!=null&&l.privacyMode.privacyModeTs>=r.privacyModeTs)){var s=a,u=s.bypassVerifiedNameUpdate,d=u===void 0?!1:u,m={isBusiness:(i=l.isBusiness)!=null?i:!1,privacyMode:l.privacyMode},p={isBusiness:!0,privacyMode:r};t.isUser()&&o("WAWebBackendApi").frontendFireAndForget("updateBusinessInfo",{contactId:t,businessInfo:{isBusiness:!0,isEnterprise:!0,privacyMode:r}}),yield(e||(e=n("Promise"))).all([d?null:o("WAWebApiVerifiedBusinessName").createOrUpdateVerifiedBusinessNameLidAware(t,{isApi:!0,isSmb:!1,privacyMode:r?{actualActors:r.actualActors,hostStorage:r.hostStorage,privacyModeTs:r.privacyModeTs}:null},o("WAWebApiVerifiedBusinessName").VerifiedBusinessNameUpdateType.Merge),o("WAWebBackendApi").frontendFireAndForget("generateAndUpdatePrivacySystemMessages",{wid:t,previousState:m,currentState:p,shouldRunMATonWid:a.shouldRunMATonWid})])}}}),u.apply(this,arguments)}function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){if(r!=null){var a=r.contact.isBusiness;return{isBusiness:a,privacyMode:a?r.contact.privacyMode:null}}var i=yield(e||(e=n("Promise"))).all([o("WAWebApiChat").getChatRecord(t),o("WAWebApiVerifiedBusinessName").getVerifiedBusinessNameRecordLidAware(t)]),l=i[0],s=i[1];return l==null?null:s==null?{isBusiness:null}:{isBusiness:!0,privacyMode:s.privacyMode==null?null:o("WAWebApiVerifiedBusinessName").convertPrivacyModeFromStorageType(s.privacyMode)}}),d.apply(this,arguments)}l.handlePrivacyModeTransition=s,l.getChatInfo=c}),98);